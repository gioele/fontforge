<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd) - fontforge/fvcomposite.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">fontforge</a> - fvcomposite.c<span style="font-size: 80%;"> (source / <a href="fvcomposite.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd)</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">1323</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-08-04</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">52</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* -*- coding: utf-8 -*- */</a>
<span class="lineNum">       2 </span>            : /* Copyright (C) 2000-2012 by George Williams */
<span class="lineNum">       3 </span>            : /*
<span class="lineNum">       4 </span>            :  * Redistribution and use in source and binary forms, with or without
<span class="lineNum">       5 </span>            :  * modification, are permitted provided that the following conditions are met:
<span class="lineNum">       6 </span>            : 
<span class="lineNum">       7 </span>            :  * Redistributions of source code must retain the above copyright notice, this
<span class="lineNum">       8 </span>            :  * list of conditions and the following disclaimer.
<span class="lineNum">       9 </span>            : 
<span class="lineNum">      10 </span>            :  * Redistributions in binary form must reproduce the above copyright notice,
<span class="lineNum">      11 </span>            :  * this list of conditions and the following disclaimer in the documentation
<span class="lineNum">      12 </span>            :  * and/or other materials provided with the distribution.
<span class="lineNum">      13 </span>            : 
<span class="lineNum">      14 </span>            :  * The name of the author may not be used to endorse or promote products
<span class="lineNum">      15 </span>            :  * derived from this software without specific prior written permission.
<span class="lineNum">      16 </span>            : 
<span class="lineNum">      17 </span>            :  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
<span class="lineNum">      18 </span>            :  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
<span class="lineNum">      19 </span>            :  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
<span class="lineNum">      20 </span>            :  * EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span class="lineNum">      21 </span>            :  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
<span class="lineNum">      22 </span>            :  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
<span class="lineNum">      23 </span>            :  * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
<span class="lineNum">      24 </span>            :  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
<span class="lineNum">      25 </span>            :  * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
<span class="lineNum">      26 </span>            :  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span class="lineNum">      27 </span>            :  */
<span class="lineNum">      28 </span>            : #include &quot;autohint.h&quot;
<span class="lineNum">      29 </span>            : #include &quot;autowidth.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;bitmapchar.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;bvedit.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;cvundoes.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;encoding.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;fontforgevw.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;fvfonts.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;splinefill.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;splinesaveafm.h&quot;
<span class="lineNum">      38 </span>            : #include &quot;splineutil.h&quot;
<span class="lineNum">      39 </span>            : #include &quot;namelist.h&quot;
<span class="lineNum">      40 </span>            : #include &lt;chardata.h&gt;
<span class="lineNum">      41 </span>            : #include &lt;math.h&gt;
<span class="lineNum">      42 </span>            : #include &lt;utype.h&gt;
<span class="lineNum">      43 </span>            : #include &lt;ustring.h&gt;
<span class="lineNum">      44 </span>            : 
<span class="lineNum">      45 </span>            : int accent_offset = 6;
<span class="lineNum">      46 </span>            : int GraveAcuteCenterBottom = 1;
<span class="lineNum">      47 </span>            : int PreferSpacingAccents = true;
<span class="lineNum">      48 </span>            : int CharCenterHighest = 1;
<span class="lineNum">      49 </span>            : 
<span class="lineNum">      50 </span>            : #define BottomAccent    0x300
<span class="lineNum">      51 </span>            : #define TopAccent       0x345
<span class="lineNum">      52 </span>            : 
<span class="lineNum">      53 </span>            : /* for accents between 0x300 and 345 these are some synonyms */
<span class="lineNum">      54 </span>            : /* type1 wants accented chars built with accents in the 0x2c? range */
<span class="lineNum">      55 </span>            : /*  except for grave and acute which live in iso8859-1 range */
<span class="lineNum">      56 </span>            : /*  this table is ordered on a best try basis */
<span class="lineNum">      57 </span>            : static const unichar_t accents[][4] = {
<span class="lineNum">      58 </span>            :     { 0x2cb, 0x300, 0x60 },     /* grave */
<span class="lineNum">      59 </span>            :     { 0x2ca, 0x301, 0xb4 },     /* acute */
<span class="lineNum">      60 </span>            :     { 0x2c6, 0x302, 0x5e },     /* circumflex */
<span class="lineNum">      61 </span>            :     { 0x2dc, 0x303, 0x7e },     /* tilde */
<span class="lineNum">      62 </span>            :     { 0x2c9, 0x304, 0xaf },     /* macron */
<span class="lineNum">      63 </span>            :     { 0x305, 0xaf },            /* overline, (macron is suggested as a syn, but it's not quite right) */
<span class="lineNum">      64 </span>            :     { 0x2d8, 0x306 },           /* breve */
<span class="lineNum">      65 </span>            :     { 0x2d9, 0x307, '.' },      /* dot above */
<span class="lineNum">      66 </span>            :     { 0xa8,  0x308 },           /* diaeresis */
<span class="lineNum">      67 </span>            :     { 0x2c0 },                  /* hook above */
<span class="lineNum">      68 </span>            :     { 0x2da, 0xb0 },            /* ring above */
<span class="lineNum">      69 </span>            :     { 0x2dd },                  /* real acute */
<span class="lineNum">      70 </span>            :     { 0x2c7 },                  /* caron */
<span class="lineNum">      71 </span>            :     { 0x2c8, 0x384, 0x30d, '\''  },     /* vertical line, tonos */
<span class="lineNum">      72 </span>            :     { 0x30e, '&quot;' },                /* real vertical line */
<span class="lineNum">      73 </span>            :     { 0 },                      /* real grave */
<span class="lineNum">      74 </span>            :     { 0 },                      /* cand... */           /* 310 */
<span class="lineNum">      75 </span>            :     { 0 },                      /* inverted breve */
<span class="lineNum">      76 </span>            :     { 0x2bb },                  /* turned comma */
<span class="lineNum">      77 </span>            :     { 0x2bc, 0x313, ',' },      /* comma above */
<span class="lineNum">      78 </span>            :     { 0x2bd },                  /* reversed comma */
<span class="lineNum">      79 </span>            :     { 0x2bc, 0x315, ',' },      /* comma above right */
<span class="lineNum">      80 </span>            :     { 0x316, 0x60, 0x2cb },     /* grave below */
<span class="lineNum">      81 </span>            :     { 0x317, 0xb4, 0x2ca },     /* acute below */
<span class="lineNum">      82 </span>            :     { 0 },                      /* left tack */
<span class="lineNum">      83 </span>            :     { 0 },                      /* right tack */
<span class="lineNum">      84 </span>            :     { 0 },                      /* left angle */
<span class="lineNum">      85 </span>            :     { 0 },                      /* horn, sometimes comma but only if nothing better */
<span class="lineNum">      86 </span>            :     { 0 },                      /* half ring */
<span class="lineNum">      87 </span>            :     { 0x2d4 },                  /* up tack */
<span class="lineNum">      88 </span>            :     { 0x2d5 },                  /* down tack */
<span class="lineNum">      89 </span>            :     { 0x2d6, 0x31f, '+' },      /* plus below */
<span class="lineNum">      90 </span>            :     { 0x2d7, 0x320, '-' },      /* minus below */       /* 320 */
<span class="lineNum">      91 </span>            :     { 0x2b2 },                  /* hook */
<span class="lineNum">      92 </span>            :     { 0 },                      /* back hook */
<span class="lineNum">      93 </span>            :     { 0x323, 0x2d9, '.' },      /* dot below */
<span class="lineNum">      94 </span>            :     { 0x324, 0xa8 },            /* diaeresis below */
<span class="lineNum">      95 </span>            :     { 0x325, 0x2da, 0xb0 },     /* ring below */
<span class="lineNum">      96 </span>            :     { 0x326, 0x2bc, ',' },      /* comma below */
<span class="lineNum">      97 </span>            :     { 0xb8 },                   /* cedilla */
<span class="lineNum">      98 </span>            :     { 0x2db },                  /* ogonek */            /* 0x328 */
<span class="lineNum">      99 </span>            :     { 0x329, 0x2c8, 0x384, '\''  },     /* vertical line below */
<span class="lineNum">     100 </span>            :     { 0 },                      /* bridge below */
<span class="lineNum">     101 </span>            :     { 0 },                      /* real arch below */
<span class="lineNum">     102 </span>            :     { 0x32c, 0x2c7 },           /* caron below */
<span class="lineNum">     103 </span>            :     { 0x32d, 0x2c6, 0x52 },     /* circumflex below */
<span class="lineNum">     104 </span>            :     { 0x32e, 0x2d8 },           /* breve below */
<span class="lineNum">     105 </span>            :     { 0 },                      /* inverted breve below */
<span class="lineNum">     106 </span>            :     { 0x330, 0x2dc, 0x7e },     /* tilde below */       /* 0x330 */
<span class="lineNum">     107 </span>            :     { 0x331, 0xaf, 0x2c9 },     /* macron below */
<span class="lineNum">     108 </span>            :     { 0x332, '_' },             /* low line */
<span class="lineNum">     109 </span>            :     { 0 },                      /* real low line */
<span class="lineNum">     110 </span>            :     { 0x334, 0x2dc, 0x7e },     /* tilde overstrike */
<span class="lineNum">     111 </span>            :     { 0x335, '-' },             /* line overstrike */
<span class="lineNum">     112 </span>            :     { 0x336, '_' },             /* long line overstrike */
<span class="lineNum">     113 </span>            :     { 0x337, '/' },             /* short solidus overstrike */
<span class="lineNum">     114 </span>            :     { 0x338, '/' },             /* long solidus overstrike */   /* 0x338 */
<span class="lineNum">     115 </span>            :     { 0 },
<span class="lineNum">     116 </span>            :     { 0 },
<span class="lineNum">     117 </span>            :     { 0 },
<span class="lineNum">     118 </span>            :     { 0 },
<span class="lineNum">     119 </span>            :     { 0 },
<span class="lineNum">     120 </span>            :     { 0 },
<span class="lineNum">     121 </span>            :     { 0 },
<span class="lineNum">     122 </span>            :     { 0x340, 0x60, 0x2cb },     /* tone mark, left of circumflex */ /* 0x340 */
<span class="lineNum">     123 </span>            :     { 0x341, 0xb4, 0x2ca },     /* tone mark, right of circumflex */
<span class="lineNum">     124 </span>            :     { 0x342, 0x2dc, 0x7e },     /* perispomeni (tilde) */
<span class="lineNum">     125 </span>            :     { 0x343, 0x2bc, ',' },      /* koronis */
<span class="lineNum">     126 </span>            :     { 0 },                      /* dialytika tonos (two accents) */
<span class="lineNum">     127 </span>            :     { 0x37a },                  /* ypogegrammeni */
<span class="lineNum">     128 </span>            :     { 0xffff }
<span class="lineNum">     129 </span>            : };
<span class="lineNum">     130 </span>            : 
<a name="131"><span class="lineNum">     131 </span>            : static int SCMakeDotless(SplineFont *sf, SplineChar *dotless, int layer, BDFFont *bdf, int disp_only, int doit);</a>
<span class="lineNum">     132 </span>            : 
<span class="lineNum">     133 </span><span class="lineNoCov">          0 : int CanonicalCombiner(int uni) {</span>
<span class="lineNum">     134 </span>            :     /* Translate spacing accents to combiners */
<span class="lineNum">     135 </span>            :     int j,k;
<span class="lineNum">     136 </span>            : 
<span class="lineNum">     137 </span>            :     /* The above table will use these occasionally, but we don't want to */
<span class="lineNum">     138 </span>            :     /*  translate them. They aren't accents */
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :     if ( uni==',' || uni=='\'' || uni=='&quot;' || uni=='~' || uni=='^' || uni=='-' ||</span>
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :             uni=='+' || uni=='.' )</span>
<span class="lineNum">     141 </span><span class="lineNoCov">          0 : return( uni );</span>
<span class="lineNum">     142 </span>            : 
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :     for ( j=0; accents[j][0]!=0xffff; ++j ) {</span>
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :         for ( k=0; k&lt;4 &amp;&amp; accents[j][k]!=0; ++k ) {</span>
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :             if ( uni==accents[j][k] ) {</span>
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :                 uni = 0x300+j;</span>
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     148 </span>            :             }
<span class="lineNum">     149 </span>            :         }
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :         if ( uni&gt;=0x300 &amp;&amp; uni&lt;0x370 )</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     152 </span>            :     }
<span class="lineNum">     153 </span><span class="lineNoCov">          0 : return( uni );</span>
<span class="lineNum">     154 </span>            : }
<span class="lineNum">     155 </span>            : 
<span class="lineNum">     156 </span>            : static const char *uc_accent_names[] = {
<span class="lineNum">     157 </span>            :     &quot;Grave&quot;,
<span class="lineNum">     158 </span>            :     &quot;Acute&quot;,
<span class="lineNum">     159 </span>            :     &quot;Circumflex&quot;,
<span class="lineNum">     160 </span>            :     &quot;Tilde&quot;,
<span class="lineNum">     161 </span>            :     &quot;Macron&quot;,
<span class="lineNum">     162 </span>            :     &quot;Overline&quot;,
<span class="lineNum">     163 </span>            :     &quot;Breve&quot;,
<span class="lineNum">     164 </span>            :     &quot;Dotaccent&quot;,
<span class="lineNum">     165 </span>            :     &quot;Diaeresis&quot;,
<span class="lineNum">     166 </span>            :     NULL,
<span class="lineNum">     167 </span>            :     &quot;Ring&quot;,
<span class="lineNum">     168 </span>            :     &quot;Acute&quot;,
<span class="lineNum">     169 </span>            :     &quot;Caron&quot;
<span class="lineNum">     170 </span>            : };
<span class="lineNum">     171 </span>            : 
<span class="lineNum">     172 </span>            : /* greek accents */
<span class="lineNum">     173 </span>            : /* because of accent unification I can't use the same glyphs for greek and */
<span class="lineNum">     174 </span>            : /*  latin accents. Annoying. So when unicode decomposes a greek letter to */
<span class="lineNum">     175 </span>            : /*  use 0x0301 we actually want 0x1ffd and so on */
<span class="lineNum">     176 </span>            : static unichar_t unicode_greekalts[256][3] = {
<span class="lineNum">     177 </span>            : /* 1F00 */ { 0x03B1, 0x1FBF, 0 },
<span class="lineNum">     178 </span>            : /* 1F01 */ { 0x03B1, 0x1FFE, 0 },
<span class="lineNum">     179 </span>            : /* 1F02 */ { 0x03B1, 0x1FCD, 0 },
<span class="lineNum">     180 </span>            : /* 1F03 */ { 0x03B1, 0x1FDD, 0 },
<span class="lineNum">     181 </span>            : /* 1F04 */ { 0x03B1, 0x1FCE, 0 },
<span class="lineNum">     182 </span>            : /* 1F05 */ { 0x03B1, 0x1FDE, 0 },
<span class="lineNum">     183 </span>            : /* 1F06 */ { 0x03B1, 0x1FCF, 0 },
<span class="lineNum">     184 </span>            : /* 1F07 */ { 0x03B1, 0x1FDF, 0 },
<span class="lineNum">     185 </span>            : /* 1F08 */ { 0x0391, 0x1FBF, 0 },
<span class="lineNum">     186 </span>            : /* 1F09 */ { 0x0391, 0x1FFE, 0 },
<span class="lineNum">     187 </span>            : /* 1F0A */ { 0x0391, 0x1FCD, 0 },
<span class="lineNum">     188 </span>            : /* 1F0B */ { 0x0391, 0x1FDD, 0 },
<span class="lineNum">     189 </span>            : /* 1F0C */ { 0x0391, 0x1FCE, 0 },
<span class="lineNum">     190 </span>            : /* 1F0D */ { 0x0391, 0x1FDE, 0 },
<span class="lineNum">     191 </span>            : /* 1F0E */ { 0x0391, 0x1FCF, 0 },
<span class="lineNum">     192 </span>            : /* 1F0F */ { 0x0391, 0x1FDF, 0 },
<span class="lineNum">     193 </span>            : /* 1F10 */ { 0x03B5, 0x1FBF, 0 },
<span class="lineNum">     194 </span>            : /* 1F11 */ { 0x03B5, 0x1FFE, 0 },
<span class="lineNum">     195 </span>            : /* 1F12 */ { 0x03B5, 0x1FCD, 0 },
<span class="lineNum">     196 </span>            : /* 1F13 */ { 0x03B5, 0x1FDD, 0 },
<span class="lineNum">     197 </span>            : /* 1F14 */ { 0x03B5, 0x1FCE, 0 },
<span class="lineNum">     198 </span>            : /* 1F15 */ { 0x03B5, 0x1FDE, 0 },
<span class="lineNum">     199 </span>            : /* 1F16 */ { 0 },
<span class="lineNum">     200 </span>            : /* 1F17 */ { 0 },
<span class="lineNum">     201 </span>            : /* 1F18 */ { 0x0395, 0x1FBF, 0 },
<span class="lineNum">     202 </span>            : /* 1F19 */ { 0x0395, 0x1FFE, 0 },
<span class="lineNum">     203 </span>            : /* 1F1A */ { 0x0395, 0x1FCD, 0 },
<span class="lineNum">     204 </span>            : /* 1F1B */ { 0x0395, 0x1FDD, 0 },
<span class="lineNum">     205 </span>            : /* 1F1C */ { 0x0395, 0x1FCE, 0 },
<span class="lineNum">     206 </span>            : /* 1F1D */ { 0x0395, 0x1FDE, 0 },
<span class="lineNum">     207 </span>            : /* 1F1E */ { 0 },
<span class="lineNum">     208 </span>            : /* 1F1F */ { 0 },
<span class="lineNum">     209 </span>            : /* 1F20 */ { 0x03B7, 0x1FBF, 0 },
<span class="lineNum">     210 </span>            : /* 1F21 */ { 0x03B7, 0x1FFE, 0 },
<span class="lineNum">     211 </span>            : /* 1F22 */ { 0x03B7, 0x1FCD, 0 },
<span class="lineNum">     212 </span>            : /* 1F23 */ { 0x03B7, 0x1FDD, 0 },
<span class="lineNum">     213 </span>            : /* 1F24 */ { 0x03B7, 0x1FCE, 0 },
<span class="lineNum">     214 </span>            : /* 1F25 */ { 0x03B7, 0x1FDE, 0 },
<span class="lineNum">     215 </span>            : /* 1F26 */ { 0x03B7, 0x1FCF, 0 },
<span class="lineNum">     216 </span>            : /* 1F27 */ { 0x03B7, 0x1FDF, 0 },
<span class="lineNum">     217 </span>            : /* 1F28 */ { 0x0397, 0x1FBF, 0 },
<span class="lineNum">     218 </span>            : /* 1F29 */ { 0x0397, 0x1FFE, 0 },
<span class="lineNum">     219 </span>            : /* 1F2A */ { 0x0397, 0x1FCD, 0 },
<span class="lineNum">     220 </span>            : /* 1F2B */ { 0x0397, 0x1FDD, 0 },
<span class="lineNum">     221 </span>            : /* 1F2C */ { 0x0397, 0x1FCE, 0 },
<span class="lineNum">     222 </span>            : /* 1F2D */ { 0x0397, 0x1FDE, 0 },
<span class="lineNum">     223 </span>            : /* 1F2E */ { 0x0397, 0x1FCF, 0 },
<span class="lineNum">     224 </span>            : /* 1F2F */ { 0x0397, 0x1FDF, 0 },
<span class="lineNum">     225 </span>            : /* 1F30 */ { 0x03B9, 0x1FBF, 0 },
<span class="lineNum">     226 </span>            : /* 1F31 */ { 0x03B9, 0x1FFE, 0 },
<span class="lineNum">     227 </span>            : /* 1F32 */ { 0x03B9, 0x1FCD, 0 },
<span class="lineNum">     228 </span>            : /* 1F33 */ { 0x03B9, 0x1FDD, 0 },
<span class="lineNum">     229 </span>            : /* 1F34 */ { 0x03B9, 0x1FCE, 0 },
<span class="lineNum">     230 </span>            : /* 1F35 */ { 0x03B9, 0x1FDE, 0 },
<span class="lineNum">     231 </span>            : /* 1F36 */ { 0x03B9, 0x1FCF, 0 },
<span class="lineNum">     232 </span>            : /* 1F37 */ { 0x03B9, 0x1FDF, 0 },
<span class="lineNum">     233 </span>            : /* 1F38 */ { 0x0399, 0x1FBF, 0 },
<span class="lineNum">     234 </span>            : /* 1F39 */ { 0x0399, 0x1FFE, 0 },
<span class="lineNum">     235 </span>            : /* 1F3A */ { 0x0399, 0x1FCD, 0 },
<span class="lineNum">     236 </span>            : /* 1F3B */ { 0x0399, 0x1FDD, 0 },
<span class="lineNum">     237 </span>            : /* 1F3C */ { 0x0399, 0x1FCE, 0 },
<span class="lineNum">     238 </span>            : /* 1F3D */ { 0x0399, 0x1FDE, 0 },
<span class="lineNum">     239 </span>            : /* 1F3E */ { 0x0399, 0x1FCF, 0 },
<span class="lineNum">     240 </span>            : /* 1F3F */ { 0x0399, 0x1FDF, 0 },
<span class="lineNum">     241 </span>            : /* 1F40 */ { 0x03BF, 0x1FBF, 0 },
<span class="lineNum">     242 </span>            : /* 1F41 */ { 0x03BF, 0x1FFE, 0 },
<span class="lineNum">     243 </span>            : /* 1F42 */ { 0x03BF, 0x1FCD, 0 },
<span class="lineNum">     244 </span>            : /* 1F43 */ { 0x03BF, 0x1FDD, 0 },
<span class="lineNum">     245 </span>            : /* 1F44 */ { 0x03BF, 0x1FCE, 0 },
<span class="lineNum">     246 </span>            : /* 1F45 */ { 0x03BF, 0x1FDE, 0 },
<span class="lineNum">     247 </span>            : /* 1F46 */ { 0 },
<span class="lineNum">     248 </span>            : /* 1F47 */ { 0 },
<span class="lineNum">     249 </span>            : /* 1F48 */ { 0x039F, 0x1FBF, 0 },
<span class="lineNum">     250 </span>            : /* 1F49 */ { 0x039F, 0x1FFE, 0 },
<span class="lineNum">     251 </span>            : /* 1F4A */ { 0x039F, 0x1FCD, 0 },
<span class="lineNum">     252 </span>            : /* 1F4B */ { 0x039F, 0x1FDD, 0 },
<span class="lineNum">     253 </span>            : /* 1F4C */ { 0x039F, 0x1FCE, 0 },
<span class="lineNum">     254 </span>            : /* 1F4D */ { 0x039F, 0x1FDE, 0 },
<span class="lineNum">     255 </span>            : /* 1F4E */ { 0 },
<span class="lineNum">     256 </span>            : /* 1F4F */ { 0 },
<span class="lineNum">     257 </span>            : /* 1F50 */ { 0x03C5, 0x1FBF, 0 },
<span class="lineNum">     258 </span>            : /* 1F51 */ { 0x03C5, 0x1FFE, 0 },
<span class="lineNum">     259 </span>            : /* 1F52 */ { 0x03C5, 0x1FCD, 0 },
<span class="lineNum">     260 </span>            : /* 1F53 */ { 0x03C5, 0x1FDD, 0 },
<span class="lineNum">     261 </span>            : /* 1F54 */ { 0x03C5, 0x1FCE, 0 },
<span class="lineNum">     262 </span>            : /* 1F55 */ { 0x03C5, 0x1FDE, 0 },
<span class="lineNum">     263 </span>            : /* 1F56 */ { 0x03C5, 0x1FCF, 0 },
<span class="lineNum">     264 </span>            : /* 1F57 */ { 0x03C5, 0x1FDF, 0 },
<span class="lineNum">     265 </span>            : /* 1F58 */ { 0 },
<span class="lineNum">     266 </span>            : /* 1F59 */ { 0x03a5, 0x1FFE, 0 },
<span class="lineNum">     267 </span>            : /* 1F5A */ { 0 },
<span class="lineNum">     268 </span>            : /* 1F5B */ { 0x03a5, 0x1FDD, 0 },
<span class="lineNum">     269 </span>            : /* 1F5C */ { 0 },
<span class="lineNum">     270 </span>            : /* 1F5D */ { 0x03a5, 0x1FDE, 0 },
<span class="lineNum">     271 </span>            : /* 1F5E */ { 0 },
<span class="lineNum">     272 </span>            : /* 1F5F */ { 0x03a5, 0x1FDF, 0 },
<span class="lineNum">     273 </span>            : /* 1F60 */ { 0x03C9, 0x1FBF, 0 },
<span class="lineNum">     274 </span>            : /* 1F61 */ { 0x03C9, 0x1FFE, 0 },
<span class="lineNum">     275 </span>            : /* 1F62 */ { 0x03C9, 0x1FCD, 0 },
<span class="lineNum">     276 </span>            : /* 1F63 */ { 0x03C9, 0x1FDD, 0 },
<span class="lineNum">     277 </span>            : /* 1F64 */ { 0x03C9, 0x1FCE, 0 },
<span class="lineNum">     278 </span>            : /* 1F65 */ { 0x03C9, 0x1FDE, 0 },
<span class="lineNum">     279 </span>            : /* 1F66 */ { 0x03C9, 0x1FCF, 0 },
<span class="lineNum">     280 </span>            : /* 1F67 */ { 0x03C9, 0x1FDF, 0 },
<span class="lineNum">     281 </span>            : /* 1F68 */ { 0x03A9, 0x1FBF, 0 },
<span class="lineNum">     282 </span>            : /* 1F69 */ { 0x03A9, 0x1FFE, 0 },
<span class="lineNum">     283 </span>            : /* 1F6A */ { 0x03A9, 0x1FCD, 0 },
<span class="lineNum">     284 </span>            : /* 1F6B */ { 0x03A9, 0x1FDD, 0 },
<span class="lineNum">     285 </span>            : /* 1F6C */ { 0x03A9, 0x1FCE, 0 },
<span class="lineNum">     286 </span>            : /* 1F6D */ { 0x03A9, 0x1FDE, 0 },
<span class="lineNum">     287 </span>            : /* 1F6E */ { 0x03A9, 0x1FCF, 0 },
<span class="lineNum">     288 </span>            : /* 1F6F */ { 0x03A9, 0x1FDF, 0 },
<span class="lineNum">     289 </span>            : /* 1F70 */ { 0x03B1, 0x1FEF, 0 },
<span class="lineNum">     290 </span>            : /* 1F71 */ { 0x03B1, 0x1FFD, 0 },
<span class="lineNum">     291 </span>            : /* 1F72 */ { 0x03B5, 0x1FEF, 0 },
<span class="lineNum">     292 </span>            : /* 1F73 */ { 0x03B5, 0x1FFD, 0 },
<span class="lineNum">     293 </span>            : /* 1F74 */ { 0x03B7, 0x1FEF, 0 },
<span class="lineNum">     294 </span>            : /* 1F75 */ { 0x03B7, 0x1FFD, 0 },
<span class="lineNum">     295 </span>            : /* 1F76 */ { 0x03B9, 0x1FEF, 0 },
<span class="lineNum">     296 </span>            : /* 1F77 */ { 0x03B9, 0x1FFD, 0 },
<span class="lineNum">     297 </span>            : /* 1F78 */ { 0x03BF, 0x1FEF, 0 },
<span class="lineNum">     298 </span>            : /* 1F79 */ { 0x03BF, 0x1FFD, 0 },
<span class="lineNum">     299 </span>            : /* 1F7A */ { 0x03C5, 0x1FEF, 0 },
<span class="lineNum">     300 </span>            : /* 1F7B */ { 0x03C5, 0x1FFD, 0 },
<span class="lineNum">     301 </span>            : /* 1F7C */ { 0x03C9, 0x1FEF, 0 },
<span class="lineNum">     302 </span>            : /* 1F7D */ { 0x03C9, 0x1FFD, 0 },
<span class="lineNum">     303 </span>            : /* 1F7E */ { 0 },
<span class="lineNum">     304 </span>            : /* 1F7F */ { 0 },
<span class="lineNum">     305 </span>            : /* 1F80 */ { 0x1F00, 0x0345, 0 },
<span class="lineNum">     306 </span>            : /* 1F81 */ { 0x1F01, 0x0345, 0 },
<span class="lineNum">     307 </span>            : /* 1F82 */ { 0x1F02, 0x0345, 0 },
<span class="lineNum">     308 </span>            : /* 1F83 */ { 0x1F03, 0x0345, 0 },
<span class="lineNum">     309 </span>            : /* 1F84 */ { 0x1F04, 0x0345, 0 },
<span class="lineNum">     310 </span>            : /* 1F85 */ { 0x1F05, 0x0345, 0 },
<span class="lineNum">     311 </span>            : /* 1F86 */ { 0x1F06, 0x0345, 0 },
<span class="lineNum">     312 </span>            : /* 1F87 */ { 0x1F07, 0x0345, 0 },
<span class="lineNum">     313 </span>            : /* 1F88 */ { 0x1F08, 0x1FBE, 0 },
<span class="lineNum">     314 </span>            : /* 1F89 */ { 0x1F09, 0x1FBE, 0 },
<span class="lineNum">     315 </span>            : /* 1F8A */ { 0x1F0A, 0x1FBE, 0 },
<span class="lineNum">     316 </span>            : /* 1F8B */ { 0x1F0B, 0x1FBE, 0 },
<span class="lineNum">     317 </span>            : /* 1F8C */ { 0x1F0C, 0x1FBE, 0 },
<span class="lineNum">     318 </span>            : /* 1F8D */ { 0x1F0D, 0x1FBE, 0 },
<span class="lineNum">     319 </span>            : /* 1F8E */ { 0x1F0E, 0x1FBE, 0 },
<span class="lineNum">     320 </span>            : /* 1F8F */ { 0x1F0F, 0x1FBE, 0 },
<span class="lineNum">     321 </span>            : /* 1F90 */ { 0x1F20, 0x0345, 0 },
<span class="lineNum">     322 </span>            : /* 1F91 */ { 0x1F21, 0x0345, 0 },
<span class="lineNum">     323 </span>            : /* 1F92 */ { 0x1F22, 0x0345, 0 },
<span class="lineNum">     324 </span>            : /* 1F93 */ { 0x1F23, 0x0345, 0 },
<span class="lineNum">     325 </span>            : /* 1F94 */ { 0x1F24, 0x0345, 0 },
<span class="lineNum">     326 </span>            : /* 1F95 */ { 0x1F25, 0x0345, 0 },
<span class="lineNum">     327 </span>            : /* 1F96 */ { 0x1F26, 0x0345, 0 },
<span class="lineNum">     328 </span>            : /* 1F97 */ { 0x1F27, 0x0345, 0 },
<span class="lineNum">     329 </span>            : /* 1F98 */ { 0x1F28, 0x1FBE, 0 },
<span class="lineNum">     330 </span>            : /* 1F99 */ { 0x1F29, 0x1FBE, 0 },
<span class="lineNum">     331 </span>            : /* 1F9A */ { 0x1F2A, 0x1FBE, 0 },
<span class="lineNum">     332 </span>            : /* 1F9B */ { 0x1F2B, 0x1FBE, 0 },
<span class="lineNum">     333 </span>            : /* 1F9C */ { 0x1F2C, 0x1FBE, 0 },
<span class="lineNum">     334 </span>            : /* 1F9D */ { 0x1F2D, 0x1FBE, 0 },
<span class="lineNum">     335 </span>            : /* 1F9E */ { 0x1F2E, 0x1FBE, 0 },
<span class="lineNum">     336 </span>            : /* 1F9F */ { 0x1F2F, 0x1FBE, 0 },
<span class="lineNum">     337 </span>            : /* 1FA0 */ { 0x1F60, 0x0345, 0 },
<span class="lineNum">     338 </span>            : /* 1FA1 */ { 0x1F61, 0x0345, 0 },
<span class="lineNum">     339 </span>            : /* 1FA2 */ { 0x1F62, 0x0345, 0 },
<span class="lineNum">     340 </span>            : /* 1FA3 */ { 0x1F63, 0x0345, 0 },
<span class="lineNum">     341 </span>            : /* 1FA4 */ { 0x1F64, 0x0345, 0 },
<span class="lineNum">     342 </span>            : /* 1FA5 */ { 0x1F65, 0x0345, 0 },
<span class="lineNum">     343 </span>            : /* 1FA6 */ { 0x1F66, 0x0345, 0 },
<span class="lineNum">     344 </span>            : /* 1FA7 */ { 0x1F67, 0x0345, 0 },
<span class="lineNum">     345 </span>            : /* 1FA8 */ { 0x1F68, 0x1FBE, 0 },
<span class="lineNum">     346 </span>            : /* 1FA9 */ { 0x1F69, 0x1FBE, 0 },
<span class="lineNum">     347 </span>            : /* 1FAA */ { 0x1F6A, 0x1FBE, 0 },
<span class="lineNum">     348 </span>            : /* 1FAB */ { 0x1F6B, 0x1FBE, 0 },
<span class="lineNum">     349 </span>            : /* 1FAC */ { 0x1F6C, 0x1FBE, 0 },
<span class="lineNum">     350 </span>            : /* 1FAD */ { 0x1F6D, 0x1FBE, 0 },
<span class="lineNum">     351 </span>            : /* 1FAE */ { 0x1F6E, 0x1FBE, 0 },
<span class="lineNum">     352 </span>            : /* 1FAF */ { 0x1F6F, 0x1FBE, 0 },
<span class="lineNum">     353 </span>            : /* 1FB0 */ { 0x03B1, 0x0306, 0 },
<span class="lineNum">     354 </span>            : /* 1FB1 */ { 0x03B1, 0x0304, 0 },
<span class="lineNum">     355 </span>            : /* 1FB2 */ { 0x1F70, 0x0345, 0 },
<span class="lineNum">     356 </span>            : /* 1FB3 */ { 0x03B1, 0x0345, 0 },
<span class="lineNum">     357 </span>            : /* 1FB4 */ { 0x1f71, 0x0345, 0 },
<span class="lineNum">     358 </span>            : /* 1FB5 */ { 0 },
<span class="lineNum">     359 </span>            : /* 1FB6 */ { 0x03B1, 0x1FC0, 0 },
<span class="lineNum">     360 </span>            : /* 1FB7 */ { 0x1FB6, 0x0345, 0 },
<span class="lineNum">     361 </span>            : /* 1FB8 */ { 0x0391, 0x0306, 0 },
<span class="lineNum">     362 </span>            : /* 1FB9 */ { 0x0391, 0x0304, 0 },
<span class="lineNum">     363 </span>            : /* 1FBA */ { 0x0391, 0x1FEF, 0 },
<span class="lineNum">     364 </span>            : /* 1FBB */ { 0x0391, 0x1FFD, 0 },
<span class="lineNum">     365 </span>            : /* 1FBC */ { 0x0391, 0x1FBE, 0 },
<span class="lineNum">     366 </span>            : /* 1FBD */ { 0x0020, 0x0313, 0 },
<span class="lineNum">     367 </span>            : /* 1FBE */ { 0x0020, 0x0345, 0 },
<span class="lineNum">     368 </span>            : /* 1FBF */ { 0x0020, 0x0313, 0 },
<span class="lineNum">     369 </span>            : /* 1FC0 */ { 0x0020, 0x0342, 0 },
<span class="lineNum">     370 </span>            : /* 1FC1 */ { 0x00A8, 0x1FC0, 0 },
<span class="lineNum">     371 </span>            : /* 1FC2 */ { 0x1F74, 0x0345, 0 },
<span class="lineNum">     372 </span>            : /* 1FC3 */ { 0x03B7, 0x0345, 0 },
<span class="lineNum">     373 </span>            : /* 1FC4 */ { 0x1f75, 0x0345, 0 },
<span class="lineNum">     374 </span>            : /* 1FC5 */ { 0 },
<span class="lineNum">     375 </span>            : /* 1FC6 */ { 0x03B7, 0x1FC0, 0 },
<span class="lineNum">     376 </span>            : /* 1FC7 */ { 0x1FC6, 0x0345, 0 },
<span class="lineNum">     377 </span>            : /* 1FC8 */ { 0x0395, 0x1FEF, 0 },
<span class="lineNum">     378 </span>            : /* 1FC9 */ { 0x0395, 0x1FFD, 0 },
<span class="lineNum">     379 </span>            : /* 1FCA */ { 0x0397, 0x1FEF, 0 },
<span class="lineNum">     380 </span>            : /* 1FCB */ { 0x0397, 0x1FFD, 0 },
<span class="lineNum">     381 </span>            : /* 1FCC */ { 0x0397, 0x1FBE, 0 },
<span class="lineNum">     382 </span>            : /* 1FCD */ { 0x1FBF, 0x1FEF, 0 },
<span class="lineNum">     383 </span>            : /* 1FCE */ { 0x1FBF, 0x1FFD, 0 },
<span class="lineNum">     384 </span>            : /* 1FCF */ { 0x1FBF, 0x1FC0, 0 },
<span class="lineNum">     385 </span>            : /* 1FD0 */ { 0x03B9, 0x0306, 0 },
<span class="lineNum">     386 </span>            : /* 1FD1 */ { 0x03B9, 0x0304, 0 },
<span class="lineNum">     387 </span>            : /* 1FD2 */ { 0x03B9, 0x1FED, 0 },
<span class="lineNum">     388 </span>            : /* 1FD3 */ { 0x03B9, 0x1FEE, 0 },
<span class="lineNum">     389 </span>            : /* 1FD4 */ { 0 },
<span class="lineNum">     390 </span>            : /* 1FD5 */ { 0 },
<span class="lineNum">     391 </span>            : /* 1FD6 */ { 0x03B9, 0x1FC0, 0 },
<span class="lineNum">     392 </span>            : /* 1FD7 */ { 0x03B9, 0x1FC1, 0 },
<span class="lineNum">     393 </span>            : /* 1FD8 */ { 0x0399, 0x0306, 0 },
<span class="lineNum">     394 </span>            : /* 1FD9 */ { 0x0399, 0x0304, 0 },
<span class="lineNum">     395 </span>            : /* 1FDA */ { 0x0399, 0x1FEF, 0 },
<span class="lineNum">     396 </span>            : /* 1FDB */ { 0x0399, 0x1FFD, 0 },
<span class="lineNum">     397 </span>            : /* 1FDC */ { 0 },
<span class="lineNum">     398 </span>            : /* 1FDD */ { 0x1FFE, 0x1FEF, 0 },
<span class="lineNum">     399 </span>            : /* 1FDE */ { 0x1FFE, 0x1FFD, 0 },
<span class="lineNum">     400 </span>            : /* 1FDF */ { 0x1FFE, 0x1FC0, 0 },
<span class="lineNum">     401 </span>            : /* 1FE0 */ { 0x03C5, 0x0306, 0 },
<span class="lineNum">     402 </span>            : /* 1FE1 */ { 0x03C5, 0x0304, 0 },
<span class="lineNum">     403 </span>            : /* 1FE2 */ { 0x03C5, 0x1FED, 0 },
<span class="lineNum">     404 </span>            : /* 1FE3 */ { 0x03C5, 0x1FEE, 0 },
<span class="lineNum">     405 </span>            : /* 1FE4 */ { 0x03C1, 0x1FBF, 0 },
<span class="lineNum">     406 </span>            : /* 1FE5 */ { 0x03C1, 0x1FFE, 0 },
<span class="lineNum">     407 </span>            : /* 1FE6 */ { 0x03C5, 0x1FC0, 0 },
<span class="lineNum">     408 </span>            : /* 1FE7 */ { 0x03C5, 0x1FC1, 0 },
<span class="lineNum">     409 </span>            : /* 1FE8 */ { 0x03A5, 0x0306, 0 },
<span class="lineNum">     410 </span>            : /* 1FE9 */ { 0x03A5, 0x0304, 0 },
<span class="lineNum">     411 </span>            : /* 1FEA */ { 0x03A5, 0x1FEF, 0 },
<span class="lineNum">     412 </span>            : /* 1FEB */ { 0x03A5, 0x1FFD, 0 },
<span class="lineNum">     413 </span>            : /* 1FEC */ { 0x03A1, 0x1FFE, 0 },
<span class="lineNum">     414 </span>            : /* 1FED */ { 0x00A8, 0x1FEF, 0 },
<span class="lineNum">     415 </span>            : /* 1FEE */ { 0x0385, 0 },
<span class="lineNum">     416 </span>            : /* 1FEF */ { 0x0060, 0 },
<span class="lineNum">     417 </span>            : /* 1FF0 */ { 0 },
<span class="lineNum">     418 </span>            : /* 1FF1 */ { 0 },
<span class="lineNum">     419 </span>            : /* 1FF2 */ { 0x1F7C, 0x0345, 0 },
<span class="lineNum">     420 </span>            : /* 1FF3 */ { 0x03C9, 0x0345, 0 },
<span class="lineNum">     421 </span>            : /* 1FF4 */ { 0x03CE, 0x0345, 0 },
<span class="lineNum">     422 </span>            : /* 1FF5 */ { 0 },
<span class="lineNum">     423 </span>            : /* 1FF6 */ { 0x03C9, 0x1FC0, 0 },
<span class="lineNum">     424 </span>            : /* 1FF7 */ { 0x1FF6, 0x0345, 0 },
<span class="lineNum">     425 </span>            : /* 1FF8 */ { 0x039F, 0x1FEF, 0 },
<span class="lineNum">     426 </span>            : /* 1FF9 */ { 0x039F, 0x1FFD, 0 },
<span class="lineNum">     427 </span>            : /* 1FFA */ { 0x03A9, 0x1FEF, 0 },
<span class="lineNum">     428 </span>            : /* 1FFB */ { 0x03A9, 0x1FFD, 0 },
<span class="lineNum">     429 </span>            : /* 1FFC */ { 0x03A9, 0x1FBE, 0 },
<span class="lineNum">     430 </span>            : /* 1FFD */ { 0x00B4, 0 },
<span class="lineNum">     431 </span>            : /* 1FFE */ { 0x0020, 0x0314, 0 },
<span class="lineNum">     432 </span>            : /* 1FFF */ { 0 },
<span class="lineNum">     433 </span>            : };
<span class="lineNum">     434 </span>            : 
<span class="lineNum">     435 </span>            : unichar_t adobes_pua_alts[0x200][3] = { /* Mapped from 0xf600-0xf7ff */
<span class="lineNum">     436 </span>            : /* U+F600 */ { 0 },
<span class="lineNum">     437 </span>            : /* U+F601 */ { 0 },
<span class="lineNum">     438 </span>            : /* U+F602 */ { 0 },
<span class="lineNum">     439 </span>            : /* U+F603 */ { 0 },
<span class="lineNum">     440 </span>            : /* U+F604 */ { 0 },
<span class="lineNum">     441 </span>            : /* U+F605 */ { 0 },
<span class="lineNum">     442 </span>            : /* U+F606 */ { 0 },
<span class="lineNum">     443 </span>            : /* U+F607 */ { 0 },
<span class="lineNum">     444 </span>            : /* U+F608 */ { 0 },
<span class="lineNum">     445 </span>            : /* U+F609 */ { 0 },
<span class="lineNum">     446 </span>            : /* U+F60A */ { 0 },
<span class="lineNum">     447 </span>            : /* U+F60B */ { 0 },
<span class="lineNum">     448 </span>            : /* U+F60C */ { 0 },
<span class="lineNum">     449 </span>            : /* U+F60D */ { 0 },
<span class="lineNum">     450 </span>            : /* U+F60E */ { 0 },
<span class="lineNum">     451 </span>            : /* U+F60F */ { 0 },
<span class="lineNum">     452 </span>            : /* U+F610 */ { 0 },
<span class="lineNum">     453 </span>            : /* U+F611 */ { 0 },
<span class="lineNum">     454 </span>            : /* U+F612 */ { 0 },
<span class="lineNum">     455 </span>            : /* U+F613 */ { 0 },
<span class="lineNum">     456 </span>            : /* U+F614 */ { 0 },
<span class="lineNum">     457 </span>            : /* U+F615 */ { 0 },
<span class="lineNum">     458 </span>            : /* U+F616 */ { 0 },
<span class="lineNum">     459 </span>            : /* U+F617 */ { 0 },
<span class="lineNum">     460 </span>            : /* U+F618 */ { 0 },
<span class="lineNum">     461 </span>            : /* U+F619 */ { 0 },
<span class="lineNum">     462 </span>            : /* U+F61A */ { 0 },
<span class="lineNum">     463 </span>            : /* U+F61B */ { 0 },
<span class="lineNum">     464 </span>            : /* U+F61C */ { 0 },
<span class="lineNum">     465 </span>            : /* U+F61D */ { 0 },
<span class="lineNum">     466 </span>            : /* U+F61E */ { 0 },
<span class="lineNum">     467 </span>            : /* U+F61F */ { 0 },
<span class="lineNum">     468 </span>            : /* U+F620 */ { 0 },
<span class="lineNum">     469 </span>            : /* U+F621 */ { 0 },
<span class="lineNum">     470 </span>            : /* U+F622 */ { 0 },
<span class="lineNum">     471 </span>            : /* U+F623 */ { 0 },
<span class="lineNum">     472 </span>            : /* U+F624 */ { 0 },
<span class="lineNum">     473 </span>            : /* U+F625 */ { 0 },
<span class="lineNum">     474 </span>            : /* U+F626 */ { 0 },
<span class="lineNum">     475 </span>            : /* U+F627 */ { 0 },
<span class="lineNum">     476 </span>            : /* U+F628 */ { 0 },
<span class="lineNum">     477 </span>            : /* U+F629 */ { 0 },
<span class="lineNum">     478 </span>            : /* U+F62A */ { 0 },
<span class="lineNum">     479 </span>            : /* U+F62B */ { 0 },
<span class="lineNum">     480 </span>            : /* U+F62C */ { 0 },
<span class="lineNum">     481 </span>            : /* U+F62D */ { 0 },
<span class="lineNum">     482 </span>            : /* U+F62E */ { 0 },
<span class="lineNum">     483 </span>            : /* U+F62F */ { 0 },
<span class="lineNum">     484 </span>            : /* U+F630 */ { 0 },
<span class="lineNum">     485 </span>            : /* U+F631 */ { 0 },
<span class="lineNum">     486 </span>            : /* U+F632 */ { 0 },
<span class="lineNum">     487 </span>            : /* U+F633 */ { 0 },
<span class="lineNum">     488 </span>            : /* U+F634 */ { 0x0020, 0x0326, 0 },
<span class="lineNum">     489 </span>            : /* U+F635 */ { 0x0020, 0x0326, 0 },
<span class="lineNum">     490 </span>            : /* U+F636 */ { 0x03d6, 0x0000, 0 },
<span class="lineNum">     491 </span>            : /* U+F637 */ { 0x0068, 0x0000, 0 },
<span class="lineNum">     492 </span>            : /* U+F638 */ { 0x0030, 0x0000, 0 },
<span class="lineNum">     493 </span>            : /* U+F639 */ { 0x0030, 0x0000, 0 },
<span class="lineNum">     494 </span>            : /* U+F63A */ { 0x0032, 0x0000, 0 },
<span class="lineNum">     495 </span>            : /* U+F63B */ { 0x0033, 0x0000, 0 },
<span class="lineNum">     496 </span>            : /* U+F63C */ { 0x0034, 0x0000, 0 },
<span class="lineNum">     497 </span>            : /* U+F63D */ { 0x0035, 0x0000, 0 },
<span class="lineNum">     498 </span>            : /* U+F63E */ { 0x0036, 0x0000, 0 },
<span class="lineNum">     499 </span>            : /* U+F63F */ { 0x0037, 0x0000, 0 },
<span class="lineNum">     500 </span>            : /* U+F640 */ { 0x0038, 0x0000, 0 },
<span class="lineNum">     501 </span>            : /* U+F641 */ { 0x0039, 0x0000, 0 },
<span class="lineNum">     502 </span>            : /* U+F642 */ { 0x0025, 0x0000, 0 },
<span class="lineNum">     503 </span>            : /* U+F643 */ { 0x0030, 0x0000, 0 },
<span class="lineNum">     504 </span>            : /* U+F644 */ { 0x0031, 0x0000, 0 },
<span class="lineNum">     505 </span>            : /* U+F645 */ { 0x0032, 0x0000, 0 },
<span class="lineNum">     506 </span>            : /* U+F646 */ { 0x0033, 0x0000, 0 },
<span class="lineNum">     507 </span>            : /* U+F647 */ { 0x0034, 0x0000, 0 },
<span class="lineNum">     508 </span>            : /* U+F648 */ { 0x0035, 0x0000, 0 },
<span class="lineNum">     509 </span>            : /* U+F649 */ { 0x0036, 0x0000, 0 },
<span class="lineNum">     510 </span>            : /* U+F64A */ { 0x0037, 0x0000, 0 },
<span class="lineNum">     511 </span>            : /* U+F64B */ { 0x0038, 0x0000, 0 },
<span class="lineNum">     512 </span>            : /* U+F64C */ { 0x0039, 0x0000, 0 },
<span class="lineNum">     513 </span>            : /* U+F64D */ { 0x20a1, 0x0000, 0 },
<span class="lineNum">     514 </span>            : /* U+F64E */ { 0x20ac, 0x0000, 0 },
<span class="lineNum">     515 </span>            : /* U+F64F */ { 0x0192, 0x0000, 0 },
<span class="lineNum">     516 </span>            : /* U+F650 */ { 0x0023, 0x0000, 0 },
<span class="lineNum">     517 </span>            : /* U+F651 */ { 0x00a3, 0x0000, 0 },
<span class="lineNum">     518 </span>            : /* U+F652 */ { 0x00a5, 0x0000, 0 },
<span class="lineNum">     519 </span>            : /* U+F653 */ { 0x0024, 0x0000, 0 },
<span class="lineNum">     520 </span>            : /* U+F654 */ { 0x00a2, 0x0000, 0 },
<span class="lineNum">     521 </span>            : /* U+F655 */ { 0x0030, 0x0000, 0 },
<span class="lineNum">     522 </span>            : /* U+F656 */ { 0x0031, 0x0000, 0 },
<span class="lineNum">     523 </span>            : /* U+F657 */ { 0x0032, 0x0000, 0 },
<span class="lineNum">     524 </span>            : /* U+F658 */ { 0x0033, 0x0000, 0 },
<span class="lineNum">     525 </span>            : /* U+F659 */ { 0x0034, 0x0000, 0 },
<span class="lineNum">     526 </span>            : /* U+F65A */ { 0x0035, 0x0000, 0 },
<span class="lineNum">     527 </span>            : /* U+F65B */ { 0x0036, 0x0000, 0 },
<span class="lineNum">     528 </span>            : /* U+F65C */ { 0x0037, 0x0000, 0 },
<span class="lineNum">     529 </span>            : /* U+F65D */ { 0x0038, 0x0000, 0 },
<span class="lineNum">     530 </span>            : /* U+F65E */ { 0x0039, 0x0000, 0 },
<span class="lineNum">     531 </span>            : /* U+F65F */ { 0x002c, 0x0000, 0 },
<span class="lineNum">     532 </span>            : /* U+F660 */ { 0x002e, 0x0000, 0 },
<span class="lineNum">     533 </span>            : /* U+F661 */ { 0x0030, 0x0000, 0 },
<span class="lineNum">     534 </span>            : /* U+F662 */ { 0x0031, 0x0000, 0 },
<span class="lineNum">     535 </span>            : /* U+F663 */ { 0x0032, 0x0000, 0 },
<span class="lineNum">     536 </span>            : /* U+F664 */ { 0x0033, 0x0000, 0 },
<span class="lineNum">     537 </span>            : /* U+F665 */ { 0x0034, 0x0000, 0 },
<span class="lineNum">     538 </span>            : /* U+F666 */ { 0x0035, 0x0000, 0 },
<span class="lineNum">     539 </span>            : /* U+F667 */ { 0x0036, 0x0000, 0 },
<span class="lineNum">     540 </span>            : /* U+F668 */ { 0x0037, 0x0000, 0 },
<span class="lineNum">     541 </span>            : /* U+F669 */ { 0x0038, 0x0000, 0 },
<span class="lineNum">     542 </span>            : /* U+F66A */ { 0x0039, 0x0000, 0 },
<span class="lineNum">     543 </span>            : /* U+F66B */ { 0x002c, 0x0000, 0 },
<span class="lineNum">     544 </span>            : /* U+F66C */ { 0x002e, 0x0000, 0 },
<span class="lineNum">     545 </span>            : /* U+F66D */ { 0xf761, 0x0306, 0 },
<span class="lineNum">     546 </span>            : /* U+F66E */ { 0xf761, 0x0304, 0 },
<span class="lineNum">     547 </span>            : /* U+F66F */ { 0xf761, 0x0328, 0 },
<span class="lineNum">     548 </span>            : /* U+F670 */ { 0xf7e6, 0x0301, 0 },
<span class="lineNum">     549 </span>            : /* U+F671 */ { 0xf763, 0x0301, 0 },
<span class="lineNum">     550 </span>            : /* U+F672 */ { 0xf763, 0x030c, 0 },
<span class="lineNum">     551 </span>            : /* U+F673 */ { 0xf763, 0x0302, 0 },
<span class="lineNum">     552 </span>            : /* U+F674 */ { 0xf763, 0x0307, 0 },
<span class="lineNum">     553 </span>            : /* U+F675 */ { 0xf764, 0x030c, 0 },
<span class="lineNum">     554 </span>            : /* U+F676 */ { 0x0111, 0x0000, 0 },
<span class="lineNum">     555 </span>            : /* U+F677 */ { 0xf765, 0x0306, 0 },
<span class="lineNum">     556 </span>            : /* U+F678 */ { 0xf765, 0x030c, 0 },
<span class="lineNum">     557 </span>            : /* U+F679 */ { 0xf765, 0x0307, 0 },
<span class="lineNum">     558 </span>            : /* U+F67A */ { 0xf765, 0x0304, 0 },
<span class="lineNum">     559 </span>            : /* U+F67B */ { 0x014b, 0x0000, 0 },
<span class="lineNum">     560 </span>            : /* U+F67C */ { 0xf765, 0x0328, 0 },
<span class="lineNum">     561 </span>            : /* U+F67D */ { 0xf767, 0x0306, 0 },
<span class="lineNum">     562 </span>            : /* U+F67E */ { 0xf767, 0x0302, 0 },
<span class="lineNum">     563 </span>            : /* U+F67F */ { 0xf767, 0x0326, 0 },
<span class="lineNum">     564 </span>            : /* U+F680 */ { 0xf767, 0x0307, 0 },
<span class="lineNum">     565 </span>            : /* U+F681 */ { 0x0127, 0x0000, 0 },
<span class="lineNum">     566 </span>            : /* U+F682 */ { 0xf768, 0x0302, 0 },
<span class="lineNum">     567 </span>            : /* U+F683 */ { 0xf769, 0x0306, 0 },
<span class="lineNum">     568 </span>            : /* U+F684 */ { 0xf769, 0xf76a, 0 },
<span class="lineNum">     569 </span>            : /* U+F685 */ { 0xf769, 0x0304, 0 },
<span class="lineNum">     570 </span>            : /* U+F686 */ { 0xf769, 0x0328, 0 },
<span class="lineNum">     571 </span>            : /* U+F687 */ { 0xf769, 0x0303, 0 },
<span class="lineNum">     572 </span>            : /* U+F688 */ { 0xf76a, 0x0302, 0 },
<span class="lineNum">     573 </span>            : /* U+F689 */ { 0xf76b, 0x0326, 0 },
<span class="lineNum">     574 </span>            : /* U+F68A */ { 0xf76c, 0x0301, 0 },
<span class="lineNum">     575 </span>            : /* U+F68B */ { 0xf76c, 0x030c, 0 },
<span class="lineNum">     576 </span>            : /* U+F68C */ { 0xf76c, 0x0326, 0 },
<span class="lineNum">     577 </span>            : /* U+F68D */ { 0xf76c, 0x00b7, 0 },
<span class="lineNum">     578 </span>            : /* U+F68E */ { 0xf76e, 0x0301, 0 },
<span class="lineNum">     579 </span>            : /* U+F68F */ { 0xf76e, 0x030c, 0 },
<span class="lineNum">     580 </span>            : /* U+F690 */ { 0xf76e, 0x0326, 0 },
<span class="lineNum">     581 </span>            : /* U+F691 */ { 0xf76f, 0x0306, 0 },
<span class="lineNum">     582 </span>            : /* U+F692 */ { 0xf76f, 0x030b, 0 },
<span class="lineNum">     583 </span>            : /* U+F693 */ { 0xf76f, 0x0304, 0 },
<span class="lineNum">     584 </span>            : /* U+F694 */ { 0xf7f8, 0x0301, 0 },
<span class="lineNum">     585 </span>            : /* U+F695 */ { 0xf772, 0x0301, 0 },
<span class="lineNum">     586 </span>            : /* U+F696 */ { 0xf772, 0x030c, 0 },
<span class="lineNum">     587 </span>            : /* U+F697 */ { 0xf772, 0x0326, 0 },
<span class="lineNum">     588 </span>            : /* U+F698 */ { 0xf773, 0x0301, 0 },
<span class="lineNum">     589 </span>            : /* U+F699 */ { 0xf773, 0x0327, 0 },
<span class="lineNum">     590 </span>            : /* U+F69A */ { 0xf773, 0x0302, 0 },
<span class="lineNum">     591 </span>            : /* U+F69B */ { 0xf773, 0x0326, 0 },
<span class="lineNum">     592 </span>            : /* U+F69C */ { 0x0167, 0x0000, 0 },
<span class="lineNum">     593 </span>            : /* U+F69D */ { 0xf774, 0x030c, 0 },
<span class="lineNum">     594 </span>            : /* U+F69E */ { 0xf774, 0x0326, 0 },
<span class="lineNum">     595 </span>            : /* U+F69F */ { 0xf775, 0x0306, 0 },
<span class="lineNum">     596 </span>            : /* U+F6A0 */ { 0xf775, 0x030b, 0 },
<span class="lineNum">     597 </span>            : /* U+F6A1 */ { 0xf775, 0x0304, 0 },
<span class="lineNum">     598 </span>            : /* U+F6A2 */ { 0xf775, 0x0328, 0 },
<span class="lineNum">     599 </span>            : /* U+F6A3 */ { 0xf775, 0x030a, 0 },
<span class="lineNum">     600 </span>            : /* U+F6A4 */ { 0xf775, 0x0303, 0 },
<span class="lineNum">     601 </span>            : /* U+F6A5 */ { 0xf777, 0x0301, 0 },
<span class="lineNum">     602 </span>            : /* U+F6A6 */ { 0xf777, 0x0302, 0 },
<span class="lineNum">     603 </span>            : /* U+F6A7 */ { 0xf777, 0x0308, 0 },
<span class="lineNum">     604 </span>            : /* U+F6A8 */ { 0xf777, 0x0300, 0 },
<span class="lineNum">     605 </span>            : /* U+F6A9 */ { 0xf779, 0x0302, 0 },
<span class="lineNum">     606 </span>            : /* U+F6AA */ { 0xf779, 0x0300, 0 },
<span class="lineNum">     607 </span>            : /* U+F6AB */ { 0xf77a, 0x0301, 0 },
<span class="lineNum">     608 </span>            : /* U+F6AC */ { 0xf77a, 0x0307, 0 },
<span class="lineNum">     609 </span>            : /* U+F6AD */ { 0xf769, 0x0307, 0 },
<span class="lineNum">     610 </span>            : /* U+F6AE */ { 0x0028, 0x0000, 0 },
<span class="lineNum">     611 </span>            : /* U+F6AF */ { 0x0029, 0x0000, 0 },
<span class="lineNum">     612 </span>            : /* U+F6B0 */ { 0x005b, 0x0000, 0 },
<span class="lineNum">     613 </span>            : /* U+F6B1 */ { 0x005d, 0x0000, 0 },
<span class="lineNum">     614 </span>            : /* U+F6B2 */ { 0x007b, 0x0000, 0 },
<span class="lineNum">     615 </span>            : /* U+F6B3 */ { 0x007d, 0x0000, 0 },
<span class="lineNum">     616 </span>            : /* U+F6B4 */ { 0x00a1, 0x0000, 0 },
<span class="lineNum">     617 </span>            : /* U+F6B5 */ { 0x00bf, 0x0000, 0 },
<span class="lineNum">     618 </span>            : /* U+F6B6 */ { 0x00ab, 0x0000, 0 },
<span class="lineNum">     619 </span>            : /* U+F6B7 */ { 0x00bb, 0x0000, 0 },
<span class="lineNum">     620 </span>            : /* U+F6B8 */ { 0x2039, 0x0000, 0 },
<span class="lineNum">     621 </span>            : /* U+F6B9 */ { 0x203a, 0x0000, 0 },
<span class="lineNum">     622 </span>            : /* U+F6BA */ { 0x002d, 0x0000, 0 },
<span class="lineNum">     623 </span>            : /* U+F6BB */ { 0x2013, 0x0000, 0 },
<span class="lineNum">     624 </span>            : /* U+F6BC */ { 0x2014, 0x0000, 0 },
<span class="lineNum">     625 </span>            : /* U+F6BD */ { 0x00b7, 0x0000, 0 },
<span class="lineNum">     626 </span>            : /* U+F6BE */ { 0x006a, 0x0000, 0 },
<span class="lineNum">     627 </span>            : /* U+F6BF */ { 0x004c, 0x004c, 0 },
<span class="lineNum">     628 </span>            : /* U+F6C0 */ { 0x006c, 0x006c, 0 },
<span class="lineNum">     629 </span>            : /* U+F6C1 */ { 0x0053, 0x0327, 0 },
<span class="lineNum">     630 </span>            : /* U+F6C2 */ { 0x0073, 0x0327, 0 },
<span class="lineNum">     631 </span>            : /* U+F6C3 */ { 0x0313, 0x0326, 0 },
<span class="lineNum">     632 </span>            : /* U+F6C4 */ { 0x0433, 0x0000, 0 },
<span class="lineNum">     633 </span>            : /* U+F6C5 */ { 0x0431, 0x0000, 0 },
<span class="lineNum">     634 </span>            : /* U+F6C6 */ { 0x0434, 0x0000, 0 },
<span class="lineNum">     635 </span>            : /* U+F6C7 */ { 0x043f, 0x0000, 0 },
<span class="lineNum">     636 </span>            : /* U+F6C8 */ { 0x0442, 0x0000, 0 },
<span class="lineNum">     637 </span>            : /* U+F6C9 */ { 0x02ca, 0x0000, 0 },
<span class="lineNum">     638 </span>            : /* U+F6CA */ { 0x02c7, 0x0000, 0 },
<span class="lineNum">     639 </span>            : /* U+F6CB */ { 0x00a8, 0x0000, 0 },
<span class="lineNum">     640 </span>            : /* U+F6CC */ { 0x00a8, 0x02ca, 0 },
<span class="lineNum">     641 </span>            : /* U+F6CD */ { 0x00a8, 0x02cb, 0 },
<span class="lineNum">     642 </span>            : /* U+F6CE */ { 0x02cb, 0x0000, 0 },
<span class="lineNum">     643 </span>            : /* U+F6CF */ { 0x02dd, 0x0000, 0 },
<span class="lineNum">     644 </span>            : /* U+F6D0 */ { 0x02c9, 0x0000, 0 },
<span class="lineNum">     645 </span>            : /* U+F6D1 */ { 0x02d8, 0x0000, 0 },
<span class="lineNum">     646 </span>            : /* U+F6D2 */ { 0x02c6, 0x0000, 0 },
<span class="lineNum">     647 </span>            : /* U+F6D3 */ { 0x030f, 0x030f, 0 },
<span class="lineNum">     648 </span>            : /* U+F6D4 */ { 0x02d8, 0x0000, 0 },
<span class="lineNum">     649 </span>            : /* U+F6D5 */ { 0x02c6, 0x0000, 0 },
<span class="lineNum">     650 </span>            : /* U+F6D6 */ { 0x030f, 0x030f, 0 },
<span class="lineNum">     651 </span>            : /* U+F6D7 */ { 0x00a8, 0x02ca, 0 },
<span class="lineNum">     652 </span>            : /* U+F6D8 */ { 0x00a8, 0x02cb, 0 },
<span class="lineNum">     653 </span>            : /* U+F6D9 */ { 0x00a9, 0x0000, 0 },
<span class="lineNum">     654 </span>            : /* U+F6DA */ { 0x00ae, 0x0000, 0 },
<span class="lineNum">     655 </span>            : /* U+F6DB */ { 0x2122, 0x0000, 0 },
<span class="lineNum">     656 </span>            : /* U+F6DC */ { 0x0031, 0x0000, 0 },
<span class="lineNum">     657 </span>            : /* U+F6DD */ { 0x0052, 0x0070, 0 },
<span class="lineNum">     658 </span>            : /* U+F6DE */ { 0x002d, 0x0000, 0 },
<span class="lineNum">     659 </span>            : /* U+F6DF */ { 0x00a2, 0x0000, 0 },
<span class="lineNum">     660 </span>            : /* U+F6E0 */ { 0x00a2, 0x0000, 0 },
<span class="lineNum">     661 </span>            : /* U+F6E1 */ { 0x002c, 0x0000, 0 },
<span class="lineNum">     662 </span>            : /* U+F6E2 */ { 0x002c, 0x0000, 0 },
<span class="lineNum">     663 </span>            : /* U+F6E3 */ { 0x0024, 0x0000, 0 },
<span class="lineNum">     664 </span>            : /* U+F6E4 */ { 0x0024, 0x0000, 0 },
<span class="lineNum">     665 </span>            : /* U+F6E5 */ { 0x002d, 0x0000, 0 },
<span class="lineNum">     666 </span>            : /* U+F6E6 */ { 0x002d, 0x0000, 0 },
<span class="lineNum">     667 </span>            : /* U+F6E7 */ { 0x002e, 0x0000, 0 },
<span class="lineNum">     668 </span>            : /* U+F6E8 */ { 0x002e, 0x0000, 0 },
<span class="lineNum">     669 </span>            : /* U+F6E9 */ { 0x0061, 0x0000, 0 },
<span class="lineNum">     670 </span>            : /* U+F6EA */ { 0x0062, 0x0000, 0 },
<span class="lineNum">     671 </span>            : /* U+F6EB */ { 0x0064, 0x0000, 0 },
<span class="lineNum">     672 </span>            : /* U+F6EC */ { 0x0065, 0x0000, 0 },
<span class="lineNum">     673 </span>            : /* U+F6ED */ { 0x0069, 0x0000, 0 },
<span class="lineNum">     674 </span>            : /* U+F6EE */ { 0x006c, 0x0000, 0 },
<span class="lineNum">     675 </span>            : /* U+F6EF */ { 0x006d, 0x0000, 0 },
<span class="lineNum">     676 </span>            : /* U+F6F0 */ { 0x006f, 0x0000, 0 },
<span class="lineNum">     677 </span>            : /* U+F6F1 */ { 0x0072, 0x0000, 0 },
<span class="lineNum">     678 </span>            : /* U+F6F2 */ { 0x0073, 0x0000, 0 },
<span class="lineNum">     679 </span>            : /* U+F6F3 */ { 0x0074, 0x0000, 0 },
<span class="lineNum">     680 </span>            : /* U+F6F4 */ { 0x02d8, 0x0000, 0 },
<span class="lineNum">     681 </span>            : /* U+F6F5 */ { 0x02c7, 0x0000, 0 },
<span class="lineNum">     682 </span>            : /* U+F6F6 */ { 0x02c6, 0x0000, 0 },
<span class="lineNum">     683 </span>            : /* U+F6F7 */ { 0x02d9, 0x0000, 0 },
<span class="lineNum">     684 </span>            : /* U+F6F8 */ { 0x02dd, 0x0000, 0 },
<span class="lineNum">     685 </span>            : /* U+F6F9 */ { 0x0142, 0x0000, 0 },
<span class="lineNum">     686 </span>            : /* U+F6FA */ { 0xf76f, 0xf765, 0 },
<span class="lineNum">     687 </span>            : /* U+F6FB */ { 0xf76f, 0x0328, 0 },
<span class="lineNum">     688 </span>            : /* U+F6FC */ { 0xf772, 0x030a, 0 },
<span class="lineNum">     689 </span>            : /* U+F6FD */ { 0xf773, 0x030c, 0 },
<span class="lineNum">     690 </span>            : /* U+F6FE */ { 0xf774, 0x0303, 0 },
<span class="lineNum">     691 </span>            : /* U+F6FF */ { 0xf77a, 0x030c, 0 },
<span class="lineNum">     692 </span>            : /* U+F700 */ { 0 },
<span class="lineNum">     693 </span>            : /* U+F701 */ { 0 },
<span class="lineNum">     694 </span>            : /* U+F702 */ { 0 },
<span class="lineNum">     695 </span>            : /* U+F703 */ { 0 },
<span class="lineNum">     696 </span>            : /* U+F704 */ { 0 },
<span class="lineNum">     697 </span>            : /* U+F705 */ { 0 },
<span class="lineNum">     698 </span>            : /* U+F706 */ { 0 },
<span class="lineNum">     699 </span>            : /* U+F707 */ { 0 },
<span class="lineNum">     700 </span>            : /* U+F708 */ { 0 },
<span class="lineNum">     701 </span>            : /* U+F709 */ { 0 },
<span class="lineNum">     702 </span>            : /* U+F70A */ { 0 },
<span class="lineNum">     703 </span>            : /* U+F70B */ { 0 },
<span class="lineNum">     704 </span>            : /* U+F70C */ { 0 },
<span class="lineNum">     705 </span>            : /* U+F70D */ { 0 },
<span class="lineNum">     706 </span>            : /* U+F70E */ { 0 },
<span class="lineNum">     707 </span>            : /* U+F70F */ { 0 },
<span class="lineNum">     708 </span>            : /* U+F710 */ { 0 },
<span class="lineNum">     709 </span>            : /* U+F711 */ { 0 },
<span class="lineNum">     710 </span>            : /* U+F712 */ { 0 },
<span class="lineNum">     711 </span>            : /* U+F713 */ { 0 },
<span class="lineNum">     712 </span>            : /* U+F714 */ { 0 },
<span class="lineNum">     713 </span>            : /* U+F715 */ { 0 },
<span class="lineNum">     714 </span>            : /* U+F716 */ { 0 },
<span class="lineNum">     715 </span>            : /* U+F717 */ { 0 },
<span class="lineNum">     716 </span>            : /* U+F718 */ { 0 },
<span class="lineNum">     717 </span>            : /* U+F719 */ { 0 },
<span class="lineNum">     718 </span>            : /* U+F71A */ { 0 },
<span class="lineNum">     719 </span>            : /* U+F71B */ { 0 },
<span class="lineNum">     720 </span>            : /* U+F71C */ { 0 },
<span class="lineNum">     721 </span>            : /* U+F71D */ { 0 },
<span class="lineNum">     722 </span>            : /* U+F71E */ { 0 },
<span class="lineNum">     723 </span>            : /* U+F71F */ { 0 },
<span class="lineNum">     724 </span>            : /* U+F720 */ { 0 },
<span class="lineNum">     725 </span>            : /* U+F721 */ { 0x0021, 0x0000, 0 },
<span class="lineNum">     726 </span>            : /* U+F722 */ { 0 },
<span class="lineNum">     727 </span>            : /* U+F723 */ { 0 },
<span class="lineNum">     728 </span>            : /* U+F724 */ { 0x0024, 0x0000, 0 },
<span class="lineNum">     729 </span>            : /* U+F725 */ { 0 },
<span class="lineNum">     730 </span>            : /* U+F726 */ { 0x0026, 0x0000, 0 },
<span class="lineNum">     731 </span>            : /* U+F727 */ { 0 },
<span class="lineNum">     732 </span>            : /* U+F728 */ { 0 },
<span class="lineNum">     733 </span>            : /* U+F729 */ { 0 },
<span class="lineNum">     734 </span>            : /* U+F72A */ { 0 },
<span class="lineNum">     735 </span>            : /* U+F72B */ { 0 },
<span class="lineNum">     736 </span>            : /* U+F72C */ { 0 },
<span class="lineNum">     737 </span>            : /* U+F72D */ { 0 },
<span class="lineNum">     738 </span>            : /* U+F72E */ { 0 },
<span class="lineNum">     739 </span>            : /* U+F72F */ { 0 },
<span class="lineNum">     740 </span>            : /* U+F730 */ { 0x0030, 0x0000, 0 },
<span class="lineNum">     741 </span>            : /* U+F731 */ { 0x0031, 0x0000, 0 },
<span class="lineNum">     742 </span>            : /* U+F732 */ { 0x0032, 0x0000, 0 },
<span class="lineNum">     743 </span>            : /* U+F733 */ { 0x0033, 0x0000, 0 },
<span class="lineNum">     744 </span>            : /* U+F734 */ { 0x0034, 0x0000, 0 },
<span class="lineNum">     745 </span>            : /* U+F735 */ { 0x0035, 0x0000, 0 },
<span class="lineNum">     746 </span>            : /* U+F736 */ { 0x0036, 0x0000, 0 },
<span class="lineNum">     747 </span>            : /* U+F737 */ { 0x0037, 0x0000, 0 },
<span class="lineNum">     748 </span>            : /* U+F738 */ { 0x0038, 0x0000, 0 },
<span class="lineNum">     749 </span>            : /* U+F739 */ { 0x0039, 0x0000, 0 },
<span class="lineNum">     750 </span>            : /* U+F73A */ { 0 },
<span class="lineNum">     751 </span>            : /* U+F73B */ { 0 },
<span class="lineNum">     752 </span>            : /* U+F73C */ { 0 },
<span class="lineNum">     753 </span>            : /* U+F73D */ { 0 },
<span class="lineNum">     754 </span>            : /* U+F73E */ { 0 },
<span class="lineNum">     755 </span>            : /* U+F73F */ { 0x003f, 0x0000, 0 },
<span class="lineNum">     756 </span>            : /* U+F740 */ { 0 },
<span class="lineNum">     757 </span>            : /* U+F741 */ { 0 },
<span class="lineNum">     758 </span>            : /* U+F742 */ { 0 },
<span class="lineNum">     759 </span>            : /* U+F743 */ { 0 },
<span class="lineNum">     760 </span>            : /* U+F744 */ { 0 },
<span class="lineNum">     761 </span>            : /* U+F745 */ { 0 },
<span class="lineNum">     762 </span>            : /* U+F746 */ { 0 },
<span class="lineNum">     763 </span>            : /* U+F747 */ { 0 },
<span class="lineNum">     764 </span>            : /* U+F748 */ { 0 },
<span class="lineNum">     765 </span>            : /* U+F749 */ { 0 },
<span class="lineNum">     766 </span>            : /* U+F74A */ { 0 },
<span class="lineNum">     767 </span>            : /* U+F74B */ { 0 },
<span class="lineNum">     768 </span>            : /* U+F74C */ { 0 },
<span class="lineNum">     769 </span>            : /* U+F74D */ { 0 },
<span class="lineNum">     770 </span>            : /* U+F74E */ { 0 },
<span class="lineNum">     771 </span>            : /* U+F74F */ { 0 },
<span class="lineNum">     772 </span>            : /* U+F750 */ { 0 },
<span class="lineNum">     773 </span>            : /* U+F751 */ { 0 },
<span class="lineNum">     774 </span>            : /* U+F752 */ { 0 },
<span class="lineNum">     775 </span>            : /* U+F753 */ { 0 },
<span class="lineNum">     776 </span>            : /* U+F754 */ { 0 },
<span class="lineNum">     777 </span>            : /* U+F755 */ { 0 },
<span class="lineNum">     778 </span>            : /* U+F756 */ { 0 },
<span class="lineNum">     779 </span>            : /* U+F757 */ { 0 },
<span class="lineNum">     780 </span>            : /* U+F758 */ { 0 },
<span class="lineNum">     781 </span>            : /* U+F759 */ { 0 },
<span class="lineNum">     782 </span>            : /* U+F75A */ { 0 },
<span class="lineNum">     783 </span>            : /* U+F75B */ { 0 },
<span class="lineNum">     784 </span>            : /* U+F75C */ { 0 },
<span class="lineNum">     785 </span>            : /* U+F75D */ { 0 },
<span class="lineNum">     786 </span>            : /* U+F75E */ { 0 },
<span class="lineNum">     787 </span>            : /* U+F75F */ { 0 },
<span class="lineNum">     788 </span>            : /* U+F760 */ { 0x0060, 0x0000, 0 },
<span class="lineNum">     789 </span>            : /* U+F761 */ { 0x0061, 0x0000, 0 },
<span class="lineNum">     790 </span>            : /* U+F762 */ { 0x0062, 0x0000, 0 },
<span class="lineNum">     791 </span>            : /* U+F763 */ { 0x0063, 0x0000, 0 },
<span class="lineNum">     792 </span>            : /* U+F764 */ { 0x0064, 0x0000, 0 },
<span class="lineNum">     793 </span>            : /* U+F765 */ { 0x0065, 0x0000, 0 },
<span class="lineNum">     794 </span>            : /* U+F766 */ { 0x0066, 0x0000, 0 },
<span class="lineNum">     795 </span>            : /* U+F767 */ { 0x0067, 0x0000, 0 },
<span class="lineNum">     796 </span>            : /* U+F768 */ { 0x0068, 0x0000, 0 },
<span class="lineNum">     797 </span>            : /* U+F769 */ { 0x0069, 0x0000, 0 },
<span class="lineNum">     798 </span>            : /* U+F76A */ { 0x006a, 0x0000, 0 },
<span class="lineNum">     799 </span>            : /* U+F76B */ { 0x006b, 0x0000, 0 },
<span class="lineNum">     800 </span>            : /* U+F76C */ { 0x006c, 0x0000, 0 },
<span class="lineNum">     801 </span>            : /* U+F76D */ { 0x006d, 0x0000, 0 },
<span class="lineNum">     802 </span>            : /* U+F76E */ { 0x006e, 0x0000, 0 },
<span class="lineNum">     803 </span>            : /* U+F76F */ { 0x006f, 0x0000, 0 },
<span class="lineNum">     804 </span>            : /* U+F770 */ { 0x0070, 0x0000, 0 },
<span class="lineNum">     805 </span>            : /* U+F771 */ { 0x0071, 0x0000, 0 },
<span class="lineNum">     806 </span>            : /* U+F772 */ { 0x0072, 0x0000, 0 },
<span class="lineNum">     807 </span>            : /* U+F773 */ { 0x0073, 0x0000, 0 },
<span class="lineNum">     808 </span>            : /* U+F774 */ { 0x0074, 0x0000, 0 },
<span class="lineNum">     809 </span>            : /* U+F775 */ { 0x0075, 0x0000, 0 },
<span class="lineNum">     810 </span>            : /* U+F776 */ { 0x0076, 0x0000, 0 },
<span class="lineNum">     811 </span>            : /* U+F777 */ { 0x0077, 0x0000, 0 },
<span class="lineNum">     812 </span>            : /* U+F778 */ { 0x0078, 0x0000, 0 },
<span class="lineNum">     813 </span>            : /* U+F779 */ { 0x0079, 0x0000, 0 },
<span class="lineNum">     814 </span>            : /* U+F77A */ { 0x007a, 0x0000, 0 },
<span class="lineNum">     815 </span>            : /* U+F77B */ { 0 },
<span class="lineNum">     816 </span>            : /* U+F77C */ { 0 },
<span class="lineNum">     817 </span>            : /* U+F77D */ { 0 },
<span class="lineNum">     818 </span>            : /* U+F77E */ { 0 },
<span class="lineNum">     819 </span>            : /* U+F77F */ { 0 },
<span class="lineNum">     820 </span>            : /* U+F780 */ { 0 },
<span class="lineNum">     821 </span>            : /* U+F781 */ { 0 },
<span class="lineNum">     822 </span>            : /* U+F782 */ { 0 },
<span class="lineNum">     823 </span>            : /* U+F783 */ { 0 },
<span class="lineNum">     824 </span>            : /* U+F784 */ { 0 },
<span class="lineNum">     825 </span>            : /* U+F785 */ { 0 },
<span class="lineNum">     826 </span>            : /* U+F786 */ { 0 },
<span class="lineNum">     827 </span>            : /* U+F787 */ { 0 },
<span class="lineNum">     828 </span>            : /* U+F788 */ { 0 },
<span class="lineNum">     829 </span>            : /* U+F789 */ { 0 },
<span class="lineNum">     830 </span>            : /* U+F78A */ { 0 },
<span class="lineNum">     831 </span>            : /* U+F78B */ { 0 },
<span class="lineNum">     832 </span>            : /* U+F78C */ { 0 },
<span class="lineNum">     833 </span>            : /* U+F78D */ { 0 },
<span class="lineNum">     834 </span>            : /* U+F78E */ { 0 },
<span class="lineNum">     835 </span>            : /* U+F78F */ { 0 },
<span class="lineNum">     836 </span>            : /* U+F790 */ { 0 },
<span class="lineNum">     837 </span>            : /* U+F791 */ { 0 },
<span class="lineNum">     838 </span>            : /* U+F792 */ { 0 },
<span class="lineNum">     839 </span>            : /* U+F793 */ { 0 },
<span class="lineNum">     840 </span>            : /* U+F794 */ { 0 },
<span class="lineNum">     841 </span>            : /* U+F795 */ { 0 },
<span class="lineNum">     842 </span>            : /* U+F796 */ { 0 },
<span class="lineNum">     843 </span>            : /* U+F797 */ { 0 },
<span class="lineNum">     844 </span>            : /* U+F798 */ { 0 },
<span class="lineNum">     845 </span>            : /* U+F799 */ { 0 },
<span class="lineNum">     846 </span>            : /* U+F79A */ { 0 },
<span class="lineNum">     847 </span>            : /* U+F79B */ { 0 },
<span class="lineNum">     848 </span>            : /* U+F79C */ { 0 },
<span class="lineNum">     849 </span>            : /* U+F79D */ { 0 },
<span class="lineNum">     850 </span>            : /* U+F79E */ { 0 },
<span class="lineNum">     851 </span>            : /* U+F79F */ { 0 },
<span class="lineNum">     852 </span>            : /* U+F7A0 */ { 0 },
<span class="lineNum">     853 </span>            : /* U+F7A1 */ { 0x00a1, 0x0000, 0 },
<span class="lineNum">     854 </span>            : /* U+F7A2 */ { 0x00a2, 0x0000, 0 },
<span class="lineNum">     855 </span>            : /* U+F7A3 */ { 0 },
<span class="lineNum">     856 </span>            : /* U+F7A4 */ { 0 },
<span class="lineNum">     857 </span>            : /* U+F7A5 */ { 0 },
<span class="lineNum">     858 </span>            : /* U+F7A6 */ { 0 },
<span class="lineNum">     859 </span>            : /* U+F7A7 */ { 0 },
<span class="lineNum">     860 </span>            : /* U+F7A8 */ { 0x00a8, 0x0000, 0 },
<span class="lineNum">     861 </span>            : /* U+F7A9 */ { 0 },
<span class="lineNum">     862 </span>            : /* U+F7AA */ { 0 },
<span class="lineNum">     863 </span>            : /* U+F7AB */ { 0 },
<span class="lineNum">     864 </span>            : /* U+F7AC */ { 0 },
<span class="lineNum">     865 </span>            : /* U+F7AD */ { 0 },
<span class="lineNum">     866 </span>            : /* U+F7AE */ { 0 },
<span class="lineNum">     867 </span>            : /* U+F7AF */ { 0x00af, 0x0000, 0 },
<span class="lineNum">     868 </span>            : /* U+F7B0 */ { 0 },
<span class="lineNum">     869 </span>            : /* U+F7B1 */ { 0 },
<span class="lineNum">     870 </span>            : /* U+F7B2 */ { 0 },
<span class="lineNum">     871 </span>            : /* U+F7B3 */ { 0 },
<span class="lineNum">     872 </span>            : /* U+F7B4 */ { 0x00b4, 0x0000, 0 },
<span class="lineNum">     873 </span>            : /* U+F7B5 */ { 0 },
<span class="lineNum">     874 </span>            : /* U+F7B6 */ { 0 },
<span class="lineNum">     875 </span>            : /* U+F7B7 */ { 0 },
<span class="lineNum">     876 </span>            : /* U+F7B8 */ { 0x00b8, 0x0000, 0 },
<span class="lineNum">     877 </span>            : /* U+F7B9 */ { 0 },
<span class="lineNum">     878 </span>            : /* U+F7BA */ { 0 },
<span class="lineNum">     879 </span>            : /* U+F7BB */ { 0 },
<span class="lineNum">     880 </span>            : /* U+F7BC */ { 0 },
<span class="lineNum">     881 </span>            : /* U+F7BD */ { 0 },
<span class="lineNum">     882 </span>            : /* U+F7BE */ { 0 },
<span class="lineNum">     883 </span>            : /* U+F7BF */ { 0x00bf, 0x0000, 0 },
<span class="lineNum">     884 </span>            : /* U+F7C0 */ { 0 },
<span class="lineNum">     885 </span>            : /* U+F7C1 */ { 0 },
<span class="lineNum">     886 </span>            : /* U+F7C2 */ { 0 },
<span class="lineNum">     887 </span>            : /* U+F7C3 */ { 0 },
<span class="lineNum">     888 </span>            : /* U+F7C4 */ { 0 },
<span class="lineNum">     889 </span>            : /* U+F7C5 */ { 0 },
<span class="lineNum">     890 </span>            : /* U+F7C6 */ { 0 },
<span class="lineNum">     891 </span>            : /* U+F7C7 */ { 0 },
<span class="lineNum">     892 </span>            : /* U+F7C8 */ { 0 },
<span class="lineNum">     893 </span>            : /* U+F7C9 */ { 0 },
<span class="lineNum">     894 </span>            : /* U+F7CA */ { 0 },
<span class="lineNum">     895 </span>            : /* U+F7CB */ { 0 },
<span class="lineNum">     896 </span>            : /* U+F7CC */ { 0 },
<span class="lineNum">     897 </span>            : /* U+F7CD */ { 0 },
<span class="lineNum">     898 </span>            : /* U+F7CE */ { 0 },
<span class="lineNum">     899 </span>            : /* U+F7CF */ { 0 },
<span class="lineNum">     900 </span>            : /* U+F7D0 */ { 0 },
<span class="lineNum">     901 </span>            : /* U+F7D1 */ { 0 },
<span class="lineNum">     902 </span>            : /* U+F7D2 */ { 0 },
<span class="lineNum">     903 </span>            : /* U+F7D3 */ { 0 },
<span class="lineNum">     904 </span>            : /* U+F7D4 */ { 0 },
<span class="lineNum">     905 </span>            : /* U+F7D5 */ { 0 },
<span class="lineNum">     906 </span>            : /* U+F7D6 */ { 0 },
<span class="lineNum">     907 </span>            : /* U+F7D7 */ { 0 },
<span class="lineNum">     908 </span>            : /* U+F7D8 */ { 0 },
<span class="lineNum">     909 </span>            : /* U+F7D9 */ { 0 },
<span class="lineNum">     910 </span>            : /* U+F7DA */ { 0 },
<span class="lineNum">     911 </span>            : /* U+F7DB */ { 0 },
<span class="lineNum">     912 </span>            : /* U+F7DC */ { 0 },
<span class="lineNum">     913 </span>            : /* U+F7DD */ { 0 },
<span class="lineNum">     914 </span>            : /* U+F7DE */ { 0 },
<span class="lineNum">     915 </span>            : /* U+F7DF */ { 0 },
<span class="lineNum">     916 </span>            : /* U+F7E0 */ { 0xf761, 0x0300, 0 },
<span class="lineNum">     917 </span>            : /* U+F7E1 */ { 0xf761, 0x0301, 0 },
<span class="lineNum">     918 </span>            : /* U+F7E2 */ { 0xf761, 0x0302, 0 },
<span class="lineNum">     919 </span>            : /* U+F7E3 */ { 0xf761, 0x0303, 0 },
<span class="lineNum">     920 </span>            : /* U+F7E4 */ { 0xf761, 0x0308, 0 },
<span class="lineNum">     921 </span>            : /* U+F7E5 */ { 0xf761, 0x030a, 0 },
<span class="lineNum">     922 </span>            : /* U+F7E6 */ { 0xf761, 0xf765, 0 },
<span class="lineNum">     923 </span>            : /* U+F7E7 */ { 0xf763, 0x0327, 0 },
<span class="lineNum">     924 </span>            : /* U+F7E8 */ { 0xf765, 0x0300, 0 },
<span class="lineNum">     925 </span>            : /* U+F7E9 */ { 0xf765, 0x0301, 0 },
<span class="lineNum">     926 </span>            : /* U+F7EA */ { 0xf765, 0x0302, 0 },
<span class="lineNum">     927 </span>            : /* U+F7EB */ { 0xf765, 0x0308, 0 },
<span class="lineNum">     928 </span>            : /* U+F7EC */ { 0xf769, 0x0300, 0 },
<span class="lineNum">     929 </span>            : /* U+F7ED */ { 0xf769, 0x0301, 0 },
<span class="lineNum">     930 </span>            : /* U+F7EE */ { 0xf769, 0x0302, 0 },
<span class="lineNum">     931 </span>            : /* U+F7EF */ { 0xf769, 0x0308, 0 },
<span class="lineNum">     932 </span>            : /* U+F7F0 */ { 0x00f0, 0x0000, 0 },
<span class="lineNum">     933 </span>            : /* U+F7F1 */ { 0xf76e, 0x0303, 0 },
<span class="lineNum">     934 </span>            : /* U+F7F2 */ { 0xf76f, 0x0300, 0 },
<span class="lineNum">     935 </span>            : /* U+F7F3 */ { 0xf76f, 0x0301, 0 },
<span class="lineNum">     936 </span>            : /* U+F7F4 */ { 0xf76f, 0x0302, 0 },
<span class="lineNum">     937 </span>            : /* U+F7F5 */ { 0xf76f, 0x0303, 0 },
<span class="lineNum">     938 </span>            : /* U+F7F6 */ { 0xf76f, 0x0308, 0 },
<span class="lineNum">     939 </span>            : /* U+F7F7 */ { 0 },
<span class="lineNum">     940 </span>            : /* U+F7F8 */ { 0x00f8, 0x0000, 0 },
<span class="lineNum">     941 </span>            : /* U+F7F9 */ { 0xf775, 0x0300, 0 },
<span class="lineNum">     942 </span>            : /* U+F7FA */ { 0xf775, 0x0301, 0 },
<span class="lineNum">     943 </span>            : /* U+F7FB */ { 0xf775, 0x0302, 0 },
<span class="lineNum">     944 </span>            : /* U+F7FC */ { 0xf775, 0x0308, 0 },
<span class="lineNum">     945 </span>            : /* U+F7FD */ { 0xf779, 0x0301, 0 },
<span class="lineNum">     946 </span>            : /* U+F7FE */ { 0x00fe, 0x0000, 0 },
<span class="lineNum">     947 </span>            : /* U+F7FF */ { 0xf779, 0x0308, 0 }
<a name="948"><span class="lineNum">     948 </span>            : };</a>
<span class="lineNum">     949 </span>            : 
<span class="lineNum">     950 </span><span class="lineNoCov">          0 : static real SplineSetQuickTop(SplineSet *ss) {</span>
<span class="lineNum">     951 </span><span class="lineNoCov">          0 :     real max = -1e10;</span>
<span class="lineNum">     952 </span>            :     SplinePoint *sp;
<span class="lineNum">     953 </span>            : 
<span class="lineNum">     954 </span><span class="lineNoCov">          0 :     for ( ; ss!=NULL; ss=ss-&gt;next ) {</span>
<span class="lineNum">     955 </span><span class="lineNoCov">          0 :         for ( sp=ss-&gt;first; ; ) {</span>
<span class="lineNum">     956 </span><span class="lineNoCov">          0 :             if ( sp-&gt;me.y &gt; max ) max = sp-&gt;me.y;</span>
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :             if ( sp-&gt;next==NULL )</span>
<span class="lineNum">     958 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :             sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :             if ( sp==ss-&gt;first )</span>
<span class="lineNum">     961 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     963 </span>            :     }
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :     if ( max&lt;-65536 ) max = 0;       /* return a reasonable value for an empty glyph */</span>
<span class="lineNum">     965 </span><span class="lineNoCov">          0 : return( max );</span>
<a name="966"><span class="lineNum">     966 </span>            : }</a>
<span class="lineNum">     967 </span>            : 
<span class="lineNum">     968 </span><span class="lineNoCov">          0 : static real SplineCharQuickTop(SplineChar *sc,int layer) {</span>
<span class="lineNum">     969 </span>            :     RefChar *ref;
<span class="lineNum">     970 </span>            :     real max, temp;
<span class="lineNum">     971 </span>            : 
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :     max = SplineSetQuickTop(sc-&gt;layers[layer].splines);</span>
<span class="lineNum">     973 </span><span class="lineNoCov">          0 :     for ( ref = sc-&gt;layers[layer].refs; ref!=NULL; ref = ref-&gt;next )</span>
<span class="lineNum">     974 </span><span class="lineNoCov">          0 :         if ( (temp =SplineSetQuickTop(ref-&gt;layers[0].splines))&gt;max )</span>
<span class="lineNum">     975 </span><span class="lineNoCov">          0 :             max = temp;</span>
<span class="lineNum">     976 </span><span class="lineNoCov">          0 : return( max );</span>
<a name="977"><span class="lineNum">     977 </span>            : }</a>
<span class="lineNum">     978 </span>            : 
<span class="lineNum">     979 </span><span class="lineNoCov">          0 : int isaccent(int uni) {</span>
<span class="lineNum">     980 </span>            : 
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :     if ( uni&lt;0x10000 &amp;&amp; iscombining(uni) )</span>
<span class="lineNum">     982 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :     if ( uni&gt;=0x2b0 &amp;&amp; uni&lt;0x2ff )</span>
<span class="lineNum">     984 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :     if ( uni=='.' || uni==',' || uni==0x60 || uni==0x5e || uni==0x7e ||</span>
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :             uni==0xa8 || uni==0xaf || uni==0xb8 || uni==0x384 || uni==0x385 ||</span>
<span class="lineNum">     987 </span><span class="lineNoCov">          0 :             (uni&gt;=0x1fbd &amp;&amp; uni&lt;=0x1fc1) ||</span>
<span class="lineNum">     988 </span><span class="lineNoCov">          0 :             (uni&gt;=0x1fcd &amp;&amp; uni&lt;=0x1fcf) ||</span>
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :             (uni&gt;=0x1fed &amp;&amp; uni&lt;=0x1fef) ||</span>
<span class="lineNum">     990 </span><span class="lineNoCov">          0 :             (uni&gt;=0x1ffd &amp;&amp; uni&lt;=0x1fff) )</span>
<span class="lineNum">     991 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     992 </span>            : 
<span class="lineNum">     993 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="994"><span class="lineNum">     994 </span>            : }</a>
<span class="lineNum">     995 </span>            : 
<span class="lineNum">     996 </span><span class="lineNoCov">          0 : static int haschar(SplineFont *sf,unichar_t ch,char *dot) {</span>
<span class="lineNum">     997 </span>            :     char buffer[200], namebuf[200];
<span class="lineNum">     998 </span>            : 
<span class="lineNum">     999 </span><span class="lineNoCov">          0 :     if ( dot==NULL || ch==-1 )</span>
<span class="lineNum">    1000 </span><span class="lineNoCov">          0 : return( SCWorthOutputting(SFGetChar(sf,ch,NULL)) );</span>
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 :     snprintf(buffer,sizeof(buffer),&quot;%s%s&quot;,</span>
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 :             (char *) StdGlyphName(namebuf,ch,sf-&gt;uni_interp,sf-&gt;for_new_glyphs),</span>
<span class="lineNum">    1003 </span>            :             dot);
<span class="lineNum">    1004 </span><span class="lineNoCov">          0 :     if ( SCWorthOutputting(SFGetChar(sf,-1,buffer)) )</span>
<span class="lineNum">    1005 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1006 </span><span class="lineNoCov">          0 :     else if ( isaccent(ch))</span>
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 : return( SCWorthOutputting(SFGetChar(sf,ch,NULL)) );</span>
<span class="lineNum">    1008 </span>            :     else
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="1010"><span class="lineNum">    1010 </span>            : }</a>
<span class="lineNum">    1011 </span>            : 
<span class="lineNum">    1012 </span><span class="lineNoCov">          0 : static SplineChar *GetChar(SplineFont *sf,unichar_t ch,char *dot) {</span>
<span class="lineNum">    1013 </span>            :     char buffer[200], namebuf[200];
<span class="lineNum">    1014 </span>            :     SplineChar *sc;
<span class="lineNum">    1015 </span>            :     /* Basically the same as above */
<span class="lineNum">    1016 </span>            : 
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :     if ( dot==NULL || ch==-1 )</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 : return( SFGetChar(sf,ch,NULL) );</span>
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :     snprintf(buffer,sizeof(buffer),&quot;%s%s&quot;,</span>
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 :             (char *) StdGlyphName(namebuf,ch,sf-&gt;uni_interp,sf-&gt;for_new_glyphs),</span>
<span class="lineNum">    1021 </span>            :             dot);
<span class="lineNum">    1022 </span><span class="lineNoCov">          0 :     if ( (sc = SFGetChar(sf,-1,buffer)) )</span>
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 : return( sc );</span>
<span class="lineNum">    1024 </span><span class="lineNoCov">          0 :     else if ( isaccent(ch))</span>
<span class="lineNum">    1025 </span><span class="lineNoCov">          0 : return( SFGetChar(sf,ch,NULL) );</span>
<span class="lineNum">    1026 </span>            :     else
<span class="lineNum">    1027 </span><span class="lineNoCov">          0 : return( NULL );</span>
<a name="1028"><span class="lineNum">    1028 </span>            : }</a>
<span class="lineNum">    1029 </span>            : 
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 : static const unichar_t *arabicfixup(SplineFont *sf, const unichar_t *upt, int ini, int final) {</span>
<span class="lineNum">    1031 </span>            :     static unichar_t arabicalts[20];
<span class="lineNum">    1032 </span>            :     unichar_t *apt; const unichar_t *pt;
<span class="lineNum">    1033 </span>            : 
<span class="lineNum">    1034 </span><span class="lineNoCov">          0 :     for ( apt=arabicalts, pt = upt; *pt!='\0'; ++pt, ++apt ) {</span>
<span class="lineNum">    1035 </span><span class="lineNoCov">          0 :         if ( *pt==' ' ) {</span>
<span class="lineNum">    1036 </span><span class="lineNoCov">          0 :             *apt = ' ';</span>
<span class="lineNum">    1037 </span><span class="lineNoCov">          0 :             ini = true;</span>
<span class="lineNum">    1038 </span><span class="lineNoCov">          0 :         } else if ( *pt&lt;0x600 || *pt&gt;0x6ff )</span>
<span class="lineNum">    1039 </span><span class="lineNoCov">          0 :             *apt = *pt;</span>
<span class="lineNum">    1040 </span><span class="lineNoCov">          0 :         else if ( ini ) {</span>
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 :             *apt = ArabicForms[*pt-0x600].initial;</span>
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :             ini = false;</span>
<span class="lineNum">    1043 </span><span class="lineNoCov">          0 :         } else if ( pt[1]==' ' || (pt[1]=='\0' &amp;&amp; final))</span>
<span class="lineNum">    1044 </span><span class="lineNoCov">          0 :             *apt = ArabicForms[*pt-0x600].final;</span>
<span class="lineNum">    1045 </span>            :         else
<span class="lineNum">    1046 </span><span class="lineNoCov">          0 :             *apt = ArabicForms[*pt-0x600].medial;</span>
<span class="lineNum">    1047 </span><span class="lineNoCov">          0 :         if ( !haschar(sf,*apt,NULL))</span>
<span class="lineNum">    1048 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1049 </span>            :     }
<span class="lineNum">    1050 </span><span class="lineNoCov">          0 :     if ( *pt=='\0' ) {</span>
<span class="lineNum">    1051 </span><span class="lineNoCov">          0 :         *apt = '\0';</span>
<span class="lineNum">    1052 </span><span class="lineNoCov">          0 : return(arabicalts);</span>
<span class="lineNum">    1053 </span>            :     }
<span class="lineNum">    1054 </span><span class="lineNoCov">          0 : return( upt );</span>
<a name="1055"><span class="lineNum">    1055 </span>            : }</a>
<span class="lineNum">    1056 </span>            : 
<span class="lineNum">    1057 </span><span class="lineNoCov">          0 : static const unichar_t *SFAlternateFromLigature(SplineFont *sf, int base,SplineChar *sc) {</span>
<span class="lineNum">    1058 </span>            :     static unichar_t space[30];
<span class="lineNum">    1059 </span><span class="lineNoCov">          0 :     unichar_t *spt, *send = space+sizeof(space)/sizeof(space[0])-1;</span>
<span class="lineNum">    1060 </span>            :     char *ligstart, *semi, *pt, sch, ch, *dpt;
<span class="lineNum">    1061 </span>            :     int j;
<span class="lineNum">    1062 </span>            :     PST *pst;
<span class="lineNum">    1063 </span>            : 
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :     if ( sc==NULL &amp;&amp; base&gt;=0 )</span>
<span class="lineNum">    1065 </span><span class="lineNoCov">          0 :         sc = SFGetChar(sf,base,NULL);</span>
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 :     pst = NULL;</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :     if ( sc!=NULL )</span>
<span class="lineNum">    1068 </span><span class="lineNoCov">          0 :         for ( pst=sc-&gt;possub; pst!=NULL &amp;&amp; pst-&gt;type!=pst_ligature; pst = pst-&gt;next );</span>
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :     if ( sc==NULL || pst==NULL )</span>
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    1071 </span>            : 
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 :     ligstart=pst-&gt;u.lig.components;</span>
<span class="lineNum">    1073 </span><span class="lineNoCov">          0 :     semi = strchr(ligstart,';');</span>
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :     if ( semi==NULL ) semi = ligstart+strlen(ligstart);</span>
<span class="lineNum">    1075 </span><span class="lineNoCov">          0 :     sch = *semi; *semi = '\0';</span>
<span class="lineNum">    1076 </span><span class="lineNoCov">          0 :     spt = space;</span>
<span class="lineNum">    1077 </span><span class="lineNoCov">          0 :     dpt = NULL;</span>
<span class="lineNum">    1078 </span><span class="lineNoCov">          0 :     for ( pt = ligstart; *pt!='\0'; ) {</span>
<span class="lineNum">    1079 </span><span class="lineNoCov">          0 :         char *start = pt; dpt=NULL;</span>
<span class="lineNum">    1080 </span><span class="lineNoCov">          0 :         for ( ; *pt!='\0' &amp;&amp; *pt!=' '; ++pt );</span>
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 :         ch = *pt; *pt = '\0';</span>
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :         for ( j=0; j&lt;sf-&gt;glyphcnt; ++j )</span>
<span class="lineNum">    1083 </span><span class="lineNoCov">          0 :             if ( sf-&gt;glyphs[j]!=NULL &amp;&amp; strcmp(sf-&gt;glyphs[j]-&gt;name,start)==0 )</span>
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">          0 :         *pt = ch;</span>
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :         if ( j==sf-&gt;glyphcnt &amp;&amp; (dpt=strchr(start,'.'))!=NULL &amp;&amp; dpt&lt;pt ) {</span>
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :             int dch = *dpt; *dpt='\0';</span>
<span class="lineNum">    1088 </span><span class="lineNoCov">          0 :             for ( j=0; j&lt;sf-&gt;glyphcnt; ++j )</span>
<span class="lineNum">    1089 </span><span class="lineNoCov">          0 :                 if ( sf-&gt;glyphs[j]!=NULL &amp;&amp; strcmp(sf-&gt;glyphs[j]-&gt;name,start)==0 )</span>
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1091 </span><span class="lineNoCov">          0 :             *dpt = dch;</span>
<span class="lineNum">    1092 </span>            :         }
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 :         if ( j&gt;=sf-&gt;glyphcnt || sf-&gt;glyphs[j]-&gt;unicodeenc==-1 || spt&gt;=send ) {</span>
<span class="lineNum">    1094 </span><span class="lineNoCov">          0 :             *semi = sch;</span>
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    1096 </span>            :         }
<span class="lineNum">    1097 </span><span class="lineNoCov">          0 :         *spt++ = sf-&gt;glyphs[j]-&gt;unicodeenc;</span>
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :         if ( ch!='\0' ) ++pt;</span>
<span class="lineNum">    1099 </span>            :     }
<span class="lineNum">    1100 </span><span class="lineNoCov">          0 :     *spt ='\0';</span>
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :     *semi = sch;</span>
<span class="lineNum">    1102 </span>            : 
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :     if ( *space&gt;=0x0600 &amp;&amp; *space&lt;=0x6ff ) {</span>
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :         int ini=0, final=0;</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :         if ( dpt==NULL || strncmp(dpt,&quot;.isolated&quot;,strlen(&quot;.isolated&quot;))==0 )</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :             ini=final = true;</span>
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :         else if ( strncmp(dpt,&quot;.initial&quot;,strlen(&quot;.initial&quot;))==0 )</span>
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :             ini=true;</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :         else if ( strncmp(dpt,&quot;.final&quot;,strlen(&quot;.final&quot;))==0 )</span>
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :             final=true;</span>
<span class="lineNum">    1111 </span><span class="lineNoCov">          0 : return( arabicfixup(sf,space,ini,final));</span>
<span class="lineNum">    1112 </span>            :     }
<span class="lineNum">    1113 </span>            : 
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 : return( space );</span>
<a name="1115"><span class="lineNum">    1115 </span>            : }</a>
<span class="lineNum">    1116 </span>            : 
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 : const unichar_t *SFGetAlternate(SplineFont *sf, int base,SplineChar *sc,int nocheck) {</span>
<span class="lineNum">    1118 </span>            :     static unichar_t greekalts[5];
<span class="lineNum">    1119 </span>            :     const unichar_t *upt, *pt; unichar_t *gpt;
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 :     char *dot = NULL;</span>
<span class="lineNum">    1121 </span>            : 
<span class="lineNum">    1122 </span><span class="lineNoCov">          0 :     if ( sc!=NULL &amp;&amp; (dot = strchr(sc-&gt;name,'.'))!=NULL ) {</span>
<span class="lineNum">    1123 </span>            :         /* agrave.sc should be built from a.sc and grave or grave.sc */
<span class="lineNum">    1124 </span><span class="lineNoCov">          0 :         char *temp = copyn(sc-&gt;name,dot-sc-&gt;name);</span>
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 :         base = UniFromName(temp,sf-&gt;uni_interp,NULL);</span>
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :         free(temp);</span>
<span class="lineNum">    1127 </span>            :     }
<span class="lineNum">    1128 </span>            : 
<span class="lineNum">    1129 </span><span class="lineNoCov">          0 :     if ( base&gt;=0xac00 &amp;&amp; base&lt;=0xd7a3 ) { /* Hangul syllables */</span>
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :         greekalts[0] = (base-0xac00)/(21*28) + 0x1100;</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 :         greekalts[1] = ((base-0xac00)/28)%21 + 0x1161;</span>
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 :         if ( (base-0xac00)%28==0 )</span>
<span class="lineNum">    1133 </span><span class="lineNoCov">          0 :             greekalts[2] = 0;</span>
<span class="lineNum">    1134 </span>            :         else
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 :             greekalts[2] = (base-0xac00)%28 -1 + 0x11a8;</span>
<span class="lineNum">    1136 </span><span class="lineNoCov">          0 :         greekalts[3] = 0;</span>
<span class="lineNum">    1137 </span><span class="lineNoCov">          0 : return( greekalts );</span>
<span class="lineNum">    1138 </span>            :     }
<span class="lineNum">    1139 </span><span class="lineNoCov">          0 :     if ( base=='i' || base=='j' ) {</span>
<span class="lineNum">    1140 </span><span class="lineNoCov">          0 :         if ( base=='i' )</span>
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :             greekalts[0] = 0x131;</span>
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :         else if ( haschar(sf,0x237,NULL))</span>
<span class="lineNum">    1143 </span><span class="lineNoCov">          0 :             greekalts[0] = 0x237;               /* proposed dotlessj */</span>
<span class="lineNum">    1144 </span>            :         else
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :             greekalts[0] = 0xf6be;              /* Dotlessj in Adobe's private use area */</span>
<span class="lineNum">    1146 </span><span class="lineNoCov">          0 :         greekalts[1] = 0x307;</span>
<span class="lineNum">    1147 </span><span class="lineNoCov">          0 :         greekalts[2] = 0;</span>
<span class="lineNum">    1148 </span><span class="lineNoCov">          0 : return( greekalts );</span>
<span class="lineNum">    1149 </span>            :     }
<span class="lineNum">    1150 </span>            : 
<span class="lineNum">    1151 </span><span class="lineNoCov">          0 :     if ( sf-&gt;uni_interp==ui_adobe &amp;&amp; base&gt;=0xf600 &amp;&amp; base&lt;=0xf7ff &amp;&amp;</span>
<span class="lineNum">    1152 </span>            :             adobes_pua_alts[base-0xf600]!=0 )
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 : return( adobes_pua_alts[base-0xf600]);</span>
<span class="lineNum">    1154 </span>            : 
<span class="lineNum">    1155 </span><span class="lineNoCov">          0 :     if ( base==-1 || base&gt;=65536 || unicode_alternates[base&gt;&gt;8]==NULL ||</span>
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :             (upt = unicode_alternates[base&gt;&gt;8][base&amp;0xff])==NULL )</span>
<span class="lineNum">    1157 </span><span class="lineNoCov">          0 : return( SFAlternateFromLigature(sf,base,sc));</span>
<span class="lineNum">    1158 </span>            : 
<span class="lineNum">    1159 </span>            :             /* The definitions of some of the greek letters may make some */
<span class="lineNum">    1160 </span>            :             /*  linguistic sense, but I can't use it to place the accents */
<span class="lineNum">    1161 </span>            :             /*  properly. So I redefine them here */
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :     if ( base&gt;=0x1f00 &amp;&amp; base&lt;0x2000 ) {</span>
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 :         gpt = unicode_greekalts[base-0x1f00];</span>
<span class="lineNum">    1164 </span><span class="lineNoCov">          0 :         if ( *gpt &amp;&amp; (nocheck ||</span>
<span class="lineNum">    1165 </span><span class="lineNoCov">          0 :                 (haschar(sf,*gpt,dot) &amp;&amp; (gpt[1]=='\0' || haschar(sf,gpt[1],dot))) ))</span>
<span class="lineNum">    1166 </span><span class="lineNoCov">          0 : return( gpt );</span>
<span class="lineNum">    1167 </span>            :             /* Similarly for these (korean) jamo */
<span class="lineNum">    1168 </span><span class="lineNoCov">          0 :     } else if (( base&gt;=0x1176 &amp;&amp; base&lt;=0x117e ) || (base&gt;=0x119a &amp;&amp; base&lt;=0x119c)) {</span>
<span class="lineNum">    1169 </span><span class="lineNoCov">          0 :         greekalts[0] = upt[1]; greekalts[1] = upt[0]; greekalts[2] = 0;</span>
<span class="lineNum">    1170 </span><span class="lineNoCov">          0 : return( greekalts );</span>
<span class="lineNum">    1171 </span><span class="lineNoCov">          0 :     } else if ( base&gt;=0x380 &amp;&amp; base&lt;=0x3ff &amp;&amp; upt!=NULL ) {</span>
<span class="lineNum">    1172 </span>            :         /* Use precombined accents when possible */
<span class="lineNum">    1173 </span><span class="lineNoCov">          0 :         if ( base==0x390 || base==0x3b0 ) {</span>
<span class="lineNum">    1174 </span><span class="lineNoCov">          0 :             greekalts[0] = base==0x390?0x3b9:0x3c5;</span>
<span class="lineNum">    1175 </span><span class="lineNoCov">          0 :             greekalts[1] = 0x385;</span>
<span class="lineNum">    1176 </span><span class="lineNoCov">          0 :             greekalts[2] = '\0';</span>
<span class="lineNum">    1177 </span><span class="lineNoCov">          0 :             if ( nocheck || haschar(sf,greekalts[1],dot))</span>
<span class="lineNum">    1178 </span><span class="lineNoCov">          0 : return( greekalts );</span>
<span class="lineNum">    1179 </span>            :         }
<span class="lineNum">    1180 </span>            :         /* In version 3 of unicode tonos gets converted to acute, which it */
<span class="lineNum">    1181 </span>            :         /*  doesn't look like. Convert it back */
<span class="lineNum">    1182 </span><span class="lineNoCov">          0 :         for ( pt=upt ; *pt &amp;&amp; *pt!=0x301; ++pt );</span>
<span class="lineNum">    1183 </span><span class="lineNoCov">          0 :         if ( *pt ) {</span>
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :             for ( gpt=greekalts ; *upt ; ++upt ) {</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :                 if ( *upt==0x301 )</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :                     *gpt++ = 0x384 /* I used to use 0x30d, thinking that it was a combining tonos, but greek users tell me it is not */;</span>
<span class="lineNum">    1187 </span>            :                 else
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :                     *gpt++ = *upt;</span>
<span class="lineNum">    1189 </span>            :             }
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 : return( greekalts );</span>
<span class="lineNum">    1191 </span>            :         }
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :     } else if (( base&gt;=0xfb50 &amp;&amp; base&lt;=0xfdff ) || ( base&gt;=0xfe70 &amp;&amp; base&lt;0xfeff ))</span>
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 : return( arabicfixup(sf,upt,isarabisolated(base)||isarabinitial(base),</span>
<span class="lineNum">    1194 </span><span class="lineNoCov">          0 :                 isarabisolated(base)||isarabfinal(base)));</span>
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 :     else if ( base==0x0122 || base==0x0136 || base==0x137 ||</span>
<span class="lineNum">    1196 </span><span class="lineNoCov">          0 :             base==0x013b || base==0x013c || base==0x0145 ||</span>
<span class="lineNum">    1197 </span><span class="lineNoCov">          0 :             base==0x0146 || base==0x0156 || base==0x0157 ) {</span>
<span class="lineNum">    1198 </span>            :         /* Unicode says these use cedilla, but it looks like a comma below */
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :         greekalts[0] = base==0x0122 ? 'G' :</span>
<span class="lineNum">    1200 </span>            :                        base==0x0136 ? 'K' :
<span class="lineNum">    1201 </span>            :                        base==0x0137 ? 'k' :
<span class="lineNum">    1202 </span>            :                        base==0x013b ? 'L' :
<span class="lineNum">    1203 </span>            :                        base==0x013c ? 'l' :
<span class="lineNum">    1204 </span>            :                        base==0x0145 ? 'N' :
<span class="lineNum">    1205 </span>            :                        base==0x0146 ? 'n' :
<span class="lineNum">    1206 </span>            :                        base==0x0156 ? 'R' :
<span class="lineNum">    1207 </span>            :                            'r';
<span class="lineNum">    1208 </span><span class="lineNoCov">          0 :         greekalts[1] = 0x326;</span>
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :         greekalts[2] = '\0';</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 : return( greekalts );</span>
<span class="lineNum">    1211 </span><span class="lineNoCov">          0 :     } else if ( base==0x0123 ) {</span>
<span class="lineNum">    1212 </span>            :         /* Unicode says this uses cedilla, but it looks like a turned comma above */
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :         greekalts[0] = 'g';</span>
<span class="lineNum">    1214 </span><span class="lineNoCov">          0 :         greekalts[1] = 0x312;</span>
<span class="lineNum">    1215 </span><span class="lineNoCov">          0 :         greekalts[2] = '\0';</span>
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 : return( greekalts );</span>
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 :     } else if ( base==0x010f || base==0x013d || base==0x013e || base==0x0165 ) {</span>
<span class="lineNum">    1218 </span>            :         /* Unicode says these use caron, but it looks like comma above right */
<span class="lineNum">    1219 </span><span class="lineNoCov">          0 :         greekalts[0] =  base==0x010f ? 'd' :</span>
<span class="lineNum">    1220 </span>            :                         base==0x013d ? 'L' :
<span class="lineNum">    1221 </span>            :                         base==0x013e ? 'l' :
<span class="lineNum">    1222 </span>            :                            't';
<span class="lineNum">    1223 </span><span class="lineNoCov">          0 :         greekalts[1] = 0x315;</span>
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :         greekalts[2] = '\0';</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 : return( greekalts );</span>
<span class="lineNum">    1226 </span>            :     }
<span class="lineNum">    1227 </span>            : 
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 : return( upt );</span>
<span class="lineNum">    1229 </span>            : }
<span class="lineNum">    1230 </span>            : 
<span class="lineNum">    1231 </span>            : static SplineChar *GetGoodAccentGlyph(SplineFont *sf, int uni, int basech,
<a name="1232"><span class="lineNum">    1232 </span>            :         int *invert,double ia, char *dot, SplineChar *destination);</a>
<span class="lineNum">    1233 </span>            : 
<span class="lineNum">    1234 </span><span class="lineNoCov">          0 : int SFIsCompositBuildable(SplineFont *sf,int unicodeenc,SplineChar *sc,int layer) {</span>
<span class="lineNum">    1235 </span>            :     const unichar_t *pt, *all; unichar_t ch, basech;
<span class="lineNum">    1236 </span>            :     SplineChar *one, *two;
<span class="lineNum">    1237 </span><span class="lineNoCov">          0 :     char *dot = NULL;</span>
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :     int invert = false;</span>
<span class="lineNum">    1239 </span>            : 
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 :     if ( unicodeenc==0x131 || unicodeenc==0x0237 || unicodeenc==0xf6be )</span>
<span class="lineNum">    1241 </span><span class="lineNoCov">          0 : return( SCMakeDotless(sf,SFGetOrMakeChar(sf,unicodeenc,NULL),layer,NULL,false,false));</span>
<span class="lineNum">    1242 </span>            : 
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :     if ( sc!=NULL &amp;&amp; (dot = strchr(sc-&gt;name,'.'))!=NULL ) {</span>
<span class="lineNum">    1244 </span>            :         /* agrave.sc should be built from a.sc and grave or grave.sc */
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :         char *temp = copyn(sc-&gt;name,dot-sc-&gt;name);</span>
<span class="lineNum">    1246 </span><span class="lineNoCov">          0 :         unicodeenc = UniFromName(temp,sf-&gt;uni_interp,NULL);</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :         free(temp);</span>
<span class="lineNum">    1248 </span>            :     }
<span class="lineNum">    1249 </span>            : 
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :     if (( all = pt = SFGetAlternate(sf,unicodeenc,sc,false))==NULL )</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1252 </span>            : 
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :     if ( sc!=NULL )</span>
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :         one = sc;</span>
<span class="lineNum">    1255 </span>            :     else
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :         one=SFGetOrMakeChar(sf,unicodeenc,NULL);</span>
<span class="lineNum">    1257 </span>            : 
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :     basech = *pt;</span>
<span class="lineNum">    1259 </span><span class="lineNoCov">          0 :     for ( ; *pt; ++pt ) {</span>
<span class="lineNum">    1260 </span><span class="lineNoCov">          0 :         ch = *pt;</span>
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 :         if ( all!=pt &amp;&amp; isaccent(ch) ) {        /* first glyph is magic and doesn't go through accent processing */</span>
<span class="lineNum">    1262 </span><span class="lineNoCov">          0 :             two = GetGoodAccentGlyph(sf,ch,basech,&amp;invert,sf-&gt;italicangle,dot,one);</span>
<span class="lineNum">    1263 </span><span class="lineNoCov">          0 :         } else if ( !haschar(sf,ch,dot))</span>
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1265 </span>            :         else
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :             two = GetChar(sf,ch,dot);</span>
<span class="lineNum">    1267 </span>            :         /* No recursive references */
<span class="lineNum">    1268 </span>            :         /* Cyrillic gamma could refer to Greek gamma, which the entry gives as an alternate */
<span class="lineNum">    1269 </span><span class="lineNoCov">          0 :         if ( one!=NULL &amp;&amp; (two==NULL || SCDependsOnSC(two,one)) )</span>
<span class="lineNum">    1270 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1271 </span>            :     }
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1273"><span class="lineNum">    1273 </span>            : }</a>
<span class="lineNum">    1274 </span>            : 
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 : int SFIsRotatable(SplineFont *sf,SplineChar *sc) {</span>
<span class="lineNum">    1276 </span>            :     char *end;
<span class="lineNum">    1277 </span>            :     int cid;
<span class="lineNum">    1278 </span>            : 
<span class="lineNum">    1279 </span><span class="lineNoCov">          0 :     if ( sf-&gt;cidmaster!=NULL &amp;&amp; strncmp(sc-&gt;name,&quot;vertcid_&quot;,8)==0 ) {</span>
<span class="lineNum">    1280 </span><span class="lineNoCov">          0 :         cid = strtol(sc-&gt;name+8,&amp;end,10);</span>
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :         if ( *end=='\0' &amp;&amp; SFHasCID(sf,cid)!=-1)</span>
<span class="lineNum">    1282 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 :     } else if ( sf-&gt;cidmaster!=NULL &amp;&amp; strstr(sc-&gt;name,&quot;.vert&quot;)!=NULL &amp;&amp;</span>
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :             (cid = CIDFromName(sc-&gt;name,sf-&gt;cidmaster))!= -1 ) {</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :         if ( SFHasCID(sf,cid)!=-1)</span>
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :     } else if ( strncmp(sc-&gt;name,&quot;vertuni&quot;,7)==0 &amp;&amp; strlen(sc-&gt;name)==11 ) {</span>
<span class="lineNum">    1288 </span><span class="lineNoCov">          0 :         int uni = strtol(sc-&gt;name+7,&amp;end,16);</span>
<span class="lineNum">    1289 </span><span class="lineNoCov">          0 :         if ( *end=='\0' &amp;&amp; SFCIDFindExistingChar(sf,uni,NULL)!=-1 )</span>
<span class="lineNum">    1290 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1291 </span><span class="lineNoCov">          0 :     } else if ( strncmp(sc-&gt;name,&quot;uni&quot;,3)==0 &amp;&amp; strstr(sc-&gt;name,&quot;.vert&quot;)!=NULL ) {</span>
<span class="lineNum">    1292 </span><span class="lineNoCov">          0 :         int uni = strtol(sc-&gt;name+3,&amp;end,16);</span>
<span class="lineNum">    1293 </span><span class="lineNoCov">          0 :         if ( *end=='.' &amp;&amp; SFCIDFindExistingChar(sf,uni,NULL)!=-1 )</span>
<span class="lineNum">    1294 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1295 </span><span class="lineNoCov">          0 :     } else if ( sc-&gt;name[0]=='u' &amp;&amp; strstr(sc-&gt;name,&quot;.vert&quot;)!=NULL ) {</span>
<span class="lineNum">    1296 </span><span class="lineNoCov">          0 :         int uni = strtol(sc-&gt;name+1,&amp;end,16);</span>
<span class="lineNum">    1297 </span><span class="lineNoCov">          0 :         if ( *end=='.' &amp;&amp; SFCIDFindExistingChar(sf,uni,NULL)!=-1 )</span>
<span class="lineNum">    1298 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1299 </span><span class="lineNoCov">          0 :     } else if ( strstr(sc-&gt;name,&quot;.vert&quot;)!=NULL || strstr(sc-&gt;name,&quot;.vrt2&quot;)!=NULL) {</span>
<span class="lineNum">    1300 </span>            :         int ret;
<span class="lineNum">    1301 </span>            :         char *temp;
<span class="lineNum">    1302 </span><span class="lineNoCov">          0 :         end = strchr(sc-&gt;name,'.');</span>
<span class="lineNum">    1303 </span><span class="lineNoCov">          0 :         temp = copyn(sc-&gt;name,end-sc-&gt;name);</span>
<span class="lineNum">    1304 </span><span class="lineNoCov">          0 :         ret = SFFindExistingSlot(sf,-1,temp)!=-1;</span>
<span class="lineNum">    1305 </span><span class="lineNoCov">          0 :         free(temp);</span>
<span class="lineNum">    1306 </span><span class="lineNoCov">          0 : return( ret );</span>
<span class="lineNum">    1307 </span>            :     }
<span class="lineNum">    1308 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="1309"><span class="lineNum">    1309 </span>            : }</a>
<span class="lineNum">    1310 </span>            : 
<span class="lineNum">    1311 </span><span class="lineNoCov">          0 : int hascomposing(SplineFont *sf,int u,SplineChar *sc) {</span>
<span class="lineNum">    1312 </span><span class="lineNoCov">          0 :     const unichar_t *upt = SFGetAlternate(sf,u,sc,false);</span>
<span class="lineNum">    1313 </span>            : 
<span class="lineNum">    1314 </span><span class="lineNoCov">          0 :     if ( upt!=NULL ) {</span>
<span class="lineNum">    1315 </span><span class="lineNoCov">          0 :         while ( *upt ) {</span>
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :             if ( (u==0x13f || u==0x140 ) &amp;&amp; *upt==0xb7 )</span>
<span class="lineNum">    1317 </span><span class="lineNoCov">          0 : return( true ); /* b7, centered dot is used as a combining accent for Ldot */</span>
<span class="lineNum">    1318 </span>            :                 /* It's spacing for ldot (but we want to pretend it's an accent) */
<span class="lineNum">    1319 </span>            :                 /*  and 0x22EF is a ligature of ... */
<span class="lineNum">    1320 </span><span class="lineNoCov">          0 :             else if ( iscombining(*upt) ||</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :                     *upt==0x0384 ||     /* tonos */</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 :                     *upt==0x0385 ||     /* dieresis/tonos */</span>
<span class="lineNum">    1323 </span><span class="lineNoCov">          0 :                     *upt==0x1ffe || *upt==0x1fbf || *upt==0x1fcf || *upt==0x1fdf ||</span>
<span class="lineNum">    1324 </span><span class="lineNoCov">          0 :                     *upt==0x1fbd || *upt==0x1fef || *upt==0x1fc0 || *upt==0x1fc1 ||</span>
<span class="lineNum">    1325 </span><span class="lineNoCov">          0 :                     *upt==0x1fee || *upt==0x1ffd || *upt==0x1fbe || *upt==0x1fed ||</span>
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :                     *upt==0x1fcd || *upt==0x1fdd || *upt==0x1fce || *upt==0x1fde )      /* Special greek accents */</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1328 </span>            :             /* Only build Jongsung out of chosung when doing a build composit */
<span class="lineNum">    1329 </span>            :             /*  not when doing a build accented (that's what the upt[1]!='\0' */
<span class="lineNum">    1330 </span>            :             /*  means */
<span class="lineNum">    1331 </span><span class="lineNoCov">          0 :             if ( *upt&gt;=0x1100 &amp;&amp; *upt&lt;0x11c7 &amp;&amp; upt[1]!='\0' )</span>
<span class="lineNum">    1332 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1333 </span><span class="lineNoCov">          0 :             ++upt;</span>
<span class="lineNum">    1334 </span>            :         }
<span class="lineNum">    1335 </span>            : 
<span class="lineNum">    1336 </span><span class="lineNoCov">          0 :         if ( u&gt;=0x1f70 &amp;&amp; u&lt;0x1f80 )</span>
<span class="lineNum">    1337 </span><span class="lineNoCov">          0 : return( true );                 /* Yes. they do work, I don't care what it looks like */</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">          0 :         if ( u==0x0149 )</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1340 </span>            :     }
<span class="lineNum">    1341 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="1342"><span class="lineNum">    1342 </span>            : }</a>
<span class="lineNum">    1343 </span>            : 
<span class="lineNum">    1344 </span><span class="lineNoCov">          0 : int SFIsSomethingBuildable(SplineFont *sf,SplineChar *sc, int layer, int onlyaccents) {</span>
<span class="lineNum">    1345 </span><span class="lineNoCov">          0 :     int unicodeenc = sc-&gt;unicodeenc;</span>
<span class="lineNum">    1346 </span>            : 
<span class="lineNum">    1347 </span><span class="lineNoCov">          0 :     if ( onlyaccents &amp;&amp;         /* Don't build greek accents out of latin ones */</span>
<span class="lineNum">    1348 </span><span class="lineNoCov">          0 :             (unicodeenc==0x1fbd || unicodeenc==0x1fbe || unicodeenc==0x1fbf ||</span>
<span class="lineNum">    1349 </span><span class="lineNoCov">          0 :              unicodeenc==0x1fef || unicodeenc==0x1ffd || unicodeenc==0x1ffe))</span>
<span class="lineNum">    1350 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1351 </span>            : 
<span class="lineNum">    1352 </span><span class="lineNoCov">          0 :     if ((unicodeenc &lt;= 0xffff &amp;&amp; iszerowidth(unicodeenc)) ||</span>
<span class="lineNum">    1353 </span><span class="lineNoCov">          0 :             (unicodeenc&gt;=0x2000 &amp;&amp; unicodeenc&lt;=0x2015 ))</span>
<span class="lineNum">    1354 </span><span class="lineNoCov">          0 : return( !onlyaccents );</span>
<span class="lineNum">    1355 </span>            : 
<span class="lineNum">    1356 </span><span class="lineNoCov">          0 :     if ( SFIsCompositBuildable(sf,unicodeenc,sc,layer))</span>
<span class="lineNum">    1357 </span><span class="lineNoCov">          0 : return( !onlyaccents || hascomposing(sf,sc-&gt;unicodeenc,sc) );</span>
<span class="lineNum">    1358 </span>            : 
<span class="lineNum">    1359 </span><span class="lineNoCov">          0 :     if ( !onlyaccents &amp;&amp; SCMakeDotless(sf,sc,layer,NULL,false,false))</span>
<span class="lineNum">    1360 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1361 </span>            : 
<span class="lineNum">    1362 </span><span class="lineNoCov">          0 : return( SFIsRotatable(sf,sc));</span>
<a name="1363"><span class="lineNum">    1363 </span>            : }</a>
<span class="lineNum">    1364 </span>            : 
<span class="lineNum">    1365 </span><span class="lineNoCov">          0 : static int SPInRange(SplinePoint *sp, real ymin, real ymax) {</span>
<span class="lineNum">    1366 </span><span class="lineNoCov">          0 : return ( sp-&gt;me.y&gt;=ymin &amp;&amp; sp-&gt;me.y&lt;=ymax );</span>
<a name="1367"><span class="lineNum">    1367 </span>            : }</a>
<span class="lineNum">    1368 </span>            : 
<span class="lineNum">    1369 </span><span class="lineNoCov">          0 : static void _SplineSetFindXRange(SplinePointList *spl, DBounds *bounds,</span>
<span class="lineNum">    1370 </span>            :         real ymin, real ymax, real ia) {
<span class="lineNum">    1371 </span>            :     Spline *spline;
<span class="lineNum">    1372 </span><span class="lineNoCov">          0 :     real xadjust, tia = tan(ia);</span>
<span class="lineNum">    1373 </span>            : 
<span class="lineNum">    1374 </span><span class="lineNoCov">          0 :     for ( ; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">    1375 </span><span class="lineNoCov">          0 :         if ( SPInRange(spl-&gt;first,ymin,ymax) ) {</span>
<span class="lineNum">    1376 </span><span class="lineNoCov">          0 :             xadjust = spl-&gt;first-&gt;me.x + tia*(spl-&gt;first-&gt;me.y-ymin);</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :             if ( bounds-&gt;minx==0 &amp;&amp; bounds-&gt;maxx==0 ) {</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 :                 bounds-&gt;minx = bounds-&gt;maxx = xadjust;</span>
<span class="lineNum">    1379 </span>            :             } else {
<span class="lineNum">    1380 </span><span class="lineNoCov">          0 :                 if ( xadjust&lt;bounds-&gt;minx ) bounds-&gt;minx = xadjust;</span>
<span class="lineNum">    1381 </span><span class="lineNoCov">          0 :                 if ( xadjust&gt;bounds-&gt;maxx ) bounds-&gt;maxx = xadjust;</span>
<span class="lineNum">    1382 </span>            :             }
<span class="lineNum">    1383 </span>            :         }
<span class="lineNum">    1384 </span><span class="lineNoCov">          0 :         for ( spline = spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline-&gt;to!=spl-&gt;first; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1385 </span><span class="lineNoCov">          0 :             if ( SPInRange(spline-&gt;to,ymin,ymax) ) {</span>
<span class="lineNum">    1386 </span><span class="lineNoCov">          0 :             xadjust = spline-&gt;to-&gt;me.x + tia*(spline-&gt;to-&gt;me.y-ymin);</span>
<span class="lineNum">    1387 </span><span class="lineNoCov">          0 :                 if ( bounds-&gt;minx==0 &amp;&amp; bounds-&gt;maxx==0 ) {</span>
<span class="lineNum">    1388 </span><span class="lineNoCov">          0 :                     bounds-&gt;minx = bounds-&gt;maxx = xadjust;</span>
<span class="lineNum">    1389 </span>            :                 } else {
<span class="lineNum">    1390 </span><span class="lineNoCov">          0 :                     if ( xadjust&lt;bounds-&gt;minx ) bounds-&gt;minx = xadjust;</span>
<span class="lineNum">    1391 </span><span class="lineNoCov">          0 :                     if ( xadjust&gt;bounds-&gt;maxx ) bounds-&gt;maxx = xadjust;</span>
<span class="lineNum">    1392 </span>            :                 }
<span class="lineNum">    1393 </span>            :             }
<span class="lineNum">    1394 </span>            :         }
<span class="lineNum">    1395 </span>            :     }
<a name="1396"><span class="lineNum">    1396 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1397 </span>            : 
<span class="lineNum">    1398 </span><span class="lineNoCov">          0 : static real _SplineSetFindXRangeAtYExtremum(SplinePointList *spl, DBounds *bounds,</span>
<span class="lineNum">    1399 </span>            :         int findymax, real yextreme) {
<span class="lineNum">    1400 </span>            :     Spline *spline;
<span class="lineNum">    1401 </span>            :     extended t0, t1, t2, t3;
<span class="lineNum">    1402 </span>            :     bigreal y0, y1, y2, y3, x;
<span class="lineNum">    1403 </span>            : 
<span class="lineNum">    1404 </span><span class="lineNoCov">          0 :     for ( ; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">    1405 </span><span class="lineNoCov">          0 :         for ( spline = spl-&gt;first-&gt;next; spline!=NULL; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1406 </span><span class="lineNoCov">          0 :             if (( findymax &amp;&amp; </span>
<span class="lineNum">    1407 </span><span class="lineNoCov">          0 :                     !(yextreme&gt;spline-&gt;from-&gt;me.y &amp;&amp; yextreme&gt;spline-&gt;from-&gt;nextcp.y &amp;&amp;</span>
<span class="lineNum">    1408 </span><span class="lineNoCov">          0 :                       yextreme&gt;spline-&gt;to-&gt;me.y &amp;&amp; yextreme&gt;spline-&gt;to-&gt;prevcp.y )) ||</span>
<span class="lineNum">    1409 </span><span class="lineNoCov">          0 :                 (!findymax &amp;&amp;</span>
<span class="lineNum">    1410 </span><span class="lineNoCov">          0 :                     !(yextreme&lt;spline-&gt;from-&gt;me.y &amp;&amp; yextreme&lt;spline-&gt;from-&gt;nextcp.y &amp;&amp;</span>
<span class="lineNum">    1411 </span><span class="lineNoCov">          0 :                       yextreme&lt;spline-&gt;to-&gt;me.y &amp;&amp; yextreme&lt;spline-&gt;to-&gt;prevcp.y )) ) {</span>
<span class="lineNum">    1412 </span>            :                 /* Ok this spline might be bigger(less) than our current */
<span class="lineNum">    1413 </span>            :                 /*  extreme value, so check it */
<span class="lineNum">    1414 </span><span class="lineNoCov">          0 :                 SplineFindExtrema(&amp;spline-&gt;splines[1],&amp;t1,&amp;t2);</span>
<span class="lineNum">    1415 </span><span class="lineNoCov">          0 :                 y0 = spline-&gt;from-&gt;me.y; t0 = 0;</span>
<span class="lineNum">    1416 </span><span class="lineNoCov">          0 :                 y3 = spline-&gt;to-&gt;me.y; t3 = 1;</span>
<span class="lineNum">    1417 </span><span class="lineNoCov">          0 :                 if ( t1!=-1 ) {</span>
<span class="lineNum">    1418 </span><span class="lineNoCov">          0 :                     y1 = ((spline-&gt;splines[1].a*t1+spline-&gt;splines[1].b)*t1+spline-&gt;splines[1].c)*t1+spline-&gt;splines[1].d;</span>
<span class="lineNum">    1419 </span><span class="lineNoCov">          0 :                     if ( y1&gt;y0 ) { y0 = y1; t0 = t1; }</span>
<span class="lineNum">    1420 </span>            :                 }
<span class="lineNum">    1421 </span><span class="lineNoCov">          0 :                 if ( t2!=-1 ) {</span>
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 :                     y2 = ((spline-&gt;splines[1].a*t2+spline-&gt;splines[1].b)*t2+spline-&gt;splines[1].c)*t2+spline-&gt;splines[1].d;</span>
<span class="lineNum">    1423 </span><span class="lineNoCov">          0 :                     if ( y2&gt;y3 ) { y3 = y2; t3 = t2; }</span>
<span class="lineNum">    1424 </span>            :                 }
<span class="lineNum">    1425 </span><span class="lineNoCov">          0 :                 if ( (findymax &amp;&amp; y0&gt;yextreme+.1) || (!findymax &amp;&amp; y0&lt;yextreme-.1) ) {</span>
<span class="lineNum">    1426 </span><span class="lineNoCov">          0 :                     bounds-&gt;miny = bounds-&gt;maxy = yextreme = y0;</span>
<span class="lineNum">    1427 </span><span class="lineNoCov">          0 :                     bounds-&gt;minx = bounds-&gt;maxx =</span>
<span class="lineNum">    1428 </span><span class="lineNoCov">          0 :                             ((spline-&gt;splines[0].a*t0+spline-&gt;splines[0].b)*t0+spline-&gt;splines[0].c)*t0+spline-&gt;splines[0].d;</span>
<span class="lineNum">    1429 </span><span class="lineNoCov">          0 :                 } else if ( (findymax &amp;&amp; y0&gt;=yextreme-.1) || (!findymax &amp;&amp; y0&lt;=yextreme+1) ) {</span>
<span class="lineNum">    1430 </span><span class="lineNoCov">          0 :                     x = ((spline-&gt;splines[0].a*t0+spline-&gt;splines[0].b)*t0+spline-&gt;splines[0].c)*t0+spline-&gt;splines[0].d;</span>
<span class="lineNum">    1431 </span><span class="lineNoCov">          0 :                     if ( x&gt;bounds-&gt;maxx ) bounds-&gt;maxx = x;</span>
<span class="lineNum">    1432 </span><span class="lineNoCov">          0 :                     else if ( x&lt;bounds-&gt;minx ) bounds-&gt;minx = x;</span>
<span class="lineNum">    1433 </span>            :                 }
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :                 if ( (findymax &amp;&amp; y3&gt;yextreme+.1) || (!findymax &amp;&amp; y3&lt;yextreme-.1) ) {</span>
<span class="lineNum">    1435 </span><span class="lineNoCov">          0 :                     bounds-&gt;miny = bounds-&gt;maxy = yextreme = y3;</span>
<span class="lineNum">    1436 </span><span class="lineNoCov">          0 :                     bounds-&gt;minx = bounds-&gt;maxx =</span>
<span class="lineNum">    1437 </span><span class="lineNoCov">          0 :                             ((spline-&gt;splines[0].a*t3+spline-&gt;splines[0].b)*t3+spline-&gt;splines[0].c)*t3+spline-&gt;splines[0].d;</span>
<span class="lineNum">    1438 </span><span class="lineNoCov">          0 :                 } else if ( (findymax &amp;&amp; y3&gt;=yextreme-.1) || (!findymax &amp;&amp; y3&lt;=yextreme+1) ) {</span>
<span class="lineNum">    1439 </span><span class="lineNoCov">          0 :                     x = ((spline-&gt;splines[0].a*t3+spline-&gt;splines[0].b)*t3+spline-&gt;splines[0].c)*t3+spline-&gt;splines[0].d;</span>
<span class="lineNum">    1440 </span><span class="lineNoCov">          0 :                     if ( x&gt;bounds-&gt;maxx ) bounds-&gt;maxx = x;</span>
<span class="lineNum">    1441 </span><span class="lineNoCov">          0 :                     else if ( x&lt;bounds-&gt;minx ) bounds-&gt;minx = x;</span>
<span class="lineNum">    1442 </span>            :                 }
<span class="lineNum">    1443 </span>            :             }
<span class="lineNum">    1444 </span><span class="lineNoCov">          0 :             if ( spline-&gt;to == spl-&gt;first )</span>
<span class="lineNum">    1445 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1446 </span>            :         }
<span class="lineNum">    1447 </span>            :     }
<span class="lineNum">    1448 </span><span class="lineNoCov">          0 : return( yextreme );</span>
<span class="lineNum">    1449 </span>            : }
<span class="lineNum">    1450 </span>            : 
<span class="lineNum">    1451 </span>            : /* this is called by the accented character routines with bounds set for the */
<span class="lineNum">    1452 </span>            : /*  entire character. Our job is to make a guess at what the top of the */
<span class="lineNum">    1453 </span>            : /*  character looks like so that we can do an optical accent placement */
<a name="1454"><span class="lineNum">    1454 </span>            : /* I currently think the best bet is to find the very highest point(s) and */</a>
<span class="lineNum">    1455 </span>            : /*  center on that. I used to find the bounds of the top quarter of the char */
<span class="lineNum">    1456 </span><span class="lineNoCov">          0 : static real SCFindTopXRange(SplineChar *sc,int layer,DBounds *bounds) {</span>
<span class="lineNum">    1457 </span>            :     RefChar *rf;
<span class="lineNum">    1458 </span><span class="lineNoCov">          0 :     real yextreme = -0x80000;</span>
<span class="lineNum">    1459 </span>            : 
<span class="lineNum">    1460 </span>            :     /* a char with no splines (ie. a space) must have an lbearing of 0 */
<span class="lineNum">    1461 </span><span class="lineNoCov">          0 :     bounds-&gt;minx = bounds-&gt;maxx = 0;</span>
<span class="lineNum">    1462 </span>            : 
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 :     for ( rf=sc-&gt;layers[layer].refs; rf!=NULL; rf = rf-&gt;next )</span>
<span class="lineNum">    1464 </span><span class="lineNoCov">          0 :         yextreme = _SplineSetFindXRangeAtYExtremum(rf-&gt;layers[0].splines,bounds,true,yextreme);</span>
<span class="lineNum">    1465 </span>            : 
<span class="lineNum">    1466 </span><span class="lineNoCov">          0 :     yextreme = _SplineSetFindXRangeAtYExtremum(sc-&gt;layers[layer].splines,bounds,true,yextreme);</span>
<span class="lineNum">    1467 </span><span class="lineNoCov">          0 :     if ( yextreme == -0x80000 ) yextreme = 0;</span>
<span class="lineNum">    1468 </span><span class="lineNoCov">          0 : return( yextreme );</span>
<a name="1469"><span class="lineNum">    1469 </span>            : }</a>
<span class="lineNum">    1470 </span>            : 
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 : static real SCFindBottomXRange(SplineChar *sc,int layer,DBounds *bounds, real ia) {</span>
<span class="lineNum">    1472 </span>            :     RefChar *rf;
<span class="lineNum">    1473 </span><span class="lineNoCov">          0 :     real yextreme = 0x80000;</span>
<span class="lineNum">    1474 </span>            : 
<span class="lineNum">    1475 </span>            :     /* a char with no splines (ie. a space) must have an lbearing of 0 */
<span class="lineNum">    1476 </span><span class="lineNoCov">          0 :     bounds-&gt;minx = bounds-&gt;maxx = 0;</span>
<span class="lineNum">    1477 </span>            : 
<span class="lineNum">    1478 </span><span class="lineNoCov">          0 :     for ( rf=sc-&gt;layers[layer].refs; rf!=NULL; rf = rf-&gt;next )</span>
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 :         yextreme = _SplineSetFindXRangeAtYExtremum(rf-&gt;layers[0].splines,bounds,false,yextreme);</span>
<span class="lineNum">    1480 </span>            : 
<span class="lineNum">    1481 </span><span class="lineNoCov">          0 :     yextreme = _SplineSetFindXRangeAtYExtremum(sc-&gt;layers[layer].splines,bounds,false,yextreme);</span>
<span class="lineNum">    1482 </span><span class="lineNoCov">          0 :     if ( yextreme == 0x80000 ) yextreme = 0;</span>
<span class="lineNum">    1483 </span><span class="lineNoCov">          0 : return( yextreme );</span>
<span class="lineNum">    1484 </span>            : }
<span class="lineNum">    1485 </span>            : 
<a name="1486"><span class="lineNum">    1486 </span>            : /* the cedilla and ogonec accents do not center on the accent itself but on */</a>
<span class="lineNum">    1487 </span>            : /*  the small part of it that joins at the top */
<span class="lineNum">    1488 </span><span class="lineNoCov">          0 : static real SCFindTopBounds(SplineChar *sc,int layer,DBounds *bounds, real ia) {</span>
<span class="lineNum">    1489 </span>            :     RefChar *rf;
<span class="lineNum">    1490 </span><span class="lineNoCov">          0 :     int ymax = bounds-&gt;maxy+1, ymin = ymax-(bounds-&gt;maxy-bounds-&gt;miny)/20;</span>
<span class="lineNum">    1491 </span>            : 
<span class="lineNum">    1492 </span>            :     /* a char with no splines (ie. a space) must have an lbearing of 0 */
<span class="lineNum">    1493 </span><span class="lineNoCov">          0 :     bounds-&gt;minx = bounds-&gt;maxx = 0;</span>
<span class="lineNum">    1494 </span>            : 
<span class="lineNum">    1495 </span><span class="lineNoCov">          0 :     for ( rf=sc-&gt;layers[layer].refs; rf!=NULL; rf = rf-&gt;next )</span>
<span class="lineNum">    1496 </span><span class="lineNoCov">          0 :         _SplineSetFindXRange(rf-&gt;layers[0].splines,bounds,ymin,ymax,ia);</span>
<span class="lineNum">    1497 </span>            : 
<span class="lineNum">    1498 </span><span class="lineNoCov">          0 :     _SplineSetFindXRange(sc-&gt;layers[layer].splines,bounds,ymin,ymax,ia);</span>
<span class="lineNum">    1499 </span><span class="lineNoCov">          0 : return( ymin );</span>
<span class="lineNum">    1500 </span>            : }
<a name="1501"><span class="lineNum">    1501 </span>            : </a>
<span class="lineNum">    1502 </span>            : /* And similarly for the floating hook, and often for grave and acute */
<span class="lineNum">    1503 </span><span class="lineNoCov">          0 : static real SCFindBottomBounds(SplineChar *sc,int layer,DBounds *bounds, real ia) {</span>
<span class="lineNum">    1504 </span>            :     RefChar *rf;
<span class="lineNum">    1505 </span><span class="lineNoCov">          0 :     int ymin = bounds-&gt;miny-1, ymax = ymin+(bounds-&gt;maxy-bounds-&gt;miny)/20;</span>
<span class="lineNum">    1506 </span>            : 
<span class="lineNum">    1507 </span>            :     /* a char with no splines (ie. a space) must have an lbearing of 0 */
<span class="lineNum">    1508 </span><span class="lineNoCov">          0 :     bounds-&gt;minx = bounds-&gt;maxx = 0;</span>
<span class="lineNum">    1509 </span>            : 
<span class="lineNum">    1510 </span><span class="lineNoCov">          0 :     for ( rf=sc-&gt;layers[layer].refs; rf!=NULL; rf = rf-&gt;next )</span>
<span class="lineNum">    1511 </span><span class="lineNoCov">          0 :         _SplineSetFindXRange(rf-&gt;layers[0].splines,bounds,ymin,ymax,ia);</span>
<span class="lineNum">    1512 </span>            : 
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 :     _SplineSetFindXRange(sc-&gt;layers[layer].splines,bounds,ymin,ymax,ia);</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">          0 : return( ymin );</span>
<a name="1515"><span class="lineNum">    1515 </span>            : }</a>
<span class="lineNum">    1516 </span>            : 
<span class="lineNum">    1517 </span><span class="lineNoCov">          0 : static real SplineCharFindSlantedBounds(SplineChar *sc,int layer,DBounds *bounds, real ia) {</span>
<span class="lineNum">    1518 </span>            :     int ymin, ymax;
<span class="lineNum">    1519 </span>            :     RefChar *rf;
<span class="lineNum">    1520 </span>            : 
<span class="lineNum">    1521 </span><span class="lineNoCov">          0 :     SplineCharFindBounds(sc,bounds);</span>
<span class="lineNum">    1522 </span>            : 
<span class="lineNum">    1523 </span><span class="lineNoCov">          0 :     ymin = bounds-&gt;miny-1, ymax = bounds-&gt;maxy+1;</span>
<span class="lineNum">    1524 </span>            : 
<span class="lineNum">    1525 </span><span class="lineNoCov">          0 :     if ( ia!=0 ) {</span>
<span class="lineNum">    1526 </span><span class="lineNoCov">          0 :         bounds-&gt;minx = bounds-&gt;maxx = 0;</span>
<span class="lineNum">    1527 </span>            : 
<span class="lineNum">    1528 </span><span class="lineNoCov">          0 :         for ( rf=sc-&gt;layers[layer].refs; rf!=NULL; rf = rf-&gt;next )</span>
<span class="lineNum">    1529 </span><span class="lineNoCov">          0 :             _SplineSetFindXRange(rf-&gt;layers[0].splines,bounds,ymin,ymax,ia);</span>
<span class="lineNum">    1530 </span>            : 
<span class="lineNum">    1531 </span><span class="lineNoCov">          0 :         _SplineSetFindXRange(sc-&gt;layers[layer].splines,bounds,ymin,ymax,ia);</span>
<span class="lineNum">    1532 </span>            :     }
<span class="lineNum">    1533 </span><span class="lineNoCov">          0 : return( ymin );</span>
<a name="1534"><span class="lineNum">    1534 </span>            : }</a>
<span class="lineNum">    1535 </span>            : 
<span class="lineNum">    1536 </span><span class="lineNoCov">          0 : static int SCStemCheck(SplineFont *sf,int layer,int basech,DBounds *bb, DBounds *rbb,int pos) {</span>
<span class="lineNum">    1537 </span>            :     /* cedilla (and ogonec on A) should be centered underneath the left */
<span class="lineNum">    1538 </span>            :     /*  (or right) vertical (or diagonal) stem. Here we try to find that */
<span class="lineNum">    1539 </span>            :     /*  stem */
<span class="lineNum">    1540 </span>            :     StemInfo *h, *best;
<span class="lineNum">    1541 </span>            :     SplineChar *sc;
<span class="lineNum">    1542 </span>            :     DStemInfo *d;
<span class="lineNum">    1543 </span>            : 
<span class="lineNum">    1544 </span><span class="lineNoCov">          0 :     sc = SFGetChar(sf,basech,NULL);</span>
<span class="lineNum">    1545 </span><span class="lineNoCov">          0 :     if ( sc==NULL )</span>
<span class="lineNum">    1546 </span><span class="lineNoCov">          0 : return( 0x70000000 );</span>
<span class="lineNum">    1547 </span><span class="lineNoCov">          0 :     if ( autohint_before_generate &amp;&amp; sc-&gt;changedsincelasthinted &amp;&amp; !sc-&gt;manualhints )</span>
<span class="lineNum">    1548 </span><span class="lineNoCov">          0 :         SplineCharAutoHint(sc,layer,NULL);</span>
<span class="lineNum">    1549 </span><span class="lineNoCov">          0 :     if ( (best=sc-&gt;vstem)!=NULL ) {</span>
<span class="lineNum">    1550 </span><span class="lineNoCov">          0 :         if ( pos &amp; FF_UNICODE_CENTERLEFT ) {</span>
<span class="lineNum">    1551 </span><span class="lineNoCov">          0 :             for ( h=best-&gt;next; h!=NULL &amp;&amp; h-&gt;start&lt;best-&gt;start+best-&gt;width; h=h-&gt;next )</span>
<span class="lineNum">    1552 </span><span class="lineNoCov">          0 :                 if ( h-&gt;start+h-&gt;width&lt;best-&gt;start+best-&gt;width )</span>
<span class="lineNum">    1553 </span><span class="lineNoCov">          0 :                     best = h;</span>
<span class="lineNum">    1554 </span><span class="lineNoCov">          0 :             if ( best-&gt;start+best-&gt;width/2&gt;(bb-&gt;maxx+bb-&gt;minx)/2 )</span>
<span class="lineNum">    1555 </span><span class="lineNoCov">          0 :                 best = NULL;</span>
<span class="lineNum">    1556 </span><span class="lineNoCov">          0 :         } else if ( pos &amp; FF_UNICODE_CENTERRIGHT ) {</span>
<span class="lineNum">    1557 </span><span class="lineNoCov">          0 :             while ( best-&gt;next!=NULL )</span>
<span class="lineNum">    1558 </span><span class="lineNoCov">          0 :                 best = best-&gt;next;</span>
<span class="lineNum">    1559 </span><span class="lineNoCov">          0 :             if ( best-&gt;start+best-&gt;width/2&lt;(bb-&gt;maxx+bb-&gt;minx)/2 )</span>
<span class="lineNum">    1560 </span><span class="lineNoCov">          0 :                 best = NULL;</span>
<span class="lineNum">    1561 </span>            :         } else {
<span class="lineNum">    1562 </span><span class="lineNoCov">          0 :             for ( h=best-&gt;next; h!=NULL ; h=h-&gt;next )</span>
<span class="lineNum">    1563 </span><span class="lineNoCov">          0 :                 if ( HIlen(h)&gt;HIlen(best))</span>
<span class="lineNum">    1564 </span><span class="lineNoCov">          0 :                     best = h;</span>
<span class="lineNum">    1565 </span>            :         }
<span class="lineNum">    1566 </span><span class="lineNoCov">          0 :         if ( best!=NULL )</span>
<span class="lineNum">    1567 </span><span class="lineNoCov">          0 : return( best-&gt;start + best-&gt;width/2 - (rbb-&gt;maxx-rbb-&gt;minx)/2 - rbb-&gt;minx );</span>
<span class="lineNum">    1568 </span>            :     }
<span class="lineNum">    1569 </span><span class="lineNoCov">          0 :     if ( sc-&gt;dstem != NULL ) {</span>
<span class="lineNum">    1570 </span>            :         double himin, himax, hibase, roff, temp;
<span class="lineNum">    1571 </span><span class="lineNoCov">          0 :         double lbx = 0, rbx = 0, lbxtest, rbxtest;</span>
<span class="lineNum">    1572 </span>            :         HintInstance *hi;
<span class="lineNum">    1573 </span><span class="lineNoCov">          0 :         for ( d=sc-&gt;dstem; d!=NULL ; d=d-&gt;next ) {</span>
<span class="lineNum">    1574 </span><span class="lineNoCov">          0 :             if ( d-&gt;where == NULL )</span>
<span class="lineNum">    1575 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    1576 </span><span class="lineNoCov">          0 :             if ( d-&gt;where-&gt;begin &lt; d-&gt;where-&gt;end ) {</span>
<span class="lineNum">    1577 </span><span class="lineNoCov">          0 :                 himin = d-&gt;where-&gt;begin;</span>
<span class="lineNum">    1578 </span><span class="lineNoCov">          0 :                 himax = d-&gt;where-&gt;end;</span>
<span class="lineNum">    1579 </span>            :             } else {
<span class="lineNum">    1580 </span><span class="lineNoCov">          0 :                 himin = d-&gt;where-&gt;end;</span>
<span class="lineNum">    1581 </span><span class="lineNoCov">          0 :                 himax = d-&gt;where-&gt;begin;</span>
<span class="lineNum">    1582 </span>            :             }
<span class="lineNum">    1583 </span><span class="lineNoCov">          0 :             for ( hi=d-&gt;where-&gt;next; hi!=NULL; hi=hi-&gt;next ) {</span>
<span class="lineNum">    1584 </span><span class="lineNoCov">          0 :                 if ( hi-&gt;begin &lt; himin ) himin = hi-&gt;begin;</span>
<span class="lineNum">    1585 </span><span class="lineNoCov">          0 :                 if ( hi-&gt;end &lt; himin ) himin = hi-&gt;end;</span>
<span class="lineNum">    1586 </span><span class="lineNoCov">          0 :                 if ( hi-&gt;end &gt; himax ) himax = hi-&gt;end;</span>
<span class="lineNum">    1587 </span><span class="lineNoCov">          0 :                 if ( hi-&gt;begin &gt; himax ) himax = hi-&gt;begin;</span>
<span class="lineNum">    1588 </span>            :             }
<span class="lineNum">    1589 </span><span class="lineNoCov">          0 :             hibase = ( d-&gt;unit.y &gt; 0 ) ? himin : himax;</span>
<span class="lineNum">    1590 </span><span class="lineNoCov">          0 :             roff =  ( d-&gt;right.x - d-&gt;left.x ) * d-&gt;unit.x + </span>
<span class="lineNum">    1591 </span><span class="lineNoCov">          0 :                     ( d-&gt;right.y - d-&gt;left.y ) * d-&gt;unit.y;</span>
<span class="lineNum">    1592 </span><span class="lineNoCov">          0 :             lbxtest = d-&gt;left.x + d-&gt;unit.x * hibase;</span>
<span class="lineNum">    1593 </span><span class="lineNoCov">          0 :             rbxtest = d-&gt;right.x + d-&gt;unit.x * ( hibase - roff );</span>
<span class="lineNum">    1594 </span><span class="lineNoCov">          0 :             if ( rbxtest &lt; lbxtest ) {</span>
<span class="lineNum">    1595 </span><span class="lineNoCov">          0 :                 temp = rbxtest; rbxtest = lbxtest; lbxtest = temp;</span>
<span class="lineNum">    1596 </span>            :             }
<span class="lineNum">    1597 </span><span class="lineNoCov">          0 :             if ( d == sc-&gt;dstem ||</span>
<span class="lineNum">    1598 </span><span class="lineNoCov">          0 :                 ( ( pos &amp; FF_UNICODE_CENTERLEFT ) &amp;&amp; rbxtest &lt; rbx ) ||</span>
<span class="lineNum">    1599 </span><span class="lineNoCov">          0 :                 ( ( pos &amp; FF_UNICODE_CENTERRIGHT ) &amp;&amp; lbxtest &gt; lbx ) ) {</span>
<span class="lineNum">    1600 </span><span class="lineNoCov">          0 :                 lbx = lbxtest; rbx = rbxtest;</span>
<span class="lineNum">    1601 </span>            :             }
<span class="lineNum">    1602 </span>            :         }
<span class="lineNum">    1603 </span><span class="lineNoCov">          0 :         if ( lbx &lt; rbx &amp;&amp; (</span>
<span class="lineNum">    1604 </span><span class="lineNoCov">          0 :             ( ( pos &amp; FF_UNICODE_CENTERLEFT ) &amp;&amp;</span>
<span class="lineNum">    1605 </span><span class="lineNoCov">          0 :             ( lbx + rbx )/2 &lt;= ( bb-&gt;maxx + bb-&gt;minx )/2 ) ||</span>
<span class="lineNum">    1606 </span><span class="lineNoCov">          0 :             ( ( pos &amp; FF_UNICODE_CENTERRIGHT ) &amp;&amp;</span>
<span class="lineNum">    1607 </span><span class="lineNoCov">          0 :             ( lbx + rbx )/2 &gt;= ( bb-&gt;maxx + bb-&gt;minx )/2 )))</span>
<span class="lineNum">    1608 </span><span class="lineNoCov">          0 : return(( lbx + rbx )/2 - ( rbb-&gt;maxx - rbb-&gt;minx )/2 - rbb-&gt;minx );</span>
<span class="lineNum">    1609 </span>            :     }
<span class="lineNum">    1610 </span><span class="lineNoCov">          0 : return( 0x70000000 );</span>
<a name="1611"><span class="lineNum">    1611 </span>            : }</a>
<span class="lineNum">    1612 </span>            : 
<span class="lineNum">    1613 </span><span class="lineNoCov">          0 : void _SCAddRef(SplineChar *sc,SplineChar *rsc,int layer,real transform[6]) {</span>
<span class="lineNum">    1614 </span><span class="lineNoCov">          0 :     RefChar *ref = RefCharCreate();</span>
<span class="lineNum">    1615 </span>            : 
<span class="lineNum">    1616 </span><span class="lineNoCov">          0 :     ref-&gt;sc = rsc;</span>
<span class="lineNum">    1617 </span><span class="lineNoCov">          0 :     ref-&gt;unicode_enc = rsc-&gt;unicodeenc;</span>
<span class="lineNum">    1618 </span><span class="lineNoCov">          0 :     ref-&gt;orig_pos = rsc-&gt;orig_pos;</span>
<span class="lineNum">    1619 </span><span class="lineNoCov">          0 :     ref-&gt;adobe_enc = getAdobeEnc(rsc-&gt;name);</span>
<span class="lineNum">    1620 </span><span class="lineNoCov">          0 :     ref-&gt;next = sc-&gt;layers[layer].refs;</span>
<span class="lineNum">    1621 </span><span class="lineNoCov">          0 :     sc-&gt;layers[layer].refs = ref;</span>
<span class="lineNum">    1622 </span><span class="lineNoCov">          0 :     memcpy(ref-&gt;transform,transform,sizeof(real [6]));</span>
<span class="lineNum">    1623 </span><span class="lineNoCov">          0 :     SCReinstanciateRefChar(sc,ref,layer);</span>
<span class="lineNum">    1624 </span><span class="lineNoCov">          0 :     SCMakeDependent(sc,rsc);</span>
<a name="1625"><span class="lineNum">    1625 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1626 </span>            : 
<span class="lineNum">    1627 </span><span class="lineNoCov">          0 : void SCAddRef(SplineChar *sc,SplineChar *rsc,int layer, real xoff, real yoff) {</span>
<span class="lineNum">    1628 </span>            :     real transform[6];
<span class="lineNum">    1629 </span><span class="lineNoCov">          0 :     transform[0] = transform[3] = 1;</span>
<span class="lineNum">    1630 </span><span class="lineNoCov">          0 :     transform[1] = transform[2] = 0;</span>
<span class="lineNum">    1631 </span><span class="lineNoCov">          0 :     transform[4] = xoff; transform[5] = yoff;</span>
<span class="lineNum">    1632 </span><span class="lineNoCov">          0 :     _SCAddRef(sc,rsc,layer,transform);</span>
<a name="1633"><span class="lineNum">    1633 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1634 </span>            : 
<span class="lineNum">    1635 </span><span class="lineNoCov">          0 : static void BCClearAndCopyBelow(BDFFont *bdf,int togid,int fromgid, int ymax) {</span>
<span class="lineNum">    1636 </span>            :     BDFChar *bc, *rbc;
<span class="lineNum">    1637 </span>            : 
<span class="lineNum">    1638 </span><span class="lineNoCov">          0 :     bc = BDFMakeGID(bdf,togid);</span>
<span class="lineNum">    1639 </span><span class="lineNoCov">          0 :     BCPreserveState(bc);</span>
<span class="lineNum">    1640 </span><span class="lineNoCov">          0 :     BCFlattenFloat(bc);</span>
<span class="lineNum">    1641 </span><span class="lineNoCov">          0 :     BCCompressBitmap(bc);</span>
<span class="lineNum">    1642 </span><span class="lineNoCov">          0 :     if ( bdf-&gt;glyphs[fromgid]!=NULL ) {</span>
<span class="lineNum">    1643 </span><span class="lineNoCov">          0 :         rbc = bdf-&gt;glyphs[fromgid];</span>
<span class="lineNum">    1644 </span><span class="lineNoCov">          0 :         free(bc-&gt;bitmap);</span>
<span class="lineNum">    1645 </span><span class="lineNoCov">          0 :         bc-&gt;xmin = rbc-&gt;xmin;</span>
<span class="lineNum">    1646 </span><span class="lineNoCov">          0 :         bc-&gt;xmax = rbc-&gt;xmax;</span>
<span class="lineNum">    1647 </span><span class="lineNoCov">          0 :         bc-&gt;ymin = rbc-&gt;ymin;</span>
<span class="lineNum">    1648 </span><span class="lineNoCov">          0 :         bc-&gt;ymax = ymax;</span>
<span class="lineNum">    1649 </span><span class="lineNoCov">          0 :         bc-&gt;bytes_per_line = rbc-&gt;bytes_per_line;</span>
<span class="lineNum">    1650 </span><span class="lineNoCov">          0 :         bc-&gt;width = rbc-&gt;width;</span>
<span class="lineNum">    1651 </span><span class="lineNoCov">          0 :         bc-&gt;bitmap = malloc(bc-&gt;bytes_per_line*(bc-&gt;ymax-bc-&gt;ymin+1));</span>
<span class="lineNum">    1652 </span><span class="lineNoCov">          0 :         memcpy(bc-&gt;bitmap,rbc-&gt;bitmap+(rbc-&gt;ymax-ymax)*rbc-&gt;bytes_per_line,</span>
<span class="lineNum">    1653 </span><span class="lineNoCov">          0 :                 bc-&gt;bytes_per_line*(bc-&gt;ymax-bc-&gt;ymin+1));</span>
<span class="lineNum">    1654 </span>            :     }
<a name="1655"><span class="lineNum">    1655 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1656 </span>            : 
<span class="lineNum">    1657 </span><span class="lineNoCov">          0 : static void BCAddReference( BDFChar *bc,BDFChar *rbc,int gid,int xoff,int yoff ) {</span>
<span class="lineNum">    1658 </span>            :     BDFRefChar *bcref;
<span class="lineNum">    1659 </span>            : 
<span class="lineNum">    1660 </span><span class="lineNoCov">          0 :     bcref = calloc( 1,sizeof( BDFRefChar ));</span>
<span class="lineNum">    1661 </span><span class="lineNoCov">          0 :     bcref-&gt;bdfc = rbc; bcref-&gt;gid = gid;</span>
<span class="lineNum">    1662 </span><span class="lineNoCov">          0 :     bcref-&gt;xoff = xoff; bcref-&gt;yoff = yoff;</span>
<span class="lineNum">    1663 </span><span class="lineNoCov">          0 :     bcref-&gt;next = bc-&gt;refs; bc-&gt;refs = bcref;</span>
<span class="lineNum">    1664 </span><span class="lineNoCov">          0 :     BCMakeDependent( bc,rbc );</span>
<a name="1665"><span class="lineNum">    1665 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1666 </span>            : 
<span class="lineNum">    1667 </span><span class="lineNoCov">          0 : static int BCFindGap(BDFChar *bc) {</span>
<span class="lineNum">    1668 </span>            :     int i,y;
<span class="lineNum">    1669 </span>            : 
<span class="lineNum">    1670 </span><span class="lineNoCov">          0 :     BCFlattenFloat(bc);</span>
<span class="lineNum">    1671 </span><span class="lineNoCov">          0 :     BCCompressBitmap(bc);</span>
<span class="lineNum">    1672 </span><span class="lineNoCov">          0 :     for ( y=bc-&gt;ymax; y&gt;=bc-&gt;ymin; --y ) {</span>
<span class="lineNum">    1673 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;bc-&gt;bytes_per_line; ++i )</span>
<span class="lineNum">    1674 </span><span class="lineNoCov">          0 :             if ( bc-&gt;bitmap[(bc-&gt;ymax-y)*bc-&gt;bytes_per_line+i]!=0 )</span>
<span class="lineNum">    1675 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1676 </span><span class="lineNoCov">          0 :         if ( i==bc-&gt;bytes_per_line )</span>
<span class="lineNum">    1677 </span><span class="lineNoCov">          0 : return( y );</span>
<span class="lineNum">    1678 </span>            :     }
<span class="lineNum">    1679 </span><span class="lineNoCov">          0 : return( bc-&gt;ymax );</span>
<a name="1680"><span class="lineNum">    1680 </span>            : }</a>
<span class="lineNum">    1681 </span>            : 
<span class="lineNum">    1682 </span><span class="lineNoCov">          0 : static int SCMakeBaseReference(SplineChar *sc,SplineFont *sf,int layer,int ch, BDFFont *bdf,int disp_only) {</span>
<span class="lineNum">    1683 </span>            :     SplineChar *rsc;
<span class="lineNum">    1684 </span>            :     BDFChar *bc;
<span class="lineNum">    1685 </span>            :     char *dot;
<span class="lineNum">    1686 </span>            :     char buffer[200], namebuf[200];
<span class="lineNum">    1687 </span>            : 
<span class="lineNum">    1688 </span><span class="lineNoCov">          0 :     if ( (dot = strchr(sc-&gt;name,'.'))!=NULL ) {</span>
<span class="lineNum">    1689 </span><span class="lineNoCov">          0 :         snprintf(buffer,sizeof(buffer),&quot;%s%s&quot;,</span>
<span class="lineNum">    1690 </span><span class="lineNoCov">          0 :                 (char *) StdGlyphName(namebuf,ch,sf-&gt;uni_interp,sf-&gt;for_new_glyphs),</span>
<span class="lineNum">    1691 </span>            :                 dot);
<span class="lineNum">    1692 </span><span class="lineNoCov">          0 :         rsc = SFGetChar(sf,-1,buffer);</span>
<span class="lineNum">    1693 </span>            :     } else
<span class="lineNum">    1694 </span><span class="lineNoCov">          0 :         rsc = SFGetChar(sf,ch,NULL);</span>
<span class="lineNum">    1695 </span>            : 
<span class="lineNum">    1696 </span><span class="lineNoCov">          0 :     if ( rsc==NULL &amp;&amp; dot==NULL ) {</span>
<span class="lineNum">    1697 </span><span class="lineNoCov">          0 :         if ( ch==0x131 || ch==0xf6be || ch==0x237) {</span>
<span class="lineNum">    1698 </span><span class="lineNoCov">          0 :             if ( ch==0x131 ) ch='i'; else ch = 'j';</span>
<span class="lineNum">    1699 </span><span class="lineNoCov">          0 :             rsc = SFGetChar(sf,ch,NULL);</span>
<span class="lineNum">    1700 </span><span class="lineNoCov">          0 :             if ( rsc!=NULL &amp;&amp; !sf-&gt;dotlesswarn ) {</span>
<span class="lineNum">    1701 </span>            : /* GT: the string &quot;dotlessi&quot; is the official postscript name for the glyph */
<span class="lineNum">    1702 </span>            : /* GT: containing an &quot;i&quot; without a dot on top of it. The name &quot;dotlessi&quot; */
<span class="lineNum">    1703 </span>            : /* GT: should be left untranslated, though you may wish to explain what it */
<span class="lineNum">    1704 </span>            : /* GT: means */
<span class="lineNum">    1705 </span><span class="lineNoCov">          0 :                 ff_post_error( _(&quot;Missing Glyph...&quot;),ch=='i'?_(&quot;Your font is missing the dotlessi glyph,\nplease add it and remake your accented glyphs&quot;):</span>
<span class="lineNum">    1706 </span>            : /* GT: Adobe decided that a dotless j glyph was needed, assigned a code */
<span class="lineNum">    1707 </span>            : /* GT: point to it in the private use area, and named it &quot;dotlessj&quot;. Then */
<span class="lineNum">    1708 </span>            : /* GT: years later the Unicode people decided one was needed and assigned */
<span class="lineNum">    1709 </span>            : /* GT: it U+0237, so that's now the official code point and it is named */
<span class="lineNum">    1710 </span>            : /* GT: &quot;uni0237&quot;. The name &quot;dotlessj&quot; is deprecated but still present in */
<span class="lineNum">    1711 </span>            : /* GT: many fonts. Neither &quot;dotlessj&quot; nor &quot;uni0237&quot; should be translated */
<span class="lineNum">    1712 </span>            : /* GT: because they are standard PostScript glyph names. */
<span class="lineNum">    1713 </span>            : /* GT: Again you may wish to explain that these refer to a &quot;j&quot; without a dot */
<span class="lineNum">    1714 </span>            :                         _(&quot;Your font is missing the uni0237 glyph,\nand the deprecated dotlessj glyph,\nplease add the former and remake your accented glyphs&quot;));
<span class="lineNum">    1715 </span><span class="lineNoCov">          0 :                 sf-&gt;dotlesswarn = true;</span>
<span class="lineNum">    1716 </span>            :             }
<span class="lineNum">    1717 </span>            :         }
<span class="lineNum">    1718 </span>            :     }
<span class="lineNum">    1719 </span><span class="lineNoCov">          0 :     if ( rsc==NULL )</span>
<span class="lineNum">    1720 </span><span class="lineNoCov">          0 : return( 0 );</span>
<span class="lineNum">    1721 </span><span class="lineNoCov">          0 :     if ( bdf == NULL || !disp_only ) {</span>
<span class="lineNum">    1722 </span><span class="lineNoCov">          0 :         sc-&gt;width = rsc-&gt;width;</span>
<span class="lineNum">    1723 </span><span class="lineNoCov">          0 :         if ( ch!=' ' )                  /* Some accents are built by combining with space. Don't. The reference won't be displayed or selectable but will be there and might cause confusion... */</span>
<span class="lineNum">    1724 </span><span class="lineNoCov">          0 :             SCAddRef(sc,rsc,layer,0,0); /* should be after the call to MakeChar */</span>
<span class="lineNum">    1725 </span>            :     }
<span class="lineNum">    1726 </span><span class="lineNoCov">          0 :     if ( !disp_only ) {</span>
<span class="lineNum">    1727 </span><span class="lineNoCov">          0 :         for ( bdf=sf-&gt;cidmaster?sf-&gt;cidmaster-&gt;bitmaps:sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">    1728 </span><span class="lineNoCov">          0 :             if ( bdf-&gt;glyphs[rsc-&gt;orig_pos] != NULL ) {</span>
<span class="lineNum">    1729 </span><span class="lineNoCov">          0 :                 if (( bc = bdf-&gt;glyphs[sc-&gt;orig_pos] ) == NULL ) {</span>
<span class="lineNum">    1730 </span><span class="lineNoCov">          0 :                     bc = BDFMakeGID(bdf,sc-&gt;orig_pos);</span>
<span class="lineNum">    1731 </span><span class="lineNoCov">          0 :                     BCClearAll( bc );</span>
<span class="lineNum">    1732 </span>            :                 }
<span class="lineNum">    1733 </span><span class="lineNoCov">          0 :                 if ( ch!=' ' )</span>
<span class="lineNum">    1734 </span><span class="lineNoCov">          0 :                     BCAddReference( bc,bdf-&gt;glyphs[rsc-&gt;orig_pos],rsc-&gt;orig_pos,0,0 );</span>
<span class="lineNum">    1735 </span>            :             }
<span class="lineNum">    1736 </span>            :         }
<span class="lineNum">    1737 </span><span class="lineNoCov">          0 :     } else if ( bdf != NULL ) {</span>
<span class="lineNum">    1738 </span><span class="lineNoCov">          0 :         if ( bdf-&gt;glyphs[rsc-&gt;orig_pos] != NULL ) {</span>
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 :             if (( bc = bdf-&gt;glyphs[sc-&gt;orig_pos] ) == NULL ) {</span>
<span class="lineNum">    1740 </span><span class="lineNoCov">          0 :                 bc = BDFMakeGID(bdf,sc-&gt;orig_pos);</span>
<span class="lineNum">    1741 </span><span class="lineNoCov">          0 :                 BCClearAll( bc );</span>
<span class="lineNum">    1742 </span>            :             }
<span class="lineNum">    1743 </span><span class="lineNoCov">          0 :             if ( ch!=' ' )</span>
<span class="lineNum">    1744 </span><span class="lineNoCov">          0 :                 BCAddReference( bc,bdf-&gt;glyphs[rsc-&gt;orig_pos],rsc-&gt;orig_pos,0,0 );</span>
<span class="lineNum">    1745 </span>            :         }
<span class="lineNum">    1746 </span>            :     }
<span class="lineNum">    1747 </span><span class="lineNoCov">          0 : return( 1 );</span>
<a name="1748"><span class="lineNum">    1748 </span>            : }</a>
<span class="lineNum">    1749 </span>            : 
<span class="lineNum">    1750 </span><span class="lineNoCov">          0 : static SplineChar *GetGoodAccentGlyph(SplineFont *sf, int uni, int basech,</span>
<span class="lineNum">    1751 </span>            :         int *invert,double ia, char *dot, SplineChar *destination) {
<span class="lineNum">    1752 </span><span class="lineNoCov">          0 :     int ach= -1;</span>
<span class="lineNum">    1753 </span>            :     const unichar_t *apt, *end;
<span class="lineNum">    1754 </span>            :     SplineChar *rsc;
<span class="lineNum">    1755 </span>            :     char buffer[200], namebuf[200];
<span class="lineNum">    1756 </span>            : 
<span class="lineNum">    1757 </span><span class="lineNoCov">          0 :     *invert = false;</span>
<span class="lineNum">    1758 </span>            : 
<span class="lineNum">    1759 </span>            :     /* cedilla on lower &quot;g&quot; becomes a turned comma above it */
<span class="lineNum">    1760 </span><span class="lineNoCov">          0 :     if ( uni==0x327 &amp;&amp; basech=='g' &amp;&amp; haschar(sf,0x312, dot))</span>
<span class="lineNum">    1761 </span><span class="lineNoCov">          0 :         uni = 0x312;</span>
<span class="lineNum">    1762 </span><span class="lineNoCov">          0 :     if ( !PreferSpacingAccents &amp;&amp; ((haschar(sf,uni, dot) &amp;&amp;</span>
<span class="lineNum">    1763 </span><span class="lineNoCov">          0 :                 !SCDependsOnSC(GetChar(sf,uni,dot),destination)) ||</span>
<span class="lineNum">    1764 </span><span class="lineNoCov">          0 :             (dot!=NULL &amp;&amp; haschar(sf,uni, NULL) &amp;&amp;</span>
<span class="lineNum">    1765 </span><span class="lineNoCov">          0 :                 !SCDependsOnSC(GetChar(sf,uni,NULL),destination))) )</span>
<span class="lineNum">    1766 </span><span class="lineNoCov">          0 :         ach = uni;</span>
<span class="lineNum">    1767 </span><span class="lineNoCov">          0 :     else if ( uni&gt;=BottomAccent &amp;&amp; uni&lt;=TopAccent ) {</span>
<span class="lineNum">    1768 </span><span class="lineNoCov">          0 :         apt = accents[uni-BottomAccent]; end = apt+sizeof(accents[0])/sizeof(accents[0][0]);</span>
<span class="lineNum">    1769 </span><span class="lineNoCov">          0 :         while ( *apt &amp;&amp; apt&lt;end &amp;&amp;</span>
<span class="lineNum">    1770 </span><span class="lineNoCov">          0 :                 (             GetChar(sf,*apt,dot) ==NULL || SCDependsOnSC(GetChar(sf,*apt,dot),destination)) &amp;&amp;</span>
<span class="lineNum">    1771 </span><span class="lineNoCov">          0 :                 (dot==NULL || GetChar(sf,*apt,NULL)==NULL || SCDependsOnSC(GetChar(sf,*apt,NULL),destination)) )</span>
<span class="lineNum">    1772 </span><span class="lineNoCov">          0 :             ++apt;</span>
<span class="lineNum">    1773 </span><span class="lineNoCov">          0 :         if ( *apt!='\0' &amp;&amp; apt&lt;end )</span>
<span class="lineNum">    1774 </span><span class="lineNoCov">          0 :             ach = *apt;</span>
<span class="lineNum">    1775 </span><span class="lineNoCov">          0 :         else if ( haschar(sf,uni,dot) &amp;&amp; !SCDependsOnSC(GetChar(sf,uni,dot),destination))</span>
<span class="lineNum">    1776 </span><span class="lineNoCov">          0 :             ach = uni;</span>
<span class="lineNum">    1777 </span><span class="lineNoCov">          0 :         else if ( uni==0x31b &amp;&amp; haschar(sf,',',NULL))</span>
<span class="lineNum">    1778 </span><span class="lineNoCov">          0 :             ach = ',';</span>
<span class="lineNum">    1779 </span><span class="lineNoCov">          0 :         else if (( uni == 0x32f || uni == 0x311 ) &amp;&amp; haschar(sf,0x2d8,NULL) &amp;&amp; ia==0 ) {</span>
<span class="lineNum">    1780 </span>            :             /* In italic fonts invert is not enough, you must do more */
<span class="lineNum">    1781 </span><span class="lineNoCov">          0 :             ach = 0x2d8;</span>
<span class="lineNum">    1782 </span><span class="lineNoCov">          0 :             *invert = true;</span>
<span class="lineNum">    1783 </span><span class="lineNoCov">          0 :         } else if ( (uni == 0x30c || uni == 0x32c ) &amp;&amp;</span>
<span class="lineNum">    1784 </span><span class="lineNoCov">          0 :                 (haschar(sf,0x302,dot) || haschar(sf,0x2c6,NULL) || haschar(sf,'^',NULL)) ) {</span>
<span class="lineNum">    1785 </span><span class="lineNoCov">          0 :             *invert = true;</span>
<span class="lineNum">    1786 </span><span class="lineNoCov">          0 :             if ( haschar(sf,0x2c6,NULL))</span>
<span class="lineNum">    1787 </span><span class="lineNoCov">          0 :                 ach = 0x2c6;</span>
<span class="lineNum">    1788 </span><span class="lineNoCov">          0 :             else if ( haschar(sf,'^',NULL) )</span>
<span class="lineNum">    1789 </span><span class="lineNoCov">          0 :                 ach = '^';</span>
<span class="lineNum">    1790 </span>            :             else
<span class="lineNum">    1791 </span><span class="lineNoCov">          0 :                 ach = 0x302;</span>
<span class="lineNum">    1792 </span>            :         }
<span class="lineNum">    1793 </span>            :     } else
<span class="lineNum">    1794 </span><span class="lineNoCov">          0 :         ach = uni;</span>
<span class="lineNum">    1795 </span>            : 
<span class="lineNum">    1796 </span><span class="lineNoCov">          0 :     rsc = NULL;</span>
<span class="lineNum">    1797 </span><span class="lineNoCov">          0 :     if ( dot!=NULL ) {</span>
<span class="lineNum">    1798 </span><span class="lineNoCov">          0 :         snprintf(buffer,sizeof(buffer),&quot;%s%s&quot;,</span>
<span class="lineNum">    1799 </span><span class="lineNoCov">          0 :                 (char *) StdGlyphName(namebuf,ach,sf-&gt;uni_interp,sf-&gt;for_new_glyphs),</span>
<span class="lineNum">    1800 </span>            :                 dot);
<span class="lineNum">    1801 </span><span class="lineNoCov">          0 :         rsc = SFGetChar(sf,-1,buffer);</span>
<span class="lineNum">    1802 </span>            :     }
<span class="lineNum">    1803 </span><span class="lineNoCov">          0 :     if ( rsc==NULL ) {</span>
<span class="lineNum">    1804 </span><span class="lineNoCov">          0 :         rsc = SFGetChar(sf,ach,NULL);</span>
<span class="lineNum">    1805 </span><span class="lineNoCov">          0 :         dot = NULL;</span>
<span class="lineNum">    1806 </span>            :     }
<span class="lineNum">    1807 </span>            : 
<span class="lineNum">    1808 </span>            :     /* Look to see if there are upper case variants of the accents available */
<span class="lineNum">    1809 </span><span class="lineNoCov">          0 :     if ( dot==NULL &amp;&amp; ( isupper(basech) || (basech&gt;=0x400 &amp;&amp; basech&lt;=0x52f) )) {</span>
<span class="lineNum">    1810 </span>            :         char *uc_accent;
<span class="lineNum">    1811 </span><span class="lineNoCov">          0 :         SplineChar *test = NULL;</span>
<span class="lineNum">    1812 </span>            :         char buffer[80];
<span class="lineNum">    1813 </span>            :         char *suffixes[4];
<span class="lineNum">    1814 </span><span class="lineNoCov">          0 :         int scnt=0, i;</span>
<span class="lineNum">    1815 </span>            : 
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 :         if ( rsc!=NULL ) {</span>
<span class="lineNum">    1817 </span><span class="lineNoCov">          0 :             uc_accent = malloc(strlen(rsc-&gt;name)+11);</span>
<span class="lineNum">    1818 </span><span class="lineNoCov">          0 :             strcpy(uc_accent,rsc-&gt;name);</span>
<span class="lineNum">    1819 </span>            :         } else
<span class="lineNum">    1820 </span><span class="lineNoCov">          0 :             uc_accent = NULL;</span>
<span class="lineNum">    1821 </span><span class="lineNoCov">          0 :         memset(suffixes,0,sizeof(suffixes));</span>
<span class="lineNum">    1822 </span><span class="lineNoCov">          0 :         if ( basech&gt;=0x400 &amp;&amp; basech&lt;=0x52f ) {</span>
<span class="lineNum">    1823 </span><span class="lineNoCov">          0 :             if ( isupper(basech) )</span>
<span class="lineNum">    1824 </span><span class="lineNoCov">          0 :                 suffixes[scnt++] = &quot;cyrcap&quot;;</span>
<span class="lineNum">    1825 </span><span class="lineNoCov">          0 :             suffixes[scnt++] = &quot;cyr&quot;;</span>
<span class="lineNum">    1826 </span>            :         }
<span class="lineNum">    1827 </span><span class="lineNoCov">          0 :         if ( isupper(basech))</span>
<span class="lineNum">    1828 </span><span class="lineNoCov">          0 :             suffixes[scnt++] = &quot;cap&quot;;</span>
<span class="lineNum">    1829 </span>            : 
<span class="lineNum">    1830 </span><span class="lineNoCov">          0 :         for ( i=0; test==NULL &amp;&amp; i&lt;scnt; ++i ) {</span>
<span class="lineNum">    1831 </span><span class="lineNoCov">          0 :             if ( uni&gt;=BottomAccent &amp;&amp; uni&lt;=TopAccent ) {</span>
<span class="lineNum">    1832 </span><span class="lineNoCov">          0 :                 apt = accents[uni-BottomAccent]; end = apt+sizeof(accents[0])/sizeof(accents[0][0]);</span>
<span class="lineNum">    1833 </span><span class="lineNoCov">          0 :                 while ( test==NULL &amp;&amp; apt&lt;end ) {</span>
<span class="lineNum">    1834 </span><span class="lineNoCov">          0 :                     int acc = *apt ? *apt : uni;</span>
<span class="lineNum">    1835 </span><span class="lineNoCov">          0 :                     sprintf( buffer,&quot;%.70s.%s&quot;, StdGlyphName(buffer,acc,ui_none,(NameList *) -1), suffixes[i]);</span>
<span class="lineNum">    1836 </span><span class="lineNoCov">          0 :                     if ( (test = SFGetChar(sf,-1,buffer))!=NULL )</span>
<span class="lineNum">    1837 </span><span class="lineNoCov">          0 :                         rsc = test;</span>
<span class="lineNum">    1838 </span><span class="lineNoCov">          0 :                     if ( test==NULL ) {</span>
<span class="lineNum">    1839 </span><span class="lineNoCov">          0 :                         sprintf( buffer,&quot;uni%04X.%s&quot;, acc, suffixes[i]);</span>
<span class="lineNum">    1840 </span><span class="lineNoCov">          0 :                         if ( (test = SFGetChar(sf,-1,buffer))!=NULL )</span>
<span class="lineNum">    1841 </span><span class="lineNoCov">          0 :                             rsc = test;</span>
<span class="lineNum">    1842 </span>            :                     }
<span class="lineNum">    1843 </span><span class="lineNoCov">          0 :                     if ( *apt=='\0' )</span>
<span class="lineNum">    1844 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1845 </span><span class="lineNoCov">          0 :                     ++apt;</span>
<span class="lineNum">    1846 </span>            :                 }
<span class="lineNum">    1847 </span>            :             }
<span class="lineNum">    1848 </span>            :         }
<span class="lineNum">    1849 </span><span class="lineNoCov">          0 :         if ( test==NULL &amp;&amp; uni&gt;=BottomAccent &amp;&amp; uni&lt;=TopAccent &amp;&amp; isupper(basech)) {</span>
<span class="lineNum">    1850 </span><span class="lineNoCov">          0 :             apt = accents[uni-BottomAccent]; end = apt+sizeof(accents[0])/sizeof(accents[0][0]);</span>
<span class="lineNum">    1851 </span><span class="lineNoCov">          0 :             while ( test==NULL &amp;&amp; apt&lt;end ) {</span>
<span class="lineNum">    1852 </span><span class="lineNoCov">          0 :                 int acc = *apt ? *apt : uni;</span>
<span class="lineNum">    1853 </span><span class="lineNoCov">          0 :                 sprintf( buffer,&quot;%.70s.%s&quot;, StdGlyphName(buffer,acc,ui_none,(NameList *) -1), suffixes[i]);</span>
<span class="lineNum">    1854 </span><span class="lineNoCov">          0 :                 if ( islower(buffer[0])) {</span>
<span class="lineNum">    1855 </span><span class="lineNoCov">          0 :                     buffer[0] = toupper(buffer[0]);</span>
<span class="lineNum">    1856 </span><span class="lineNoCov">          0 :                     if ( (test = SFGetChar(sf,-1,buffer))!=NULL )</span>
<span class="lineNum">    1857 </span><span class="lineNoCov">          0 :                         rsc = test;</span>
<span class="lineNum">    1858 </span>            :                 }
<span class="lineNum">    1859 </span><span class="lineNoCov">          0 :                 if ( *apt=='\0' )</span>
<span class="lineNum">    1860 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1861 </span><span class="lineNoCov">          0 :                 ++apt;</span>
<span class="lineNum">    1862 </span>            :             }
<span class="lineNum">    1863 </span>            :         }
<span class="lineNum">    1864 </span><span class="lineNoCov">          0 :         if ( test==NULL &amp;&amp; uni&gt;=BottomAccent &amp;&amp; uni&lt;BottomAccent+sizeof(uc_accent_names)/sizeof(uc_accent_names[0]) &amp;&amp;</span>
<span class="lineNum">    1865 </span><span class="lineNoCov">          0 :                 uc_accent_names[uni-BottomAccent]!=NULL &amp;&amp; isupper(basech))</span>
<span class="lineNum">    1866 </span><span class="lineNoCov">          0 :             if ( (test = SFGetChar(sf,-1,uc_accent_names[uni-BottomAccent]))!=NULL )</span>
<span class="lineNum">    1867 </span><span class="lineNoCov">          0 :                 rsc = test;</span>
<span class="lineNum">    1868 </span><span class="lineNoCov">          0 :         if ( test==NULL &amp;&amp; uc_accent!=NULL &amp;&amp; islower(*uc_accent) &amp;&amp; isupper(basech)) {</span>
<span class="lineNum">    1869 </span><span class="lineNoCov">          0 :             *uc_accent = toupper(*uc_accent);</span>
<span class="lineNum">    1870 </span><span class="lineNoCov">          0 :             if ( (test=SFGetChar(sf,-1,uc_accent))!=NULL )</span>
<span class="lineNum">    1871 </span><span class="lineNoCov">          0 :                 rsc = test;</span>
<span class="lineNum">    1872 </span>            :         }
<span class="lineNum">    1873 </span><span class="lineNoCov">          0 :         free(uc_accent);</span>
<span class="lineNum">    1874 </span>            :     }
<span class="lineNum">    1875 </span><span class="lineNoCov">          0 :     if ( rsc!=NULL &amp;&amp; SCDependsOnSC(rsc,destination))</span>
<span class="lineNum">    1876 </span><span class="lineNoCov">          0 :         rsc = NULL;</span>
<span class="lineNum">    1877 </span><span class="lineNoCov">          0 : return( rsc );</span>
<a name="1878"><span class="lineNum">    1878 </span>            : }</a>
<span class="lineNum">    1879 </span>            : 
<span class="lineNum">    1880 </span><span class="lineNoCov">          0 : static void TurnOffUseMyMetrics(SplineChar *sc) {</span>
<span class="lineNum">    1881 </span>            :     /* When building greek polytonic glyphs, or any glyphs where the accents */
<span class="lineNum">    1882 </span>            :     /*  change the metrics, we should turn off &quot;use my metrics&quot; on the base */
<span class="lineNum">    1883 </span>            :     /*  reference */
<span class="lineNum">    1884 </span>            :     RefChar *refs;
<span class="lineNum">    1885 </span>            :     int ly;
<span class="lineNum">    1886 </span>            : 
<span class="lineNum">    1887 </span><span class="lineNoCov">          0 :     for ( ly=ly_fore; ly&lt;sc-&gt;layer_cnt; ++ly )</span>
<span class="lineNum">    1888 </span><span class="lineNoCov">          0 :         for ( refs = sc-&gt;layers[ly].refs; refs!=NULL; refs = refs-&gt;next )</span>
<span class="lineNum">    1889 </span><span class="lineNoCov">          0 :             refs-&gt;use_my_metrics = false;</span>
<a name="1890"><span class="lineNum">    1890 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1891 </span>            : 
<span class="lineNum">    1892 </span><span class="lineNoCov">          0 : AnchorClass *AnchorClassMatch(SplineChar *sc1,SplineChar *sc2,AnchorClass *restrict_,</span>
<span class="lineNum">    1893 </span>            :         AnchorPoint **_ap1,AnchorPoint **_ap2 ) {
<span class="lineNum">    1894 </span>            :     AnchorPoint *ap1, *ap2;
<span class="lineNum">    1895 </span>            : 
<span class="lineNum">    1896 </span><span class="lineNoCov">          0 :     for ( ap1=sc1-&gt;anchor; ap1!=NULL ; ap1=ap1-&gt;next ) if ( restrict_==(AnchorClass *) -1 || ap1-&gt;anchor==restrict_ ) {</span>
<span class="lineNum">    1897 </span><span class="lineNoCov">          0 :         for ( ap2=sc2-&gt;anchor; ap2!=NULL; ap2=ap2-&gt;next ) if ( restrict_==(AnchorClass *) -1 || ap2-&gt;anchor==restrict_ ) {</span>
<span class="lineNum">    1898 </span><span class="lineNoCov">          0 :             if ( ap1-&gt;anchor==ap2-&gt;anchor &amp;&amp;</span>
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :                     ((ap1-&gt;type&gt;=at_basechar &amp;&amp; ap1-&gt;type&lt;=at_basemark &amp;&amp; ap2-&gt;type==at_mark) ||</span>
<span class="lineNum">    1900 </span><span class="lineNoCov">          0 :                      (ap1-&gt;type==at_cexit &amp;&amp; ap2-&gt;type==at_centry) )) {</span>
<span class="lineNum">    1901 </span><span class="lineNoCov">          0 :                  *_ap1 = ap1;</span>
<span class="lineNum">    1902 </span><span class="lineNoCov">          0 :                  *_ap2 = ap2;</span>
<span class="lineNum">    1903 </span><span class="lineNoCov">          0 : return( ap1-&gt;anchor );</span>
<span class="lineNum">    1904 </span>            :             }
<span class="lineNum">    1905 </span>            :         }
<span class="lineNum">    1906 </span>            :     }
<span class="lineNum">    1907 </span><span class="lineNoCov">          0 : return( NULL );</span>
<a name="1908"><span class="lineNum">    1908 </span>            : }</a>
<span class="lineNum">    1909 </span>            : 
<span class="lineNum">    1910 </span><span class="lineNoCov">          0 : AnchorClass *AnchorClassMkMkMatch(SplineChar *sc1,SplineChar *sc2,</span>
<span class="lineNum">    1911 </span>            :         AnchorPoint **_ap1,AnchorPoint **_ap2 ) {
<span class="lineNum">    1912 </span>            :     AnchorPoint *ap1, *ap2;
<span class="lineNum">    1913 </span>            : 
<span class="lineNum">    1914 </span><span class="lineNoCov">          0 :     for ( ap1=sc1-&gt;anchor; ap1!=NULL ; ap1=ap1-&gt;next ) {</span>
<span class="lineNum">    1915 </span><span class="lineNoCov">          0 :         for ( ap2=sc2-&gt;anchor; ap2!=NULL; ap2=ap2-&gt;next ) {</span>
<span class="lineNum">    1916 </span><span class="lineNoCov">          0 :             if ( ap1-&gt;anchor==ap2-&gt;anchor &amp;&amp;</span>
<span class="lineNum">    1917 </span><span class="lineNoCov">          0 :                     ap1-&gt;type==at_basemark &amp;&amp; ap2-&gt;type==at_mark)  {</span>
<span class="lineNum">    1918 </span><span class="lineNoCov">          0 :                  *_ap1 = ap1;</span>
<span class="lineNum">    1919 </span><span class="lineNoCov">          0 :                  *_ap2 = ap2;</span>
<span class="lineNum">    1920 </span><span class="lineNoCov">          0 : return( ap1-&gt;anchor );</span>
<span class="lineNum">    1921 </span>            :             }
<span class="lineNum">    1922 </span>            :         }
<span class="lineNum">    1923 </span>            :     }
<span class="lineNum">    1924 </span><span class="lineNoCov">          0 : return( NULL );</span>
<a name="1925"><span class="lineNum">    1925 </span>            : }</a>
<span class="lineNum">    1926 </span>            : 
<span class="lineNum">    1927 </span><span class="lineNoCov">          0 : AnchorClass *AnchorClassCursMatch(SplineChar *sc1,SplineChar *sc2,</span>
<span class="lineNum">    1928 </span>            :         AnchorPoint **_ap1,AnchorPoint **_ap2 ) {
<span class="lineNum">    1929 </span>            :     AnchorPoint *ap1, *ap2;
<span class="lineNum">    1930 </span>            : 
<span class="lineNum">    1931 </span><span class="lineNoCov">          0 :     for ( ap1=sc1-&gt;anchor; ap1!=NULL ; ap1=ap1-&gt;next ) {</span>
<span class="lineNum">    1932 </span><span class="lineNoCov">          0 :         for ( ap2=sc2-&gt;anchor; ap2!=NULL; ap2=ap2-&gt;next ) {</span>
<span class="lineNum">    1933 </span><span class="lineNoCov">          0 :             if ( ap1-&gt;anchor==ap2-&gt;anchor &amp;&amp;</span>
<span class="lineNum">    1934 </span><span class="lineNoCov">          0 :                     ap1-&gt;type==at_cexit &amp;&amp; ap2-&gt;type==at_centry)  {</span>
<span class="lineNum">    1935 </span><span class="lineNoCov">          0 :                  *_ap1 = ap1;</span>
<span class="lineNum">    1936 </span><span class="lineNoCov">          0 :                  *_ap2 = ap2;</span>
<span class="lineNum">    1937 </span><span class="lineNoCov">          0 : return( ap1-&gt;anchor );</span>
<span class="lineNum">    1938 </span>            :             }
<span class="lineNum">    1939 </span>            :         }
<span class="lineNum">    1940 </span>            :     }
<span class="lineNum">    1941 </span><span class="lineNoCov">          0 : return( NULL );</span>
<a name="1942"><span class="lineNum">    1942 </span>            : }</a>
<span class="lineNum">    1943 </span>            : 
<span class="lineNum">    1944 </span><span class="lineNoCov">          0 : static void _BCCenterAccent( BDFFont *bdf, int gid, int rgid, int ch, int basech, int italicoff,</span>
<span class="lineNum">    1945 </span>            :         uint32 pos,     /* unicode char position info, see #define for utype2[] in utype.h */
<span class="lineNum">    1946 </span>            :         real em ) {
<span class="lineNum">    1947 </span>            :     BDFChar *bc, *rbc;
<span class="lineNum">    1948 </span>            :     int ixoff, iyoff, ispacing;
<span class="lineNum">    1949 </span>            :     IBounds ibb, irb;
<span class="lineNum">    1950 </span>            :     
<span class="lineNum">    1951 </span><span class="lineNoCov">          0 :     if (( rbc = bdf-&gt;glyphs[rgid] ) != NULL &amp;&amp; ( bc = bdf-&gt;glyphs[gid] ) != NULL ) {</span>
<span class="lineNum">    1952 </span><span class="lineNoCov">          0 :         if ( (ispacing = (bdf-&gt;pixelsize*accent_offset+50)/100)&lt;=1 ) ispacing = 2;</span>
<span class="lineNum">    1953 </span><span class="lineNoCov">          0 :         BCFlattenFloat(rbc);</span>
<span class="lineNum">    1954 </span><span class="lineNoCov">          0 :         BCCompressBitmap(rbc);</span>
<span class="lineNum">    1955 </span><span class="lineNoCov">          0 :         BDFCharQuickBounds( bc,&amp;ibb,0,0,false,true );</span>
<span class="lineNum">    1956 </span><span class="lineNoCov">          0 :         BDFCharQuickBounds( rbc,&amp;irb,0,0,false,true );</span>
<span class="lineNum">    1957 </span>            : 
<span class="lineNum">    1958 </span><span class="lineNoCov">          0 :         if ( (pos &amp; FF_UNICODE_ABOVE) &amp;&amp; (pos &amp; (FF_UNICODE_LEFT|FF_UNICODE_RIGHT)) )</span>
<span class="lineNum">    1959 </span><span class="lineNoCov">          0 :             iyoff = ibb.maxy - irb.maxy;</span>
<span class="lineNum">    1960 </span><span class="lineNoCov">          0 :         else if ( pos &amp; FF_UNICODE_ABOVE )</span>
<span class="lineNum">    1961 </span><span class="lineNoCov">          0 :             iyoff = ibb.maxy + ispacing - irb.miny;</span>
<span class="lineNum">    1962 </span><span class="lineNoCov">          0 :         else if ( pos &amp; FF_UNICODE_BELOW ) {</span>
<span class="lineNum">    1963 </span><span class="lineNoCov">          0 :             iyoff = ibb.miny - irb.maxy;</span>
<span class="lineNum">    1964 </span><span class="lineNoCov">          0 :             if ( !( pos &amp; FF_UNICODE_TOUCHING) )</span>
<span class="lineNum">    1965 </span><span class="lineNoCov">          0 :                 iyoff -= ispacing;</span>
<span class="lineNum">    1966 </span><span class="lineNoCov">          0 :         } else if ( pos &amp; FF_UNICODE_OVERSTRIKE )</span>
<span class="lineNum">    1967 </span><span class="lineNoCov">          0 :             iyoff = ibb.miny - irb.miny + ((ibb.maxy-ibb.miny)-(irb.maxy-irb.miny))/2;</span>
<span class="lineNum">    1968 </span>            :         else
<span class="lineNum">    1969 </span><span class="lineNoCov">          0 :             iyoff = ibb.miny - irb.miny;</span>
<span class="lineNum">    1970 </span><span class="lineNoCov">          0 :         if ( isupper(basech) &amp;&amp; ch==0x342)</span>
<span class="lineNum">    1971 </span><span class="lineNoCov">          0 :             ixoff = ibb.minx - irb.minx;</span>
<span class="lineNum">    1972 </span><span class="lineNoCov">          0 :         else if ( pos &amp; FF_UNICODE_LEFT )</span>
<span class="lineNum">    1973 </span><span class="lineNoCov">          0 :             ixoff = ibb.minx - ispacing - irb.maxx;</span>
<span class="lineNum">    1974 </span><span class="lineNoCov">          0 :         else if ( pos &amp; FF_UNICODE_RIGHT ) {</span>
<span class="lineNum">    1975 </span><span class="lineNoCov">          0 :             ixoff = ibb.maxx - irb.minx + ispacing/2;</span>
<span class="lineNum">    1976 </span><span class="lineNoCov">          0 :             if ( !( pos &amp; FF_UNICODE_TOUCHING) )</span>
<span class="lineNum">    1977 </span><span class="lineNoCov">          0 :                 ixoff += ispacing;</span>
<span class="lineNum">    1978 </span>            :         } else {
<span class="lineNum">    1979 </span><span class="lineNoCov">          0 :             if ( pos &amp; FF_UNICODE_CENTERLEFT )</span>
<span class="lineNum">    1980 </span><span class="lineNoCov">          0 :                 ixoff = ibb.minx + (ibb.maxx-ibb.minx)/2 - irb.maxx;</span>
<span class="lineNum">    1981 </span><span class="lineNoCov">          0 :             else if ( pos &amp; FF_UNICODE_LEFTEDGE )</span>
<span class="lineNum">    1982 </span><span class="lineNoCov">          0 :                 ixoff = ibb.minx - irb.minx;</span>
<span class="lineNum">    1983 </span><span class="lineNoCov">          0 :             else if ( pos &amp; FF_UNICODE_CENTERRIGHT )</span>
<span class="lineNum">    1984 </span><span class="lineNoCov">          0 :                 ixoff = ibb.minx + (ibb.maxx-ibb.minx)/2 - irb.minx;</span>
<span class="lineNum">    1985 </span><span class="lineNoCov">          0 :             else if ( pos &amp; FF_UNICODE_RIGHTEDGE )</span>
<span class="lineNum">    1986 </span><span class="lineNoCov">          0 :                 ixoff = ibb.maxx - irb.maxx;</span>
<span class="lineNum">    1987 </span>            :             else
<span class="lineNum">    1988 </span><span class="lineNoCov">          0 :                 ixoff = ibb.minx - irb.minx + ((ibb.maxx-ibb.minx)-(irb.maxx-irb.minx))/2;</span>
<span class="lineNum">    1989 </span>            :         }
<span class="lineNum">    1990 </span><span class="lineNoCov">          0 :         ixoff += rint( italicoff*bdf-&gt;pixelsize/em );</span>
<span class="lineNum">    1991 </span><span class="lineNoCov">          0 :         BCAddReference( bc,rbc,rgid,ixoff,iyoff );</span>
<span class="lineNum">    1992 </span>            :     }
<a name="1993"><span class="lineNum">    1993 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1994 </span>            : 
<span class="lineNum">    1995 </span><span class="lineNoCov">          0 : static void _SCCenterAccent(SplineChar *sc,SplineChar *basersc, SplineFont *sf,</span>
<span class="lineNum">    1996 </span>            :         int layer, int ch, BDFFont *bdf, int disp_only,
<span class="lineNum">    1997 </span>            :         SplineChar *rsc, real ia, int basech,
<span class="lineNum">    1998 </span>            :         int invert,     /* invert accent, false==0, true!=0 */
<span class="lineNum">    1999 </span>            :         uint32 pos      /* unicode char position info, see #define for utype2[] in utype.h */ ) {
<span class="lineNum">    2000 </span>            :     real transform[6];
<span class="lineNum">    2001 </span>            :     DBounds bb, rbb, bbb;
<span class="lineNum">    2002 </span>            :     real xoff, yoff;
<span class="lineNum">    2003 </span><span class="lineNoCov">          0 :     real spacing = (sf-&gt;ascent+sf-&gt;descent)*accent_offset/100;</span>
<span class="lineNum">    2004 </span>            :     real ybase, italicoff;
<span class="lineNum">    2005 </span>            :     const unichar_t *temp;
<span class="lineNum">    2006 </span><span class="lineNoCov">          0 :     int baserch = basech;</span>
<span class="lineNum">    2007 </span>            :     int eta;
<span class="lineNum">    2008 </span>            :     AnchorPoint *ap1, *ap2;
<span class="lineNum">    2009 </span>            : 
<span class="lineNum">    2010 </span><span class="lineNoCov">          0 :     if ( rsc==NULL || sc==NULL )</span>
<span class="lineNum">    2011 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2012 </span>            : 
<span class="lineNum">    2013 </span>            :     /* When we center an accent on Uhorn, we don't really want it centered */
<span class="lineNum">    2014 </span>            :     /*  on the combination, we want it centered on &quot;U&quot;. So if basech is itself*/
<span class="lineNum">    2015 </span>            :     /*  a combo, find what it is based on */
<span class="lineNum">    2016 </span><span class="lineNoCov">          0 :     if ( (temp = SFGetAlternate(sf,basech,NULL,false))!=NULL &amp;&amp; haschar(sf,*temp,NULL))</span>
<span class="lineNum">    2017 </span><span class="lineNoCov">          0 :         baserch = *temp;</span>
<span class="lineNum">    2018 </span>            :     /* Similarly in Ø or ø, we really want to base the accents on O or o */
<span class="lineNum">    2019 </span><span class="lineNoCov">          0 :     if ( baserch==0xf8 ) baserch = 'o';</span>
<span class="lineNum">    2020 </span><span class="lineNoCov">          0 :     else if ( baserch==0xd8 ) baserch = 'O';</span>
<span class="lineNum">    2021 </span>            : 
<span class="lineNum">    2022 </span><span class="lineNoCov">          0 :     SplineCharFindSlantedBounds(rsc,layer,&amp;rbb,ia);</span>
<span class="lineNum">    2023 </span><span class="lineNoCov">          0 :     if ( ch==0x328 || ch==0x327 ) {     /* cedilla and ogonek */</span>
<span class="lineNum">    2024 </span><span class="lineNoCov">          0 :         SCFindTopBounds(rsc,layer,&amp;rbb,ia);</span>
<span class="lineNum">    2025 </span>            :         /* should do more than touch, should overlap a tiny bit... */
<span class="lineNum">    2026 </span><span class="lineNoCov">          0 :         rbb.maxy -= (rbb.maxy-rbb.miny)/30;</span>
<span class="lineNum">    2027 </span><span class="lineNoCov">          0 :     } else if ( ch==0x345 ) {   /* ypogegrammeni */</span>
<span class="lineNum">    2028 </span><span class="lineNoCov">          0 :         SCFindTopBounds(rsc,layer,&amp;rbb,ia);</span>
<span class="lineNum">    2029 </span><span class="lineNoCov">          0 :     } else if ( (GraveAcuteCenterBottom &amp;&amp; (ch==0x300 || ch==0x301 || ch==0x30b || ch==0x30f)) || ch==0x309 )   /* grave, acute, hungarian, Floating hook */</span>
<span class="lineNum">    2030 </span><span class="lineNoCov">          0 :         SCFindBottomBounds(rsc,layer,&amp;rbb,ia);</span>
<span class="lineNum">    2031 </span><span class="lineNoCov">          0 :     else if ( basech=='A' &amp;&amp; ch==0x30a )</span>
<span class="lineNum">    2032 </span>            :         /* Again, a tiny bit of overlap is usual for Aring */
<span class="lineNum">    2033 </span><span class="lineNoCov">          0 :         rbb.miny += (rbb.maxy-rbb.miny)/30;</span>
<span class="lineNum">    2034 </span><span class="lineNoCov">          0 :     ybase = SplineCharFindSlantedBounds(sc,layer,&amp;bb,ia);</span>
<span class="lineNum">    2035 </span><span class="lineNoCov">          0 :     if ( basersc==NULL ) {</span>
<span class="lineNum">    2036 </span><span class="lineNoCov">          0 :         if ( baserch!=basech &amp;&amp; ( basersc = SFGetChar(sf,baserch,NULL))!=NULL )</span>
<span class="lineNum">    2037 </span>            :             /* Do Nothing */;
<span class="lineNum">    2038 </span><span class="lineNoCov">          0 :         else if ( basersc == NULL || (basech!=-1 &amp;&amp; (basech==sc-&gt;unicodeenc || ( basersc = SFGetChar(sf,basech,NULL))==NULL )))</span>
<span class="lineNum">    2039 </span><span class="lineNoCov">          0 :             basersc = sc;</span>
<span class="lineNum">    2040 </span>            :     }
<span class="lineNum">    2041 </span><span class="lineNoCov">          0 :     if ( ia==0 &amp;&amp; baserch!=basech &amp;&amp; basersc!=NULL ) {</span>
<span class="lineNum">    2042 </span><span class="lineNoCov">          0 :         ybase = SplineCharFindSlantedBounds(basersc,layer,&amp;bbb,ia);</span>
<span class="lineNum">    2043 </span><span class="lineNoCov">          0 :         if ( ff_unicode_utype2[1+ch] &amp; (FF_UNICODE_ABOVE|FF_UNICODE_BELOW) ) {</span>
<span class="lineNum">    2044 </span>            :             /* if unicode.org character definition matches ABOVE or BELOW, then... */
<span class="lineNum">    2045 </span><span class="lineNoCov">          0 :             bbb.maxy = bb.maxy;</span>
<span class="lineNum">    2046 </span><span class="lineNoCov">          0 :             bbb.miny = bb.miny;</span>
<span class="lineNum">    2047 </span>            :         }
<span class="lineNum">    2048 </span><span class="lineNoCov">          0 :         if ( ff_unicode_utype2[1+ch] &amp; (FF_UNICODE_RIGHT|FF_UNICODE_LEFT) ) {</span>
<span class="lineNum">    2049 </span>            :             /* if unicode.org character definition matches RIGHT or LEFT, then... */
<span class="lineNum">    2050 </span><span class="lineNoCov">          0 :             bbb.maxx = bb.maxx;</span>
<span class="lineNum">    2051 </span><span class="lineNoCov">          0 :             bbb.minx = bb.minx;</span>
<span class="lineNum">    2052 </span>            :         }
<span class="lineNum">    2053 </span><span class="lineNoCov">          0 :         bb = bbb;</span>
<span class="lineNum">    2054 </span>            :     }
<span class="lineNum">    2055 </span>            : 
<span class="lineNum">    2056 </span><span class="lineNoCov">          0 :     transform[0] = transform[3] = 1;</span>
<span class="lineNum">    2057 </span><span class="lineNoCov">          0 :     transform[1] = transform[2] = transform[4] = transform[5] = 0;</span>
<span class="lineNum">    2058 </span>            : 
<span class="lineNum">    2059 </span><span class="lineNoCov">          0 :     italicoff = 0;</span>
<span class="lineNum">    2060 </span><span class="lineNoCov">          0 :     if ( sc-&gt;layers[layer].refs!=NULL &amp;&amp; sc-&gt;layers[layer].refs-&gt;next!=NULL &amp;&amp;</span>
<span class="lineNum">    2061 </span><span class="lineNoCov">          0 :             (AnchorClassMkMkMatch(sc-&gt;layers[layer].refs-&gt;sc,rsc,&amp;ap1,&amp;ap2)!=NULL ||</span>
<span class="lineNum">    2062 </span><span class="lineNoCov">          0 :              AnchorClassCursMatch(sc-&gt;layers[layer].refs-&gt;sc,rsc,&amp;ap1,&amp;ap2)!=NULL) ) {</span>
<span class="lineNum">    2063 </span>            :         /* Do we have a mark to mark attachment to the last anchor we added? */
<span class="lineNum">    2064 </span>            :         /*  (or a cursive exit to entry match?) */
<span class="lineNum">    2065 </span>            :         /*  If so then figure offsets relative to it. */
<span class="lineNum">    2066 </span><span class="lineNoCov">          0 :         xoff = ap1-&gt;me.x-ap2-&gt;me.x + sc-&gt;layers[layer].refs-&gt;transform[4];</span>
<span class="lineNum">    2067 </span><span class="lineNoCov">          0 :         yoff = ap1-&gt;me.y-ap2-&gt;me.y + sc-&gt;layers[layer].refs-&gt;transform[5];</span>
<span class="lineNum">    2068 </span><span class="lineNoCov">          0 :         pos = ff_unicode_utype2[1+ch];  /* init with unicode.org position information */</span>
<span class="lineNum">    2069 </span><span class="lineNoCov">          0 :     } else if ( AnchorClassMatch(basersc,rsc,(AnchorClass *) -1,&amp;ap1,&amp;ap2)!=NULL &amp;&amp; ap2-&gt;type==at_mark ) {</span>
<span class="lineNum">    2070 </span><span class="lineNoCov">          0 :         xoff = ap1-&gt;me.x-ap2-&gt;me.x;</span>
<span class="lineNum">    2071 </span><span class="lineNoCov">          0 :         yoff = ap1-&gt;me.y-ap2-&gt;me.y;</span>
<span class="lineNum">    2072 </span><span class="lineNoCov">          0 :         pos = ff_unicode_utype2[1+ch];  /* init with unicode.org position information */</span>
<span class="lineNum">    2073 </span>            :     } else {
<span class="lineNum">    2074 </span>            :  /* try to establish a common line on which all accents lie. The problem being*/
<span class="lineNum">    2075 </span>            :  /*  that an accent above a,e,o will usually be slightly higher than an accent */
<span class="lineNum">    2076 </span>            :  /*  above i or u, similarly for upper case. Letters with ascenders shouldn't */
<span class="lineNum">    2077 </span>            :  /*  have much of a problem because ascenders are (usually) all the same shape*/
<span class="lineNum">    2078 </span>            :  /* Obviously this test is only meaningful for latin,greek,cyrillic alphas */
<span class="lineNum">    2079 </span>            :  /*  hence test for isupper,islower. And I'm assuming greek,cyrillic will */
<span class="lineNum">    2080 </span>            :  /*  be consistant with latin */
<span class="lineNum">    2081 </span><span class="lineNoCov">          0 :         if ( islower(basech) || isupper(basech)) {</span>
<span class="lineNum">    2082 </span><span class="lineNoCov">          0 :             SplineChar *common = SFGetChar(sf,islower(basech)?'o':'O',NULL);</span>
<span class="lineNum">    2083 </span><span class="lineNoCov">          0 :             if ( common!=NULL ) {</span>
<span class="lineNum">    2084 </span><span class="lineNoCov">          0 :                 real top = SplineCharQuickTop(common,layer);</span>
<span class="lineNum">    2085 </span><span class="lineNoCov">          0 :                 if ( bb.maxy&lt;top ) {</span>
<span class="lineNum">    2086 </span><span class="lineNoCov">          0 :                     bb.maxx += tan(ia)*(top-bb.maxy);</span>
<span class="lineNum">    2087 </span><span class="lineNoCov">          0 :                     bb.maxy = top;</span>
<span class="lineNum">    2088 </span>            :                 }
<span class="lineNum">    2089 </span>            :             }
<span class="lineNum">    2090 </span>            :         }
<span class="lineNum">    2091 </span><span class="lineNoCov">          0 :         eta = false;</span>
<span class="lineNum">    2092 </span><span class="lineNoCov">          0 :         if ( ((basech&gt;=0x1f20 &amp;&amp; basech&lt;=0x1f27) || basech==0x1f74 || basech==0x1f75 || basech==0x1fc6 || basech==0x3b7 || basech==0x3ae) &amp;&amp;</span>
<span class="lineNum">    2093 </span>            :                 ch==0x345 ) {
<span class="lineNum">    2094 </span><span class="lineNoCov">          0 :             bb.miny = 0;                /* ypogegrammeni rides below baseline, not below bottom stem */</span>
<span class="lineNum">    2095 </span><span class="lineNoCov">          0 :             eta = true;</span>
<span class="lineNum">    2096 </span><span class="lineNoCov">          0 :             if ( basersc!=NULL &amp;&amp; basersc-&gt;vstem!=NULL ) {</span>
<span class="lineNum">    2097 </span><span class="lineNoCov">          0 :                 bb.minx = basersc-&gt;vstem-&gt;start;</span>
<span class="lineNum">    2098 </span><span class="lineNoCov">          0 :                 bb.maxx = bb.minx + basersc-&gt;vstem-&gt;width;</span>
<span class="lineNum">    2099 </span>            :             } else
<span class="lineNum">    2100 </span><span class="lineNoCov">          0 :                 bb.maxx -= (bb.maxx-bb.minx)/3; /* Should also be centered on left stem of eta, but I don't know how to do that..., hence this hack */</span>
<span class="lineNum">    2101 </span>            :         }
<span class="lineNum">    2102 </span>            : 
<span class="lineNum">    2103 </span><span class="lineNoCov">          0 :         if ( invert ) {</span>
<span class="lineNum">    2104 </span>            :             /* yes, this transform does a vertical flip from the vertical midpoint of the breve */
<span class="lineNum">    2105 </span><span class="lineNoCov">          0 :             transform[3] = -1;</span>
<span class="lineNum">    2106 </span><span class="lineNoCov">          0 :             transform[5] = rbb.maxy+rbb.miny;</span>
<span class="lineNum">    2107 </span>            :         }
<span class="lineNum">    2108 </span><span class="lineNoCov">          0 :         if ( pos==FF_UNICODE_NOPOSDATAGIVEN ) {</span>
<span class="lineNum">    2109 </span>            :             /* if here, then we need to initialize some type of position info for the accent */
<span class="lineNum">    2110 </span><span class="lineNoCov">          0 :             if ( ch&lt;0 || ch&gt;=0x10000 )    /* makeutype.c only built data in utype.c for {0...MAXC} */</span>
<span class="lineNum">    2111 </span><span class="lineNoCov">          0 :                 pos = FF_UNICODE_ABOVE;</span>
<span class="lineNum">    2112 </span>            :             else
<span class="lineNum">    2113 </span><span class="lineNoCov">          0 :                 pos = ff_unicode_utype2[1+ch];  /* init with unicode.org position information */</span>
<span class="lineNum">    2114 </span>            :             /* In greek, PSILI and friends are centered above lower case, and kern left*/
<span class="lineNum">    2115 </span>            :             /*  for upper case */
<span class="lineNum">    2116 </span><span class="lineNoCov">          0 :             if (( basech&gt;=0x390 &amp;&amp; basech&lt;=0x3ff) || (basech&gt;=0x1f00 &amp;&amp; basech&lt;=0x1fff)) {</span>
<span class="lineNum">    2117 </span><span class="lineNoCov">          0 :                 if ( ( basech==0x1fbf || basech==0x1fef || basech==0x1ffe ) &amp;&amp;</span>
<span class="lineNum">    2118 </span><span class="lineNoCov">          0 :                         (ch==0x1fbf || ch==0x1fef || ch==0x1ffe || ch==0x1fbd || ch==0x1ffd )) {</span>
<span class="lineNum">    2119 </span><span class="lineNoCov">          0 :                     pos = FF_UNICODE_ABOVE|FF_UNICODE_RIGHT;</span>
<span class="lineNum">    2120 </span><span class="lineNoCov">          0 :                 } else if ( isupper(basech) &amp;&amp;</span>
<span class="lineNum">    2121 </span><span class="lineNoCov">          0 :                         (ch==0x313 || ch==0x314 || ch==0x301 || ch==0x300 || ch==0x30d ||</span>
<span class="lineNum">    2122 </span><span class="lineNoCov">          0 :                          ch==0x1ffe || ch==0x1fbf || ch==0x1fcf || ch==0x1fdf ||</span>
<span class="lineNum">    2123 </span><span class="lineNoCov">          0 :                          ch==0x1fbd || ch==0x1fef || ch==0x1ffd ||</span>
<span class="lineNum">    2124 </span><span class="lineNoCov">          0 :                          ch==0x1fcd || ch==0x1fdd || ch==0x1fce || ch==0x1fde ) )</span>
<span class="lineNum">    2125 </span><span class="lineNoCov">          0 :                     pos = FF_UNICODE_ABOVE|FF_UNICODE_LEFT;</span>
<span class="lineNum">    2126 </span><span class="lineNoCov">          0 :                 else if ( isupper(basech) &amp;&amp; ch==0x1fbe )</span>
<span class="lineNum">    2127 </span><span class="lineNoCov">          0 :                     pos = FF_UNICODE_RIGHT;</span>
<span class="lineNum">    2128 </span><span class="lineNoCov">          0 :                 else if ( ch==0x1fcd || ch==0x1fdd || ch==0x1fce || ch==0x1fde ||</span>
<span class="lineNum">    2129 </span><span class="lineNoCov">          0 :                          ch==0x1ffe || ch==0x1fbf || ch==0x1fcf || ch==0x1fdf ||</span>
<span class="lineNum">    2130 </span>            :                          ch==0x384 )
<span class="lineNum">    2131 </span><span class="lineNoCov">          0 :                     pos = FF_UNICODE_ABOVE;</span>
<span class="lineNum">    2132 </span><span class="lineNoCov">          0 :             } else if ( (basech==0x1ffe || basech==0x1fbf) &amp;&amp; (ch==0x301 || ch==0x300))</span>
<span class="lineNum">    2133 </span><span class="lineNoCov">          0 :                 pos = FF_UNICODE_RIGHT;</span>
<span class="lineNum">    2134 </span><span class="lineNoCov">          0 :             else if ( sc-&gt;unicodeenc==0x1fbe &amp;&amp; ch==0x345 )</span>
<span class="lineNum">    2135 </span><span class="lineNoCov">          0 :                 pos = FF_UNICODE_RIGHT;</span>
<span class="lineNum">    2136 </span><span class="lineNoCov">          0 :             else if ( basech=='l' &amp;&amp; ch==0xb7 )</span>
<span class="lineNum">    2137 </span><span class="lineNoCov">          0 :                 pos = FF_UNICODE_RIGHT|FF_UNICODE_OVERSTRIKE;</span>
<span class="lineNum">    2138 </span><span class="lineNoCov">          0 :             else if ( basech=='L' &amp;&amp; ch==0xb7 )</span>
<span class="lineNum">    2139 </span><span class="lineNoCov">          0 :                 pos = FF_UNICODE_OVERSTRIKE;</span>
<span class="lineNum">    2140 </span><span class="lineNoCov">          0 :             else if ( ch==0xb7 )</span>
<span class="lineNum">    2141 </span><span class="lineNoCov">          0 :                 pos = FF_UNICODE_RIGHT;</span>
<span class="lineNum">    2142 </span><span class="lineNoCov">          0 :             else if ( basech=='A' &amp;&amp; ch==0x30a )        /* Aring usually touches */</span>
<span class="lineNum">    2143 </span><span class="lineNoCov">          0 :                 pos = FF_UNICODE_ABOVE|FF_UNICODE_TOUCHING;</span>
<span class="lineNum">    2144 </span><span class="lineNoCov">          0 :             else if (( basech=='A' || basech=='a' || basech=='E' || basech=='u' ) &amp;&amp;</span>
<span class="lineNum">    2145 </span>            :                     ch == 0x328 )
<span class="lineNum">    2146 </span><span class="lineNoCov">          0 :                 pos = FF_UNICODE_BELOW|FF_UNICODE_CENTERRIGHT|FF_UNICODE_TOUCHING;      /* ogonek off to the right for these in polish (but not lc e) */</span>
<span class="lineNum">    2147 </span><span class="lineNoCov">          0 :             else if (( basech=='N' || basech=='n' || basech=='K' || basech=='k' || basech=='R' || basech=='r' || basech=='H' || basech=='h' ) &amp;&amp;</span>
<span class="lineNum">    2148 </span>            :                     ch == 0x327 )
<span class="lineNum">    2149 </span><span class="lineNoCov">          0 :                 pos = FF_UNICODE_BELOW|FF_UNICODE_CENTERLEFT|FF_UNICODE_TOUCHING;       /* cedilla off under left stem for these guys */</span>
<span class="lineNum">    2150 </span><span class="lineNoCov">          0 :             if ( basech==0x391 &amp;&amp; pos==(FF_UNICODE_ABOVE|FF_UNICODE_LEFT) ) {</span>
<span class="lineNum">    2151 </span><span class="lineNoCov">          0 :                 bb.minx += (bb.maxx-bb.minx)/4;</span>
<span class="lineNum">    2152 </span>            :             }
<span class="lineNum">    2153 </span>            :         }
<span class="lineNum">    2154 </span><span class="lineNoCov">          0 :         if ( sc-&gt;unicodeenc==0x0149 )</span>
<span class="lineNum">    2155 </span><span class="lineNoCov">          0 :             pos = FF_UNICODE_ABOVE|FF_UNICODE_LEFT;</span>
<span class="lineNum">    2156 </span><span class="lineNoCov">          0 :         else if ( sc-&gt;unicodeenc==0x013d || sc-&gt;unicodeenc==0x013e )</span>
<span class="lineNum">    2157 </span><span class="lineNoCov">          0 :             pos = FF_UNICODE_ABOVE|FF_UNICODE_RIGHT;</span>
<span class="lineNum">    2158 </span><span class="lineNoCov">          0 :         else if ( sc-&gt;unicodeenc==0x010f || sc-&gt;unicodeenc==0x013d ||</span>
<span class="lineNum">    2159 </span><span class="lineNoCov">          0 :                   sc-&gt;unicodeenc==0x013e || sc-&gt;unicodeenc==0x0165 )</span>
<span class="lineNum">    2160 </span><span class="lineNoCov">          0 :             pos = FF_UNICODE_ABOVE|FF_UNICODE_RIGHT;</span>
<span class="lineNum">    2161 </span><span class="lineNoCov">          0 :         else if ( (sc-&gt;unicodeenc==0x1fbd || sc-&gt;unicodeenc==0x1fbf ||</span>
<span class="lineNum">    2162 </span><span class="lineNoCov">          0 :                 sc-&gt;unicodeenc==0x1ffe || sc-&gt;unicodeenc==0x1fc0 ) &amp;&amp;</span>
<span class="lineNum">    2163 </span><span class="lineNoCov">          0 :                 bb.maxy==0 &amp;&amp; bb.miny==0 ) {</span>
<span class="lineNum">    2164 </span>            :             /* Building accents on top of space */
<span class="lineNum">    2165 </span><span class="lineNoCov">          0 :             bb.maxy = 7*sf-&gt;ascent/10;</span>
<span class="lineNum">    2166 </span>            :         }
<span class="lineNum">    2167 </span>            : 
<span class="lineNum">    2168 </span><span class="lineNoCov">          0 :         if ( (pos &amp; FF_UNICODE_ABOVE) &amp;&amp; (pos &amp; (FF_UNICODE_LEFT|FF_UNICODE_RIGHT)) )</span>
<span class="lineNum">    2169 </span><span class="lineNoCov">          0 :             yoff = bb.maxy - rbb.maxy;</span>
<span class="lineNum">    2170 </span><span class="lineNoCov">          0 :         else if ( pos &amp; FF_UNICODE_ABOVE ) {</span>
<span class="lineNum">    2171 </span><span class="lineNoCov">          0 :             yoff = bb.maxy - rbb.miny;</span>
<span class="lineNum">    2172 </span><span class="lineNoCov">          0 :             if ( !( pos &amp; FF_UNICODE_TOUCHING) )</span>
<span class="lineNum">    2173 </span><span class="lineNoCov">          0 :                 yoff += spacing;</span>
<span class="lineNum">    2174 </span><span class="lineNoCov">          0 :         } else if ( pos &amp; FF_UNICODE_BELOW ) {</span>
<span class="lineNum">    2175 </span><span class="lineNoCov">          0 :             yoff = bb.miny - rbb.maxy;</span>
<span class="lineNum">    2176 </span><span class="lineNoCov">          0 :             if ( !( pos &amp; FF_UNICODE_TOUCHING) )</span>
<span class="lineNum">    2177 </span><span class="lineNoCov">          0 :                 yoff -= spacing;</span>
<span class="lineNum">    2178 </span><span class="lineNoCov">          0 :         } else if ( pos &amp; FF_UNICODE_OVERSTRIKE )</span>
<span class="lineNum">    2179 </span><span class="lineNoCov">          0 :             yoff = bb.miny - rbb.miny + ((bb.maxy-bb.miny)-(rbb.maxy-rbb.miny))/2;</span>
<span class="lineNum">    2180 </span>            :         else /* If neither Above, Below, nor overstrike then should use the same baseline */
<span class="lineNum">    2181 </span><span class="lineNoCov">          0 :             yoff = bb.miny - rbb.miny;</span>
<span class="lineNum">    2182 </span>            : 
<span class="lineNum">    2183 </span><span class="lineNoCov">          0 :         if ( pos &amp; (FF_UNICODE_ABOVE|FF_UNICODE_BELOW) ) {</span>
<span class="lineNum">    2184 </span>            :             /* When we center an accent above an asymetric character like &quot;C&quot; we */
<span class="lineNum">    2185 </span>            :             /*  should not pick the mid point of the char. Rather we should pick */
<span class="lineNum">    2186 </span>            :             /*  the highest point (mostly anyway, there are exceptions) */
<span class="lineNum">    2187 </span><span class="lineNoCov">          0 :             if ( pos &amp; FF_UNICODE_ABOVE ) {</span>
<span class="lineNum">    2188 </span>            :                 static DBounds pointless;
<span class="lineNum">    2189 </span><span class="lineNoCov">          0 :                 if ( CharCenterHighest ) {</span>
<span class="lineNum">    2190 </span><span class="lineNoCov">          0 :                     if ( basech!='b' &amp;&amp; basech!='d' &amp;&amp; basech!='h' &amp;&amp; basech!='n' &amp;&amp; basech!='r' &amp;&amp; basech!=0xf8 &amp;&amp;</span>
<span class="lineNum">    2191 </span><span class="lineNoCov">          0 :                             basech!='B' &amp;&amp; basech!='D' &amp;&amp; basech!='L' &amp;&amp; basech!=0xd8 )</span>
<span class="lineNum">    2192 </span><span class="lineNoCov">          0 :                         ybase = SCFindTopXRange(sc,layer,&amp;bb);</span>
<span class="lineNum">    2193 </span><span class="lineNoCov">          0 :                     if ( ((basech=='h' &amp;&amp; ch==0x307) || /* dot over the stem in hdot */</span>
<span class="lineNum">    2194 </span><span class="lineNoCov">          0 :                             basech=='i' || basech=='j' || basech==0x131 || basech==0xf6be || basech==0x237 ||</span>
<span class="lineNum">    2195 </span><span class="lineNoCov">          0 :                             (basech=='k' &amp;&amp; ch==0x301) ||</span>
<span class="lineNum">    2196 </span><span class="lineNoCov">          0 :                             (baserch=='L' &amp;&amp; (ch==0x301 || ch==0x304)) ||</span>
<span class="lineNum">    2197 </span><span class="lineNoCov">          0 :                             basech=='l' || basech=='t' ) &amp;&amp;</span>
<span class="lineNum">    2198 </span><span class="lineNoCov">          0 :                             (xoff=SCStemCheck(sf,layer,basech,&amp;bb,&amp;pointless,pos))!=0x70000000 )</span>
<span class="lineNum">    2199 </span><span class="lineNoCov">          0 :                         bb.minx = bb.maxx = xoff;               /* While on &quot;t&quot; we should center over the stem */</span>
<span class="lineNum">    2200 </span>            :                 }
<span class="lineNum">    2201 </span><span class="lineNoCov">          0 :             } else if ( ( pos &amp; FF_UNICODE_BELOW ) &amp;&amp; !eta )</span>
<span class="lineNum">    2202 </span><span class="lineNoCov">          0 :                 if ( CharCenterHighest )</span>
<span class="lineNum">    2203 </span><span class="lineNoCov">          0 :                     ybase = SCFindBottomXRange(sc,layer,&amp;bb,ia);</span>
<span class="lineNum">    2204 </span>            :         }
<span class="lineNum">    2205 </span>            : 
<span class="lineNum">    2206 </span><span class="lineNoCov">          0 :         if ( isupper(basech) &amp;&amp; ch==0x342)      /* While this guy rides above PSILI on left */</span>
<span class="lineNum">    2207 </span><span class="lineNoCov">          0 :             xoff = bb.minx - rbb.minx;</span>
<span class="lineNum">    2208 </span><span class="lineNoCov">          0 :         else if ( pos &amp; FF_UNICODE_LEFT )</span>
<span class="lineNum">    2209 </span><span class="lineNoCov">          0 :             xoff = bb.minx - spacing - rbb.maxx;</span>
<span class="lineNum">    2210 </span><span class="lineNoCov">          0 :         else if ( pos &amp; FF_UNICODE_RIGHT ) {</span>
<span class="lineNum">    2211 </span><span class="lineNoCov">          0 :             xoff = bb.maxx - rbb.minx+spacing/2;</span>
<span class="lineNum">    2212 </span><span class="lineNoCov">          0 :             if ( !( pos &amp; FF_UNICODE_TOUCHING) )</span>
<span class="lineNum">    2213 </span><span class="lineNoCov">          0 :                 xoff += spacing;</span>
<span class="lineNum">    2214 </span>            :         } else {
<span class="lineNum">    2215 </span><span class="lineNoCov">          0 :             if ( (pos &amp; (FF_UNICODE_CENTERLEFT|FF_UNICODE_CENTERRIGHT)) &amp;&amp;</span>
<span class="lineNum">    2216 </span><span class="lineNoCov">          0 :                     (xoff=SCStemCheck(sf,layer,basech,&amp;bb,&amp;rbb,pos))!=0x70000000 )</span>
<span class="lineNum">    2217 </span>            :                 /* Done */;
<span class="lineNum">    2218 </span><span class="lineNoCov">          0 :             else if ( pos &amp; FF_UNICODE_CENTERLEFT )</span>
<span class="lineNum">    2219 </span><span class="lineNoCov">          0 :                 xoff = bb.minx + (bb.maxx-bb.minx)/2 - rbb.maxx;</span>
<span class="lineNum">    2220 </span><span class="lineNoCov">          0 :             else if ( pos &amp; FF_UNICODE_LEFTEDGE )</span>
<span class="lineNum">    2221 </span><span class="lineNoCov">          0 :                 xoff = bb.minx - rbb.minx;</span>
<span class="lineNum">    2222 </span><span class="lineNoCov">          0 :             else if ( pos &amp; FF_UNICODE_CENTERRIGHT )</span>
<span class="lineNum">    2223 </span><span class="lineNoCov">          0 :                 xoff = bb.minx + (bb.maxx-bb.minx)/2 - rbb.minx;</span>
<span class="lineNum">    2224 </span><span class="lineNoCov">          0 :             else if ( pos &amp; FF_UNICODE_RIGHTEDGE )</span>
<span class="lineNum">    2225 </span><span class="lineNoCov">          0 :                 xoff = bb.maxx - rbb.maxx;</span>
<span class="lineNum">    2226 </span>            :             else
<span class="lineNum">    2227 </span><span class="lineNoCov">          0 :                 xoff = bb.minx - rbb.minx + ((bb.maxx-bb.minx)-(rbb.maxx-rbb.minx))/2;</span>
<span class="lineNum">    2228 </span>            :         }
<span class="lineNum">    2229 </span><span class="lineNoCov">          0 :         if ( ia!=0 )</span>
<span class="lineNum">    2230 </span><span class="lineNoCov">          0 :             xoff += (italicoff = tan(-ia)*(rbb.miny+yoff-ybase));</span>
<span class="lineNum">    2231 </span>            :     }   /* Anchor points */
<span class="lineNum">    2232 </span><span class="lineNoCov">          0 :     transform[4] = xoff;</span>
<span class="lineNum">    2233 </span><span class="lineNoCov">          0 :     /*if ( invert ) transform[5] -= yoff; else */transform[5] += yoff;</span>
<span class="lineNum">    2234 </span>            : 
<span class="lineNum">    2235 </span><span class="lineNoCov">          0 :     if ( bdf == NULL || !disp_only ) {</span>
<span class="lineNum">    2236 </span><span class="lineNoCov">          0 :         _SCAddRef(sc,rsc,layer,transform);</span>
<span class="lineNum">    2237 </span><span class="lineNoCov">          0 :         if ( pos != FF_UNICODE_NOPOSDATAGIVEN &amp;&amp; (pos &amp; FF_UNICODE_RIGHT) )</span>
<span class="lineNum">    2238 </span><span class="lineNoCov">          0 :             SCSynchronizeWidth(sc,sc-&gt;width + rbb.maxx-rbb.minx+spacing,sc-&gt;width,NULL);</span>
<span class="lineNum">    2239 </span><span class="lineNoCov">          0 :         if ( pos != FF_UNICODE_NOPOSDATAGIVEN &amp;&amp; (pos &amp; (FF_UNICODE_LEFT|FF_UNICODE_RIGHT|FF_UNICODE_CENTERLEFT|FF_UNICODE_LEFTEDGE|FF_UNICODE_CENTERRIGHT|FF_UNICODE_RIGHTEDGE)) )</span>
<span class="lineNum">    2240 </span><span class="lineNoCov">          0 :             TurnOffUseMyMetrics(sc);</span>
<span class="lineNum">    2241 </span>            :     }
<span class="lineNum">    2242 </span><span class="lineNoCov">          0 :     if ( !disp_only ) {</span>
<span class="lineNum">    2243 </span><span class="lineNoCov">          0 :         for ( bdf=sf-&gt;cidmaster?sf-&gt;cidmaster-&gt;bitmaps:sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">    2244 </span><span class="lineNoCov">          0 :             if ( bdf-&gt;glyphs[rsc-&gt;orig_pos] != NULL )</span>
<span class="lineNum">    2245 </span><span class="lineNoCov">          0 :                 _BCCenterAccent( bdf,sc-&gt;orig_pos,rsc-&gt;orig_pos,ch,basech,italicoff,pos,sf-&gt;ascent+sf-&gt;descent );</span>
<span class="lineNum">    2246 </span>            :         }
<span class="lineNum">    2247 </span><span class="lineNoCov">          0 :     } else if ( bdf != NULL &amp;&amp; bdf-&gt;glyphs[rsc-&gt;orig_pos] != NULL )</span>
<span class="lineNum">    2248 </span><span class="lineNoCov">          0 :         _BCCenterAccent( bdf,sc-&gt;orig_pos,rsc-&gt;orig_pos,ch,basech,italicoff,pos,sf-&gt;ascent+sf-&gt;descent );</span>
<a name="2249"><span class="lineNum">    2249 </span>            : }</a>
<span class="lineNum">    2250 </span>            : 
<span class="lineNum">    2251 </span><span class="lineNoCov">          0 : static void SCCenterAccent(SplineChar *sc,SplineChar *basersc, SplineFont *sf,</span>
<span class="lineNum">    2252 </span>            :         int layer, int ch, BDFFont *bdf,int disp_only,
<span class="lineNum">    2253 </span>            :         real ia, int basech, char *dot ) {
<span class="lineNum">    2254 </span><span class="lineNoCov">          0 :     int invert = false;                 /* invert accent, false==0, true!=0 */</span>
<span class="lineNum">    2255 </span><span class="lineNoCov">          0 :     SplineChar *rsc = GetGoodAccentGlyph(sf,ch,basech,&amp;invert,ia,dot,sc);</span>
<span class="lineNum">    2256 </span>            : 
<span class="lineNum">    2257 </span>            :     /* find a location to put an accent on this character */
<span class="lineNum">    2258 </span><span class="lineNoCov">          0 :     _SCCenterAccent(sc,basersc,sf,layer,ch,bdf,disp_only,rsc,ia,basech,invert,FF_UNICODE_NOPOSDATAGIVEN);</span>
<a name="2259"><span class="lineNum">    2259 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2260 </span>            : 
<span class="lineNum">    2261 </span><span class="lineNoCov">          0 : static void _BCPutRefAfter( BDFFont *bdf,int gid,int rgid,int normal,int under ) {</span>
<span class="lineNum">    2262 </span>            :     BDFChar *bc, *rbc;
<span class="lineNum">    2263 </span>            :     int ispacing;
<span class="lineNum">    2264 </span>            : 
<span class="lineNum">    2265 </span><span class="lineNoCov">          0 :     if ( bdf-&gt;glyphs[rgid]!=NULL &amp;&amp; bdf-&gt;glyphs[gid]!=NULL ) {</span>
<span class="lineNum">    2266 </span><span class="lineNoCov">          0 :         rbc = bdf-&gt;glyphs[rgid];</span>
<span class="lineNum">    2267 </span><span class="lineNoCov">          0 :         bc = bdf-&gt;glyphs[gid];</span>
<span class="lineNum">    2268 </span><span class="lineNoCov">          0 :         BCFlattenFloat(rbc);</span>
<span class="lineNum">    2269 </span><span class="lineNoCov">          0 :         BCCompressBitmap(rbc);</span>
<span class="lineNum">    2270 </span><span class="lineNoCov">          0 :         BCCompressBitmap(bc);</span>
<span class="lineNum">    2271 </span><span class="lineNoCov">          0 :         if ( (ispacing = (bdf-&gt;pixelsize*accent_offset+50)/100)&lt;=1 ) ispacing = 2;</span>
<span class="lineNum">    2272 </span><span class="lineNoCov">          0 :         if ( normal ) {</span>
<span class="lineNum">    2273 </span><span class="lineNoCov">          0 :             BCAddReference( bc,rbc,rgid,bc-&gt;width,0 );</span>
<span class="lineNum">    2274 </span><span class="lineNoCov">          0 :             bc-&gt;width += rbc-&gt;width;</span>
<span class="lineNum">    2275 </span><span class="lineNoCov">          0 :         } else if ( under ) {</span>
<span class="lineNum">    2276 </span><span class="lineNoCov">          0 :             BCAddReference( bc,rbc,rgid,</span>
<span class="lineNum">    2277 </span><span class="lineNoCov">          0 :                     (bc-&gt;xmax+rbc-&gt;xmin-rbc-&gt;xmax-rbc-&gt;xmin)/2,</span>
<span class="lineNum">    2278 </span><span class="lineNoCov">          0 :                     bc-&gt;ymin-ispacing-rbc-&gt;ymax );</span>
<span class="lineNum">    2279 </span>            :         } else {
<span class="lineNum">    2280 </span><span class="lineNoCov">          0 :             BCAddReference( bc,rbc,rgid,bc-&gt;xmax-ispacing-rbc-&gt;xmin,0 );</span>
<span class="lineNum">    2281 </span>            :         }
<span class="lineNum">    2282 </span>            :     }
<a name="2283"><span class="lineNum">    2283 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2284 </span>            : 
<span class="lineNum">    2285 </span><span class="lineNoCov">          0 : static void SCPutRefAfter(SplineChar *sc,SplineFont *sf,int layer, int ch,</span>
<span class="lineNum">    2286 </span>            :         BDFFont *bdf,int disp_only, char *dot) {
<span class="lineNum">    2287 </span><span class="lineNoCov">          0 :     SplineChar *rsc = SFGetChar(sf,ch,NULL);</span>
<span class="lineNum">    2288 </span><span class="lineNoCov">          0 :     int full = sc-&gt;unicodeenc, normal = false, under = false/*, stationary=false*/;</span>
<span class="lineNum">    2289 </span>            :     DBounds bb, rbb;
<span class="lineNum">    2290 </span><span class="lineNoCov">          0 :     real spacing = (sf-&gt;ascent+sf-&gt;descent)*accent_offset/100;</span>
<span class="lineNum">    2291 </span>            :     char buffer[300], namebuf[300];
<span class="lineNum">    2292 </span>            : 
<span class="lineNum">    2293 </span><span class="lineNoCov">          0 :     if ( bdf == NULL || !disp_only ) {</span>
<span class="lineNum">    2294 </span><span class="lineNoCov">          0 :         if ( dot!=NULL &amp;&amp; rsc!=NULL ) {</span>
<span class="lineNum">    2295 </span><span class="lineNoCov">          0 :             snprintf(buffer,sizeof(buffer),&quot;%s%s&quot;, rsc-&gt;name, dot );</span>
<span class="lineNum">    2296 </span><span class="lineNoCov">          0 :             rsc = SFGetChar(sf,-1,buffer);</span>
<span class="lineNum">    2297 </span><span class="lineNoCov">          0 :         } else if ( dot!=NULL ) {</span>
<span class="lineNum">    2298 </span><span class="lineNoCov">          0 :             snprintf(buffer,sizeof(buffer),&quot;%s%s&quot;,</span>
<span class="lineNum">    2299 </span><span class="lineNoCov">          0 :                     (char *) StdGlyphName(namebuf,ch,sf-&gt;uni_interp,sf-&gt;for_new_glyphs),</span>
<span class="lineNum">    2300 </span>            :                     dot);
<span class="lineNum">    2301 </span><span class="lineNoCov">          0 :             rsc = SFGetChar(sf,-1,buffer);</span>
<span class="lineNum">    2302 </span>            :         }
<span class="lineNum">    2303 </span>            : 
<span class="lineNum">    2304 </span><span class="lineNoCov">          0 :         if ( full&lt;0x1100 || full&gt;0x11ff ) {</span>
<span class="lineNum">    2305 </span><span class="lineNoCov">          0 :             SCAddRef(sc,rsc,layer,sc-&gt;width,0);</span>
<span class="lineNum">    2306 </span><span class="lineNoCov">          0 :             sc-&gt;width += rsc-&gt;width;</span>
<span class="lineNum">    2307 </span><span class="lineNoCov">          0 :             normal = true;</span>
<span class="lineNum">    2308 </span>            :     /* these two jamo (same consonant really) ride underneath (except sometimes) */
<span class="lineNum">    2309 </span>            :     /* So should the jungsong */
<span class="lineNum">    2310 </span><span class="lineNoCov">          0 :         } else if (( ch==0x110b &amp;&amp; (full!=0x1135 &amp;&amp; full!=0x1147 &amp;&amp; full!=0x114d)) ||</span>
<span class="lineNum">    2311 </span><span class="lineNoCov">          0 :                     (ch==0x11bc &amp;&amp; full!=0x11ee) ||</span>
<span class="lineNum">    2312 </span><span class="lineNoCov">          0 :                     full==0x1182 || full==0x1183 || full==0x1187 || (full==0x118b &amp;&amp; ch==0x1173) ||</span>
<span class="lineNum">    2313 </span><span class="lineNoCov">          0 :                     full==0x118d || full==0x1193 || (full&gt;=0x1195 &amp;&amp; full&lt;=0x1197) ||</span>
<span class="lineNum">    2314 </span><span class="lineNoCov">          0 :                     full==0x119d || full==0x11a0 ) {</span>
<span class="lineNum">    2315 </span><span class="lineNoCov">          0 :             SplineCharQuickBounds(sc,&amp;bb);</span>
<span class="lineNum">    2316 </span><span class="lineNoCov">          0 :             SplineCharQuickBounds(rsc,&amp;rbb);</span>
<span class="lineNum">    2317 </span><span class="lineNoCov">          0 :             SCAddRef(sc,rsc,layer,(bb.maxx+bb.minx)/2-(rbb.maxx+rbb.minx)/2,bb.miny-spacing-rbb.maxy);</span>
<span class="lineNum">    2318 </span><span class="lineNoCov">          0 :             under = true;</span>
<span class="lineNum">    2319 </span>            :         } else {        /* Jamo should snuggle right up to one another, and ignore the width */
<span class="lineNum">    2320 </span><span class="lineNoCov">          0 :             SplineCharQuickBounds(sc,&amp;bb);</span>
<span class="lineNum">    2321 </span><span class="lineNoCov">          0 :             SplineCharQuickBounds(rsc,&amp;rbb);</span>
<span class="lineNum">    2322 </span><span class="lineNoCov">          0 :             SCAddRef(sc,rsc,layer,bb.maxx+spacing-rbb.minx,0);</span>
<span class="lineNum">    2323 </span>            :         }
<span class="lineNum">    2324 </span>            :     }
<span class="lineNum">    2325 </span><span class="lineNoCov">          0 :     if ( !disp_only ) {</span>
<span class="lineNum">    2326 </span><span class="lineNoCov">          0 :         for ( bdf=sf-&gt;cidmaster?sf-&gt;cidmaster-&gt;bitmaps:sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">    2327 </span><span class="lineNoCov">          0 :             _BCPutRefAfter( bdf,sc-&gt;orig_pos,rsc-&gt;orig_pos,normal,under );</span>
<span class="lineNum">    2328 </span>            :         }
<span class="lineNum">    2329 </span><span class="lineNoCov">          0 :     } else if ( bdf != NULL )</span>
<span class="lineNum">    2330 </span><span class="lineNoCov">          0 :         _BCPutRefAfter( bdf,sc-&gt;orig_pos,rsc-&gt;orig_pos,normal,under );</span>
<a name="2331"><span class="lineNum">    2331 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2332 </span>            : 
<span class="lineNum">    2333 </span><span class="lineNoCov">          0 : static void BCMakeSpace(BDFFont *bdf, int gid, int width, int em) {</span>
<span class="lineNum">    2334 </span>            :     BDFChar *bc;
<span class="lineNum">    2335 </span>            : 
<span class="lineNum">    2336 </span><span class="lineNoCov">          0 :     if ( (bc = bdf-&gt;glyphs[gid])==NULL ) {</span>
<span class="lineNum">    2337 </span><span class="lineNoCov">          0 :         BDFMakeGID( bdf,gid );</span>
<span class="lineNum">    2338 </span>            :     } else {
<span class="lineNum">    2339 </span><span class="lineNoCov">          0 :         BCPreserveState(bc);</span>
<span class="lineNum">    2340 </span><span class="lineNoCov">          0 :         BCFlattenFloat(bc);</span>
<span class="lineNum">    2341 </span><span class="lineNoCov">          0 :         BCCompressBitmap(bc);</span>
<span class="lineNum">    2342 </span><span class="lineNoCov">          0 :         free(bc-&gt;bitmap);</span>
<span class="lineNum">    2343 </span><span class="lineNoCov">          0 :         bc-&gt;xmin = 0;</span>
<span class="lineNum">    2344 </span><span class="lineNoCov">          0 :         bc-&gt;xmax = 1;</span>
<span class="lineNum">    2345 </span><span class="lineNoCov">          0 :         bc-&gt;ymin = 0;</span>
<span class="lineNum">    2346 </span><span class="lineNoCov">          0 :         bc-&gt;ymax = 1;</span>
<span class="lineNum">    2347 </span><span class="lineNoCov">          0 :         bc-&gt;bytes_per_line = 1;</span>
<span class="lineNum">    2348 </span><span class="lineNoCov">          0 :         bc-&gt;width = rint(width*bdf-&gt;pixelsize/(real) em);</span>
<span class="lineNum">    2349 </span><span class="lineNoCov">          0 :         bc-&gt;bitmap = calloc(bc-&gt;bytes_per_line*(bc-&gt;ymax-bc-&gt;ymin+1),sizeof(char));</span>
<span class="lineNum">    2350 </span>            :     }
<a name="2351"><span class="lineNum">    2351 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2352 </span>            : 
<span class="lineNum">    2353 </span><span class="lineNoCov">          0 : static void DoSpaces(SplineFont *sf,SplineChar *sc,int layer,BDFFont *bdf,int disp_only) {</span>
<span class="lineNum">    2354 </span>            :     int width;
<span class="lineNum">    2355 </span><span class="lineNoCov">          0 :     int uni = sc-&gt;unicodeenc;</span>
<span class="lineNum">    2356 </span><span class="lineNoCov">          0 :     int em = sf-&gt;ascent+sf-&gt;descent;</span>
<span class="lineNum">    2357 </span>            :     SplineChar *tempsc;
<span class="lineNum">    2358 </span>            : 
<span class="lineNum">    2359 </span><span class="lineNoCov">          0 :     if ( iszerowidth(uni))</span>
<span class="lineNum">    2360 </span><span class="lineNoCov">          0 :         width = 0;</span>
<span class="lineNum">    2361 </span><span class="lineNoCov">          0 :     else switch ( uni ) {</span>
<span class="lineNum">    2362 </span>            :       case 0x2000: case 0x2002:
<span class="lineNum">    2363 </span><span class="lineNoCov">          0 :         width = em/2;</span>
<span class="lineNum">    2364 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2365 </span>            :       case 0x2001: case 0x2003:
<span class="lineNum">    2366 </span><span class="lineNoCov">          0 :         width = em;</span>
<span class="lineNum">    2367 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2368 </span>            :       case 0x2004:
<span class="lineNum">    2369 </span><span class="lineNoCov">          0 :         width = em/3;</span>
<span class="lineNum">    2370 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2371 </span>            :       case 0x2005:
<span class="lineNum">    2372 </span><span class="lineNoCov">          0 :         width = em/4;</span>
<span class="lineNum">    2373 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2374 </span>            :       case 0x2006:
<span class="lineNum">    2375 </span><span class="lineNoCov">          0 :         width = em/6;</span>
<span class="lineNum">    2376 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2377 </span>            :       case 0x2009:
<span class="lineNum">    2378 </span><span class="lineNoCov">          0 :         width = em/10;</span>
<span class="lineNum">    2379 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2380 </span>            :       case 0x200a:
<span class="lineNum">    2381 </span><span class="lineNoCov">          0 :         width = em/100;</span>
<span class="lineNum">    2382 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2383 </span>            :       case 0x2007:
<span class="lineNum">    2384 </span><span class="lineNoCov">          0 :         tempsc = SFGetChar(sf,'0',NULL);</span>
<span class="lineNum">    2385 </span><span class="lineNoCov">          0 :         if ( tempsc!=NULL &amp;&amp; tempsc-&gt;layers[layer].splines==NULL &amp;&amp; tempsc-&gt;layers[layer].refs==NULL ) tempsc = NULL;</span>
<span class="lineNum">    2386 </span><span class="lineNoCov">          0 :         if ( tempsc==NULL ) width = em/2; else width = tempsc-&gt;width;</span>
<span class="lineNum">    2387 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2388 </span>            :       case 0x2008:
<span class="lineNum">    2389 </span><span class="lineNoCov">          0 :         tempsc = SFGetChar(sf,'.',NULL);</span>
<span class="lineNum">    2390 </span><span class="lineNoCov">          0 :         if ( tempsc!=NULL &amp;&amp; tempsc-&gt;layers[layer].splines==NULL &amp;&amp; tempsc-&gt;layers[layer].refs==NULL ) tempsc = NULL;</span>
<span class="lineNum">    2391 </span><span class="lineNoCov">          0 :         if ( tempsc==NULL ) width = em/4; else width = tempsc-&gt;width;</span>
<span class="lineNum">    2392 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2393 </span>            :       case ' ':
<span class="lineNum">    2394 </span><span class="lineNoCov">          0 :         tempsc = SFGetChar(sf,'I',NULL);</span>
<span class="lineNum">    2395 </span><span class="lineNoCov">          0 :         if ( tempsc!=NULL &amp;&amp; tempsc-&gt;layers[layer].splines==NULL &amp;&amp; tempsc-&gt;layers[layer].refs==NULL ) tempsc = NULL;</span>
<span class="lineNum">    2396 </span><span class="lineNoCov">          0 :         if ( tempsc==NULL ) width = em/4; else width = tempsc-&gt;width;</span>
<span class="lineNum">    2397 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2398 </span>            :       default:
<span class="lineNum">    2399 </span><span class="lineNoCov">          0 :         width = em/3;</span>
<span class="lineNum">    2400 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2401 </span>            :     }
<span class="lineNum">    2402 </span>            : 
<span class="lineNum">    2403 </span><span class="lineNoCov">          0 :     if ( !disp_only || bdf == NULL ) {</span>
<span class="lineNum">    2404 </span><span class="lineNoCov">          0 :         sc-&gt;width = width;</span>
<span class="lineNum">    2405 </span><span class="lineNoCov">          0 :         sc-&gt;widthset = true;</span>
<span class="lineNum">    2406 </span><span class="lineNoCov">          0 :         SCCharChangedUpdate(sc,ly_none);</span>
<span class="lineNum">    2407 </span>            :     }
<span class="lineNum">    2408 </span>            : 
<span class="lineNum">    2409 </span><span class="lineNoCov">          0 :     if ( !disp_only ) {</span>
<span class="lineNum">    2410 </span><span class="lineNoCov">          0 :         for ( bdf=sf-&gt;cidmaster?sf-&gt;cidmaster-&gt;bitmaps:sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">    2411 </span><span class="lineNoCov">          0 :             BCMakeSpace( bdf,sc-&gt;orig_pos,width,em );</span>
<span class="lineNum">    2412 </span><span class="lineNoCov">          0 :             BCCharChangedUpdate(bdf-&gt;glyphs[sc-&gt;orig_pos]);</span>
<span class="lineNum">    2413 </span>            :         }
<span class="lineNum">    2414 </span><span class="lineNoCov">          0 :     } else if ( bdf != NULL ) {</span>
<span class="lineNum">    2415 </span><span class="lineNoCov">          0 :         BCMakeSpace( bdf,sc-&gt;orig_pos,width,em );</span>
<span class="lineNum">    2416 </span><span class="lineNoCov">          0 :         BCCharChangedUpdate(bdf-&gt;glyphs[sc-&gt;orig_pos]);</span>
<span class="lineNum">    2417 </span>            :     }
<a name="2418"><span class="lineNum">    2418 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2419 </span>            : 
<span class="lineNum">    2420 </span><span class="lineNoCov">          0 : static SplinePoint *MakeSP(real x, real y, SplinePoint *last,int order2) {</span>
<span class="lineNum">    2421 </span><span class="lineNoCov">          0 :     SplinePoint *new = chunkalloc(sizeof(SplinePoint));</span>
<span class="lineNum">    2422 </span>            : 
<span class="lineNum">    2423 </span><span class="lineNoCov">          0 :     new-&gt;me.x = x; new-&gt;me.y = y;</span>
<span class="lineNum">    2424 </span><span class="lineNoCov">          0 :     new-&gt;prevcp = new-&gt;nextcp = new-&gt;me;</span>
<span class="lineNum">    2425 </span><span class="lineNoCov">          0 :     new-&gt;noprevcp = new-&gt;nonextcp = true;</span>
<span class="lineNum">    2426 </span><span class="lineNoCov">          0 :     new-&gt;pointtype = pt_corner;</span>
<span class="lineNum">    2427 </span><span class="lineNoCov">          0 :     if ( last!=NULL )</span>
<span class="lineNum">    2428 </span><span class="lineNoCov">          0 :         SplineMake(last,new,order2);</span>
<span class="lineNum">    2429 </span><span class="lineNoCov">          0 : return( new );</span>
<a name="2430"><span class="lineNum">    2430 </span>            : }</a>
<span class="lineNum">    2431 </span>            : 
<span class="lineNum">    2432 </span><span class="lineNoCov">          0 : static void BCMakeRule(BDFFont *bdf, int gid, int layer) {</span>
<span class="lineNum">    2433 </span>            :     BDFChar *bc, *tempbc;
<span class="lineNum">    2434 </span>            : 
<span class="lineNum">    2435 </span><span class="lineNoCov">          0 :     if ( (bc = bdf-&gt;glyphs[gid])==NULL ) {</span>
<span class="lineNum">    2436 </span><span class="lineNoCov">          0 :         BDFMakeGID(bdf,gid);</span>
<span class="lineNum">    2437 </span>            :     } else {
<span class="lineNum">    2438 </span><span class="lineNoCov">          0 :         BCPreserveState(bc);</span>
<span class="lineNum">    2439 </span><span class="lineNoCov">          0 :         BCFlattenFloat(bc);</span>
<span class="lineNum">    2440 </span><span class="lineNoCov">          0 :         BCCompressBitmap(bc);</span>
<span class="lineNum">    2441 </span><span class="lineNoCov">          0 :         free(bc-&gt;bitmap);</span>
<span class="lineNum">    2442 </span><span class="lineNoCov">          0 :         tempbc = SplineCharRasterize(bc-&gt;sc,layer,bdf-&gt;pixelsize);</span>
<span class="lineNum">    2443 </span><span class="lineNoCov">          0 :         bc-&gt;xmin = tempbc-&gt;xmin;</span>
<span class="lineNum">    2444 </span><span class="lineNoCov">          0 :         bc-&gt;xmax = tempbc-&gt;xmax;</span>
<span class="lineNum">    2445 </span><span class="lineNoCov">          0 :         bc-&gt;ymin = tempbc-&gt;ymin;</span>
<span class="lineNum">    2446 </span><span class="lineNoCov">          0 :         bc-&gt;ymax = tempbc-&gt;ymax;</span>
<span class="lineNum">    2447 </span><span class="lineNoCov">          0 :         bc-&gt;bytes_per_line = tempbc-&gt;bytes_per_line;</span>
<span class="lineNum">    2448 </span><span class="lineNoCov">          0 :         bc-&gt;width = tempbc-&gt;width;</span>
<span class="lineNum">    2449 </span><span class="lineNoCov">          0 :         bc-&gt;bitmap = tempbc-&gt;bitmap;</span>
<span class="lineNum">    2450 </span><span class="lineNoCov">          0 :         free(tempbc);</span>
<span class="lineNum">    2451 </span>            :     }
<a name="2452"><span class="lineNum">    2452 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2453 </span>            : 
<span class="lineNum">    2454 </span><span class="lineNoCov">          0 : static void DoRules(SplineFont *sf,SplineChar *sc,int layer,BDFFont *bdf,int disp_only) {</span>
<span class="lineNum">    2455 </span>            :     int width;
<span class="lineNum">    2456 </span><span class="lineNoCov">          0 :     int uni = sc-&gt;unicodeenc;</span>
<span class="lineNum">    2457 </span><span class="lineNoCov">          0 :     int em = sf-&gt;ascent+sf-&gt;descent;</span>
<span class="lineNum">    2458 </span>            :     SplineChar *tempsc;
<span class="lineNum">    2459 </span>            :     DBounds b;
<span class="lineNum">    2460 </span>            :     real lbearing, rbearing, height, ypos;
<span class="lineNum">    2461 </span>            :     SplinePoint *first, *sp;
<span class="lineNum">    2462 </span>            : 
<span class="lineNum">    2463 </span><span class="lineNoCov">          0 :     switch ( uni ) {</span>
<span class="lineNum">    2464 </span>            :       case '-':
<span class="lineNum">    2465 </span><span class="lineNoCov">          0 :         width = em/3;</span>
<span class="lineNum">    2466 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2467 </span>            :       case 0x2010: case 0x2011:
<span class="lineNum">    2468 </span><span class="lineNoCov">          0 :         tempsc = SFGetChar(sf,'-',NULL);</span>
<span class="lineNum">    2469 </span><span class="lineNoCov">          0 :         if ( tempsc!=NULL &amp;&amp; tempsc-&gt;layers[layer].splines==NULL &amp;&amp; tempsc-&gt;layers[layer].refs==NULL ) tempsc = NULL;</span>
<span class="lineNum">    2470 </span><span class="lineNoCov">          0 :         if ( tempsc==NULL ) width = (4*em)/10; else width = tempsc-&gt;width;</span>
<span class="lineNum">    2471 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2472 </span>            :       case 0x2012:
<span class="lineNum">    2473 </span><span class="lineNoCov">          0 :         tempsc = SFGetChar(sf,'0',NULL);</span>
<span class="lineNum">    2474 </span><span class="lineNoCov">          0 :         if ( tempsc!=NULL &amp;&amp; tempsc-&gt;layers[layer].splines==NULL &amp;&amp; tempsc-&gt;layers[layer].refs==NULL ) tempsc = NULL;</span>
<span class="lineNum">    2475 </span><span class="lineNoCov">          0 :         if ( tempsc==NULL ) width = em/2; else width = tempsc-&gt;width;</span>
<span class="lineNum">    2476 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2477 </span>            :       case 0x2013:
<span class="lineNum">    2478 </span><span class="lineNoCov">          0 :         width = em/2;</span>
<span class="lineNum">    2479 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2480 </span>            :       case 0x2014: case 0x30fc:
<span class="lineNum">    2481 </span><span class="lineNoCov">          0 :         width = em;</span>
<span class="lineNum">    2482 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2483 </span>            :       case 0x2015:              /* French quotation dash */
<span class="lineNum">    2484 </span><span class="lineNoCov">          0 :         width = 2*em;</span>
<span class="lineNum">    2485 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2486 </span>            :       default:
<span class="lineNum">    2487 </span><span class="lineNoCov">          0 :         width = em/3;</span>
<span class="lineNum">    2488 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2489 </span>            :     }
<span class="lineNum">    2490 </span>            : 
<span class="lineNum">    2491 </span><span class="lineNoCov">          0 :     tempsc = SFGetChar(sf,'-',NULL);</span>
<span class="lineNum">    2492 </span><span class="lineNoCov">          0 :     if ( tempsc==NULL || (tempsc-&gt;layers[layer].splines==NULL &amp;&amp; tempsc-&gt;layers[layer].refs==NULL )) {</span>
<span class="lineNum">    2493 </span><span class="lineNoCov">          0 :         height = em/10;</span>
<span class="lineNum">    2494 </span><span class="lineNoCov">          0 :         lbearing = rbearing = em/10;</span>
<span class="lineNum">    2495 </span><span class="lineNoCov">          0 :         if ( lbearing+rbearing&gt;2*width/3 )</span>
<span class="lineNum">    2496 </span><span class="lineNoCov">          0 :             lbearing = rbearing = width/4;</span>
<span class="lineNum">    2497 </span><span class="lineNoCov">          0 :         ypos = em/4;</span>
<span class="lineNum">    2498 </span>            :     } else {
<span class="lineNum">    2499 </span><span class="lineNoCov">          0 :         SplineCharFindBounds(tempsc,&amp;b);</span>
<span class="lineNum">    2500 </span><span class="lineNoCov">          0 :         height = b.maxy-b.miny;</span>
<span class="lineNum">    2501 </span><span class="lineNoCov">          0 :         rbearing = tempsc-&gt;width - b.maxx;</span>
<span class="lineNum">    2502 </span><span class="lineNoCov">          0 :         lbearing = b.minx;</span>
<span class="lineNum">    2503 </span><span class="lineNoCov">          0 :         ypos = b.miny;</span>
<span class="lineNum">    2504 </span>            :     }
<span class="lineNum">    2505 </span><span class="lineNoCov">          0 :     if ( bdf == NULL || !disp_only ) {</span>
<span class="lineNum">    2506 </span><span class="lineNoCov">          0 :         first = sp = MakeSP(lbearing,ypos,NULL,sc-&gt;layers[layer].order2);</span>
<span class="lineNum">    2507 </span><span class="lineNoCov">          0 :         sp = MakeSP(lbearing,ypos+height,sp,sc-&gt;layers[layer].order2);</span>
<span class="lineNum">    2508 </span><span class="lineNoCov">          0 :         sp = MakeSP(width-rbearing,ypos+height,sp,sc-&gt;layers[layer].order2);</span>
<span class="lineNum">    2509 </span><span class="lineNoCov">          0 :         sp = MakeSP(width-rbearing,ypos,sp,sc-&gt;layers[layer].order2);</span>
<span class="lineNum">    2510 </span><span class="lineNoCov">          0 :         SplineMake(sp,first,sc-&gt;layers[layer].order2);</span>
<span class="lineNum">    2511 </span><span class="lineNoCov">          0 :         sc-&gt;layers[layer].splines = chunkalloc(sizeof(SplinePointList));</span>
<span class="lineNum">    2512 </span><span class="lineNoCov">          0 :         sc-&gt;layers[layer].splines-&gt;first = sc-&gt;layers[layer].splines-&gt;last = first;</span>
<span class="lineNum">    2513 </span><span class="lineNoCov">          0 :         sc-&gt;layers[layer].splines-&gt;start_offset = 0;</span>
<span class="lineNum">    2514 </span><span class="lineNoCov">          0 :         sc-&gt;width = width;</span>
<span class="lineNum">    2515 </span><span class="lineNoCov">          0 :         sc-&gt;widthset = true;</span>
<span class="lineNum">    2516 </span><span class="lineNoCov">          0 :         SCCharChangedUpdate(sc,layer);</span>
<span class="lineNum">    2517 </span>            :     }
<span class="lineNum">    2518 </span>            : 
<span class="lineNum">    2519 </span><span class="lineNoCov">          0 :     if ( !disp_only ) {</span>
<span class="lineNum">    2520 </span><span class="lineNoCov">          0 :         for ( bdf=sf-&gt;cidmaster?sf-&gt;cidmaster-&gt;bitmaps:sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">    2521 </span><span class="lineNoCov">          0 :             BCMakeRule( bdf,sc-&gt;orig_pos,layer );</span>
<span class="lineNum">    2522 </span><span class="lineNoCov">          0 :             BCCharChangedUpdate(bdf-&gt;glyphs[sc-&gt;orig_pos]);</span>
<span class="lineNum">    2523 </span>            :         }
<span class="lineNum">    2524 </span><span class="lineNoCov">          0 :     } else if ( bdf != NULL ) {</span>
<span class="lineNum">    2525 </span><span class="lineNoCov">          0 :         BCMakeRule( bdf,sc-&gt;orig_pos,layer );</span>
<span class="lineNum">    2526 </span><span class="lineNoCov">          0 :         BCCharChangedUpdate(bdf-&gt;glyphs[sc-&gt;orig_pos]);</span>
<span class="lineNum">    2527 </span>            :     }
<a name="2528"><span class="lineNum">    2528 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2529 </span>            : 
<span class="lineNum">    2530 </span><span class="lineNoCov">          0 : static void BCDoRotation(BDFFont *bdf, int gid) {</span>
<span class="lineNum">    2531 </span>            :     BDFChar *from, *to;
<span class="lineNum">    2532 </span>            : 
<span class="lineNum">    2533 </span><span class="lineNoCov">          0 :     if ( gid&gt;=bdf-&gt;glyphcnt || bdf-&gt;glyphs[gid]==NULL )</span>
<span class="lineNum">    2534 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2535 </span><span class="lineNoCov">          0 :     from = bdf-&gt;glyphs[gid];</span>
<span class="lineNum">    2536 </span><span class="lineNoCov">          0 :     to = BDFMakeGID(bdf,gid);</span>
<span class="lineNum">    2537 </span><span class="lineNoCov">          0 :     BCRotateCharForVert(to,from,bdf);</span>
<span class="lineNum">    2538 </span><span class="lineNoCov">          0 :     BCCharChangedUpdate(to);</span>
<a name="2539"><span class="lineNum">    2539 </span>            : }</a>
<span class="lineNum">    2540 </span>            : 
<span class="lineNum">    2541 </span><span class="lineNoCov">          0 : static void DoRotation(SplineFont *sf,SplineChar *sc,int layer,BDFFont *bdf,int disp_only) {</span>
<span class="lineNum">    2542 </span>            :     /* In when laying CJK characters vertically and intermixed latin (greek,etc) */
<span class="lineNum">    2543 </span>            :     /*  characters need to be rotated. Adobe's cid tables call for some */
<span class="lineNum">    2544 </span>            :     /*  pre-rotated characters, so we might as well be prepared to deal with */
<span class="lineNum">    2545 </span>            :     /*  them. Note the rotated and normal characters are often in different */
<span class="lineNum">    2546 </span>            :     /*  subfonts so we can't use references */
<span class="lineNum">    2547 </span>            :     SplineChar *scbase;
<span class="lineNum">    2548 </span>            :     real transform[6];
<span class="lineNum">    2549 </span>            :     SplineSet *last, *temp;
<span class="lineNum">    2550 </span>            :     RefChar *ref;
<span class="lineNum">    2551 </span>            :     char *end;
<span class="lineNum">    2552 </span>            :     int j,cid;
<span class="lineNum">    2553 </span>            : 
<span class="lineNum">    2554 </span><span class="lineNoCov">          0 :     if ( sf-&gt;cidmaster!=NULL &amp;&amp; strncmp(sc-&gt;name,&quot;vertcid_&quot;,8)==0 ) {</span>
<span class="lineNum">    2555 </span><span class="lineNoCov">          0 :         cid = strtol(sc-&gt;name+8,&amp;end,10);</span>
<span class="lineNum">    2556 </span><span class="lineNoCov">          0 :         if ( *end!='\0' || (j=SFHasCID(sf,cid))==-1)</span>
<span class="lineNum">    2557 </span><span class="lineNoCov">          0 : return;         /* Can't happen */</span>
<span class="lineNum">    2558 </span><span class="lineNoCov">          0 :         scbase = sf-&gt;cidmaster-&gt;subfonts[j]-&gt;glyphs[cid];</span>
<span class="lineNum">    2559 </span><span class="lineNoCov">          0 :     } else if ( sf-&gt;cidmaster!=NULL &amp;&amp; strstr(sc-&gt;name,&quot;.vert&quot;)!=NULL &amp;&amp;</span>
<span class="lineNum">    2560 </span><span class="lineNoCov">          0 :             (cid = CIDFromName(sc-&gt;name,sf-&gt;cidmaster))!= -1 ) {</span>
<span class="lineNum">    2561 </span><span class="lineNoCov">          0 :         if ( (j=SFHasCID(sf,cid))==-1)</span>
<span class="lineNum">    2562 </span><span class="lineNoCov">          0 : return;         /* Can't happen */</span>
<span class="lineNum">    2563 </span><span class="lineNoCov">          0 :         scbase = sf-&gt;cidmaster-&gt;subfonts[j]-&gt;glyphs[cid];</span>
<span class="lineNum">    2564 </span>            :     } else {
<span class="lineNum">    2565 </span><span class="lineNoCov">          0 :         if ( strncmp(sc-&gt;name,&quot;vertuni&quot;,7)==0 &amp;&amp; strlen(sc-&gt;name)==11 ) {</span>
<span class="lineNum">    2566 </span>            :             char *end;
<span class="lineNum">    2567 </span><span class="lineNoCov">          0 :             int uni = strtol(sc-&gt;name+7,&amp;end,16);</span>
<span class="lineNum">    2568 </span><span class="lineNoCov">          0 :             if ( *end!='\0' || (cid = SFCIDFindExistingChar(sf,uni,NULL))==-1 )</span>
<span class="lineNum">    2569 </span><span class="lineNoCov">          0 : return;         /* Can't happen */</span>
<span class="lineNum">    2570 </span><span class="lineNoCov">          0 :         } else if ( strncmp(sc-&gt;name,&quot;uni&quot;,3)==0 &amp;&amp; strstr(sc-&gt;name,&quot;.vert&quot;)!=NULL ) {</span>
<span class="lineNum">    2571 </span><span class="lineNoCov">          0 :             int uni = strtol(sc-&gt;name+3,&amp;end,16);</span>
<span class="lineNum">    2572 </span><span class="lineNoCov">          0 :             if ( *end!='.' || (cid = SFCIDFindExistingChar(sf,uni,NULL))==-1 )</span>
<span class="lineNum">    2573 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2574 </span><span class="lineNoCov">          0 :         } else if ( sc-&gt;name[0]=='u' &amp;&amp; strstr(sc-&gt;name,&quot;.vert&quot;)!=NULL ) {</span>
<span class="lineNum">    2575 </span><span class="lineNoCov">          0 :             int uni = strtol(sc-&gt;name+1,&amp;end,16);</span>
<span class="lineNum">    2576 </span><span class="lineNoCov">          0 :             if ( *end!='.' || (cid = SFCIDFindExistingChar(sf,uni,NULL))==-1 )</span>
<span class="lineNum">    2577 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2578 </span><span class="lineNoCov">          0 :         } else if ( strstr(sc-&gt;name,&quot;.vert&quot;)!=NULL || strstr(sc-&gt;name,&quot;.vrt2&quot;)!=NULL) {</span>
<span class="lineNum">    2579 </span>            :             char *temp;
<span class="lineNum">    2580 </span><span class="lineNoCov">          0 :             end = strchr(sc-&gt;name,'.');</span>
<span class="lineNum">    2581 </span><span class="lineNoCov">          0 :             temp = copyn(sc-&gt;name,end-sc-&gt;name);</span>
<span class="lineNum">    2582 </span><span class="lineNoCov">          0 :             cid = SFFindExistingSlot(sf,-1,temp);</span>
<span class="lineNum">    2583 </span><span class="lineNoCov">          0 :             free(temp);</span>
<span class="lineNum">    2584 </span><span class="lineNoCov">          0 :             if ( cid==-1 )</span>
<span class="lineNum">    2585 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2586 </span>            :         }
<span class="lineNum">    2587 </span><span class="lineNoCov">          0 :         if ( sf-&gt;cidmaster==NULL )</span>
<span class="lineNum">    2588 </span><span class="lineNoCov">          0 :             scbase = sf-&gt;glyphs[cid];</span>
<span class="lineNum">    2589 </span>            :         else
<span class="lineNum">    2590 </span><span class="lineNoCov">          0 :             scbase = sf-&gt;cidmaster-&gt;subfonts[SFHasCID(sf,cid)]-&gt;glyphs[cid];</span>
<span class="lineNum">    2591 </span>            :     }
<span class="lineNum">    2592 </span>            : 
<span class="lineNum">    2593 </span><span class="lineNoCov">          0 :     if ( bdf == NULL || !disp_only ) {</span>
<span class="lineNum">    2594 </span><span class="lineNoCov">          0 :         transform[0] = transform[3] = 0;</span>
<span class="lineNum">    2595 </span><span class="lineNoCov">          0 :         transform[1] = -1; transform[2] = 1;</span>
<span class="lineNum">    2596 </span><span class="lineNoCov">          0 :         transform[4] = scbase-&gt;parent-&gt;descent; transform[5] = /*scbase-&gt;parent-&gt;vertical_origin*/ scbase-&gt;parent-&gt;ascent;</span>
<span class="lineNum">    2597 </span>            : 
<span class="lineNum">    2598 </span><span class="lineNoCov">          0 :         sc-&gt;layers[layer].splines = SplinePointListTransform(SplinePointListCopy(scbase-&gt;layers[layer].splines),</span>
<span class="lineNum">    2599 </span>            :                 transform, tpt_AllPoints );
<span class="lineNum">    2600 </span><span class="lineNoCov">          0 :         if ( sc-&gt;layers[layer].splines==NULL ) last = NULL;</span>
<span class="lineNum">    2601 </span><span class="lineNoCov">          0 :         else for ( last = sc-&gt;layers[layer].splines; last-&gt;next!=NULL; last = last-&gt;next );</span>
<span class="lineNum">    2602 </span>            : 
<span class="lineNum">    2603 </span><span class="lineNoCov">          0 :         for ( ref = scbase-&gt;layers[layer].refs; ref!=NULL; ref=ref-&gt;next ) {</span>
<span class="lineNum">    2604 </span><span class="lineNoCov">          0 :             temp = SplinePointListTransform(SplinePointListCopy(ref-&gt;layers[0].splines),</span>
<span class="lineNum">    2605 </span>            :                 transform, tpt_AllPoints );
<span class="lineNum">    2606 </span><span class="lineNoCov">          0 :             if ( last==NULL )</span>
<span class="lineNum">    2607 </span><span class="lineNoCov">          0 :                 sc-&gt;layers[layer].splines = temp;</span>
<span class="lineNum">    2608 </span>            :             else
<span class="lineNum">    2609 </span><span class="lineNoCov">          0 :                 last-&gt;next = temp;</span>
<span class="lineNum">    2610 </span><span class="lineNoCov">          0 :             if ( temp!=NULL )</span>
<span class="lineNum">    2611 </span><span class="lineNoCov">          0 :                 for ( last=temp; last-&gt;next!=NULL; last=last-&gt;next );</span>
<span class="lineNum">    2612 </span>            :         }
<span class="lineNum">    2613 </span><span class="lineNoCov">          0 :         sc-&gt;width = sc-&gt;parent-&gt;ascent+sc-&gt;parent-&gt;descent;</span>
<span class="lineNum">    2614 </span><span class="lineNoCov">          0 :         SCCharChangedUpdate(sc,layer);</span>
<span class="lineNum">    2615 </span>            :     }
<span class="lineNum">    2616 </span>            : 
<span class="lineNum">    2617 </span><span class="lineNoCov">          0 :     if ( !disp_only ) {</span>
<span class="lineNum">    2618 </span><span class="lineNoCov">          0 :         for ( bdf=sf-&gt;cidmaster?sf-&gt;cidmaster-&gt;bitmaps:sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">    2619 </span><span class="lineNoCov">          0 :             BCDoRotation( bdf,sc-&gt;orig_pos );</span>
<span class="lineNum">    2620 </span>            :         }
<span class="lineNum">    2621 </span><span class="lineNoCov">          0 :     } else if ( bdf != NULL ) {</span>
<span class="lineNum">    2622 </span><span class="lineNoCov">          0 :         BCDoRotation( bdf,sc-&gt;orig_pos );</span>
<span class="lineNum">    2623 </span>            :     }
<a name="2624"><span class="lineNum">    2624 </span>            : }</a>
<span class="lineNum">    2625 </span>            : 
<span class="lineNum">    2626 </span><span class="lineNoCov">          0 : static int SCMakeRightToLeftLig(SplineChar *sc,SplineFont *sf,</span>
<span class="lineNum">    2627 </span>            :         int layer, const unichar_t *start,BDFFont *bdf,int disp_only) {
<span class="lineNum">    2628 </span><span class="lineNoCov">          0 :     int cnt = u_strlen(start);</span>
<span class="lineNum">    2629 </span><span class="lineNoCov">          0 :     int ret=false, ch, alt_ch;</span>
<span class="lineNum">    2630 </span>            :     const unichar_t *pt;
<span class="lineNum">    2631 </span>            : 
<span class="lineNum">    2632 </span><span class="lineNoCov">          0 :     pt = start+cnt-1;</span>
<span class="lineNum">    2633 </span><span class="lineNoCov">          0 :     ch = *pt;</span>
<span class="lineNum">    2634 </span><span class="lineNoCov">          0 :     if ( ch&gt;=0x621 &amp;&amp; ch&lt;=0x6ff ) {</span>
<span class="lineNum">    2635 </span><span class="lineNoCov">          0 :         alt_ch = ArabicForms[ch-0x600].final;</span>
<span class="lineNum">    2636 </span><span class="lineNoCov">          0 :         if ( alt_ch!=0 &amp;&amp; haschar(sf,alt_ch,NULL))</span>
<span class="lineNum">    2637 </span><span class="lineNoCov">          0 :             ch = alt_ch;</span>
<span class="lineNum">    2638 </span>            :     }
<span class="lineNum">    2639 </span><span class="lineNoCov">          0 :     if ( SCMakeBaseReference(sc,sf,layer,ch,bdf,disp_only) ) {</span>
<span class="lineNum">    2640 </span><span class="lineNoCov">          0 :         for ( --pt; pt&gt;=start; --pt ) {</span>
<span class="lineNum">    2641 </span><span class="lineNoCov">          0 :             ch = *pt;</span>
<span class="lineNum">    2642 </span><span class="lineNoCov">          0 :             if ( ch&gt;=0x621 &amp;&amp; ch&lt;=0x6ff ) {</span>
<span class="lineNum">    2643 </span><span class="lineNoCov">          0 :                 if ( pt==start )</span>
<span class="lineNum">    2644 </span><span class="lineNoCov">          0 :                     alt_ch = ArabicForms[ch-0x600].initial;</span>
<span class="lineNum">    2645 </span>            :                 else
<span class="lineNum">    2646 </span><span class="lineNoCov">          0 :                     alt_ch = ArabicForms[ch-0x600].medial;</span>
<span class="lineNum">    2647 </span><span class="lineNoCov">          0 :                 if ( alt_ch!=0 &amp;&amp; haschar(sf,alt_ch,NULL))</span>
<span class="lineNum">    2648 </span><span class="lineNoCov">          0 :                     ch = alt_ch;</span>
<span class="lineNum">    2649 </span>            :             }
<span class="lineNum">    2650 </span><span class="lineNoCov">          0 :             SCPutRefAfter(sc,sf,layer,ch,bdf,disp_only,NULL);</span>
<span class="lineNum">    2651 </span>            :         }
<span class="lineNum">    2652 </span><span class="lineNoCov">          0 :         ret = true;</span>
<span class="lineNum">    2653 </span>            :     }
<span class="lineNum">    2654 </span><span class="lineNoCov">          0 : return( ret );</span>
<a name="2655"><span class="lineNum">    2655 </span>            : }</a>
<span class="lineNum">    2656 </span>            : 
<span class="lineNum">    2657 </span><span class="lineNoCov">          0 : static void SCBuildHangul(SplineFont *sf,SplineChar *sc, int layer, const unichar_t *pt,</span>
<span class="lineNum">    2658 </span>            :         BDFFont *bdf, int disp_only) {
<span class="lineNum">    2659 </span>            :     SplineChar *rsc;
<span class="lineNum">    2660 </span><span class="lineNoCov">          0 :     int first = true;</span>
<span class="lineNum">    2661 </span>            : 
<span class="lineNum">    2662 </span><span class="lineNoCov">          0 :     sc-&gt;width = 0;</span>
<span class="lineNum">    2663 </span><span class="lineNoCov">          0 :     while ( *pt ) {</span>
<span class="lineNum">    2664 </span><span class="lineNoCov">          0 :         rsc = SFGetChar(sf,*pt++,NULL);</span>
<span class="lineNum">    2665 </span><span class="lineNoCov">          0 :         if ( rsc!=NULL ) {</span>
<span class="lineNum">    2666 </span><span class="lineNoCov">          0 :             if ( bdf == NULL || !disp_only ) {</span>
<span class="lineNum">    2667 </span><span class="lineNoCov">          0 :                 SCAddRef(sc,rsc,layer,0,0);</span>
<span class="lineNum">    2668 </span><span class="lineNoCov">          0 :                 if ( rsc-&gt;width&gt;sc-&gt;width ) sc-&gt;width = rsc-&gt;width;</span>
<span class="lineNum">    2669 </span>            :             }
<span class="lineNum">    2670 </span><span class="lineNoCov">          0 :             if ( !disp_only ) {</span>
<span class="lineNum">    2671 </span><span class="lineNoCov">          0 :                 for ( bdf=sf-&gt;cidmaster?sf-&gt;cidmaster-&gt;bitmaps:sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">    2672 </span><span class="lineNoCov">          0 :                     if ( first )</span>
<span class="lineNum">    2673 </span><span class="lineNoCov">          0 :                         BCClearAll(bdf-&gt;glyphs[sc-&gt;orig_pos]);</span>
<span class="lineNum">    2674 </span><span class="lineNoCov">          0 :                     BCAddReference( BDFMakeGID(bdf,sc-&gt;orig_pos),bdf-&gt;glyphs[rsc-&gt;orig_pos],</span>
<span class="lineNum">    2675 </span>            :                         rsc-&gt;orig_pos,0,0 );
<span class="lineNum">    2676 </span>            :                 }
<span class="lineNum">    2677 </span><span class="lineNoCov">          0 :             } else if ( bdf != NULL ) {</span>
<span class="lineNum">    2678 </span><span class="lineNoCov">          0 :                 if ( first )</span>
<span class="lineNum">    2679 </span><span class="lineNoCov">          0 :                     BCClearAll(bdf-&gt;glyphs[sc-&gt;orig_pos]);</span>
<span class="lineNum">    2680 </span><span class="lineNoCov">          0 :                 BCAddReference( BDFMakeGID(bdf,sc-&gt;orig_pos),bdf-&gt;glyphs[rsc-&gt;orig_pos],</span>
<span class="lineNum">    2681 </span>            :                     rsc-&gt;orig_pos,0,0 );
<span class="lineNum">    2682 </span>            :             }
<span class="lineNum">    2683 </span><span class="lineNoCov">          0 :             first = false;</span>
<span class="lineNum">    2684 </span>            :         }
<span class="lineNum">    2685 </span>            :     }
<a name="2686"><span class="lineNum">    2686 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2687 </span>            : 
<span class="lineNum">    2688 </span><span class="lineNoCov">          0 : static int _SCMakeDotless(SplineFont *sf, SplineChar *dotless, int layer, int doit) {</span>
<span class="lineNum">    2689 </span>            :     SplineChar *sc, *xsc;
<span class="lineNum">    2690 </span>            :     BlueData bd;
<span class="lineNum">    2691 </span><span class="lineNoCov">          0 :     SplineSet *head=NULL, *last=NULL, *test, *cur, *next;</span>
<span class="lineNum">    2692 </span>            :     DBounds b;
<span class="lineNum">    2693 </span>            : 
<span class="lineNum">    2694 </span><span class="lineNoCov">          0 :     sc = SFGetChar(sf,dotless-&gt;unicodeenc==0x131?'i':'j',NULL);</span>
<span class="lineNum">    2695 </span><span class="lineNoCov">          0 :     xsc = SFGetChar(sf,'x',NULL);</span>
<span class="lineNum">    2696 </span><span class="lineNoCov">          0 :     if ( sc==NULL || sc-&gt;layers[layer].splines==NULL || sc-&gt;layers[layer].refs!=NULL || xsc==NULL )</span>
<span class="lineNum">    2697 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    2698 </span><span class="lineNoCov">          0 :     QuickBlues(sf,layer,&amp;bd);</span>
<span class="lineNum">    2699 </span><span class="lineNoCov">          0 :     if ( bd.xheight==0 )</span>
<span class="lineNum">    2700 </span><span class="lineNoCov">          0 : return(false );</span>
<span class="lineNum">    2701 </span><span class="lineNoCov">          0 :     for ( test=sc-&gt;layers[layer].splines; test!=NULL; test=test-&gt;next ) {</span>
<span class="lineNum">    2702 </span><span class="lineNoCov">          0 :         next = test-&gt;next; test-&gt;next = NULL;</span>
<span class="lineNum">    2703 </span><span class="lineNoCov">          0 :         SplineSetQuickBounds(test,&amp;b);</span>
<span class="lineNum">    2704 </span><span class="lineNoCov">          0 :         test-&gt;next = next;</span>
<span class="lineNum">    2705 </span><span class="lineNoCov">          0 :         if ( b.miny &lt; bd.xheight ) {</span>
<span class="lineNum">    2706 </span><span class="lineNoCov">          0 :             if ( !doit )</span>
<span class="lineNum">    2707 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    2708 </span><span class="lineNoCov">          0 :             cur = SplinePointListCopy1(test);</span>
<span class="lineNum">    2709 </span><span class="lineNoCov">          0 :             if ( last==NULL )</span>
<span class="lineNum">    2710 </span><span class="lineNoCov">          0 :                 head = cur;</span>
<span class="lineNum">    2711 </span>            :             else
<span class="lineNum">    2712 </span><span class="lineNoCov">          0 :                 last-&gt;next = cur;</span>
<span class="lineNum">    2713 </span><span class="lineNoCov">          0 :             last = cur;</span>
<span class="lineNum">    2714 </span>            :         }
<span class="lineNum">    2715 </span>            :     }
<span class="lineNum">    2716 </span><span class="lineNoCov">          0 :     if ( head==NULL )</span>
<span class="lineNum">    2717 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    2718 </span>            : 
<span class="lineNum">    2719 </span><span class="lineNoCov">          0 :     SCPreserveLayer(dotless,layer,true);</span>
<span class="lineNum">    2720 </span><span class="lineNoCov">          0 :     SplinePointListsFree(dotless-&gt;layers[layer].splines);</span>
<span class="lineNum">    2721 </span><span class="lineNoCov">          0 :     dotless-&gt;layers[layer].splines = NULL;</span>
<span class="lineNum">    2722 </span><span class="lineNoCov">          0 :     SCRemoveLayerDependents(dotless,layer);</span>
<span class="lineNum">    2723 </span><span class="lineNoCov">          0 :     dotless-&gt;width = sc-&gt;width;</span>
<span class="lineNum">    2724 </span><span class="lineNoCov">          0 :     dotless-&gt;layers[layer].splines = head;</span>
<span class="lineNum">    2725 </span><span class="lineNoCov">          0 :     SCCharChangedUpdate(dotless,layer);</span>
<span class="lineNum">    2726 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2727"><span class="lineNum">    2727 </span>            : }</a>
<span class="lineNum">    2728 </span>            : 
<span class="lineNum">    2729 </span><span class="lineNoCov">          0 : static int SCMakeDotless(SplineFont *sf, SplineChar *dotless, int layer, BDFFont *bdf, int disp_only, int doit) {</span>
<span class="lineNum">    2730 </span>            :     SplineChar *sc;
<span class="lineNum">    2731 </span>            :     BDFChar *bc;
<span class="lineNum">    2732 </span><span class="lineNoCov">          0 :     int ret = 0;</span>
<span class="lineNum">    2733 </span>            : 
<span class="lineNum">    2734 </span><span class="lineNoCov">          0 :     if ( dotless==NULL )</span>
<span class="lineNum">    2735 </span><span class="lineNoCov">          0 : return( ret );</span>
<span class="lineNum">    2736 </span><span class="lineNoCov">          0 :         if ( dotless-&gt;unicodeenc!=0x131 &amp;&amp; dotless-&gt;unicodeenc!=0xf6be &amp;&amp; dotless-&gt;unicodeenc!=0x237 )</span>
<span class="lineNum">    2737 </span><span class="lineNoCov">          0 : return( ret );</span>
<span class="lineNum">    2738 </span><span class="lineNoCov">          0 :     sc = SFGetChar(sf,dotless-&gt;unicodeenc==0x131?'i':'j',NULL);</span>
<span class="lineNum">    2739 </span><span class="lineNoCov">          0 :     if ( sc==NULL )</span>
<span class="lineNum">    2740 </span><span class="lineNoCov">          0 : return( ret );</span>
<span class="lineNum">    2741 </span><span class="lineNoCov">          0 :     if ( bdf==NULL || !disp_only )</span>
<span class="lineNum">    2742 </span><span class="lineNoCov">          0 :         ret = _SCMakeDotless( sf,dotless,layer,doit );</span>
<span class="lineNum">    2743 </span>            : 
<span class="lineNum">    2744 </span><span class="lineNoCov">          0 :     if ( !disp_only ) {</span>
<span class="lineNum">    2745 </span><span class="lineNoCov">          0 :         for ( bdf=sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">    2746 </span><span class="lineNoCov">          0 :             if (( bc = bdf-&gt;glyphs[sc-&gt;orig_pos])!=NULL ) {</span>
<span class="lineNum">    2747 </span><span class="lineNoCov">          0 :                 BCClearAndCopyBelow(bdf,dotless-&gt;orig_pos,sc-&gt;orig_pos,BCFindGap(bc));</span>
<span class="lineNum">    2748 </span>            :             }
<span class="lineNum">    2749 </span>            :         }
<span class="lineNum">    2750 </span><span class="lineNoCov">          0 :     } else if ( bdf != NULL ) {</span>
<span class="lineNum">    2751 </span><span class="lineNoCov">          0 :         if (( bc = bdf-&gt;glyphs[sc-&gt;orig_pos])!=NULL ) {</span>
<span class="lineNum">    2752 </span><span class="lineNoCov">          0 :             BCClearAndCopyBelow(bdf,dotless-&gt;orig_pos,sc-&gt;orig_pos,BCFindGap(bc));</span>
<span class="lineNum">    2753 </span>            :         }
<span class="lineNum">    2754 </span>            :     }
<span class="lineNum">    2755 </span>            :             
<span class="lineNum">    2756 </span><span class="lineNoCov">          0 : return( ret );</span>
<a name="2757"><span class="lineNum">    2757 </span>            : }</a>
<span class="lineNum">    2758 </span>            : 
<span class="lineNum">    2759 </span><span class="lineNoCov">          0 : static void SCSetReasonableLBearing(SplineChar *sc,SplineChar *base,int layer) {</span>
<span class="lineNum">    2760 </span>            :     DBounds full, b;
<span class="lineNum">    2761 </span>            :     SplineFont *sf;
<span class="lineNum">    2762 </span>            :     int emsize;
<span class="lineNum">    2763 </span>            :     double xoff;
<span class="lineNum">    2764 </span>            :     RefChar *ref;
<span class="lineNum">    2765 </span>            :     real transform[6];
<span class="lineNum">    2766 </span>            : 
<span class="lineNum">    2767 </span>            :     /* Hmm. Panov doesn't think this should happen */
<span class="lineNum">    2768 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2769 </span>            : 
<span class="lineNum">    2770 </span>            :     SplineCharLayerFindBounds(sc,layer,&amp;full);
<span class="lineNum">    2771 </span>            :     SplineCharLayerFindBounds(base,layer,&amp;b);
<span class="lineNum">    2772 </span>            : 
<span class="lineNum">    2773 </span>            :     sf = sc-&gt;parent;
<span class="lineNum">    2774 </span>            :     emsize = sf-&gt;ascent+sf-&gt;descent;
<span class="lineNum">    2775 </span>            : 
<span class="lineNum">    2776 </span>            :     /* Now don't get excited if we have a very thin glyph (I in a sans-serif) */
<span class="lineNum">    2777 </span>            :     /*  and a centered accent spills off to the left a little */
<span class="lineNum">    2778 </span>            :     if ( full.minx&gt;=0 || full.minx&gt;=b.minx || full.minx&gt;=-(emsize/20) )
<span class="lineNum">    2779 </span>            : return;
<span class="lineNum">    2780 </span>            :     /* ok. let's say we want an lbearing that's the same as that of the base */
<span class="lineNum">    2781 </span>            :     /*  glyph */
<span class="lineNum">    2782 </span>            :     xoff = b.minx-full.minx;
<span class="lineNum">    2783 </span>            :     memset(transform,0,sizeof(transform));
<span class="lineNum">    2784 </span>            :     transform[0] = transform[3] = 1.0;
<span class="lineNum">    2785 </span>            :     transform[4] = xoff;
<span class="lineNum">    2786 </span>            :     for ( ref=sc-&gt;layers[layer].refs; ref!=NULL; ref=ref-&gt;next ) {
<span class="lineNum">    2787 </span>            :         ref-&gt;bb.minx += xoff; ref-&gt;bb.maxx += xoff;
<span class="lineNum">    2788 </span>            :         ref-&gt;transform[4] += xoff;
<span class="lineNum">    2789 </span>            :         SplinePointListTransform(ref-&gt;layers[0].splines,transform,tpt_AllPoints);
<span class="lineNum">    2790 </span>            :     }
<span class="lineNum">    2791 </span>            :     SCSynchronizeWidth(sc,sc-&gt;width + xoff,sc-&gt;width,NULL);
<a name="2792"><span class="lineNum">    2792 </span>            : }</a>
<span class="lineNum">    2793 </span>            : 
<span class="lineNum">    2794 </span><span class="lineNoCov">          0 : void SCBuildComposit(SplineFont *sf, SplineChar *sc, int layer, BDFFont *bdf, int disp_only ) {</span>
<span class="lineNum">    2795 </span>            :     const unichar_t *pt, *apt; unichar_t ch;
<span class="lineNum">    2796 </span>            :     real ia;
<span class="lineNum">    2797 </span>            :     char *dot;
<span class="lineNum">    2798 </span>            :     /* This does not handle arabic ligatures at all. It would need to reverse */
<span class="lineNum">    2799 </span>            :     /*  the string and deal with &lt;final&gt;, &lt;medial&gt;, etc. info we don't have */
<span class="lineNum">    2800 </span>            : 
<span class="lineNum">    2801 </span><span class="lineNoCov">          0 :     if ( !SFIsSomethingBuildable(sf,sc,layer,false))</span>
<span class="lineNum">    2802 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2803 </span><span class="lineNoCov">          0 :     if ( !disp_only || bdf == NULL ) {</span>
<span class="lineNum">    2804 </span><span class="lineNoCov">          0 :         SCPreserveLayer(sc,layer,true);</span>
<span class="lineNum">    2805 </span><span class="lineNoCov">          0 :         SplinePointListsFree(sc-&gt;layers[layer].splines);</span>
<span class="lineNum">    2806 </span><span class="lineNoCov">          0 :         sc-&gt;layers[layer].splines = NULL;</span>
<span class="lineNum">    2807 </span><span class="lineNoCov">          0 :         SCRemoveLayerDependents(sc,layer);</span>
<span class="lineNum">    2808 </span><span class="lineNoCov">          0 :         sc-&gt;width = 0;</span>
<span class="lineNum">    2809 </span>            :     }
<span class="lineNum">    2810 </span><span class="lineNoCov">          0 :     if ( !disp_only ) {</span>
<span class="lineNum">    2811 </span><span class="lineNoCov">          0 :         for ( bdf=sf-&gt;cidmaster?sf-&gt;cidmaster-&gt;bitmaps:sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next )</span>
<span class="lineNum">    2812 </span><span class="lineNoCov">          0 :             if ( bdf-&gt;glyphs[sc-&gt;orig_pos]!=NULL )</span>
<span class="lineNum">    2813 </span><span class="lineNoCov">          0 :                 BCClearAll( bdf-&gt;glyphs[sc-&gt;orig_pos] );</span>
<span class="lineNum">    2814 </span><span class="lineNoCov">          0 :     } else if ( bdf!=NULL) {</span>
<span class="lineNum">    2815 </span><span class="lineNoCov">          0 :         if ( bdf-&gt;glyphs[sc-&gt;orig_pos]!=NULL )</span>
<span class="lineNum">    2816 </span><span class="lineNoCov">          0 :             BCClearAll( bdf-&gt;glyphs[sc-&gt;orig_pos] );</span>
<span class="lineNum">    2817 </span>            :     }
<span class="lineNum">    2818 </span>            : 
<span class="lineNum">    2819 </span><span class="lineNoCov">          0 :     if ( iszerowidth(sc-&gt;unicodeenc) || (sc-&gt;unicodeenc&gt;=0x2000 &amp;&amp; sc-&gt;unicodeenc&lt;=0x200f )) {</span>
<span class="lineNum">    2820 </span><span class="lineNoCov">          0 :         DoSpaces( sf,sc,layer,bdf,disp_only );</span>
<span class="lineNum">    2821 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2822 </span><span class="lineNoCov">          0 :     } else if ( sc-&gt;unicodeenc&gt;=0x2010 &amp;&amp; sc-&gt;unicodeenc&lt;=0x2015 ) {</span>
<span class="lineNum">    2823 </span><span class="lineNoCov">          0 :         DoRules( sf,sc,layer,bdf,disp_only );</span>
<span class="lineNum">    2824 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2825 </span><span class="lineNoCov">          0 :     } else if ( SFIsRotatable(sf,sc) ) {</span>
<span class="lineNum">    2826 </span><span class="lineNoCov">          0 :         DoRotation( sf,sc,layer,bdf,disp_only );</span>
<span class="lineNum">    2827 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2828 </span><span class="lineNoCov">          0 :     } else if ( sc-&gt;unicodeenc==0x131 || sc-&gt;unicodeenc==0x237 || sc-&gt;unicodeenc==0xf6be ) {</span>
<span class="lineNum">    2829 </span><span class="lineNoCov">          0 :         SCMakeDotless( sf,sc,layer,bdf,disp_only,true );</span>
<span class="lineNum">    2830 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2831 </span>            :     }
<span class="lineNum">    2832 </span>            : 
<span class="lineNum">    2833 </span><span class="lineNoCov">          0 :     if (( ia = sf-&gt;italicangle )==0 )</span>
<span class="lineNum">    2834 </span><span class="lineNoCov">          0 :         ia = SFGuessItalicAngle(sf);</span>
<span class="lineNum">    2835 </span><span class="lineNoCov">          0 :     ia *= 3.1415926535897932/180;       /* convert degrees to radians */</span>
<span class="lineNum">    2836 </span>            : 
<span class="lineNum">    2837 </span><span class="lineNoCov">          0 :     dot = strchr(sc-&gt;name,'.');</span>
<span class="lineNum">    2838 </span>            : 
<span class="lineNum">    2839 </span><span class="lineNoCov">          0 :     pt= SFGetAlternate(sf,sc-&gt;unicodeenc,sc,false);</span>
<span class="lineNum">    2840 </span><span class="lineNoCov">          0 :     ch = *pt++;</span>
<span class="lineNum">    2841 </span><span class="lineNoCov">          0 :     if ( dot==NULL &amp;&amp; ( ch=='i' || ch=='j' || ch==0x456 )) {</span>
<span class="lineNum">    2842 </span>            :         /* if we're combining i (or j) with an accent that would interfere */
<span class="lineNum">    2843 </span>            :         /*  with the dot, then get rid of the dot. (use dotlessi) */
<span class="lineNum">    2844 </span><span class="lineNoCov">          0 :         for ( apt = pt; *apt &amp;&amp; combiningposmask(*apt) != FF_UNICODE_ABOVE; ++apt);</span>
<span class="lineNum">    2845 </span><span class="lineNoCov">          0 :         if ( *apt!='\0' ) {</span>
<span class="lineNum">    2846 </span><span class="lineNoCov">          0 :             if ( ch=='i' || ch==0x456 ) ch = 0x0131;</span>
<span class="lineNum">    2847 </span><span class="lineNoCov">          0 :             else if ( ch=='j' ) {</span>
<span class="lineNum">    2848 </span><span class="lineNoCov">          0 :                 if ( haschar(sf,0x237,NULL) ) ch = 0x237;               /* Proposed dotlessj */</span>
<span class="lineNum">    2849 </span><span class="lineNoCov">          0 :                 else ch = 0xf6be;                               /* Adobe's private use dotless j */</span>
<span class="lineNum">    2850 </span>            :             }
<span class="lineNum">    2851 </span>            :         }
<span class="lineNum">    2852 </span>            :     }
<span class="lineNum">    2853 </span><span class="lineNoCov">          0 :     if ( sc-&gt;unicodeenc&gt;=0xac00 &amp;&amp; sc-&gt;unicodeenc&lt;=0xd7a3 )</span>
<span class="lineNum">    2854 </span><span class="lineNoCov">          0 :         SCBuildHangul(sf,sc,layer,pt-1,bdf,disp_only);</span>
<span class="lineNum">    2855 </span><span class="lineNoCov">          0 :     else if ( isrighttoleft(ch) &amp;&amp; !iscombining(*pt)) {</span>
<span class="lineNum">    2856 </span><span class="lineNoCov">          0 :         SCMakeRightToLeftLig(sc,sf,layer,pt-1,bdf,disp_only);</span>
<span class="lineNum">    2857 </span>            :     } else {
<span class="lineNum">    2858 </span>            :         RefChar *base;
<span class="lineNum">    2859 </span><span class="lineNoCov">          0 :         if ( !SCMakeBaseReference(sc,sf,layer,ch,bdf,disp_only) )</span>
<span class="lineNum">    2860 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2861 </span><span class="lineNoCov">          0 :         base = sc-&gt;layers[layer].refs;</span>
<span class="lineNum">    2862 </span><span class="lineNoCov">          0 :         if ( base==NULL )</span>
<span class="lineNum">    2863 </span>            :             /* Happens when building glyphs which are themselves marks, like */
<span class="lineNum">    2864 </span>            :             /* perispomeni which is a tilde over a space, only we don't make */
<span class="lineNum">    2865 </span>            :             /* a reference to space */;
<span class="lineNum">    2866 </span><span class="lineNoCov">          0 :         else if ( sc-&gt;width == base-&gt;sc-&gt;width )</span>
<span class="lineNum">    2867 </span><span class="lineNoCov">          0 :             base-&gt;use_my_metrics = true;</span>
<span class="lineNum">    2868 </span><span class="lineNoCov">          0 :         while ( iscombining(*pt) || (ch=='L' &amp;&amp; *pt==0xb7) ||   /* b7, centered dot is used as a combining accent for Ldot but as a lig for ldot */</span>
<span class="lineNum">    2869 </span><span class="lineNoCov">          0 :                 *pt==0x384 || *pt==0x385 || (*pt&gt;=0x1fbd &amp;&amp; *pt&lt;=0x1fff ))        /* Special greek accents */</span>
<span class="lineNum">    2870 </span><span class="lineNoCov">          0 :             SCCenterAccent(sc,base!=NULL?base-&gt;sc:NULL,sf,layer,*pt++,bdf,disp_only,ia,ch,dot);</span>
<span class="lineNum">    2871 </span><span class="lineNoCov">          0 :         while ( *pt ) {</span>
<span class="lineNum">    2872 </span><span class="lineNoCov">          0 :             if ( base!=NULL ) base-&gt;use_my_metrics = false;</span>
<span class="lineNum">    2873 </span><span class="lineNoCov">          0 :             SCPutRefAfter(sc,sf,layer,*pt++,bdf,disp_only,dot);</span>
<span class="lineNum">    2874 </span>            :         }
<span class="lineNum">    2875 </span>            :         /* All along we assumed the base glyph didn't move. This makes       */
<span class="lineNum">    2876 </span>            :         /* positioning easier. But if we add accents to the left we now want */
<span class="lineNum">    2877 </span>            :         /* to move the glyph so we don't have a negative lbearing */
<span class="lineNum">    2878 </span><span class="lineNoCov">          0 :         if ( base!=NULL )</span>
<span class="lineNum">    2879 </span><span class="lineNoCov">          0 :             SCSetReasonableLBearing(sc,base-&gt;sc,layer);</span>
<span class="lineNum">    2880 </span>            :     }
<span class="lineNum">    2881 </span><span class="lineNoCov">          0 :     if ( !disp_only || bdf == NULL )</span>
<span class="lineNum">    2882 </span><span class="lineNoCov">          0 :         SCCharChangedUpdate(sc,layer);</span>
<span class="lineNum">    2883 </span><span class="lineNoCov">          0 :     if ( !disp_only ) {</span>
<span class="lineNum">    2884 </span><span class="lineNoCov">          0 :         for ( bdf=sf-&gt;cidmaster?sf-&gt;cidmaster-&gt;bitmaps:sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next )</span>
<span class="lineNum">    2885 </span><span class="lineNoCov">          0 :             if ( bdf-&gt;glyphs[sc-&gt;orig_pos]!=NULL )</span>
<span class="lineNum">    2886 </span><span class="lineNoCov">          0 :                 BCCharChangedUpdate(bdf-&gt;glyphs[sc-&gt;orig_pos]);</span>
<span class="lineNum">    2887 </span><span class="lineNoCov">          0 :     } else if ( bdf != NULL &amp;&amp; bdf-&gt;glyphs[sc-&gt;orig_pos]!=NULL )</span>
<span class="lineNum">    2888 </span><span class="lineNoCov">          0 :         BCCharChangedUpdate(bdf-&gt;glyphs[sc-&gt;orig_pos]);</span>
<span class="lineNum">    2889 </span><span class="lineNoCov">          0 : return;</span>
<a name="2890"><span class="lineNum">    2890 </span>            : }</a>
<span class="lineNum">    2891 </span>            : 
<span class="lineNum">    2892 </span><span class="lineNoCov">          0 : int SCAppendAccent(SplineChar *sc,int layer,</span>
<span class="lineNum">    2893 </span>            :         char *glyph_name,       /* unicode char name */
<span class="lineNum">    2894 </span>            :         int uni,                /* unicode char value */
<span class="lineNum">    2895 </span>            :         uint32 pos              /* unicode char position info, see #define for (uint32)(utype2[]) */ ) {
<span class="lineNum">    2896 </span><span class="lineNoCov">          0 :     SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">    2897 </span>            :     double ia;
<span class="lineNum">    2898 </span>            :     int basech;
<span class="lineNum">    2899 </span><span class="lineNoCov">          0 :     RefChar *ref, *last=NULL;</span>
<span class="lineNum">    2900 </span><span class="lineNoCov">          0 :     int invert = false;         /* invert accent, false==0, true!=0 */</span>
<span class="lineNum">    2901 </span>            :     SplineChar *asc;
<span class="lineNum">    2902 </span>            :     int i;
<span class="lineNum">    2903 </span>            :     const unichar_t *apt, *end;
<span class="lineNum">    2904 </span>            :     char *pt;
<span class="lineNum">    2905 </span>            : 
<span class="lineNum">    2906 </span><span class="lineNoCov">          0 :     for ( ref=sc-&gt;layers[layer].refs; ref!=NULL; ref=ref-&gt;next )</span>
<span class="lineNum">    2907 </span><span class="lineNoCov">          0 :         last = ref;</span>
<span class="lineNum">    2908 </span><span class="lineNoCov">          0 :     if ( last==NULL )</span>
<span class="lineNum">    2909 </span><span class="lineNoCov">          0 : return( 1 );                            /* No base character reference found */</span>
<span class="lineNum">    2910 </span><span class="lineNoCov">          0 :     basech = last-&gt;sc-&gt;unicodeenc;</span>
<span class="lineNum">    2911 </span>            : 
<span class="lineNum">    2912 </span><span class="lineNoCov">          0 :     if (( ia = sf-&gt;italicangle )==0 )</span>
<span class="lineNum">    2913 </span><span class="lineNoCov">          0 :         ia = SFGuessItalicAngle(sf);</span>
<span class="lineNum">    2914 </span><span class="lineNoCov">          0 :     ia *= 3.1415926535897932/180;       /* convert degrees to radians */</span>
<span class="lineNum">    2915 </span>            : 
<span class="lineNum">    2916 </span><span class="lineNoCov">          0 :     SCPreserveLayer(sc,layer,true);</span>
<span class="lineNum">    2917 </span>            : 
<span class="lineNum">    2918 </span><span class="lineNoCov">          0 :     asc = SFGetChar(sf,uni,glyph_name);</span>
<span class="lineNum">    2919 </span><span class="lineNoCov">          0 :     if ( asc!=NULL &amp;&amp; uni==-1 )</span>
<span class="lineNum">    2920 </span><span class="lineNoCov">          0 :         uni = asc-&gt;unicodeenc;</span>
<span class="lineNum">    2921 </span><span class="lineNoCov">          0 :     else if ( asc==NULL &amp;&amp; uni!=-1 )</span>
<span class="lineNum">    2922 </span><span class="lineNoCov">          0 :         asc = GetGoodAccentGlyph(sf,uni,basech,&amp;invert,ia,NULL,sc);</span>
<span class="lineNum">    2923 </span><span class="lineNoCov">          0 :     if ( asc==NULL )</span>
<span class="lineNum">    2924 </span><span class="lineNoCov">          0 : return( 2 );                            /* Could not find that accent */</span>
<span class="lineNum">    2925 </span><span class="lineNoCov">          0 :     if ( uni==-1 &amp;&amp; (pt=strchr(asc-&gt;name,'.'))!=NULL &amp;&amp; pt-asc-&gt;name&lt;100 ) {</span>
<span class="lineNum">    2926 </span>            :         char buffer[101];
<span class="lineNum">    2927 </span><span class="lineNoCov">          0 :         strncpy(buffer,asc-&gt;name,pt-asc-&gt;name);</span>
<span class="lineNum">    2928 </span><span class="lineNoCov">          0 :         buffer[(pt-asc-&gt;name)] = '\0';</span>
<span class="lineNum">    2929 </span><span class="lineNoCov">          0 :         uni = UniFromName(buffer,ui_none,NULL);</span>
<span class="lineNum">    2930 </span>            :     }
<span class="lineNum">    2931 </span>            : 
<span class="lineNum">    2932 </span><span class="lineNoCov">          0 :     if ( uni&lt;=BottomAccent || uni&gt;=TopAccent ) {</span>
<span class="lineNum">    2933 </span>            :         /* Find the real combining character that maps to this glyph */
<span class="lineNum">    2934 </span>            :         /* that's where we store positioning info */
<span class="lineNum">    2935 </span><span class="lineNoCov">          0 :         for ( i=BottomAccent; i&lt;=TopAccent; ++i ) {</span>
<span class="lineNum">    2936 </span><span class="lineNoCov">          0 :             apt = accents[i-BottomAccent]; end = apt+sizeof(accents[0])/sizeof(accents[0][0]);</span>
<span class="lineNum">    2937 </span><span class="lineNoCov">          0 :             while ( apt&lt;end &amp;&amp; *apt!=uni )</span>
<span class="lineNum">    2938 </span><span class="lineNoCov">          0 :                 ++apt;</span>
<span class="lineNum">    2939 </span><span class="lineNoCov">          0 :             if ( apt&lt;end ) {</span>
<span class="lineNum">    2940 </span><span class="lineNoCov">          0 :                 uni = i;</span>
<span class="lineNum">    2941 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2942 </span>            :             }
<span class="lineNum">    2943 </span>            :         }
<span class="lineNum">    2944 </span>            :     }
<span class="lineNum">    2945 </span>            : 
<span class="lineNum">    2946 </span><span class="lineNoCov">          0 :     _SCCenterAccent(sc,last-&gt;sc,sf,layer,uni,NULL,false,asc,ia,basech,invert,pos);</span>
<span class="lineNum">    2947 </span><span class="lineNoCov">          0 : return( 0 );</span>
<span class="lineNum">    2948 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
