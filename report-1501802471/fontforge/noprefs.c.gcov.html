<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd) - fontforge/noprefs.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">fontforge</a> - noprefs.c<span style="font-size: 80%;"> (source / <a href="noprefs.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd)</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">3</td>
            <td class="headerCovTableEntry">318</td>
            <td class="headerCovTableEntryLo">0.9 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-08-04</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">14</td>
            <td class="headerCovTableEntryLo">7.1 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* Copyright (C) 2000-2012 by George Williams */</a>
<span class="lineNum">       2 </span>            : /*
<span class="lineNum">       3 </span>            :  * Redistribution and use in source and binary forms, with or without
<span class="lineNum">       4 </span>            :  * modification, are permitted provided that the following conditions are met:
<span class="lineNum">       5 </span>            : 
<span class="lineNum">       6 </span>            :  * Redistributions of source code must retain the above copyright notice, this
<span class="lineNum">       7 </span>            :  * list of conditions and the following disclaimer.
<span class="lineNum">       8 </span>            : 
<span class="lineNum">       9 </span>            :  * Redistributions in binary form must reproduce the above copyright notice,
<span class="lineNum">      10 </span>            :  * this list of conditions and the following disclaimer in the documentation
<span class="lineNum">      11 </span>            :  * and/or other materials provided with the distribution.
<span class="lineNum">      12 </span>            : 
<span class="lineNum">      13 </span>            :  * The name of the author may not be used to endorse or promote products
<span class="lineNum">      14 </span>            :  * derived from this software without specific prior written permission.
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            :  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
<span class="lineNum">      17 </span>            :  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
<span class="lineNum">      18 </span>            :  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
<span class="lineNum">      19 </span>            :  * EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span class="lineNum">      20 </span>            :  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
<span class="lineNum">      21 </span>            :  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
<span class="lineNum">      22 </span>            :  * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
<span class="lineNum">      23 </span>            :  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
<span class="lineNum">      24 </span>            :  * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
<span class="lineNum">      25 </span>            :  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span class="lineNum">      26 </span>            :  */
<span class="lineNum">      27 </span>            : #include &quot;autotrace.h&quot;
<span class="lineNum">      28 </span>            : #include &quot;encoding.h&quot;
<span class="lineNum">      29 </span>            : #include &quot;fontforge.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;groups.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;macenc.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;namelist.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;othersubrs.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;plugins.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;sfd.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;splineutil.h&quot;
<span class="lineNum">      37 </span>            : #include &lt;charset.h&gt;
<span class="lineNum">      38 </span>            : #include &lt;gfile.h&gt;
<span class="lineNum">      39 </span>            : #include &lt;ustring.h&gt;
<span class="lineNum">      40 </span>            : 
<span class="lineNum">      41 </span>            : #include &lt;sys/types.h&gt;
<span class="lineNum">      42 </span>            : #include &lt;dirent.h&gt;
<span class="lineNum">      43 </span>            : #include &lt;locale.h&gt;
<span class="lineNum">      44 </span>            : #include &lt;time.h&gt;
<span class="lineNum">      45 </span>            : #include &lt;sys/time.h&gt;
<span class="lineNum">      46 </span>            : #include &lt;stdlib.h&gt;
<span class="lineNum">      47 </span>            : 
<span class="lineNum">      48 </span>            : #include &quot;ttf.h&quot;
<span class="lineNum">      49 </span>            : 
<span class="lineNum">      50 </span>            : #if HAVE_LANGINFO_H
<span class="lineNum">      51 </span>            : # include &lt;langinfo.h&gt;
<span class="lineNum">      52 </span>            : #endif
<span class="lineNum">      53 </span>            : 
<span class="lineNum">      54 </span>            : #if defined(__MINGW32__)
<span class="lineNum">      55 </span>            : #include &lt;windows.h&gt;
<span class="lineNum">      56 </span>            : #endif
<span class="lineNum">      57 </span>            : 
<span class="lineNum">      58 </span>            : #include &lt;glib.h&gt;
<span class="lineNum">      59 </span>            : 
<span class="lineNum">      60 </span>            : static char *othersubrsfile = NULL;
<span class="lineNum">      61 </span>            : 
<span class="lineNum">      62 </span>            : extern int adjustwidth;
<span class="lineNum">      63 </span>            : extern int adjustlbearing;
<span class="lineNum">      64 </span>            : extern Encoding *default_encoding;
<span class="lineNum">      65 </span>            : extern int autohint_before_generate;
<span class="lineNum">      66 </span>            : extern int accent_offset;
<span class="lineNum">      67 </span>            : extern int GraveAcuteCenterBottom;
<span class="lineNum">      68 </span>            : extern int PreferSpacingAccents;
<span class="lineNum">      69 </span>            : extern int CharCenterHighest;
<span class="lineNum">      70 </span>            : extern int recognizePUA;
<span class="lineNum">      71 </span>            : extern int snaptoint;
<span class="lineNum">      72 </span>            : extern float joinsnap;
<span class="lineNum">      73 </span>            : extern char *BDFFoundry;
<span class="lineNum">      74 </span>            : extern char *TTFFoundry;
<span class="lineNum">      75 </span>            : extern char *xuid;
<span class="lineNum">      76 </span>            : extern char *SaveTablesPref;
<span class="lineNum">      77 </span>            : extern int maxundoes;                   /* in cvundoes */
<span class="lineNum">      78 </span>            : extern int prefer_cjk_encodings;        /* in parsettf */
<span class="lineNum">      79 </span>            : extern int onlycopydisplayed, copymetadata, copyttfinstr;
<span class="lineNum">      80 </span>            : extern int oldformatstate;              /* in savefontdlg.c */
<span class="lineNum">      81 </span>            : extern int oldbitmapstate;              /* in savefontdlg.c */
<span class="lineNum">      82 </span>            : static int old_ttf_flags=0, old_otf_flags=0;
<span class="lineNum">      83 </span>            : extern int old_sfnt_flags;              /* in savefont.c */
<span class="lineNum">      84 </span>            : extern int old_ps_flags;                /* in savefont.c */
<span class="lineNum">      85 </span>            : extern int preferpotrace;               /* in autotrace.c */
<span class="lineNum">      86 </span>            : extern int autotrace_ask;               /* in autotrace.c */
<span class="lineNum">      87 </span>            : extern int mf_ask;                      /* in autotrace.c */
<span class="lineNum">      88 </span>            : extern int mf_clearbackgrounds;         /* in autotrace.c */
<span class="lineNum">      89 </span>            : extern int mf_showerrors;               /* in autotrace.c */
<span class="lineNum">      90 </span>            : extern char *mf_args;                   /* in autotrace.c */
<span class="lineNum">      91 </span>            : static int glyph_2_name_map=0;          /* was in tottf.c, now a flag in savefont options dlg */
<span class="lineNum">      92 </span>            : extern int coverageformatsallowed;      /* in tottfgpos.c */
<span class="lineNum">      93 </span>            : extern int hint_diagonal_ends;          /* in stemdb.c */
<span class="lineNum">      94 </span>            : extern int hint_diagonal_intersections; /* in stemdb.c */
<span class="lineNum">      95 </span>            : extern int hint_bounding_boxes;         /* in stemdb.c */
<span class="lineNum">      96 </span>            : extern int detect_diagonal_stems;       /* in stemdb.c */
<span class="lineNum">      97 </span>            : extern int new_em_size;                         /* in splineutil2.c */
<span class="lineNum">      98 </span>            : extern int new_fonts_are_order2;                /* in splineutil2.c */
<span class="lineNum">      99 </span>            : extern int loaded_fonts_same_as_new;            /* in splineutil2.c */
<span class="lineNum">     100 </span>            : extern int use_second_indic_scripts;            /* in tottfgpos.c */
<span class="lineNum">     101 </span>            : extern MacFeat *default_mac_feature_map,        /* from macenc.c */
<span class="lineNum">     102 </span>            :                 *user_mac_feature_map;
<span class="lineNum">     103 </span>            : extern int allow_utf8_glyphnames;               /* in charinfo.c */
<span class="lineNum">     104 </span>            : extern int ask_user_for_cmap;                   /* in parsettf.c */
<span class="lineNum">     105 </span>            : extern NameList *force_names_when_opening;
<span class="lineNum">     106 </span>            : extern NameList *force_names_when_saving;
<span class="lineNum">     107 </span>            : extern NameList *namelist_for_new_fonts;
<span class="lineNum">     108 </span>            : extern int default_fv_row_count;                /* in splineutil2.c */
<span class="lineNum">     109 </span>            : extern int default_fv_col_count;                /* in splineutil2.c */
<span class="lineNum">     110 </span>            : extern int use_freetype_to_rasterize_fv;        /* in bitmapchar.c */
<span class="lineNum">     111 </span>            : 
<span class="lineNum">     112 </span>            : /* UI preferences which we don't use, but will preserve to so we can read/write */
<span class="lineNum">     113 </span>            : /*  UI preference files without loss of data */
<span class="lineNum">     114 </span>            : static char *xdefs_filename;
<span class="lineNum">     115 </span>            : static int splash=1;
<span class="lineNum">     116 </span>            : static int cv_auto_goto=1;
<span class="lineNum">     117 </span>            : static int OpenCharsInNewWindow=1;
<span class="lineNum">     118 </span>            : static float arrowAmount=1;
<span class="lineNum">     119 </span>            : static float arrowAccelFactor=10;
<span class="lineNum">     120 </span>            : static float snapdistance=3.5;
<span class="lineNum">     121 </span>            : static int stop_at_join=0;
<span class="lineNum">     122 </span>            : static int updateflex=0;                                /* in charview.c */
<span class="lineNum">     123 </span>            : static int ask_user_for_resolution=1;
<span class="lineNum">     124 </span>            : static int default_fv_showhmetrics=0;   /* in fontview */
<span class="lineNum">     125 </span>            : static int default_fv_showvmetrics=0;   /* in fontview */
<span class="lineNum">     126 </span>            : static int default_fv_glyphlabel=0;     /* in fontview */
<span class="lineNum">     127 </span>            : static int save_to_dir=0;                       /* in fontview, use sfdir rather than sfd */
<span class="lineNum">     128 </span>            : static int palettes_docked=1;           /* in cvpalettes */
<span class="lineNum">     129 </span>            : static int cvvisible[2]={1,1}, bvvisible[3]={1,1,1};    /* in cvpalettes.c */
<span class="lineNum">     130 </span>            : static int infowindowdistance=10;               /* in cvruler.c */
<span class="lineNum">     131 </span>            : static int loacal_markextrema, loacal_markpoi, loacal_showrulers,
<span class="lineNum">     132 </span>            :     loacal_showcpinfo, loacal_showsidebearings, loacal_showpoints,
<span class="lineNum">     133 </span>            :     loacal_showfilled, loacal_showtabs, loacal_showrefnames;
<span class="lineNum">     134 </span>            : static int oldsystem=100;
<span class="lineNum">     135 </span>            : static int rectelipse=0, polystar=0, regular_star=0;    /* from cvpalettes.c */
<span class="lineNum">     136 </span>            : static int center_out[2]={0,0};                 /* from cvpalettes.c */
<span class="lineNum">     137 </span>            : static float rr_radius=0;                               /* from cvpalettes.c */
<span class="lineNum">     138 </span>            : static int ps_pointcnt=5;                               /* from cvpalettes.c */
<span class="lineNum">     139 </span>            : static float star_percent=100;                  /* from cvpalettes.c */
<span class="lineNum">     140 </span>            : static int debug_wins=0;                        /* in cvdebug.c */
<span class="lineNum">     141 </span>            : static int gridfit_dpi=100, gridfit_depth=1;    /* in cvgridfit.c */
<span class="lineNum">     142 </span>            : static float gridfit_pointsizex=12;             /* in cvgridfit.c */
<span class="lineNum">     143 </span>            : static float gridfit_pointsizey=12;             /* in cvgridfit.c */
<span class="lineNum">     144 </span>            : static int  gridfit_x_sameas_y=true;            /* in cvgridfit.c */
<span class="lineNum">     145 </span>            : static int default_font_filter_index=0;
<span class="lineNum">     146 </span>            : static unichar_t *script_menu_names[SCRIPT_MENU_MAX];
<span class="lineNum">     147 </span>            : static char *script_filenames[SCRIPT_MENU_MAX];
<span class="lineNum">     148 </span>            : /* defined in fontforgeui.h */
<span class="lineNum">     149 </span>            : #define RECENT_MAX 10
<span class="lineNum">     150 </span>            : static char *RecentFiles[RECENT_MAX];
<span class="lineNum">     151 </span>            : static int ItalicConstrained = true;
<span class="lineNum">     152 </span>            : extern int clear_tt_instructions_when_needed;   /* cvundoes.c */
<span class="lineNum">     153 </span>            : static int cv_width;                    /* in charview.c */
<span class="lineNum">     154 </span>            : static int cv_height;                   /* in charview.c */
<span class="lineNum">     155 </span>            : static int mv_width;                            /* in metricsview.c */
<span class="lineNum">     156 </span>            : static int mv_height;                           /* in metricsview.c */
<span class="lineNum">     157 </span>            : static int bv_width;                            /* in bitmapview.c */
<span class="lineNum">     158 </span>            : static int bv_height;                           /* in bitmapview.c */
<span class="lineNum">     159 </span>            : static int mvshowgrid;                          /* in metricsview.c */
<span class="lineNum">     160 </span>            : static int old_validate = true;
<span class="lineNum">     161 </span>            : static int old_fontlog = false;
<span class="lineNum">     162 </span>            : static int home_char = 'A';
<span class="lineNum">     163 </span>            : static int compact_font_on_open=0;
<span class="lineNum">     164 </span>            : static int aa_pixelsize;                        /* from anchorsaway.c */
<span class="lineNum">     165 </span>            : 
<span class="lineNum">     166 </span>            : static int gfc_showhidden, gfc_dirplace;
<span class="lineNum">     167 </span>            : static char *gfc_bookmarks=NULL;
<span class="lineNum">     168 </span>            : static char *pixmapdir=NULL;
<span class="lineNum">     169 </span>            : 
<span class="lineNum">     170 </span>            : enum pref_types { pr_int, pr_real, pr_bool, pr_enum, pr_encoding, pr_string,
<span class="lineNum">     171 </span>            :         pr_file, pr_namelist, pr_unicode };
<span class="lineNum">     172 </span>            : 
<span class="lineNum">     173 </span>            : static struct prefs_list {
<span class="lineNum">     174 </span>            :     char *name;
<span class="lineNum">     175 </span>            :         /* In the prefs file the untranslated name will always be used, but */
<span class="lineNum">     176 </span>            :         /* in the UI that name may be translated. */
<span class="lineNum">     177 </span>            :     enum pref_types type;
<span class="lineNum">     178 </span>            :     void *val;
<span class="lineNum">     179 </span>            :     void *(*get)(void);
<span class="lineNum">     180 </span>            :     void (*set)(void *);
<span class="lineNum">     181 </span>            :     char mn;
<span class="lineNum">     182 </span>            :     struct enums *enums;
<span class="lineNum">     183 </span>            :     unsigned int dontdisplay: 1;
<span class="lineNum">     184 </span>            :     char *popup;
<span class="lineNum">     185 </span>            : } core_list[] = {
<span class="lineNum">     186 </span>            :     { N_(&quot;OtherSubrsFile&quot;), pr_file, &amp;othersubrsfile, NULL, NULL, 'O', NULL, 0, N_(&quot;If you wish to replace Adobe's OtherSubrs array (for Type1 fonts)\nwith an array of your own, set this to point to a file containing\na list of up to 14 PostScript subroutines. Each subroutine must\nbe preceded by a line starting with '%%%%' (any text before the\nfirst '%%%%' line will be treated as an initial copyright notice).\nThe first three subroutines are for flex hints, the next for hint\nsubstitution (this MUST be present), the 14th (or 13 as the\nnumbering actually starts with 0) is for counter hints.\nThe subroutines should not be enclosed in a [ ] pair.&quot;) },
<span class="lineNum">     187 </span>            :     { N_(&quot;NewCharset&quot;), pr_encoding, &amp;default_encoding, NULL, NULL, 'N', NULL, 0, N_(&quot;Default encoding for\nnew fonts&quot;) },
<span class="lineNum">     188 </span>            :     { N_(&quot;NewEmSize&quot;), pr_int, &amp;new_em_size, NULL, NULL, 'S', NULL, 0, N_(&quot;The default size of the Em-Square in a newly created font.&quot;) },
<span class="lineNum">     189 </span>            :     { N_(&quot;NewFontsQuadratic&quot;), pr_bool, &amp;new_fonts_are_order2, NULL, NULL, 'Q', NULL, 0, N_(&quot;Whether new fonts should contain splines of quadratic (truetype)\nor cubic (postscript &amp; opentype).&quot;) },
<span class="lineNum">     190 </span>            :     { N_(&quot;FreeTypeInFontView&quot;), pr_bool, &amp;use_freetype_to_rasterize_fv, NULL, NULL, 'O', NULL, 0, N_(&quot;Use the FreeType rasterizer (when available)\nto rasterize glyphs in the font view.\nThis generally results in better quality.&quot;) },
<span class="lineNum">     191 </span>            :     { N_(&quot;LoadedFontsAsNew&quot;), pr_bool, &amp;loaded_fonts_same_as_new, NULL, NULL, 'L', NULL, 0, N_(&quot;Whether fonts loaded from the disk should retain their splines\nwith the original order (quadratic or cubic), or whether the\nsplines should be converted to the default order for new fonts\n(see NewFontsQuadratic).&quot;) },
<span class="lineNum">     192 </span>            :     { N_(&quot;PreferCJKEncodings&quot;), pr_bool, &amp;prefer_cjk_encodings, NULL, NULL, 'C', NULL, 0, N_(&quot;When loading a truetype or opentype font which has both a unicode\nand a CJK encoding table, use this flag to specify which\nshould be loaded for the font.&quot;) },
<span class="lineNum">     193 </span>            :     { N_(&quot;AskUserForCMap&quot;), pr_bool, &amp;ask_user_for_cmap, NULL, NULL, 'O', NULL, 0, N_(&quot;When loading a font in sfnt format (TrueType, OpenType, etc.),\nask the user to specify which cmap to use initially.&quot;) },
<span class="lineNum">     194 </span>            :     { N_(&quot;PreserveTables&quot;), pr_string, &amp;SaveTablesPref, NULL, NULL, 'P', NULL, 0, N_(&quot;Enter a list of 4 letter table tags, separated by commas.\nFontForge will make a binary copy of these tables when it\nloads a True/OpenType font, and will output them (unchanged)\nwhen it generates the font. Do not include table tags which\nFontForge thinks it understands.&quot;) },
<span class="lineNum">     195 </span>            :     { N_(&quot;ItalicConstrained&quot;), pr_bool, &amp;ItalicConstrained, NULL, NULL, '\0', NULL, 0, N_(&quot;In the Outline View, the Shift key constrains motion to be parallel to the ItalicAngle rather than constraining it to be vertical.&quot;) },
<span class="lineNum">     196 </span>            :     { N_(&quot;SnapToInt&quot;), pr_bool, &amp;snaptoint, NULL, NULL, '\0', NULL, 0, N_(&quot;When the user clicks in the editing window, round the location to the nearest integers.&quot;) },
<span class="lineNum">     197 </span>            :     { N_(&quot;JoinSnap&quot;), pr_real, &amp;joinsnap, NULL, NULL, '\0', NULL, 0, N_(&quot;The Edit-&gt;Join command will join points which are this close together\nA value of 0 means they must be coincident&quot;) },
<span class="lineNum">     198 </span>            :     { N_(&quot;CopyMetaData&quot;), pr_bool, &amp;copymetadata, NULL, NULL, '\0', NULL, 0, N_(&quot;When copying glyphs from the font view, also copy the\nglyphs' metadata (name, encoding, comment, etc).&quot;) },
<span class="lineNum">     199 </span>            :     { N_(&quot;UndoDepth&quot;), pr_int, &amp;maxundoes, NULL, NULL, '\0', NULL, 0, N_(&quot;The maximum number of Undoes/Redoes stored in a glyph&quot;) },
<span class="lineNum">     200 </span>            :     { N_(&quot;AutoWidthSync&quot;), pr_bool, &amp;adjustwidth, NULL, NULL, '\0', NULL, 0, N_(&quot;Changing the width of a glyph\nchanges the widths of all accented\nglyphs based on it.&quot;) },
<span class="lineNum">     201 </span>            :     { N_(&quot;AutoLBearingSync&quot;), pr_bool, &amp;adjustlbearing, NULL, NULL, '\0', NULL, 0, N_(&quot;Changing the left side bearing\nof a glyph adjusts the lbearing\nof other references in all accented\nglyphs based on it.&quot;) },
<span class="lineNum">     202 </span>            :     { N_(&quot;ClearInstrsBigChanges&quot;), pr_bool, &amp;clear_tt_instructions_when_needed, NULL, NULL, 'C', NULL, 0, N_(&quot;Instructions in a TrueType font refer to\npoints by number, so if you edit a glyph\nin such a way that some points have different\nnumbers (add points, remove them, etc.) then\nthe instructions will be applied to the wrong\npoints with disasterous results.\n  Normally FontForge will remove the instructions\nif it detects that the points have been renumbered\nin order to avoid the above problem. You may turn\nthis behavior off -- but be careful!&quot;) },
<span class="lineNum">     203 </span>            :     { N_(&quot;CopyTTFInstrs&quot;), pr_bool, &amp;copyttfinstr, NULL, NULL, '\0', NULL, 0, N_(&quot;When copying glyphs from the font view, also copy the\nglyphs' metadata (name, encoding, comment, etc).&quot;) },
<span class="lineNum">     204 </span>            :     { N_(&quot;AccentOffsetPercent&quot;), pr_int, &amp;accent_offset, NULL, NULL, '\0', NULL, 0, N_(&quot;The percentage of an em by which an accent is offset from its base glyph in Build Accent&quot;) },
<span class="lineNum">     205 </span>            :     { N_(&quot;AccentCenterLowest&quot;), pr_bool, &amp;GraveAcuteCenterBottom, NULL, NULL, '\0', NULL, 0, N_(&quot;When placing grave and acute accents above letters, should\nFontForge center them based on their full width, or\nshould it just center based on the lowest point\nof the accent.&quot;) },
<span class="lineNum">     206 </span>            :     { N_(&quot;CharCenterHighest&quot;), pr_bool, &amp;CharCenterHighest, NULL, NULL, '\0', NULL, 0, N_(&quot;When centering an accent over a glyph, should the accent\nbe centered on the highest point(s) of the glyph,\nor the middle of the glyph?&quot;) },
<span class="lineNum">     207 </span>            :     { N_(&quot;PreferSpacingAccents&quot;), pr_bool, &amp;PreferSpacingAccents, NULL, NULL, '\0', NULL, 0, N_(&quot;Use spacing accents (Unicode: 02C0-02FF) rather than\ncombining accents (Unicode: 0300-036F) when\nbuilding accented glyphs.&quot;) },
<span class="lineNum">     208 </span>            :     { N_(&quot;PreferPotrace&quot;), pr_bool, &amp;preferpotrace, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge supports two different helper applications to do autotracing\n autotrace and potrace\nIf your system only has one it will use that one, if you have both\nuse this option to tell FontForge which to pick.&quot;) },
<span class="lineNum">     209 </span>            :     { N_(&quot;AutotraceArgs&quot;), pr_string, NULL, GetAutoTraceArgs, SetAutoTraceArgs, '\0', NULL, 0, N_(&quot;Extra arguments for configuring the autotrace program\n(either autotrace or potrace)&quot;) },
<span class="lineNum">     210 </span>            :     { N_(&quot;AutotraceAsk&quot;), pr_bool, &amp;autotrace_ask, NULL, NULL, '\0', NULL, 0, N_(&quot;Ask the user for autotrace arguments each time autotrace is invoked&quot;) },
<span class="lineNum">     211 </span>            :     { N_(&quot;MfArgs&quot;), pr_string, &amp;mf_args, NULL, NULL, '\0', NULL, 0, N_(&quot;Commands to pass to mf (metafont) program, the filename will follow these&quot;) },
<span class="lineNum">     212 </span>            :     { N_(&quot;MfAsk&quot;), pr_bool, &amp;mf_ask, NULL, NULL, '\0', NULL, 0, N_(&quot;Ask the user for mf commands each time mf is invoked&quot;) },
<span class="lineNum">     213 </span>            :     { N_(&quot;MfClearBg&quot;), pr_bool, &amp;mf_clearbackgrounds, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge loads large images into the background of each glyph\nprior to autotracing them. You may retain those\nimages to look at after mf processing is complete, or\nremove them to save space&quot;) },
<span class="lineNum">     214 </span>            :     { N_(&quot;MfShowErr&quot;), pr_bool, &amp;mf_showerrors, NULL, NULL, '\0', NULL, 0, N_(&quot;MetaFont (mf) generates lots of verbiage to stdout.\nMost of the time I find it an annoyance but it is\nimportant to see if something goes wrong.&quot;) },
<span class="lineNum">     215 </span>            :     { N_(&quot;FoundryName&quot;), pr_string, &amp;BDFFoundry, NULL, NULL, 'F', NULL, 0, N_(&quot;Name used for foundry field in bdf\nfont generation&quot;) },
<span class="lineNum">     216 </span>            :     { N_(&quot;TTFFoundry&quot;), pr_string, &amp;TTFFoundry, NULL, NULL, 'T', NULL, 0, N_(&quot;Name used for Vendor ID field in\nttf (OS/2 table) font generation.\nMust be no more than 4 characters&quot;) },
<span class="lineNum">     217 </span>            :     { N_(&quot;NewFontNameList&quot;), pr_namelist, &amp;namelist_for_new_fonts, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge will use this namelist when assigning\nglyph names to code points in a new font.&quot;) },
<span class="lineNum">     218 </span>            :     { N_(&quot;RecognizePUANames&quot;), pr_bool, &amp;recognizePUA, NULL, NULL, 'U', NULL, 0, N_(&quot;Once upon a time, Adobe assigned PUA (public use area) encodings\nfor many stylistic variants of characters (small caps, old style\nnumerals, etc.). Adobe no longer believes this to be a good idea,\nand recommends that these encodings be ignored.\n\n The assignments were originally made because most applications\ncould not handle OpenType features for accessing variants. Adobe\nnow believes that all apps that matter can now do so. Applications\nlike Word and OpenOffice still can't handle these features, so\n fontforge's default behavior is to ignore Adobe's current\nrecommendations.\n\nNote: This does not affect figuring out unicode from the font's encoding,\nit just controls determining unicode from a name.&quot;) },
<span class="lineNum">     219 </span>            :     { N_(&quot;UnicodeGlyphNames&quot;), pr_bool, &amp;allow_utf8_glyphnames, NULL, NULL, 'O', NULL, 0, N_(&quot;Allow the full unicode character set in glyph names.\nThis does not conform to adobe's glyph name standard.\nSuch names should be for internal use only and\nshould NOT end up in production fonts.&quot; ) },
<span class="lineNum">     220 </span>            :     { N_(&quot;XUID-Base&quot;), pr_string, &amp;xuid, NULL, NULL, 'X', NULL, 0, N_(&quot;If specified this should be a space separated list of integers each\nless than 16777216 which uniquely identify your organization\nFontForge will generate a random number for the final component.&quot;) },
<span class="lineNum">     221 </span>            :     { N_(&quot;AskBDFResolution&quot;), pr_bool, &amp;ask_user_for_resolution, NULL, NULL, 'B', NULL, 0, N_(&quot;When generating a set of BDF fonts ask the user\nto specify the screen resolution of the fonts\notherwise FontForge will guess depending on the pixel size.&quot;) },
<span class="lineNum">     222 </span>            :     { N_(&quot;AutoHint&quot;), pr_bool, &amp;autohint_before_generate, NULL, NULL, 'H', NULL, 0, N_(&quot;AutoHint changed glyphs before generating a font&quot;) },
<span class="lineNum">     223 </span>            :     { N_(&quot;HintBoundingBoxes&quot;), pr_bool, &amp;hint_bounding_boxes, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge will place vertical or horizontal hints to describe the bounding boxes of suitable glyphs.&quot;) },
<span class="lineNum">     224 </span>            :     { N_(&quot;HintDiagonalEnds&quot;), pr_bool, &amp;hint_diagonal_ends, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge will place vertical or horizontal hints at the ends of diagonal stems.&quot;) },
<span class="lineNum">     225 </span>            :     { N_(&quot;HintDiagonalInter&quot;), pr_bool, &amp;hint_diagonal_intersections, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge will place vertical or horizontal hints at the intersections of diagonal stems.&quot;) },
<span class="lineNum">     226 </span>            :     { N_(&quot;DetectDiagonalStems&quot;), pr_bool, &amp;detect_diagonal_stems, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge will generate diagonal stem hints, which then can be used by the AutoInstr command.&quot;) },
<span class="lineNum">     227 </span>            :     { N_(&quot;UseNewIndicScripts&quot;), pr_bool, &amp;use_second_indic_scripts, NULL, NULL, 'C', NULL, 0, N_(&quot;MS has changed (in August 2006) the inner workings of their Indic shaping\nengine, and to disambiguate this change has created a parallel set of script\ntags (generally ending in '2') for Indic writing systems. If you are working\nwith the new system set this flag, if you are working with the old unset it.\n(if you aren't doing Indic work, this flag is irrelevant).&quot;) },
<span class="lineNum">     228 </span>            :     { &quot;AntiAlias&quot;, pr_bool, &amp;default_fv_antialias, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     229 </span>            :     { &quot;DefaultFVSize&quot;, pr_int, &amp;default_fv_font_size, NULL, NULL, 'S', NULL, 1, NULL },
<span class="lineNum">     230 </span>            :     { &quot;DefaultFVRowCount&quot;, pr_int, &amp;default_fv_row_count, NULL, NULL, 'S', NULL, 1, NULL },
<span class="lineNum">     231 </span>            :     { &quot;DefaultFVColCount&quot;, pr_int, &amp;default_fv_col_count, NULL, NULL, 'S', NULL, 1, NULL },
<span class="lineNum">     232 </span>            :     { &quot;OnlyCopyDisplayed&quot;, pr_bool, &amp;onlycopydisplayed, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     233 </span>            :     { &quot;DefaultOutputFormat&quot;, pr_int, &amp;oldformatstate, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     234 </span>            :     { &quot;DefaultBitmapFormat&quot;, pr_int, &amp;oldbitmapstate, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     235 </span>            :     { &quot;SaveValidate&quot;, pr_int, &amp;old_validate, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     236 </span>            :     { &quot;SaveFontLogAsk&quot;, pr_int, &amp;old_fontlog, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     237 </span>            :     { &quot;DefaultSFNTflags&quot;, pr_int, &amp;old_sfnt_flags, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     238 </span>            :     { &quot;DefaultPSflags&quot;, pr_int, &amp;old_ps_flags, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     239 </span>            :     { &quot;PageWidth&quot;, pr_int, &amp;pagewidth, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     240 </span>            :     { &quot;PageHeight&quot;, pr_int, &amp;pageheight, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     241 </span>            :     { &quot;PrintType&quot;, pr_int, &amp;printtype, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     242 </span>            :     { &quot;PrintCommand&quot;, pr_string, &amp;printcommand, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     243 </span>            :     { &quot;PageLazyPrinter&quot;, pr_string, &amp;printlazyprinter, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     244 </span>            :     { &quot;CoverageFormatsAllowed&quot;, pr_int, &amp;coverageformatsallowed, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     245 </span>            :     { &quot;ForceNamesWhenOpening&quot;, pr_namelist, &amp;force_names_when_opening, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     246 </span>            :     { &quot;ForceNamesWhenSaving&quot;, pr_namelist, &amp;force_names_when_saving, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     247 </span>            :     { NULL, 0, NULL, NULL, NULL, '\0', NULL, 0, NULL } /* Sentinel */
<span class="lineNum">     248 </span>            : },
<span class="lineNum">     249 </span>            : extras[] = {
<span class="lineNum">     250 </span>            :     { N_(&quot;ResourceFile&quot;), pr_file, &amp;xdefs_filename, NULL, NULL, 'R', NULL, 0, N_(&quot;When FontForge starts up, it loads the user interface theme from\nthis file. Any changes will only take effect the next time you start FontForge.&quot;) },
<span class="lineNum">     251 </span>            :     { N_(&quot;SplashScreen&quot;), pr_bool, &amp;splash, NULL, NULL, 'S', NULL, 0, N_(&quot;Show splash screen on start-up&quot;) },
<span class="lineNum">     252 </span>            :     { N_(&quot;GlyphAutoGoto&quot;), pr_bool, &amp;cv_auto_goto, NULL, NULL, '\0', NULL, 0, N_(&quot;Typing a normal character in the glyph view window changes the window to look at that character&quot;) },
<span class="lineNum">     253 </span>            :     { N_(&quot;OpenCharsInNewWindow&quot;), pr_bool, &amp;OpenCharsInNewWindow, NULL, NULL, '\0', NULL, 0, N_(&quot;When double clicking on a character in the font view\nopen that character in a new window, otherwise\nreuse an existing one.&quot;) },
<span class="lineNum">     254 </span>            :     { N_(&quot;ArrowMoveSize&quot;), pr_real, &amp;arrowAmount, NULL, NULL, '\0', NULL, 0, N_(&quot;The number of em-units by which an arrow key will move a selected point&quot;) },
<span class="lineNum">     255 </span>            :     { N_(&quot;ArrowAccelFactor&quot;), pr_real, &amp;arrowAccelFactor, NULL, NULL, '\0', NULL, 0, N_(&quot;Holding down the Shift key will speed up arrow key motion by this factor&quot;) },
<span class="lineNum">     256 </span>            :     { N_(&quot;SnapDistance&quot;), pr_real, &amp;snapdistance, NULL, NULL, '\0', NULL, 0, N_(&quot;When the mouse pointer is within this many pixels\nof one of the various interesting features (baseline,\nwidth, grid splines, etc.) the pointer will snap\nto that feature.&quot;) },
<span class="lineNum">     257 </span>            :     { N_(&quot;StopAtJoin&quot;), pr_bool, &amp;stop_at_join, NULL, NULL, '\0', NULL, 0, N_(&quot;When dragging points in the outline view a join may occur\n(two open contours may connect at their endpoints). When\nthis is On a join will cause FontForge to stop moving the\nselection (as if the user had released the mouse button).\nThis is handy if your fingers are inclined to wiggle a bit.&quot;) },
<span class="lineNum">     258 </span>            :     { N_(&quot;UpdateFlex&quot;), pr_bool, &amp;updateflex, NULL, NULL, '\0', NULL, 0, N_(&quot;Figure out flex hints after every change&quot;) },
<span class="lineNum">     259 </span>            :     { N_(&quot;AskBDFResolution&quot;), pr_bool, &amp;ask_user_for_resolution, NULL, NULL, 'B', NULL, 0, N_(&quot;When generating a set of BDF fonts ask the user\nto specify the screen resolution of the fonts\notherwise FontForge will guess depending on the pixel size.&quot;) },
<span class="lineNum">     260 </span>            :     { &quot;DefaultFVShowHmetrics&quot;, pr_int, &amp;default_fv_showhmetrics, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     261 </span>            :     { &quot;DefaultFVShowVmetrics&quot;, pr_int, &amp;default_fv_showvmetrics, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     262 </span>            :     { &quot;DefaultFVGlyphLabel&quot;, pr_int, &amp;default_fv_glyphlabel, NULL, NULL, 'S', NULL, 1, NULL },
<span class="lineNum">     263 </span>            :     { &quot;SaveToDir&quot;, pr_int, &amp;save_to_dir, NULL, NULL, 'S', NULL, 1, NULL },
<span class="lineNum">     264 </span>            :     { &quot;PalettesDocked&quot;, pr_bool, &amp;palettes_docked, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     265 </span>            :     { &quot;CVVisible0&quot;, pr_bool, &amp;cvvisible[0], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     266 </span>            :     { &quot;CVVisible1&quot;, pr_bool, &amp;cvvisible[1], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     267 </span>            :     { &quot;BVVisible0&quot;, pr_bool, &amp;bvvisible[0], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     268 </span>            :     { &quot;BVVisible1&quot;, pr_bool, &amp;bvvisible[1], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     269 </span>            :     { &quot;BVVisible2&quot;, pr_bool, &amp;bvvisible[2], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     270 </span>            :     { &quot;InfoWindowDistance&quot;, pr_int, &amp;infowindowdistance, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     271 </span>            :     { &quot;MarkExtrema&quot;, pr_int, &amp;loacal_markextrema, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     272 </span>            :     { &quot;MarkPointsOfInflect&quot;, pr_int, &amp;loacal_markpoi, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     273 </span>            :     { &quot;ShowRulers&quot;, pr_bool, &amp;loacal_showrulers, NULL, NULL, '\0', NULL, 1, N_(&quot;Display rulers in the Outline Glyph View&quot;) },
<span class="lineNum">     274 </span>            :     { &quot;ShowCPInfo&quot;, pr_int, &amp;loacal_showcpinfo, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     275 </span>            :     { &quot;ShowSideBearings&quot;, pr_int, &amp;loacal_showsidebearings, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     276 </span>            :     { &quot;ShowRefNames&quot;, pr_int, &amp;loacal_showrefnames, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     277 </span>            :     { &quot;ShowPoints&quot;, pr_bool, &amp;loacal_showpoints, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     278 </span>            :     { &quot;ShowFilled&quot;, pr_int, &amp;loacal_showfilled, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     279 </span>            :     { &quot;ShowTabs&quot;, pr_int, &amp;loacal_showtabs, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     280 </span>            :     { &quot;DefaultScreenDpiSystem&quot;, pr_int, &amp;oldsystem, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     281 </span>            :     { &quot;RegularStar&quot;, pr_bool, &amp;regular_star, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     282 </span>            :     { &quot;PolyStar&quot;, pr_bool, &amp;polystar, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     283 </span>            :     { &quot;RectEllipse&quot;, pr_bool, &amp;rectelipse, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     284 </span>            :     { &quot;RectCenterOut&quot;, pr_bool, &amp;center_out[0], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     285 </span>            :     { &quot;EllipseCenterOut&quot;, pr_bool, &amp;center_out[1], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     286 </span>            :     { &quot;PolyStartPointCnt&quot;, pr_int, &amp;ps_pointcnt, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     287 </span>            :     { &quot;RoundRectRadius&quot;, pr_real, &amp;rr_radius, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     288 </span>            :     { &quot;StarPercent&quot;, pr_real, &amp;star_percent, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     289 </span>            :     { &quot;DebugWins&quot;, pr_int, &amp;debug_wins, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     290 </span>            :     { &quot;GridFitDpi&quot;, pr_int, &amp;gridfit_dpi, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     291 </span>            :     { &quot;GridFitDepth&quot;, pr_int, &amp;gridfit_depth, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     292 </span>            :     { &quot;GridFitPointSize&quot;, pr_real, &amp;gridfit_pointsizey, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     293 </span>            :     { &quot;GridFitPointSizeX&quot;, pr_real, &amp;gridfit_pointsizex, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     294 </span>            :     { &quot;GridFitSameAs&quot;, pr_int, &amp;gridfit_x_sameas_y, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     295 </span>            :     { &quot;MVShowGrid&quot;, pr_int, &amp;mvshowgrid, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     296 </span>            :     { &quot;DefaultFontFilterIndex&quot;, pr_int, &amp;default_font_filter_index, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     297 </span>            :     { &quot;SeekChar&quot;, pr_unicode, &amp;home_char, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     298 </span>            :     { &quot;CompactOnOpen&quot;, pr_bool, &amp;compact_font_on_open, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     299 </span>            :     { &quot;PixmapDir&quot;, pr_file, &amp;pixmapdir, NULL, NULL, 'R', NULL, 0, NULL },
<span class="lineNum">     300 </span>            :     { &quot;DefaultCVWidth&quot;, pr_int, &amp;cv_width, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     301 </span>            :     { &quot;DefaultCVHeight&quot;, pr_int, &amp;cv_height, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     302 </span>            :     { &quot;FCShowHidden&quot;, pr_bool, &amp;gfc_showhidden, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     303 </span>            :     { &quot;FCDirPlacement&quot;, pr_int, &amp;gfc_dirplace, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     304 </span>            :     { &quot;FCBookmarks&quot;, pr_string, &amp;gfc_bookmarks, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     305 </span>            :     { &quot;DefaultMVWidth&quot;, pr_int, &amp;mv_width, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     306 </span>            :     { &quot;DefaultMVHeight&quot;, pr_int, &amp;mv_height, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     307 </span>            :     { &quot;DefaultBVWidth&quot;, pr_int, &amp;bv_width, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     308 </span>            :     { &quot;DefaultBVHeight&quot;, pr_int, &amp;bv_height, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     309 </span>            :     { &quot;AnchorControlPixelSize&quot;, pr_int, &amp;aa_pixelsize, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     310 </span>            :     { &quot;DefaultTTFflags&quot;, pr_int, &amp;old_ttf_flags, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     311 </span>            :     { &quot;DefaultOTFflags&quot;, pr_int, &amp;old_otf_flags, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     312 </span>            :     { NULL, 0, NULL, NULL, NULL, '\0', NULL, 0, NULL } /* Sentinel */
<span class="lineNum">     313 </span>            : },
<a name="314"><span class="lineNum">     314 </span>            : *prefs_list[] = { core_list, extras, NULL };</a>
<span class="lineNum">     315 </span>            : 
<span class="lineNum">     316 </span><span class="lineNoCov">          0 : static int UserSettingsDiffer(void) {</span>
<span class="lineNum">     317 </span>            :     int i,j;
<span class="lineNum">     318 </span>            : 
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :     if ( user_macfeat_otftag==NULL )</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     321 </span>            : 
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :     for ( i=0; user_macfeat_otftag[i].otf_tag!=0; ++i );</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :     for ( j=0; macfeat_otftag[j].otf_tag!=0; ++j );</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :     if ( i!=j )</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :     for ( i=0; user_macfeat_otftag[i].otf_tag!=0; ++i ) {</span>
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :         for ( j=0; macfeat_otftag[j].otf_tag!=0; ++j ) {</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :             if ( macfeat_otftag[j].mac_feature_type ==</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag[i].mac_feature_type &amp;&amp;</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :                     macfeat_otftag[j].mac_feature_setting ==</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag[i].mac_feature_setting &amp;&amp;</span>
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :                     macfeat_otftag[j].otf_tag ==</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag[i].otf_tag )</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     335 </span>            :         }
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :         if ( macfeat_otftag[j].otf_tag==0 )</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     338 </span>            :     }
<span class="lineNum">     339 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="340"><span class="lineNum">     340 </span>            : }</a>
<span class="lineNum">     341 </span>            : 
<span class="lineNum">     342 </span><span class="lineNoCov">          0 : static int NOUI_GetPrefs(char *name,Val *val) {</span>
<span class="lineNum">     343 </span>            :     int i,j;
<span class="lineNum">     344 </span>            :     
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :     for ( i=0; prefs_list[i]!=NULL; ++i ) for ( j=0; prefs_list[i][j].name!=NULL; ++j ) {</span>
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :         if ( strcmp(prefs_list[i][j].name,name)==0 ) {</span>
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :             struct prefs_list *pf = &amp;prefs_list[i][j];</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :             if ( pf-&gt;type == pr_bool || pf-&gt;type == pr_int || pf-&gt;type == pr_unicode ) {</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :                 val-&gt;type = v_int;</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :                 val-&gt;u.ival = *((int *) (pf-&gt;val));</span>
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_string || pf-&gt;type == pr_file ) {</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :                 val-&gt;type = v_str;</span>
<span class="lineNum">     353 </span>            : 
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :                 char *tmpstr = pf-&gt;val ? *((char **) (pf-&gt;val)) : (char *) (pf-&gt;get)();</span>
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :                 val-&gt;u.sval = copy( tmpstr ? tmpstr : &quot;&quot; );</span>
<span class="lineNum">     356 </span>            : 
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :                 if( ! pf-&gt;val )</span>
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :                     free( tmpstr );</span>
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_encoding ) {</span>
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :                 val-&gt;type = v_str;</span>
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :                 if ( *((NameList **) (pf-&gt;val))==NULL )</span>
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :                     val-&gt;u.sval = copy( &quot;NULL&quot; );</span>
<span class="lineNum">     363 </span>            :                 else
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :                     val-&gt;u.sval = copy( (*((Encoding **) (pf-&gt;val)))-&gt;enc_name );</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_namelist ) {</span>
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :                 val-&gt;type = v_str;</span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :                 val-&gt;u.sval = copy( (*((NameList **) (pf-&gt;val)))-&gt;title );</span>
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_real ) {</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :                 val-&gt;type = v_real;</span>
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :                 val-&gt;u.fval = *((float *) (pf-&gt;val));</span>
<span class="lineNum">     371 </span>            :             } else
<span class="lineNum">     372 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     373 </span>            : 
<span class="lineNum">     374 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     375 </span>            :         }
<span class="lineNum">     376 </span>            :     }
<span class="lineNum">     377 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="378"><span class="lineNum">     378 </span>            : }</a>
<span class="lineNum">     379 </span>            : 
<span class="lineNum">     380 </span><span class="lineNoCov">          0 : static int NOUI_SetPrefs(char *name,Val *val1, Val *val2) {</span>
<span class="lineNum">     381 </span>            :     int i,j;
<span class="lineNum">     382 </span>            : 
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :     for ( i=0; prefs_list[i]!=NULL; ++i ) for ( j=0; prefs_list[i][j].name!=NULL; ++j ) {</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :         if ( strcmp(prefs_list[i][j].name,name)==0 ) {</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :             struct prefs_list *pf = &amp;prefs_list[i][j];</span>
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :             if ( pf-&gt;type == pr_bool || pf-&gt;type == pr_int || pf-&gt;type == pr_unicode ) {</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :                 if ( (val1-&gt;type!=v_int &amp;&amp; val1-&gt;type!=v_unicode) || val2!=NULL )</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :                 *((int *) (pf-&gt;val)) = val1-&gt;u.ival;</span>
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_real ) {</span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :                 if ( val1-&gt;type==v_real &amp;&amp; val2==NULL )</span>
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :                     *((float *) (pf-&gt;val)) = val1-&gt;u.fval;</span>
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :                 else if ( val1-&gt;type!=v_int || (val2!=NULL &amp;&amp; val2-&gt;type!=v_int ))</span>
<span class="lineNum">     394 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     395 </span>            :                 else
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :                     *((float *) (pf-&gt;val)) = (val2==NULL ? val1-&gt;u.ival : val1-&gt;u.ival / (double) val2-&gt;u.ival);</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_string || pf-&gt;type == pr_file ) {</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :                 if ( val1-&gt;type!=v_str || val2!=NULL )</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :                 if ( pf-&gt;set ) {</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :                     pf-&gt;set( val1-&gt;u.sval );</span>
<span class="lineNum">     402 </span>            :                 } else {
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :                     free( *((char **) (pf-&gt;val)));</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :                     *((char **) (pf-&gt;val)) = copy( val1-&gt;u.sval );</span>
<span class="lineNum">     405 </span>            :                 }
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_encoding ) {</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :                 if ( val2!=NULL )</span>
<span class="lineNum">     408 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :                 else if ( val1-&gt;type==v_str &amp;&amp; pf-&gt;val == &amp;default_encoding) {</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :                     Encoding *enc = FindOrMakeEncoding(val1-&gt;u.sval);</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :                     if ( enc==NULL )</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :                     *((Encoding **) (pf-&gt;val)) = enc;</span>
<span class="lineNum">     414 </span>            :                 } else
<span class="lineNum">     415 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_namelist ) {</span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :                 if ( val2!=NULL )</span>
<span class="lineNum">     418 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :                 else if ( val1-&gt;type==v_str ) {</span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :                     NameList *nl = NameListByName(val1-&gt;u.sval);</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :                     if ( strcmp(val1-&gt;u.sval,&quot;NULL&quot;)==0 &amp;&amp; pf-&gt;val != &amp;namelist_for_new_fonts )</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :                         nl = NULL;</span>
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :                     else if ( nl==NULL )</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :                     *((NameList **) (pf-&gt;val)) = nl;</span>
<span class="lineNum">     426 </span>            :                 } else
<span class="lineNum">     427 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     428 </span>            :             } else
<span class="lineNum">     429 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     430 </span>            : 
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :             SavePrefs(true);</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     433 </span>            :         }
<span class="lineNum">     434 </span>            :     }
<span class="lineNum">     435 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="436"><span class="lineNum">     436 </span>            : }</a>
<span class="lineNum">     437 </span>            : 
<span class="lineNum">     438 </span><span class="lineNoCov">          0 : static char *getPfaEditPrefs(void) {</span>
<span class="lineNum">     439 </span>            :     static char *prefs=NULL;
<span class="lineNum">     440 </span>            :     char buffer[1025];
<span class="lineNum">     441 </span>            : 
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :     if ( prefs!=NULL )</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 : return( prefs );</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :     if ( getFontForgeUserDir(Config)==NULL )</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :     sprintf(buffer,&quot;%s/prefs&quot;, getFontForgeUserDir(Config));</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :     prefs = copy(buffer);</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 : return( prefs );</span>
<a name="449"><span class="lineNum">     449 </span>            : }</a>
<span class="lineNum">     450 </span>            : 
<span class="lineNum">     451 </span><span class="lineNoCov">          0 : static char *NOUI_getFontForgeShareDir(void) {</span>
<span class="lineNum">     452 </span>            : #if defined(__MINGW32__)
<span class="lineNum">     453 </span>            :     #ifndef MAX_PATH
<span class="lineNum">     454 </span>            :     #define MAX_PATH 4096
<span class="lineNum">     455 </span>            :     #endif
<span class="lineNum">     456 </span>            :     
<span class="lineNum">     457 </span>            :     static char* sharedir = NULL;
<span class="lineNum">     458 </span>            :     if(!sharedir){
<span class="lineNum">     459 </span>            :         char path[MAX_PATH+32];
<span class="lineNum">     460 </span>            :         char* c = path;
<span class="lineNum">     461 </span>            :         char* tail = 0;
<span class="lineNum">     462 </span>            :         unsigned int  len = GetModuleFileNameA(NULL, path, MAX_PATH);
<span class="lineNum">     463 </span>            :         path[len] = '\0';
<span class="lineNum">     464 </span>            :         for(; *c; *c++){
<span class="lineNum">     465 </span>            :             if(*c == '\\'){
<span class="lineNum">     466 </span>            :                 tail=c;
<span class="lineNum">     467 </span>            :                 *c = '/';
<span class="lineNum">     468 </span>            :             }
<span class="lineNum">     469 </span>            :         }
<span class="lineNum">     470 </span>            :         if(!tail) tail=c;
<span class="lineNum">     471 </span>            :         strcpy(tail, &quot;/share/fontforge&quot;);
<span class="lineNum">     472 </span>            :         sharedir = copy(path);
<span class="lineNum">     473 </span>            :     }
<span class="lineNum">     474 </span>            :     return sharedir;
<span class="lineNum">     475 </span>            : #elif defined(SHAREDIR)
<span class="lineNum">     476 </span><span class="lineNoCov">          0 : return( SHAREDIR &quot;/fontforge&quot; );</span>
<span class="lineNum">     477 </span>            : #elif defined(PREFIX)
<span class="lineNum">     478 </span>            : return( PREFIX &quot;/share/fontforge&quot; );
<span class="lineNum">     479 </span>            : #else
<span class="lineNum">     480 </span>            : return( NULL );
<span class="lineNum">     481 </span>            : #endif
<span class="lineNum">     482 </span>            : }
<a name="483"><span class="lineNum">     483 </span>            : </a>
<span class="lineNum">     484 </span>            : #  include &lt;charset.h&gt;            /* we still need the charsets &amp; encoding to set local_encoding */
<span class="lineNum">     485 </span><span class="lineNoCov">          0 : static int encmatch(const char *enc,int subok) {</span>
<span class="lineNum">     486 </span>            :     static struct { char *name; int enc; } encs[] = {
<span class="lineNum">     487 </span>            :         { &quot;US-ASCII&quot;, e_usascii },
<span class="lineNum">     488 </span>            :         { &quot;ASCII&quot;, e_usascii },
<span class="lineNum">     489 </span>            :         { &quot;ISO646-NO&quot;, e_iso646_no },
<span class="lineNum">     490 </span>            :         { &quot;ISO646-SE&quot;, e_iso646_se },
<span class="lineNum">     491 </span>            :         { &quot;LATIN10&quot;, e_iso8859_16 },
<span class="lineNum">     492 </span>            :         { &quot;LATIN1&quot;, e_iso8859_1 },
<span class="lineNum">     493 </span>            :         { &quot;ISO-8859-1&quot;, e_iso8859_1 },
<span class="lineNum">     494 </span>            :         { &quot;ISO-8859-2&quot;, e_iso8859_2 },
<span class="lineNum">     495 </span>            :         { &quot;ISO-8859-3&quot;, e_iso8859_3 },
<span class="lineNum">     496 </span>            :         { &quot;ISO-8859-4&quot;, e_iso8859_4 },
<span class="lineNum">     497 </span>            :         { &quot;ISO-8859-5&quot;, e_iso8859_4 },
<span class="lineNum">     498 </span>            :         { &quot;ISO-8859-6&quot;, e_iso8859_4 },
<span class="lineNum">     499 </span>            :         { &quot;ISO-8859-7&quot;, e_iso8859_4 },
<span class="lineNum">     500 </span>            :         { &quot;ISO-8859-8&quot;, e_iso8859_4 },
<span class="lineNum">     501 </span>            :         { &quot;ISO-8859-9&quot;, e_iso8859_4 },
<span class="lineNum">     502 </span>            :         { &quot;ISO-8859-10&quot;, e_iso8859_10 },
<span class="lineNum">     503 </span>            :         { &quot;ISO-8859-11&quot;, e_iso8859_11 },
<span class="lineNum">     504 </span>            :         { &quot;ISO-8859-13&quot;, e_iso8859_13 },
<span class="lineNum">     505 </span>            :         { &quot;ISO-8859-14&quot;, e_iso8859_14 },
<span class="lineNum">     506 </span>            :         { &quot;ISO-8859-15&quot;, e_iso8859_15 },
<span class="lineNum">     507 </span>            :         { &quot;ISO-8859-16&quot;, e_iso8859_16 },
<span class="lineNum">     508 </span>            :         { &quot;ISO_8859-1&quot;, e_iso8859_1 },
<span class="lineNum">     509 </span>            :         { &quot;ISO_8859-2&quot;, e_iso8859_2 },
<span class="lineNum">     510 </span>            :         { &quot;ISO_8859-3&quot;, e_iso8859_3 },
<span class="lineNum">     511 </span>            :         { &quot;ISO_8859-4&quot;, e_iso8859_4 },
<span class="lineNum">     512 </span>            :         { &quot;ISO_8859-5&quot;, e_iso8859_4 },
<span class="lineNum">     513 </span>            :         { &quot;ISO_8859-6&quot;, e_iso8859_4 },
<span class="lineNum">     514 </span>            :         { &quot;ISO_8859-7&quot;, e_iso8859_4 },
<span class="lineNum">     515 </span>            :         { &quot;ISO_8859-8&quot;, e_iso8859_4 },
<span class="lineNum">     516 </span>            :         { &quot;ISO_8859-9&quot;, e_iso8859_4 },
<span class="lineNum">     517 </span>            :         { &quot;ISO_8859-10&quot;, e_iso8859_10 },
<span class="lineNum">     518 </span>            :         { &quot;ISO_8859-11&quot;, e_iso8859_11 },
<span class="lineNum">     519 </span>            :         { &quot;ISO_8859-13&quot;, e_iso8859_13 },
<span class="lineNum">     520 </span>            :         { &quot;ISO_8859-14&quot;, e_iso8859_14 },
<span class="lineNum">     521 </span>            :         { &quot;ISO_8859-15&quot;, e_iso8859_15 },
<span class="lineNum">     522 </span>            :         { &quot;ISO_8859-16&quot;, e_iso8859_16 },
<span class="lineNum">     523 </span>            :         { &quot;ISO8859-1&quot;, e_iso8859_1 },
<span class="lineNum">     524 </span>            :         { &quot;ISO8859-2&quot;, e_iso8859_2 },
<span class="lineNum">     525 </span>            :         { &quot;ISO8859-3&quot;, e_iso8859_3 },
<span class="lineNum">     526 </span>            :         { &quot;ISO8859-4&quot;, e_iso8859_4 },
<span class="lineNum">     527 </span>            :         { &quot;ISO8859-5&quot;, e_iso8859_4 },
<span class="lineNum">     528 </span>            :         { &quot;ISO8859-6&quot;, e_iso8859_4 },
<span class="lineNum">     529 </span>            :         { &quot;ISO8859-7&quot;, e_iso8859_4 },
<span class="lineNum">     530 </span>            :         { &quot;ISO8859-8&quot;, e_iso8859_4 },
<span class="lineNum">     531 </span>            :         { &quot;ISO8859-9&quot;, e_iso8859_4 },
<span class="lineNum">     532 </span>            :         { &quot;ISO8859-10&quot;, e_iso8859_10 },
<span class="lineNum">     533 </span>            :         { &quot;ISO8859-11&quot;, e_iso8859_11 },
<span class="lineNum">     534 </span>            :         { &quot;ISO8859-13&quot;, e_iso8859_13 },
<span class="lineNum">     535 </span>            :         { &quot;ISO8859-14&quot;, e_iso8859_14 },
<span class="lineNum">     536 </span>            :         { &quot;ISO8859-15&quot;, e_iso8859_15 },
<span class="lineNum">     537 </span>            :         { &quot;ISO8859-16&quot;, e_iso8859_16 },
<span class="lineNum">     538 </span>            :         { &quot;ISO88591&quot;, e_iso8859_1 },
<span class="lineNum">     539 </span>            :         { &quot;ISO88592&quot;, e_iso8859_2 },
<span class="lineNum">     540 </span>            :         { &quot;ISO88593&quot;, e_iso8859_3 },
<span class="lineNum">     541 </span>            :         { &quot;ISO88594&quot;, e_iso8859_4 },
<span class="lineNum">     542 </span>            :         { &quot;ISO88595&quot;, e_iso8859_4 },
<span class="lineNum">     543 </span>            :         { &quot;ISO88596&quot;, e_iso8859_4 },
<span class="lineNum">     544 </span>            :         { &quot;ISO88597&quot;, e_iso8859_4 },
<span class="lineNum">     545 </span>            :         { &quot;ISO88598&quot;, e_iso8859_4 },
<span class="lineNum">     546 </span>            :         { &quot;ISO88599&quot;, e_iso8859_4 },
<span class="lineNum">     547 </span>            :         { &quot;ISO885910&quot;, e_iso8859_10 },
<span class="lineNum">     548 </span>            :         { &quot;ISO885911&quot;, e_iso8859_11 },
<span class="lineNum">     549 </span>            :         { &quot;ISO885913&quot;, e_iso8859_13 },
<span class="lineNum">     550 </span>            :         { &quot;ISO885914&quot;, e_iso8859_14 },
<span class="lineNum">     551 </span>            :         { &quot;ISO885915&quot;, e_iso8859_15 },
<span class="lineNum">     552 </span>            :         { &quot;ISO885916&quot;, e_iso8859_16 },
<span class="lineNum">     553 </span>            :         { &quot;8859_1&quot;, e_iso8859_1 },
<span class="lineNum">     554 </span>            :         { &quot;8859_2&quot;, e_iso8859_2 },
<span class="lineNum">     555 </span>            :         { &quot;8859_3&quot;, e_iso8859_3 },
<span class="lineNum">     556 </span>            :         { &quot;8859_4&quot;, e_iso8859_4 },
<span class="lineNum">     557 </span>            :         { &quot;8859_5&quot;, e_iso8859_4 },
<span class="lineNum">     558 </span>            :         { &quot;8859_6&quot;, e_iso8859_4 },
<span class="lineNum">     559 </span>            :         { &quot;8859_7&quot;, e_iso8859_4 },
<span class="lineNum">     560 </span>            :         { &quot;8859_8&quot;, e_iso8859_4 },
<span class="lineNum">     561 </span>            :         { &quot;8859_9&quot;, e_iso8859_4 },
<span class="lineNum">     562 </span>            :         { &quot;8859_10&quot;, e_iso8859_10 },
<span class="lineNum">     563 </span>            :         { &quot;8859_11&quot;, e_iso8859_11 },
<span class="lineNum">     564 </span>            :         { &quot;8859_13&quot;, e_iso8859_13 },
<span class="lineNum">     565 </span>            :         { &quot;8859_14&quot;, e_iso8859_14 },
<span class="lineNum">     566 </span>            :         { &quot;8859_15&quot;, e_iso8859_15 },
<span class="lineNum">     567 </span>            :         { &quot;8859_16&quot;, e_iso8859_16 },
<span class="lineNum">     568 </span>            :         { &quot;KOI8-R&quot;, e_koi8_r },
<span class="lineNum">     569 </span>            :         { &quot;KOI8R&quot;, e_koi8_r },
<span class="lineNum">     570 </span>            :         { &quot;WINDOWS-1252&quot;, e_win },
<span class="lineNum">     571 </span>            :         { &quot;CP1252&quot;, e_win },
<span class="lineNum">     572 </span>            :         { &quot;Big5&quot;, e_big5 },
<span class="lineNum">     573 </span>            :         { &quot;Big-5&quot;, e_big5 },
<span class="lineNum">     574 </span>            :         { &quot;BigFive&quot;, e_big5 },
<span class="lineNum">     575 </span>            :         { &quot;Big-Five&quot;, e_big5 },
<span class="lineNum">     576 </span>            :         { &quot;Big5HKSCS&quot;, e_big5hkscs },
<span class="lineNum">     577 </span>            :         { &quot;Big5-HKSCS&quot;, e_big5hkscs },
<span class="lineNum">     578 </span>            :         { &quot;UTF-8&quot;, e_utf8 },
<span class="lineNum">     579 </span>            :         { &quot;utf-8&quot;, e_utf8 },
<span class="lineNum">     580 </span>            :         { &quot;UTF8&quot;, e_utf8 },
<span class="lineNum">     581 </span>            :         { &quot;utf8&quot;, e_utf8 },
<span class="lineNum">     582 </span>            :         { &quot;ISO-10646/UTF-8&quot;, e_utf8 },
<span class="lineNum">     583 </span>            :         { &quot;ISO_10646/UTF-8&quot;, e_utf8 },
<span class="lineNum">     584 </span>            :         { &quot;UCS2&quot;, e_unicode },
<span class="lineNum">     585 </span>            :         { &quot;UCS-2&quot;, e_unicode },
<span class="lineNum">     586 </span>            :         { &quot;UCS-2-INTERNAL&quot;, e_unicode },
<span class="lineNum">     587 </span>            :         { &quot;ISO-10646&quot;, e_unicode },
<span class="lineNum">     588 </span>            :         { &quot;ISO_10646&quot;, e_unicode },
<span class="lineNum">     589 </span>            :         /* { &quot;eucJP&quot;, e_euc }, */
<span class="lineNum">     590 </span>            :         /* { &quot;EUC-JP&quot;, e_euc }, */
<span class="lineNum">     591 </span>            :         /* { &quot;ujis&quot;, ??? }, */
<span class="lineNum">     592 </span>            :         /* { &quot;EUC-KR&quot;, e_euckorean }, */
<span class="lineNum">     593 </span>            :         { NULL, 0 }
<span class="lineNum">     594 </span>            :     };
<span class="lineNum">     595 </span>            :     int i;
<span class="lineNum">     596 </span>            :     char buffer[80];
<span class="lineNum">     597 </span>            : #if HAVE_ICONV
<span class="lineNum">     598 </span>            :     static char *last_complaint;
<span class="lineNum">     599 </span>            : 
<span class="lineNum">     600 </span>            :     iconv_t test;
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :     free(iconv_local_encoding_name);</span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :     iconv_local_encoding_name= NULL;</span>
<span class="lineNum">     603 </span>            : #endif
<span class="lineNum">     604 </span>            : 
<span class="lineNum">     605 </span><span class="lineNoCov">          0 :     if ( strchr(enc,'@')!=NULL &amp;&amp; strlen(enc)&lt;sizeof(buffer)-1 ) {</span>
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :         strcpy(buffer,enc);</span>
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :         *strchr(buffer,'@') = '\0';</span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :         enc = buffer;</span>
<span class="lineNum">     609 </span>            :     }
<span class="lineNum">     610 </span>            : 
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :     for ( i=0; encs[i].name!=NULL; ++i )</span>
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :         if ( strmatch(enc,encs[i].name)==0 )</span>
<span class="lineNum">     613 </span><span class="lineNoCov">          0 : return( encs[i].enc );</span>
<span class="lineNum">     614 </span>            : 
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :     if ( subok ) {</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :         for ( i=0; encs[i].name!=NULL; ++i )</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :             if ( strstrmatch(enc,encs[i].name)!=NULL )</span>
<span class="lineNum">     618 </span><span class="lineNoCov">          0 : return( encs[i].enc );</span>
<span class="lineNum">     619 </span>            : 
<span class="lineNum">     620 </span>            : #if HAVE_ICONV
<span class="lineNum">     621 </span>            :         /* I only try to use iconv if the encoding doesn't match one I support*/
<span class="lineNum">     622 </span>            :         /*  loading iconv unicode data takes a while */
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :         test = iconv_open(enc,FindUnicharName());</span>
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :         if ( test==(iconv_t) (-1) || test==NULL ) {</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :             if ( last_complaint==NULL || strcmp(last_complaint,enc)!=0 ) {</span>
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :                 fprintf( stderr, &quot;Neither FontForge nor iconv() supports your encoding (%s) we will pretend\n you asked for latin1 instead.\n&quot;, enc );</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :                 free( last_complaint );</span>
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :                 last_complaint = copy(enc);</span>
<span class="lineNum">     629 </span>            :             }
<span class="lineNum">     630 </span>            :         } else {
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :             if ( last_complaint==NULL || strcmp(last_complaint,enc)!=0 ) {</span>
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :                 fprintf( stderr, &quot;FontForge does not support your encoding (%s), it will try to use iconv()\n or it will pretend the local encoding is latin1\n&quot;, enc );</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :                 free( last_complaint );</span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :                 last_complaint = copy(enc);</span>
<span class="lineNum">     635 </span>            :             }
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :             iconv_local_encoding_name= copy(enc);</span>
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :             iconv_close(test);</span>
<span class="lineNum">     638 </span>            :         }
<span class="lineNum">     639 </span>            : #else
<span class="lineNum">     640 </span>            :         fprintf( stderr, &quot;FontForge does not support your encoding (%s), it will pretend the local encoding is latin1\n&quot;, enc );
<span class="lineNum">     641 </span>            : #endif
<span class="lineNum">     642 </span>            : 
<span class="lineNum">     643 </span><span class="lineNoCov">          0 : return( e_iso8859_1 );</span>
<span class="lineNum">     644 </span>            :     }
<span class="lineNum">     645 </span><span class="lineNoCov">          0 : return( e_unknown );</span>
<a name="646"><span class="lineNum">     646 </span>            : }</a>
<span class="lineNum">     647 </span>            : 
<span class="lineNum">     648 </span><span class="lineNoCov">          0 : static int DefaultEncoding(void) {</span>
<span class="lineNum">     649 </span>            :     const char *loc;
<span class="lineNum">     650 </span>            :     int enc;
<span class="lineNum">     651 </span>            : 
<span class="lineNum">     652 </span>            : #if HAVE_LANGINFO_H
<span class="lineNum">     653 </span><span class="lineNoCov">          0 :     loc = nl_langinfo(CODESET);</span>
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :     enc = encmatch(loc,false);</span>
<span class="lineNum">     655 </span><span class="lineNoCov">          0 :     if ( enc!=e_unknown )</span>
<span class="lineNum">     656 </span><span class="lineNoCov">          0 : return( enc );</span>
<span class="lineNum">     657 </span>            : #endif
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :     loc = getenv(&quot;LC_ALL&quot;);</span>
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :     if ( loc==NULL ) loc = getenv(&quot;LC_CTYPE&quot;);</span>
<span class="lineNum">     660 </span>            :     /*if ( loc==NULL ) loc = getenv(&quot;LC_MESSAGES&quot;);*/
<span class="lineNum">     661 </span><span class="lineNoCov">          0 :     if ( loc==NULL ) loc = getenv(&quot;LANG&quot;);</span>
<span class="lineNum">     662 </span>            : 
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :     if ( loc==NULL )</span>
<span class="lineNum">     664 </span><span class="lineNoCov">          0 : return( e_iso8859_1 );</span>
<span class="lineNum">     665 </span>            : 
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :     enc = encmatch(loc,false);</span>
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :     if ( enc==e_unknown ) {</span>
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :         loc = strrchr(loc,'.');</span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :         if ( loc==NULL )</span>
<span class="lineNum">     670 </span><span class="lineNoCov">          0 : return( e_iso8859_1 );</span>
<span class="lineNum">     671 </span><span class="lineNoCov">          0 :         enc = encmatch(loc+1,true);</span>
<span class="lineNum">     672 </span>            :     }
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :     if ( enc==e_unknown )</span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 : return( e_iso8859_1 );</span>
<span class="lineNum">     675 </span>            : 
<span class="lineNum">     676 </span><span class="lineNoCov">          0 : return( enc );</span>
<a name="677"><span class="lineNum">     677 </span>            : }</a>
<span class="lineNum">     678 </span>            : 
<span class="lineNum">     679 </span><span class="lineNoCov">          0 : static void DefaultXUID(void) {</span>
<span class="lineNum">     680 </span>            :     /* Adobe has assigned PfaEdit a base XUID of 1021. Each new user is going */
<span class="lineNum">     681 </span>            :     /*  to get a couple of random numbers appended to that, hoping that will */
<span class="lineNum">     682 </span>            :     /*  make for a fairly safe system. */
<span class="lineNum">     683 </span>            :     /* FontForge will use the same scheme */
<span class="lineNum">     684 </span>            :     int r1, r2;
<span class="lineNum">     685 </span>            :     char buffer[50];
<span class="lineNum">     686 </span>            :     struct timeval tv;
<span class="lineNum">     687 </span>            : 
<span class="lineNum">     688 </span><span class="lineNoCov">          0 :     gettimeofday(&amp;tv,NULL);</span>
<span class="lineNum">     689 </span><span class="lineNoCov">          0 :     srand(tv.tv_usec);</span>
<span class="lineNum">     690 </span>            :     do {
<span class="lineNum">     691 </span><span class="lineNoCov">          0 :         r1 = rand()&amp;0x3ff;</span>
<span class="lineNum">     692 </span><span class="lineNoCov">          0 :     } while ( r1==0 );          /* I reserve &quot;0&quot; for me! */</span>
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :     gettimeofday(&amp;tv,NULL);</span>
<span class="lineNum">     694 </span><span class="lineNoCov">          0 :     g_random_set_seed(tv.tv_usec+1);</span>
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :     r2 = g_random_int();</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :     sprintf( buffer, &quot;1021 %d %d&quot;, r1, r2 );</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :     if (xuid != NULL) free(xuid);</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :     xuid = copy(buffer);</span>
<a name="699"><span class="lineNum">     699 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     700 </span>            : 
<span class="lineNum">     701 </span><span class="lineNoCov">          0 : static void NOUI_SetDefaults(void) {</span>
<span class="lineNum">     702 </span>            : 
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :     DefaultXUID();</span>
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :     local_encoding = DefaultEncoding();</span>
<a name="705"><span class="lineNum">     705 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     706 </span>            : 
<span class="lineNum">     707 </span><span class="lineNoCov">          0 : static void ParseMacMapping(char *pt,struct macsettingname *ms) {</span>
<span class="lineNum">     708 </span>            :     char *end;
<span class="lineNum">     709 </span>            : 
<span class="lineNum">     710 </span><span class="lineNoCov">          0 :     ms-&gt;mac_feature_type = strtol(pt,&amp;end,10);</span>
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :     if ( *end==',' ) ++end;</span>
<span class="lineNum">     712 </span><span class="lineNoCov">          0 :     ms-&gt;mac_feature_setting = strtol(end,&amp;end,10);</span>
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :     if ( *end==' ' ) ++end;</span>
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :     ms-&gt;otf_tag =</span>
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :         ((end[0]&amp;0xff)&lt;&lt;24) |</span>
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :         ((end[1]&amp;0xff)&lt;&lt;16) |</span>
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :         ((end[2]&amp;0xff)&lt;&lt;8) |</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :         (end[3]&amp;0xff);</span>
<a name="719"><span class="lineNum">     719 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     720 </span>            : 
<span class="lineNum">     721 </span><span class="lineNoCov">          0 : static void ParseNewMacFeature(FILE *p,char *line) {</span>
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :     fseek(p,-(strlen(line)-strlen(&quot;MacFeat:&quot;)),SEEK_CUR);</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :     line[strlen(&quot;MacFeat:&quot;)] ='\0';</span>
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :     default_mac_feature_map = SFDParseMacFeatures(p,line);</span>
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :     fseek(p,-strlen(line),SEEK_CUR);</span>
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :     if ( user_mac_feature_map!=NULL )</span>
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :         MacFeatListFree(user_mac_feature_map);</span>
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :     user_mac_feature_map = default_mac_feature_map;</span>
<a name="729"><span class="lineNum">     729 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     730 </span>            : 
<span class="lineNum">     731 </span><span class="lineNoCov">          0 : static void NOUI_LoadPrefs(void) {</span>
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :     char *prefs = getPfaEditPrefs();</span>
<span class="lineNum">     733 </span>            :     FILE *p;
<span class="lineNum">     734 </span>            :     char line[1100];
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :     int i, j, ri=0, mn=0, ms=0/*, fn=0, ff=0, filt_max=0*/;</span>
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :     int msp=0, msc=0;</span>
<span class="lineNum">     737 </span>            :     char *pt;
<span class="lineNum">     738 </span>            :     struct prefs_list *pl;
<span class="lineNum">     739 </span>            : 
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :     LoadPluginDir(NULL);</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :     LoadPfaEditEncodings();</span>
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :     LoadGroupList();</span>
<span class="lineNum">     743 </span>            : 
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :     if ( prefs!=NULL &amp;&amp; (p=fopen(prefs,&quot;r&quot;))!=NULL ) {</span>
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :         while ( fgets(line,sizeof(line),p)!=NULL ) {</span>
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :             if ( *line=='#' )</span>
<span class="lineNum">     747 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">     748 </span><span class="lineNoCov">          0 :             pt = strchr(line,':');</span>
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :             if ( pt==NULL )</span>
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">     751 </span><span class="lineNoCov">          0 :             for ( j=0; prefs_list[j]!=NULL; ++j ) {</span>
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :                 for ( i=0; prefs_list[j][i].name!=NULL; ++i )</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :                     if ( strncmp(line,prefs_list[j][i].name,pt-line)==0 )</span>
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :                 if ( prefs_list[j][i].name!=NULL )</span>
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">     757 </span>            :             }
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :             pl = NULL;</span>
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :             if ( prefs_list[j]!=NULL )</span>
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :                 pl = &amp;prefs_list[j][i];</span>
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :             for ( ++pt; *pt=='\t'; ++pt );</span>
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :             if ( line[strlen(line)-1]=='\n' )</span>
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :                 line[strlen(line)-1] = '\0';</span>
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :             if ( line[strlen(line)-1]=='\r' )</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :                 line[strlen(line)-1] = '\0';</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :             if ( pl==NULL ) {</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :                 if ( strncmp(line,&quot;Recent:&quot;,strlen(&quot;Recent:&quot;))==0 &amp;&amp; ri&lt;RECENT_MAX )</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :                     RecentFiles[ri++] = copy(pt);</span>
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :                 else if ( strncmp(line,&quot;MenuScript:&quot;,strlen(&quot;MenuScript:&quot;))==0 &amp;&amp; ms&lt;SCRIPT_MENU_MAX )</span>
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :                     script_filenames[ms++] = copy(pt);</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :                 else if ( strncmp(line,&quot;MenuName:&quot;,strlen(&quot;MenuName:&quot;))==0 &amp;&amp; mn&lt;SCRIPT_MENU_MAX )</span>
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :                     script_menu_names[mn++] = utf82u_copy(pt);</span>
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :                 else if ( strncmp(line,&quot;MacMapCnt:&quot;,strlen(&quot;MacSetCnt:&quot;))==0 ) {</span>
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :                     sscanf( pt, &quot;%d&quot;, &amp;msc );</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :                     msp = 0;</span>
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag = calloc(msc+1,sizeof(struct macsettingname));</span>
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :                 } else if ( strncmp(line,&quot;MacMapping:&quot;,strlen(&quot;MacMapping:&quot;))==0 &amp;&amp; msp&lt;msc ) {</span>
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :                     ParseMacMapping(pt,&amp;user_macfeat_otftag[msp++]);</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :                 } else if ( strncmp(line,&quot;MacFeat:&quot;,strlen(&quot;MacFeat:&quot;))==0 ) {</span>
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :                     ParseNewMacFeature(p,line);</span>
<span class="lineNum">     781 </span>            :                 }
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">     783 </span>            :             }
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :             switch ( pl-&gt;type ) {</span>
<span class="lineNum">     785 </span>            :               case pr_encoding:
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :                 { Encoding *enc = FindOrMakeEncoding(pt);</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :                     if ( enc==NULL )</span>
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :                         enc = FindOrMakeEncoding(&quot;ISO8859-1&quot;);</span>
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :                     if ( enc==NULL )</span>
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :                         enc = &amp;custom;</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :                     *((Encoding **) (pl-&gt;val)) = enc;</span>
<span class="lineNum">     792 </span>            :                 }
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">     794 </span>            :               case pr_namelist:
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :                 { NameList *nl = NameListByName(pt);</span>
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :                     if ( strcmp(pt,&quot;NULL&quot;)==0 &amp;&amp; pl-&gt;val != &amp;namelist_for_new_fonts )</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :                         *((NameList **) (pl-&gt;val)) = NULL;</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :                     else if ( nl!=NULL )</span>
<span class="lineNum">     799 </span><span class="lineNoCov">          0 :                         *((NameList **) (pl-&gt;val)) = nl;</span>
<span class="lineNum">     800 </span>            :                 }
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">     802 </span>            :               case pr_bool: case pr_int:
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :                 sscanf( pt, &quot;%d&quot;, (int *) pl-&gt;val );</span>
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">     805 </span>            :               case pr_unicode:
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :                 if ( sscanf( pt, &quot;U+%x&quot;, (int *) pl-&gt;val )!=1 )</span>
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :                     if ( sscanf( pt, &quot;u+%x&quot;, (int *) pl-&gt;val )!=1 )</span>
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :                         sscanf( pt, &quot;%x&quot;, (int *) pl-&gt;val );</span>
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">     810 </span>            :               case pr_real:
<span class="lineNum">     811 </span>            :                 { char *end;
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :                     *((float *) pl-&gt;val) = strtod(pt,&amp;end);</span>
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :                     if (( *end==',' || *end=='.' ) ) {</span>
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :                         *end = (*end=='.')?',':'.';</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :                         *((float *) pl-&gt;val) = strtod(pt,NULL);</span>
<span class="lineNum">     816 </span>            :                     }
<span class="lineNum">     817 </span>            :                 }
<span class="lineNum">     818 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">     819 </span>            :               case pr_string: case pr_file:
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :                 if ( *pt=='\0' ) pt=NULL;</span>
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;val!=NULL )</span>
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :                     *((char **) (pl-&gt;val)) = copy(pt);</span>
<span class="lineNum">     823 </span>            :                 else
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :                     (pl-&gt;set)(copy(pt));</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">     826 </span>            :             }
<span class="lineNum">     827 </span>            :         }
<span class="lineNum">     828 </span><span class="lineNoCov">          0 :         fclose(p);</span>
<span class="lineNum">     829 </span>            :     }
<span class="lineNum">     830 </span><span class="lineNoCov">          0 :     if ( othersubrsfile!=NULL &amp;&amp; ReadOtherSubrsFile(othersubrsfile)&lt;=0 )</span>
<span class="lineNum">     831 </span><span class="lineNoCov">          0 :         fprintf( stderr, &quot;Failed to read OtherSubrs from %s\n&quot;, othersubrsfile );</span>
<span class="lineNum">     832 </span>            :         
<span class="lineNum">     833 </span><span class="lineNoCov">          0 :     if ( glyph_2_name_map ) {</span>
<span class="lineNum">     834 </span><span class="lineNoCov">          0 :         old_sfnt_flags |= ttf_flag_glyphmap;</span>
<span class="lineNum">     835 </span>            :     }
<span class="lineNum">     836 </span><span class="lineNoCov">          0 :     LoadNamelistDir(NULL);</span>
<a name="837"><span class="lineNum">     837 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     838 </span>            : 
<span class="lineNum">     839 </span><span class="lineNoCov">          0 : static void NOUI_SavePrefs(int not_if_script) {</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :     char *prefs = getPfaEditPrefs();</span>
<span class="lineNum">     841 </span>            :     FILE *p;
<span class="lineNum">     842 </span>            :     int i, j;
<span class="lineNum">     843 </span>            :     char *temp;
<span class="lineNum">     844 </span>            :     struct prefs_list *pl;
<span class="lineNum">     845 </span>            :     extern int running_script;
<span class="lineNum">     846 </span>            : 
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :     if ( prefs==NULL )</span>
<span class="lineNum">     848 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     849 </span><span class="lineNoCov">          0 :     if ( not_if_script &amp;&amp; running_script )</span>
<span class="lineNum">     850 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     851 </span>            : 
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :     if ( (p=fopen(prefs,&quot;w&quot;))==NULL )</span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     854 </span>            : 
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :     for ( j=0; prefs_list[j]!=NULL; ++j ) for ( i=0; prefs_list[j][i].name!=NULL; ++i ) {</span>
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :         pl = &amp;prefs_list[j][i];</span>
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :         switch ( pl-&gt;type ) {</span>
<span class="lineNum">     858 </span>            :           case pr_encoding:
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;%s:\t%s\n&quot;, pl-&gt;name, (*((Encoding **) (pl-&gt;val)))-&gt;enc_name );</span>
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     861 </span>            :           case pr_namelist:
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;%s:\t%s\n&quot;, pl-&gt;name, *((NameList **) (pl-&gt;val))==NULL ? &quot;NULL&quot; :</span>
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :                     (*((NameList **) (pl-&gt;val)))-&gt;title );</span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     865 </span>            :           case pr_bool: case pr_int:
<span class="lineNum">     866 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;%s:\t%d\n&quot;, pl-&gt;name, *(int *) (pl-&gt;val) );</span>
<span class="lineNum">     867 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     868 </span>            :           case pr_unicode:
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;%s:\tU+%04x\n&quot;, pl-&gt;name, *(int *) (pl-&gt;val) );</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     871 </span>            :           case pr_real:
<span class="lineNum">     872 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;%s:\t%g\n&quot;, pl-&gt;name, (double) *(float *) (pl-&gt;val) );</span>
<span class="lineNum">     873 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     874 </span>            :           case pr_string: case pr_file:
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :             if ( (pl-&gt;val)!=NULL )</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :                 temp = *(char **) (pl-&gt;val);</span>
<span class="lineNum">     877 </span>            :             else
<span class="lineNum">     878 </span><span class="lineNoCov">          0 :                 temp = (char *) (pl-&gt;get());</span>
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :             if ( temp!=NULL )</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :                 fprintf( p, &quot;%s:\t%s\n&quot;, pl-&gt;name, temp );</span>
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :             if ( (pl-&gt;val)==NULL )</span>
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :                 free(temp);</span>
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     884 </span>            :         }
<span class="lineNum">     885 </span>            :     }
<span class="lineNum">     886 </span>            : 
<span class="lineNum">     887 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;RECENT_MAX &amp;&amp; RecentFiles[i]!=NULL; ++i )</span>
<span class="lineNum">     888 </span><span class="lineNoCov">          0 :         fprintf( p, &quot;Recent:\t%s\n&quot;, RecentFiles[i]);</span>
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;SCRIPT_MENU_MAX &amp;&amp; script_filenames[i]!=NULL; ++i ) {</span>
<span class="lineNum">     890 </span><span class="lineNoCov">          0 :         fprintf( p, &quot;MenuScript:\t%s\n&quot;, script_filenames[i]);</span>
<span class="lineNum">     891 </span><span class="lineNoCov">          0 :         fprintf( p, &quot;MenuName:\t%s\n&quot;, temp = u2utf8_copy(script_menu_names[i]));</span>
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :         free(temp);</span>
<span class="lineNum">     893 </span>            :     }
<span class="lineNum">     894 </span><span class="lineNoCov">          0 :     if ( user_macfeat_otftag!=NULL &amp;&amp; UserSettingsDiffer()) {</span>
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :         for ( i=0; user_macfeat_otftag[i].otf_tag!=0; ++i );</span>
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :         fprintf( p, &quot;MacMapCnt: %d\n&quot;, i );</span>
<span class="lineNum">     897 </span><span class="lineNoCov">          0 :         for ( i=0; user_macfeat_otftag[i].otf_tag!=0; ++i ) {</span>
<span class="lineNum">     898 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;MacMapping: %d,%d %c%c%c%c\n&quot;,</span>
<span class="lineNum">     899 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag[i].mac_feature_type,</span>
<span class="lineNum">     900 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag[i].mac_feature_setting,</span>
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :                         (int) (user_macfeat_otftag[i].otf_tag&gt;&gt;24),</span>
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :                         (int) ((user_macfeat_otftag[i].otf_tag&gt;&gt;16)&amp;0xff),</span>
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :                         (int) ((user_macfeat_otftag[i].otf_tag&gt;&gt;8)&amp;0xff),</span>
<span class="lineNum">     904 </span><span class="lineNoCov">          0 :                         (int) (user_macfeat_otftag[i].otf_tag&amp;0xff) );</span>
<span class="lineNum">     905 </span>            :         }
<span class="lineNum">     906 </span>            :     }
<span class="lineNum">     907 </span>            : 
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :     if ( UserFeaturesDiffer())</span>
<span class="lineNum">     909 </span><span class="lineNoCov">          0 :         SFDDumpMacFeat(p,default_mac_feature_map);</span>
<span class="lineNum">     910 </span>            : 
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :     fclose(p);</span>
<span class="lineNum">     912 </span>            : }
<span class="lineNum">     913 </span>            : 
<span class="lineNum">     914 </span>            : static struct prefs_interface prefsnoui = {
<span class="lineNum">     915 </span>            :     NOUI_SavePrefs,
<span class="lineNum">     916 </span>            :     NOUI_LoadPrefs,
<span class="lineNum">     917 </span>            :     NOUI_GetPrefs,
<span class="lineNum">     918 </span>            :     NOUI_SetPrefs,
<span class="lineNum">     919 </span>            :     NOUI_getFontForgeShareDir,
<span class="lineNum">     920 </span>            :     NOUI_SetDefaults
<span class="lineNum">     921 </span>            : };
<span class="lineNum">     922 </span>            : 
<a name="923"><span class="lineNum">     923 </span>            : struct prefs_interface *prefs_interface = &amp;prefsnoui;</a>
<span class="lineNum">     924 </span>            : 
<span class="lineNum">     925 </span><span class="lineCov">         40 : void FF_SetPrefsInterface(struct prefs_interface *prefsi) {</span>
<span class="lineNum">     926 </span><span class="lineCov">         40 :     prefs_interface = prefsi;</span>
<span class="lineNum">     927 </span><span class="lineCov">         40 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
