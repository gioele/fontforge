<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd) - fontforgeexe/charinfo.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">fontforgeexe</a> - charinfo.c<span style="font-size: 80%;"> (source / <a href="charinfo.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd)</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">3601</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-08-04</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">107</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* -*- coding: utf-8 -*- */</a>
<span class="lineNum">       2 </span>            : /* Copyright (C) 2000-2012 by George Williams */
<span class="lineNum">       3 </span>            : /*
<span class="lineNum">       4 </span>            :  * Redistribution and use in source and binary forms, with or without
<span class="lineNum">       5 </span>            :  * modification, are permitted provided that the following conditions are met:
<span class="lineNum">       6 </span>            : 
<span class="lineNum">       7 </span>            :  * Redistributions of source code must retain the above copyright notice, this
<span class="lineNum">       8 </span>            :  * list of conditions and the following disclaimer.
<span class="lineNum">       9 </span>            : 
<span class="lineNum">      10 </span>            :  * Redistributions in binary form must reproduce the above copyright notice,
<span class="lineNum">      11 </span>            :  * this list of conditions and the following disclaimer in the documentation
<span class="lineNum">      12 </span>            :  * and/or other materials provided with the distribution.
<span class="lineNum">      13 </span>            : 
<span class="lineNum">      14 </span>            :  * The name of the author may not be used to endorse or promote products
<span class="lineNum">      15 </span>            :  * derived from this software without specific prior written permission.
<span class="lineNum">      16 </span>            : 
<span class="lineNum">      17 </span>            :  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
<span class="lineNum">      18 </span>            :  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
<span class="lineNum">      19 </span>            :  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
<span class="lineNum">      20 </span>            :  * EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span class="lineNum">      21 </span>            :  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
<span class="lineNum">      22 </span>            :  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
<span class="lineNum">      23 </span>            :  * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
<span class="lineNum">      24 </span>            :  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
<span class="lineNum">      25 </span>            :  * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
<span class="lineNum">      26 </span>            :  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span class="lineNum">      27 </span>            :  */
<span class="lineNum">      28 </span>            : 
<span class="lineNum">      29 </span>            : #include &quot;autowidth2.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;cvundoes.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;fontforgeui.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;fvcomposite.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;fvfonts.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;lookups.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;namelist.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;splinefill.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;splineutil.h&quot;
<span class="lineNum">      38 </span>            : #include &quot;tottfgpos.h&quot;
<span class="lineNum">      39 </span>            : #include &lt;ustring.h&gt;
<span class="lineNum">      40 </span>            : #include &lt;math.h&gt;
<span class="lineNum">      41 </span>            : #include &lt;utype.h&gt;
<span class="lineNum">      42 </span>            : #include &lt;chardata.h&gt;
<span class="lineNum">      43 </span>            : #include &quot;ttf.h&quot;              /* For MAC_DELETED_GLYPH_NAME */
<span class="lineNum">      44 </span>            : #include &lt;gkeysym.h&gt;
<span class="lineNum">      45 </span>            : #include &quot;gutils/unicodelibinfo.h&quot;
<span class="lineNum">      46 </span>            : 
<span class="lineNum">      47 </span>            : extern int lookup_hideunused;
<span class="lineNum">      48 </span>            : 
<span class="lineNum">      49 </span>            : static int last_gi_aspect = 0;
<span class="lineNum">      50 </span>            : 
<span class="lineNum">      51 </span>            : typedef struct charinfo {
<span class="lineNum">      52 </span>            :     CharView *cv;
<span class="lineNum">      53 </span>            :     EncMap *map;
<span class="lineNum">      54 </span>            :     SplineChar *sc, *cachedsc;
<span class="lineNum">      55 </span>            :     int def_layer;
<span class="lineNum">      56 </span>            :     SplineChar *oldsc;          /* oldsc-&gt;charinfo will point to us. Used to keep track of that pointer */
<span class="lineNum">      57 </span>            :     int enc;
<span class="lineNum">      58 </span>            :     GWindow gw;
<span class="lineNum">      59 </span>            :     int done, first, changed;
<span class="lineNum">      60 </span>            :     struct lookup_subtable *old_sub;
<span class="lineNum">      61 </span>            :     int r,c;
<span class="lineNum">      62 </span>            :     int lc_seen, lc_aspect, vert_aspect;
<span class="lineNum">      63 </span>            :     Color last, real_last;
<span class="lineNum">      64 </span>            :     struct splinecharlist *changes;
<span class="lineNum">      65 </span>            :     int name_change, uni_change;
<span class="lineNum">      66 </span>            : } CharInfo;
<span class="lineNum">      67 </span>            : 
<span class="lineNum">      68 </span>            : #define CI_Width        218
<span class="lineNum">      69 </span>            : #define CI_Height       292
<span class="lineNum">      70 </span>            : 
<span class="lineNum">      71 </span>            : #define CID_UName       1001
<span class="lineNum">      72 </span>            : #define CID_UValue      1002
<span class="lineNum">      73 </span>            : #define CID_UChar       1003
<span class="lineNum">      74 </span>            : #define CID_Cancel      1005
<span class="lineNum">      75 </span>            : #define CID_ComponentMsg        1006
<span class="lineNum">      76 </span>            : #define CID_Components  1007
<span class="lineNum">      77 </span>            : #define CID_Comment     1008
<span class="lineNum">      78 </span>            : #define CID_Color       1009
<span class="lineNum">      79 </span>            : #define CID_GClass      1010
<span class="lineNum">      80 </span>            : #define CID_Tabs        1011
<span class="lineNum">      81 </span>            : 
<span class="lineNum">      82 </span>            : #define CID_TeX_Height  1012
<span class="lineNum">      83 </span>            : #define CID_TeX_Depth   1013
<span class="lineNum">      84 </span>            : #define CID_TeX_Italic  1014
<span class="lineNum">      85 </span>            : #define CID_HorAccent   1015
<span class="lineNum">      86 </span>            : /* Room for one more here, if we need it */
<span class="lineNum">      87 </span>            : #define CID_TeX_HeightD 1017
<span class="lineNum">      88 </span>            : #define CID_TeX_DepthD  1018
<span class="lineNum">      89 </span>            : #define CID_TeX_ItalicD 1019
<span class="lineNum">      90 </span>            : #define CID_HorAccentD  1020
<span class="lineNum">      91 </span>            : 
<span class="lineNum">      92 </span>            : #define CID_ItalicDevTab        1022
<span class="lineNum">      93 </span>            : #define CID_AccentDevTab        1023
<span class="lineNum">      94 </span>            : 
<span class="lineNum">      95 </span>            : #define CID_IsExtended  1024
<span class="lineNum">      96 </span>            : #define CID_DefLCCount  1040
<span class="lineNum">      97 </span>            : #define CID_LCCount     1041
<span class="lineNum">      98 </span>            : #define CID_LCCountLab  1042
<span class="lineNum">      99 </span>            : 
<span class="lineNum">     100 </span>            : #define CID_UnlinkRmOverlap     1045
<span class="lineNum">     101 </span>            : #define CID_AltUni      1046
<span class="lineNum">     102 </span>            : 
<span class="lineNum">     103 </span>            : /* Offsets for repeated fields. add 100*index (index&lt;=6) */
<span class="lineNum">     104 </span>            : #define CID_List        1220
<span class="lineNum">     105 </span>            : #define CID_New         1221
<span class="lineNum">     106 </span>            : #define CID_Delete      1222
<span class="lineNum">     107 </span>            : #define CID_Edit        1223
<span class="lineNum">     108 </span>            : 
<span class="lineNum">     109 </span>            : #define CID_PST         1111
<span class="lineNum">     110 </span>            : #define CID_Tag         1112
<span class="lineNum">     111 </span>            : #define CID_Contents    1113
<span class="lineNum">     112 </span>            : #define CID_SelectResults       1114
<span class="lineNum">     113 </span>            : #define CID_MergeResults        1115
<span class="lineNum">     114 </span>            : #define CID_RestrictSelection   1116
<span class="lineNum">     115 </span>            : 
<span class="lineNum">     116 </span>            : /* Offsets for repeated fields. add 100*index (index&lt;2) */ /* 0=&gt;Vert, 1=&gt;Hor */
<span class="lineNum">     117 </span>            : #define CID_VariantList         2000
<span class="lineNum">     118 </span>            : #define CID_ExtItalicCor        2001
<span class="lineNum">     119 </span>            : #define CID_ExtItalicDev        2002
<span class="lineNum">     120 </span>            : #define CID_ExtensionList       2003
<span class="lineNum">     121 </span>            : 
<span class="lineNum">     122 </span>            : #define CID_IsTileMargin        3001
<span class="lineNum">     123 </span>            : #define CID_TileMargin          3002
<span class="lineNum">     124 </span>            : #define CID_IsTileBBox          3003
<span class="lineNum">     125 </span>            : #define CID_TileBBoxMinX        3004
<span class="lineNum">     126 </span>            : #define CID_TileBBoxMinY        3005
<span class="lineNum">     127 </span>            : #define CID_TileBBoxMaxX        3006
<span class="lineNum">     128 </span>            : #define CID_TileBBoxMaxY        3007
<span class="lineNum">     129 </span>            : 
<span class="lineNum">     130 </span>            : #define SIM_DX          1
<span class="lineNum">     131 </span>            : #define SIM_DY          3
<span class="lineNum">     132 </span>            : #define SIM_DX_ADV      5
<span class="lineNum">     133 </span>            : #define SIM_DY_ADV      7
<span class="lineNum">     134 </span>            : #define PAIR_DX1        2
<span class="lineNum">     135 </span>            : #define PAIR_DY1        4
<span class="lineNum">     136 </span>            : #define PAIR_DX_ADV1    6
<span class="lineNum">     137 </span>            : #define PAIR_DY_ADV1    8
<span class="lineNum">     138 </span>            : #define PAIR_DX2        10
<span class="lineNum">     139 </span>            : #define PAIR_DY2        12
<span class="lineNum">     140 </span>            : #define PAIR_DX_ADV2    14
<span class="lineNum">     141 </span>            : #define PAIR_DY_ADV2    16
<span class="lineNum">     142 </span>            : 
<span class="lineNum">     143 </span>            : static GTextInfo glyphclasses[] = {
<span class="lineNum">     144 </span>            :     { (unichar_t *) N_(&quot;Automatic&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     145 </span>            :     { (unichar_t *) N_(&quot;No Class&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     146 </span>            :     { (unichar_t *) N_(&quot;Base Glyph&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     147 </span>            :     { (unichar_t *) N_(&quot;Base Lig&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     148 </span>            :     { (unichar_t *) N_(&quot;Mark&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     149 </span>            :     { (unichar_t *) N_(&quot;Component&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     150 </span>            :     GTEXTINFO_EMPTY
<span class="lineNum">     151 </span>            : };
<span class="lineNum">     152 </span>            : 
<span class="lineNum">     153 </span>            : #define CUSTOM_COLOR    9
<span class="lineNum">     154 </span>            : #define COLOR_CHOOSE    (-10)
<span class="lineNum">     155 </span>            : static GTextInfo std_colors[] = {
<span class="lineNum">     156 </span>            :     { (unichar_t *) N_(&quot;Color|Choose...&quot;), NULL, 0, 0, (void *) COLOR_CHOOSE, NULL, 0, 1, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     157 </span>            :     { (unichar_t *) N_(&quot;Color|Default&quot;), &amp;def_image, 0, 0, (void *) COLOR_DEFAULT, NULL, 0, 1, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     158 </span>            :     { NULL, &amp;white_image, 0, 0, (void *) 0xffffff, NULL, 0, 1, 0, 0, 0, 0, 0, 0, 0, '\0' },
<span class="lineNum">     159 </span>            :     { NULL, &amp;red_image, 0, 0, (void *) 0xff0000, NULL, 0, 1, 0, 0, 0, 0, 0, 0, 0, '\0' },
<span class="lineNum">     160 </span>            :     { NULL, &amp;green_image, 0, 0, (void *) 0x00ff00, NULL, 0, 1, 0, 0, 0, 0, 0, 0, 0, '\0' },
<span class="lineNum">     161 </span>            :     { NULL, &amp;blue_image, 0, 0, (void *) 0x0000ff, NULL, 0, 1, 0, 0, 0, 0, 0, 0, 0, '\0' },
<span class="lineNum">     162 </span>            :     { NULL, &amp;yellow_image, 0, 0, (void *) 0xffff00, NULL, 0, 1, 0, 0, 0, 0, 0, 0, 0, '\0' },
<span class="lineNum">     163 </span>            :     { NULL, &amp;cyan_image, 0, 0, (void *) 0x00ffff, NULL, 0, 1, 0, 0, 0, 0, 0, 0, 0, '\0' },
<span class="lineNum">     164 </span>            :     { NULL, &amp;magenta_image, 0, 0, (void *) 0xff00ff, NULL, 0, 1, 0, 0, 0, 0, 0, 0, 0, '\0' },
<span class="lineNum">     165 </span>            :     { NULL, NULL, 0, 0, (void *) 0x000000, NULL, 0, 1, 0, 0, 0, 0, 0, 0, 0, '\0' },
<span class="lineNum">     166 </span>            :     GTEXTINFO_EMPTY
<span class="lineNum">     167 </span>            : };
<span class="lineNum">     168 </span>            : 
<span class="lineNum">     169 </span>            : static char *newstrings[] = { N_(&quot;New Positioning&quot;), N_(&quot;New Pair Position&quot;),
<span class="lineNum">     170 </span>            :         N_(&quot;New Substitution Variant&quot;),
<a name="171"><span class="lineNum">     171 </span>            :         N_(&quot;New Alternate List&quot;), N_(&quot;New Multiple List&quot;), N_(&quot;New Ligature&quot;), NULL };</a>
<span class="lineNum">     172 </span>            : 
<span class="lineNum">     173 </span><span class="lineNoCov">          0 : static unichar_t *CounterMaskLine(SplineChar *sc, HintMask *hm) {</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :     unichar_t *textmask = NULL;</span>
<span class="lineNum">     175 </span>            :     int j,k,len;
<span class="lineNum">     176 </span>            :     StemInfo *h;
<span class="lineNum">     177 </span>            :     char buffer[100];
<span class="lineNum">     178 </span>            : 
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :     for ( j=0; j&lt;2; ++j ) {</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :         len = 0;</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :         for ( h=sc-&gt;hstem, k=0; h!=NULL &amp;&amp; k&lt;HntMax; h=h-&gt;next, ++k ) {</span>
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :             if ( (*hm)[k&gt;&gt;3]&amp; (0x80&gt;&gt;(k&amp;7)) ) {</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :                 sprintf( buffer, &quot;H&lt;%g,%g&gt;, &quot;,</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :                         rint(h-&gt;start*100)/100, rint(h-&gt;width*100)/100 );</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :                 if ( textmask!=NULL )</span>
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :                     uc_strcpy(textmask+len,buffer);</span>
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :                 len += strlen(buffer);</span>
<span class="lineNum">     188 </span>            :             }
<span class="lineNum">     189 </span>            :         }
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :         for ( h=sc-&gt;vstem; h!=NULL &amp;&amp; k&lt;HntMax; h=h-&gt;next, ++k ) {</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :             if ( (*hm)[k&gt;&gt;3]&amp; (0x80&gt;&gt;(k&amp;7)) ) {</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :                 sprintf( buffer, &quot;V&lt;%g,%g&gt;, &quot;,</span>
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :                         rint(h-&gt;start*100)/100, rint(h-&gt;width*100)/100 );</span>
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :                 if ( textmask!=NULL )</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :                     uc_strcpy(textmask+len,buffer);</span>
<span class="lineNum">     196 </span><span class="lineNoCov">          0 :                 len += strlen(buffer);</span>
<span class="lineNum">     197 </span>            :             }
<span class="lineNum">     198 </span>            :         }
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :         if ( textmask==NULL ) {</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :             textmask = malloc((len+1)*sizeof(unichar_t));</span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :             *textmask = '\0';</span>
<span class="lineNum">     202 </span>            :         }
<span class="lineNum">     203 </span>            :     }
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :     if ( len&gt;1 &amp;&amp; textmask[len-2]==',' )</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :         textmask[len-2] = '\0';</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 : return( textmask );</span>
<span class="lineNum">     207 </span>            : }
<span class="lineNum">     208 </span>            : 
<span class="lineNum">     209 </span>            : #define CID_HintMask    2020
<span class="lineNum">     210 </span>            : #define HI_Width        200
<span class="lineNum">     211 </span>            : #define HI_Height       260
<span class="lineNum">     212 </span>            : 
<span class="lineNum">     213 </span>            : struct hi_data {
<span class="lineNum">     214 </span>            :     int done, ok, empty;
<span class="lineNum">     215 </span>            :     GWindow gw;
<span class="lineNum">     216 </span>            :     HintMask *cur;
<span class="lineNum">     217 </span>            :     SplineChar *sc;
<a name="218"><span class="lineNum">     218 </span>            : };</a>
<span class="lineNum">     219 </span>            : 
<span class="lineNum">     220 </span><span class="lineNoCov">          0 : static int HI_Ok(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :         struct hi_data *hi = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     223 </span>            :         int32 i, len;
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :         GTextInfo **ti = GGadgetGetList(GWidgetGetControl(hi-&gt;gw,CID_HintMask),&amp;len);</span>
<span class="lineNum">     225 </span>            : 
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;len; ++i )</span>
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :             if ( ti[i]-&gt;selected )</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     229 </span>            : 
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :         memset(hi-&gt;cur,0,sizeof(HintMask));</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :         if ( i==len ) {</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :             hi-&gt;empty = true;</span>
<span class="lineNum">     233 </span>            :         } else {
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;len; ++i )</span>
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :                 if ( ti[i]-&gt;selected )</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :                     (*hi-&gt;cur)[i&gt;&gt;3] |= (0x80&gt;&gt;(i&amp;7));</span>
<span class="lineNum">     237 </span>            :         }
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :         PI_ShowHints(hi-&gt;sc,GWidgetGetControl(hi-&gt;gw,CID_HintMask),false);</span>
<span class="lineNum">     239 </span>            : 
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :         hi-&gt;done = true;</span>
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :         hi-&gt;ok = true;</span>
<span class="lineNum">     242 </span>            :     }
<span class="lineNum">     243 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="244"><span class="lineNum">     244 </span>            : }</a>
<span class="lineNum">     245 </span>            : 
<span class="lineNum">     246 </span><span class="lineNoCov">          0 : static void HI_DoCancel(struct hi_data *hi) {</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :     hi-&gt;done = true;</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :     PI_ShowHints(hi-&gt;sc,GWidgetGetControl(hi-&gt;gw,CID_HintMask),false);</span>
<a name="249"><span class="lineNum">     249 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     250 </span>            : 
<span class="lineNum">     251 </span><span class="lineNoCov">          0 : static int HI_HintSel(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_listselected ) {</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :         struct hi_data *hi = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     254 </span>            : 
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :         PI_ShowHints(hi-&gt;sc,g,true);</span>
<span class="lineNum">     256 </span>            :         /* Do I need to check for overlap here? */
<span class="lineNum">     257 </span>            :     }
<span class="lineNum">     258 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="259"><span class="lineNum">     259 </span>            : }</a>
<span class="lineNum">     260 </span>            : 
<span class="lineNum">     261 </span><span class="lineNoCov">          0 : static int HI_Cancel(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :         HI_DoCancel( GDrawGetUserData(GGadgetGetWindow(g)));</span>
<span class="lineNum">     264 </span>            :     }
<span class="lineNum">     265 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="266"><span class="lineNum">     266 </span>            : }</a>
<span class="lineNum">     267 </span>            : 
<span class="lineNum">     268 </span><span class="lineNoCov">          0 : static int hi_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :         HI_DoCancel( GDrawGetUserData(gw));</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_char ) {</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.keysym == GK_F1 || event-&gt;u.chr.keysym == GK_Help ) {</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :             help(&quot;charinfo.html#Counters&quot;);</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     275 </span>            :         }
<span class="lineNum">     276 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     277 </span>            :     }
<span class="lineNum">     278 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="279"><span class="lineNum">     279 </span>            : }</a>
<span class="lineNum">     280 </span>            : 
<span class="lineNum">     281 </span><span class="lineNoCov">          0 : static void CI_AskCounters(CharInfo *ci,HintMask *old) {</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :     HintMask *cur = old != NULL ? old : chunkalloc(sizeof(HintMask));</span>
<span class="lineNum">     283 </span>            :     struct hi_data hi;
<span class="lineNum">     284 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">     285 </span>            :     GGadgetCreateData hgcd[5], *varray[11], *harray[8], boxes[3];
<span class="lineNum">     286 </span>            :     GTextInfo hlabel[5];
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :     GGadget *list = GWidgetGetControl(ci-&gt;gw,CID_List+600);</span>
<span class="lineNum">     288 </span>            :     int j,k;
<span class="lineNum">     289 </span>            :     GRect pos;
<span class="lineNum">     290 </span>            : 
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :     memset(&amp;hi,0,sizeof(hi));</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :     hi.cur = cur;</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :     hi.sc = ci-&gt;sc;</span>
<span class="lineNum">     294 </span>            : 
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :         memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :         wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_isdlg|wam_restrict;</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :         wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :         wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :         wattrs.undercursor = 1;</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :         wattrs.cursor = ct_pointer;</span>
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :         wattrs.utf8_window_title = old==NULL?_(&quot;New Counter Mask&quot;):_(&quot;Edit Counter Mask&quot;);</span>
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :         wattrs.is_dlg = true;</span>
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :         pos.width = GGadgetScale(GDrawPointsToPixels(NULL,HI_Width));</span>
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :         pos.height = GDrawPointsToPixels(NULL,HI_Height);</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :         hi.gw = GDrawCreateTopWindow(NULL,&amp;pos,hi_e_h,&amp;hi,&amp;wattrs);</span>
<span class="lineNum">     306 </span>            : 
<span class="lineNum">     307 </span>            : 
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :         memset(hgcd,0,sizeof(hgcd));</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :         memset(boxes,0,sizeof(boxes));</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :         memset(hlabel,0,sizeof(hlabel));</span>
<span class="lineNum">     311 </span>            : 
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :         j=k=0;</span>
<span class="lineNum">     313 </span>            : 
<span class="lineNum">     314 </span><span class="lineNoCov">          0 :         hgcd[j].gd.pos.x = 20-3; hgcd[j].gd.pos.y = HI_Height-31-3;</span>
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :         hgcd[j].gd.pos.width = -1; hgcd[j].gd.pos.height = 0;</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :         hgcd[j].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :         hlabel[j].text = (unichar_t *) _(&quot;Select hints between which counters are formed&quot;);</span>
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :         hlabel[j].text_is_1byte = true;</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :         hlabel[j].text_in_resource = true;</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :         hgcd[j].gd.label = &amp;hlabel[j];</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :         varray[k++] = &amp;hgcd[j]; varray[k++] = NULL;</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :         hgcd[j++].creator = GLabelCreate;</span>
<span class="lineNum">     323 </span>            : 
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :         hgcd[j].gd.pos.x = 5; hgcd[j].gd.pos.y = 5;</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :         hgcd[j].gd.pos.width = HI_Width-10; hgcd[j].gd.pos.height = HI_Height-45;</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :         hgcd[j].gd.flags = gg_visible | gg_enabled | gg_list_multiplesel;</span>
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :         hgcd[j].gd.cid = CID_HintMask;</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :         hgcd[j].gd.u.list = SCHintList(ci-&gt;sc,old);</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :         hgcd[j].gd.handle_controlevent = HI_HintSel;</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :         varray[k++] = &amp;hgcd[j]; varray[k++] = NULL;</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :         varray[k++] = GCD_Glue; varray[k++] = NULL;</span>
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :         hgcd[j++].creator = GListCreate;</span>
<span class="lineNum">     333 </span>            : 
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :         hgcd[j].gd.pos.x = 20-3; hgcd[j].gd.pos.y = HI_Height-31-3;</span>
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :         hgcd[j].gd.pos.width = -1; hgcd[j].gd.pos.height = 0;</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :         hgcd[j].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :         hlabel[j].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :         hlabel[j].text_is_1byte = true;</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :         hlabel[j].text_in_resource = true;</span>
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :         hgcd[j].gd.label = &amp;hlabel[j];</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :         hgcd[j].gd.handle_controlevent = HI_Ok;</span>
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :         harray[0] = GCD_Glue; harray[1] = &amp;hgcd[j]; harray[2] = GCD_Glue; harray[3] = GCD_Glue;</span>
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :         hgcd[j++].creator = GButtonCreate;</span>
<span class="lineNum">     344 </span>            : 
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :         hgcd[j].gd.pos.x = -20; hgcd[j].gd.pos.y = HI_Height-31;</span>
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :         hgcd[j].gd.pos.width = -1; hgcd[j].gd.pos.height = 0;</span>
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :         hgcd[j].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :         hlabel[j].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :         hlabel[j].text_is_1byte = true;</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :         hlabel[j].text_in_resource = true;</span>
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :         hgcd[j].gd.label = &amp;hlabel[j];</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :         hgcd[j].gd.handle_controlevent = HI_Cancel;</span>
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :         harray[4] = GCD_Glue; harray[5] = &amp;hgcd[j]; harray[6] = GCD_Glue; harray[7] = NULL;</span>
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :         hgcd[j++].creator = GButtonCreate;</span>
<span class="lineNum">     355 </span>            : 
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :         boxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :         boxes[2].gd.u.boxelements = harray;</span>
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :         boxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :         varray[k++] = &amp;boxes[2]; varray[k++] = NULL; </span>
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :         varray[k++] = GCD_Glue; varray[k++] = NULL;</span>
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :         varray[k] = NULL;</span>
<span class="lineNum">     362 </span>            : 
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :         boxes[0].gd.pos.x = boxes[0].gd.pos.y = 2;</span>
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :         boxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :         boxes[0].gd.u.boxelements = varray;</span>
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :         boxes[0].creator = GHVGroupCreate;</span>
<span class="lineNum">     367 </span>            : 
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :         GGadgetsCreate(hi.gw,boxes);</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(boxes[0].ret,1);</span>
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(boxes[2].ret,gb_expandgluesame);</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :         GHVBoxFitWindow(boxes[0].ret);</span>
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :         GTextInfoListFree(hgcd[0].gd.u.list);</span>
<span class="lineNum">     373 </span>            : 
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :         PI_ShowHints(hi.sc,hgcd[0].ret,true);</span>
<span class="lineNum">     375 </span>            : 
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :     GDrawSetVisible(hi.gw,true);</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :     while ( !hi.done )</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(hi.gw);</span>
<span class="lineNum">     380 </span>            : 
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :     if ( !hi.ok ) {</span>
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :         if ( old==NULL ) chunkfree(cur,sizeof(HintMask));</span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 : return;         /* Cancelled */</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :     } else if ( old==NULL &amp;&amp; hi.empty ) {</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :         if ( old==NULL ) chunkfree(cur,sizeof(HintMask));</span>
<span class="lineNum">     386 </span><span class="lineNoCov">          0 : return;         /* Didn't add anything new */</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :     } else if ( old==NULL ) {</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :         GListAddStr(list,CounterMaskLine(hi.sc,cur),cur);</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :     } else if ( !hi.empty ) {</span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :         GListReplaceStr(list,GGadgetGetFirstListSelectedItem(list),</span>
<span class="lineNum">     392 </span>            :                 CounterMaskLine(hi.sc,cur),cur);
<span class="lineNum">     393 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     394 </span>            :     } else {
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :         GListDelSelected(list);</span>
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :         chunkfree(cur,sizeof(HintMask));</span>
<span class="lineNum">     397 </span>            :     }
<a name="398"><span class="lineNum">     398 </span>            : }</a>
<span class="lineNum">     399 </span>            : 
<span class="lineNum">     400 </span><span class="lineNoCov">          0 : static int CI_NewCounter(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     401 </span>            :     CharInfo *ci;
<span class="lineNum">     402 </span>            : 
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :         ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :         CI_AskCounters(ci,NULL);</span>
<span class="lineNum">     406 </span>            :     }
<span class="lineNum">     407 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="408"><span class="lineNum">     408 </span>            : }</a>
<span class="lineNum">     409 </span>            : 
<span class="lineNum">     410 </span><span class="lineNoCov">          0 : static int CI_EditCounter(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     411 </span>            :     GTextInfo *ti;
<span class="lineNum">     412 </span>            :     GGadget *list;
<span class="lineNum">     413 </span>            :     CharInfo *ci;
<span class="lineNum">     414 </span>            : 
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :         ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :         list = GWidgetGetControl(GGadgetGetWindow(g),CID_List+6*100);</span>
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :         if ( (ti = GGadgetGetListItemSelected(list))==NULL )</span>
<span class="lineNum">     419 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :         CI_AskCounters(ci,ti-&gt;userdata);</span>
<span class="lineNum">     421 </span>            :     }
<span class="lineNum">     422 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="423"><span class="lineNum">     423 </span>            : }</a>
<span class="lineNum">     424 </span>            : 
<span class="lineNum">     425 </span><span class="lineNoCov">          0 : static int CI_DeleteCounter(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     426 </span>            :     int32 len; int i,j, offset;
<span class="lineNum">     427 </span>            :     GTextInfo **old, **new_;
<span class="lineNum">     428 </span>            :     GGadget *list;
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :         offset = GGadgetGetCid(g)-CID_Delete;</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :         list = GWidgetGetControl(GGadgetGetWindow(g),CID_List+offset);</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :         old = GGadgetGetList(list,&amp;len);</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :         new_ = calloc(len+1,sizeof(GTextInfo *));</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :         for ( i=j=0; i&lt;len; ++i )</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :             if ( !old[i]-&gt;selected ) {</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :                 new_[j] = (GTextInfo *) malloc(sizeof(GTextInfo));</span>
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :                 *new_[j] = *old[i];</span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :                 new_[j]-&gt;text = u_copy(new_[j]-&gt;text);</span>
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :                 ++j;</span>
<span class="lineNum">     440 </span>            :             }
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :         new_[j] = (GTextInfo *) calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :         if ( offset==600 ) {</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;len; ++i ) if ( old[i]-&gt;selected )</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :                 chunkfree(old[i]-&gt;userdata,sizeof(HintMask));</span>
<span class="lineNum">     445 </span>            :         }
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :         GGadgetSetList(list,new_,false);</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(GGadgetGetWindow(g),CID_Delete+offset),false);</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(GGadgetGetWindow(g),CID_Edit+offset),false);</span>
<span class="lineNum">     449 </span>            :     }
<span class="lineNum">     450 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="451"><span class="lineNum">     451 </span>            : }</a>
<span class="lineNum">     452 </span>            : 
<span class="lineNum">     453 </span><span class="lineNoCov">          0 : static int CI_CounterSelChanged(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_listselected ) {</span>
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :         int sel = GGadgetGetFirstListSelectedItem(g);</span>
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :         int offset = GGadgetGetCid(g)-CID_List;</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(ci-&gt;gw,CID_Delete+offset),sel!=-1);</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(ci-&gt;gw,CID_Edit+offset),sel!=-1);</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :     } else if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_listdoubleclick ) {</span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :         int offset = GGadgetGetCid(g)-CID_List;</span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :         e-&gt;u.control.subtype = et_buttonactivate;</span>
<span class="lineNum">     464 </span><span class="lineNoCov">          0 :         e-&gt;u.control.g = GWidgetGetControl(ci-&gt;gw,CID_Edit+offset);</span>
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :         CI_EditCounter(e-&gt;u.control.g,e);</span>
<span class="lineNum">     466 </span>            :     }
<span class="lineNum">     467 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="468"><span class="lineNum">     468 </span>            : }</a>
<span class="lineNum">     469 </span>            : 
<span class="lineNum">     470 </span><span class="lineNoCov">          0 : static int ParseUValue(GWindow gw, int cid, int minusoneok) {</span>
<span class="lineNum">     471 </span><span class="lineNoCov">          0 :     const unichar_t *ret = _GGadgetGetTitle(GWidgetGetControl(gw,cid));</span>
<span class="lineNum">     472 </span>            :     unichar_t *end;
<span class="lineNum">     473 </span>            :     int val;
<span class="lineNum">     474 </span>            : 
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :     if (( *ret=='U' || *ret=='u' ) &amp;&amp; ret[1]=='+' )</span>
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :         val = u_strtoul(ret+2,&amp;end,16);</span>
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :     else if ( *ret=='#' )</span>
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :         val = u_strtoul(ret+1,&amp;end,16);</span>
<span class="lineNum">     479 </span>            :     else
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :         val = u_strtoul(ret,&amp;end,16);</span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :     if ( val==-1 &amp;&amp; minusoneok )</span>
<span class="lineNum">     482 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :     if ( *end || val&lt;0 || val&gt;0x10ffff ) {</span>
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :         GGadgetProtest8( _(&quot;Unicode _Value:&quot;) );</span>
<span class="lineNum">     485 </span><span class="lineNoCov">          0 : return( -2 );</span>
<span class="lineNum">     486 </span>            :     }
<span class="lineNum">     487 </span><span class="lineNoCov">          0 : return( val );</span>
<a name="488"><span class="lineNum">     488 </span>            : }</a>
<span class="lineNum">     489 </span>            : 
<span class="lineNum">     490 </span><span class="lineNoCov">          0 : static void SetNameFromUnicode(GWindow gw,int cid,int val) {</span>
<span class="lineNum">     491 </span>            :     unichar_t *temp;
<span class="lineNum">     492 </span>            :     char buf[100];
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :     CharInfo *ci = GDrawGetUserData(gw);</span>
<span class="lineNum">     494 </span>            : 
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :     temp = utf82u_copy(StdGlyphName(buf,val,ci-&gt;sc-&gt;parent-&gt;uni_interp,ci-&gt;sc-&gt;parent-&gt;for_new_glyphs));</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :     GGadgetSetTitle(GWidgetGetControl(gw,cid),temp);</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :     free(temp);</span>
<a name="498"><span class="lineNum">     498 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     499 </span>            : 
<span class="lineNum">     500 </span><span class="lineNoCov">          0 : void SCInsertPST(SplineChar *sc,PST *new_) {</span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :     new_-&gt;next = sc-&gt;possub;</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :     sc-&gt;possub = new_;</span>
<a name="503"><span class="lineNum">     503 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     504 </span>            : 
<span class="lineNum">     505 </span><span class="lineNoCov">          0 : static int CI_NameCheck(const unichar_t *name) {</span>
<span class="lineNum">     506 </span>            :     int bad, questionable;
<span class="lineNum">     507 </span>            :     extern int allow_utf8_glyphnames;
<span class="lineNum">     508 </span>            :     char *buts[3];
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :     buts[0] = _(&quot;_Yes&quot;); buts[1]=_(&quot;_No&quot;); buts[2] = NULL;</span>
<span class="lineNum">     510 </span>            : 
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :     if ( uc_strcmp(name,&quot;.notdef&quot;)==0 )               /* This name is a special case and doesn't follow conventions */</span>
<span class="lineNum">     512 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :     if ( u_strlen(name)&gt;31 ) {</span>
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Bad Name&quot;),_(&quot;Glyph names are limited to 31 characters&quot;));</span>
<span class="lineNum">     515 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :     } else if ( *name=='\0' ) {</span>
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Bad Name&quot;),_(&quot;Bad Name&quot;));</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :     } else if ( isdigit(*name) || *name=='.' ) {</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Bad Name&quot;),_(&quot;A glyph name may not start with a digit nor a full stop (period)&quot;));</span>
<span class="lineNum">     521 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     522 </span>            :     }
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :     bad = questionable = false;</span>
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :     while ( *name ) {</span>
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :         if ( *name&lt;=' ' || (!allow_utf8_glyphnames &amp;&amp; *name&gt;=0x7f) ||</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :                 *name=='(' || *name=='[' || *name=='{' || *name=='&lt;' ||</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :                 *name==')' || *name==']' || *name=='}' || *name=='&gt;' ||</span>
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :                 *name=='%' || *name=='/' )</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :             bad=true;</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :         else if ( !isalnum(*name) &amp;&amp; *name!='.' &amp;&amp; *name!='_' )</span>
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :             questionable = true;</span>
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :         ++name;</span>
<span class="lineNum">     533 </span>            :     }
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :     if ( bad ) {</span>
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Bad Name&quot;),_(&quot;A glyph name must be ASCII, without spaces and may not contain the characters \&quot;([{&lt;&gt;}])/%%\&quot;, and should contain only alphanumerics, periods and underscores&quot;));</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :     } else if ( questionable ) {</span>
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :         if ( gwwv_ask(_(&quot;Bad Name&quot;),(const char **) buts,0,1,_(&quot;A glyph name should contain only alphanumerics, periods and underscores\nDo you want to use this name in spite of that?&quot;))==1 )</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 : return(false);</span>
<span class="lineNum">     540 </span>            :     }
<span class="lineNum">     541 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="542"><span class="lineNum">     542 </span>            : }</a>
<span class="lineNum">     543 </span>            : 
<span class="lineNum">     544 </span><span class="lineNoCov">          0 : static void CI_ParseCounters(CharInfo *ci) {</span>
<span class="lineNum">     545 </span>            :     int32 i,len;
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :     GTextInfo **ti = GGadgetGetList(GWidgetGetControl(ci-&gt;gw,CID_List+600),&amp;len);</span>
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :     SplineChar *sc = ci-&gt;cachedsc;</span>
<span class="lineNum">     548 </span>            : 
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :     free(sc-&gt;countermasks);</span>
<span class="lineNum">     550 </span>            : 
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :     sc-&gt;countermask_cnt = len;</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :     if ( len==0 )</span>
<span class="lineNum">     553 </span><span class="lineNoCov">          0 :         sc-&gt;countermasks = NULL;</span>
<span class="lineNum">     554 </span>            :     else {
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :         sc-&gt;countermasks = malloc(len*sizeof(HintMask));</span>
<span class="lineNum">     556 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;len; ++i ) {</span>
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :             memcpy(sc-&gt;countermasks[i],ti[i]-&gt;userdata,sizeof(HintMask));</span>
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :             chunkfree(ti[i]-&gt;userdata,sizeof(HintMask));</span>
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :             ti[i]-&gt;userdata = NULL;</span>
<span class="lineNum">     560 </span>            :         }
<span class="lineNum">     561 </span>            :     }
<a name="562"><span class="lineNum">     562 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     563 </span>            : 
<span class="lineNum">     564 </span><span class="lineNoCov">          0 : int DeviceTableOK(char *dvstr, int *_low, int *_high) {</span>
<span class="lineNum">     565 </span>            :     char *pt, *end;
<span class="lineNum">     566 </span>            :     int low, high, pixel, cor;
<span class="lineNum">     567 </span>            : 
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :     low = high = -1;</span>
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :     if ( dvstr!=NULL ) {</span>
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :         while ( *dvstr==' ' ) ++dvstr;</span>
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :         for ( pt=dvstr; *pt; ) {</span>
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :             pixel = strtol(pt,&amp;end,10);</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :             if ( pixel&lt;=0 || pt==end)</span>
<span class="lineNum">     574 </span>            :         break;
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :             pt = end;</span>
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :             if ( *pt==':' ) ++pt;</span>
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :             cor = strtol(pt,&amp;end,10);</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :             if ( pt==end || cor&lt;-128 || cor&gt;127 )</span>
<span class="lineNum">     579 </span>            :         break;
<span class="lineNum">     580 </span><span class="lineNoCov">          0 :             pt = end;</span>
<span class="lineNum">     581 </span><span class="lineNoCov">          0 :             while ( *pt==' ' ) ++pt;</span>
<span class="lineNum">     582 </span><span class="lineNoCov">          0 :             if ( *pt==',' ) ++pt;</span>
<span class="lineNum">     583 </span><span class="lineNoCov">          0 :             while ( *pt==' ' ) ++pt;</span>
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :             if ( low==-1 ) low = high = pixel;</span>
<span class="lineNum">     585 </span><span class="lineNoCov">          0 :             else if ( pixel&lt;low ) low = pixel;</span>
<span class="lineNum">     586 </span><span class="lineNoCov">          0 :             else if ( pixel&gt;high ) high = pixel;</span>
<span class="lineNum">     587 </span>            :         }
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :         if ( *pt != '\0' )</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     590 </span>            :     }
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :     *_low = low; *_high = high;</span>
<span class="lineNum">     592 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="593"><span class="lineNum">     593 </span>            : }</a>
<span class="lineNum">     594 </span>            : 
<span class="lineNum">     595 </span><span class="lineNoCov">          0 : DeviceTable *DeviceTableParse(DeviceTable *dv,char *dvstr) {</span>
<span class="lineNum">     596 </span>            :     char *pt, *end;
<span class="lineNum">     597 </span>            :     int low, high, pixel, cor;
<span class="lineNum">     598 </span>            : 
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :     DeviceTableOK(dvstr,&amp;low,&amp;high);</span>
<span class="lineNum">     600 </span><span class="lineNoCov">          0 :     if ( low==-1 ) {</span>
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :         if ( dv!=NULL ) {</span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :             free(dv-&gt;corrections);</span>
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :             memset(dv,0,sizeof(*dv));</span>
<span class="lineNum">     604 </span>            :         }
<span class="lineNum">     605 </span><span class="lineNoCov">          0 : return( dv );</span>
<span class="lineNum">     606 </span>            :     }
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :     if ( dv==NULL )</span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :         dv = chunkalloc(sizeof(DeviceTable));</span>
<span class="lineNum">     609 </span>            :     else
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :         free(dv-&gt;corrections);</span>
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :     dv-&gt;first_pixel_size = low;</span>
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :     dv-&gt;last_pixel_size = high;</span>
<span class="lineNum">     613 </span><span class="lineNoCov">          0 :     dv-&gt;corrections = calloc(high-low+1,1);</span>
<span class="lineNum">     614 </span>            : 
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :     for ( pt=dvstr; *pt; ) {</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :         pixel = strtol(pt,&amp;end,10);</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :         if ( pixel&lt;=0 || pt==end)</span>
<span class="lineNum">     618 </span>            :     break;
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :         pt = end;</span>
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :         if ( *pt==':' ) ++pt;</span>
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :         cor = strtol(pt,&amp;end,10);</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :         if ( pt==end || cor&lt;-128 || cor&gt;127 )</span>
<span class="lineNum">     623 </span>            :     break;
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :         pt = end;</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :         while ( *pt==' ' ) ++pt;</span>
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :         if ( *pt==',' ) ++pt;</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :         while ( *pt==' ' ) ++pt;</span>
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :         dv-&gt;corrections[pixel-low] = cor;</span>
<span class="lineNum">     629 </span>            :     }
<span class="lineNum">     630 </span><span class="lineNoCov">          0 : return( dv );</span>
<a name="631"><span class="lineNum">     631 </span>            : }</a>
<span class="lineNum">     632 </span>            : 
<span class="lineNum">     633 </span><span class="lineNoCov">          0 : void VRDevTabParse(struct vr *vr,struct matrix_data *md) {</span>
<span class="lineNum">     634 </span>            :     ValDevTab temp, *adjust;
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :     int any = false;</span>
<span class="lineNum">     636 </span>            : 
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :     if ( (adjust = vr-&gt;adjust)==NULL ) {</span>
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :         adjust = &amp;temp;</span>
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :         memset(&amp;temp,0,sizeof(temp));</span>
<span class="lineNum">     640 </span>            :     }
<span class="lineNum">     641 </span><span class="lineNoCov">          0 :     any |= (DeviceTableParse(&amp;adjust-&gt;xadjust,md[0].u.md_str)!=NULL);</span>
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :     any |= (DeviceTableParse(&amp;adjust-&gt;yadjust,md[2].u.md_str)!=NULL);</span>
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :     any |= (DeviceTableParse(&amp;adjust-&gt;xadv,md[4].u.md_str)!=NULL);</span>
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :     any |= (DeviceTableParse(&amp;adjust-&gt;yadv,md[6].u.md_str)!=NULL);</span>
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :     if ( any &amp;&amp; adjust==&amp;temp ) {</span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :         vr-&gt;adjust = chunkalloc(sizeof(ValDevTab));</span>
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :         *vr-&gt;adjust = temp;</span>
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :     } else if ( !any &amp;&amp; vr-&gt;adjust!=NULL ) {</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :         ValDevFree(vr-&gt;adjust);</span>
<span class="lineNum">     650 </span><span class="lineNoCov">          0 :         vr-&gt;adjust = NULL;</span>
<span class="lineNum">     651 </span>            :     }
<a name="652"><span class="lineNum">     652 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     653 </span>            : 
<span class="lineNum">     654 </span><span class="lineNoCov">          0 : void DevTabToString(char **str,DeviceTable *adjust) {</span>
<span class="lineNum">     655 </span>            :     char *pt;
<span class="lineNum">     656 </span>            :     int i;
<span class="lineNum">     657 </span>            : 
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :     if ( adjust==NULL || adjust-&gt;corrections==NULL ) {</span>
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :         *str = NULL;</span>
<span class="lineNum">     660 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     661 </span>            :     }
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :     *str = pt = malloc(11*(adjust-&gt;last_pixel_size-adjust-&gt;first_pixel_size+1)+1);</span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :     for ( i=adjust-&gt;first_pixel_size; i&lt;=adjust-&gt;last_pixel_size; ++i ) {</span>
<span class="lineNum">     664 </span><span class="lineNoCov">          0 :         if ( adjust-&gt;corrections[i-adjust-&gt;first_pixel_size]!=0 )</span>
<span class="lineNum">     665 </span><span class="lineNoCov">          0 :             sprintf( pt, &quot;%d:%d, &quot;, i, adjust-&gt;corrections[i-adjust-&gt;first_pixel_size]);</span>
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :         pt += strlen(pt);</span>
<span class="lineNum">     667 </span>            :     }
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :     if ( pt&gt;*str &amp;&amp; pt[-2] == ',' )</span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :         pt[-2] = '\0';</span>
<a name="670"><span class="lineNum">     670 </span>            : }</a>
<span class="lineNum">     671 </span>            :     
<span class="lineNum">     672 </span><span class="lineNoCov">          0 : void ValDevTabToStrings(struct matrix_data *mds,int first_offset,ValDevTab *adjust) {</span>
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :     if ( adjust==NULL )</span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     675 </span><span class="lineNoCov">          0 :     DevTabToString(&amp;mds[first_offset].u.md_str,&amp;adjust-&gt;xadjust);</span>
<span class="lineNum">     676 </span><span class="lineNoCov">          0 :     DevTabToString(&amp;mds[first_offset+2].u.md_str,&amp;adjust-&gt;yadjust);</span>
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :     DevTabToString(&amp;mds[first_offset+4].u.md_str,&amp;adjust-&gt;xadv);</span>
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :     DevTabToString(&amp;mds[first_offset+6].u.md_str,&amp;adjust-&gt;yadv);</span>
<a name="679"><span class="lineNum">     679 </span>            : }</a>
<span class="lineNum">     680 </span>            : 
<span class="lineNum">     681 </span><span class="lineNoCov">          0 : void KpMDParse(SplineChar *sc,struct lookup_subtable *sub,</span>
<span class="lineNum">     682 </span>            :         struct matrix_data *possub,int rows,int cols,int i) {
<span class="lineNum">     683 </span>            :     SplineChar *other;
<span class="lineNum">     684 </span>            :     PST *pst;
<span class="lineNum">     685 </span>            :     KernPair *kp;
<span class="lineNum">     686 </span>            :     int isv, iskpable, offset, newv;
<span class="lineNum">     687 </span>            :     char *dvstr;
<span class="lineNum">     688 </span>            :     char *pt, *start;
<span class="lineNum">     689 </span>            :     int ch;
<span class="lineNum">     690 </span>            : 
<span class="lineNum">     691 </span><span class="lineNoCov">          0 :     for ( start=possub[cols*i+1].u.md_str; ; ) {</span>
<span class="lineNum">     692 </span><span class="lineNoCov">          0 :         while ( *start==' ' ) ++start;</span>
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :         if ( *start=='\0' )</span>
<span class="lineNum">     694 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :         for ( pt=start; *pt!='\0' &amp;&amp; *pt!=' ' &amp;&amp; *pt!='('; ++pt );</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :         ch = *pt; *pt = '\0';</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :         other = SFGetChar(sc-&gt;parent,-1,start);</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :         for ( pst=sc-&gt;possub; pst!=NULL; pst=pst-&gt;next ) {</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :             if ( pst-&gt;subtable == sub &amp;&amp;</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :                     strcmp(start,pst-&gt;u.pair.paired)==0 )</span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     702 </span>            :         }
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :         kp = NULL;</span>
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :         if ( pst==NULL &amp;&amp; other!=NULL ) {</span>
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :             for ( isv=0; isv&lt;2; ++isv ) {</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :                 for ( kp = isv ? sc-&gt;vkerns : sc-&gt;kerns; kp!=NULL; kp=kp-&gt;next )</span>
<span class="lineNum">     707 </span><span class="lineNoCov">          0 :                     if ( kp-&gt;subtable==(void *) possub[cols*i+0].u.md_ival &amp;&amp;</span>
<span class="lineNum">     708 </span><span class="lineNoCov">          0 :                             kp-&gt;sc == other )</span>
<span class="lineNum">     709 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">     710 </span><span class="lineNoCov">          0 :                 if ( kp!=NULL )</span>
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">     712 </span>            :             }
<span class="lineNum">     713 </span>            :         }
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :         newv = false;</span>
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :         if ( other==NULL )</span>
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :             iskpable = false;</span>
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :         else if ( sub-&gt;vertical_kerning ) {</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :             newv = true;</span>
<span class="lineNum">     719 </span><span class="lineNoCov">          0 :             iskpable = possub[cols*i+PAIR_DX1].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DY1].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DX_ADV1].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DX2].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DY2].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DX_ADV2].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DY_ADV2].u.md_ival==0;</span>
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :             offset = possub[cols*i+PAIR_DY1].u.md_ival;</span>
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :             iskpable &amp;= (possub[cols*i+PAIR_DX1+1].u.md_str==NULL || *possub[cols*i+PAIR_DX1+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DY1+1].u.md_str==0 || *possub[cols*i+PAIR_DY1+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DX_ADV1+1].u.md_str==0 || *possub[cols*i+PAIR_DX_ADV1+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DX2+1].u.md_str==0 || *possub[cols*i+PAIR_DX2+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DY2+1].u.md_str==0 || *possub[cols*i+PAIR_DY2+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DX_ADV2+1].u.md_str==0 || *possub[cols*i+PAIR_DX_ADV2+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DY_ADV2+1].u.md_str==0 || *possub[cols*i+PAIR_DY_ADV2+1].u.md_str==0 );</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :             dvstr = possub[cols*i+PAIR_DY1+1].u.md_str;</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :         } else if ( sub-&gt;lookup-&gt;lookup_flags &amp; pst_r2l ) {</span>
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :             iskpable = possub[cols*i+PAIR_DX1].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     737 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DY1].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DX_ADV1].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     739 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DY_ADV1].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DX2].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DY2].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DY_ADV2].u.md_ival==0;</span>
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :             offset = possub[cols*i+PAIR_DX_ADV2].u.md_ival;</span>
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :             iskpable &amp;= (possub[cols*i+PAIR_DX1+1].u.md_str==NULL || *possub[cols*i+PAIR_DX1+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DY1+1].u.md_str==0 || *possub[cols*i+PAIR_DY1+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DX_ADV1+1].u.md_str==0 || *possub[cols*i+PAIR_DX_ADV1+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     747 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DY_ADV1+1].u.md_str==0 || *possub[cols*i+PAIR_DY_ADV1+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     748 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DX2+1].u.md_str==0 || *possub[cols*i+PAIR_DX2+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DY2+1].u.md_str==0 || *possub[cols*i+PAIR_DY2+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DY_ADV2+1].u.md_str==0 || *possub[cols*i+PAIR_DY_ADV2+1].u.md_str==0 );</span>
<span class="lineNum">     751 </span><span class="lineNoCov">          0 :             dvstr = possub[cols*i+PAIR_DX_ADV2+1].u.md_str;</span>
<span class="lineNum">     752 </span>            :         } else {
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :             iskpable = possub[cols*i+PAIR_DX1].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DY1].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DY_ADV1].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DX2].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DY2].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DX_ADV2].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :                         possub[cols*i+PAIR_DY_ADV2].u.md_ival==0;</span>
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :             offset = possub[cols*i+PAIR_DX_ADV1].u.md_ival;</span>
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :             iskpable &amp;= (possub[cols*i+PAIR_DX1+1].u.md_str==NULL || *possub[cols*i+PAIR_DX1+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DY1+1].u.md_str==0 || *possub[cols*i+PAIR_DY1+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DY_ADV1+1].u.md_str==0 || *possub[cols*i+PAIR_DY_ADV1+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DX2+1].u.md_str==0 || *possub[cols*i+PAIR_DX2+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DY2+1].u.md_str==0 || *possub[cols*i+PAIR_DY2+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DX_ADV2+1].u.md_str==0 || *possub[cols*i+PAIR_DX_ADV2+1].u.md_str==0 ) &amp;&amp;</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :                         (possub[cols*i+PAIR_DY_ADV2+1].u.md_str==0 || *possub[cols*i+PAIR_DY_ADV2+1].u.md_str==0 );</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :             dvstr = possub[cols*i+PAIR_DX_ADV1+1].u.md_str;</span>
<span class="lineNum">     769 </span>            :         }
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :         if ( iskpable ) {</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :             if ( kp==NULL ) {</span>
<span class="lineNum">     772 </span>            :                 /* If there's a pst, ignore it, it will not get ticked and will*/
<span class="lineNum">     773 </span>            :                 /*  be freed later */
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :                 kp = chunkalloc(sizeof(KernPair));</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :                 kp-&gt;subtable = sub;</span>
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :                 kp-&gt;sc = other;</span>
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :                 if ( newv ) {</span>
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :                     kp-&gt;next = sc-&gt;vkerns;</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :                     sc-&gt;vkerns = kp;</span>
<span class="lineNum">     780 </span>            :                 } else {
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :                     kp-&gt;next = sc-&gt;kerns;</span>
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :                     sc-&gt;kerns = kp;</span>
<span class="lineNum">     783 </span>            :                 }
<span class="lineNum">     784 </span>            :             }
<span class="lineNum">     785 </span><span class="lineNoCov">          0 :             DeviceTableFree(kp-&gt;adjust);</span>
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :             kp-&gt;adjust = DeviceTableParse(NULL,dvstr);</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :             kp-&gt;off = offset;</span>
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :             kp-&gt;kcid = true;</span>
<span class="lineNum">     789 </span>            :         } else {
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :             if ( pst == NULL ) {</span>
<span class="lineNum">     791 </span>            :                 /* If there's a kp, ignore it, it will not get ticked and will*/
<span class="lineNum">     792 </span>            :                 /*  be freed later */
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :                 pst = chunkalloc(sizeof(PST));</span>
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :                 pst-&gt;type = pst_pair;</span>
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :                 pst-&gt;subtable = sub;</span>
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :                 pst-&gt;next = sc-&gt;possub;</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :                 sc-&gt;possub = pst;</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :                 pst-&gt;u.pair.vr = chunkalloc(sizeof(struct vr [2]));</span>
<span class="lineNum">     799 </span><span class="lineNoCov">          0 :                 pst-&gt;u.pair.paired = copy(start);</span>
<span class="lineNum">     800 </span>            :             }
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :             VRDevTabParse(&amp;pst-&gt;u.pair.vr[0],&amp;possub[cols*i+PAIR_DX1+1]);</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :             VRDevTabParse(&amp;pst-&gt;u.pair.vr[1],&amp;possub[cols*i+PAIR_DX2]+1);</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :             pst-&gt;u.pair.vr[0].xoff = possub[cols*i+PAIR_DX1].u.md_ival;</span>
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :             pst-&gt;u.pair.vr[0].yoff = possub[cols*i+PAIR_DY1].u.md_ival;</span>
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :             pst-&gt;u.pair.vr[0].h_adv_off = possub[cols*i+PAIR_DX_ADV1].u.md_ival;</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :             pst-&gt;u.pair.vr[0].v_adv_off = possub[cols*i+PAIR_DY_ADV1].u.md_ival;</span>
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :             pst-&gt;u.pair.vr[1].xoff = possub[cols*i+PAIR_DX2].u.md_ival;</span>
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :             pst-&gt;u.pair.vr[1].yoff = possub[cols*i+PAIR_DY2].u.md_ival;</span>
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :             pst-&gt;u.pair.vr[1].h_adv_off = possub[cols*i+PAIR_DX_ADV2].u.md_ival;</span>
<span class="lineNum">     810 </span><span class="lineNoCov">          0 :             pst-&gt;u.pair.vr[1].v_adv_off = possub[cols*i+PAIR_DY_ADV2].u.md_ival;</span>
<span class="lineNum">     811 </span><span class="lineNoCov">          0 :             pst-&gt;ticked = true;</span>
<span class="lineNum">     812 </span>            :         }
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :         *pt = ch;</span>
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :         if ( ch=='(' ) {</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :             while ( *pt!=')' &amp;&amp; *pt!='\0' ) ++pt;</span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :             if ( *pt==')' ) ++pt;</span>
<span class="lineNum">     817 </span>            :         }
<span class="lineNum">     818 </span><span class="lineNoCov">          0 :         start = pt;</span>
<span class="lineNum">     819 </span><span class="lineNoCov">          0 :     }</span>
<a name="820"><span class="lineNum">     820 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     821 </span>            : 
<span class="lineNum">     822 </span><span class="lineNoCov">          0 : static int CI_ProcessPosSubs(CharInfo *ci) {</span>
<span class="lineNum">     823 </span>            :     /* Check for duplicate entries in kerning and ligatures. If we find any */
<span class="lineNum">     824 </span>            :     /*  complain and return failure */
<span class="lineNum">     825 </span>            :     /* Check for various other errors */
<span class="lineNum">     826 </span>            :     /* Otherwise process */
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :     SplineChar *sc = ci-&gt;cachedsc, *found;</span>
<span class="lineNum">     828 </span>            :     int i,j, rows, cols, isv, pstt, ch;
<span class="lineNum">     829 </span>            :     char *pt;
<span class="lineNum">     830 </span>            :     struct matrix_data *possub;
<span class="lineNum">     831 </span>            :     char *buts[3];
<span class="lineNum">     832 </span>            :     KernPair *kp, *kpprev, *kpnext;
<span class="lineNum">     833 </span>            :     PST *pst, *pstprev, *pstnext;
<span class="lineNum">     834 </span>            : 
<span class="lineNum">     835 </span><span class="lineNoCov">          0 :     possub = GMatrixEditGet(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_ligature-1)*100), &amp;rows );</span>
<span class="lineNum">     836 </span><span class="lineNoCov">          0 :     cols = GMatrixEditGetColCnt(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_ligature-1)*100) );</span>
<span class="lineNum">     837 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">     838 </span><span class="lineNoCov">          0 :         for ( j=i+1; j&lt;rows; ++j ) {</span>
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :             if ( possub[cols*i+0].u.md_ival == possub[cols*j+0].u.md_ival &amp;&amp;</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :                     strcmp(possub[cols*i+1].u.md_str,possub[cols*j+1].u.md_str)==0 ) {</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :                 ff_post_error( _(&quot;Duplicate Ligature&quot;),_(&quot;There are two ligature entries with the same components (%.80s) in the same lookup subtable (%.30s)&quot;),</span>
<span class="lineNum">     842 </span><span class="lineNoCov">          0 :                         possub[cols*j+1].u.md_str,</span>
<span class="lineNum">     843 </span><span class="lineNoCov">          0 :                         ((struct lookup_subtable *) possub[cols*i+0].u.md_ival)-&gt;subtable_name );</span>
<span class="lineNum">     844 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     845 </span>            :             }
<span class="lineNum">     846 </span>            :         }
<span class="lineNum">     847 </span>            :     }
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :     possub = GMatrixEditGet(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_pair-1)*100), &amp;rows );</span>
<span class="lineNum">     849 </span><span class="lineNoCov">          0 :     cols = GMatrixEditGetColCnt(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_pair-1)*100));</span>
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :         for ( j=i+1; j&lt;rows; ++j ) {</span>
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :             if ( possub[cols*i+0].u.md_ival == possub[cols*j+0].u.md_ival &amp;&amp;</span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :                     strcmp(possub[cols*i+1].u.md_str,possub[cols*j+1].u.md_str)==0 ) {</span>
<span class="lineNum">     854 </span><span class="lineNoCov">          0 :                 ff_post_error( _(&quot;Duplicate Kern data&quot;),_(&quot;There are two kerning entries for the same glyph (%.80s) in the same lookup subtable (%.30s)&quot;),</span>
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :                         possub[cols*j+1].u.md_str,</span>
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :                         ((struct lookup_subtable *) possub[cols*i+0].u.md_ival)-&gt;subtable_name );</span>
<span class="lineNum">     857 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     858 </span>            :             }
<span class="lineNum">     859 </span>            :         }
<span class="lineNum">     860 </span>            :     }
<span class="lineNum">     861 </span>            : 
<span class="lineNum">     862 </span>            :     /* Check for badly specified device tables */
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :     for ( pstt = pst_position; pstt&lt;=pst_pair; ++pstt ) {</span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :         int startc = pstt==pst_position ? SIM_DX+1 : PAIR_DX1+1;</span>
<span class="lineNum">     865 </span>            :         int low, high, c, r;
<span class="lineNum">     866 </span><span class="lineNoCov">          0 :         possub = GMatrixEditGet(GWidgetGetControl(ci-&gt;gw,CID_List+(pstt-1)*100), &amp;rows );</span>
<span class="lineNum">     867 </span><span class="lineNoCov">          0 :         cols = GMatrixEditGetColCnt(GWidgetGetControl(ci-&gt;gw,CID_List+(pstt-1)*100));</span>
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :         for ( r=0; r&lt;rows; ++r ) {</span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :             for ( c=startc; c&lt;cols; c+=2 ) {</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :                 if ( !DeviceTableOK(possub[r*cols+c].u.md_str,&amp;low,&amp;high) ) {</span>
<span class="lineNum">     871 </span><span class="lineNoCov">          0 :                     ff_post_error( _(&quot;Bad Device Table Adjustment&quot;),_(&quot;A device table adjustment specified for %.80s is invalid&quot;),</span>
<span class="lineNum">     872 </span><span class="lineNoCov">          0 :                             possub[cols*r+0].u.md_str );</span>
<span class="lineNum">     873 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     874 </span>            :                 }
<span class="lineNum">     875 </span>            :             }
<span class="lineNum">     876 </span>            :         }
<span class="lineNum">     877 </span>            :     }
<span class="lineNum">     878 </span>            : 
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :     for ( pstt = pst_pair; pstt&lt;=pst_ligature; ++pstt ) {</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :         possub = GMatrixEditGet(GWidgetGetControl(ci-&gt;gw,CID_List+(pstt-1)*100), &amp;rows );</span>
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :         cols = GMatrixEditGetColCnt(GWidgetGetControl(ci-&gt;gw,CID_List+(pstt-1)*100));</span>
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :             char *start = possub[cols*i+1].u.md_str;</span>
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :             while ( *start== ' ' ) ++start;</span>
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :             if ( *start=='\0' ) {</span>
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :                 ff_post_error( _(&quot;Missing glyph name&quot;),_(&quot;You must specify a glyph name for subtable %s&quot;),</span>
<span class="lineNum">     887 </span><span class="lineNoCov">          0 :                         ((struct lookup_subtable *) possub[cols*i+0].u.md_ival)-&gt;subtable_name );</span>
<span class="lineNum">     888 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     889 </span>            :             }
<span class="lineNum">     890 </span><span class="lineNoCov">          0 :             while ( *start ) {</span>
<span class="lineNum">     891 </span><span class="lineNoCov">          0 :                 for ( pt=start; *pt!='\0' &amp;&amp; *pt!=' ' &amp;&amp; *pt!='(' ; ++pt );</span>
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :                 ch = *pt; *pt='\0';</span>
<span class="lineNum">     893 </span><span class="lineNoCov">          0 :                 found = SFGetChar(sc-&gt;parent,-1,start);</span>
<span class="lineNum">     894 </span><span class="lineNoCov">          0 :                 if ( found==NULL ) {</span>
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :                     buts[0] = _(&quot;_Yes&quot;);</span>
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :                     buts[1] = _(&quot;_Cancel&quot;);</span>
<span class="lineNum">     897 </span><span class="lineNoCov">          0 :                     buts[2] = NULL;</span>
<span class="lineNum">     898 </span><span class="lineNoCov">          0 :                     if ( gwwv_ask(_(&quot;Missing glyph&quot;),(const char **) buts,0,1,_(&quot;In lookup subtable %.30s you refer to a glyph named %.80s, which is not in the font yet. Was this intentional?&quot;),</span>
<span class="lineNum">     899 </span><span class="lineNoCov">          0 :                             ((struct lookup_subtable *) possub[cols*i+0].u.md_ival)-&gt;subtable_name,</span>
<span class="lineNum">     900 </span>            :                             start)==1 ) {
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :                         *pt = ch;</span>
<span class="lineNum">     902 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     903 </span>            :                     }
<span class="lineNum">     904 </span><span class="lineNoCov">          0 :                 } else if ( found==ci-&gt;sc &amp;&amp; pstt!=pst_pair ) {</span>
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :                     buts[0] = _(&quot;_Yes&quot;);</span>
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :                     buts[1] = _(&quot;_Cancel&quot;);</span>
<span class="lineNum">     907 </span><span class="lineNoCov">          0 :                     buts[2] = NULL;</span>
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :                     if ( gwwv_ask(_(&quot;Substitution generates itself&quot;),(const char **) buts,0,1,_(&quot;In lookup subtable %.30s you replace a glyph with itself. Was this intentional?&quot;),</span>
<span class="lineNum">     909 </span><span class="lineNoCov">          0 :                             ((struct lookup_subtable *) possub[cols*i+0].u.md_ival)-&gt;subtable_name)==1 ) {</span>
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :                         *pt = ch;</span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     912 </span>            :                     }
<span class="lineNum">     913 </span>            :                 }
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :                 *pt = ch;</span>
<span class="lineNum">     915 </span><span class="lineNoCov">          0 :                 if ( ch=='(' ) {</span>
<span class="lineNum">     916 </span><span class="lineNoCov">          0 :                     while ( *pt!=')' &amp;&amp; *pt!='\0' ) ++pt;</span>
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :                     if ( *pt==')' ) ++pt;</span>
<span class="lineNum">     918 </span>            :                 }
<span class="lineNum">     919 </span><span class="lineNoCov">          0 :                 while ( *pt== ' ' ) ++pt;</span>
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :                 start = pt;</span>
<span class="lineNum">     921 </span>            :             }
<span class="lineNum">     922 </span>            :         }
<span class="lineNum">     923 </span>            :     }
<span class="lineNum">     924 </span>            : 
<span class="lineNum">     925 </span>            :     /* If we get this far, then we didn't find any errors */
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :     for ( pst = sc-&gt;possub; pst!=NULL; pst=pst-&gt;next )</span>
<span class="lineNum">     927 </span><span class="lineNoCov">          0 :         pst-&gt;ticked = pst-&gt;type==pst_lcaret;</span>
<span class="lineNum">     928 </span><span class="lineNoCov">          0 :     for ( isv=0; isv&lt;2; ++isv )</span>
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :         for ( kp = isv ? sc-&gt;vkerns : sc-&gt;kerns; kp!=NULL; kp=kp-&gt;next )</span>
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :             kp-&gt;kcid = 0;</span>
<span class="lineNum">     931 </span>            : 
<span class="lineNum">     932 </span><span class="lineNoCov">          0 :     for ( pstt=pst_substitution; pstt&lt;=pst_ligature; ++pstt ) {</span>
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :         possub = GMatrixEditGet(GWidgetGetControl(ci-&gt;gw,CID_List+(pstt-1)*100), &amp;rows );</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :         cols = GMatrixEditGetColCnt(GWidgetGetControl(ci-&gt;gw,CID_List+(pstt-1)*100) );</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">     936 </span><span class="lineNoCov">          0 :             for ( pst=sc-&gt;possub; pst!=NULL; pst=pst-&gt;next ) {</span>
<span class="lineNum">     937 </span><span class="lineNoCov">          0 :                 if ( pst-&gt;subtable == (void *) possub[cols*i+0].u.md_ival &amp;&amp;</span>
<span class="lineNum">     938 </span><span class="lineNoCov">          0 :                         !pst-&gt;ticked )</span>
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">     940 </span>            :             }
<span class="lineNum">     941 </span><span class="lineNoCov">          0 :             if ( pst==NULL ) {</span>
<span class="lineNum">     942 </span><span class="lineNoCov">          0 :                 pst = chunkalloc(sizeof(PST));</span>
<span class="lineNum">     943 </span><span class="lineNoCov">          0 :                 pst-&gt;type = pstt;</span>
<span class="lineNum">     944 </span><span class="lineNoCov">          0 :                 pst-&gt;subtable = (void *) possub[cols*i+0].u.md_ival;</span>
<span class="lineNum">     945 </span><span class="lineNoCov">          0 :                 pst-&gt;next = sc-&gt;possub;</span>
<span class="lineNum">     946 </span><span class="lineNoCov">          0 :                 sc-&gt;possub = pst;</span>
<span class="lineNum">     947 </span>            :             } else
<span class="lineNum">     948 </span><span class="lineNoCov">          0 :                 free( pst-&gt;u.subs.variant );</span>
<span class="lineNum">     949 </span><span class="lineNoCov">          0 :             pst-&gt;ticked = true;</span>
<span class="lineNum">     950 </span><span class="lineNoCov">          0 :             pst-&gt;u.subs.variant = GlyphNameListDeUnicode( possub[cols*i+1].u.md_str );</span>
<span class="lineNum">     951 </span><span class="lineNoCov">          0 :             if ( pstt==pst_ligature )</span>
<span class="lineNum">     952 </span><span class="lineNoCov">          0 :                 pst-&gt;u.lig.lig = sc;</span>
<span class="lineNum">     953 </span>            :         }
<span class="lineNum">     954 </span>            :     }
<span class="lineNum">     955 </span>            : 
<span class="lineNum">     956 </span><span class="lineNoCov">          0 :     possub = GMatrixEditGet(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_position-1)*100), &amp;rows );</span>
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :     cols = GMatrixEditGetColCnt(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_position-1)*100));</span>
<span class="lineNum">     958 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :         for ( pst=sc-&gt;possub; pst!=NULL; pst=pst-&gt;next ) {</span>
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :             if ( pst-&gt;subtable == (void *) possub[cols*i+0].u.md_ival &amp;&amp;</span>
<span class="lineNum">     961 </span><span class="lineNoCov">          0 :                     !pst-&gt;ticked )</span>
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     963 </span>            :         }
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :         if ( pst==NULL ) {</span>
<span class="lineNum">     965 </span><span class="lineNoCov">          0 :             pst = chunkalloc(sizeof(PST));</span>
<span class="lineNum">     966 </span><span class="lineNoCov">          0 :             pst-&gt;type = pst_position;</span>
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :             pst-&gt;subtable = (void *) possub[cols*i+0].u.md_ival;</span>
<span class="lineNum">     968 </span><span class="lineNoCov">          0 :             pst-&gt;next = sc-&gt;possub;</span>
<span class="lineNum">     969 </span><span class="lineNoCov">          0 :             sc-&gt;possub = pst;</span>
<span class="lineNum">     970 </span>            :         }
<span class="lineNum">     971 </span><span class="lineNoCov">          0 :         VRDevTabParse(&amp;pst-&gt;u.pos,&amp;possub[cols*i+SIM_DX+1]);</span>
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :         pst-&gt;u.pos.xoff = possub[cols*i+SIM_DX].u.md_ival;</span>
<span class="lineNum">     973 </span><span class="lineNoCov">          0 :         pst-&gt;u.pos.yoff = possub[cols*i+SIM_DY].u.md_ival;</span>
<span class="lineNum">     974 </span><span class="lineNoCov">          0 :         pst-&gt;u.pos.h_adv_off = possub[cols*i+SIM_DX_ADV].u.md_ival;</span>
<span class="lineNum">     975 </span><span class="lineNoCov">          0 :         pst-&gt;u.pos.v_adv_off = possub[cols*i+SIM_DY_ADV].u.md_ival;</span>
<span class="lineNum">     976 </span><span class="lineNoCov">          0 :         pst-&gt;ticked = true;</span>
<span class="lineNum">     977 </span>            :     }
<span class="lineNum">     978 </span>            : 
<span class="lineNum">     979 </span><span class="lineNoCov">          0 :     possub = GMatrixEditGet(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_pair-1)*100), &amp;rows );</span>
<span class="lineNum">     980 </span><span class="lineNoCov">          0 :     cols = GMatrixEditGetColCnt(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_pair-1)*100));</span>
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">     982 </span><span class="lineNoCov">          0 :         struct lookup_subtable *sub = ((struct lookup_subtable *) possub[cols*i+0].u.md_ival);</span>
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :         KpMDParse(sc,sub,possub,rows,cols,i);</span>
<span class="lineNum">     984 </span>            :     }
<span class="lineNum">     985 </span>            : 
<span class="lineNum">     986 </span>            :     /* Now, free anything that did not get ticked */
<span class="lineNum">     987 </span><span class="lineNoCov">          0 :     for ( pstprev=NULL, pst = sc-&gt;possub; pst!=NULL; pst=pstnext ) {</span>
<span class="lineNum">     988 </span><span class="lineNoCov">          0 :         pstnext = pst-&gt;next;</span>
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :         if ( pst-&gt;ticked )</span>
<span class="lineNum">     990 </span><span class="lineNoCov">          0 :             pstprev = pst;</span>
<span class="lineNum">     991 </span>            :         else {
<span class="lineNum">     992 </span><span class="lineNoCov">          0 :             if ( pstprev==NULL )</span>
<span class="lineNum">     993 </span><span class="lineNoCov">          0 :                 sc-&gt;possub = pstnext;</span>
<span class="lineNum">     994 </span>            :             else
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :                 pstprev-&gt;next = pstnext;</span>
<span class="lineNum">     996 </span><span class="lineNoCov">          0 :             pst-&gt;next = NULL;</span>
<span class="lineNum">     997 </span><span class="lineNoCov">          0 :             PSTFree(pst);</span>
<span class="lineNum">     998 </span>            :         }
<span class="lineNum">     999 </span>            :     }
<span class="lineNum">    1000 </span><span class="lineNoCov">          0 :     for ( isv=0; isv&lt;2; ++isv ) {</span>
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 :         for ( kpprev=NULL, kp = isv ? sc-&gt;vkerns : sc-&gt;kerns; kp!=NULL; kp=kpnext ) {</span>
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 :             kpnext = kp-&gt;next;</span>
<span class="lineNum">    1003 </span><span class="lineNoCov">          0 :             if ( kp-&gt;kcid!=0 )</span>
<span class="lineNum">    1004 </span><span class="lineNoCov">          0 :                 kpprev = kp;</span>
<span class="lineNum">    1005 </span>            :             else {
<span class="lineNum">    1006 </span><span class="lineNoCov">          0 :                 if ( kpprev!=NULL )</span>
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 :                     kpprev-&gt;next = kpnext;</span>
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 :                 else if ( isv )</span>
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 :                     sc-&gt;vkerns = kpnext;</span>
<span class="lineNum">    1010 </span>            :                 else
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :                     sc-&gt;kerns = kpnext;</span>
<span class="lineNum">    1012 </span><span class="lineNoCov">          0 :                 kp-&gt;next = NULL;</span>
<span class="lineNum">    1013 </span><span class="lineNoCov">          0 :                 KernPairsFree(kp);</span>
<span class="lineNum">    1014 </span>            :             }
<span class="lineNum">    1015 </span>            :         }
<span class="lineNum">    1016 </span>            :     }
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :     for ( isv=0; isv&lt;2; ++isv )</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :         for ( kp = isv ? sc-&gt;vkerns : sc-&gt;kerns; kp!=NULL; kp=kp-&gt;next )</span>
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :             kp-&gt;kcid = 0;</span>
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1021"><span class="lineNum">    1021 </span>            : }</a>
<span class="lineNum">    1022 </span>            : 
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 : static int gettex(GWindow gw,int cid,char *msg,int *err) {</span>
<span class="lineNum">    1024 </span><span class="lineNoCov">          0 :     const unichar_t *ret = _GGadgetGetTitle(GWidgetGetControl(gw,cid));</span>
<span class="lineNum">    1025 </span>            : 
<span class="lineNum">    1026 </span><span class="lineNoCov">          0 :     if ( *ret=='\0' )</span>
<span class="lineNum">    1027 </span><span class="lineNoCov">          0 : return( TEX_UNDEF );</span>
<span class="lineNum">    1028 </span><span class="lineNoCov">          0 : return( GetInt8(gw,cid,msg,err));</span>
<a name="1029"><span class="lineNum">    1029 </span>            : }</a>
<span class="lineNum">    1030 </span>            : 
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 : struct glyphvariants *GV_ParseConstruction(struct glyphvariants *gv,</span>
<span class="lineNum">    1032 </span>            :         struct matrix_data *stuff, int rows, int cols) {
<span class="lineNum">    1033 </span>            :     int i;
<span class="lineNum">    1034 </span>            : 
<span class="lineNum">    1035 </span><span class="lineNoCov">          0 :     if ( gv==NULL )</span>
<span class="lineNum">    1036 </span><span class="lineNoCov">          0 :         gv = chunkalloc(sizeof(struct glyphvariants));</span>
<span class="lineNum">    1037 </span>            : 
<span class="lineNum">    1038 </span><span class="lineNoCov">          0 :     gv-&gt;part_cnt = rows;</span>
<span class="lineNum">    1039 </span><span class="lineNoCov">          0 :     gv-&gt;parts = calloc(rows,sizeof(struct gv_part));</span>
<span class="lineNum">    1040 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 :         gv-&gt;parts[i].component = copy(stuff[i*cols+0].u.md_str);</span>
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :         gv-&gt;parts[i].is_extender = stuff[i*cols+1].u.md_ival;</span>
<span class="lineNum">    1043 </span><span class="lineNoCov">          0 :         gv-&gt;parts[i].startConnectorLength = stuff[i*cols+2].u.md_ival;</span>
<span class="lineNum">    1044 </span><span class="lineNoCov">          0 :         gv-&gt;parts[i].endConnectorLength = stuff[i*cols+3].u.md_ival;</span>
<span class="lineNum">    1045 </span><span class="lineNoCov">          0 :         gv-&gt;parts[i].fullAdvance = stuff[i*cols+4].u.md_ival;</span>
<span class="lineNum">    1046 </span>            :     }
<span class="lineNum">    1047 </span><span class="lineNoCov">          0 : return( gv );</span>
<a name="1048"><span class="lineNum">    1048 </span>            : }</a>
<span class="lineNum">    1049 </span>            : 
<span class="lineNum">    1050 </span><span class="lineNoCov">          0 : static struct glyphvariants *CI_ParseVariants(struct glyphvariants *gv,</span>
<span class="lineNum">    1051 </span>            :         CharInfo *ci, int is_horiz,
<span class="lineNum">    1052 </span>            :         char *italic_correction_devtab, int italic_correction,
<span class="lineNum">    1053 </span>            :         int only_parts) {
<span class="lineNum">    1054 </span><span class="lineNoCov">          0 :     char *variants = GGadgetGetTitle8(GWidgetGetControl(ci-&gt;gw,CID_VariantList+is_horiz*100));</span>
<span class="lineNum">    1055 </span><span class="lineNoCov">          0 :     GGadget *construct = GWidgetGetControl(ci-&gt;gw,CID_ExtensionList+is_horiz*100);</span>
<span class="lineNum">    1056 </span><span class="lineNoCov">          0 :     int rows, cols = GMatrixEditGetColCnt(construct);</span>
<span class="lineNum">    1057 </span><span class="lineNoCov">          0 :     struct matrix_data *stuff = GMatrixEditGet(construct,&amp;rows);</span>
<span class="lineNum">    1058 </span>            : 
<span class="lineNum">    1059 </span><span class="lineNoCov">          0 :     if ( (variants==NULL || variants[0]=='\0' || only_parts) &amp;&amp; rows==0 ) {</span>
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :         free(variants);</span>
<span class="lineNum">    1061 </span><span class="lineNoCov">          0 :         GlyphVariantsFree(gv);</span>
<span class="lineNum">    1062 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    1063 </span>            :     }
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :     if ( gv==NULL )</span>
<span class="lineNum">    1065 </span><span class="lineNoCov">          0 :         gv = chunkalloc(sizeof(struct glyphvariants));</span>
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 :     free(gv-&gt;variants); gv-&gt;variants = NULL;</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :     if ( only_parts ) {</span>
<span class="lineNum">    1068 </span><span class="lineNoCov">          0 :         free(variants); variants = NULL;</span>
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :     } else if ( variants!=NULL &amp;&amp; *variants!='\0' )</span>
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :         gv-&gt;variants = variants;</span>
<span class="lineNum">    1071 </span>            :     else {
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 :         gv-&gt;variants = NULL;</span>
<span class="lineNum">    1073 </span><span class="lineNoCov">          0 :         free( variants);</span>
<span class="lineNum">    1074 </span>            :     }
<span class="lineNum">    1075 </span><span class="lineNoCov">          0 :     if ( !only_parts ) {</span>
<span class="lineNum">    1076 </span><span class="lineNoCov">          0 :         gv-&gt;italic_correction = italic_correction;</span>
<span class="lineNum">    1077 </span><span class="lineNoCov">          0 :         gv-&gt;italic_adjusts = DeviceTableParse(gv-&gt;italic_adjusts,italic_correction_devtab);</span>
<span class="lineNum">    1078 </span>            :     }
<span class="lineNum">    1079 </span><span class="lineNoCov">          0 :     gv = GV_ParseConstruction(gv,stuff,rows,cols);</span>
<span class="lineNum">    1080 </span><span class="lineNoCov">          0 : return( gv );</span>
<a name="1081"><span class="lineNum">    1081 </span>            : }</a>
<span class="lineNum">    1082 </span>            : 
<span class="lineNum">    1083 </span><span class="lineNoCov">          0 : static int CI_ValidateAltUnis(CharInfo *ci) {</span>
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :     GGadget *au = GWidgetGetControl(ci-&gt;gw,CID_AltUni);</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">          0 :     int rows, cols = GMatrixEditGetColCnt(au);</span>
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :     struct matrix_data *stuff = GMatrixEditGet(au,&amp;rows);</span>
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :     int i, asked = false;</span>
<span class="lineNum">    1088 </span>            : 
<span class="lineNum">    1089 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :         int uni = stuff[i*cols+0].u.md_ival, vs = stuff[i*cols+1].u.md_ival;</span>
<span class="lineNum">    1091 </span><span class="lineNoCov">          0 :         if ( uni&lt;0 || uni&gt;=unicode4_size ||</span>
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :                 vs&lt;-1 || vs&gt;=unicode4_size ) {</span>
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 :             ff_post_error(_(&quot;Unicode out of range&quot;), _(&quot;Bad unicode value for an alternate unicode / variation selector&quot;));</span>
<span class="lineNum">    1094 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1095 </span>            :         }
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 :         if ( (vs&gt;=0x180B &amp;&amp; vs&lt;=0x180D) ||        /* Mongolian VS */</span>
<span class="lineNum">    1097 </span><span class="lineNoCov">          0 :                  (vs&gt;=0xfe00 &amp;&amp; vs&lt;=0xfe0f) ||    /* First VS block */</span>
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :                  (vs&gt;=0xE0100 &amp;&amp; vs&lt;=0xE01EF) ) { /* Second VS block */</span>
<span class="lineNum">    1099 </span>            :             /* ok, that's a reasonable value */;
<span class="lineNum">    1100 </span><span class="lineNoCov">          0 :         } else if ( vs==0 || vs==-1 ) {</span>
<span class="lineNum">    1101 </span>            :             /* That's ok too (means no selector, just an alternate encoding) */;
<span class="lineNum">    1102 </span><span class="lineNoCov">          0 :         } else if ( !asked ) {</span>
<span class="lineNum">    1103 </span>            :             char *buts[3];
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :             buts[0] = _(&quot;_OK&quot;); buts[1] = _(&quot;_Cancel&quot;); buts[2]=NULL;</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :             if ( gwwv_ask(_(&quot;Unexpected Variation Selector&quot;),(const char **) buts,0,1,</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :                     _(&quot;Variation selectors are normally between\n&quot;</span>
<span class="lineNum">    1107 </span>            :                       &quot;   U+180B and U+180D\n&quot;
<span class="lineNum">    1108 </span>            :                       &quot;   U+FE00 and U+FE0F\n&quot;
<span class="lineNum">    1109 </span>            :                       &quot;   U+E0100 and U+E01EF\n&quot;
<span class="lineNum">    1110 </span>            :                       &quot;did you really intend to use U+%04X?&quot;), vs)==1 )
<span class="lineNum">    1111 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :             asked = true;</span>
<span class="lineNum">    1113 </span>            :         }
<span class="lineNum">    1114 </span>            :     }
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1116"><span class="lineNum">    1116 </span>            : }</a>
<span class="lineNum">    1117 </span>            : 
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 : static void CI_ParseAltUnis(CharInfo *ci) {</span>
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 :     GGadget *au = GWidgetGetControl(ci-&gt;gw,CID_AltUni);</span>
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 :     int rows, cols = GMatrixEditGetColCnt(au);</span>
<span class="lineNum">    1121 </span><span class="lineNoCov">          0 :     struct matrix_data *stuff = GMatrixEditGet(au,&amp;rows);</span>
<span class="lineNum">    1122 </span>            :     int i;
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :     struct altuni *altuni, *last = NULL;</span>
<span class="lineNum">    1124 </span><span class="lineNoCov">          0 :     SplineChar *sc = ci-&gt;cachedsc;</span>
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 :     int deenc = false;</span>
<span class="lineNum">    1126 </span>            :     FontView *fvs;
<span class="lineNum">    1127 </span>            :     int oldcnt, newcnt;
<span class="lineNum">    1128 </span>            : 
<span class="lineNum">    1129 </span><span class="lineNoCov">          0 :     oldcnt = 0;</span>
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :     for ( altuni=sc-&gt;altuni ; altuni!=NULL; altuni = altuni-&gt;next )</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 :         if ( altuni-&gt;vs==-1 &amp;&amp; altuni-&gt;fid==0 )</span>
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 :             ++oldcnt;</span>
<span class="lineNum">    1133 </span>            : 
<span class="lineNum">    1134 </span><span class="lineNoCov">          0 :     newcnt = 0;</span>
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">    1136 </span><span class="lineNoCov">          0 :         int uni = stuff[i*cols+0].u.md_ival, vs = stuff[i*cols+1].u.md_ival;</span>
<span class="lineNum">    1137 </span><span class="lineNoCov">          0 :         if ( vs!=0 )</span>
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    1139 </span><span class="lineNoCov">          0 :         ++newcnt;</span>
<span class="lineNum">    1140 </span><span class="lineNoCov">          0 :         if ( uni==sc-&gt;unicodeenc )</span>
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :         for ( altuni=sc-&gt;altuni ; altuni!=NULL; altuni = altuni-&gt;next )</span>
<span class="lineNum">    1143 </span><span class="lineNoCov">          0 :             if ( uni==altuni-&gt;unienc &amp;&amp; altuni-&gt;vs==-1 &amp;&amp; altuni-&gt;fid==0 )</span>
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :         if ( altuni==NULL ) {</span>
<span class="lineNum">    1146 </span><span class="lineNoCov">          0 :             deenc = true;</span>
<span class="lineNum">    1147 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1148 </span>            :         }
<span class="lineNum">    1149 </span>            :     }
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :     if ( oldcnt!=newcnt || deenc ) {</span>
<span class="lineNum">    1151 </span><span class="lineNoCov">          0 :         for ( fvs=(FontView *) sc-&gt;parent-&gt;fv; fvs!=NULL; fvs=(FontView *) fvs-&gt;b.nextsame ) {</span>
<span class="lineNum">    1152 </span><span class="lineNoCov">          0 :             fvs-&gt;b.map-&gt;enc = &amp;custom;</span>
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :             FVSetTitle((FontViewBase *) fvs);</span>
<span class="lineNum">    1154 </span>            :         }
<span class="lineNum">    1155 </span>            :     }
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :     AltUniFree(sc-&gt;altuni); sc-&gt;altuni = NULL;</span>
<span class="lineNum">    1157 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">    1158 </span><span class="lineNoCov">          0 :         int uni = stuff[i*cols+0].u.md_ival, vs = stuff[i*cols+1].u.md_ival;</span>
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 :         altuni = chunkalloc(sizeof(struct altuni));</span>
<span class="lineNum">    1160 </span><span class="lineNoCov">          0 :         altuni-&gt;unienc = uni;</span>
<span class="lineNum">    1161 </span><span class="lineNoCov">          0 :         altuni-&gt;vs = vs==0 ? -1 : vs;</span>
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :         altuni-&gt;fid = 0;</span>
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 :         if ( last == NULL )</span>
<span class="lineNum">    1164 </span><span class="lineNoCov">          0 :             sc-&gt;altuni = altuni;</span>
<span class="lineNum">    1165 </span>            :         else
<span class="lineNum">    1166 </span><span class="lineNoCov">          0 :             last-&gt;next = altuni;</span>
<span class="lineNum">    1167 </span><span class="lineNoCov">          0 :         last = altuni;</span>
<span class="lineNum">    1168 </span>            :     }
<a name="1169"><span class="lineNum">    1169 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1170 </span>            : 
<span class="lineNum">    1171 </span><span class="lineNoCov">          0 : static KernPair *CI_KPCopy(KernPair *kp) {</span>
<span class="lineNum">    1172 </span><span class="lineNoCov">          0 :     KernPair *head=NULL, *last=NULL, *newkp;</span>
<span class="lineNum">    1173 </span>            : 
<span class="lineNum">    1174 </span><span class="lineNoCov">          0 :     while ( kp!=NULL ) {</span>
<span class="lineNum">    1175 </span><span class="lineNoCov">          0 :         newkp = chunkalloc(sizeof(KernPair));</span>
<span class="lineNum">    1176 </span><span class="lineNoCov">          0 :         *newkp = *kp;</span>
<span class="lineNum">    1177 </span><span class="lineNoCov">          0 :         newkp-&gt;adjust = DeviceTableCopy(kp-&gt;adjust);</span>
<span class="lineNum">    1178 </span><span class="lineNoCov">          0 :         newkp-&gt;next = NULL;</span>
<span class="lineNum">    1179 </span><span class="lineNoCov">          0 :         if ( head==NULL )</span>
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :             head = newkp;</span>
<span class="lineNum">    1181 </span>            :         else
<span class="lineNum">    1182 </span><span class="lineNoCov">          0 :             last-&gt;next = newkp;</span>
<span class="lineNum">    1183 </span><span class="lineNoCov">          0 :         last = newkp;</span>
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :         kp = kp-&gt;next;</span>
<span class="lineNum">    1185 </span>            :     }
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 : return( head );</span>
<a name="1187"><span class="lineNum">    1187 </span>            : }</a>
<span class="lineNum">    1188 </span>            : 
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 : static PST *CI_PSTCopy(PST *pst) {</span>
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :     PST *head=NULL, *last=NULL, *newpst;</span>
<span class="lineNum">    1191 </span>            : 
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :     while ( pst!=NULL ) {</span>
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :         newpst = chunkalloc(sizeof(KernPair));</span>
<span class="lineNum">    1194 </span><span class="lineNoCov">          0 :         *newpst = *pst;</span>
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 :         if ( newpst-&gt;type==pst_ligature ) {</span>
<span class="lineNum">    1196 </span><span class="lineNoCov">          0 :             newpst-&gt;u.lig.components = copy(pst-&gt;u.lig.components);</span>
<span class="lineNum">    1197 </span><span class="lineNoCov">          0 :         } else if ( newpst-&gt;type==pst_pair ) {</span>
<span class="lineNum">    1198 </span><span class="lineNoCov">          0 :             newpst-&gt;u.pair.paired = copy(pst-&gt;u.pair.paired);</span>
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :             newpst-&gt;u.pair.vr = chunkalloc(sizeof( struct vr [2]));</span>
<span class="lineNum">    1200 </span><span class="lineNoCov">          0 :             memcpy(newpst-&gt;u.pair.vr,pst-&gt;u.pair.vr,sizeof(struct vr [2]));</span>
<span class="lineNum">    1201 </span><span class="lineNoCov">          0 :             newpst-&gt;u.pair.vr[0].adjust = ValDevTabCopy(pst-&gt;u.pair.vr[0].adjust);</span>
<span class="lineNum">    1202 </span><span class="lineNoCov">          0 :             newpst-&gt;u.pair.vr[1].adjust = ValDevTabCopy(pst-&gt;u.pair.vr[1].adjust);</span>
<span class="lineNum">    1203 </span><span class="lineNoCov">          0 :         } else if ( newpst-&gt;type==pst_lcaret ) {</span>
<span class="lineNum">    1204 </span><span class="lineNoCov">          0 :             newpst-&gt;u.lcaret.carets = malloc(pst-&gt;u.lcaret.cnt*sizeof(uint16));</span>
<span class="lineNum">    1205 </span><span class="lineNoCov">          0 :             memcpy(newpst-&gt;u.lcaret.carets,pst-&gt;u.lcaret.carets,pst-&gt;u.lcaret.cnt*sizeof(uint16));</span>
<span class="lineNum">    1206 </span><span class="lineNoCov">          0 :         } else if ( newpst-&gt;type==pst_substitution || newpst-&gt;type==pst_multiple || newpst-&gt;type==pst_alternate )</span>
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :             newpst-&gt;u.subs.variant = copy(pst-&gt;u.subs.variant);</span>
<span class="lineNum">    1208 </span><span class="lineNoCov">          0 :         newpst-&gt;next = NULL;</span>
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :         if ( head==NULL )</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :             head = newpst;</span>
<span class="lineNum">    1211 </span>            :         else
<span class="lineNum">    1212 </span><span class="lineNoCov">          0 :             last-&gt;next = newpst;</span>
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :         last = newpst;</span>
<span class="lineNum">    1214 </span><span class="lineNoCov">          0 :         pst = pst-&gt;next;</span>
<span class="lineNum">    1215 </span>            :     }
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 : return( head );</span>
<a name="1217"><span class="lineNum">    1217 </span>            : }</a>
<span class="lineNum">    1218 </span>            : 
<span class="lineNum">    1219 </span><span class="lineNoCov">          0 : static SplineChar *CI_SCDuplicate(SplineChar *sc) {</span>
<span class="lineNum">    1220 </span>            :     SplineChar *newsc;          /* copy everything we care about in this dlg */
<span class="lineNum">    1221 </span>            : 
<span class="lineNum">    1222 </span><span class="lineNoCov">          0 :     newsc = chunkalloc(sizeof(SplineChar));</span>
<span class="lineNum">    1223 </span><span class="lineNoCov">          0 :     newsc-&gt;name = copy(sc-&gt;name);</span>
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :     newsc-&gt;parent = sc-&gt;parent;</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :     newsc-&gt;unicodeenc = sc-&gt;unicodeenc;</span>
<span class="lineNum">    1226 </span><span class="lineNoCov">          0 :     newsc-&gt;orig_pos = sc-&gt;orig_pos;</span>
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :     newsc-&gt;comment = copy(sc-&gt;comment);</span>
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 :     newsc-&gt;unlink_rm_ovrlp_save_undo = sc-&gt;unlink_rm_ovrlp_save_undo;</span>
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :     newsc-&gt;glyph_class = sc-&gt;glyph_class;</span>
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :     newsc-&gt;color = sc-&gt;color;</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :     if ( sc-&gt;countermask_cnt!=0 ) {</span>
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :         newsc-&gt;countermask_cnt = sc-&gt;countermask_cnt;</span>
<span class="lineNum">    1233 </span><span class="lineNoCov">          0 :         newsc-&gt;countermasks = malloc(sc-&gt;countermask_cnt*sizeof(HintMask));</span>
<span class="lineNum">    1234 </span><span class="lineNoCov">          0 :         memcpy(newsc-&gt;countermasks,sc-&gt;countermasks,sc-&gt;countermask_cnt*sizeof(HintMask));</span>
<span class="lineNum">    1235 </span>            :     }
<span class="lineNum">    1236 </span><span class="lineNoCov">          0 :     newsc-&gt;tex_height = sc-&gt;tex_height;</span>
<span class="lineNum">    1237 </span><span class="lineNoCov">          0 :     newsc-&gt;tex_depth = sc-&gt;tex_depth;</span>
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :     newsc-&gt;italic_correction = sc-&gt;italic_correction;</span>
<span class="lineNum">    1239 </span><span class="lineNoCov">          0 :     newsc-&gt;top_accent_horiz = sc-&gt;top_accent_horiz;</span>
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 :     newsc-&gt;is_extended_shape = sc-&gt;is_extended_shape;</span>
<span class="lineNum">    1241 </span><span class="lineNoCov">          0 :     newsc-&gt;italic_adjusts = DeviceTableCopy(sc-&gt;italic_adjusts);</span>
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :     newsc-&gt;top_accent_adjusts = DeviceTableCopy(sc-&gt;top_accent_adjusts);</span>
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :     newsc-&gt;horiz_variants = GlyphVariantsCopy(sc-&gt;horiz_variants);</span>
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :     newsc-&gt;vert_variants = GlyphVariantsCopy(sc-&gt;vert_variants);</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :     newsc-&gt;altuni = AltUniCopy(sc-&gt;altuni,NULL);</span>
<span class="lineNum">    1246 </span><span class="lineNoCov">          0 :     newsc-&gt;lig_caret_cnt_fixed = sc-&gt;lig_caret_cnt_fixed;</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :     newsc-&gt;possub = CI_PSTCopy(sc-&gt;possub);</span>
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 :     newsc-&gt;kerns = CI_KPCopy(sc-&gt;kerns);</span>
<span class="lineNum">    1249 </span><span class="lineNoCov">          0 :     newsc-&gt;vkerns = CI_KPCopy(sc-&gt;vkerns);</span>
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :     newsc-&gt;tile_margin = sc-&gt;tile_margin;</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :     newsc-&gt;tile_bounds = sc-&gt;tile_bounds;</span>
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 : return( newsc );</span>
<a name="1253"><span class="lineNum">    1253 </span>            : }</a>
<span class="lineNum">    1254 </span>            : 
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 : static int CI_CheckMetaData(CharInfo *ci,SplineChar *oldsc,char *name,int unienc, char *comment) {</span>
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :     SplineFont *sf = oldsc-&gt;parent;</span>
<span class="lineNum">    1257 </span>            :     int i;
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :     int isnotdef, samename=false, sameuni=false;</span>
<span class="lineNum">    1259 </span>            :     struct altuni *alt;
<span class="lineNum">    1260 </span><span class="lineNoCov">          0 :     SplineChar *newsc = ci-&gt;cachedsc;</span>
<span class="lineNum">    1261 </span>            :     struct splinecharlist *scl, *baduniscl, *badnamescl;
<span class="lineNum">    1262 </span>            :     SplineChar *baduni, *badname;
<span class="lineNum">    1263 </span>            : 
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 :     for ( alt=oldsc-&gt;altuni; alt!=NULL &amp;&amp; (alt-&gt;unienc!=unienc || alt-&gt;vs!=-1 || alt-&gt;fid!=0); alt=alt-&gt;next );</span>
<span class="lineNum">    1265 </span><span class="lineNoCov">          0 :     if ( unienc==oldsc-&gt;unicodeenc || alt!=NULL )</span>
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :         sameuni=true;</span>
<span class="lineNum">    1267 </span><span class="lineNoCov">          0 :     samename = ( oldsc-&gt;name!=NULL &amp;&amp; strcmp(name,oldsc-&gt;name)==0 );</span>
<span class="lineNum">    1268 </span>            :     
<span class="lineNum">    1269 </span><span class="lineNoCov">          0 :     isnotdef = strcmp(name,&quot;.notdef&quot;)==0;</span>
<span class="lineNum">    1270 </span><span class="lineNoCov">          0 :     if (( !sameuni &amp;&amp; unienc!=-1) || (!samename &amp;&amp; !isnotdef) ) {</span>
<span class="lineNum">    1271 </span><span class="lineNoCov">          0 :         baduniscl = badnamescl = NULL;</span>
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 :         baduni = badname = NULL;</span>
<span class="lineNum">    1273 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;sf-&gt;glyphcnt; ++i ) if ( sf-&gt;glyphs[i]!=NULL &amp;&amp; sf-&gt;glyphs[i]!=ci-&gt;sc ) {</span>
<span class="lineNum">    1274 </span><span class="lineNoCov">          0 :             if ( unienc!=-1 &amp;&amp; sf-&gt;glyphs[i]-&gt;unicodeenc==unienc ) {</span>
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :                 for ( scl=ci-&gt;changes; scl!=NULL &amp;&amp; scl-&gt;sc-&gt;orig_pos!=i; scl = scl-&gt;next );</span>
<span class="lineNum">    1276 </span><span class="lineNoCov">          0 :                 if ( scl==NULL ) {</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">          0 :                     baduni = sf-&gt;glyphs[i];</span>
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 :                     baduniscl = NULL;</span>
<span class="lineNum">    1279 </span><span class="lineNoCov">          0 :                 } else if ( scl-&gt;sc-&gt;unicodeenc==unienc ) {</span>
<span class="lineNum">    1280 </span><span class="lineNoCov">          0 :                     baduni = scl-&gt;sc;</span>
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :                     baduniscl = scl;</span>
<span class="lineNum">    1282 </span>            :                 }
<span class="lineNum">    1283 </span>            :             }
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :             if ( !isnotdef &amp;&amp; strcmp(name,sf-&gt;glyphs[i]-&gt;name )==0 ) {</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :                 for ( scl=ci-&gt;changes; scl!=NULL &amp;&amp; scl-&gt;sc-&gt;orig_pos!=i; scl = scl-&gt;next );</span>
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :                 if ( scl==NULL ) {</span>
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :                     badname = sf-&gt;glyphs[i];</span>
<span class="lineNum">    1288 </span><span class="lineNoCov">          0 :                     badnamescl = NULL;</span>
<span class="lineNum">    1289 </span><span class="lineNoCov">          0 :                 } else if ( strcmp(scl-&gt;sc-&gt;name,name)==0 ) {</span>
<span class="lineNum">    1290 </span><span class="lineNoCov">          0 :                     badname = scl-&gt;sc;</span>
<span class="lineNum">    1291 </span><span class="lineNoCov">          0 :                     badnamescl = scl;</span>
<span class="lineNum">    1292 </span>            :                 }
<span class="lineNum">    1293 </span>            :             }
<span class="lineNum">    1294 </span>            :         }
<span class="lineNum">    1295 </span><span class="lineNoCov">          0 :         for ( scl=ci-&gt;changes; scl!=NULL ; scl = scl-&gt;next ) if ( scl-&gt;sc!=newsc ) {</span>
<span class="lineNum">    1296 </span><span class="lineNoCov">          0 :             if ( unienc!=-1 &amp;&amp; scl-&gt;sc-&gt;unicodeenc==unienc ) {</span>
<span class="lineNum">    1297 </span><span class="lineNoCov">          0 :                 baduni = scl-&gt;sc;</span>
<span class="lineNum">    1298 </span><span class="lineNoCov">          0 :                 baduniscl = scl;</span>
<span class="lineNum">    1299 </span>            :             }
<span class="lineNum">    1300 </span><span class="lineNoCov">          0 :             if ( !isnotdef &amp;&amp; strcmp(scl-&gt;sc-&gt;name,name)==0 ) {</span>
<span class="lineNum">    1301 </span><span class="lineNoCov">          0 :                 badname = scl-&gt;sc;</span>
<span class="lineNum">    1302 </span><span class="lineNoCov">          0 :                 badnamescl = scl;</span>
<span class="lineNum">    1303 </span>            :             }
<span class="lineNum">    1304 </span>            :         }
<span class="lineNum">    1305 </span><span class="lineNoCov">          0 :         if ( baduni!=NULL || badname!=NULL ) {</span>
<span class="lineNum">    1306 </span>            :             char *buts[3];
<span class="lineNum">    1307 </span><span class="lineNoCov">          0 :             buts[0] = _(&quot;_Yes&quot;); buts[1]=_(&quot;_Cancel&quot;); buts[2] = NULL;</span>
<span class="lineNum">    1308 </span><span class="lineNoCov">          0 :             if ( badname==baduni ) {</span>
<span class="lineNum">    1309 </span><span class="lineNoCov">          0 :                 if ( ff_ask(_(&quot;Multiple&quot;),(const char **) buts,0,1,_(&quot;There is already a glyph with this name and encoding,\nboth must be unique within a font,\ndo you want to swap them?&quot;))==1 )</span>
<span class="lineNum">    1310 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1311 </span>            :                 /* If we're going to swap, then add the swapee to the list of */
<span class="lineNum">    1312 </span>            :                 /*  things that need changing */
<span class="lineNum">    1313 </span><span class="lineNoCov">          0 :                 if ( baduniscl==NULL ) {</span>
<span class="lineNum">    1314 </span><span class="lineNoCov">          0 :                     baduni = CI_SCDuplicate(baduni);</span>
<span class="lineNum">    1315 </span><span class="lineNoCov">          0 :                     baduniscl = chunkalloc(sizeof(struct splinecharlist));</span>
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :                     baduniscl-&gt;sc = baduni;</span>
<span class="lineNum">    1317 </span><span class="lineNoCov">          0 :                     baduniscl-&gt;next = ci-&gt;changes;</span>
<span class="lineNum">    1318 </span><span class="lineNoCov">          0 :                     ci-&gt;changes = baduniscl;</span>
<span class="lineNum">    1319 </span>            :                 }
<span class="lineNum">    1320 </span><span class="lineNoCov">          0 :                 baduni-&gt;unicodeenc = oldsc-&gt;unicodeenc;</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :                 free(baduni-&gt;name); baduni-&gt;name = copy(oldsc-&gt;name);</span>
<span class="lineNum">    1322 </span>            :             } else {
<span class="lineNum">    1323 </span><span class="lineNoCov">          0 :                 if ( baduni!=NULL ) {</span>
<span class="lineNum">    1324 </span><span class="lineNoCov">          0 :                     if ( ff_ask(_(&quot;Multiple&quot;),(const char **) buts,0,1,_(&quot;There is already a glyph with this encoding,\nwhich must be unique within a font,\ndo you want to swap the encodings of the two?&quot;))==1 )</span>
<span class="lineNum">    1325 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :                     if ( baduniscl==NULL ) {</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :                         baduni = CI_SCDuplicate(baduni);</span>
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 :                         baduniscl = chunkalloc(sizeof(struct splinecharlist));</span>
<span class="lineNum">    1329 </span><span class="lineNoCov">          0 :                         baduniscl-&gt;sc = baduni;</span>
<span class="lineNum">    1330 </span><span class="lineNoCov">          0 :                         baduniscl-&gt;next = ci-&gt;changes;</span>
<span class="lineNum">    1331 </span><span class="lineNoCov">          0 :                         ci-&gt;changes = baduniscl;</span>
<span class="lineNum">    1332 </span>            :                     }
<span class="lineNum">    1333 </span><span class="lineNoCov">          0 :                     baduni-&gt;unicodeenc = oldsc-&gt;unicodeenc;</span>
<span class="lineNum">    1334 </span>            :                 }
<span class="lineNum">    1335 </span><span class="lineNoCov">          0 :                 if ( badname!=NULL ) {</span>
<span class="lineNum">    1336 </span><span class="lineNoCov">          0 :                     if ( ff_ask(_(&quot;Multiple&quot;),(const char **) buts,0,1,_(&quot;There is already a glyph with this name,\nwhich must be unique within a font,\ndo you want to swap the names of the two?&quot;))==1 )</span>
<span class="lineNum">    1337 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">          0 :                     if ( badnamescl==NULL ) {</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 :                         badname = CI_SCDuplicate(badname);</span>
<span class="lineNum">    1340 </span><span class="lineNoCov">          0 :                         badnamescl = chunkalloc(sizeof(struct splinecharlist));</span>
<span class="lineNum">    1341 </span><span class="lineNoCov">          0 :                         badnamescl-&gt;sc = badname;</span>
<span class="lineNum">    1342 </span><span class="lineNoCov">          0 :                         badnamescl-&gt;next = ci-&gt;changes;</span>
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 :                         ci-&gt;changes = badnamescl;</span>
<span class="lineNum">    1344 </span>            :                     }
<span class="lineNum">    1345 </span><span class="lineNoCov">          0 :                     free(badname-&gt;name); badname-&gt;name = copy(oldsc-&gt;name);</span>
<span class="lineNum">    1346 </span>            :                 }
<span class="lineNum">    1347 </span>            :             }
<span class="lineNum">    1348 </span>            :         }
<span class="lineNum">    1349 </span>            :     }
<span class="lineNum">    1350 </span><span class="lineNoCov">          0 :     if ( !samename )</span>
<span class="lineNum">    1351 </span><span class="lineNoCov">          0 :         ci-&gt;name_change = true;</span>
<span class="lineNum">    1352 </span><span class="lineNoCov">          0 :     if ( !sameuni )</span>
<span class="lineNum">    1353 </span><span class="lineNoCov">          0 :         ci-&gt;uni_change = true;</span>
<span class="lineNum">    1354 </span><span class="lineNoCov">          0 :     free( newsc-&gt;name ); free( newsc-&gt;comment );</span>
<span class="lineNum">    1355 </span><span class="lineNoCov">          0 :     newsc-&gt;name = copy( name );</span>
<span class="lineNum">    1356 </span><span class="lineNoCov">          0 :     newsc-&gt;unicodeenc = unienc;</span>
<span class="lineNum">    1357 </span><span class="lineNoCov">          0 :     newsc-&gt;comment = copy( comment );</span>
<span class="lineNum">    1358 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1359"><span class="lineNum">    1359 </span>            : }</a>
<span class="lineNum">    1360 </span>            : 
<span class="lineNum">    1361 </span><span class="lineNoCov">          0 : static int _CI_OK(CharInfo *ci) {</span>
<span class="lineNum">    1362 </span>            :     int val;
<span class="lineNum">    1363 </span>            :     int ret;
<span class="lineNum">    1364 </span>            :     char *name, *comment;
<span class="lineNum">    1365 </span>            :     const unichar_t *nm;
<span class="lineNum">    1366 </span><span class="lineNoCov">          0 :     int err = false;</span>
<span class="lineNum">    1367 </span>            :     int tex_height, tex_depth, italic, topaccent;
<span class="lineNum">    1368 </span>            :     int hic, vic;
<span class="lineNum">    1369 </span><span class="lineNoCov">          0 :     int lc_cnt=-1;</span>
<span class="lineNum">    1370 </span><span class="lineNoCov">          0 :     char *italicdevtab=NULL, *accentdevtab=NULL, *hicdt=NULL, *vicdt=NULL;</span>
<span class="lineNum">    1371 </span><span class="lineNoCov">          0 :     int lig_caret_cnt_fixed=0;</span>
<span class="lineNum">    1372 </span>            :     int low,high;
<span class="lineNum">    1373 </span><span class="lineNoCov">          0 :     real tile_margin=0;</span>
<span class="lineNum">    1374 </span>            :     DBounds tileb;
<span class="lineNum">    1375 </span><span class="lineNoCov">          0 :     SplineChar *oldsc = ci-&gt;cachedsc==NULL ? ci-&gt;sc : ci-&gt;cachedsc;</span>
<span class="lineNum">    1376 </span>            : 
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :     if ( !CI_ValidateAltUnis(ci))</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1379 </span>            : 
<span class="lineNum">    1380 </span><span class="lineNoCov">          0 :     val = ParseUValue(ci-&gt;gw,CID_UValue,true);</span>
<span class="lineNum">    1381 </span><span class="lineNoCov">          0 :     if ( val==-2 )</span>
<span class="lineNum">    1382 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1383 </span><span class="lineNoCov">          0 :     tex_height = gettex(ci-&gt;gw,CID_TeX_Height,_(&quot;Height&quot;),&amp;err);</span>
<span class="lineNum">    1384 </span><span class="lineNoCov">          0 :     tex_depth  = gettex(ci-&gt;gw,CID_TeX_Depth ,_(&quot;Depth&quot;) ,&amp;err);</span>
<span class="lineNum">    1385 </span><span class="lineNoCov">          0 :     italic     = gettex(ci-&gt;gw,CID_TeX_Italic,_(&quot;Italic Correction&quot;),&amp;err);</span>
<span class="lineNum">    1386 </span><span class="lineNoCov">          0 :     topaccent  = gettex(ci-&gt;gw,CID_HorAccent,_(&quot;Top Accent Horizontal Pos&quot;),&amp;err);</span>
<span class="lineNum">    1387 </span><span class="lineNoCov">          0 :     if ( err )</span>
<span class="lineNum">    1388 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1389 </span><span class="lineNoCov">          0 :     hic = GetInt8(ci-&gt;gw,CID_ExtItalicCor+1*100,_(&quot;Horizontal Extension Italic Correction&quot;),&amp;err);</span>
<span class="lineNum">    1390 </span><span class="lineNoCov">          0 :     vic = GetInt8(ci-&gt;gw,CID_ExtItalicCor+0*100,_(&quot;Vertical Extension Italic Correction&quot;),&amp;err);</span>
<span class="lineNum">    1391 </span><span class="lineNoCov">          0 :     if ( err )</span>
<span class="lineNum">    1392 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1393 </span>            : 
<span class="lineNum">    1394 </span><span class="lineNoCov">          0 :     memset(&amp;tileb,0,sizeof(tileb));</span>
<span class="lineNum">    1395 </span><span class="lineNoCov">          0 :     if ( ci-&gt;sc-&gt;parent-&gt;multilayer ) {</span>
<span class="lineNum">    1396 </span><span class="lineNoCov">          0 :         if ( GGadgetIsChecked(GWidgetGetControl(ci-&gt;gw,CID_IsTileMargin)))</span>
<span class="lineNum">    1397 </span><span class="lineNoCov">          0 :             tile_margin = GetReal8(ci-&gt;gw,CID_TileMargin,_(&quot;Tile Margin&quot;),&amp;err);</span>
<span class="lineNum">    1398 </span>            :         else {
<span class="lineNum">    1399 </span><span class="lineNoCov">          0 :             tileb.minx = GetReal8(ci-&gt;gw,CID_TileBBoxMinX,_(&quot;Tile Min X&quot;),&amp;err);</span>
<span class="lineNum">    1400 </span><span class="lineNoCov">          0 :             tileb.miny = GetReal8(ci-&gt;gw,CID_TileBBoxMinY,_(&quot;Tile Min Y&quot;),&amp;err);</span>
<span class="lineNum">    1401 </span><span class="lineNoCov">          0 :             tileb.maxx = GetReal8(ci-&gt;gw,CID_TileBBoxMaxX,_(&quot;Tile Max X&quot;),&amp;err);</span>
<span class="lineNum">    1402 </span><span class="lineNoCov">          0 :             tileb.maxy = GetReal8(ci-&gt;gw,CID_TileBBoxMaxY,_(&quot;Tile Max Y&quot;),&amp;err);</span>
<span class="lineNum">    1403 </span>            :         }
<span class="lineNum">    1404 </span><span class="lineNoCov">          0 :         if ( err )</span>
<span class="lineNum">    1405 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1406 </span>            :     }
<span class="lineNum">    1407 </span>            : 
<span class="lineNum">    1408 </span><span class="lineNoCov">          0 :     lig_caret_cnt_fixed = !GGadgetIsChecked(GWidgetGetControl(ci-&gt;gw,CID_DefLCCount));</span>
<span class="lineNum">    1409 </span><span class="lineNoCov">          0 :     if ( ci-&gt;lc_seen ) {</span>
<span class="lineNum">    1410 </span><span class="lineNoCov">          0 :         lc_cnt = GetInt8(ci-&gt;gw,CID_LCCount,_(&quot;Ligature Caret Count&quot;),&amp;err);</span>
<span class="lineNum">    1411 </span><span class="lineNoCov">          0 :         if ( err )</span>
<span class="lineNum">    1412 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1413 </span><span class="lineNoCov">          0 :         if ( lc_cnt&lt;0 || lc_cnt&gt;100 ) {</span>
<span class="lineNum">    1414 </span><span class="lineNoCov">          0 :             ff_post_error(_(&quot;Bad Lig. Caret Count&quot;),_(&quot;Unreasonable ligature caret count&quot;));</span>
<span class="lineNum">    1415 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1416 </span>            :         }
<span class="lineNum">    1417 </span>            :     }
<span class="lineNum">    1418 </span><span class="lineNoCov">          0 :     nm = _GGadgetGetTitle(GWidgetGetControl(ci-&gt;gw,CID_UName));</span>
<span class="lineNum">    1419 </span><span class="lineNoCov">          0 :     if ( !CI_NameCheck(nm) )</span>
<span class="lineNum">    1420 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1421 </span>            : 
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 :     italicdevtab = GGadgetGetTitle8(GWidgetGetControl(ci-&gt;gw,CID_ItalicDevTab));</span>
<span class="lineNum">    1423 </span><span class="lineNoCov">          0 :     accentdevtab = GGadgetGetTitle8(GWidgetGetControl(ci-&gt;gw,CID_AccentDevTab));</span>
<span class="lineNum">    1424 </span><span class="lineNoCov">          0 :     hicdt = GGadgetGetTitle8(GWidgetGetControl(ci-&gt;gw,CID_ExtItalicDev+1*100));</span>
<span class="lineNum">    1425 </span><span class="lineNoCov">          0 :     vicdt = GGadgetGetTitle8(GWidgetGetControl(ci-&gt;gw,CID_ExtItalicDev+0*100));</span>
<span class="lineNum">    1426 </span><span class="lineNoCov">          0 :     if ( !DeviceTableOK(italicdevtab,&amp;low,&amp;high) || !DeviceTableOK(accentdevtab,&amp;low,&amp;high) ||</span>
<span class="lineNum">    1427 </span><span class="lineNoCov">          0 :             !DeviceTableOK(hicdt,&amp;low,&amp;high) || !DeviceTableOK(vicdt,&amp;low,&amp;high)) {</span>
<span class="lineNum">    1428 </span><span class="lineNoCov">          0 :         ff_post_error( _(&quot;Bad Device Table Adjustment&quot;),_(&quot;A device table adjustment specified for the MATH table is invalid&quot;) );</span>
<span class="lineNum">    1429 </span><span class="lineNoCov">          0 :         free( accentdevtab );</span>
<span class="lineNum">    1430 </span><span class="lineNoCov">          0 :         free( italicdevtab );</span>
<span class="lineNum">    1431 </span><span class="lineNoCov">          0 :         free(hicdt); free(vicdt);</span>
<span class="lineNum">    1432 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1433 </span>            :     }
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :     if ( ci-&gt;cachedsc==NULL ) {</span>
<span class="lineNum">    1435 </span>            :         struct splinecharlist *scl;
<span class="lineNum">    1436 </span><span class="lineNoCov">          0 :         ci-&gt;cachedsc = chunkalloc(sizeof(SplineChar));</span>
<span class="lineNum">    1437 </span><span class="lineNoCov">          0 :         ci-&gt;cachedsc-&gt;orig_pos = ci-&gt;sc-&gt;orig_pos;</span>
<span class="lineNum">    1438 </span><span class="lineNoCov">          0 :         ci-&gt;cachedsc-&gt;parent = ci-&gt;sc-&gt;parent;</span>
<span class="lineNum">    1439 </span><span class="lineNoCov">          0 :         scl = chunkalloc(sizeof(struct splinecharlist));</span>
<span class="lineNum">    1440 </span><span class="lineNoCov">          0 :         scl-&gt;sc = ci-&gt;cachedsc;</span>
<span class="lineNum">    1441 </span><span class="lineNoCov">          0 :         scl-&gt;next = ci-&gt;changes;</span>
<span class="lineNum">    1442 </span><span class="lineNoCov">          0 :         ci-&gt;changes = scl;</span>
<span class="lineNum">    1443 </span>            :     }
<span class="lineNum">    1444 </span>            :     /* CI_ProcessPosSubs is the first thing which might change anything real */
<span class="lineNum">    1445 </span><span class="lineNoCov">          0 :     if ( !CI_ProcessPosSubs(ci)) {</span>
<span class="lineNum">    1446 </span><span class="lineNoCov">          0 :         free( accentdevtab );</span>
<span class="lineNum">    1447 </span><span class="lineNoCov">          0 :         free( italicdevtab );</span>
<span class="lineNum">    1448 </span><span class="lineNoCov">          0 :         free(hicdt); free(vicdt);</span>
<span class="lineNum">    1449 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1450 </span>            :     }
<span class="lineNum">    1451 </span><span class="lineNoCov">          0 :     name = u2utf8_copy( nm );</span>
<span class="lineNum">    1452 </span><span class="lineNoCov">          0 :     comment = GGadgetGetTitle8(GWidgetGetControl(ci-&gt;gw,CID_Comment));</span>
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :     if ( comment!=NULL &amp;&amp; *comment=='\0' ) {</span>
<span class="lineNum">    1454 </span><span class="lineNoCov">          0 :         free(comment);</span>
<span class="lineNum">    1455 </span><span class="lineNoCov">          0 :         comment=NULL;</span>
<span class="lineNum">    1456 </span>            :     }
<span class="lineNum">    1457 </span><span class="lineNoCov">          0 :     ret = CI_CheckMetaData(ci,oldsc,name,val,comment);</span>
<span class="lineNum">    1458 </span><span class="lineNoCov">          0 :     free(name); free(comment);</span>
<span class="lineNum">    1459 </span><span class="lineNoCov">          0 :     if ( !ret ) {</span>
<span class="lineNum">    1460 </span><span class="lineNoCov">          0 :         free( accentdevtab );</span>
<span class="lineNum">    1461 </span><span class="lineNoCov">          0 :         free( italicdevtab );</span>
<span class="lineNum">    1462 </span><span class="lineNoCov">          0 :         free(hicdt); free(vicdt);</span>
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1464 </span>            :     }
<span class="lineNum">    1465 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;unlink_rm_ovrlp_save_undo = GGadgetIsChecked(GWidgetGetControl(ci-&gt;gw,CID_UnlinkRmOverlap));</span>
<span class="lineNum">    1466 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;glyph_class = GGadgetGetFirstListSelectedItem(GWidgetGetControl(ci-&gt;gw,CID_GClass));</span>
<span class="lineNum">    1467 </span><span class="lineNoCov">          0 :     val = GGadgetGetFirstListSelectedItem(GWidgetGetControl(ci-&gt;gw,CID_Color));</span>
<span class="lineNum">    1468 </span><span class="lineNoCov">          0 :     if ( val!=-1 )</span>
<span class="lineNum">    1469 </span><span class="lineNoCov">          0 :         ci-&gt;cachedsc-&gt;color = (intpt) (std_colors[val].userdata);</span>
<span class="lineNum">    1470 </span><span class="lineNoCov">          0 :     CI_ParseCounters(ci);</span>
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;tex_height = tex_height;</span>
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;tex_depth  = tex_depth;</span>
<span class="lineNum">    1473 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;italic_correction = italic;</span>
<span class="lineNum">    1474 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;top_accent_horiz = topaccent;</span>
<span class="lineNum">    1475 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;is_extended_shape = GGadgetIsChecked(GWidgetGetControl(ci-&gt;gw,CID_IsExtended));</span>
<span class="lineNum">    1476 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;italic_adjusts = DeviceTableParse(ci-&gt;cachedsc-&gt;italic_adjusts,italicdevtab);</span>
<span class="lineNum">    1477 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;top_accent_adjusts = DeviceTableParse(ci-&gt;cachedsc-&gt;top_accent_adjusts,accentdevtab);</span>
<span class="lineNum">    1478 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;horiz_variants = CI_ParseVariants(ci-&gt;cachedsc-&gt;horiz_variants,ci,1,hicdt,hic,false);</span>
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;vert_variants  = CI_ParseVariants(ci-&gt;cachedsc-&gt;vert_variants ,ci,0,vicdt,vic,false);</span>
<span class="lineNum">    1480 </span>            : 
<span class="lineNum">    1481 </span><span class="lineNoCov">          0 :     free( accentdevtab );</span>
<span class="lineNum">    1482 </span><span class="lineNoCov">          0 :     free( italicdevtab );</span>
<span class="lineNum">    1483 </span><span class="lineNoCov">          0 :     free(hicdt); free(vicdt);</span>
<span class="lineNum">    1484 </span>            : 
<span class="lineNum">    1485 </span><span class="lineNoCov">          0 :     CI_ParseAltUnis(ci);</span>
<span class="lineNum">    1486 </span>            : 
<span class="lineNum">    1487 </span><span class="lineNoCov">          0 :     if ( ci-&gt;lc_seen ) {</span>
<span class="lineNum">    1488 </span><span class="lineNoCov">          0 :         PST *pst, *prev=NULL;</span>
<span class="lineNum">    1489 </span>            :         int i;
<span class="lineNum">    1490 </span><span class="lineNoCov">          0 :         ci-&gt;cachedsc-&gt;lig_caret_cnt_fixed = lig_caret_cnt_fixed;</span>
<span class="lineNum">    1491 </span><span class="lineNoCov">          0 :         for ( pst = ci-&gt;cachedsc-&gt;possub; pst!=NULL &amp;&amp; pst-&gt;type!=pst_lcaret; pst=pst-&gt;next )</span>
<span class="lineNum">    1492 </span><span class="lineNoCov">          0 :             prev = pst;</span>
<span class="lineNum">    1493 </span><span class="lineNoCov">          0 :         if ( pst==NULL &amp;&amp; lc_cnt==0 )</span>
<span class="lineNum">    1494 </span>            :             /* Nothing to do */;
<span class="lineNum">    1495 </span><span class="lineNoCov">          0 :         else if ( pst!=NULL &amp;&amp; lc_cnt==0 ) {</span>
<span class="lineNum">    1496 </span><span class="lineNoCov">          0 :             if ( prev==NULL )</span>
<span class="lineNum">    1497 </span><span class="lineNoCov">          0 :                 ci-&gt;cachedsc-&gt;possub = pst-&gt;next;</span>
<span class="lineNum">    1498 </span>            :             else
<span class="lineNum">    1499 </span><span class="lineNoCov">          0 :                 prev-&gt;next = pst-&gt;next;</span>
<span class="lineNum">    1500 </span><span class="lineNoCov">          0 :             pst-&gt;next = NULL;</span>
<span class="lineNum">    1501 </span><span class="lineNoCov">          0 :             PSTFree(pst);</span>
<span class="lineNum">    1502 </span>            :         } else {
<span class="lineNum">    1503 </span><span class="lineNoCov">          0 :             if ( pst==NULL ) {</span>
<span class="lineNum">    1504 </span><span class="lineNoCov">          0 :                 pst = chunkalloc(sizeof(PST));</span>
<span class="lineNum">    1505 </span><span class="lineNoCov">          0 :                 pst-&gt;type = pst_lcaret;</span>
<span class="lineNum">    1506 </span><span class="lineNoCov">          0 :                 pst-&gt;next = ci-&gt;sc-&gt;possub;</span>
<span class="lineNum">    1507 </span><span class="lineNoCov">          0 :                 ci-&gt;cachedsc-&gt;possub = pst;</span>
<span class="lineNum">    1508 </span>            :             }
<span class="lineNum">    1509 </span><span class="lineNoCov">          0 :             if ( lc_cnt&gt;pst-&gt;u.lcaret.cnt )</span>
<span class="lineNum">    1510 </span><span class="lineNoCov">          0 :                 pst-&gt;u.lcaret.carets = realloc(pst-&gt;u.lcaret.carets,lc_cnt*sizeof(int16));</span>
<span class="lineNum">    1511 </span><span class="lineNoCov">          0 :             for ( i=pst-&gt;u.lcaret.cnt; i&lt;lc_cnt; ++i )</span>
<span class="lineNum">    1512 </span><span class="lineNoCov">          0 :                 pst-&gt;u.lcaret.carets[i] = 0;</span>
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 :             pst-&gt;u.lcaret.cnt = lc_cnt;</span>
<span class="lineNum">    1514 </span>            :         }
<span class="lineNum">    1515 </span>            :     }
<span class="lineNum">    1516 </span>            : 
<span class="lineNum">    1517 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;tile_margin = tile_margin;</span>
<span class="lineNum">    1518 </span><span class="lineNoCov">          0 :     ci-&gt;cachedsc-&gt;tile_bounds = tileb;</span>
<span class="lineNum">    1519 </span>            : 
<span class="lineNum">    1520 </span><span class="lineNoCov">          0 : return( ret );</span>
<a name="1521"><span class="lineNum">    1521 </span>            : }</a>
<span class="lineNum">    1522 </span>            : 
<span class="lineNum">    1523 </span><span class="lineNoCov">          0 : static void CI_ApplyAll(CharInfo *ci) {</span>
<span class="lineNum">    1524 </span><span class="lineNoCov">          0 :     int refresh_fvdi = false;</span>
<span class="lineNum">    1525 </span>            :     struct splinecharlist *scl;
<span class="lineNum">    1526 </span>            :     SplineChar *cached, *sc;
<span class="lineNum">    1527 </span><span class="lineNoCov">          0 :     SplineFont *sf = ci-&gt;sc-&gt;parent;</span>
<span class="lineNum">    1528 </span>            :     FontView *fvs;
<span class="lineNum">    1529 </span>            : 
<span class="lineNum">    1530 </span><span class="lineNoCov">          0 :     for ( scl = ci-&gt;changes; scl!=NULL; scl=scl-&gt;next ) {</span>
<span class="lineNum">    1531 </span><span class="lineNoCov">          0 :         cached = scl-&gt;sc;</span>
<span class="lineNum">    1532 </span><span class="lineNoCov">          0 :         sc = sf-&gt;glyphs[cached-&gt;orig_pos];</span>
<span class="lineNum">    1533 </span><span class="lineNoCov">          0 :         SCPreserveState(sc,2);</span>
<span class="lineNum">    1534 </span><span class="lineNoCov">          0 :         if ( strcmp(cached-&gt;name,sc-&gt;name)!=0 || cached-&gt;unicodeenc!=sc-&gt;unicodeenc )</span>
<span class="lineNum">    1535 </span><span class="lineNoCov">          0 :             refresh_fvdi = 1;</span>
<span class="lineNum">    1536 </span><span class="lineNoCov">          0 :         if ( sc-&gt;name==NULL || strcmp( sc-&gt;name,cached-&gt;name )!=0 ) {</span>
<span class="lineNum">    1537 </span><span class="lineNoCov">          0 :             if ( sc-&gt;name!=NULL )</span>
<span class="lineNum">    1538 </span><span class="lineNoCov">          0 :                 SFGlyphRenameFixup(sf,sc-&gt;name,cached-&gt;name,false);</span>
<span class="lineNum">    1539 </span><span class="lineNoCov">          0 :             free(sc-&gt;name); sc-&gt;name = copy(cached-&gt;name);</span>
<span class="lineNum">    1540 </span><span class="lineNoCov">          0 :             sc-&gt;namechanged = true;</span>
<span class="lineNum">    1541 </span><span class="lineNoCov">          0 :             GlyphHashFree(sf);</span>
<span class="lineNum">    1542 </span>            :         }
<span class="lineNum">    1543 </span><span class="lineNoCov">          0 :         if ( sc-&gt;unicodeenc != cached-&gt;unicodeenc ) {</span>
<span class="lineNum">    1544 </span>            :             struct splinecharlist *scl;
<span class="lineNum">    1545 </span>            :             int layer;
<span class="lineNum">    1546 </span>            :             RefChar *ref;
<span class="lineNum">    1547 </span>            :             struct altuni *alt;
<span class="lineNum">    1548 </span>            : 
<span class="lineNum">    1549 </span>            :             /* All references need the new unicode value */
<span class="lineNum">    1550 </span><span class="lineNoCov">          0 :             for ( scl=sc-&gt;dependents; scl!=NULL; scl=scl-&gt;next ) {</span>
<span class="lineNum">    1551 </span><span class="lineNoCov">          0 :                 for ( layer=ly_back; layer&lt;scl-&gt;sc-&gt;layer_cnt; ++layer )</span>
<span class="lineNum">    1552 </span><span class="lineNoCov">          0 :                     for ( ref = scl-&gt;sc-&gt;layers[layer].refs; ref!=NULL; ref=ref-&gt;next )</span>
<span class="lineNum">    1553 </span><span class="lineNoCov">          0 :                         if ( ref-&gt;sc==sc )</span>
<span class="lineNum">    1554 </span><span class="lineNoCov">          0 :                             ref-&gt;unicode_enc = cached-&gt;unicodeenc;</span>
<span class="lineNum">    1555 </span>            :             }
<span class="lineNum">    1556 </span>            :             /* If the current unicode enc were in the list of alt unis */
<span class="lineNum">    1557 </span>            :             /*  the user might have forgotten to remove it. So if s/he did */
<span class="lineNum">    1558 </span>            :             /*  forget, swap the altuni value with the old value */
<span class="lineNum">    1559 </span><span class="lineNoCov">          0 :             for ( alt=cached-&gt;altuni; alt!=NULL &amp;&amp; (alt-&gt;unienc!=cached-&gt;unicodeenc || alt-&gt;vs!=-1 || alt-&gt;fid!=0); alt=alt-&gt;next );</span>
<span class="lineNum">    1560 </span><span class="lineNoCov">          0 :             if ( alt!=NULL )    /* alt-&gt;unienc==new value */</span>
<span class="lineNum">    1561 </span><span class="lineNoCov">          0 :                 alt-&gt;unienc = sc-&gt;unicodeenc;</span>
<span class="lineNum">    1562 </span><span class="lineNoCov">          0 :             sc-&gt;unicodeenc = cached-&gt;unicodeenc;</span>
<span class="lineNum">    1563 </span>            :         }
<span class="lineNum">    1564 </span><span class="lineNoCov">          0 :         free(sc-&gt;comment); sc-&gt;comment = copy(cached-&gt;comment);</span>
<span class="lineNum">    1565 </span><span class="lineNoCov">          0 :         sc-&gt;unlink_rm_ovrlp_save_undo = cached-&gt;unlink_rm_ovrlp_save_undo;</span>
<span class="lineNum">    1566 </span><span class="lineNoCov">          0 :         sc-&gt;glyph_class = cached-&gt;glyph_class;</span>
<span class="lineNum">    1567 </span><span class="lineNoCov">          0 :         if ( sc-&gt;color != cached-&gt;color )</span>
<span class="lineNum">    1568 </span><span class="lineNoCov">          0 :             refresh_fvdi = true;</span>
<span class="lineNum">    1569 </span><span class="lineNoCov">          0 :         sc-&gt;color = cached-&gt;color;</span>
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 :         free(sc-&gt;countermasks);</span>
<span class="lineNum">    1571 </span><span class="lineNoCov">          0 :         sc-&gt;countermask_cnt = cached-&gt;countermask_cnt;</span>
<span class="lineNum">    1572 </span><span class="lineNoCov">          0 :         sc-&gt;countermasks = cached-&gt;countermasks;</span>
<span class="lineNum">    1573 </span><span class="lineNoCov">          0 :         cached-&gt;countermasks = NULL; cached-&gt;countermask_cnt = 0;</span>
<span class="lineNum">    1574 </span><span class="lineNoCov">          0 :         sc-&gt;tex_height = cached-&gt;tex_height;</span>
<span class="lineNum">    1575 </span><span class="lineNoCov">          0 :         sc-&gt;tex_depth  = cached-&gt;tex_depth;</span>
<span class="lineNum">    1576 </span><span class="lineNoCov">          0 :         sc-&gt;italic_correction = cached-&gt;italic_correction;</span>
<span class="lineNum">    1577 </span><span class="lineNoCov">          0 :         sc-&gt;top_accent_horiz = cached-&gt;top_accent_horiz;</span>
<span class="lineNum">    1578 </span><span class="lineNoCov">          0 :         sc-&gt;is_extended_shape = cached-&gt;is_extended_shape;</span>
<span class="lineNum">    1579 </span><span class="lineNoCov">          0 :         DeviceTableFree(sc-&gt;italic_adjusts);</span>
<span class="lineNum">    1580 </span><span class="lineNoCov">          0 :         DeviceTableFree(sc-&gt;top_accent_adjusts);</span>
<span class="lineNum">    1581 </span><span class="lineNoCov">          0 :         sc-&gt;italic_adjusts = cached-&gt;italic_adjusts;</span>
<span class="lineNum">    1582 </span><span class="lineNoCov">          0 :         sc-&gt;top_accent_adjusts = cached-&gt;top_accent_adjusts;</span>
<span class="lineNum">    1583 </span><span class="lineNoCov">          0 :         cached-&gt;italic_adjusts = cached-&gt;top_accent_adjusts = NULL;</span>
<span class="lineNum">    1584 </span><span class="lineNoCov">          0 :         GlyphVariantsFree(sc-&gt;horiz_variants);</span>
<span class="lineNum">    1585 </span><span class="lineNoCov">          0 :         GlyphVariantsFree(sc-&gt;vert_variants);</span>
<span class="lineNum">    1586 </span><span class="lineNoCov">          0 :         sc-&gt;horiz_variants = cached-&gt;horiz_variants;</span>
<span class="lineNum">    1587 </span><span class="lineNoCov">          0 :         sc-&gt;vert_variants = cached-&gt;vert_variants;</span>
<span class="lineNum">    1588 </span><span class="lineNoCov">          0 :         cached-&gt;horiz_variants = cached-&gt;vert_variants = NULL;</span>
<span class="lineNum">    1589 </span><span class="lineNoCov">          0 :         AltUniFree(sc-&gt;altuni);</span>
<span class="lineNum">    1590 </span><span class="lineNoCov">          0 :         sc-&gt;altuni = cached-&gt;altuni;</span>
<span class="lineNum">    1591 </span><span class="lineNoCov">          0 :         cached-&gt;altuni = NULL;</span>
<span class="lineNum">    1592 </span><span class="lineNoCov">          0 :         sc-&gt;lig_caret_cnt_fixed = cached-&gt;lig_caret_cnt_fixed;</span>
<span class="lineNum">    1593 </span><span class="lineNoCov">          0 :         PSTFree(sc-&gt;possub);</span>
<span class="lineNum">    1594 </span><span class="lineNoCov">          0 :         sc-&gt;possub = cached-&gt;possub;</span>
<span class="lineNum">    1595 </span><span class="lineNoCov">          0 :         cached-&gt;possub = NULL;</span>
<span class="lineNum">    1596 </span><span class="lineNoCov">          0 :         KernPairsFree(sc-&gt;kerns); KernPairsFree(sc-&gt;vkerns);</span>
<span class="lineNum">    1597 </span><span class="lineNoCov">          0 :         sc-&gt;kerns = cached-&gt;kerns; sc-&gt;vkerns = cached-&gt;vkerns;</span>
<span class="lineNum">    1598 </span><span class="lineNoCov">          0 :         cached-&gt;kerns = cached-&gt;vkerns = NULL;</span>
<span class="lineNum">    1599 </span><span class="lineNoCov">          0 :         sc-&gt;tile_margin = cached-&gt;tile_margin;</span>
<span class="lineNum">    1600 </span><span class="lineNoCov">          0 :         sc-&gt;tile_bounds = cached-&gt;tile_bounds;</span>
<span class="lineNum">    1601 </span><span class="lineNoCov">          0 :         if ( !sc-&gt;changed ) {</span>
<span class="lineNum">    1602 </span><span class="lineNoCov">          0 :             sc-&gt;changed = true;</span>
<span class="lineNum">    1603 </span><span class="lineNoCov">          0 :             refresh_fvdi = true;</span>
<span class="lineNum">    1604 </span>            :         }
<span class="lineNum">    1605 </span><span class="lineNoCov">          0 :         SCRefreshTitles(sc);</span>
<span class="lineNum">    1606 </span>            :     }
<span class="lineNum">    1607 </span><span class="lineNoCov">          0 :     if ( ci-&gt;name_change || ci-&gt;uni_change ) {</span>
<span class="lineNum">    1608 </span><span class="lineNoCov">          0 :         for ( fvs=(FontView *) sf-&gt;fv; fvs!=NULL; fvs=(FontView *) fvs-&gt;b.nextsame ) {</span>
<span class="lineNum">    1609 </span>            :             /* Postscript encodings are by name, others are by unicode */
<span class="lineNum">    1610 </span>            :             /* Hence slight differences in when we update the encoding */
<span class="lineNum">    1611 </span><span class="lineNoCov">          0 :             if ( (ci-&gt;name_change &amp;&amp; fvs-&gt;b.map-&gt;enc-&gt;psnames!=NULL ) ||</span>
<span class="lineNum">    1612 </span><span class="lineNoCov">          0 :                     (ci-&gt;uni_change &amp;&amp; fvs-&gt;b.map-&gt;enc-&gt;psnames==NULL )) {</span>
<span class="lineNum">    1613 </span><span class="lineNoCov">          0 :                 fvs-&gt;b.map-&gt;enc = &amp;custom;</span>
<span class="lineNum">    1614 </span><span class="lineNoCov">          0 :                 FVSetTitle((FontViewBase *) fvs);</span>
<span class="lineNum">    1615 </span><span class="lineNoCov">          0 :                 refresh_fvdi = true;</span>
<span class="lineNum">    1616 </span>            :             }
<span class="lineNum">    1617 </span>            :         }
<span class="lineNum">    1618 </span>            :     }
<span class="lineNum">    1619 </span><span class="lineNoCov">          0 :     if ( refresh_fvdi ) {</span>
<span class="lineNum">    1620 </span><span class="lineNoCov">          0 :         for ( fvs=(FontView *) sf-&gt;fv; fvs!=NULL; fvs=(FontView *) fvs-&gt;b.nextsame ) {</span>
<span class="lineNum">    1621 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(fvs-&gt;gw,NULL,false);  /* Redraw info area just in case this char is selected */</span>
<span class="lineNum">    1622 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(fvs-&gt;v,NULL,false);   /* Redraw character area in case this char is on screen */</span>
<span class="lineNum">    1623 </span>            :         }
<span class="lineNum">    1624 </span>            :     }
<span class="lineNum">    1625 </span><span class="lineNoCov">          0 :     if ( ci-&gt;changes )</span>
<span class="lineNum">    1626 </span><span class="lineNoCov">          0 :         sf-&gt;changed = true;</span>
<a name="1627"><span class="lineNum">    1627 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1628 </span>            : 
<span class="lineNum">    1629 </span><span class="lineNoCov">          0 : static void CI_Finish(CharInfo *ci) {</span>
<span class="lineNum">    1630 </span>            :     struct splinecharlist *scl, *next;
<span class="lineNum">    1631 </span>            : 
<span class="lineNum">    1632 </span><span class="lineNoCov">          0 :     for ( scl=ci-&gt;changes; scl!=NULL; scl=next ) {</span>
<span class="lineNum">    1633 </span><span class="lineNoCov">          0 :         next = scl-&gt;next;</span>
<span class="lineNum">    1634 </span><span class="lineNoCov">          0 :         SplineCharFree(scl-&gt;sc);</span>
<span class="lineNum">    1635 </span><span class="lineNoCov">          0 :         chunkfree(scl,sizeof(*scl));</span>
<span class="lineNum">    1636 </span>            :     }
<span class="lineNum">    1637 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(ci-&gt;gw);</span>
<a name="1638"><span class="lineNum">    1638 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1639 </span>            : 
<span class="lineNum">    1640 </span><span class="lineNoCov">          0 : static int CI_OK(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1641 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1642 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    1643 </span><span class="lineNoCov">          0 :         if ( _CI_OK(ci) ) {</span>
<span class="lineNum">    1644 </span><span class="lineNoCov">          0 :             CI_ApplyAll(ci);</span>
<span class="lineNum">    1645 </span><span class="lineNoCov">          0 :             CI_Finish(ci);</span>
<span class="lineNum">    1646 </span>            :         }
<span class="lineNum">    1647 </span>            :     }
<span class="lineNum">    1648 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1649"><span class="lineNum">    1649 </span>            : }</a>
<span class="lineNum">    1650 </span>            : 
<span class="lineNum">    1651 </span><span class="lineNoCov">          0 : static void CI_BoundsToMargin(CharInfo *ci) {</span>
<span class="lineNum">    1652 </span><span class="lineNoCov">          0 :     int err=false;</span>
<span class="lineNum">    1653 </span><span class="lineNoCov">          0 :     real margin = GetCalmReal8(ci-&gt;gw,CID_TileMargin,NULL,&amp;err);</span>
<span class="lineNum">    1654 </span>            :     DBounds b;
<span class="lineNum">    1655 </span>            :     char buffer[40];
<span class="lineNum">    1656 </span>            : 
<span class="lineNum">    1657 </span><span class="lineNoCov">          0 :     if ( err )</span>
<span class="lineNum">    1658 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1659 </span><span class="lineNoCov">          0 :     SplineCharFindBounds(ci-&gt;sc,&amp;b);</span>
<span class="lineNum">    1660 </span><span class="lineNoCov">          0 :     sprintf( buffer, &quot;%g&quot;, (double)(b.minx-margin) );</span>
<span class="lineNum">    1661 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TileBBoxMinX),buffer);</span>
<span class="lineNum">    1662 </span><span class="lineNoCov">          0 :     sprintf( buffer, &quot;%g&quot;, (double)(b.miny-margin) );</span>
<span class="lineNum">    1663 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TileBBoxMinY),buffer);</span>
<span class="lineNum">    1664 </span><span class="lineNoCov">          0 :     sprintf( buffer, &quot;%g&quot;, (double)(b.maxx+margin) );</span>
<span class="lineNum">    1665 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TileBBoxMaxX),buffer);</span>
<span class="lineNum">    1666 </span><span class="lineNoCov">          0 :     sprintf( buffer, &quot;%g&quot;, (double)(b.maxy+margin) );</span>
<span class="lineNum">    1667 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TileBBoxMaxY),buffer);</span>
<a name="1668"><span class="lineNum">    1668 </span>            : }</a>
<span class="lineNum">    1669 </span>            : 
<span class="lineNum">    1670 </span><span class="lineNoCov">          0 : static int CI_TileMarginChange(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1671 </span><span class="lineNoCov">          0 :     CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    1672 </span>            : 
<span class="lineNum">    1673 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textfocuschanged &amp;&amp;</span>
<span class="lineNum">    1674 </span><span class="lineNoCov">          0 :             e-&gt;u.control.u.tf_focus.gained_focus )</span>
<span class="lineNum">    1675 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(ci-&gt;gw,CID_IsTileMargin),true);</span>
<span class="lineNum">    1676 </span><span class="lineNoCov">          0 :     else if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textchanged )</span>
<span class="lineNum">    1677 </span><span class="lineNoCov">          0 :         CI_BoundsToMargin(ci);</span>
<span class="lineNum">    1678 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1679 </span>            : }
<span class="lineNum">    1680 </span>            : 
<a name="1681"><span class="lineNum">    1681 </span>            : /* Generate default settings for the entries in ligature lookup</a>
<span class="lineNum">    1682 </span>            :  * subtables. */
<span class="lineNum">    1683 </span><span class="lineNoCov">          0 : static char *LigDefaultStr(int uni, char *name, int alt_lig ) {</span>
<span class="lineNum">    1684 </span><span class="lineNoCov">          0 :     const unichar_t *alt=NULL, *pt;</span>
<span class="lineNum">    1685 </span><span class="lineNoCov">          0 :     char *components = NULL, *tmp;</span>
<span class="lineNum">    1686 </span>            :     int len;
<span class="lineNum">    1687 </span>            :     unichar_t hack[30], *upt;
<span class="lineNum">    1688 </span>            :     char buffer[80];
<span class="lineNum">    1689 </span>            : 
<span class="lineNum">    1690 </span>            :     /* If it's not (bmp) unicode we have no info on it */
<span class="lineNum">    1691 </span>            :     /*  Unless it looks like one of adobe's special ligature names */
<span class="lineNum">    1692 </span><span class="lineNoCov">          0 :     if ( uni==-1 || uni&gt;=0x10000 )</span>
<span class="lineNum">    1693 </span>            :         /* Nope */;
<span class="lineNum">    1694 </span><span class="lineNoCov">          0 :     else if ( isdecompositionnormative(uni) &amp;&amp;</span>
<span class="lineNum">    1695 </span><span class="lineNoCov">          0 :                 unicode_alternates[uni&gt;&gt;8]!=NULL &amp;&amp;</span>
<span class="lineNum">    1696 </span><span class="lineNoCov">          0 :                 (alt = unicode_alternates[uni&gt;&gt;8][uni&amp;0xff])!=NULL ) {</span>
<span class="lineNum">    1697 </span><span class="lineNoCov">          0 :         if ( alt[1]=='\0' )</span>
<span class="lineNum">    1698 </span><span class="lineNoCov">          0 :             alt = NULL;         /* Single replacements aren't ligatures */</span>
<span class="lineNum">    1699 </span><span class="lineNoCov">          0 :         else if ( iscombining(alt[1]) &amp;&amp; ( alt[2]=='\0' || iscombining(alt[2]))) {</span>
<span class="lineNum">    1700 </span><span class="lineNoCov">          0 :             if ( alt_lig != -10 )       /* alt_lig = 10 =&gt; mac unicode decomp */</span>
<span class="lineNum">    1701 </span><span class="lineNoCov">          0 :                 alt = NULL;             /* Otherwise, don't treat accented letters as ligatures */</span>
<span class="lineNum">    1702 </span><span class="lineNoCov">          0 :         } else if (! is_LIGATURE_or_VULGAR_FRACTION((uint32)(uni)) &amp;&amp;</span>
<span class="lineNum">    1703 </span><span class="lineNoCov">          0 :                 uni!=0x152 &amp;&amp; uni!=0x153 &amp;&amp;     /* oe ligature should not be standard */</span>
<span class="lineNum">    1704 </span><span class="lineNoCov">          0 :                 uni!=0x132 &amp;&amp; uni!=0x133 &amp;&amp;     /* nor ij */</span>
<span class="lineNum">    1705 </span><span class="lineNoCov">          0 :                 (uni&lt;0xfb2a || uni&gt;0xfb4f) &amp;&amp;     /* Allow hebrew precomposed chars */</span>
<span class="lineNum">    1706 </span><span class="lineNoCov">          0 :                 uni!=0x215f &amp;&amp;</span>
<span class="lineNum">    1707 </span><span class="lineNoCov">          0 :                 !((uni&gt;=0x0958 &amp;&amp; uni&lt;=0x095f) || uni==0x929 || uni==0x931 || uni==0x934)) {</span>
<span class="lineNum">    1708 </span><span class="lineNoCov">          0 :             alt = NULL;</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">          0 :         } else if ( (tmp=unicode_name(65))==NULL ) { /* test for 'A' to see if library exists */</span>
<span class="lineNum">    1710 </span><span class="lineNoCov">          0 :             if ( (uni&gt;=0xbc &amp;&amp; uni&lt;=0xbe ) ||             /* Latin1 fractions */</span>
<span class="lineNum">    1711 </span><span class="lineNoCov">          0 :                     (uni&gt;=0x2153 &amp;&amp; uni&lt;=0x215e ) ||      /* other fractions */</span>
<span class="lineNum">    1712 </span><span class="lineNoCov">          0 :                     (uni&gt;=0xfb00 &amp;&amp; uni&lt;=0xfb06 ) ||      /* latin ligatures */</span>
<span class="lineNum">    1713 </span><span class="lineNoCov">          0 :                     (uni&gt;=0xfb13 &amp;&amp; uni&lt;=0xfb17 ) ||      /* armenian ligatures */</span>
<span class="lineNum">    1714 </span><span class="lineNoCov">          0 :                     uni==0xfb17 ||                      /* hebrew ligature */</span>
<span class="lineNum">    1715 </span><span class="lineNoCov">          0 :                     (uni&gt;=0xfb2a &amp;&amp; uni&lt;=0xfb4f ) ||      /* hebrew precomposed chars */</span>
<span class="lineNum">    1716 </span><span class="lineNoCov">          0 :                     (uni&gt;=0xfbea &amp;&amp; uni&lt;=0xfdcf ) ||      /* arabic ligatures */</span>
<span class="lineNum">    1717 </span><span class="lineNoCov">          0 :                     (uni&gt;=0xfdf0 &amp;&amp; uni&lt;=0xfdfb ) ||      /* arabic ligatures */</span>
<span class="lineNum">    1718 </span><span class="lineNoCov">          0 :                     (uni&gt;=0xfef5 &amp;&amp; uni&lt;=0xfefc ))        /* arabic ligatures */</span>
<span class="lineNum">    1719 </span>            :                 ;       /* These are good */
<span class="lineNum">    1720 </span>            :             else
<span class="lineNum">    1721 </span><span class="lineNoCov">          0 :                 alt = NULL;</span>
<span class="lineNum">    1722 </span>            :         } else
<span class="lineNum">    1723 </span><span class="lineNoCov">          0 :             free(tmp); /* found 'A' means there is a library, now cleanup */</span>
<span class="lineNum">    1724 </span>            :     }
<span class="lineNum">    1725 </span><span class="lineNoCov">          0 :     if ( alt==NULL ) {</span>
<span class="lineNum">    1726 </span><span class="lineNoCov">          0 :         if ( name==NULL || alt_lig )</span>
<span class="lineNum">    1727 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    1728 </span>            :         else
<span class="lineNum">    1729 </span><span class="lineNoCov">          0 : return( AdobeLigatureFormat(name));</span>
<span class="lineNum">    1730 </span>            :     }
<span class="lineNum">    1731 </span>            : 
<span class="lineNum">    1732 </span><span class="lineNoCov">          0 :     if ( uni==0xfb03 &amp;&amp; alt_lig==1 )</span>
<span class="lineNum">    1733 </span><span class="lineNoCov">          0 :         components = copy(&quot;ff i&quot;);</span>
<span class="lineNum">    1734 </span><span class="lineNoCov">          0 :     else if ( uni==0xfb04 &amp;&amp; alt_lig==1 )</span>
<span class="lineNum">    1735 </span><span class="lineNoCov">          0 :         components = copy(&quot;ff l&quot;);</span>
<span class="lineNum">    1736 </span><span class="lineNoCov">          0 :     else if ( alt!=NULL ) {</span>
<span class="lineNum">    1737 </span><span class="lineNoCov">          0 :         if ( alt[1]==0x2044 &amp;&amp; (alt[2]==0 || alt[3]==0) &amp;&amp; alt_lig==1 ) {</span>
<span class="lineNum">    1738 </span><span class="lineNoCov">          0 :             u_strcpy(hack,alt);</span>
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 :             hack[1] = '/';</span>
<span class="lineNum">    1740 </span><span class="lineNoCov">          0 :             alt = hack;</span>
<span class="lineNum">    1741 </span><span class="lineNoCov">          0 :         } else if ( alt_lig&gt;0 )</span>
<span class="lineNum">    1742 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    1743 </span>            : 
<span class="lineNum">    1744 </span><span class="lineNoCov">          0 :         if ( isarabisolated(uni) || isarabinitial(uni) || isarabmedial(uni) || isarabfinal(uni) ) {</span>
<span class="lineNum">    1745 </span>            :             /* If it is arabic, then convert from the unformed version to the formed */
<span class="lineNum">    1746 </span><span class="lineNoCov">          0 :             if ( u_strlen(alt)&lt;sizeof(hack)/sizeof(hack[0])-1 ) {</span>
<span class="lineNum">    1747 </span><span class="lineNoCov">          0 :                 u_strcpy(hack,alt);</span>
<span class="lineNum">    1748 </span><span class="lineNoCov">          0 :                 for ( upt=hack ; *upt ; ++upt ) {</span>
<span class="lineNum">    1749 </span>            :                     /* Make everything medial */
<span class="lineNum">    1750 </span><span class="lineNoCov">          0 :                     if ( *upt&gt;=0x600 &amp;&amp; *upt&lt;=0x6ff )</span>
<span class="lineNum">    1751 </span><span class="lineNoCov">          0 :                         *upt = ArabicForms[*upt-0x600].medial;</span>
<span class="lineNum">    1752 </span>            :                 }
<span class="lineNum">    1753 </span><span class="lineNoCov">          0 :                 if ( isarabisolated(uni) || isarabfinal(uni) ) {</span>
<span class="lineNum">    1754 </span><span class="lineNoCov">          0 :                     int len = upt-hack-1;</span>
<span class="lineNum">    1755 </span><span class="lineNoCov">          0 :                     if ( alt[len]&gt;=0x600 &amp;&amp; alt[len]&lt;=0x6ff )</span>
<span class="lineNum">    1756 </span><span class="lineNoCov">          0 :                         hack[len] = ArabicForms[alt[len]-0x600].final;</span>
<span class="lineNum">    1757 </span>            :                 }
<span class="lineNum">    1758 </span><span class="lineNoCov">          0 :                 if ( isarabisolated(uni) || isarabinitial(uni) ) {</span>
<span class="lineNum">    1759 </span><span class="lineNoCov">          0 :                     if ( alt[0]&gt;=0x600 &amp;&amp; alt[0]&lt;=0x6ff )</span>
<span class="lineNum">    1760 </span><span class="lineNoCov">          0 :                         hack[0] = ArabicForms[alt[0]-0x600].initial;</span>
<span class="lineNum">    1761 </span>            :                 }
<span class="lineNum">    1762 </span><span class="lineNoCov">          0 :                 alt = hack;</span>
<span class="lineNum">    1763 </span>            :             }
<span class="lineNum">    1764 </span>            :         }
<span class="lineNum">    1765 </span>            : 
<span class="lineNum">    1766 </span><span class="lineNoCov">          0 :         components=NULL;</span>
<span class="lineNum">    1767 </span>            :         while ( 1 ) {
<span class="lineNum">    1768 </span><span class="lineNoCov">          0 :             len = 0;</span>
<span class="lineNum">    1769 </span><span class="lineNoCov">          0 :             for ( pt=alt; *pt; ++pt ) {</span>
<span class="lineNum">    1770 </span><span class="lineNoCov">          0 :                 if ( components==NULL ) {</span>
<span class="lineNum">    1771 </span><span class="lineNoCov">          0 :                     len += strlen(StdGlyphName(buffer,*pt,ui_none,(NameList *)-1))+1;</span>
<span class="lineNum">    1772 </span>            :                 } else {
<span class="lineNum">    1773 </span><span class="lineNoCov">          0 :                     const char *temp = StdGlyphName(buffer,*pt,ui_none,(NameList *)-1);</span>
<span class="lineNum">    1774 </span><span class="lineNoCov">          0 :                     strcpy(components+len,temp);</span>
<span class="lineNum">    1775 </span><span class="lineNoCov">          0 :                     len += strlen( temp );</span>
<span class="lineNum">    1776 </span><span class="lineNoCov">          0 :                     components[len++] = ' ';</span>
<span class="lineNum">    1777 </span>            :                 }
<span class="lineNum">    1778 </span>            :             }
<span class="lineNum">    1779 </span><span class="lineNoCov">          0 :             if ( components!=NULL )</span>
<span class="lineNum">    1780 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1781 </span><span class="lineNoCov">          0 :             components = malloc(len+1);</span>
<span class="lineNum">    1782 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1783 </span><span class="lineNoCov">          0 :         components[len-1] = '\0';</span>
<span class="lineNum">    1784 </span>            :     }
<span class="lineNum">    1785 </span><span class="lineNoCov">          0 : return( components );</span>
<a name="1786"><span class="lineNum">    1786 </span>            : }</a>
<span class="lineNum">    1787 </span>            : 
<span class="lineNum">    1788 </span><span class="lineNoCov">          0 : char *AdobeLigatureFormat(char *name) {</span>
<span class="lineNum">    1789 </span>            :     /* There are two formats for ligs: &lt;glyph-name&gt;_&lt;glyph-name&gt;{...} or */
<span class="lineNum">    1790 </span>            :     /*  uni&lt;code&gt;&lt;code&gt;{...} (only works for BMP) */
<span class="lineNum">    1791 </span>            :     /* I'm not checking to see if all the components are valid */
<span class="lineNum">    1792 </span>            :     char *components, *pt, buffer[12];
<span class="lineNum">    1793 </span>            :     const char *next;
<span class="lineNum">    1794 </span><span class="lineNoCov">          0 :     int len = strlen(name), uni;</span>
<span class="lineNum">    1795 </span>            : 
<span class="lineNum">    1796 </span><span class="lineNoCov">          0 :     if ( strncmp(name,&quot;uni&quot;,3)==0 &amp;&amp; (len-3)%4==0 &amp;&amp; len&gt;7 ) {</span>
<span class="lineNum">    1797 </span><span class="lineNoCov">          0 :         pt = name+3;</span>
<span class="lineNum">    1798 </span><span class="lineNoCov">          0 :         components = malloc(1); *components = '\0';</span>
<span class="lineNum">    1799 </span><span class="lineNoCov">          0 :         while ( *pt ) {</span>
<span class="lineNum">    1800 </span><span class="lineNoCov">          0 :             if ( sscanf(pt,&quot;%4x&quot;, (unsigned *) &amp;uni )==0 ) {</span>
<span class="lineNum">    1801 </span><span class="lineNoCov">          0 :                 free(components); components = NULL;</span>
<span class="lineNum">    1802 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1803 </span>            :             }
<span class="lineNum">    1804 </span><span class="lineNoCov">          0 :             next = StdGlyphName(buffer,uni,ui_none,(NameList *)-1);</span>
<span class="lineNum">    1805 </span><span class="lineNoCov">          0 :             components = realloc(components,strlen(components) + strlen(next) + 2);</span>
<span class="lineNum">    1806 </span><span class="lineNoCov">          0 :             if ( *components!='\0' )</span>
<span class="lineNum">    1807 </span><span class="lineNoCov">          0 :                 strcat(components,&quot; &quot;);</span>
<span class="lineNum">    1808 </span><span class="lineNoCov">          0 :             strcat(components,next);</span>
<span class="lineNum">    1809 </span><span class="lineNoCov">          0 :             pt += 4;</span>
<span class="lineNum">    1810 </span>            :         }
<span class="lineNum">    1811 </span><span class="lineNoCov">          0 :         if ( components!=NULL )</span>
<span class="lineNum">    1812 </span><span class="lineNoCov">          0 : return( components );</span>
<span class="lineNum">    1813 </span>            :     }
<span class="lineNum">    1814 </span>            : 
<span class="lineNum">    1815 </span><span class="lineNoCov">          0 :     if ( strchr(name,'_')==NULL )</span>
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    1817 </span><span class="lineNoCov">          0 :     pt = components = copy(name);</span>
<span class="lineNum">    1818 </span><span class="lineNoCov">          0 :     while ( (pt = strchr(pt,'_'))!=NULL )</span>
<span class="lineNum">    1819 </span><span class="lineNoCov">          0 :         *pt = ' ';</span>
<span class="lineNum">    1820 </span><span class="lineNoCov">          0 : return( components );</span>
<a name="1821"><span class="lineNum">    1821 </span>            : }</a>
<span class="lineNum">    1822 </span>            : 
<span class="lineNum">    1823 </span><span class="lineNoCov">          0 : uint32 LigTagFromUnicode(int uni) {</span>
<span class="lineNum">    1824 </span><span class="lineNoCov">          0 :     int tag = CHR('l','i','g','a');     /* standard */</span>
<span class="lineNum">    1825 </span>            : 
<span class="lineNum">    1826 </span><span class="lineNoCov">          0 :     if (( uni&gt;=0xbc &amp;&amp; uni&lt;=0xbe ) || (uni&gt;=0x2153 &amp;&amp; uni&lt;=0x215f) )</span>
<span class="lineNum">    1827 </span><span class="lineNoCov">          0 :         tag = CHR('f','r','a','c');     /* Fraction */</span>
<span class="lineNum">    1828 </span>            :     /* hebrew precomposed characters */
<span class="lineNum">    1829 </span><span class="lineNoCov">          0 :     else if ( uni&gt;=0xfb2a &amp;&amp; uni&lt;=0xfb4e )</span>
<span class="lineNum">    1830 </span><span class="lineNoCov">          0 :         tag = CHR('c','c','m','p');</span>
<span class="lineNum">    1831 </span><span class="lineNoCov">          0 :     else if ( uni==0xfb4f )</span>
<span class="lineNum">    1832 </span><span class="lineNoCov">          0 :         tag = CHR('h','l','i','g');</span>
<span class="lineNum">    1833 </span>            :     /* armenian */
<span class="lineNum">    1834 </span><span class="lineNoCov">          0 :     else if ( uni&gt;=0xfb13 &amp;&amp; uni&lt;=0xfb17 )</span>
<span class="lineNum">    1835 </span><span class="lineNoCov">          0 :         tag = CHR('l','i','g','a');</span>
<span class="lineNum">    1836 </span>            :     /* devanagari ligatures */
<span class="lineNum">    1837 </span><span class="lineNoCov">          0 :     else if ( (uni&gt;=0x0958 &amp;&amp; uni&lt;=0x095f) || uni==0x931 || uni==0x934 || uni==0x929 )</span>
<span class="lineNum">    1838 </span><span class="lineNoCov">          0 :         tag = CHR('n','u','k','t');</span>
<span class="lineNum">    1839 </span><span class="lineNoCov">          0 :     else switch ( uni ) {</span>
<span class="lineNum">    1840 </span>            :       case 0xfb05:              /* long-s t */
<span class="lineNum">    1841 </span>            :         /* This should be 'liga' for long-s+t and 'hlig' for s+t */
<span class="lineNum">    1842 </span><span class="lineNoCov">          0 :         tag = CHR('l','i','g','a');</span>
<span class="lineNum">    1843 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1844 </span>            :       case 0x00c6: case 0x00e6:         /* ae, AE */
<span class="lineNum">    1845 </span>            :       case 0x0152: case 0x0153:         /* oe, OE */
<span class="lineNum">    1846 </span>            :       case 0x0132: case 0x0133:         /* ij, IJ */
<span class="lineNum">    1847 </span>            :       case 0xfb06:                      /* s t */
<span class="lineNum">    1848 </span><span class="lineNoCov">          0 :         tag = CHR('d','l','i','g');</span>
<span class="lineNum">    1849 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1850 </span>            :       case 0xfefb: case 0xfefc: /* Lam &amp; Alef, required ligs */
<span class="lineNum">    1851 </span><span class="lineNoCov">          0 :         tag = CHR('r','l','i','g');</span>
<span class="lineNum">    1852 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1853 </span>            :     }
<span class="lineNum">    1854 </span><span class="lineNoCov">          0 : return( tag );</span>
<a name="1855"><span class="lineNum">    1855 </span>            : }</a>
<span class="lineNum">    1856 </span>            : 
<span class="lineNum">    1857 </span><span class="lineNoCov">          0 : SplineChar *SuffixCheck(SplineChar *sc,char *suffix) {</span>
<span class="lineNum">    1858 </span><span class="lineNoCov">          0 :     SplineChar *alt = NULL;</span>
<span class="lineNum">    1859 </span><span class="lineNoCov">          0 :     SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">    1860 </span>            :     char namebuf[200];
<span class="lineNum">    1861 </span>            : 
<span class="lineNum">    1862 </span><span class="lineNoCov">          0 :     if ( *suffix=='.' ) ++suffix;</span>
<span class="lineNum">    1863 </span><span class="lineNoCov">          0 :     if ( sf-&gt;cidmaster!=NULL ) {</span>
<span class="lineNum">    1864 </span><span class="lineNoCov">          0 :         sprintf( namebuf, &quot;%.20s.%d.%.80s&quot;, sf-&gt;cidmaster-&gt;ordering, sc-&gt;orig_pos, suffix );</span>
<span class="lineNum">    1865 </span><span class="lineNoCov">          0 :         alt = SFGetChar(sf,-1,namebuf);</span>
<span class="lineNum">    1866 </span><span class="lineNoCov">          0 :         if ( alt==NULL ) {</span>
<span class="lineNum">    1867 </span><span class="lineNoCov">          0 :             sprintf( namebuf, &quot;cid-%d.%.80s&quot;, sc-&gt;orig_pos, suffix );</span>
<span class="lineNum">    1868 </span><span class="lineNoCov">          0 :             alt = SFGetChar(sf,-1,namebuf);</span>
<span class="lineNum">    1869 </span>            :         }
<span class="lineNum">    1870 </span>            :     }
<span class="lineNum">    1871 </span><span class="lineNoCov">          0 :     if ( alt==NULL &amp;&amp; sc-&gt;unicodeenc!=-1 ) {</span>
<span class="lineNum">    1872 </span><span class="lineNoCov">          0 :         sprintf( namebuf, &quot;uni%04X.%.80s&quot;, sc-&gt;unicodeenc, suffix );</span>
<span class="lineNum">    1873 </span><span class="lineNoCov">          0 :         alt = SFGetChar(sf,-1,namebuf);</span>
<span class="lineNum">    1874 </span>            :     }
<span class="lineNum">    1875 </span><span class="lineNoCov">          0 :     if ( alt==NULL ) {</span>
<span class="lineNum">    1876 </span><span class="lineNoCov">          0 :         sprintf( namebuf, &quot;glyph%d.%.80s&quot;, sc-&gt;orig_pos, suffix );</span>
<span class="lineNum">    1877 </span><span class="lineNoCov">          0 :         alt = SFGetChar(sf,-1,namebuf);</span>
<span class="lineNum">    1878 </span>            :     }
<span class="lineNum">    1879 </span><span class="lineNoCov">          0 :     if ( alt==NULL ) {</span>
<span class="lineNum">    1880 </span><span class="lineNoCov">          0 :         sprintf( namebuf, &quot;%.80s.%.80s&quot;, sc-&gt;name, suffix );</span>
<span class="lineNum">    1881 </span><span class="lineNoCov">          0 :         alt = SFGetChar(sf,-1,namebuf);</span>
<span class="lineNum">    1882 </span>            :     }
<span class="lineNum">    1883 </span><span class="lineNoCov">          0 : return( alt );</span>
<a name="1884"><span class="lineNum">    1884 </span>            : }</a>
<span class="lineNum">    1885 </span>            : 
<span class="lineNum">    1886 </span><span class="lineNoCov">          0 : static SplineChar *SuffixCheckCase(SplineChar *sc,char *suffix, int cvt2lc ) {</span>
<span class="lineNum">    1887 </span><span class="lineNoCov">          0 :     SplineChar *alt = NULL;</span>
<span class="lineNum">    1888 </span><span class="lineNoCov">          0 :     SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">    1889 </span>            :     char namebuf[100];
<span class="lineNum">    1890 </span>            : 
<span class="lineNum">    1891 </span><span class="lineNoCov">          0 :     if ( *suffix=='.' ) ++suffix;</span>
<span class="lineNum">    1892 </span><span class="lineNoCov">          0 :     if ( sf-&gt;cidmaster!=NULL )</span>
<span class="lineNum">    1893 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    1894 </span>            : 
<span class="lineNum">    1895 </span>            :     /* Small cap characters are sometimes named &quot;a.sc&quot; */
<span class="lineNum">    1896 </span>            :     /*  and sometimes &quot;A.small&quot; */
<span class="lineNum">    1897 </span>            :     /* So if I want a 'smcp' feature I must convert &quot;a&quot; to &quot;A.small&quot; */
<span class="lineNum">    1898 </span>            :     /* And if I want a 'c2sc' feature I must convert &quot;A&quot; to &quot;a.sc&quot; */
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :     if ( cvt2lc ) {</span>
<span class="lineNum">    1900 </span><span class="lineNoCov">          0 :         if ( alt==NULL &amp;&amp; sc-&gt;unicodeenc!=-1 &amp;&amp; sc-&gt;unicodeenc&lt;0x10000 &amp;&amp;</span>
<span class="lineNum">    1901 </span><span class="lineNoCov">          0 :                 isupper(sc-&gt;unicodeenc)) {</span>
<span class="lineNum">    1902 </span><span class="lineNoCov">          0 :             sprintf( namebuf, &quot;uni%04X.%s&quot;, tolower(sc-&gt;unicodeenc), suffix );</span>
<span class="lineNum">    1903 </span><span class="lineNoCov">          0 :             alt = SFGetChar(sf,-1,namebuf);</span>
<span class="lineNum">    1904 </span>            :         }
<span class="lineNum">    1905 </span><span class="lineNoCov">          0 :         if ( alt==NULL &amp;&amp; isupper(*sc-&gt;name)) {</span>
<span class="lineNum">    1906 </span><span class="lineNoCov">          0 :             sprintf( namebuf, &quot;%c%s.%s&quot;, tolower(*sc-&gt;name), sc-&gt;name+1, suffix );</span>
<span class="lineNum">    1907 </span><span class="lineNoCov">          0 :             alt = SFGetChar(sf,-1,namebuf);</span>
<span class="lineNum">    1908 </span>            :         }
<span class="lineNum">    1909 </span>            :     } else {
<span class="lineNum">    1910 </span><span class="lineNoCov">          0 :         if ( alt==NULL &amp;&amp; sc-&gt;unicodeenc!=-1 &amp;&amp; sc-&gt;unicodeenc&lt;0x10000 &amp;&amp;</span>
<span class="lineNum">    1911 </span><span class="lineNoCov">          0 :                 islower(sc-&gt;unicodeenc)) {</span>
<span class="lineNum">    1912 </span><span class="lineNoCov">          0 :             sprintf( namebuf, &quot;uni%04X.%s&quot;, toupper(sc-&gt;unicodeenc), suffix );</span>
<span class="lineNum">    1913 </span><span class="lineNoCov">          0 :             alt = SFGetChar(sf,-1,namebuf);</span>
<span class="lineNum">    1914 </span>            :         }
<span class="lineNum">    1915 </span><span class="lineNoCov">          0 :         if ( alt==NULL &amp;&amp; islower(*sc-&gt;name)) {</span>
<span class="lineNum">    1916 </span><span class="lineNoCov">          0 :             sprintf( namebuf, &quot;%c%s.%s&quot;, toupper(*sc-&gt;name), sc-&gt;name+1, suffix );</span>
<span class="lineNum">    1917 </span><span class="lineNoCov">          0 :             alt = SFGetChar(sf,-1,namebuf);</span>
<span class="lineNum">    1918 </span>            :         }
<span class="lineNum">    1919 </span>            :     }
<span class="lineNum">    1920 </span><span class="lineNoCov">          0 : return( alt );</span>
<a name="1921"><span class="lineNum">    1921 </span>            : }</a>
<span class="lineNum">    1922 </span>            : 
<span class="lineNum">    1923 </span><span class="lineNoCov">          0 : void SCLigCaretCheck(SplineChar *sc,int clean) {</span>
<span class="lineNum">    1924 </span><span class="lineNoCov">          0 :     PST *pst, *carets=NULL, *prev_carets=NULL, *prev;</span>
<span class="lineNum">    1925 </span><span class="lineNoCov">          0 :     int lig_comp_max=0, lc, i;</span>
<span class="lineNum">    1926 </span>            :     char *pt;
<span class="lineNum">    1927 </span>            :     /* Check to see if this is a ligature character, and if so, does it have */
<span class="lineNum">    1928 </span>            :     /*  a ligature caret structure. If a lig but no lig caret structure then */
<span class="lineNum">    1929 </span>            :     /*  create a lig caret struct */
<span class="lineNum">    1930 </span>            :     /* This is not entirely sufficient. If we have an old type1 font with afm */
<span class="lineNum">    1931 </span>            :     /*  file then there was no way of saying &quot;ffi = f + f + i&quot; instead you    */
<span class="lineNum">    1932 </span>            :     /*  said &quot;ffi = ff + i&quot; (only two component ligatures allowed). This means*/
<span class="lineNum">    1933 </span>            :     /*  we'd get the wrong number of lcaret positions */
<span class="lineNum">    1934 </span>            : 
<span class="lineNum">    1935 </span><span class="lineNoCov">          0 :     if ( sc-&gt;lig_caret_cnt_fixed )</span>
<span class="lineNum">    1936 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1937 </span>            : 
<span class="lineNum">    1938 </span><span class="lineNoCov">          0 :     for ( pst=sc-&gt;possub, prev=NULL; pst!=NULL; prev = pst, pst=pst-&gt;next ) {</span>
<span class="lineNum">    1939 </span><span class="lineNoCov">          0 :         if ( pst-&gt;type == pst_lcaret ) {</span>
<span class="lineNum">    1940 </span><span class="lineNoCov">          0 :             if ( carets!=NULL )</span>
<span class="lineNum">    1941 </span><span class="lineNoCov">          0 :                 IError(&quot;Too many ligature caret structures&quot; );</span>
<span class="lineNum">    1942 </span>            :             else {
<span class="lineNum">    1943 </span><span class="lineNoCov">          0 :                 carets = pst;</span>
<span class="lineNum">    1944 </span><span class="lineNoCov">          0 :                 prev_carets = prev;</span>
<span class="lineNum">    1945 </span>            :             }
<span class="lineNum">    1946 </span><span class="lineNoCov">          0 :         } else if ( pst-&gt;type==pst_ligature ) {</span>
<span class="lineNum">    1947 </span><span class="lineNoCov">          0 :             for ( lc=0, pt=pst-&gt;u.lig.components; *pt; ++pt )</span>
<span class="lineNum">    1948 </span><span class="lineNoCov">          0 :                 if ( *pt==' ' ) ++lc;</span>
<span class="lineNum">    1949 </span><span class="lineNoCov">          0 :             if ( lc&gt;lig_comp_max )</span>
<span class="lineNum">    1950 </span><span class="lineNoCov">          0 :                 lig_comp_max = lc;</span>
<span class="lineNum">    1951 </span>            :         }
<span class="lineNum">    1952 </span>            :     }
<span class="lineNum">    1953 </span><span class="lineNoCov">          0 :     if ( lig_comp_max == 0 ) {</span>
<span class="lineNum">    1954 </span><span class="lineNoCov">          0 :         if ( clean &amp;&amp; carets!=NULL ) {</span>
<span class="lineNum">    1955 </span><span class="lineNoCov">          0 :             if ( prev_carets==NULL )</span>
<span class="lineNum">    1956 </span><span class="lineNoCov">          0 :                 sc-&gt;possub = carets-&gt;next;</span>
<span class="lineNum">    1957 </span>            :             else
<span class="lineNum">    1958 </span><span class="lineNoCov">          0 :                 prev_carets-&gt;next = carets-&gt;next;</span>
<span class="lineNum">    1959 </span><span class="lineNoCov">          0 :             carets-&gt;next = NULL;</span>
<span class="lineNum">    1960 </span><span class="lineNoCov">          0 :             PSTFree(carets);</span>
<span class="lineNum">    1961 </span>            :         }
<span class="lineNum">    1962 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1963 </span>            :     }
<span class="lineNum">    1964 </span><span class="lineNoCov">          0 :     if ( carets==NULL ) {</span>
<span class="lineNum">    1965 </span><span class="lineNoCov">          0 :         carets = chunkalloc(sizeof(PST));</span>
<span class="lineNum">    1966 </span><span class="lineNoCov">          0 :         carets-&gt;type = pst_lcaret;</span>
<span class="lineNum">    1967 </span><span class="lineNoCov">          0 :         carets-&gt;subtable = NULL;             /* Not relevant here */</span>
<span class="lineNum">    1968 </span><span class="lineNoCov">          0 :         carets-&gt;next = sc-&gt;possub;</span>
<span class="lineNum">    1969 </span><span class="lineNoCov">          0 :         sc-&gt;possub = carets;</span>
<span class="lineNum">    1970 </span>            :     }
<span class="lineNum">    1971 </span><span class="lineNoCov">          0 :     if ( carets-&gt;u.lcaret.cnt&gt;=lig_comp_max ) {</span>
<span class="lineNum">    1972 </span><span class="lineNoCov">          0 :         carets-&gt;u.lcaret.cnt = lig_comp_max;</span>
<span class="lineNum">    1973 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1974 </span>            :     }
<span class="lineNum">    1975 </span><span class="lineNoCov">          0 :     if ( carets-&gt;u.lcaret.carets==NULL )</span>
<span class="lineNum">    1976 </span><span class="lineNoCov">          0 :         carets-&gt;u.lcaret.carets = (int16 *) calloc(lig_comp_max,sizeof(int16));</span>
<span class="lineNum">    1977 </span>            :     else {
<span class="lineNum">    1978 </span><span class="lineNoCov">          0 :         carets-&gt;u.lcaret.carets = (int16 *) realloc(carets-&gt;u.lcaret.carets,lig_comp_max*sizeof(int16));</span>
<span class="lineNum">    1979 </span><span class="lineNoCov">          0 :         for ( i=carets-&gt;u.lcaret.cnt; i&lt;lig_comp_max; ++i )</span>
<span class="lineNum">    1980 </span><span class="lineNoCov">          0 :             carets-&gt;u.lcaret.carets[i] = 0;</span>
<span class="lineNum">    1981 </span>            :     }
<span class="lineNum">    1982 </span><span class="lineNoCov">          0 :     carets-&gt;u.lcaret.cnt = lig_comp_max;</span>
<a name="1983"><span class="lineNum">    1983 </span>            : }</a>
<span class="lineNum">    1984 </span>            : 
<span class="lineNum">    1985 </span><span class="lineNoCov">          0 : static int CI_SName(GGadget *g, GEvent *e) {    /* Set From Name */</span>
<span class="lineNum">    1986 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1987 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    1988 </span><span class="lineNoCov">          0 :         const unichar_t *ret = _GGadgetGetTitle(GWidgetGetControl(ci-&gt;gw,CID_UName));</span>
<span class="lineNum">    1989 </span>            :         int i;
<span class="lineNum">    1990 </span>            :         char buf[40], *ctemp; unichar_t ubuf[2], *temp;
<span class="lineNum">    1991 </span><span class="lineNoCov">          0 :         ctemp = u2utf8_copy(ret);</span>
<span class="lineNum">    1992 </span><span class="lineNoCov">          0 :         i = UniFromName(ctemp,ui_none,&amp;custom);</span>
<span class="lineNum">    1993 </span><span class="lineNoCov">          0 :         free(ctemp);</span>
<span class="lineNum">    1994 </span><span class="lineNoCov">          0 :         if ( i==-1 ) {</span>
<span class="lineNum">    1995 </span>            :             /* Adobe says names like uni00410042 represent a ligature (A&amp;B) */
<span class="lineNum">    1996 </span>            :             /*  (that is &quot;uni&quot; followed by two (or more) 4-digit codes). */
<span class="lineNum">    1997 </span>            :             /* But that names outside of BMP should be uXXXX or uXXXXX or uXXXXXX */
<span class="lineNum">    1998 </span><span class="lineNoCov">          0 :             if ( ret[0]=='u' &amp;&amp; ret[1]!='n' &amp;&amp; u_strlen(ret)&lt;=1+6 ) {</span>
<span class="lineNum">    1999 </span>            :                 unichar_t *end;
<span class="lineNum">    2000 </span><span class="lineNoCov">          0 :                 i = u_strtol(ret+1,&amp;end,16);</span>
<span class="lineNum">    2001 </span><span class="lineNoCov">          0 :                 if ( *end )</span>
<span class="lineNum">    2002 </span><span class="lineNoCov">          0 :                     i = -1;</span>
<span class="lineNum">    2003 </span>            :                 else            /* Make sure it is properly capitalized */
<span class="lineNum">    2004 </span><span class="lineNoCov">          0 :                     SetNameFromUnicode(ci-&gt;gw,CID_UName,i);</span>
<span class="lineNum">    2005 </span>            :             }
<span class="lineNum">    2006 </span>            :         }
<span class="lineNum">    2007 </span>            : 
<span class="lineNum">    2008 </span><span class="lineNoCov">          0 :         sprintf(buf,&quot;U+%04x&quot;, i);</span>
<span class="lineNum">    2009 </span><span class="lineNoCov">          0 :         temp = uc_copy(i==-1?&quot;-1&quot;:buf);</span>
<span class="lineNum">    2010 </span><span class="lineNoCov">          0 :         GGadgetSetTitle(GWidgetGetControl(ci-&gt;gw,CID_UValue),temp);</span>
<span class="lineNum">    2011 </span><span class="lineNoCov">          0 :         free(temp);</span>
<span class="lineNum">    2012 </span>            : 
<span class="lineNum">    2013 </span><span class="lineNoCov">          0 :         ubuf[0] = i;</span>
<span class="lineNum">    2014 </span><span class="lineNoCov">          0 :         if ( i==-1 || i&gt;0xffff )</span>
<span class="lineNum">    2015 </span><span class="lineNoCov">          0 :             ubuf[0] = '\0';</span>
<span class="lineNum">    2016 </span><span class="lineNoCov">          0 :         ubuf[1] = '\0';</span>
<span class="lineNum">    2017 </span><span class="lineNoCov">          0 :         GGadgetSetTitle(GWidgetGetControl(ci-&gt;gw,CID_UChar),ubuf);</span>
<span class="lineNum">    2018 </span>            :     }
<span class="lineNum">    2019 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2020"><span class="lineNum">    2020 </span>            : }</a>
<span class="lineNum">    2021 </span>            : 
<span class="lineNum">    2022 </span><span class="lineNoCov">          0 : static int CI_SValue(GGadget *g, GEvent *e) {   /* Set From Value */</span>
<span class="lineNum">    2023 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    2024 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2025 </span>            :         unichar_t ubuf[2];
<span class="lineNum">    2026 </span>            :         int val;
<span class="lineNum">    2027 </span>            : 
<span class="lineNum">    2028 </span><span class="lineNoCov">          0 :         val = ParseUValue(ci-&gt;gw,CID_UValue,false);</span>
<span class="lineNum">    2029 </span><span class="lineNoCov">          0 :         if ( val&lt;0 )</span>
<span class="lineNum">    2030 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    2031 </span>            : 
<span class="lineNum">    2032 </span><span class="lineNoCov">          0 :         SetNameFromUnicode(ci-&gt;gw,CID_UName,val);</span>
<span class="lineNum">    2033 </span>            : 
<span class="lineNum">    2034 </span><span class="lineNoCov">          0 :         ubuf[0] = val;</span>
<span class="lineNum">    2035 </span><span class="lineNoCov">          0 :         if ( val==-1 )</span>
<span class="lineNum">    2036 </span><span class="lineNoCov">          0 :             ubuf[0] = '\0';</span>
<span class="lineNum">    2037 </span><span class="lineNoCov">          0 :         ubuf[1] = '\0';</span>
<span class="lineNum">    2038 </span><span class="lineNoCov">          0 :         GGadgetSetTitle(GWidgetGetControl(ci-&gt;gw,CID_UChar),ubuf);</span>
<span class="lineNum">    2039 </span>            :     }
<span class="lineNum">    2040 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2041"><span class="lineNum">    2041 </span>            : }</a>
<span class="lineNum">    2042 </span>            : 
<span class="lineNum">    2043 </span><span class="lineNoCov">          0 : GTextInfo *TIFromName(const char *name) {</span>
<span class="lineNum">    2044 </span><span class="lineNoCov">          0 :     GTextInfo *ti = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">    2045 </span><span class="lineNoCov">          0 :     ti-&gt;text = utf82u_copy(name);</span>
<span class="lineNum">    2046 </span><span class="lineNoCov">          0 :     ti-&gt;fg = COLOR_DEFAULT;</span>
<span class="lineNum">    2047 </span><span class="lineNoCov">          0 :     ti-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">    2048 </span><span class="lineNoCov">          0 : return( ti );</span>
<a name="2049"><span class="lineNum">    2049 </span>            : }</a>
<span class="lineNum">    2050 </span>            : 
<span class="lineNum">    2051 </span><span class="lineNoCov">          0 : static void CI_SetNameList(CharInfo *ci,int val) {</span>
<span class="lineNum">    2052 </span><span class="lineNoCov">          0 :     GGadget *g = GWidgetGetControl(ci-&gt;gw,CID_UName);</span>
<span class="lineNum">    2053 </span>            :     int cnt;
<span class="lineNum">    2054 </span>            : 
<span class="lineNum">    2055 </span><span class="lineNoCov">          0 :     if ( GGadgetGetUserData(g)==(void *) (intpt) val )</span>
<span class="lineNum">    2056 </span><span class="lineNoCov">          0 : return;         /* Didn't change */</span>
<span class="lineNum">    2057 </span>            :     {
<span class="lineNum">    2058 </span><span class="lineNoCov">          0 :         GTextInfo **list = NULL;</span>
<span class="lineNum">    2059 </span><span class="lineNoCov">          0 :         char **names = AllGlyphNames(val,ci-&gt;sc-&gt;parent-&gt;for_new_glyphs,ci-&gt;sc);</span>
<span class="lineNum">    2060 </span>            : 
<span class="lineNum">    2061 </span><span class="lineNoCov">          0 :         for ( cnt=0; names[cnt]!=NULL; ++cnt );</span>
<span class="lineNum">    2062 </span><span class="lineNoCov">          0 :         list = malloc((cnt+1)*sizeof(GTextInfo*)); </span>
<span class="lineNum">    2063 </span><span class="lineNoCov">          0 :         for ( cnt=0; names[cnt]!=NULL; ++cnt ) {</span>
<span class="lineNum">    2064 </span><span class="lineNoCov">          0 :             list[cnt] = TIFromName(names[cnt]);</span>
<span class="lineNum">    2065 </span><span class="lineNoCov">          0 :             free(names[cnt]);</span>
<span class="lineNum">    2066 </span>            :         }
<span class="lineNum">    2067 </span><span class="lineNoCov">          0 :         free(names);</span>
<span class="lineNum">    2068 </span><span class="lineNoCov">          0 :         list[cnt] = TIFromName(NULL);</span>
<span class="lineNum">    2069 </span><span class="lineNoCov">          0 :         GGadgetSetList(g,list,true);</span>
<span class="lineNum">    2070 </span>            :     }
<span class="lineNum">    2071 </span><span class="lineNoCov">          0 :     GGadgetSetUserData(g,(void *) (intpt) val);</span>
<a name="2072"><span class="lineNum">    2072 </span>            : }</a>
<span class="lineNum">    2073 </span>            : 
<span class="lineNum">    2074 </span><span class="lineNoCov">          0 : static int CI_UValChanged(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2075 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textchanged ) {</span>
<span class="lineNum">    2076 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2077 </span><span class="lineNoCov">          0 :         const unichar_t *ret = _GGadgetGetTitle(GWidgetGetControl(ci-&gt;gw,CID_UValue));</span>
<span class="lineNum">    2078 </span>            :         unichar_t *end;
<span class="lineNum">    2079 </span>            :         int val;
<span class="lineNum">    2080 </span>            : 
<span class="lineNum">    2081 </span><span class="lineNoCov">          0 :         if (( *ret=='U' || *ret=='u' ) &amp;&amp; ret[1]=='+' )</span>
<span class="lineNum">    2082 </span><span class="lineNoCov">          0 :             ret += 2;</span>
<span class="lineNum">    2083 </span><span class="lineNoCov">          0 :         val = u_strtol(ret,&amp;end,16);</span>
<span class="lineNum">    2084 </span><span class="lineNoCov">          0 :         if ( *end=='\0' )</span>
<span class="lineNum">    2085 </span><span class="lineNoCov">          0 :             CI_SetNameList(ci,val);</span>
<span class="lineNum">    2086 </span>            :     }
<span class="lineNum">    2087 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2088"><span class="lineNum">    2088 </span>            : }</a>
<span class="lineNum">    2089 </span>            : 
<span class="lineNum">    2090 </span><span class="lineNoCov">          0 : static int CI_CharChanged(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2091 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textchanged ) {</span>
<span class="lineNum">    2092 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2093 </span><span class="lineNoCov">          0 :         const unichar_t *ret = _GGadgetGetTitle(GWidgetGetControl(ci-&gt;gw,CID_UChar));</span>
<span class="lineNum">    2094 </span><span class="lineNoCov">          0 :         int val = *ret;</span>
<span class="lineNum">    2095 </span>            :         unichar_t *temp, ubuf[2]; char buf[10];
<span class="lineNum">    2096 </span>            : 
<span class="lineNum">    2097 </span><span class="lineNoCov">          0 :         if ( ret[0]=='\0' )</span>
<span class="lineNum">    2098 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    2099 </span><span class="lineNoCov">          0 :         else if ( ret[1]!='\0' ) {</span>
<span class="lineNum">    2100 </span><span class="lineNoCov">          0 :             ff_post_notice(_(&quot;Only a single character allowed&quot;),_(&quot;Only a single character allowed&quot;));</span>
<span class="lineNum">    2101 </span><span class="lineNoCov">          0 :             ubuf[0] = ret[0];</span>
<span class="lineNum">    2102 </span><span class="lineNoCov">          0 :             ubuf[1] = '\0';</span>
<span class="lineNum">    2103 </span><span class="lineNoCov">          0 :             GGadgetSetTitle(GWidgetGetControl(ci-&gt;gw,CID_UChar),ubuf);</span>
<span class="lineNum">    2104 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    2105 </span>            :         }
<span class="lineNum">    2106 </span>            : 
<span class="lineNum">    2107 </span><span class="lineNoCov">          0 :         SetNameFromUnicode(ci-&gt;gw,CID_UName,val);</span>
<span class="lineNum">    2108 </span><span class="lineNoCov">          0 :         CI_SetNameList(ci,val);</span>
<span class="lineNum">    2109 </span>            : 
<span class="lineNum">    2110 </span><span class="lineNoCov">          0 :         sprintf(buf,&quot;U+%04x&quot;, val);</span>
<span class="lineNum">    2111 </span><span class="lineNoCov">          0 :         temp = uc_copy(buf);</span>
<span class="lineNum">    2112 </span><span class="lineNoCov">          0 :         GGadgetSetTitle(GWidgetGetControl(ci-&gt;gw,CID_UValue),temp);</span>
<span class="lineNum">    2113 </span><span class="lineNoCov">          0 :         free(temp);</span>
<span class="lineNum">    2114 </span>            :     }
<span class="lineNum">    2115 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2116"><span class="lineNum">    2116 </span>            : }</a>
<span class="lineNum">    2117 </span>            : 
<span class="lineNum">    2118 </span><span class="lineNoCov">          0 : static int CI_CommentChanged(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2119 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textchanged ) {</span>
<span class="lineNum">    2120 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2121 </span>            :         /* Let's give things with comments a white color. This may not be a good idea */
<span class="lineNum">    2122 </span><span class="lineNoCov">          0 :         if ( ci-&gt;first &amp;&amp; ci-&gt;sc-&gt;color==COLOR_DEFAULT &amp;&amp;</span>
<span class="lineNum">    2123 </span><span class="lineNoCov">          0 :                 0==GGadgetGetFirstListSelectedItem(GWidgetGetControl(ci-&gt;gw,CID_Color)) )</span>
<span class="lineNum">    2124 </span><span class="lineNoCov">          0 :             GGadgetSelectOneListItem(GWidgetGetControl(ci-&gt;gw,CID_Color),1);</span>
<span class="lineNum">    2125 </span><span class="lineNoCov">          0 :         ci-&gt;first = false;</span>
<span class="lineNum">    2126 </span>            :     }
<span class="lineNum">    2127 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    2128 </span>            : }
<span class="lineNum">    2129 </span>            : 
<span class="lineNum">    2130 </span>            : struct devtab_dlg {
<span class="lineNum">    2131 </span>            :     int done;
<span class="lineNum">    2132 </span>            :     GWindow gw;
<span class="lineNum">    2133 </span>            :     GGadget *gme;
<span class="lineNum">    2134 </span>            :     DeviceTable devtab;
<span class="lineNum">    2135 </span>            : };
<span class="lineNum">    2136 </span>            : 
<span class="lineNum">    2137 </span>            : static struct col_init devtabci[] = {
<span class="lineNum">    2138 </span>            :     { me_int, NULL, NULL, NULL, N_(&quot;Pixel Size&quot;) },
<span class="lineNum">    2139 </span>            :     { me_int, NULL, NULL, NULL, N_(&quot;Correction&quot;) },
<span class="lineNum">    2140 </span>            :     COL_INIT_EMPTY
<a name="2141"><span class="lineNum">    2141 </span>            : };</a>
<span class="lineNum">    2142 </span>            : 
<span class="lineNum">    2143 </span><span class="lineNoCov">          0 : static void DevTabMatrixInit(struct matrixinit *mi,char *dvstr) {</span>
<span class="lineNum">    2144 </span>            :     struct matrix_data *md;
<span class="lineNum">    2145 </span>            :     int k, p, cnt;
<span class="lineNum">    2146 </span>            :     DeviceTable devtab;
<span class="lineNum">    2147 </span>            : 
<span class="lineNum">    2148 </span><span class="lineNoCov">          0 :     memset(&amp;devtab,0,sizeof(devtab));</span>
<span class="lineNum">    2149 </span><span class="lineNoCov">          0 :     DeviceTableParse(&amp;devtab,dvstr);</span>
<span class="lineNum">    2150 </span><span class="lineNoCov">          0 :     cnt = 0;</span>
<span class="lineNum">    2151 </span><span class="lineNoCov">          0 :     if ( devtab.corrections!=NULL ) {</span>
<span class="lineNum">    2152 </span><span class="lineNoCov">          0 :         for ( k=devtab.first_pixel_size; k&lt;=devtab.last_pixel_size; ++k )</span>
<span class="lineNum">    2153 </span><span class="lineNoCov">          0 :             if ( devtab.corrections[k-devtab.first_pixel_size]!=0 )</span>
<span class="lineNum">    2154 </span><span class="lineNoCov">          0 :                 ++cnt;</span>
<span class="lineNum">    2155 </span>            :     }
<span class="lineNum">    2156 </span>            : 
<span class="lineNum">    2157 </span><span class="lineNoCov">          0 :     memset(mi,0,sizeof(*mi));</span>
<span class="lineNum">    2158 </span><span class="lineNoCov">          0 :     mi-&gt;col_cnt = 2;</span>
<span class="lineNum">    2159 </span><span class="lineNoCov">          0 :     mi-&gt;col_init = devtabci;</span>
<span class="lineNum">    2160 </span>            : 
<span class="lineNum">    2161 </span><span class="lineNoCov">          0 :     md = NULL;</span>
<span class="lineNum">    2162 </span><span class="lineNoCov">          0 :     for ( k=0; k&lt;2; ++k ) {</span>
<span class="lineNum">    2163 </span><span class="lineNoCov">          0 :         cnt = 0;</span>
<span class="lineNum">    2164 </span><span class="lineNoCov">          0 :         if ( devtab.corrections==NULL )</span>
<span class="lineNum">    2165 </span>            :             /* Do Nothing */;
<span class="lineNum">    2166 </span><span class="lineNoCov">          0 :         else for ( p=devtab.first_pixel_size; p&lt;=devtab.last_pixel_size; ++p ) {</span>
<span class="lineNum">    2167 </span><span class="lineNoCov">          0 :             if ( devtab.corrections[p-devtab.first_pixel_size]!=0 ) {</span>
<span class="lineNum">    2168 </span><span class="lineNoCov">          0 :                 if ( k ) {</span>
<span class="lineNum">    2169 </span><span class="lineNoCov">          0 :                     md[2*cnt+0].u.md_ival = p;</span>
<span class="lineNum">    2170 </span><span class="lineNoCov">          0 :                     md[2*cnt+1].u.md_ival = devtab.corrections[p-devtab.first_pixel_size];</span>
<span class="lineNum">    2171 </span>            :                 }
<span class="lineNum">    2172 </span><span class="lineNoCov">          0 :                 ++cnt;</span>
<span class="lineNum">    2173 </span>            :             }
<span class="lineNum">    2174 </span>            :         }
<span class="lineNum">    2175 </span><span class="lineNoCov">          0 :         if ( md==NULL )</span>
<span class="lineNum">    2176 </span><span class="lineNoCov">          0 :             md = calloc(2*(cnt+10),sizeof(struct matrix_data));</span>
<span class="lineNum">    2177 </span>            :     }
<span class="lineNum">    2178 </span><span class="lineNoCov">          0 :     mi-&gt;matrix_data = md;</span>
<span class="lineNum">    2179 </span><span class="lineNoCov">          0 :     mi-&gt;initial_row_cnt = cnt;</span>
<span class="lineNum">    2180 </span>            : 
<span class="lineNum">    2181 </span><span class="lineNoCov">          0 :     mi-&gt;initrow = NULL;</span>
<span class="lineNum">    2182 </span><span class="lineNoCov">          0 :     mi-&gt;finishedit = NULL;</span>
<span class="lineNum">    2183 </span><span class="lineNoCov">          0 :     mi-&gt;candelete = NULL;</span>
<span class="lineNum">    2184 </span><span class="lineNoCov">          0 :     mi-&gt;popupmenu = NULL;</span>
<span class="lineNum">    2185 </span><span class="lineNoCov">          0 :     mi-&gt;handle_key = NULL;</span>
<span class="lineNum">    2186 </span><span class="lineNoCov">          0 :     mi-&gt;bigedittitle = NULL;</span>
<span class="lineNum">    2187 </span>            : 
<span class="lineNum">    2188 </span><span class="lineNoCov">          0 :     free( devtab.corrections );</span>
<a name="2189"><span class="lineNum">    2189 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2190 </span>            : 
<span class="lineNum">    2191 </span><span class="lineNoCov">          0 : static int DevTabDlg_OK(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2192 </span>            : 
<span class="lineNum">    2193 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    2194 </span><span class="lineNoCov">          0 :         struct devtab_dlg *dvd = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2195 </span>            :         int rows, i, low, high;
<span class="lineNum">    2196 </span><span class="lineNoCov">          0 :         struct matrix_data *corrections = GMatrixEditGet(dvd-&gt;gme, &amp;rows);</span>
<span class="lineNum">    2197 </span>            : 
<span class="lineNum">    2198 </span><span class="lineNoCov">          0 :         low = high = -1;</span>
<span class="lineNum">    2199 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">    2200 </span><span class="lineNoCov">          0 :             if ( corrections[2*i+1].u.md_ival&lt;-128 || corrections[2*i+1].u.md_ival&gt;127 ) {</span>
<span class="lineNum">    2201 </span><span class="lineNoCov">          0 :                 ff_post_error(_(&quot;Bad correction&quot;),_(&quot;The correction on line %d is too big.  It must be between -128 and 127&quot;),</span>
<span class="lineNum">    2202 </span>            :                         i+1 );
<span class="lineNum">    2203 </span><span class="lineNoCov">          0 : return(true);</span>
<span class="lineNum">    2204 </span><span class="lineNoCov">          0 :             } else if ( corrections[2*i+0].u.md_ival&lt;0 || corrections[2*i+0].u.md_ival&gt;32767 ) {</span>
<span class="lineNum">    2205 </span><span class="lineNoCov">          0 :                 gwwv_post_error(_(&quot;Bad pixel size&quot;),_(&quot;The pixel size on line %d is out of bounds.&quot;),</span>
<span class="lineNum">    2206 </span>            :                         i+1 );
<span class="lineNum">    2207 </span><span class="lineNoCov">          0 : return(true);</span>
<span class="lineNum">    2208 </span>            :             }
<span class="lineNum">    2209 </span><span class="lineNoCov">          0 :             if ( corrections[2*i+1].u.md_ival!=0 ) {</span>
<span class="lineNum">    2210 </span><span class="lineNoCov">          0 :                 if ( low==-1 )</span>
<span class="lineNum">    2211 </span><span class="lineNoCov">          0 :                     low = high = corrections[2*i+0].u.md_ival;</span>
<span class="lineNum">    2212 </span><span class="lineNoCov">          0 :                 else if ( corrections[2*i+0].u.md_ival&lt;low )</span>
<span class="lineNum">    2213 </span><span class="lineNoCov">          0 :                     low = corrections[2*i+0].u.md_ival;</span>
<span class="lineNum">    2214 </span><span class="lineNoCov">          0 :                 else if ( corrections[2*i+0].u.md_ival&gt;high )</span>
<span class="lineNum">    2215 </span><span class="lineNoCov">          0 :                     high = corrections[2*i+0].u.md_ival;</span>
<span class="lineNum">    2216 </span>            :             }
<span class="lineNum">    2217 </span>            :         }
<span class="lineNum">    2218 </span><span class="lineNoCov">          0 :         memset(&amp;dvd-&gt;devtab,0,sizeof(DeviceTable));</span>
<span class="lineNum">    2219 </span><span class="lineNoCov">          0 :         if ( low!=-1 ) {</span>
<span class="lineNum">    2220 </span><span class="lineNoCov">          0 :             dvd-&gt;devtab.first_pixel_size = low;</span>
<span class="lineNum">    2221 </span><span class="lineNoCov">          0 :             dvd-&gt;devtab.last_pixel_size = high;</span>
<span class="lineNum">    2222 </span><span class="lineNoCov">          0 :             dvd-&gt;devtab.corrections = calloc(high-low+1,1);</span>
<span class="lineNum">    2223 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">    2224 </span><span class="lineNoCov">          0 :                 if ( corrections[2*i+1].u.md_ival!=0 ) {</span>
<span class="lineNum">    2225 </span><span class="lineNoCov">          0 :                     dvd-&gt;devtab.corrections[ corrections[2*i+0].u.md_ival-low ] =</span>
<span class="lineNum">    2226 </span><span class="lineNoCov">          0 :                             corrections[2*i+1].u.md_ival;</span>
<span class="lineNum">    2227 </span>            :                 }
<span class="lineNum">    2228 </span>            :             }
<span class="lineNum">    2229 </span>            :         }
<span class="lineNum">    2230 </span><span class="lineNoCov">          0 :         dvd-&gt;done = 2;</span>
<span class="lineNum">    2231 </span>            :     }
<span class="lineNum">    2232 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2233"><span class="lineNum">    2233 </span>            : }</a>
<span class="lineNum">    2234 </span>            : 
<span class="lineNum">    2235 </span><span class="lineNoCov">          0 : static int DevTabDlg_Cancel(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2236 </span>            : 
<span class="lineNum">    2237 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    2238 </span><span class="lineNoCov">          0 :         struct devtab_dlg *dvd = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2239 </span><span class="lineNoCov">          0 :         dvd-&gt;done = true;</span>
<span class="lineNum">    2240 </span>            :     }
<span class="lineNum">    2241 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2242"><span class="lineNum">    2242 </span>            : }</a>
<span class="lineNum">    2243 </span>            : 
<span class="lineNum">    2244 </span><span class="lineNoCov">          0 : static int devtabdlg_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    2245 </span>            : 
<span class="lineNum">    2246 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">    2247 </span><span class="lineNoCov">          0 :         struct devtab_dlg *dvd = GDrawGetUserData(gw);</span>
<span class="lineNum">    2248 </span><span class="lineNoCov">          0 :         dvd-&gt;done = true;</span>
<span class="lineNum">    2249 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_char ) {</span>
<span class="lineNum">    2250 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    2251 </span>            :     }
<span class="lineNum">    2252 </span>            : 
<span class="lineNum">    2253 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2254"><span class="lineNum">    2254 </span>            : }</a>
<span class="lineNum">    2255 </span>            : 
<span class="lineNum">    2256 </span><span class="lineNoCov">          0 : char *DevTab_Dlg(GGadget *g, int r, int c) {</span>
<span class="lineNum">    2257 </span><span class="lineNoCov">          0 :     int rows, k, j, cols = GMatrixEditGetColCnt(g);</span>
<span class="lineNum">    2258 </span><span class="lineNoCov">          0 :     struct matrix_data *strings = GMatrixEditGet(g, &amp;rows);</span>
<span class="lineNum">    2259 </span><span class="lineNoCov">          0 :     char *dvstr = strings[cols*r+c].u.md_str;</span>
<span class="lineNum">    2260 </span>            :     struct devtab_dlg dvd;
<span class="lineNum">    2261 </span>            :     GRect pos;
<span class="lineNum">    2262 </span>            :     GWindow gw;
<span class="lineNum">    2263 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    2264 </span>            :     GGadgetCreateData gcd[4], boxes[3];
<span class="lineNum">    2265 </span>            :     GGadgetCreateData *varray[6], *harray3[8];
<span class="lineNum">    2266 </span>            :     GTextInfo label[4];
<span class="lineNum">    2267 </span>            :     struct matrixinit mi;
<span class="lineNum">    2268 </span>            : 
<span class="lineNum">    2269 </span><span class="lineNoCov">          0 :     memset(&amp;dvd,0,sizeof(dvd));</span>
<span class="lineNum">    2270 </span>            : 
<span class="lineNum">    2271 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    2272 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_isdlg|wam_restrict;</span>
<span class="lineNum">    2273 </span><span class="lineNoCov">          0 :     wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">    2274 </span><span class="lineNoCov">          0 :     wattrs.is_dlg = true;</span>
<span class="lineNum">    2275 </span><span class="lineNoCov">          0 :     wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">    2276 </span><span class="lineNoCov">          0 :     wattrs.undercursor = 1;</span>
<span class="lineNum">    2277 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_pointer;</span>
<span class="lineNum">    2278 </span><span class="lineNoCov">          0 :     wattrs.utf8_window_title = _(&quot;Device Table Adjustments&quot;);</span>
<span class="lineNum">    2279 </span><span class="lineNoCov">          0 :     pos.x = pos.y = 0;</span>
<span class="lineNum">    2280 </span><span class="lineNoCov">          0 :     pos.width =GDrawPointsToPixels(NULL,GGadgetScale(268));</span>
<span class="lineNum">    2281 </span><span class="lineNoCov">          0 :     pos.height = GDrawPointsToPixels(NULL,375);</span>
<span class="lineNum">    2282 </span><span class="lineNoCov">          0 :     dvd.gw = gw = GDrawCreateTopWindow(NULL,&amp;pos,devtabdlg_e_h,&amp;dvd,&amp;wattrs);</span>
<span class="lineNum">    2283 </span>            : 
<span class="lineNum">    2284 </span><span class="lineNoCov">          0 :     DevTabMatrixInit(&amp;mi,dvstr);</span>
<span class="lineNum">    2285 </span>            : 
<span class="lineNum">    2286 </span><span class="lineNoCov">          0 :     memset(&amp;gcd,0,sizeof(gcd));</span>
<span class="lineNum">    2287 </span><span class="lineNoCov">          0 :     memset(&amp;boxes,0,sizeof(boxes));</span>
<span class="lineNum">    2288 </span><span class="lineNoCov">          0 :     memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">    2289 </span><span class="lineNoCov">          0 :     k=j=0;</span>
<span class="lineNum">    2290 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = gcd[1].gd.pos.y+14;</span>
<span class="lineNum">    2291 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_enabled | gg_visible | gg_utf8_popup;</span>
<span class="lineNum">    2292 </span><span class="lineNoCov">          0 :     gcd[k].gd.u.matrix = &amp;mi;</span>
<span class="lineNum">    2293 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(</span>
<span class="lineNum">    2294 </span>            :         &quot;At small pixel sizes (screen font sizes)\n&quot;
<span class="lineNum">    2295 </span>            :         &quot;the rounding errors that occur may be\n&quot;
<span class="lineNum">    2296 </span>            :         &quot;extremely ugly. A device table allows\n&quot;
<span class="lineNum">    2297 </span>            :         &quot;you to specify adjustments to the rounded\n&quot;
<span class="lineNum">    2298 </span>            :         &quot;Every pixel size my have its own adjustment.&quot;);
<span class="lineNum">    2299 </span><span class="lineNoCov">          0 :     gcd[k].creator = GMatrixEditCreate;</span>
<span class="lineNum">    2300 </span><span class="lineNoCov">          0 :     varray[j++] = &amp;gcd[k++]; varray[j++] = NULL;</span>
<span class="lineNum">    2301 </span>            : 
<span class="lineNum">    2302 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 30-3; </span>
<span class="lineNum">    2303 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">    2304 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">    2305 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2306 </span><span class="lineNoCov">          0 :     label[k].text_in_resource = true;</span>
<span class="lineNum">    2307 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2308 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = DevTabDlg_OK;</span>
<span class="lineNum">    2309 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GButtonCreate;</span>
<span class="lineNum">    2310 </span>            : 
<span class="lineNum">    2311 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = -30;</span>
<span class="lineNum">    2312 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">    2313 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    2314 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2315 </span><span class="lineNoCov">          0 :     label[k].text_in_resource = true;</span>
<span class="lineNum">    2316 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2317 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = DevTabDlg_Cancel;</span>
<span class="lineNum">    2318 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_Cancel;</span>
<span class="lineNum">    2319 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GButtonCreate;</span>
<span class="lineNum">    2320 </span>            : 
<span class="lineNum">    2321 </span><span class="lineNoCov">          0 :     harray3[0] = harray3[2] = harray3[3] = harray3[4] = harray3[6] = GCD_Glue;</span>
<span class="lineNum">    2322 </span><span class="lineNoCov">          0 :     harray3[7] = NULL;</span>
<span class="lineNum">    2323 </span><span class="lineNoCov">          0 :     harray3[1] = &amp;gcd[k-2]; harray3[5] = &amp;gcd[k-1];</span>
<span class="lineNum">    2324 </span>            : 
<span class="lineNum">    2325 </span><span class="lineNoCov">          0 :     boxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2326 </span><span class="lineNoCov">          0 :     boxes[0].gd.u.boxelements = harray3;</span>
<span class="lineNum">    2327 </span><span class="lineNoCov">          0 :     boxes[0].creator = GHBoxCreate;</span>
<span class="lineNum">    2328 </span><span class="lineNoCov">          0 :     varray[j++] = &amp;boxes[0]; varray[j++] = NULL; varray[j] = NULL;</span>
<span class="lineNum">    2329 </span>            :     
<span class="lineNum">    2330 </span><span class="lineNoCov">          0 :     boxes[1].gd.pos.x = boxes[1].gd.pos.y = 2;</span>
<span class="lineNum">    2331 </span><span class="lineNoCov">          0 :     boxes[1].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2332 </span><span class="lineNoCov">          0 :     boxes[1].gd.u.boxelements = varray;</span>
<span class="lineNum">    2333 </span><span class="lineNoCov">          0 :     boxes[1].creator = GHVGroupCreate;</span>
<span class="lineNum">    2334 </span>            : 
<span class="lineNum">    2335 </span><span class="lineNoCov">          0 :     GGadgetsCreate(gw,boxes+1);</span>
<span class="lineNum">    2336 </span>            : 
<span class="lineNum">    2337 </span><span class="lineNoCov">          0 :     free( mi.matrix_data );</span>
<span class="lineNum">    2338 </span>            : 
<span class="lineNum">    2339 </span><span class="lineNoCov">          0 :     dvd.gme = gcd[0].ret;</span>
<span class="lineNum">    2340 </span><span class="lineNoCov">          0 :     GMatrixEditSetNewText(gcd[0].ret,S_(&quot;PixelSize|New&quot;));</span>
<span class="lineNum">    2341 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(boxes[1].ret,1);</span>
<span class="lineNum">    2342 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(boxes[0].ret,gb_expandgluesame);</span>
<span class="lineNum">    2343 </span>            : 
<span class="lineNum">    2344 </span><span class="lineNoCov">          0 :     GHVBoxFitWindow(boxes[1].ret);</span>
<span class="lineNum">    2345 </span>            : 
<span class="lineNum">    2346 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<span class="lineNum">    2347 </span><span class="lineNoCov">          0 :     while ( !dvd.done )</span>
<span class="lineNum">    2348 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">    2349 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(gw);</span>
<span class="lineNum">    2350 </span><span class="lineNoCov">          0 :     if ( dvd.done==2 ) {</span>
<span class="lineNum">    2351 </span>            :         char *ret;
<span class="lineNum">    2352 </span><span class="lineNoCov">          0 :         DevTabToString(&amp;ret,&amp;dvd.devtab);</span>
<span class="lineNum">    2353 </span><span class="lineNoCov">          0 :         free(dvd.devtab.corrections);</span>
<span class="lineNum">    2354 </span><span class="lineNoCov">          0 : return( ret );</span>
<span class="lineNum">    2355 </span>            :     } else
<span class="lineNum">    2356 </span><span class="lineNoCov">          0 : return( copy(dvstr));</span>
<span class="lineNum">    2357 </span>            : }
<span class="lineNum">    2358 </span>            : 
<span class="lineNum">    2359 </span>            : static void finishedit(GGadget *g, int r, int c, int wasnew);
<span class="lineNum">    2360 </span>            : static void kernfinishedit(GGadget *g, int r, int c, int wasnew);
<span class="lineNum">    2361 </span>            : static void kerninit(GGadget *g, int r);
<span class="lineNum">    2362 </span>            : static void enable_enum(GGadget *g, GMenuItem *mi, int r, int c);
<span class="lineNum">    2363 </span>            : 
<span class="lineNum">    2364 </span>            : static struct col_init simplesubsci[] = {
<span class="lineNum">    2365 </span>            :     { me_enum , NULL, NULL, enable_enum, N_(&quot;Subtable&quot;) },
<span class="lineNum">    2366 </span>            :     { me_string, NULL, NULL, NULL, N_(&quot;Replacement Glyph Name&quot;) },
<span class="lineNum">    2367 </span>            :     COL_INIT_EMPTY
<span class="lineNum">    2368 </span>            : };
<span class="lineNum">    2369 </span>            : static struct col_init ligatureci[] = {
<span class="lineNum">    2370 </span>            :     { me_enum , NULL, NULL, NULL, N_(&quot;Subtable&quot;) },   /* There can be multiple ligatures for a glyph */
<span class="lineNum">    2371 </span>            :     { me_string, NULL, NULL, NULL, N_(&quot;Source Glyph Names&quot;) },
<span class="lineNum">    2372 </span>            :     COL_INIT_EMPTY
<span class="lineNum">    2373 </span>            : };
<span class="lineNum">    2374 </span>            : static struct col_init altsubsci[] = {
<span class="lineNum">    2375 </span>            :     { me_enum , NULL, NULL, enable_enum, N_(&quot;Subtable&quot;) },
<span class="lineNum">    2376 </span>            :     { me_string, NULL, NULL, NULL, N_(&quot;Replacement Glyph Names&quot;) },
<span class="lineNum">    2377 </span>            :     COL_INIT_EMPTY
<span class="lineNum">    2378 </span>            : };
<span class="lineNum">    2379 </span>            : static struct col_init multsubsci[] = {
<span class="lineNum">    2380 </span>            :     { me_enum , NULL, NULL, enable_enum, N_(&quot;Subtable&quot;) },
<span class="lineNum">    2381 </span>            :     { me_string, NULL, NULL, NULL, N_(&quot;Replacement Glyph Names&quot;) },
<span class="lineNum">    2382 </span>            :     COL_INIT_EMPTY
<span class="lineNum">    2383 </span>            : };
<span class="lineNum">    2384 </span>            : static struct col_init simpleposci[] = {
<span class="lineNum">    2385 </span>            :     { me_enum , NULL, NULL, enable_enum, N_(&quot;Subtable&quot;) },
<span class="lineNum">    2386 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆x&quot;) },        /* delta-x */
<span class="lineNum">    2387 </span>            : /* GT: &quot;Adjust&quot; here means Device Table based pixel adjustments, an OpenType */
<span class="lineNum">    2388 </span>            : /* GT: concept which allows small corrections for small pixel sizes where */
<span class="lineNum">    2389 </span>            : /* GT: rounding errors (in kerning for example) may smush too glyphs together */
<span class="lineNum">    2390 </span>            : /* GT: or space them too far apart. Generally not a problem for big pixelsizes*/
<span class="lineNum">    2391 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2392 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆y&quot;) },                /* delta-y */
<span class="lineNum">    2393 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2394 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆x_adv&quot;) },    /* delta-x-adv */
<span class="lineNum">    2395 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2396 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆y_adv&quot;) },    /* delta-y-adv */
<span class="lineNum">    2397 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2398 </span>            :     COL_INIT_EMPTY
<span class="lineNum">    2399 </span>            : };
<span class="lineNum">    2400 </span>            : static struct col_init pairposci[] = {
<span class="lineNum">    2401 </span>            :     { me_enum , NULL, NULL, NULL, N_(&quot;Subtable&quot;) },   /* There can be multiple kern-pairs for a glyph */
<span class="lineNum">    2402 </span>            :     { me_string , DevTab_Dlg, NULL, NULL, N_(&quot;Second Glyph Name&quot;) },
<span class="lineNum">    2403 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆x #1&quot;) },             /* delta-x */
<span class="lineNum">    2404 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2405 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆y #1&quot;) },             /* delta-y */
<span class="lineNum">    2406 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2407 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆x_adv #1&quot;) }, /* delta-x-adv */
<span class="lineNum">    2408 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2409 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆y_adv #1&quot;) }, /* delta-y-adv */
<span class="lineNum">    2410 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2411 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆x #2&quot;) },             /* delta-x */
<span class="lineNum">    2412 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2413 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆y #2&quot;) },             /* delta-y */
<span class="lineNum">    2414 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2415 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆x_adv #2&quot;) }, /* delta-x-adv */
<span class="lineNum">    2416 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2417 </span>            :     { me_int, NULL, NULL, NULL, NU_(&quot;∆y_adv #2&quot;) }, /* delta-y-adv */
<span class="lineNum">    2418 </span>            :     { me_funcedit, DevTab_Dlg, NULL, NULL, N_(&quot;Adjust&quot;) },
<span class="lineNum">    2419 </span>            :     COL_INIT_EMPTY
<span class="lineNum">    2420 </span>            : };
<span class="lineNum">    2421 </span>            : static int pst2lookuptype[] = { ot_undef, gpos_single, gpos_pair, gsub_single,
<span class="lineNum">    2422 </span>            :      gsub_alternate, gsub_multiple, gsub_ligature, 0 };
<span class="lineNum">    2423 </span>            : struct matrixinit mi[] = {
<span class="lineNum">    2424 </span>            :     { sizeof(simpleposci)/sizeof(struct col_init)-1, simpleposci, 0, NULL, NULL, NULL, finishedit, NULL, NULL, NULL },
<span class="lineNum">    2425 </span>            :     { sizeof(pairposci)/sizeof(struct col_init)-1, pairposci, 0, NULL, kerninit, NULL, kernfinishedit, NULL, NULL, NULL },
<span class="lineNum">    2426 </span>            :     { sizeof(simplesubsci)/sizeof(struct col_init)-1, simplesubsci, 0, NULL, NULL, NULL, finishedit, NULL, NULL, NULL },
<span class="lineNum">    2427 </span>            :     { sizeof(altsubsci)/sizeof(struct col_init)-1, altsubsci, 0, NULL, NULL, NULL, finishedit, NULL, NULL, NULL },
<span class="lineNum">    2428 </span>            :     { sizeof(multsubsci)/sizeof(struct col_init)-1, multsubsci, 0, NULL, NULL, NULL, finishedit, NULL, NULL, NULL },
<span class="lineNum">    2429 </span>            :     { sizeof(ligatureci)/sizeof(struct col_init)-1, ligatureci, 0, NULL, NULL, NULL, finishedit, NULL, NULL, NULL },
<span class="lineNum">    2430 </span>            :     MATRIXINIT_EMPTY
<a name="2431"><span class="lineNum">    2431 </span>            : };</a>
<span class="lineNum">    2432 </span>            : 
<span class="lineNum">    2433 </span><span class="lineNoCov">          0 : static void enable_enum(GGadget *g, GMenuItem *mi, int r, int c) {</span>
<span class="lineNum">    2434 </span>            :     int i,rows,j;
<span class="lineNum">    2435 </span>            :     struct matrix_data *possub;
<span class="lineNum">    2436 </span>            :     CharInfo *ci;
<span class="lineNum">    2437 </span>            :     int sel,cols;
<span class="lineNum">    2438 </span>            : 
<span class="lineNum">    2439 </span><span class="lineNoCov">          0 :     if ( c!=0 )</span>
<span class="lineNum">    2440 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2441 </span><span class="lineNoCov">          0 :     ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2442 </span><span class="lineNoCov">          0 :     sel = GTabSetGetSel(GWidgetGetControl(ci-&gt;gw,CID_Tabs))-2;</span>
<span class="lineNum">    2443 </span><span class="lineNoCov">          0 :     possub = GMatrixEditGet(g, &amp;rows);</span>
<span class="lineNum">    2444 </span><span class="lineNoCov">          0 :     cols = GMatrixEditGetColCnt(g);</span>
<span class="lineNum">    2445 </span>            : 
<span class="lineNum">    2446 </span><span class="lineNoCov">          0 :     ci-&gt;old_sub = (void *) possub[r*cols+0].u.md_ival;</span>
<span class="lineNum">    2447 </span>            : 
<span class="lineNum">    2448 </span><span class="lineNoCov">          0 :     for ( i=0; mi[i].ti.text!=NULL || mi[i].ti.line; ++i ) {</span>
<span class="lineNum">    2449 </span><span class="lineNoCov">          0 :         if ( mi[i].ti.line )    /* Lines, and the new entry always enabled */</span>
<span class="lineNum">    2450 </span><span class="lineNoCov">          0 :             mi[i].ti.disabled = false;</span>
<span class="lineNum">    2451 </span><span class="lineNoCov">          0 :         else if ( mi[i].ti.userdata == NULL )</span>
<span class="lineNum">    2452 </span>            :             /* One of the lookup (rather than subtable) entries. leave disabled */;
<span class="lineNum">    2453 </span><span class="lineNoCov">          0 :         else if ( mi[i].ti.userdata == (void *) possub[r*cols+0].u.md_ival ) {</span>
<span class="lineNum">    2454 </span><span class="lineNoCov">          0 :             mi[i].ti.selected = true;           /* Current thing, they can keep on using it */</span>
<span class="lineNum">    2455 </span><span class="lineNoCov">          0 :             mi[i].ti.disabled = false;</span>
<span class="lineNum">    2456 </span>            :         } else {
<span class="lineNum">    2457 </span><span class="lineNoCov">          0 :             for ( j=0; j&lt;rows; ++j )</span>
<span class="lineNum">    2458 </span><span class="lineNoCov">          0 :                 if ( mi[i].ti.userdata == (void *) possub[j*cols+0].u.md_ival ) {</span>
<span class="lineNum">    2459 </span><span class="lineNoCov">          0 :                     mi[i].ti.selected = false;</span>
<span class="lineNum">    2460 </span><span class="lineNoCov">          0 :                     mi[i].ti.disabled = true;</span>
<span class="lineNum">    2461 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2462 </span>            :                 }
<span class="lineNum">    2463 </span><span class="lineNoCov">          0 :             if ( j==rows ) {    /* This subtable hasn't been used yet */</span>
<span class="lineNum">    2464 </span><span class="lineNoCov">          0 :                 mi[i].ti.disabled = false;</span>
<span class="lineNum">    2465 </span>            :             }
<span class="lineNum">    2466 </span>            :         }
<span class="lineNum">    2467 </span>            :     }
<a name="2468"><span class="lineNum">    2468 </span>            : }</a>
<span class="lineNum">    2469 </span>            : 
<span class="lineNum">    2470 </span><span class="lineNoCov">          0 : void SCSubtableDefaultSubsCheck(SplineChar *sc, struct lookup_subtable *sub,</span>
<span class="lineNum">    2471 </span>            :         struct matrix_data *possub, int col_cnt, int r, int layer) {
<span class="lineNum">    2472 </span>            :     FeatureScriptLangList *fl;
<span class="lineNum">    2473 </span><span class="lineNoCov">          0 :     int lookup_type = sub-&gt;lookup-&gt;lookup_type;</span>
<span class="lineNum">    2474 </span>            :     SplineChar *alt;
<span class="lineNum">    2475 </span>            :     char buffer[8];
<span class="lineNum">    2476 </span>            :     int i;
<span class="lineNum">    2477 </span>            :     static uint32 form_tags[] = { CHR('i','n','i','t'), CHR('m','e','d','i'), CHR('f','i','n','a'), CHR('i','s','o','l'), 0 };
<span class="lineNum">    2478 </span>            :     real loff, roff;
<span class="lineNum">    2479 </span>            : 
<span class="lineNum">    2480 </span><span class="lineNoCov">          0 :     if ( lookup_type == gsub_single &amp;&amp; sub-&gt;suffix != NULL ) {</span>
<span class="lineNum">    2481 </span><span class="lineNoCov">          0 :         alt = SuffixCheck(sc,sub-&gt;suffix);</span>
<span class="lineNum">    2482 </span><span class="lineNoCov">          0 :         if ( alt!=NULL ) {</span>
<span class="lineNum">    2483 </span><span class="lineNoCov">          0 :             possub[r*col_cnt+1].u.md_str = copy( alt-&gt;name );</span>
<span class="lineNum">    2484 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2485 </span>            :         }
<span class="lineNum">    2486 </span>            :     }
<span class="lineNum">    2487 </span>            : 
<span class="lineNum">    2488 </span><span class="lineNoCov">          0 :     for ( fl = sub-&gt;lookup-&gt;features; fl!=NULL; fl=fl-&gt;next ) {</span>
<span class="lineNum">    2489 </span><span class="lineNoCov">          0 :         if ( lookup_type == gpos_single ) {</span>
<span class="lineNum">    2490 </span>            :             /* These too features are designed to crop off the left and right */
<span class="lineNum">    2491 </span>            :             /*  side bearings respectively */
<span class="lineNum">    2492 </span><span class="lineNoCov">          0 :             if ( fl-&gt;featuretag == CHR('l','f','b','d') ) {</span>
<span class="lineNum">    2493 </span><span class="lineNoCov">          0 :                 GuessOpticalOffset(sc,layer,&amp;loff,&amp;roff,0);</span>
<span class="lineNum">    2494 </span>            :                 /* Adjust horixontal positioning and horizontal advance by */
<span class="lineNum">    2495 </span>            :                 /*  the left side bearing */
<span class="lineNum">    2496 </span><span class="lineNoCov">          0 :                 possub[r*col_cnt+SIM_DX].u.md_ival = -loff;</span>
<span class="lineNum">    2497 </span><span class="lineNoCov">          0 :                 possub[r*col_cnt+SIM_DX_ADV].u.md_ival = -loff;</span>
<span class="lineNum">    2498 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2499 </span><span class="lineNoCov">          0 :             } else if ( fl-&gt;featuretag == CHR('r','t','b','d') ) {</span>
<span class="lineNum">    2500 </span><span class="lineNoCov">          0 :                 GuessOpticalOffset(sc,layer,&amp;loff,&amp;roff,0);</span>
<span class="lineNum">    2501 </span>            :                 /* Adjust horizontal advance by right side bearing */
<span class="lineNum">    2502 </span><span class="lineNoCov">          0 :                 possub[r*col_cnt+SIM_DX_ADV].u.md_ival = -roff;</span>
<span class="lineNum">    2503 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2504 </span>            :             }
<span class="lineNum">    2505 </span><span class="lineNoCov">          0 :         } else if ( lookup_type == gsub_single ) {</span>
<span class="lineNum">    2506 </span><span class="lineNoCov">          0 :             alt = NULL;</span>
<span class="lineNum">    2507 </span><span class="lineNoCov">          0 :             if ( fl-&gt;featuretag == CHR('s','m','c','p') ) {</span>
<span class="lineNum">    2508 </span><span class="lineNoCov">          0 :                 alt = SuffixCheck(sc,&quot;sc&quot;);</span>
<span class="lineNum">    2509 </span><span class="lineNoCov">          0 :                 if ( alt==NULL )</span>
<span class="lineNum">    2510 </span><span class="lineNoCov">          0 :                     alt = SuffixCheckCase(sc,&quot;small&quot;,false);</span>
<span class="lineNum">    2511 </span><span class="lineNoCov">          0 :             } else if ( fl-&gt;featuretag == CHR('c','2','s','c') ) {</span>
<span class="lineNum">    2512 </span><span class="lineNoCov">          0 :                 alt = SuffixCheck(sc,&quot;small&quot;);</span>
<span class="lineNum">    2513 </span><span class="lineNoCov">          0 :                 if ( alt==NULL )</span>
<span class="lineNum">    2514 </span><span class="lineNoCov">          0 :                     alt = SuffixCheckCase(sc,&quot;sc&quot;,true);</span>
<span class="lineNum">    2515 </span><span class="lineNoCov">          0 :             } else if ( fl-&gt;featuretag == CHR('r','t','l','a') ) {</span>
<span class="lineNum">    2516 </span><span class="lineNoCov">          0 :                 if ( sc-&gt;unicodeenc!=-1 &amp;&amp; sc-&gt;unicodeenc&lt;0x10000 &amp;&amp; tomirror(sc-&gt;unicodeenc)!=0 )</span>
<span class="lineNum">    2517 </span><span class="lineNoCov">          0 :                     alt = SFGetChar(sc-&gt;parent,tomirror(sc-&gt;unicodeenc),NULL);</span>
<span class="lineNum">    2518 </span><span class="lineNoCov">          0 :             } else if ( sc-&gt;unicodeenc==0x3c3 &amp;&amp; fl-&gt;featuretag==CHR('f','i','n','a') ) {</span>
<span class="lineNum">    2519 </span>            :                 /* Greek final sigma */
<span class="lineNum">    2520 </span><span class="lineNoCov">          0 :                 alt = SFGetChar(sc-&gt;parent,0x3c2,NULL);</span>
<span class="lineNum">    2521 </span>            :             }
<span class="lineNum">    2522 </span><span class="lineNoCov">          0 :             if ( alt==NULL ) {</span>
<span class="lineNum">    2523 </span><span class="lineNoCov">          0 :                 buffer[0] = fl-&gt;featuretag&gt;&gt;24;</span>
<span class="lineNum">    2524 </span><span class="lineNoCov">          0 :                 buffer[1] = fl-&gt;featuretag&gt;&gt;16;</span>
<span class="lineNum">    2525 </span><span class="lineNoCov">          0 :                 buffer[2] = fl-&gt;featuretag&gt;&gt;8;</span>
<span class="lineNum">    2526 </span><span class="lineNoCov">          0 :                 buffer[3] = fl-&gt;featuretag&amp;0xff;</span>
<span class="lineNum">    2527 </span><span class="lineNoCov">          0 :                 buffer[4] = 0;</span>
<span class="lineNum">    2528 </span><span class="lineNoCov">          0 :                 alt = SuffixCheck(sc,buffer);</span>
<span class="lineNum">    2529 </span>            :             }
<span class="lineNum">    2530 </span><span class="lineNoCov">          0 :             if ( alt==NULL &amp;&amp; sc-&gt;unicodeenc&gt;=0x600 &amp;&amp; sc-&gt;unicodeenc&lt;0x700 ) {</span>
<span class="lineNum">    2531 </span>            :                 /* Arabic forms */
<span class="lineNum">    2532 </span><span class="lineNoCov">          0 :                 for ( i=0; form_tags[i]!=0; ++i ) if ( form_tags[i]==fl-&gt;featuretag ) {</span>
<span class="lineNum">    2533 </span><span class="lineNoCov">          0 :                     if ( (&amp;(ArabicForms[sc-&gt;unicodeenc-0x600].initial))[i]!=0 &amp;&amp;</span>
<span class="lineNum">    2534 </span><span class="lineNoCov">          0 :                             (&amp;(ArabicForms[sc-&gt;unicodeenc-0x600].initial))[i]!=sc-&gt;unicodeenc &amp;&amp;</span>
<span class="lineNum">    2535 </span><span class="lineNoCov">          0 :                             (alt = SFGetChar(sc-&gt;parent,(&amp;(ArabicForms[sc-&gt;unicodeenc-0x600].initial))[i],NULL))!=NULL )</span>
<span class="lineNum">    2536 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    2537 </span>            :                 }
<span class="lineNum">    2538 </span>            :             }
<span class="lineNum">    2539 </span><span class="lineNoCov">          0 :             if ( alt!=NULL ) {</span>
<span class="lineNum">    2540 </span><span class="lineNoCov">          0 :                 possub[r*col_cnt+1].u.md_str = copy( alt-&gt;name );</span>
<span class="lineNum">    2541 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2542 </span>            :             }
<span class="lineNum">    2543 </span><span class="lineNoCov">          0 :         } else if ( lookup_type == gsub_ligature ) {</span>
<span class="lineNum">    2544 </span><span class="lineNoCov">          0 :             if ( fl-&gt;featuretag == LigTagFromUnicode(sc-&gt;unicodeenc) ) {</span>
<span class="lineNum">    2545 </span>            :                 int alt_index;
<span class="lineNum">    2546 </span><span class="lineNoCov">          0 :                 for ( alt_index = 0; ; ++alt_index ) {</span>
<span class="lineNum">    2547 </span><span class="lineNoCov">          0 :                     char *components = LigDefaultStr(sc-&gt;unicodeenc,sc-&gt;name,alt_index);</span>
<span class="lineNum">    2548 </span><span class="lineNoCov">          0 :                     if ( components==NULL )</span>
<span class="lineNum">    2549 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    2550 </span><span class="lineNoCov">          0 :                     for ( i=0; i&lt;r; ++i ) {</span>
<span class="lineNum">    2551 </span><span class="lineNoCov">          0 :                         if ( possub[i*col_cnt+0].u.md_ival == (intpt) sub &amp;&amp;</span>
<span class="lineNum">    2552 </span><span class="lineNoCov">          0 :                                 strcmp(possub[i*col_cnt+1].u.md_str,components)==0 )</span>
<span class="lineNum">    2553 </span><span class="lineNoCov">          0 :                     break;</span>
<span class="lineNum">    2554 </span>            :                     }
<span class="lineNum">    2555 </span><span class="lineNoCov">          0 :                     if ( i==r ) {</span>
<span class="lineNum">    2556 </span><span class="lineNoCov">          0 :                         possub[r*col_cnt+1].u.md_str = components;</span>
<span class="lineNum">    2557 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2558 </span>            :                     }
<span class="lineNum">    2559 </span><span class="lineNoCov">          0 :                     free( components );</span>
<span class="lineNum">    2560 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    2561 </span>            :             }
<span class="lineNum">    2562 </span>            :         }
<span class="lineNum">    2563 </span>            :     }
<a name="2564"><span class="lineNum">    2564 </span>            : }</a>
<span class="lineNum">    2565 </span>            : 
<span class="lineNum">    2566 </span><span class="lineNoCov">          0 : static void finishedit(GGadget *g, int r, int c, int wasnew) {</span>
<span class="lineNum">    2567 </span>            :     int rows;
<span class="lineNum">    2568 </span>            :     struct matrix_data *possub;
<span class="lineNum">    2569 </span>            :     CharInfo *ci;
<span class="lineNum">    2570 </span>            :     int sel,cols;
<span class="lineNum">    2571 </span>            :     struct lookup_subtable *sub;
<span class="lineNum">    2572 </span>            :     struct subtable_data sd;
<span class="lineNum">    2573 </span>            :     GTextInfo *ti;
<span class="lineNum">    2574 </span>            : 
<span class="lineNum">    2575 </span><span class="lineNoCov">          0 :     if ( c!=0 )</span>
<span class="lineNum">    2576 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2577 </span><span class="lineNoCov">          0 :     ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2578 </span><span class="lineNoCov">          0 :     sel = GTabSetGetSel(GWidgetGetControl(ci-&gt;gw,CID_Tabs))-2;</span>
<span class="lineNum">    2579 </span><span class="lineNoCov">          0 :     possub = GMatrixEditGet(g, &amp;rows);</span>
<span class="lineNum">    2580 </span><span class="lineNoCov">          0 :     cols = GMatrixEditGetColCnt(g);</span>
<span class="lineNum">    2581 </span><span class="lineNoCov">          0 :     if ( possub[r*cols+0].u.md_ival!=0 ) {</span>
<span class="lineNum">    2582 </span><span class="lineNoCov">          0 :         if ( wasnew )</span>
<span class="lineNum">    2583 </span><span class="lineNoCov">          0 :             SCSubtableDefaultSubsCheck(ci-&gt;sc,(struct lookup_subtable *) possub[r*cols+0].u.md_ival, possub,</span>
<span class="lineNum">    2584 </span>            :                     cols, r, ci-&gt;def_layer );
<span class="lineNum">    2585 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2586 </span>            :     }
<span class="lineNum">    2587 </span>            :     /* They asked to create a new subtable */
<span class="lineNum">    2588 </span>            : 
<span class="lineNum">    2589 </span><span class="lineNoCov">          0 :     memset(&amp;sd,0,sizeof(sd));</span>
<span class="lineNum">    2590 </span><span class="lineNoCov">          0 :     sd.flags = sdf_dontedit;</span>
<span class="lineNum">    2591 </span><span class="lineNoCov">          0 :     sub = SFNewLookupSubtableOfType(ci-&gt;sc-&gt;parent,pst2lookuptype[sel+1],&amp;sd,ci-&gt;def_layer);</span>
<span class="lineNum">    2592 </span><span class="lineNoCov">          0 :     if ( sub!=NULL ) {</span>
<span class="lineNum">    2593 </span><span class="lineNoCov">          0 :         possub[r*cols+0].u.md_ival = (intpt) sub;</span>
<span class="lineNum">    2594 </span><span class="lineNoCov">          0 :         ti = SFSubtableListOfType(ci-&gt;sc-&gt;parent, pst2lookuptype[sel+1], false, false);</span>
<span class="lineNum">    2595 </span><span class="lineNoCov">          0 :         GMatrixEditSetColumnChoices(g,0,ti);</span>
<span class="lineNum">    2596 </span><span class="lineNoCov">          0 :         GTextInfoListFree(ti);</span>
<span class="lineNum">    2597 </span><span class="lineNoCov">          0 :         if ( wasnew &amp;&amp; ci-&gt;cv!=NULL )</span>
<span class="lineNum">    2598 </span><span class="lineNoCov">          0 :             SCSubtableDefaultSubsCheck(ci-&gt;sc,sub, possub, cols, r, CVLayer((CharViewBase *) (ci-&gt;cv)));</span>
<span class="lineNum">    2599 </span><span class="lineNoCov">          0 :     } else if ( ci-&gt;old_sub!=NULL ) {</span>
<span class="lineNum">    2600 </span>            :         /* Restore old value */
<span class="lineNum">    2601 </span><span class="lineNoCov">          0 :         possub[r*cols+0].u.md_ival = (intpt) ci-&gt;old_sub;</span>
<span class="lineNum">    2602 </span>            :     } else {
<span class="lineNum">    2603 </span><span class="lineNoCov">          0 :         GMatrixEditDeleteRow(g,r);</span>
<span class="lineNum">    2604 </span>            :     }
<span class="lineNum">    2605 </span><span class="lineNoCov">          0 :     ci-&gt;old_sub = NULL;</span>
<span class="lineNum">    2606 </span><span class="lineNoCov">          0 :     GGadgetRedraw(g);</span>
<a name="2607"><span class="lineNum">    2607 </span>            : }</a>
<span class="lineNum">    2608 </span>            : 
<span class="lineNum">    2609 </span><span class="lineNoCov">          0 : static void kern_AddKP(void *data,SplineChar *left, SplineChar *right, int off) {</span>
<span class="lineNum">    2610 </span><span class="lineNoCov">          0 :     int *kp_offset = data;</span>
<span class="lineNum">    2611 </span><span class="lineNoCov">          0 :     *kp_offset = off;</span>
<a name="2612"><span class="lineNum">    2612 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2613 </span>            : 
<span class="lineNum">    2614 </span><span class="lineNoCov">          0 : static void kernfinishedit(GGadget *g, int r, int c, int wasnew) {</span>
<span class="lineNum">    2615 </span>            :     int rows;
<span class="lineNum">    2616 </span>            :     struct matrix_data *possub;
<span class="lineNum">    2617 </span>            :     CharInfo *ci;
<span class="lineNum">    2618 </span>            :     int cols;
<span class="lineNum">    2619 </span>            :     struct lookup_subtable *sub;
<span class="lineNum">    2620 </span>            :     SplineChar *lefts[2], *rights[2];
<span class="lineNum">    2621 </span><span class="lineNoCov">          0 :     int touch, separation, kp_offset=0;</span>
<span class="lineNum">    2622 </span>            :     SplineChar *osc;
<span class="lineNum">    2623 </span>            : 
<span class="lineNum">    2624 </span><span class="lineNoCov">          0 :     if ( c==1 ) {</span>
<span class="lineNum">    2625 </span><span class="lineNoCov">          0 :         ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2626 </span><span class="lineNoCov">          0 :         possub = GMatrixEditGet(g, &amp;rows);</span>
<span class="lineNum">    2627 </span><span class="lineNoCov">          0 :         cols = GMatrixEditGetColCnt(g);</span>
<span class="lineNum">    2628 </span><span class="lineNoCov">          0 :         sub = (struct lookup_subtable *) possub[r*cols+0].u.md_ival;</span>
<span class="lineNum">    2629 </span><span class="lineNoCov">          0 :         if ( possub[r*cols+PAIR_DX_ADV1].u.md_ival==0 &amp;&amp;</span>
<span class="lineNum">    2630 </span><span class="lineNoCov">          0 :                 possub[r*cols+1].u.md_str!=NULL &amp;&amp;</span>
<span class="lineNum">    2631 </span><span class="lineNoCov">          0 :                 (osc = SFGetChar(ci-&gt;sc-&gt;parent,-1,possub[r*cols+1].u.md_str))!=NULL ) {</span>
<span class="lineNum">    2632 </span><span class="lineNoCov">          0 :             lefts[1] = rights[1] = NULL;</span>
<span class="lineNum">    2633 </span><span class="lineNoCov">          0 :             if ( sub-&gt;lookup-&gt;lookup_flags &amp; pst_r2l ) {</span>
<span class="lineNum">    2634 </span><span class="lineNoCov">          0 :                 lefts[0] = osc;</span>
<span class="lineNum">    2635 </span><span class="lineNoCov">          0 :                 rights[0] = ci-&gt;sc;</span>
<span class="lineNum">    2636 </span>            :             } else {
<span class="lineNum">    2637 </span><span class="lineNoCov">          0 :                 lefts[0] = ci-&gt;sc;</span>
<span class="lineNum">    2638 </span><span class="lineNoCov">          0 :                 rights[0] = osc;</span>
<span class="lineNum">    2639 </span>            :             }
<span class="lineNum">    2640 </span><span class="lineNoCov">          0 :             touch = sub-&gt;kerning_by_touch;</span>
<span class="lineNum">    2641 </span><span class="lineNoCov">          0 :             separation = sub-&gt;separation;</span>
<span class="lineNum">    2642 </span><span class="lineNoCov">          0 :             if ( separation==0 &amp;&amp; !touch )</span>
<span class="lineNum">    2643 </span><span class="lineNoCov">          0 :                 separation = 15*(osc-&gt;parent-&gt;ascent+osc-&gt;parent-&gt;descent)/100;</span>
<span class="lineNum">    2644 </span><span class="lineNoCov">          0 :             AutoKern2(osc-&gt;parent,ci-&gt;def_layer,lefts,rights,sub,</span>
<span class="lineNum">    2645 </span>            :                     separation,0,touch,0,0,     /* Don't bother with minkern or onlyCloser, they asked for this, they get it, whatever it may be */
<span class="lineNum">    2646 </span>            :                     kern_AddKP,&amp;kp_offset);
<span class="lineNum">    2647 </span><span class="lineNoCov">          0 :             possub[r*cols+PAIR_DX_ADV1].u.md_ival=kp_offset;</span>
<span class="lineNum">    2648 </span>            :         }
<span class="lineNum">    2649 </span>            :     } else
<span class="lineNum">    2650 </span><span class="lineNoCov">          0 :         finishedit(g,r,c,wasnew);</span>
<a name="2651"><span class="lineNum">    2651 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2652 </span>            : 
<span class="lineNum">    2653 </span><span class="lineNoCov">          0 : static int SubHasScript(uint32 script,struct lookup_subtable *sub) {</span>
<span class="lineNum">    2654 </span>            :     FeatureScriptLangList *f;
<span class="lineNum">    2655 </span>            :     struct scriptlanglist *s;
<span class="lineNum">    2656 </span>            : 
<span class="lineNum">    2657 </span><span class="lineNoCov">          0 :     if ( sub==NULL )</span>
<span class="lineNum">    2658 </span><span class="lineNoCov">          0 : return(false);</span>
<span class="lineNum">    2659 </span><span class="lineNoCov">          0 :     for ( f = sub-&gt;lookup-&gt;features; f!=NULL; f=f-&gt;next ) {</span>
<span class="lineNum">    2660 </span><span class="lineNoCov">          0 :         for ( s=f-&gt;scripts; s!=NULL; s=s-&gt;next ) {</span>
<span class="lineNum">    2661 </span><span class="lineNoCov">          0 :             if ( s-&gt;script == script )</span>
<span class="lineNum">    2662 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    2663 </span>            :         }
<span class="lineNum">    2664 </span>            :     }
<span class="lineNum">    2665 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="2666"><span class="lineNum">    2666 </span>            : }</a>
<span class="lineNum">    2667 </span>            : 
<span class="lineNum">    2668 </span><span class="lineNoCov">          0 : static void kerninit(GGadget *g, int r) {</span>
<span class="lineNum">    2669 </span><span class="lineNoCov">          0 :     CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2670 </span><span class="lineNoCov">          0 :     GMenuItem *mi = GMatrixEditGetColumnChoices(g,0);</span>
<span class="lineNum">    2671 </span>            :     int i,cols,rows;
<span class="lineNum">    2672 </span>            :     struct matrix_data *possub;
<span class="lineNum">    2673 </span>            :     uint32 script;
<span class="lineNum">    2674 </span>            : 
<span class="lineNum">    2675 </span><span class="lineNoCov">          0 :     possub = GMatrixEditGet(g, &amp;rows);</span>
<span class="lineNum">    2676 </span><span class="lineNoCov">          0 :     cols = GMatrixEditGetColCnt(g);</span>
<span class="lineNum">    2677 </span>            : 
<span class="lineNum">    2678 </span><span class="lineNoCov">          0 :     if ( r!=0 )</span>
<span class="lineNum">    2679 </span><span class="lineNoCov">          0 :         possub[r*cols+0].u.md_ival = possub[(r-1)*cols+0].u.md_ival;</span>
<span class="lineNum">    2680 </span>            :     else {
<span class="lineNum">    2681 </span><span class="lineNoCov">          0 :         script = SCScriptFromUnicode(ci-&gt;sc);</span>
<span class="lineNum">    2682 </span><span class="lineNoCov">          0 :         for ( i=0; mi[i].ti.line || mi[i].ti.text!=NULL; ++i ) {</span>
<span class="lineNum">    2683 </span><span class="lineNoCov">          0 :             if ( SubHasScript(script,(struct lookup_subtable *) mi[i].ti.userdata ) )</span>
<span class="lineNum">    2684 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2685 </span>            :         }
<span class="lineNum">    2686 </span><span class="lineNoCov">          0 :         if ( mi[i].ti.line || mi[i].ti.text!=NULL )</span>
<span class="lineNum">    2687 </span><span class="lineNoCov">          0 :             possub[r*cols+0].u.md_ival = (intpt) mi[i].ti.userdata;</span>
<span class="lineNum">    2688 </span>            :     }
<a name="2689"><span class="lineNum">    2689 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2690 </span>            : 
<span class="lineNum">    2691 </span><span class="lineNoCov">          0 : static void CI_DoHideUnusedSingle(CharInfo *ci) {</span>
<span class="lineNum">    2692 </span><span class="lineNoCov">          0 :     GGadget *pstk = GWidgetGetControl(ci-&gt;gw,CID_List+(pst_position-1)*100);</span>
<span class="lineNum">    2693 </span><span class="lineNoCov">          0 :     int rows, cols = GMatrixEditGetColCnt(pstk);</span>
<span class="lineNum">    2694 </span><span class="lineNoCov">          0 :     struct matrix_data *old = GMatrixEditGet(pstk,&amp;rows);</span>
<span class="lineNum">    2695 </span>            :     uint8 cols_used[20];
<span class="lineNum">    2696 </span>            :     int r, col, tot;
<span class="lineNum">    2697 </span>            : 
<span class="lineNum">    2698 </span><span class="lineNoCov">          0 :     if ( lookup_hideunused ) {</span>
<span class="lineNum">    2699 </span><span class="lineNoCov">          0 :         memset(cols_used,0,sizeof(cols_used));</span>
<span class="lineNum">    2700 </span><span class="lineNoCov">          0 :         for ( r=0; r&lt;rows; ++r ) {</span>
<span class="lineNum">    2701 </span><span class="lineNoCov">          0 :             for ( col=1; col&lt;cols; col+=2 ) {</span>
<span class="lineNum">    2702 </span><span class="lineNoCov">          0 :                 if ( old[cols*r+col].u.md_ival!=0 )</span>
<span class="lineNum">    2703 </span><span class="lineNoCov">          0 :                     cols_used[col] = true;</span>
<span class="lineNum">    2704 </span><span class="lineNoCov">          0 :                 if ( old[cols*r+col+1].u.md_str!=NULL &amp;&amp; *old[cols*r+col+1].u.md_str!='\0' )</span>
<span class="lineNum">    2705 </span><span class="lineNoCov">          0 :                     cols_used[col+1] = true;</span>
<span class="lineNum">    2706 </span>            :             }
<span class="lineNum">    2707 </span>            :         }
<span class="lineNum">    2708 </span><span class="lineNoCov">          0 :         for ( col=1, tot=0; col&lt;cols; ++col )</span>
<span class="lineNum">    2709 </span><span class="lineNoCov">          0 :             tot += cols_used[col];</span>
<span class="lineNum">    2710 </span>            :         /* If no columns used (no info yet, all info is to preempt a kernclass and sets to 0) */
<span class="lineNum">    2711 </span>            :         /*  then show what we expect to be the default column for this kerning mode*/
<span class="lineNum">    2712 </span><span class="lineNoCov">          0 :         if ( tot==0 ) {</span>
<span class="lineNum">    2713 </span><span class="lineNoCov">          0 :             if ( strstr(ci-&gt;sc-&gt;name,&quot;.vert&quot;)!=NULL || strstr(ci-&gt;sc-&gt;name,&quot;.vrt2&quot;)!=NULL )</span>
<span class="lineNum">    2714 </span><span class="lineNoCov">          0 :                 cols_used[SIM_DY] = true;</span>
<span class="lineNum">    2715 </span>            :             else
<span class="lineNum">    2716 </span><span class="lineNoCov">          0 :                 cols_used[SIM_DX] = true;</span>
<span class="lineNum">    2717 </span>            :         }
<span class="lineNum">    2718 </span><span class="lineNoCov">          0 :         for ( col=1; col&lt;cols; ++col )</span>
<span class="lineNum">    2719 </span><span class="lineNoCov">          0 :             GMatrixEditShowColumn(pstk,col,cols_used[col]);</span>
<span class="lineNum">    2720 </span>            :     } else {
<span class="lineNum">    2721 </span><span class="lineNoCov">          0 :         for ( col=1; col&lt;cols; ++col )</span>
<span class="lineNum">    2722 </span><span class="lineNoCov">          0 :             GMatrixEditShowColumn(pstk,col,true);</span>
<span class="lineNum">    2723 </span>            :     }
<span class="lineNum">    2724 </span><span class="lineNoCov">          0 :     GWidgetToDesiredSize(ci-&gt;gw);</span>
<span class="lineNum">    2725 </span>            : 
<span class="lineNum">    2726 </span><span class="lineNoCov">          0 :     GGadgetRedraw(pstk);</span>
<a name="2727"><span class="lineNum">    2727 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2728 </span>            : 
<span class="lineNum">    2729 </span><span class="lineNoCov">          0 : static void CI_DoHideUnusedPair(CharInfo *ci) {</span>
<span class="lineNum">    2730 </span><span class="lineNoCov">          0 :     GGadget *pstk = GWidgetGetControl(ci-&gt;gw,CID_List+(pst_pair-1)*100);</span>
<span class="lineNum">    2731 </span><span class="lineNoCov">          0 :     int rows, cols = GMatrixEditGetColCnt(pstk);</span>
<span class="lineNum">    2732 </span><span class="lineNoCov">          0 :     struct matrix_data *old = GMatrixEditGet(pstk,&amp;rows);</span>
<span class="lineNum">    2733 </span>            :     uint8 cols_used[20];
<span class="lineNum">    2734 </span>            :     int r, col, tot;
<span class="lineNum">    2735 </span>            : 
<span class="lineNum">    2736 </span><span class="lineNoCov">          0 :     if ( lookup_hideunused ) {</span>
<span class="lineNum">    2737 </span><span class="lineNoCov">          0 :         memset(cols_used,0,sizeof(cols_used));</span>
<span class="lineNum">    2738 </span><span class="lineNoCov">          0 :         for ( r=0; r&lt;rows; ++r ) {</span>
<span class="lineNum">    2739 </span><span class="lineNoCov">          0 :             for ( col=2; col&lt;cols; col+=2 ) {</span>
<span class="lineNum">    2740 </span><span class="lineNoCov">          0 :                 if ( old[cols*r+col].u.md_ival!=0 )</span>
<span class="lineNum">    2741 </span><span class="lineNoCov">          0 :                     cols_used[col] = true;</span>
<span class="lineNum">    2742 </span><span class="lineNoCov">          0 :                 if ( old[cols*r+col+1].u.md_str!=NULL &amp;&amp; *old[cols*r+col+1].u.md_str!='\0' )</span>
<span class="lineNum">    2743 </span><span class="lineNoCov">          0 :                     cols_used[col+1] = true;</span>
<span class="lineNum">    2744 </span>            :             }
<span class="lineNum">    2745 </span>            :         }
<span class="lineNum">    2746 </span><span class="lineNoCov">          0 :         for ( col=2, tot=0; col&lt;cols; ++col )</span>
<span class="lineNum">    2747 </span><span class="lineNoCov">          0 :             tot += cols_used[col];</span>
<span class="lineNum">    2748 </span>            :         /* If no columns used (no info yet, all info is to preempt a kernclass and sets to 0) */
<span class="lineNum">    2749 </span>            :         /*  then show what we expect to be the default column for this kerning mode*/
<span class="lineNum">    2750 </span><span class="lineNoCov">          0 :         if ( tot==0 ) {</span>
<span class="lineNum">    2751 </span><span class="lineNoCov">          0 :             if ( strstr(ci-&gt;sc-&gt;name,&quot;.vert&quot;)!=NULL || strstr(ci-&gt;sc-&gt;name,&quot;.vrt2&quot;)!=NULL )</span>
<span class="lineNum">    2752 </span><span class="lineNoCov">          0 :                 cols_used[PAIR_DY_ADV1] = true;</span>
<span class="lineNum">    2753 </span><span class="lineNoCov">          0 :             else if ( SCRightToLeft(ci-&gt;sc))</span>
<span class="lineNum">    2754 </span><span class="lineNoCov">          0 :                 cols_used[PAIR_DX_ADV2] = true;</span>
<span class="lineNum">    2755 </span>            :             else
<span class="lineNum">    2756 </span><span class="lineNoCov">          0 :                 cols_used[PAIR_DX_ADV1] = true;</span>
<span class="lineNum">    2757 </span>            :         }
<span class="lineNum">    2758 </span><span class="lineNoCov">          0 :         for ( col=2; col&lt;cols; ++col )</span>
<span class="lineNum">    2759 </span><span class="lineNoCov">          0 :             GMatrixEditShowColumn(pstk,col,cols_used[col]);</span>
<span class="lineNum">    2760 </span>            :     } else {
<span class="lineNum">    2761 </span><span class="lineNoCov">          0 :         for ( col=2; col&lt;cols; ++col )</span>
<span class="lineNum">    2762 </span><span class="lineNoCov">          0 :             GMatrixEditShowColumn(pstk,col,true);</span>
<span class="lineNum">    2763 </span>            :     }
<span class="lineNum">    2764 </span><span class="lineNoCov">          0 :     GWidgetToDesiredSize(ci-&gt;gw);</span>
<span class="lineNum">    2765 </span>            : 
<span class="lineNum">    2766 </span><span class="lineNoCov">          0 :     GGadgetRedraw(pstk);</span>
<a name="2767"><span class="lineNum">    2767 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2768 </span>            : 
<span class="lineNum">    2769 </span><span class="lineNoCov">          0 : static int CI_HideUnusedPair(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2770 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">    2771 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2772 </span><span class="lineNoCov">          0 :         lookup_hideunused = GGadgetIsChecked(g);</span>
<span class="lineNum">    2773 </span><span class="lineNoCov">          0 :         CI_DoHideUnusedPair(ci);</span>
<span class="lineNum">    2774 </span><span class="lineNoCov">          0 :         GGadgetRedraw(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_pair-1)*100));</span>
<span class="lineNum">    2775 </span>            :     }
<span class="lineNum">    2776 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2777"><span class="lineNum">    2777 </span>            : }</a>
<span class="lineNum">    2778 </span>            : 
<span class="lineNum">    2779 </span><span class="lineNoCov">          0 : static int CI_HideUnusedSingle(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2780 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">    2781 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2782 </span><span class="lineNoCov">          0 :         lookup_hideunused = GGadgetIsChecked(g);</span>
<span class="lineNum">    2783 </span><span class="lineNoCov">          0 :         CI_DoHideUnusedSingle(ci);</span>
<span class="lineNum">    2784 </span><span class="lineNoCov">          0 :         GGadgetRedraw(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_position-1)*100));</span>
<span class="lineNum">    2785 </span>            :     }
<span class="lineNum">    2786 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2787"><span class="lineNum">    2787 </span>            : }</a>
<span class="lineNum">    2788 </span>            : 
<span class="lineNum">    2789 </span><span class="lineNoCov">          0 : static void CI_FreeKernedImage(const void *_ci, GImage *img) {</span>
<span class="lineNum">    2790 </span><span class="lineNoCov">          0 :     GImageDestroy(img);</span>
<span class="lineNum">    2791 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2792 </span>            : 
<a name="2793"><span class="lineNum">    2793 </span>            : static const int kern_popup_size = 100;</a>
<span class="lineNum">    2794 </span>            : 
<span class="lineNum">    2795 </span><span class="lineNoCov">          0 : static BDFChar *Rasterize(SplineChar *sc,int def_layer) {</span>
<span class="lineNum">    2796 </span><span class="lineNoCov">          0 :     void *freetypecontext=NULL;</span>
<span class="lineNum">    2797 </span>            :     BDFChar *ret;
<span class="lineNum">    2798 </span>            : 
<span class="lineNum">    2799 </span><span class="lineNoCov">          0 :     freetypecontext = FreeTypeFontContext(sc-&gt;parent,sc,sc-&gt;parent-&gt;fv,def_layer);</span>
<span class="lineNum">    2800 </span><span class="lineNoCov">          0 :     if ( freetypecontext!=NULL ) {</span>
<span class="lineNum">    2801 </span><span class="lineNoCov">          0 :         ret = SplineCharFreeTypeRasterize(freetypecontext,sc-&gt;orig_pos,kern_popup_size,72,8);</span>
<span class="lineNum">    2802 </span><span class="lineNoCov">          0 :         FreeTypeFreeContext(freetypecontext);</span>
<span class="lineNum">    2803 </span>            :     } else
<span class="lineNum">    2804 </span><span class="lineNoCov">          0 :         ret = SplineCharAntiAlias(sc,def_layer,kern_popup_size,4);</span>
<span class="lineNum">    2805 </span><span class="lineNoCov">          0 : return( ret );</span>
<a name="2806"><span class="lineNum">    2806 </span>            : }</a>
<span class="lineNum">    2807 </span>            : 
<span class="lineNum">    2808 </span><span class="lineNoCov">          0 : static GImage *CI_GetKernedImage(const void *_ci) {</span>
<span class="lineNum">    2809 </span><span class="lineNoCov">          0 :     CharInfo *ci = (CharInfo *) _ci;</span>
<span class="lineNum">    2810 </span><span class="lineNoCov">          0 :     GGadget *pstk = GWidgetGetControl(ci-&gt;gw,CID_List+(pst_pair-1)*100);</span>
<span class="lineNum">    2811 </span><span class="lineNoCov">          0 :     int rows, cols = GMatrixEditGetColCnt(pstk);</span>
<span class="lineNum">    2812 </span><span class="lineNoCov">          0 :     struct matrix_data *old = GMatrixEditGet(pstk,&amp;rows);</span>
<span class="lineNum">    2813 </span><span class="lineNoCov">          0 :     SplineChar *othersc = SFGetChar(ci-&gt;sc-&gt;parent,-1, old[cols*ci-&gt;r+1].u.md_str);</span>
<span class="lineNum">    2814 </span>            :     BDFChar *me, *other;
<span class="lineNum">    2815 </span><span class="lineNoCov">          0 :     double scale = kern_popup_size/(double) (ci-&gt;sc-&gt;parent-&gt;ascent+ci-&gt;sc-&gt;parent-&gt;descent);</span>
<span class="lineNum">    2816 </span>            :     int kern;
<span class="lineNum">    2817 </span>            :     int width, height, miny, maxy, minx, maxx;
<span class="lineNum">    2818 </span>            :     GImage *img;
<span class="lineNum">    2819 </span>            :     struct _GImage *base;
<span class="lineNum">    2820 </span>            :     Color fg, bg;
<span class="lineNum">    2821 </span>            :     int l,clut_scale;
<span class="lineNum">    2822 </span>            :     int x,y, xoffset, yoffset, coff1, coff2;
<span class="lineNum">    2823 </span><span class="lineNoCov">          0 :     struct lookup_subtable *sub = (struct lookup_subtable *) (old[cols*ci-&gt;r+0].u.md_ival);</span>
<span class="lineNum">    2824 </span>            : 
<span class="lineNum">    2825 </span><span class="lineNoCov">          0 :     if ( othersc==NULL )</span>
<span class="lineNum">    2826 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    2827 </span><span class="lineNoCov">          0 :     me = Rasterize(ci-&gt;sc,ci-&gt;def_layer);</span>
<span class="lineNum">    2828 </span><span class="lineNoCov">          0 :     other = Rasterize(othersc,ci-&gt;def_layer);</span>
<span class="lineNum">    2829 </span><span class="lineNoCov">          0 :     if ( sub-&gt;vertical_kerning ) {</span>
<span class="lineNum">    2830 </span><span class="lineNoCov">          0 :         int vwidth = rint(ci-&gt;sc-&gt;vwidth*scale);</span>
<span class="lineNum">    2831 </span><span class="lineNoCov">          0 :         kern = rint( old[cols*ci-&gt;r+PAIR_DY_ADV1].u.md_ival*scale );</span>
<span class="lineNum">    2832 </span><span class="lineNoCov">          0 :         miny = me-&gt;ymin + rint(old[cols*ci-&gt;r+PAIR_DY1].u.md_ival*scale);</span>
<span class="lineNum">    2833 </span><span class="lineNoCov">          0 :         maxy = me-&gt;ymax + rint(old[cols*ci-&gt;r+PAIR_DY1].u.md_ival*scale);</span>
<span class="lineNum">    2834 </span><span class="lineNoCov">          0 :         if ( miny &gt; vwidth + kern + rint(old[cols*ci-&gt;r+PAIR_DY2].u.md_ival*scale) + other-&gt;ymin )</span>
<span class="lineNum">    2835 </span><span class="lineNoCov">          0 :             miny = vwidth + kern + rint(old[cols*ci-&gt;r+PAIR_DY2].u.md_ival*scale) + other-&gt;ymin;</span>
<span class="lineNum">    2836 </span><span class="lineNoCov">          0 :         if ( maxy &lt; vwidth + kern + rint(old[cols*ci-&gt;r+PAIR_DY2].u.md_ival*scale) + other-&gt;ymax )</span>
<span class="lineNum">    2837 </span><span class="lineNoCov">          0 :             maxy = vwidth + kern + rint(old[cols*ci-&gt;r+PAIR_DY2].u.md_ival*scale) + other-&gt;ymax;</span>
<span class="lineNum">    2838 </span><span class="lineNoCov">          0 :         height = maxy - miny + 2;</span>
<span class="lineNum">    2839 </span><span class="lineNoCov">          0 :         minx = me-&gt;xmin + rint(old[cols*ci-&gt;r+PAIR_DX1].u.md_ival*scale); maxx = me-&gt;xmax + rint(old[cols*ci-&gt;r+PAIR_DX1].u.md_ival*scale);</span>
<span class="lineNum">    2840 </span><span class="lineNoCov">          0 :         if ( minx&gt;other-&gt;xmin + rint(old[cols*ci-&gt;r+PAIR_DX2].u.md_ival*scale) ) minx = other-&gt;xmin+ rint(old[cols*ci-&gt;r+PAIR_DX2].u.md_ival*scale) ;</span>
<span class="lineNum">    2841 </span><span class="lineNoCov">          0 :         if ( maxx&lt;other-&gt;xmax + rint(old[cols*ci-&gt;r+PAIR_DX2].u.md_ival*scale) ) maxx = other-&gt;xmax+ rint(old[cols*ci-&gt;r+PAIR_DX2].u.md_ival*scale) ;</span>
<span class="lineNum">    2842 </span>            : 
<span class="lineNum">    2843 </span><span class="lineNoCov">          0 :         img = GImageCreate(it_index,maxx-minx+2,height);</span>
<span class="lineNum">    2844 </span><span class="lineNoCov">          0 :         base = img-&gt;u.image;</span>
<span class="lineNum">    2845 </span><span class="lineNoCov">          0 :         memset(base-&gt;data,'\0',base-&gt;bytes_per_line*base-&gt;height);</span>
<span class="lineNum">    2846 </span>            : 
<span class="lineNum">    2847 </span><span class="lineNoCov">          0 :         yoffset = 1 + maxy - vwidth - kern - rint(old[cols*ci-&gt;r+PAIR_DY1].u.md_ival*scale);</span>
<span class="lineNum">    2848 </span><span class="lineNoCov">          0 :         xoffset = 1 - minx + rint(old[cols*ci-&gt;r+PAIR_DX1].u.md_ival*scale);</span>
<span class="lineNum">    2849 </span><span class="lineNoCov">          0 :         for ( y=me-&gt;ymin; y&lt;=me-&gt;ymax; ++y ) {</span>
<span class="lineNum">    2850 </span><span class="lineNoCov">          0 :             for ( x=me-&gt;xmin; x&lt;=me-&gt;xmax; ++x ) {</span>
<span class="lineNum">    2851 </span><span class="lineNoCov">          0 :                 base-&gt;data[(yoffset-y)*base-&gt;bytes_per_line + (x+xoffset)] =</span>
<span class="lineNum">    2852 </span><span class="lineNoCov">          0 :                         me-&gt;bitmap[(me-&gt;ymax-y)*me-&gt;bytes_per_line + (x-me-&gt;xmin)];</span>
<span class="lineNum">    2853 </span>            :             }
<span class="lineNum">    2854 </span>            :         }
<span class="lineNum">    2855 </span><span class="lineNoCov">          0 :         yoffset = 1 + maxy - rint(old[cols*ci-&gt;r+PAIR_DY2].u.md_ival*scale);</span>
<span class="lineNum">    2856 </span><span class="lineNoCov">          0 :         xoffset = 1 - minx + rint(old[cols*ci-&gt;r+PAIR_DX2].u.md_ival*scale);</span>
<span class="lineNum">    2857 </span><span class="lineNoCov">          0 :         for ( y=other-&gt;ymin; y&lt;=other-&gt;ymax; ++y ) {</span>
<span class="lineNum">    2858 </span><span class="lineNoCov">          0 :             for ( x=other-&gt;xmin; x&lt;=other-&gt;xmax; ++x ) {</span>
<span class="lineNum">    2859 </span><span class="lineNoCov">          0 :                 int n = other-&gt;bitmap[(other-&gt;ymax-y)*other-&gt;bytes_per_line + (x-other-&gt;xmin)];</span>
<span class="lineNum">    2860 </span><span class="lineNoCov">          0 :                 if ( n&gt;base-&gt;data[(yoffset-y)*base-&gt;bytes_per_line + (x+xoffset)] )</span>
<span class="lineNum">    2861 </span><span class="lineNoCov">          0 :                     base-&gt;data[(yoffset-y)*base-&gt;bytes_per_line + (x+xoffset)] = n;</span>
<span class="lineNum">    2862 </span>            :             }
<span class="lineNum">    2863 </span>            :         }
<span class="lineNum">    2864 </span>            :     } else {
<span class="lineNum">    2865 </span><span class="lineNoCov">          0 :         coff1 = coff2 = 0;</span>
<span class="lineNum">    2866 </span><span class="lineNoCov">          0 :         if ( sub-&gt;lookup-&gt;lookup_flags &amp; pst_r2l ) {</span>
<span class="lineNum">    2867 </span><span class="lineNoCov">          0 :             BDFChar *temp = me;</span>
<span class="lineNum">    2868 </span><span class="lineNoCov">          0 :             me = other;</span>
<span class="lineNum">    2869 </span><span class="lineNoCov">          0 :             other = temp;</span>
<span class="lineNum">    2870 </span><span class="lineNoCov">          0 :             coff1 = 8; coff2 = -8;</span>
<span class="lineNum">    2871 </span>            :         }
<span class="lineNum">    2872 </span><span class="lineNoCov">          0 :         kern = rint( old[cols*ci-&gt;r+PAIR_DX_ADV1+coff1].u.md_ival*scale );</span>
<span class="lineNum">    2873 </span><span class="lineNoCov">          0 :         minx = me-&gt;xmin + rint(old[cols*ci-&gt;r+PAIR_DX1+coff1].u.md_ival*scale);</span>
<span class="lineNum">    2874 </span><span class="lineNoCov">          0 :         maxx = me-&gt;xmax + rint(old[cols*ci-&gt;r+PAIR_DX1+coff1].u.md_ival*scale);</span>
<span class="lineNum">    2875 </span><span class="lineNoCov">          0 :         if ( minx &gt; me-&gt;width + kern + rint(old[cols*ci-&gt;r+PAIR_DX2+coff2].u.md_ival*scale) + other-&gt;xmin )</span>
<span class="lineNum">    2876 </span><span class="lineNoCov">          0 :             minx = me-&gt;width + kern + rint(old[cols*ci-&gt;r+PAIR_DX2+coff2].u.md_ival*scale) + other-&gt;xmin;</span>
<span class="lineNum">    2877 </span><span class="lineNoCov">          0 :         if ( maxx &lt; me-&gt;width + kern + rint(old[cols*ci-&gt;r+PAIR_DX2+coff2].u.md_ival*scale) + other-&gt;xmax )</span>
<span class="lineNum">    2878 </span><span class="lineNoCov">          0 :             maxx = me-&gt;width + kern + rint(old[cols*ci-&gt;r+PAIR_DX2+coff2].u.md_ival*scale) + other-&gt;xmax;</span>
<span class="lineNum">    2879 </span><span class="lineNoCov">          0 :         width = maxx - minx + 2;</span>
<span class="lineNum">    2880 </span><span class="lineNoCov">          0 :         miny = me-&gt;ymin + rint(old[cols*ci-&gt;r+PAIR_DY1+coff1].u.md_ival*scale); maxy = me-&gt;ymax + rint(old[cols*ci-&gt;r+PAIR_DY1+coff1].u.md_ival*scale);</span>
<span class="lineNum">    2881 </span><span class="lineNoCov">          0 :         if ( miny&gt;other-&gt;ymin + rint(old[cols*ci-&gt;r+PAIR_DY2+coff2].u.md_ival*scale) ) miny = other-&gt;ymin+ rint(old[cols*ci-&gt;r+PAIR_DY2+coff2].u.md_ival*scale) ;</span>
<span class="lineNum">    2882 </span><span class="lineNoCov">          0 :         if ( maxy&lt;other-&gt;ymax + rint(old[cols*ci-&gt;r+PAIR_DY2+coff2].u.md_ival*scale) ) maxy = other-&gt;ymax+ rint(old[cols*ci-&gt;r+PAIR_DY2+coff2].u.md_ival*scale) ;</span>
<span class="lineNum">    2883 </span>            : 
<span class="lineNum">    2884 </span><span class="lineNoCov">          0 :         img = GImageCreate(it_index,width,maxy-miny+2);</span>
<span class="lineNum">    2885 </span><span class="lineNoCov">          0 :         base = img-&gt;u.image;</span>
<span class="lineNum">    2886 </span><span class="lineNoCov">          0 :         memset(base-&gt;data,'\0',base-&gt;bytes_per_line*base-&gt;height);</span>
<span class="lineNum">    2887 </span>            : 
<span class="lineNum">    2888 </span><span class="lineNoCov">          0 :         xoffset = rint(old[cols*ci-&gt;r+PAIR_DX1+coff1].u.md_ival*scale) + 1 - minx;</span>
<span class="lineNum">    2889 </span><span class="lineNoCov">          0 :         yoffset = 1 + maxy - rint(old[cols*ci-&gt;r+PAIR_DY1+coff1].u.md_ival*scale);</span>
<span class="lineNum">    2890 </span><span class="lineNoCov">          0 :         for ( y=me-&gt;ymin; y&lt;=me-&gt;ymax; ++y ) {</span>
<span class="lineNum">    2891 </span><span class="lineNoCov">          0 :             for ( x=me-&gt;xmin; x&lt;=me-&gt;xmax; ++x ) {</span>
<span class="lineNum">    2892 </span><span class="lineNoCov">          0 :                 base-&gt;data[(yoffset-y)*base-&gt;bytes_per_line + (x+xoffset)] =</span>
<span class="lineNum">    2893 </span><span class="lineNoCov">          0 :                         me-&gt;bitmap[(me-&gt;ymax-y)*me-&gt;bytes_per_line + (x-me-&gt;xmin)];</span>
<span class="lineNum">    2894 </span>            :             }
<span class="lineNum">    2895 </span>            :         }
<span class="lineNum">    2896 </span><span class="lineNoCov">          0 :         xoffset = 1 - minx + me-&gt;width + kern - rint(old[cols*ci-&gt;r+PAIR_DX2+coff2].u.md_ival*scale);</span>
<span class="lineNum">    2897 </span><span class="lineNoCov">          0 :         yoffset = 1 + maxy - rint(old[cols*ci-&gt;r+PAIR_DY2+coff2].u.md_ival*scale);</span>
<span class="lineNum">    2898 </span><span class="lineNoCov">          0 :         for ( y=other-&gt;ymin; y&lt;=other-&gt;ymax; ++y ) {</span>
<span class="lineNum">    2899 </span><span class="lineNoCov">          0 :             for ( x=other-&gt;xmin; x&lt;=other-&gt;xmax; ++x ) {</span>
<span class="lineNum">    2900 </span><span class="lineNoCov">          0 :                 int n = other-&gt;bitmap[(other-&gt;ymax-y)*other-&gt;bytes_per_line + (x-other-&gt;xmin)];</span>
<span class="lineNum">    2901 </span><span class="lineNoCov">          0 :                 if ( n&gt;base-&gt;data[(yoffset-y)*base-&gt;bytes_per_line + (x+xoffset)] )</span>
<span class="lineNum">    2902 </span><span class="lineNoCov">          0 :                     base-&gt;data[(yoffset-y)*base-&gt;bytes_per_line + (x+xoffset)] = n;</span>
<span class="lineNum">    2903 </span>            :             }
<span class="lineNum">    2904 </span>            :         }
<span class="lineNum">    2905 </span>            :     }
<span class="lineNum">    2906 </span><span class="lineNoCov">          0 :     memset(base-&gt;clut,'\0',sizeof(*base-&gt;clut));</span>
<span class="lineNum">    2907 </span><span class="lineNoCov">          0 :     bg = GDrawGetDefaultBackground(NULL);</span>
<span class="lineNum">    2908 </span><span class="lineNoCov">          0 :     fg = GDrawGetDefaultForeground(NULL);</span>
<span class="lineNum">    2909 </span><span class="lineNoCov">          0 :     clut_scale = me-&gt;depth == 8 ? 8 : 4;</span>
<span class="lineNum">    2910 </span><span class="lineNoCov">          0 :     base-&gt;clut-&gt;clut_len = 1&lt;&lt;clut_scale;</span>
<span class="lineNum">    2911 </span><span class="lineNoCov">          0 :     for ( l=0; l&lt;(1&lt;&lt;clut_scale); ++l )</span>
<span class="lineNum">    2912 </span><span class="lineNoCov">          0 :         base-&gt;clut-&gt;clut[l] =</span>
<span class="lineNum">    2913 </span><span class="lineNoCov">          0 :             COLOR_CREATE(</span>
<span class="lineNum">    2914 </span>            :              COLOR_RED(bg) + (l*(COLOR_RED(fg)-COLOR_RED(bg)))/((1&lt;&lt;clut_scale)-1),
<span class="lineNum">    2915 </span>            :              COLOR_GREEN(bg) + (l*(COLOR_GREEN(fg)-COLOR_GREEN(bg)))/((1&lt;&lt;clut_scale)-1),
<span class="lineNum">    2916 </span>            :              COLOR_BLUE(bg) + (l*(COLOR_BLUE(fg)-COLOR_BLUE(bg)))/((1&lt;&lt;clut_scale)-1) );
<span class="lineNum">    2917 </span><span class="lineNoCov">          0 :     BDFCharFree(me);</span>
<span class="lineNum">    2918 </span><span class="lineNoCov">          0 :     BDFCharFree(other);</span>
<span class="lineNum">    2919 </span><span class="lineNoCov">          0 : return( img );</span>
<span class="lineNum">    2920 </span>            : }
<span class="lineNum">    2921 </span>            : 
<span class="lineNum">    2922 </span>            : /* Draws an image of a glyph with a vertical bar down the middle. */
<a name="2923"><span class="lineNum">    2923 </span>            : /*  used to show italic correction position (we also dot in the width line) */</a>
<span class="lineNum">    2924 </span>            : /*  and top accent horizontal position for the MATH table */
<span class="lineNum">    2925 </span><span class="lineNoCov">          0 : GImage *SC_GetLinedImage(SplineChar *sc, int def_layer, int pos, int is_italic_cor) {</span>
<span class="lineNum">    2926 </span>            :     BDFChar *me;
<span class="lineNum">    2927 </span><span class="lineNoCov">          0 :     double scale = kern_popup_size/(double) (sc-&gt;parent-&gt;ascent+sc-&gt;parent-&gt;descent);</span>
<span class="lineNum">    2928 </span>            :     int miny, maxy, minx, maxx;
<span class="lineNum">    2929 </span>            :     GImage *img;
<span class="lineNum">    2930 </span>            :     struct _GImage *base;
<span class="lineNum">    2931 </span>            :     Color fg, bg;
<span class="lineNum">    2932 </span>            :     int l,clut_scale;
<span class="lineNum">    2933 </span>            :     int x,y, xoffset, yoffset;
<span class="lineNum">    2934 </span>            :     int pixel;
<span class="lineNum">    2935 </span>            : 
<span class="lineNum">    2936 </span><span class="lineNoCov">          0 :     if ( is_italic_cor )</span>
<span class="lineNum">    2937 </span><span class="lineNoCov">          0 :         pos += sc-&gt;width;</span>
<span class="lineNum">    2938 </span><span class="lineNoCov">          0 :     pos = rint( pos*scale );</span>
<span class="lineNum">    2939 </span><span class="lineNoCov">          0 :     if ( pos&lt;-100 || pos&gt;100 )</span>
<span class="lineNum">    2940 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    2941 </span><span class="lineNoCov">          0 :     me = Rasterize(sc,def_layer);</span>
<span class="lineNum">    2942 </span><span class="lineNoCov">          0 :     if ( pos&lt;me-&gt;xmin-10 || pos&gt;me-&gt;xmax+30 ) {</span>
<span class="lineNum">    2943 </span><span class="lineNoCov">          0 :         BDFCharFree(me);</span>
<span class="lineNum">    2944 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    2945 </span>            :     }
<span class="lineNum">    2946 </span><span class="lineNoCov">          0 :     if ( (minx=me-&gt;xmin)&gt;0 ) minx = 0;</span>
<span class="lineNum">    2947 </span><span class="lineNoCov">          0 :     if ( (maxx=me-&gt;xmax)&lt;me-&gt;width ) maxx = me-&gt;width;</span>
<span class="lineNum">    2948 </span><span class="lineNoCov">          0 :     if ( pos&lt;minx ) minx = pos-2;</span>
<span class="lineNum">    2949 </span><span class="lineNoCov">          0 :     if ( pos&gt;maxx ) maxx = pos+2;</span>
<span class="lineNum">    2950 </span><span class="lineNoCov">          0 :     miny = me-&gt;ymin - 4;</span>
<span class="lineNum">    2951 </span><span class="lineNoCov">          0 :     maxy = me-&gt;ymax + 4;</span>
<span class="lineNum">    2952 </span>            : 
<span class="lineNum">    2953 </span><span class="lineNoCov">          0 :     pixel = me-&gt;depth == 8 ? 0xff : 0xf;</span>
<span class="lineNum">    2954 </span>            : 
<span class="lineNum">    2955 </span><span class="lineNoCov">          0 :     img = GImageCreate(it_index,maxx-minx+2,maxy-miny+2);</span>
<span class="lineNum">    2956 </span><span class="lineNoCov">          0 :     base = img-&gt;u.image;</span>
<span class="lineNum">    2957 </span><span class="lineNoCov">          0 :     memset(base-&gt;data,'\0',base-&gt;bytes_per_line*base-&gt;height);</span>
<span class="lineNum">    2958 </span>            : 
<span class="lineNum">    2959 </span><span class="lineNoCov">          0 :     xoffset = 1 - minx;</span>
<span class="lineNum">    2960 </span><span class="lineNoCov">          0 :     yoffset = 1 + maxy;</span>
<span class="lineNum">    2961 </span><span class="lineNoCov">          0 :     for ( y=me-&gt;ymin; y&lt;=me-&gt;ymax; ++y ) {</span>
<span class="lineNum">    2962 </span><span class="lineNoCov">          0 :         for ( x=me-&gt;xmin; x&lt;=me-&gt;xmax; ++x ) {</span>
<span class="lineNum">    2963 </span><span class="lineNoCov">          0 :             base-&gt;data[(yoffset-y)*base-&gt;bytes_per_line + (x+xoffset)] =</span>
<span class="lineNum">    2964 </span><span class="lineNoCov">          0 :                     me-&gt;bitmap[(me-&gt;ymax-y)*me-&gt;bytes_per_line + (x-me-&gt;xmin)];</span>
<span class="lineNum">    2965 </span>            :         }
<span class="lineNum">    2966 </span>            :     }
<span class="lineNum">    2967 </span><span class="lineNoCov">          0 :     for ( y=miny; y&lt;=maxy; ++y ) {</span>
<span class="lineNum">    2968 </span><span class="lineNoCov">          0 :         base-&gt;data[(yoffset-y)*base-&gt;bytes_per_line + (pos+xoffset)] = pixel;</span>
<span class="lineNum">    2969 </span><span class="lineNoCov">          0 :         if ( is_italic_cor &amp;&amp; (y&amp;1 ))</span>
<span class="lineNum">    2970 </span><span class="lineNoCov">          0 :             base-&gt;data[(yoffset-y)*base-&gt;bytes_per_line + (me-&gt;width+xoffset)] = pixel;</span>
<span class="lineNum">    2971 </span>            :     }
<span class="lineNum">    2972 </span>            :     
<span class="lineNum">    2973 </span><span class="lineNoCov">          0 :     memset(base-&gt;clut,'\0',sizeof(*base-&gt;clut));</span>
<span class="lineNum">    2974 </span><span class="lineNoCov">          0 :     bg = GDrawGetDefaultBackground(NULL);</span>
<span class="lineNum">    2975 </span><span class="lineNoCov">          0 :     fg = GDrawGetDefaultForeground(NULL);</span>
<span class="lineNum">    2976 </span><span class="lineNoCov">          0 :     clut_scale = me-&gt;depth == 8 ? 8 : 4;</span>
<span class="lineNum">    2977 </span><span class="lineNoCov">          0 :     base-&gt;clut-&gt;clut_len = 1&lt;&lt;clut_scale;</span>
<span class="lineNum">    2978 </span><span class="lineNoCov">          0 :     for ( l=0; l&lt;(1&lt;&lt;clut_scale); ++l )</span>
<span class="lineNum">    2979 </span><span class="lineNoCov">          0 :         base-&gt;clut-&gt;clut[l] =</span>
<span class="lineNum">    2980 </span><span class="lineNoCov">          0 :             COLOR_CREATE(</span>
<span class="lineNum">    2981 </span>            :              COLOR_RED(bg) + (l*(COLOR_RED(fg)-COLOR_RED(bg)))/((1&lt;&lt;clut_scale)-1),
<span class="lineNum">    2982 </span>            :              COLOR_GREEN(bg) + (l*(COLOR_GREEN(fg)-COLOR_GREEN(bg)))/((1&lt;&lt;clut_scale)-1),
<span class="lineNum">    2983 </span>            :              COLOR_BLUE(bg) + (l*(COLOR_BLUE(fg)-COLOR_BLUE(bg)))/((1&lt;&lt;clut_scale)-1) );
<span class="lineNum">    2984 </span><span class="lineNoCov">          0 :     BDFCharFree(me);</span>
<span class="lineNum">    2985 </span><span class="lineNoCov">          0 : return( img );</span>
<span class="lineNum">    2986 </span>            : }
<span class="lineNum">    2987 </span>            : 
<a name="2988"><span class="lineNum">    2988 </span>            : #define ICON_WIDTH 15</a>
<span class="lineNum">    2989 </span>            : 
<span class="lineNum">    2990 </span><span class="lineNoCov">          0 : GImage *GV_GetConstructedImage(SplineChar *sc,int def_layer,struct glyphvariants *gv, int is_horiz) {</span>
<span class="lineNum">    2991 </span><span class="lineNoCov">          0 :     SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">    2992 </span>            :     BDFChar *me, **others;
<span class="lineNum">    2993 </span><span class="lineNoCov">          0 :     double scale = kern_popup_size/(double) (sf-&gt;ascent+sf-&gt;descent);</span>
<span class="lineNum">    2994 </span>            :     GImage *img;
<span class="lineNum">    2995 </span>            :     struct _GImage *base;
<span class="lineNum">    2996 </span>            :     Color fg, bg;
<span class="lineNum">    2997 </span>            :     int l,clut_scale;
<span class="lineNum">    2998 </span>            :     int x,y;
<span class="lineNum">    2999 </span>            :     int i,j;
<span class="lineNum">    3000 </span>            : 
<span class="lineNum">    3001 </span><span class="lineNoCov">          0 :     if ( gv==NULL || gv-&gt;part_cnt==0 )</span>
<span class="lineNum">    3002 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    3003 </span><span class="lineNoCov">          0 :     me = Rasterize(sc,def_layer);</span>
<span class="lineNum">    3004 </span><span class="lineNoCov">          0 :     others = malloc(gv-&gt;part_cnt*sizeof(BDFChar *));</span>
<span class="lineNum">    3005 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;gv-&gt;part_cnt; ++i ) {</span>
<span class="lineNum">    3006 </span><span class="lineNoCov">          0 :         SplineChar *othersc = SFGetChar(sf,-1,gv-&gt;parts[i].component);</span>
<span class="lineNum">    3007 </span><span class="lineNoCov">          0 :         if ( othersc==NULL ) {</span>
<span class="lineNum">    3008 </span><span class="lineNoCov">          0 :             for ( j=0; j&lt;i; ++j )</span>
<span class="lineNum">    3009 </span><span class="lineNoCov">          0 :                 BDFCharFree(others[j]);</span>
<span class="lineNum">    3010 </span><span class="lineNoCov">          0 :             free(others);</span>
<span class="lineNum">    3011 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    3012 </span>            :         }
<span class="lineNum">    3013 </span><span class="lineNoCov">          0 :         others[i] = Rasterize(othersc,def_layer);</span>
<span class="lineNum">    3014 </span>            :     }
<span class="lineNum">    3015 </span><span class="lineNoCov">          0 :     if ( is_horiz ) {</span>
<span class="lineNum">    3016 </span>            :         int ymin, ymax;
<span class="lineNum">    3017 </span>            :         int width, xoff;
<span class="lineNum">    3018 </span>            : 
<span class="lineNum">    3019 </span><span class="lineNoCov">          0 :         for ( i=1; i&lt;gv-&gt;part_cnt; ++i ) {        /* Normalize all but first. Makes construction easier */</span>
<span class="lineNum">    3020 </span><span class="lineNoCov">          0 :             others[i]-&gt;xmax -= others[i]-&gt;xmin;</span>
<span class="lineNum">    3021 </span><span class="lineNoCov">          0 :             others[i]-&gt;xmin = 0;</span>
<span class="lineNum">    3022 </span>            :         }
<span class="lineNum">    3023 </span><span class="lineNoCov">          0 :         xoff = me-&gt;xmin&lt;0 ? -me-&gt;xmin : 0;</span>
<span class="lineNum">    3024 </span><span class="lineNoCov">          0 :         width = xoff + me-&gt;width + ICON_WIDTH;</span>
<span class="lineNum">    3025 </span><span class="lineNoCov">          0 :         ymin = me-&gt;ymin; ymax = me-&gt;ymax;</span>
<span class="lineNum">    3026 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;gv-&gt;part_cnt; ++i ) {</span>
<span class="lineNum">    3027 </span>            :             int overlap;
<span class="lineNum">    3028 </span><span class="lineNoCov">          0 :             if ( i==gv-&gt;part_cnt-1 )</span>
<span class="lineNum">    3029 </span><span class="lineNoCov">          0 :                 overlap=0;</span>
<span class="lineNum">    3030 </span>            :             else {
<span class="lineNum">    3031 </span><span class="lineNoCov">          0 :                 overlap = gv-&gt;parts[i].endConnectorLength&gt;gv-&gt;parts[i+1].startConnectorLength ?</span>
<span class="lineNum">    3032 </span><span class="lineNoCov">          0 :                         gv-&gt;parts[i+1].startConnectorLength :</span>
<span class="lineNum">    3033 </span>            :                         gv-&gt;parts[i].endConnectorLength;
<span class="lineNum">    3034 </span><span class="lineNoCov">          0 :                 overlap = rint( scale*overlap );</span>
<span class="lineNum">    3035 </span>            :             }
<span class="lineNum">    3036 </span><span class="lineNoCov">          0 :             width += rint(gv-&gt;parts[i].fullAdvance*scale) - overlap + others[i]-&gt;xmin/* Only does anything if i==0, then it normalizes the rest to the same baseline */;</span>
<span class="lineNum">    3037 </span><span class="lineNoCov">          0 :             if ( others[i]-&gt;ymin&lt;ymin ) ymin = others[i]-&gt;ymin;</span>
<span class="lineNum">    3038 </span><span class="lineNoCov">          0 :             if ( others[i]-&gt;ymax&gt;ymax ) ymax = others[i]-&gt;ymax;</span>
<span class="lineNum">    3039 </span>            :         }
<span class="lineNum">    3040 </span><span class="lineNoCov">          0 :         if ( ymax&lt;=ICON_WIDTH ) ymax = ICON_WIDTH;</span>
<span class="lineNum">    3041 </span><span class="lineNoCov">          0 :         if ( ymin&gt;0 ) ymin = 0;</span>
<span class="lineNum">    3042 </span><span class="lineNoCov">          0 :         img = GImageCreate(it_index,width+10,ymax-ymin+2);</span>
<span class="lineNum">    3043 </span><span class="lineNoCov">          0 :         base = img-&gt;u.image;</span>
<span class="lineNum">    3044 </span><span class="lineNoCov">          0 :         memset(base-&gt;data,'\0',base-&gt;bytes_per_line*base-&gt;height);</span>
<span class="lineNum">    3045 </span>            : 
<span class="lineNum">    3046 </span><span class="lineNoCov">          0 :         ++xoff;         /* One pixel margin */</span>
<span class="lineNum">    3047 </span>            : 
<span class="lineNum">    3048 </span><span class="lineNoCov">          0 :         for ( y=me-&gt;ymin; y&lt;=me-&gt;ymax; ++y ) {</span>
<span class="lineNum">    3049 </span><span class="lineNoCov">          0 :             for ( x=me-&gt;xmin; x&lt;=me-&gt;xmax; ++x ) {</span>
<span class="lineNum">    3050 </span><span class="lineNoCov">          0 :                 base-&gt;data[(1+ymax-y)*base-&gt;bytes_per_line + (x+xoff)] =</span>
<span class="lineNum">    3051 </span><span class="lineNoCov">          0 :                         me-&gt;bitmap[(me-&gt;ymax-y)*me-&gt;bytes_per_line + (x-me-&gt;xmin)];</span>
<span class="lineNum">    3052 </span>            :             }
<span class="lineNum">    3053 </span>            :         }
<span class="lineNum">    3054 </span><span class="lineNoCov">          0 :         xoff += me-&gt;width;</span>
<span class="lineNum">    3055 </span>            :         {
<span class="lineNum">    3056 </span><span class="lineNoCov">          0 :             int pixel = me-&gt;depth == 8 ? 0xff : 0xf;</span>
<span class="lineNum">    3057 </span><span class="lineNoCov">          0 :             for ( j = -1; j&lt;2; j+=2 ) {</span>
<span class="lineNum">    3058 </span><span class="lineNoCov">          0 :                 if ( me-&gt;ymax&lt;-me-&gt;ymin )</span>
<span class="lineNum">    3059 </span><span class="lineNoCov">          0 :                     y = (me-&gt;ymax+me-&gt;ymin)/2;</span>
<span class="lineNum">    3060 </span>            :                 else
<span class="lineNum">    3061 </span><span class="lineNoCov">          0 :                     y = 1+me-&gt;ymax/2;</span>
<span class="lineNum">    3062 </span><span class="lineNoCov">          0 :                 y = ymax-y + j*2;</span>
<span class="lineNum">    3063 </span><span class="lineNoCov">          0 :                 for ( x=1; x&lt;ICON_WIDTH-5; ++x )</span>
<span class="lineNum">    3064 </span><span class="lineNoCov">          0 :                     base-&gt;data[y*base-&gt;bytes_per_line + (x+xoff)] = pixel;</span>
<span class="lineNum">    3065 </span><span class="lineNoCov">          0 :                 for ( x=ICON_WIDTH-8; x&lt;ICON_WIDTH-1; ++x )</span>
<span class="lineNum">    3066 </span><span class="lineNoCov">          0 :                     base-&gt;data[(y+j*(ICON_WIDTH-4-x))*base-&gt;bytes_per_line + (x+xoff)] = pixel;</span>
<span class="lineNum">    3067 </span>            :             }
<span class="lineNum">    3068 </span><span class="lineNoCov">          0 :             xoff += ICON_WIDTH;</span>
<span class="lineNum">    3069 </span>            :         }
<span class="lineNum">    3070 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;gv-&gt;part_cnt; ++i ) {</span>
<span class="lineNum">    3071 </span>            :             int overlap;
<span class="lineNum">    3072 </span><span class="lineNoCov">          0 :             if ( i==gv-&gt;part_cnt-1 )</span>
<span class="lineNum">    3073 </span><span class="lineNoCov">          0 :                 overlap=0;</span>
<span class="lineNum">    3074 </span>            :             else {
<span class="lineNum">    3075 </span><span class="lineNoCov">          0 :                 overlap = gv-&gt;parts[i].endConnectorLength&gt;gv-&gt;parts[i+1].startConnectorLength ?</span>
<span class="lineNum">    3076 </span><span class="lineNoCov">          0 :                         gv-&gt;parts[i+1].startConnectorLength :</span>
<span class="lineNum">    3077 </span>            :                         gv-&gt;parts[i].endConnectorLength;
<span class="lineNum">    3078 </span><span class="lineNoCov">          0 :                 overlap = rint( scale*overlap );</span>
<span class="lineNum">    3079 </span>            :             }
<span class="lineNum">    3080 </span><span class="lineNoCov">          0 :             for ( y=others[i]-&gt;ymin; y&lt;=others[i]-&gt;ymax; ++y ) {</span>
<span class="lineNum">    3081 </span><span class="lineNoCov">          0 :                 for ( x=others[i]-&gt;xmin; x&lt;=others[i]-&gt;xmax; ++x ) {</span>
<span class="lineNum">    3082 </span><span class="lineNoCov">          0 :                     int n = others[i]-&gt;bitmap[(others[i]-&gt;ymax-y)*others[i]-&gt;bytes_per_line + (x-others[i]-&gt;xmin)];</span>
<span class="lineNum">    3083 </span><span class="lineNoCov">          0 :                     if ( n&gt;base-&gt;data[(ymax-y)*base-&gt;bytes_per_line + (x+xoff)] )</span>
<span class="lineNum">    3084 </span><span class="lineNoCov">          0 :                         base-&gt;data[(ymax-y)*base-&gt;bytes_per_line + (x+xoff)] = n;</span>
<span class="lineNum">    3085 </span>            :                 }
<span class="lineNum">    3086 </span>            :             }
<span class="lineNum">    3087 </span><span class="lineNoCov">          0 :             xoff += rint(gv-&gt;parts[i].fullAdvance*scale) - overlap + others[i]-&gt;xmin/* Only does anything if i==0, then it normalizes the rest to the same baseline */;</span>
<span class="lineNum">    3088 </span>            :         }
<span class="lineNum">    3089 </span>            :     } else {
<span class="lineNum">    3090 </span>            :         int xmin, xmax, ymin, ymax;
<span class="lineNum">    3091 </span>            :         int yoff, xoff, width;
<span class="lineNum">    3092 </span>            : 
<span class="lineNum">    3093 </span><span class="lineNoCov">          0 :         for ( i=1; i&lt;gv-&gt;part_cnt; ++i ) {        /* Normalize all but first. Makes construction easier */</span>
<span class="lineNum">    3094 </span><span class="lineNoCov">          0 :             others[i]-&gt;ymax -= others[i]-&gt;ymin;</span>
<span class="lineNum">    3095 </span><span class="lineNoCov">          0 :             others[i]-&gt;ymin = 0;</span>
<span class="lineNum">    3096 </span>            :         }
<span class="lineNum">    3097 </span>            : 
<span class="lineNum">    3098 </span><span class="lineNoCov">          0 :         xoff = me-&gt;xmin&lt;0 ? -me-&gt;xmin : 0;</span>
<span class="lineNum">    3099 </span><span class="lineNoCov">          0 :         width = xoff + me-&gt;width + ICON_WIDTH;</span>
<span class="lineNum">    3100 </span><span class="lineNoCov">          0 :         ymin = me-&gt;ymin; ymax = me-&gt;ymax;</span>
<span class="lineNum">    3101 </span><span class="lineNoCov">          0 :         xmin = xmax = 0;</span>
<span class="lineNum">    3102 </span><span class="lineNoCov">          0 :         yoff = 0;</span>
<span class="lineNum">    3103 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;gv-&gt;part_cnt; ++i ) {</span>
<span class="lineNum">    3104 </span>            :             int overlap;
<span class="lineNum">    3105 </span><span class="lineNoCov">          0 :             if ( i==gv-&gt;part_cnt-1 )</span>
<span class="lineNum">    3106 </span><span class="lineNoCov">          0 :                 overlap=0;</span>
<span class="lineNum">    3107 </span>            :             else {
<span class="lineNum">    3108 </span><span class="lineNoCov">          0 :                 overlap = gv-&gt;parts[i].endConnectorLength&gt;gv-&gt;parts[i+1].startConnectorLength ?</span>
<span class="lineNum">    3109 </span><span class="lineNoCov">          0 :                         gv-&gt;parts[i+1].startConnectorLength :</span>
<span class="lineNum">    3110 </span>            :                         gv-&gt;parts[i].endConnectorLength;
<span class="lineNum">    3111 </span><span class="lineNoCov">          0 :                 overlap = rint( scale*overlap );</span>
<span class="lineNum">    3112 </span>            :             }
<span class="lineNum">    3113 </span><span class="lineNoCov">          0 :             if ( ymin&gt;others[i]-&gt;ymin+yoff ) ymin = others[i]-&gt;ymin+yoff;</span>
<span class="lineNum">    3114 </span><span class="lineNoCov">          0 :             if ( ymax&lt;others[i]-&gt;ymax+yoff ) ymax = others[i]-&gt;ymax+yoff;</span>
<span class="lineNum">    3115 </span><span class="lineNoCov">          0 :             yoff += rint(gv-&gt;parts[i].fullAdvance*scale) - overlap + others[i]-&gt;ymin/* Only does anything if i==0, then it normalizes the rest to the same baseline */;</span>
<span class="lineNum">    3116 </span><span class="lineNoCov">          0 :             if ( others[i]-&gt;xmin&lt;xmin ) xmin = others[i]-&gt;xmin;</span>
<span class="lineNum">    3117 </span><span class="lineNoCov">          0 :             if ( others[i]-&gt;xmax&gt;xmax ) xmax = others[i]-&gt;xmax;</span>
<span class="lineNum">    3118 </span>            :         }
<span class="lineNum">    3119 </span><span class="lineNoCov">          0 :         if ( xmin&lt;-width ) {</span>
<span class="lineNum">    3120 </span><span class="lineNoCov">          0 :             xoff = -xmin-width;</span>
<span class="lineNum">    3121 </span><span class="lineNoCov">          0 :             width = -xmin;</span>
<span class="lineNum">    3122 </span>            :         }
<span class="lineNum">    3123 </span><span class="lineNoCov">          0 :         if ( xmax&gt;0 )</span>
<span class="lineNum">    3124 </span><span class="lineNoCov">          0 :             width += xmax;</span>
<span class="lineNum">    3125 </span><span class="lineNoCov">          0 :         if ( ymax&lt;=ICON_WIDTH ) ymax = ICON_WIDTH;</span>
<span class="lineNum">    3126 </span><span class="lineNoCov">          0 :         if ( ymin&gt;0 ) ymin = 0;</span>
<span class="lineNum">    3127 </span><span class="lineNoCov">          0 :         img = GImageCreate(it_index,width+2,ymax-ymin+2);</span>
<span class="lineNum">    3128 </span><span class="lineNoCov">          0 :         base = img-&gt;u.image;</span>
<span class="lineNum">    3129 </span><span class="lineNoCov">          0 :         memset(base-&gt;data,'\0',base-&gt;bytes_per_line*base-&gt;height);</span>
<span class="lineNum">    3130 </span>            : 
<span class="lineNum">    3131 </span><span class="lineNoCov">          0 :         ++xoff;         /* One pixel margin */</span>
<span class="lineNum">    3132 </span>            : 
<span class="lineNum">    3133 </span><span class="lineNoCov">          0 :         for ( y=me-&gt;ymin; y&lt;=me-&gt;ymax; ++y ) {</span>
<span class="lineNum">    3134 </span><span class="lineNoCov">          0 :             for ( x=me-&gt;xmin; x&lt;=me-&gt;xmax; ++x ) {</span>
<span class="lineNum">    3135 </span><span class="lineNoCov">          0 :                 base-&gt;data[(1+ymax-y)*base-&gt;bytes_per_line + (x+xoff)] =</span>
<span class="lineNum">    3136 </span><span class="lineNoCov">          0 :                         me-&gt;bitmap[(me-&gt;ymax-y)*me-&gt;bytes_per_line + (x-me-&gt;xmin)];</span>
<span class="lineNum">    3137 </span>            :             }
<span class="lineNum">    3138 </span>            :         }
<span class="lineNum">    3139 </span><span class="lineNoCov">          0 :         xoff += me-&gt;width;</span>
<span class="lineNum">    3140 </span>            :         {
<span class="lineNum">    3141 </span><span class="lineNoCov">          0 :             int pixel = me-&gt;depth == 8 ? 0xff : 0xf;</span>
<span class="lineNum">    3142 </span><span class="lineNoCov">          0 :             for ( j = -1; j&lt;2; j+=2 ) {</span>
<span class="lineNum">    3143 </span><span class="lineNoCov">          0 :                 if ( me-&gt;ymax&lt;-me-&gt;ymin )</span>
<span class="lineNum">    3144 </span><span class="lineNoCov">          0 :                     y = (me-&gt;ymax+me-&gt;ymin)/2;</span>
<span class="lineNum">    3145 </span>            :                 else
<span class="lineNum">    3146 </span><span class="lineNoCov">          0 :                     y = 1+me-&gt;ymax/2;</span>
<span class="lineNum">    3147 </span><span class="lineNoCov">          0 :                 y = ymax-y + j*2;</span>
<span class="lineNum">    3148 </span><span class="lineNoCov">          0 :                 for ( x=1; x&lt;ICON_WIDTH-5; ++x )</span>
<span class="lineNum">    3149 </span><span class="lineNoCov">          0 :                     base-&gt;data[y*base-&gt;bytes_per_line + (x+xoff)] = pixel;</span>
<span class="lineNum">    3150 </span><span class="lineNoCov">          0 :                 for ( x=ICON_WIDTH-8; x&lt;ICON_WIDTH-1; ++x )</span>
<span class="lineNum">    3151 </span><span class="lineNoCov">          0 :                     base-&gt;data[(y+j*(ICON_WIDTH-4-x))*base-&gt;bytes_per_line + (x+xoff)] = pixel;</span>
<span class="lineNum">    3152 </span>            :             }
<span class="lineNum">    3153 </span><span class="lineNoCov">          0 :             xoff += ICON_WIDTH;</span>
<span class="lineNum">    3154 </span>            :         }
<span class="lineNum">    3155 </span><span class="lineNoCov">          0 :         yoff=0;</span>
<span class="lineNum">    3156 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;gv-&gt;part_cnt; ++i ) {</span>
<span class="lineNum">    3157 </span>            :             int overlap;
<span class="lineNum">    3158 </span><span class="lineNoCov">          0 :             if ( i==gv-&gt;part_cnt-1 )</span>
<span class="lineNum">    3159 </span><span class="lineNoCov">          0 :                 overlap=0;</span>
<span class="lineNum">    3160 </span>            :             else {
<span class="lineNum">    3161 </span><span class="lineNoCov">          0 :                 overlap = gv-&gt;parts[i].endConnectorLength&gt;gv-&gt;parts[i+1].startConnectorLength ?</span>
<span class="lineNum">    3162 </span><span class="lineNoCov">          0 :                         gv-&gt;parts[i+1].startConnectorLength :</span>
<span class="lineNum">    3163 </span>            :                         gv-&gt;parts[i].endConnectorLength;
<span class="lineNum">    3164 </span><span class="lineNoCov">          0 :                 overlap = rint( scale*overlap );</span>
<span class="lineNum">    3165 </span>            :             }
<span class="lineNum">    3166 </span><span class="lineNoCov">          0 :             for ( y=others[i]-&gt;ymin; y&lt;=others[i]-&gt;ymax; ++y ) {</span>
<span class="lineNum">    3167 </span><span class="lineNoCov">          0 :                 for ( x=others[i]-&gt;xmin; x&lt;=others[i]-&gt;xmax; ++x ) {</span>
<span class="lineNum">    3168 </span><span class="lineNoCov">          0 :                     int n = others[i]-&gt;bitmap[(others[i]-&gt;ymax-y)*others[i]-&gt;bytes_per_line + (x-others[i]-&gt;xmin)];</span>
<span class="lineNum">    3169 </span><span class="lineNoCov">          0 :                     if ( n&gt;base-&gt;data[(ymax-y-yoff)*base-&gt;bytes_per_line + (x+xoff)] )</span>
<span class="lineNum">    3170 </span><span class="lineNoCov">          0 :                         base-&gt;data[(ymax-y-yoff)*base-&gt;bytes_per_line + (x+xoff)] = n;</span>
<span class="lineNum">    3171 </span>            :                 }
<span class="lineNum">    3172 </span>            :             }
<span class="lineNum">    3173 </span><span class="lineNoCov">          0 :             yoff += rint(gv-&gt;parts[i].fullAdvance*scale) - overlap + others[i]-&gt;ymin/* Only does anything if i==0, then it normalizes the rest to the same baseline */;</span>
<span class="lineNum">    3174 </span>            :         }
<span class="lineNum">    3175 </span>            :     }
<span class="lineNum">    3176 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;gv-&gt;part_cnt; ++i )</span>
<span class="lineNum">    3177 </span><span class="lineNoCov">          0 :         BDFCharFree(others[i]);</span>
<span class="lineNum">    3178 </span><span class="lineNoCov">          0 :     free(others);</span>
<span class="lineNum">    3179 </span>            : 
<span class="lineNum">    3180 </span><span class="lineNoCov">          0 :     memset(base-&gt;clut,'\0',sizeof(*base-&gt;clut));</span>
<span class="lineNum">    3181 </span><span class="lineNoCov">          0 :     bg = GDrawGetDefaultBackground(NULL);</span>
<span class="lineNum">    3182 </span><span class="lineNoCov">          0 :     fg = GDrawGetDefaultForeground(NULL);</span>
<span class="lineNum">    3183 </span><span class="lineNoCov">          0 :     clut_scale = me-&gt;depth == 8 ? 8 : 4;</span>
<span class="lineNum">    3184 </span><span class="lineNoCov">          0 :     BDFCharFree(me);</span>
<span class="lineNum">    3185 </span><span class="lineNoCov">          0 :     base-&gt;clut-&gt;clut_len = 1&lt;&lt;clut_scale;</span>
<span class="lineNum">    3186 </span><span class="lineNoCov">          0 :     for ( l=0; l&lt;(1&lt;&lt;clut_scale); ++l )</span>
<span class="lineNum">    3187 </span><span class="lineNoCov">          0 :         base-&gt;clut-&gt;clut[l] =</span>
<span class="lineNum">    3188 </span><span class="lineNoCov">          0 :             COLOR_CREATE(</span>
<span class="lineNum">    3189 </span>            :              COLOR_RED(bg) + (l*(COLOR_RED(fg)-COLOR_RED(bg)))/((1&lt;&lt;clut_scale)-1),
<span class="lineNum">    3190 </span>            :              COLOR_GREEN(bg) + (l*(COLOR_GREEN(fg)-COLOR_GREEN(bg)))/((1&lt;&lt;clut_scale)-1),
<span class="lineNum">    3191 </span>            :              COLOR_BLUE(bg) + (l*(COLOR_BLUE(fg)-COLOR_BLUE(bg)))/((1&lt;&lt;clut_scale)-1) );
<span class="lineNum">    3192 </span><span class="lineNoCov">          0 : return( img );</span>
<a name="3193"><span class="lineNum">    3193 </span>            : }</a>
<span class="lineNum">    3194 </span>            : 
<span class="lineNum">    3195 </span><span class="lineNoCov">          0 : static GImage *CI_GetConstructedImage(const void *_ci) {</span>
<span class="lineNum">    3196 </span><span class="lineNoCov">          0 :     CharInfo *ci = (CharInfo *) _ci;</span>
<span class="lineNum">    3197 </span>            :     GImage *ret;
<span class="lineNum">    3198 </span><span class="lineNoCov">          0 :     int is_horiz = GTabSetGetSel(GWidgetGetControl(ci-&gt;gw,CID_Tabs))-ci-&gt;vert_aspect;</span>
<span class="lineNum">    3199 </span>            :     struct glyphvariants *gv;
<span class="lineNum">    3200 </span>            : 
<span class="lineNum">    3201 </span><span class="lineNoCov">          0 :     gv = CI_ParseVariants(NULL,ci,is_horiz,NULL,0,true);</span>
<span class="lineNum">    3202 </span>            : 
<span class="lineNum">    3203 </span><span class="lineNoCov">          0 :     ret = GV_GetConstructedImage(ci-&gt;sc,ci-&gt;def_layer,gv,is_horiz);</span>
<span class="lineNum">    3204 </span><span class="lineNoCov">          0 :     GlyphVariantsFree(gv);</span>
<span class="lineNum">    3205 </span><span class="lineNoCov">          0 : return( ret );</span>
<a name="3206"><span class="lineNum">    3206 </span>            : }</a>
<span class="lineNum">    3207 </span>            : 
<span class="lineNum">    3208 </span><span class="lineNoCov">          0 : GImage *NameList_GetImage(SplineFont *sf,SplineChar *sc,int def_layer,</span>
<span class="lineNum">    3209 </span>            :         char *namelist, int isliga ) {
<span class="lineNum">    3210 </span>            :     BDFChar *me, **extras;
<span class="lineNum">    3211 </span>            :     int width, xmin, xmax, ymin, ymax;
<span class="lineNum">    3212 </span>            :     GImage *img;
<span class="lineNum">    3213 </span>            :     struct _GImage *base;
<span class="lineNum">    3214 </span>            :     Color fg, bg;
<span class="lineNum">    3215 </span>            :     int l,clut_scale;
<span class="lineNum">    3216 </span>            :     int x,y;
<span class="lineNum">    3217 </span>            :     SplineChar *other;
<span class="lineNum">    3218 </span>            :     int extracnt;
<span class="lineNum">    3219 </span>            :     int i,j;
<span class="lineNum">    3220 </span><span class="lineNoCov">          0 :     char *subs = namelist, *pt, *start;</span>
<span class="lineNum">    3221 </span>            :     int ch;
<span class="lineNum">    3222 </span>            : 
<span class="lineNum">    3223 </span><span class="lineNoCov">          0 :     if ( sc==NULL || sf==NULL || namelist==NULL )</span>
<span class="lineNum">    3224 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    3225 </span><span class="lineNoCov">          0 :     me = Rasterize(sc,def_layer);</span>
<span class="lineNum">    3226 </span><span class="lineNoCov">          0 :     ymin = me-&gt;ymin; ymax = me-&gt;ymax;</span>
<span class="lineNum">    3227 </span><span class="lineNoCov">          0 :     xmin = me-&gt;xmin; xmax = me-&gt;xmax; width = me-&gt;width;</span>
<span class="lineNum">    3228 </span><span class="lineNoCov">          0 :     extracnt = 0; extras = NULL;</span>
<span class="lineNum">    3229 </span>            : 
<span class="lineNum">    3230 </span><span class="lineNoCov">          0 :     for ( pt=subs; *pt ; ++extracnt ) {</span>
<span class="lineNum">    3231 </span><span class="lineNoCov">          0 :         while ( *pt!=' ' &amp;&amp; *pt!='\0' ) ++pt;</span>
<span class="lineNum">    3232 </span><span class="lineNoCov">          0 :         if ( *pt==' ' )</span>
<span class="lineNum">    3233 </span><span class="lineNoCov">          0 :             while ( *pt==' ' ) ++pt;</span>
<span class="lineNum">    3234 </span>            :     }
<span class="lineNum">    3235 </span><span class="lineNoCov">          0 :     extras = malloc(extracnt*sizeof(BDFChar *));</span>
<span class="lineNum">    3236 </span><span class="lineNoCov">          0 :     extracnt = 0;</span>
<span class="lineNum">    3237 </span><span class="lineNoCov">          0 :     for ( pt=subs; *pt ; ) {</span>
<span class="lineNum">    3238 </span><span class="lineNoCov">          0 :         start = pt;</span>
<span class="lineNum">    3239 </span><span class="lineNoCov">          0 :         while ( *pt!=' ' &amp;&amp; *pt!='\0' &amp;&amp; *pt!='(' ) ++pt;</span>
<span class="lineNum">    3240 </span><span class="lineNoCov">          0 :         ch = *pt; *pt = '\0';</span>
<span class="lineNum">    3241 </span><span class="lineNoCov">          0 :         other = SFGetChar(sf,-1, start);</span>
<span class="lineNum">    3242 </span><span class="lineNoCov">          0 :         *pt = ch;</span>
<span class="lineNum">    3243 </span><span class="lineNoCov">          0 :         if ( ch=='(' ) {</span>
<span class="lineNum">    3244 </span><span class="lineNoCov">          0 :             while ( *pt!=')' &amp;&amp; *pt!='\0' ) ++pt;</span>
<span class="lineNum">    3245 </span><span class="lineNoCov">          0 :             if ( *pt==')' ) ++pt;</span>
<span class="lineNum">    3246 </span>            :         }
<span class="lineNum">    3247 </span><span class="lineNoCov">          0 :         if ( other!=NULL ) {</span>
<span class="lineNum">    3248 </span><span class="lineNoCov">          0 :             if ( extracnt==0 ) width += ICON_WIDTH;</span>
<span class="lineNum">    3249 </span><span class="lineNoCov">          0 :             extras[extracnt] = Rasterize(other,def_layer);</span>
<span class="lineNum">    3250 </span><span class="lineNoCov">          0 :             if ( width+extras[extracnt]-&gt;xmin &lt; xmin ) xmin = width+extras[extracnt]-&gt;xmin;</span>
<span class="lineNum">    3251 </span><span class="lineNoCov">          0 :             if ( width+extras[extracnt]-&gt;xmax &gt; xmax ) xmax = width+extras[extracnt]-&gt;xmax;</span>
<span class="lineNum">    3252 </span><span class="lineNoCov">          0 :             if ( extras[extracnt]-&gt;ymin &lt; ymin ) ymin = extras[extracnt]-&gt;ymin;</span>
<span class="lineNum">    3253 </span><span class="lineNoCov">          0 :             if ( extras[extracnt]-&gt;ymax &gt; ymax ) ymax = extras[extracnt]-&gt;ymax;</span>
<span class="lineNum">    3254 </span><span class="lineNoCov">          0 :             width += extras[extracnt++]-&gt;width;</span>
<span class="lineNum">    3255 </span>            :         }
<span class="lineNum">    3256 </span><span class="lineNoCov">          0 :         if ( *pt==' ' )</span>
<span class="lineNum">    3257 </span><span class="lineNoCov">          0 :             while ( *pt==' ' ) ++pt;</span>
<span class="lineNum">    3258 </span>            :     }
<span class="lineNum">    3259 </span>            : 
<span class="lineNum">    3260 </span><span class="lineNoCov">          0 :     if ( ymax&lt;=ICON_WIDTH ) ymax = ICON_WIDTH;</span>
<span class="lineNum">    3261 </span><span class="lineNoCov">          0 :     if ( ymin&gt;0 ) ymin = 0;</span>
<span class="lineNum">    3262 </span><span class="lineNoCov">          0 :     if ( xmax&lt;xmin ) {</span>
<span class="lineNum">    3263 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;extracnt; ++i )</span>
<span class="lineNum">    3264 </span><span class="lineNoCov">          0 :             BDFCharFree(extras[i]);</span>
<span class="lineNum">    3265 </span><span class="lineNoCov">          0 :         free(extras);</span>
<span class="lineNum">    3266 </span><span class="lineNoCov">          0 :         return( NULL );</span>
<span class="lineNum">    3267 </span>            :     }
<span class="lineNum">    3268 </span>            : 
<span class="lineNum">    3269 </span><span class="lineNoCov">          0 :     if ( xmin&gt;0 ) xmin = 0;</span>
<span class="lineNum">    3270 </span>            : 
<span class="lineNum">    3271 </span><span class="lineNoCov">          0 :     img = GImageCreate(it_index,xmax - xmin + 2,ymax-ymin+2);</span>
<span class="lineNum">    3272 </span><span class="lineNoCov">          0 :     base = img-&gt;u.image;</span>
<span class="lineNum">    3273 </span><span class="lineNoCov">          0 :     memset(base-&gt;data,'\0',base-&gt;bytes_per_line*base-&gt;height);</span>
<span class="lineNum">    3274 </span>            : 
<span class="lineNum">    3275 </span><span class="lineNoCov">          0 :     width = -xmin;</span>
<span class="lineNum">    3276 </span><span class="lineNoCov">          0 :     ++width;</span>
<span class="lineNum">    3277 </span>            : 
<span class="lineNum">    3278 </span><span class="lineNoCov">          0 :     for ( y=me-&gt;ymin; y&lt;=me-&gt;ymax; ++y ) {</span>
<span class="lineNum">    3279 </span><span class="lineNoCov">          0 :         for ( x=me-&gt;xmin; x&lt;=me-&gt;xmax; ++x ) {</span>
<span class="lineNum">    3280 </span><span class="lineNoCov">          0 :             base-&gt;data[(1+ymax-y)*base-&gt;bytes_per_line + (x+width)] =</span>
<span class="lineNum">    3281 </span><span class="lineNoCov">          0 :                     me-&gt;bitmap[(me-&gt;ymax-y)*me-&gt;bytes_per_line + (x-me-&gt;xmin)];</span>
<span class="lineNum">    3282 </span>            :         }
<span class="lineNum">    3283 </span>            :     }
<span class="lineNum">    3284 </span><span class="lineNoCov">          0 :     width += me-&gt;width;</span>
<span class="lineNum">    3285 </span><span class="lineNoCov">          0 :     if ( extracnt!=0 ) {</span>
<span class="lineNum">    3286 </span><span class="lineNoCov">          0 :         int pixel = me-&gt;depth == 8 ? 0xff : 0xf;</span>
<span class="lineNum">    3287 </span><span class="lineNoCov">          0 :         if ( !isliga ) {</span>
<span class="lineNum">    3288 </span><span class="lineNoCov">          0 :             for ( j = -1; j&lt;2; j+=2 ) {</span>
<span class="lineNum">    3289 </span><span class="lineNoCov">          0 :                 if ( me-&gt;ymax&lt;-me-&gt;ymin )</span>
<span class="lineNum">    3290 </span><span class="lineNoCov">          0 :                     y = (me-&gt;ymax+me-&gt;ymin)/2;</span>
<span class="lineNum">    3291 </span>            :                 else
<span class="lineNum">    3292 </span><span class="lineNoCov">          0 :                     y = 1+me-&gt;ymax/2;</span>
<span class="lineNum">    3293 </span><span class="lineNoCov">          0 :                 y = ymax-y + j*2;</span>
<span class="lineNum">    3294 </span><span class="lineNoCov">          0 :                 for ( x=1; x&lt;ICON_WIDTH-5; ++x )</span>
<span class="lineNum">    3295 </span><span class="lineNoCov">          0 :                     base-&gt;data[y*base-&gt;bytes_per_line + (x+width)] = pixel;</span>
<span class="lineNum">    3296 </span><span class="lineNoCov">          0 :                 for ( x=ICON_WIDTH-8; x&lt;ICON_WIDTH-1; ++x )</span>
<span class="lineNum">    3297 </span><span class="lineNoCov">          0 :                     base-&gt;data[(y+j*(ICON_WIDTH-4-x))*base-&gt;bytes_per_line + (x+width)] = pixel;</span>
<span class="lineNum">    3298 </span>            :             }
<span class="lineNum">    3299 </span><span class="lineNoCov">          0 :         } else if ( isliga&gt;0 ) {</span>
<span class="lineNum">    3300 </span><span class="lineNoCov">          0 :             for ( j = -1; j&lt;2; j+=2 ) {</span>
<span class="lineNum">    3301 </span><span class="lineNoCov">          0 :                 y = 1+ymax/2 + j*2;</span>
<span class="lineNum">    3302 </span><span class="lineNoCov">          0 :                 for ( x=5; x&lt;ICON_WIDTH-1; ++x )</span>
<span class="lineNum">    3303 </span><span class="lineNoCov">          0 :                     base-&gt;data[y*base-&gt;bytes_per_line + (x+width)] = pixel;</span>
<span class="lineNum">    3304 </span><span class="lineNoCov">          0 :                 for ( x=8; x&gt;1 ; --x )</span>
<span class="lineNum">    3305 </span><span class="lineNoCov">          0 :                     base-&gt;data[(y+j*(x-3))*base-&gt;bytes_per_line + (x+width)] = pixel;</span>
<span class="lineNum">    3306 </span>            :             }
<span class="lineNum">    3307 </span>            :         }
<span class="lineNum">    3308 </span><span class="lineNoCov">          0 :         width += ICON_WIDTH;</span>
<span class="lineNum">    3309 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;extracnt; ++i ) {</span>
<span class="lineNum">    3310 </span><span class="lineNoCov">          0 :             BDFChar *other = extras[i];</span>
<span class="lineNum">    3311 </span><span class="lineNoCov">          0 :             for ( y=other-&gt;ymin; y&lt;=other-&gt;ymax; ++y ) {</span>
<span class="lineNum">    3312 </span><span class="lineNoCov">          0 :                 for ( x=other-&gt;xmin; x&lt;=other-&gt;xmax; ++x ) {</span>
<span class="lineNum">    3313 </span><span class="lineNoCov">          0 :                     if ( other-&gt;bitmap[(other-&gt;ymax-y)*other-&gt;bytes_per_line + (x-other-&gt;xmin)] != 0 )</span>
<span class="lineNum">    3314 </span><span class="lineNoCov">          0 :                         base-&gt;data[(1+ymax-y)*base-&gt;bytes_per_line + (x+width)] =</span>
<span class="lineNum">    3315 </span><span class="lineNoCov">          0 :                                 other-&gt;bitmap[(other-&gt;ymax-y)*other-&gt;bytes_per_line + (x-other-&gt;xmin)];</span>
<span class="lineNum">    3316 </span>            :                 }
<span class="lineNum">    3317 </span>            :             }
<span class="lineNum">    3318 </span><span class="lineNoCov">          0 :             width += other-&gt;width;</span>
<span class="lineNum">    3319 </span>            :         }
<span class="lineNum">    3320 </span>            :     }
<span class="lineNum">    3321 </span><span class="lineNoCov">          0 :     memset(base-&gt;clut,'\0',sizeof(*base-&gt;clut));</span>
<span class="lineNum">    3322 </span><span class="lineNoCov">          0 :     bg = GDrawGetDefaultBackground(NULL);</span>
<span class="lineNum">    3323 </span><span class="lineNoCov">          0 :     fg = GDrawGetDefaultForeground(NULL);</span>
<span class="lineNum">    3324 </span><span class="lineNoCov">          0 :     clut_scale = me-&gt;depth == 8 ? 8 : 4;</span>
<span class="lineNum">    3325 </span><span class="lineNoCov">          0 :     base-&gt;clut-&gt;clut_len = 1&lt;&lt;clut_scale;</span>
<span class="lineNum">    3326 </span><span class="lineNoCov">          0 :     for ( l=0; l&lt;(1&lt;&lt;clut_scale); ++l )</span>
<span class="lineNum">    3327 </span><span class="lineNoCov">          0 :         base-&gt;clut-&gt;clut[l] =</span>
<span class="lineNum">    3328 </span><span class="lineNoCov">          0 :             COLOR_CREATE(</span>
<span class="lineNum">    3329 </span>            :              COLOR_RED(bg) + (l*(COLOR_RED(fg)-COLOR_RED(bg)))/((1&lt;&lt;clut_scale)-1),
<span class="lineNum">    3330 </span>            :              COLOR_GREEN(bg) + (l*(COLOR_GREEN(fg)-COLOR_GREEN(bg)))/((1&lt;&lt;clut_scale)-1),
<span class="lineNum">    3331 </span>            :              COLOR_BLUE(bg) + (l*(COLOR_BLUE(fg)-COLOR_BLUE(bg)))/((1&lt;&lt;clut_scale)-1) );
<span class="lineNum">    3332 </span><span class="lineNoCov">          0 :      BDFCharFree(me);</span>
<span class="lineNum">    3333 </span><span class="lineNoCov">          0 :      for ( i=0; i&lt;extracnt; ++i )</span>
<span class="lineNum">    3334 </span><span class="lineNoCov">          0 :          BDFCharFree(extras[i]);</span>
<span class="lineNum">    3335 </span><span class="lineNoCov">          0 :      free(extras);</span>
<span class="lineNum">    3336 </span><span class="lineNoCov">          0 : return( img );</span>
<a name="3337"><span class="lineNum">    3337 </span>            : }</a>
<span class="lineNum">    3338 </span>            : 
<span class="lineNum">    3339 </span><span class="lineNoCov">          0 : GImage *PST_GetImage(GGadget *pstk,SplineFont *sf,int def_layer,</span>
<span class="lineNum">    3340 </span>            :         struct lookup_subtable *sub,int popup_r, SplineChar *sc ) {
<span class="lineNum">    3341 </span><span class="lineNoCov">          0 :     int rows, cols = GMatrixEditGetColCnt(pstk);</span>
<span class="lineNum">    3342 </span><span class="lineNoCov">          0 :     struct matrix_data *old = GMatrixEditGet(pstk,&amp;rows);</span>
<span class="lineNum">    3343 </span>            : 
<span class="lineNum">    3344 </span><span class="lineNoCov">          0 :     if ( sc==NULL || sub==NULL )</span>
<span class="lineNum">    3345 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    3346 </span><span class="lineNoCov">          0 :     if ( sub-&gt;lookup-&gt;lookup_type&lt;gsub_single || sub-&gt;lookup-&gt;lookup_type&gt;gsub_ligature )</span>
<span class="lineNum">    3347 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    3348 </span>            : 
<span class="lineNum">    3349 </span><span class="lineNoCov">          0 : return( NameList_GetImage(sf,sc,def_layer,old[cols*popup_r+1].u.md_str,</span>
<span class="lineNum">    3350 </span><span class="lineNoCov">          0 :         sub-&gt;lookup-&gt;lookup_type==gsub_ligature));</span>
<a name="3351"><span class="lineNum">    3351 </span>            : }</a>
<span class="lineNum">    3352 </span>            : 
<span class="lineNum">    3353 </span><span class="lineNoCov">          0 : static GImage *_CI_GetImage(const void *_ci) {</span>
<span class="lineNum">    3354 </span><span class="lineNoCov">          0 :     CharInfo *ci = (CharInfo *) _ci;</span>
<span class="lineNum">    3355 </span><span class="lineNoCov">          0 :     int offset = GTabSetGetSel(GWidgetGetControl(ci-&gt;gw,CID_Tabs))-2;</span>
<span class="lineNum">    3356 </span><span class="lineNoCov">          0 :     GGadget *pstk = GWidgetGetControl(ci-&gt;gw,CID_List+offset*100);</span>
<span class="lineNum">    3357 </span><span class="lineNoCov">          0 :     int rows, cols = GMatrixEditGetColCnt(pstk);</span>
<span class="lineNum">    3358 </span><span class="lineNoCov">          0 :     struct matrix_data *old = GMatrixEditGet(pstk,&amp;rows);</span>
<span class="lineNum">    3359 </span><span class="lineNoCov">          0 :     struct lookup_subtable *sub = (struct lookup_subtable *) (old[cols*ci-&gt;r+0].u.md_ival);</span>
<span class="lineNum">    3360 </span>            : 
<span class="lineNum">    3361 </span><span class="lineNoCov">          0 :     if ( ci-&gt;r&gt;=rows )</span>
<span class="lineNum">    3362 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    3363 </span>            : 
<span class="lineNum">    3364 </span><span class="lineNoCov">          0 : return( PST_GetImage(pstk,ci-&gt;sc-&gt;parent,ci-&gt;def_layer,sub,ci-&gt;r,ci-&gt;sc) );</span>
<a name="3365"><span class="lineNum">    3365 </span>            : }</a>
<span class="lineNum">    3366 </span>            : 
<span class="lineNum">    3367 </span><span class="lineNoCov">          0 : static void CI_KerningPopupPrepare(GGadget *g, int r, int c) {</span>
<span class="lineNum">    3368 </span><span class="lineNoCov">          0 :     CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    3369 </span><span class="lineNoCov">          0 :     int rows, cols = GMatrixEditGetColCnt(g);</span>
<span class="lineNum">    3370 </span><span class="lineNoCov">          0 :     struct matrix_data *old = GMatrixEditGet(g,&amp;rows);</span>
<span class="lineNum">    3371 </span>            : 
<span class="lineNum">    3372 </span><span class="lineNoCov">          0 :     if ( c&lt;0 || c&gt;=cols || r&lt;0 || r&gt;=rows || old[cols*r+1].u.md_str==NULL ||</span>
<span class="lineNum">    3373 </span><span class="lineNoCov">          0 :         SFGetChar(ci-&gt;sc-&gt;parent,-1, old[cols*r+1].u.md_str)==NULL )</span>
<span class="lineNum">    3374 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3375 </span><span class="lineNoCov">          0 :     ci-&gt;r = r; ci-&gt;c = c;</span>
<span class="lineNum">    3376 </span><span class="lineNoCov">          0 :     GGadgetPreparePopupImage(GGadgetGetWindow(g),NULL,ci,CI_GetKernedImage,CI_FreeKernedImage);</span>
<a name="3377"><span class="lineNum">    3377 </span>            : }</a>
<span class="lineNum">    3378 </span>            : 
<span class="lineNum">    3379 </span><span class="lineNoCov">          0 : static void CI_SubsPopupPrepare(GGadget *g, int r, int c) {</span>
<span class="lineNum">    3380 </span><span class="lineNoCov">          0 :     CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    3381 </span><span class="lineNoCov">          0 :     int rows, cols = GMatrixEditGetColCnt(g);</span>
<span class="lineNum">    3382 </span>            : 
<span class="lineNum">    3383 </span><span class="lineNoCov">          0 :     (void) GMatrixEditGet(g,&amp;rows);</span>
<span class="lineNum">    3384 </span><span class="lineNoCov">          0 :     if ( c&lt;0 || c&gt;=cols || r&lt;0 || r&gt;=rows )</span>
<span class="lineNum">    3385 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3386 </span><span class="lineNoCov">          0 :     ci-&gt;r = r; ci-&gt;c = c;</span>
<span class="lineNum">    3387 </span><span class="lineNoCov">          0 :     GGadgetPreparePopupImage(GGadgetGetWindow(g),NULL,ci,_CI_GetImage,CI_FreeKernedImage);</span>
<a name="3388"><span class="lineNum">    3388 </span>            : }</a>
<span class="lineNum">    3389 </span>            : 
<span class="lineNum">    3390 </span><span class="lineNoCov">          0 : static void CI_ConstructionPopupPrepare(GGadget *g, int r, int c) {</span>
<span class="lineNum">    3391 </span><span class="lineNoCov">          0 :     CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    3392 </span>            :     int rows/*, cols = GMatrixEditGetColCnt(g)*/;
<span class="lineNum">    3393 </span>            : 
<span class="lineNum">    3394 </span><span class="lineNoCov">          0 :     (void) GMatrixEditGet(g,&amp;rows);</span>
<span class="lineNum">    3395 </span><span class="lineNoCov">          0 :     if ( rows==0 )</span>
<span class="lineNum">    3396 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3397 </span><span class="lineNoCov">          0 :     GGadgetPreparePopupImage(GGadgetGetWindow(g),NULL,ci,CI_GetConstructedImage,CI_FreeKernedImage);</span>
<a name="3398"><span class="lineNum">    3398 </span>            : }</a>
<span class="lineNum">    3399 </span>            : 
<span class="lineNum">    3400 </span><span class="lineNoCov">          0 : static unichar_t **CI_GlyphNameCompletion(GGadget *t,int from_tab) {</span>
<span class="lineNum">    3401 </span><span class="lineNoCov">          0 :     CharInfo *ci = GDrawGetUserData(GDrawGetParentWindow(GGadgetGetWindow(t)));</span>
<span class="lineNum">    3402 </span><span class="lineNoCov">          0 :     SplineFont *sf = ci-&gt;sc-&gt;parent;</span>
<span class="lineNum">    3403 </span>            : 
<span class="lineNum">    3404 </span><span class="lineNoCov">          0 : return( SFGlyphNameCompletion(sf,t,from_tab,false));</span>
<a name="3405"><span class="lineNum">    3405 </span>            : }</a>
<span class="lineNum">    3406 </span>            : 
<span class="lineNum">    3407 </span><span class="lineNoCov">          0 : static unichar_t **CI_GlyphListCompletion(GGadget *t,int from_tab) {</span>
<span class="lineNum">    3408 </span><span class="lineNoCov">          0 :     CharInfo *ci = GDrawGetUserData(GDrawGetParentWindow(GGadgetGetWindow(t)));</span>
<span class="lineNum">    3409 </span><span class="lineNoCov">          0 :     SplineFont *sf = ci-&gt;sc-&gt;parent;</span>
<span class="lineNum">    3410 </span>            : 
<span class="lineNum">    3411 </span><span class="lineNoCov">          0 : return( SFGlyphNameCompletion(sf,t,from_tab,true));</span>
<span class="lineNum">    3412 </span>            : }
<a name="3413"><span class="lineNum">    3413 </span>            : </a>
<span class="lineNum">    3414 </span>            : 
<span class="lineNum">    3415 </span><span class="lineNoCov">          0 : static void extpart_finishedit(GGadget *g, int r, int c, int wasnew) {</span>
<span class="lineNum">    3416 </span>            :     int rows;
<span class="lineNum">    3417 </span>            :     struct matrix_data *possub;
<span class="lineNum">    3418 </span>            :     CharInfo *ci;
<span class="lineNum">    3419 </span>            :     int is_horiz,cols;
<span class="lineNum">    3420 </span>            :     DBounds b;
<span class="lineNum">    3421 </span>            :     double full_advance;
<span class="lineNum">    3422 </span>            :     SplineChar *sc;
<span class="lineNum">    3423 </span>            : 
<span class="lineNum">    3424 </span><span class="lineNoCov">          0 :     if ( c!=0 )</span>
<span class="lineNum">    3425 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3426 </span><span class="lineNoCov">          0 :     if ( !wasnew )</span>
<span class="lineNum">    3427 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3428 </span>            :     /* If they added a new glyph to the sequence then set some defaults for it. */
<span class="lineNum">    3429 </span>            :     /*  only the full advance has any likelyhood of being correct */
<span class="lineNum">    3430 </span><span class="lineNoCov">          0 :     ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    3431 </span><span class="lineNoCov">          0 :     is_horiz = GTabSetGetSel(GWidgetGetControl(ci-&gt;gw,CID_Tabs))-ci-&gt;vert_aspect;</span>
<span class="lineNum">    3432 </span><span class="lineNoCov">          0 :     possub = GMatrixEditGet(g, &amp;rows);</span>
<span class="lineNum">    3433 </span><span class="lineNoCov">          0 :     cols = GMatrixEditGetColCnt(g);</span>
<span class="lineNum">    3434 </span><span class="lineNoCov">          0 :     if ( possub[r*cols+0].u.md_str==NULL )</span>
<span class="lineNum">    3435 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3436 </span><span class="lineNoCov">          0 :     sc = SFGetChar(ci-&gt;sc-&gt;parent,-1,possub[r*cols+0].u.md_str);</span>
<span class="lineNum">    3437 </span><span class="lineNoCov">          0 :     if ( sc==NULL )</span>
<span class="lineNum">    3438 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3439 </span><span class="lineNoCov">          0 :     SplineCharFindBounds(sc,&amp;b);</span>
<span class="lineNum">    3440 </span><span class="lineNoCov">          0 :     if ( is_horiz )</span>
<span class="lineNum">    3441 </span><span class="lineNoCov">          0 :         full_advance = b.maxx - b.minx;</span>
<span class="lineNum">    3442 </span>            :     else
<span class="lineNum">    3443 </span><span class="lineNoCov">          0 :         full_advance = b.maxy - b.miny;</span>
<span class="lineNum">    3444 </span><span class="lineNoCov">          0 :     possub[r*cols+2].u.md_ival = possub[r*cols+3].u.md_ival = rint(full_advance/3);</span>
<span class="lineNum">    3445 </span><span class="lineNoCov">          0 :     possub[r*cols+4].u.md_ival = rint(full_advance);</span>
<span class="lineNum">    3446 </span><span class="lineNoCov">          0 :     GGadgetRedraw(g);</span>
<span class="lineNum">    3447 </span>            : }
<span class="lineNum">    3448 </span>            : 
<span class="lineNum">    3449 </span>            : static GTextInfo truefalse[] = {
<span class="lineNum">    3450 </span>            :     { (unichar_t *) N_(&quot;false&quot;), NULL, 0, 0, (void *) 0, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0'},
<span class="lineNum">    3451 </span>            :     { (unichar_t *) N_(&quot;true&quot;),  NULL, 0, 0, (void *) 1, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0'},
<span class="lineNum">    3452 </span>            :     GTEXTINFO_EMPTY
<span class="lineNum">    3453 </span>            : };
<span class="lineNum">    3454 </span>            : 
<span class="lineNum">    3455 </span>            : static struct col_init extensionpart[] = {
<span class="lineNum">    3456 </span>            :     { me_string , NULL, NULL, NULL, N_(&quot;Glyph&quot;) },
<span class="lineNum">    3457 </span>            :     { me_enum, NULL, truefalse, NULL, N_(&quot;Extender&quot;) },
<span class="lineNum">    3458 </span>            : /* GT: &quot;Len&quot; is an abreviation for &quot;Length&quot; */
<span class="lineNum">    3459 </span>            :     { me_int, NULL, NULL, NULL, N_(&quot;StartLen&quot;) },
<span class="lineNum">    3460 </span>            :     { me_int, NULL, NULL, NULL, N_(&quot;EndLen&quot;) },
<span class="lineNum">    3461 </span>            :     { me_int, NULL, NULL, NULL, N_(&quot;FullLen&quot;) },
<span class="lineNum">    3462 </span>            :     COL_INIT_EMPTY
<span class="lineNum">    3463 </span>            : };
<span class="lineNum">    3464 </span>            : static struct matrixinit mi_extensionpart =
<a name="3465"><span class="lineNum">    3465 </span>            :     { sizeof(extensionpart)/sizeof(struct col_init)-1, extensionpart, 0, NULL, NULL, NULL, extpart_finishedit, NULL, NULL, NULL };</a>
<span class="lineNum">    3466 </span>            : 
<span class="lineNum">    3467 </span><span class="lineNoCov">          0 : static int isxheight(int uni) {</span>
<span class="lineNum">    3468 </span><span class="lineNoCov">          0 :     if ( uni&gt;=0x10000 || !islower(uni))</span>
<span class="lineNum">    3469 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    3470 </span>            : 
<span class="lineNum">    3471 </span><span class="lineNoCov">          0 :     if ( uni=='a' || uni=='c' || uni=='e' || uni=='i' || uni=='j' ||</span>
<span class="lineNum">    3472 </span><span class="lineNoCov">          0 :             (uni&gt;='m' &amp;&amp; uni&lt;='z') ||</span>
<span class="lineNum">    3473 </span><span class="lineNoCov">          0 :             uni==0x131 || uni==0x237 || /* Ignore accented letters except the dotlessi/j */</span>
<span class="lineNum">    3474 </span><span class="lineNoCov">          0 :             (uni&gt;=0x250 &amp;&amp; uni&lt;0x253) || uni==0x254 || uni==0x255 ||</span>
<span class="lineNum">    3475 </span><span class="lineNoCov">          0 :             (uni&gt;=0x258 &amp;&amp; uni&lt;0x265) || uni==0x269 || uni==0x26A ||</span>
<span class="lineNum">    3476 </span><span class="lineNoCov">          0 :             (uni&gt;=0x26f &amp;&amp; uni&lt;=0x277) || uni==0x279 ||</span>
<span class="lineNum">    3477 </span><span class="lineNoCov">          0 :             uni==0x3b1 || uni==0x3b3 || uni==0x3b5 || uni==0x3b7 ||</span>
<span class="lineNum">    3478 </span><span class="lineNoCov">          0 :             uni==0x3b9 || uni==0x3ba || uni==0x3bc || uni==0x3bd ||</span>
<span class="lineNum">    3479 </span><span class="lineNoCov">          0 :             (uni&gt;=0x3bf &amp;&amp; uni&lt;=0x3c7) || uni==0x3c9 ||</span>
<span class="lineNum">    3480 </span><span class="lineNoCov">          0 :             (uni&gt;=0x400 &amp;&amp; uni&lt;=0x45f))</span>
<span class="lineNum">    3481 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    3482 </span>            : 
<span class="lineNum">    3483 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="3484"><span class="lineNum">    3484 </span>            : }</a>
<span class="lineNum">    3485 </span>            : 
<span class="lineNum">    3486 </span><span class="lineNoCov">          0 : static int isbaseline(int uni) {</span>
<span class="lineNum">    3487 </span>            :     /* Treat rounded letters as being on the base line */
<span class="lineNum">    3488 </span>            :     /* But don't bother including guys that normally are on the baseline */
<span class="lineNum">    3489 </span>            : 
<span class="lineNum">    3490 </span><span class="lineNoCov">          0 :     if ( (uni&gt;='a' &amp;&amp; uni&lt;'g') || uni=='h' || uni=='i' ||</span>
<span class="lineNum">    3491 </span><span class="lineNoCov">          0 :             (uni&gt;='k' &amp;&amp; uni&lt;='o') || (uni&gt;='r' &amp;&amp; uni&lt;'y') || uni=='z' ||</span>
<span class="lineNum">    3492 </span><span class="lineNoCov">          0 :             (uni&gt;='A' &amp;&amp; uni&lt;='Z' ) ||</span>
<span class="lineNum">    3493 </span><span class="lineNoCov">          0 :             uni==0x3b0 || uni==0x3b4 || uni==0x3b5 || (uni&gt;=0x3b8 &amp;&amp; uni&lt;0x3bb) ||</span>
<span class="lineNum">    3494 </span><span class="lineNoCov">          0 :             uni==0x3bd || uni==0x3bf || uni==0x3c0 || (uni&gt;=0x3c2 &amp;&amp; uni&lt;0x3c6) ||</span>
<span class="lineNum">    3495 </span><span class="lineNoCov">          0 :             uni==0x3c8 || uni==0x3c7 || uni==0x3c9 ||</span>
<span class="lineNum">    3496 </span><span class="lineNoCov">          0 :             (uni&gt;=0x391 &amp;&amp; uni&lt;0x3aa) ||</span>
<span class="lineNum">    3497 </span><span class="lineNoCov">          0 :             (uni&gt;=0x400 &amp;&amp; uni&lt;0x40f) || (uni&gt;=0x410 &amp;&amp; uni&lt;=0x413) ||</span>
<span class="lineNum">    3498 </span><span class="lineNoCov">          0 :             (uni&gt;=0x415 &amp;&amp; uni&lt;0x425) || uni==0x427 || uni==0x428 ||</span>
<span class="lineNum">    3499 </span><span class="lineNoCov">          0 :             (uni&gt;=0x42a &amp;&amp; uni&lt;0x433) || (uni&gt;=0x435 &amp;&amp; uni&lt;0x45e) )</span>
<span class="lineNum">    3500 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    3501 </span>            : 
<span class="lineNum">    3502 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="3503"><span class="lineNum">    3503 </span>            : }</a>
<span class="lineNum">    3504 </span>            : 
<span class="lineNum">    3505 </span><span class="lineNoCov">          0 : static int TeX_Default(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    3506 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    3507 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    3508 </span><span class="lineNoCov">          0 :         int cid = GGadgetGetCid(g);</span>
<span class="lineNum">    3509 </span>            :         DBounds b;
<span class="lineNum">    3510 </span>            :         int value;
<span class="lineNum">    3511 </span><span class="lineNoCov">          0 :         SplineChar *basesc = NULL;</span>
<span class="lineNum">    3512 </span><span class="lineNoCov">          0 :         SplineFont *sf = ci-&gt;sc-&gt;parent;</span>
<span class="lineNum">    3513 </span>            :         int style;
<span class="lineNum">    3514 </span>            :         char buf[12];
<span class="lineNum">    3515 </span>            : 
<span class="lineNum">    3516 </span><span class="lineNoCov">          0 :         basesc = ci-&gt;sc;</span>
<span class="lineNum">    3517 </span>            :         /* Try to align the top of lowercase (xheight) letters all at the */
<span class="lineNum">    3518 </span>            :         /*  same height. Ditto for uppercase &amp; ascender letters */
<span class="lineNum">    3519 </span><span class="lineNoCov">          0 :         if ( cid==CID_TeX_HeightD &amp;&amp; ci-&gt;sc-&gt;unicodeenc&lt;0x10000 &amp;&amp;</span>
<span class="lineNum">    3520 </span><span class="lineNoCov">          0 :                 isxheight(ci-&gt;sc-&gt;unicodeenc) &amp;&amp;</span>
<span class="lineNum">    3521 </span>            :                 (basesc = SFGetChar(sf,'x',NULL))!=NULL )
<span class="lineNum">    3522 </span>            :             /* Done */;
<span class="lineNum">    3523 </span><span class="lineNoCov">          0 :         else if ( cid==CID_TeX_HeightD &amp;&amp; ci-&gt;sc-&gt;unicodeenc&lt;0x10000 &amp;&amp;</span>
<span class="lineNum">    3524 </span><span class="lineNoCov">          0 :                 islower(ci-&gt;sc-&gt;unicodeenc) &amp;&amp;</span>
<span class="lineNum">    3525 </span>            :                 (basesc = SFGetChar(sf,'l',NULL))!=NULL )
<span class="lineNum">    3526 </span>            :             /* Done */;
<span class="lineNum">    3527 </span><span class="lineNoCov">          0 :         else if ( cid==CID_TeX_HeightD &amp;&amp; ci-&gt;sc-&gt;unicodeenc&lt;0x10000 &amp;&amp;</span>
<span class="lineNum">    3528 </span><span class="lineNoCov">          0 :                 isupper(ci-&gt;sc-&gt;unicodeenc) &amp;&amp;</span>
<span class="lineNum">    3529 </span>            :                 (basesc = SFGetChar(sf,'I',NULL))!=NULL )
<span class="lineNum">    3530 </span>            :             /* Done */;
<span class="lineNum">    3531 </span><span class="lineNoCov">          0 :         else if ( cid==CID_TeX_DepthD &amp;&amp; ci-&gt;sc-&gt;unicodeenc&lt;0x10000 &amp;&amp;</span>
<span class="lineNum">    3532 </span><span class="lineNoCov">          0 :                 isbaseline(ci-&gt;sc-&gt;unicodeenc) &amp;&amp;</span>
<span class="lineNum">    3533 </span>            :                 (basesc = SFGetChar(sf,'I',NULL))!=NULL )
<span class="lineNum">    3534 </span>            :             /* Done */;
<span class="lineNum">    3535 </span>            :         else
<span class="lineNum">    3536 </span><span class="lineNoCov">          0 :             basesc = ci-&gt;sc;</span>
<span class="lineNum">    3537 </span>            : 
<span class="lineNum">    3538 </span><span class="lineNoCov">          0 :         SplineCharFindBounds(basesc,&amp;b);</span>
<span class="lineNum">    3539 </span><span class="lineNoCov">          0 :         style = MacStyleCode(sf,NULL);</span>
<span class="lineNum">    3540 </span>            : 
<span class="lineNum">    3541 </span><span class="lineNoCov">          0 :         if ( cid == CID_TeX_HeightD ) {</span>
<span class="lineNum">    3542 </span><span class="lineNoCov">          0 :             if ( basesc!=ci-&gt;sc &amp;&amp; basesc-&gt;tex_height!=TEX_UNDEF )</span>
<span class="lineNum">    3543 </span><span class="lineNoCov">          0 :                 value = basesc-&gt;tex_height;</span>
<span class="lineNum">    3544 </span>            :             else
<span class="lineNum">    3545 </span><span class="lineNoCov">          0 :                 value = rint(b.maxy);</span>
<span class="lineNum">    3546 </span><span class="lineNoCov">          0 :             if ( value&lt;0 ) value = 0;</span>
<span class="lineNum">    3547 </span><span class="lineNoCov">          0 :         } else if ( cid == CID_TeX_DepthD ) {</span>
<span class="lineNum">    3548 </span><span class="lineNoCov">          0 :             if ( basesc!=ci-&gt;sc &amp;&amp; basesc-&gt;tex_depth!=TEX_UNDEF )</span>
<span class="lineNum">    3549 </span><span class="lineNoCov">          0 :                 value = basesc-&gt;tex_depth;</span>
<span class="lineNum">    3550 </span>            :             else {
<span class="lineNum">    3551 </span><span class="lineNoCov">          0 :                 value = -rint(b.miny);</span>
<span class="lineNum">    3552 </span><span class="lineNoCov">          0 :                 if ( value&lt;5 ) value = 0;</span>
<span class="lineNum">    3553 </span>            :             }
<span class="lineNum">    3554 </span><span class="lineNoCov">          0 :         } else if ( cid == CID_HorAccentD ) {</span>
<span class="lineNum">    3555 </span><span class="lineNoCov">          0 :             double italic_off = (b.maxy-b.miny)*tan(-sf-&gt;italicangle);</span>
<span class="lineNum">    3556 </span><span class="lineNoCov">          0 :             if ( b.maxx-b.minx-italic_off &lt; 0 )</span>
<span class="lineNum">    3557 </span><span class="lineNoCov">          0 :                 value = rint(b.minx + (b.maxx-b.minx)/2);</span>
<span class="lineNum">    3558 </span>            :             else
<span class="lineNum">    3559 </span><span class="lineNoCov">          0 :                 value = rint(b.minx + italic_off + (b.maxx - b.minx - italic_off)/2);</span>
<span class="lineNum">    3560 </span><span class="lineNoCov">          0 :         } else if ( (style&amp;sf_italic) || sf-&gt;italicangle!=0 ) {</span>
<span class="lineNum">    3561 </span><span class="lineNoCov">          0 :             value = rint((b.maxx-ci-&gt;sc-&gt;width) +</span>
<span class="lineNum">    3562 </span><span class="lineNoCov">          0 :                             (sf-&gt;ascent+sf-&gt;descent)/16.0);</span>
<span class="lineNum">    3563 </span>            :         } else
<span class="lineNum">    3564 </span><span class="lineNoCov">          0 :             value = 0;</span>
<span class="lineNum">    3565 </span><span class="lineNoCov">          0 :         sprintf( buf, &quot;%d&quot;, value );</span>
<span class="lineNum">    3566 </span><span class="lineNoCov">          0 :         GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,cid-5),buf);</span>
<span class="lineNum">    3567 </span>            :     }
<span class="lineNum">    3568 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="3569"><span class="lineNum">    3569 </span>            : }</a>
<span class="lineNum">    3570 </span>            : 
<span class="lineNum">    3571 </span><span class="lineNoCov">          0 : static int CI_SubSuperPositionings(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    3572 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    3573 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    3574 </span><span class="lineNoCov">          0 :         MathKernDialog(ci-&gt;sc,ci-&gt;def_layer);</span>
<span class="lineNum">    3575 </span>            :     }
<span class="lineNum">    3576 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    3577 </span>            : }
<span class="lineNum">    3578 </span>            : 
<span class="lineNum">    3579 </span>            : static struct col_init altuniinfo[] = {
<span class="lineNum">    3580 </span>            :     { me_uhex , NULL, NULL, NULL, N_(&quot;Unicode&quot;) },
<span class="lineNum">    3581 </span>            :     { me_uhex, NULL, truefalse, NULL, N_(&quot;Variation Selector (or 0)&quot;) },
<span class="lineNum">    3582 </span>            :     COL_INIT_EMPTY
<span class="lineNum">    3583 </span>            : };
<span class="lineNum">    3584 </span>            : static struct matrixinit mi_altuniinfo =
<a name="3585"><span class="lineNum">    3585 </span>            :     { sizeof(altuniinfo)/sizeof(struct col_init)-1, altuniinfo, 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL };</a>
<span class="lineNum">    3586 </span>            : 
<span class="lineNum">    3587 </span><span class="lineNoCov">          0 : static void CI_NoteAspect(CharInfo *ci) {</span>
<span class="lineNum">    3588 </span><span class="lineNoCov">          0 :     int new_aspect = GTabSetGetSel(GWidgetGetControl(ci-&gt;gw,CID_Tabs));</span>
<span class="lineNum">    3589 </span>            :     PST *pst;
<span class="lineNum">    3590 </span>            :     int cnt;
<span class="lineNum">    3591 </span>            :     char buf[20];
<span class="lineNum">    3592 </span>            : 
<span class="lineNum">    3593 </span><span class="lineNoCov">          0 :     last_gi_aspect = new_aspect;</span>
<span class="lineNum">    3594 </span><span class="lineNoCov">          0 :     if ( new_aspect == ci-&gt;lc_aspect &amp;&amp; (!ci-&gt;lc_seen || GGadgetIsChecked(GWidgetGetControl(ci-&gt;gw,CID_DefLCCount)))) {</span>
<span class="lineNum">    3595 </span><span class="lineNoCov">          0 :         ci-&gt;lc_seen = true;</span>
<span class="lineNum">    3596 </span><span class="lineNoCov">          0 :         for ( pst=ci-&gt;sc-&gt;possub; pst!=NULL &amp;&amp; pst-&gt;type!=pst_lcaret; pst=pst-&gt;next );</span>
<span class="lineNum">    3597 </span><span class="lineNoCov">          0 :         if ( GGadgetIsChecked(GWidgetGetControl(ci-&gt;gw,CID_DefLCCount)) &amp;&amp;</span>
<span class="lineNum">    3598 </span><span class="lineNoCov">          0 :                 pst==NULL ) {</span>
<span class="lineNum">    3599 </span>            :             int rows, cols, i;
<span class="lineNum">    3600 </span>            :             struct matrix_data *possub;
<span class="lineNum">    3601 </span>            :             /* Normally we look for ligatures in the possub list, but here*/
<span class="lineNum">    3602 </span>            :             /*  we will examine the ligature pane itself to get the most */
<span class="lineNum">    3603 </span>            :             /*  up to date info */
<span class="lineNum">    3604 </span><span class="lineNoCov">          0 :             possub = GMatrixEditGet(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_ligature-1)*100), &amp;rows );</span>
<span class="lineNum">    3605 </span><span class="lineNoCov">          0 :             cols = GMatrixEditGetColCnt(GWidgetGetControl(ci-&gt;gw,CID_List+(pst_ligature-1)*100) );</span>
<span class="lineNum">    3606 </span><span class="lineNoCov">          0 :             cnt = 0;</span>
<span class="lineNum">    3607 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;rows; ++i ) {</span>
<span class="lineNum">    3608 </span><span class="lineNoCov">          0 :                 char *pt = possub[cols*i+1].u.md_str;</span>
<span class="lineNum">    3609 </span><span class="lineNoCov">          0 :                 int comp = 0;</span>
<span class="lineNum">    3610 </span><span class="lineNoCov">          0 :                 while ( *pt!='\0' ) {</span>
<span class="lineNum">    3611 </span><span class="lineNoCov">          0 :                     while ( *pt==' ' ) ++pt;</span>
<span class="lineNum">    3612 </span><span class="lineNoCov">          0 :                     if ( *pt=='\0' )</span>
<span class="lineNum">    3613 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    3614 </span><span class="lineNoCov">          0 :                     while ( *pt!=' ' &amp;&amp; *pt!='\0' ) ++pt;</span>
<span class="lineNum">    3615 </span><span class="lineNoCov">          0 :                     ++comp;</span>
<span class="lineNum">    3616 </span>            :                 }
<span class="lineNum">    3617 </span><span class="lineNoCov">          0 :                 if ( comp&gt;cnt ) cnt = comp;</span>
<span class="lineNum">    3618 </span>            :             }
<span class="lineNum">    3619 </span><span class="lineNoCov">          0 :             --cnt;              /* We want one fewer caret than there are components -- carets go BETWEEN components */</span>
<span class="lineNum">    3620 </span><span class="lineNoCov">          0 :         } else if ( pst!=NULL )</span>
<span class="lineNum">    3621 </span><span class="lineNoCov">          0 :             cnt = pst-&gt;u.lcaret.cnt;</span>
<span class="lineNum">    3622 </span>            :         else
<span class="lineNum">    3623 </span><span class="lineNoCov">          0 :             cnt = 0;</span>
<span class="lineNum">    3624 </span><span class="lineNoCov">          0 :         if ( cnt&lt;0 ) cnt = 0;</span>
<span class="lineNum">    3625 </span><span class="lineNoCov">          0 :         sprintf( buf, &quot;%d&quot;, cnt );</span>
<span class="lineNum">    3626 </span><span class="lineNoCov">          0 :         GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_LCCount),buf);</span>
<span class="lineNum">    3627 </span>            :     }
<a name="3628"><span class="lineNum">    3628 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3629 </span>            : 
<span class="lineNum">    3630 </span><span class="lineNoCov">          0 : static int CI_AspectChange(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    3631 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">    3632 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    3633 </span><span class="lineNoCov">          0 :         CI_NoteAspect(ci);</span>
<span class="lineNum">    3634 </span>            :     }
<span class="lineNum">    3635 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="3636"><span class="lineNum">    3636 </span>            : }</a>
<span class="lineNum">    3637 </span>            : 
<span class="lineNum">    3638 </span><span class="lineNoCov">          0 : static int CI_DefLCChange(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    3639 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">    3640 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    3641 </span><span class="lineNoCov">          0 :         int show = !GGadgetIsChecked(g);</span>
<span class="lineNum">    3642 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(ci-&gt;gw,CID_LCCount),show);</span>
<span class="lineNum">    3643 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(ci-&gt;gw,CID_LCCountLab),show);</span>
<span class="lineNum">    3644 </span>            :     }
<span class="lineNum">    3645 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="3646"><span class="lineNum">    3646 </span>            : }</a>
<span class="lineNum">    3647 </span>            : 
<span class="lineNum">    3648 </span><span class="lineNoCov">          0 : void GV_ToMD(GGadget *g, struct glyphvariants *gv) {</span>
<span class="lineNum">    3649 </span><span class="lineNoCov">          0 :     int cols = GMatrixEditGetColCnt(g), j;</span>
<span class="lineNum">    3650 </span>            :     struct matrix_data *mds;
<span class="lineNum">    3651 </span><span class="lineNoCov">          0 :     if ( gv==NULL ) {</span>
<span class="lineNum">    3652 </span><span class="lineNoCov">          0 :         GMatrixEditSet(g, NULL,0,false);</span>
<span class="lineNum">    3653 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3654 </span>            :     }
<span class="lineNum">    3655 </span><span class="lineNoCov">          0 :     mds = calloc(gv-&gt;part_cnt*cols,sizeof(struct matrix_data));</span>
<span class="lineNum">    3656 </span><span class="lineNoCov">          0 :     for ( j=0; j&lt;gv-&gt;part_cnt; ++j ) {</span>
<span class="lineNum">    3657 </span><span class="lineNoCov">          0 :         mds[j*cols+0].u.md_str = copy(gv-&gt;parts[j].component);</span>
<span class="lineNum">    3658 </span><span class="lineNoCov">          0 :         mds[j*cols+1].u.md_ival = gv-&gt;parts[j].is_extender;</span>
<span class="lineNum">    3659 </span><span class="lineNoCov">          0 :         mds[j*cols+2].u.md_ival = gv-&gt;parts[j].startConnectorLength;</span>
<span class="lineNum">    3660 </span><span class="lineNoCov">          0 :         mds[j*cols+3].u.md_ival = gv-&gt;parts[j].endConnectorLength;</span>
<span class="lineNum">    3661 </span><span class="lineNoCov">          0 :         mds[j*cols+4].u.md_ival = gv-&gt;parts[j].fullAdvance;</span>
<span class="lineNum">    3662 </span>            :     }
<span class="lineNum">    3663 </span><span class="lineNoCov">          0 :     GMatrixEditSet(g, mds,gv-&gt;part_cnt,false);</span>
<a name="3664"><span class="lineNum">    3664 </span>            : }</a>
<span class="lineNum">    3665 </span>            : 
<span class="lineNum">    3666 </span><span class="lineNoCov">          0 : static void GA_ToMD(GGadget *g, SplineChar *sc) {</span>
<span class="lineNum">    3667 </span>            :     struct altuni *alt;
<span class="lineNum">    3668 </span><span class="lineNoCov">          0 :     int cols = GMatrixEditGetColCnt(g), cnt;</span>
<span class="lineNum">    3669 </span>            :     struct matrix_data *mds;
<span class="lineNum">    3670 </span><span class="lineNoCov">          0 :     if ( sc-&gt;altuni==NULL ) {</span>
<span class="lineNum">    3671 </span><span class="lineNoCov">          0 :         GMatrixEditSet(g, NULL,0,false);</span>
<span class="lineNum">    3672 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3673 </span>            :     }
<span class="lineNum">    3674 </span><span class="lineNoCov">          0 :     for ( cnt=0, alt=sc-&gt;altuni; alt!=NULL; ++cnt, alt=alt-&gt;next );</span>
<span class="lineNum">    3675 </span><span class="lineNoCov">          0 :     mds = calloc(cnt*cols,sizeof(struct matrix_data));</span>
<span class="lineNum">    3676 </span><span class="lineNoCov">          0 :     for ( cnt=0, alt=sc-&gt;altuni; alt!=NULL; ++cnt, alt=alt-&gt;next ) {</span>
<span class="lineNum">    3677 </span><span class="lineNoCov">          0 :         mds[cnt*cols+0].u.md_ival = alt-&gt;unienc;</span>
<span class="lineNum">    3678 </span><span class="lineNoCov">          0 :         mds[cnt*cols+1].u.md_ival = alt-&gt;vs==-1? 0 : alt-&gt;vs;</span>
<span class="lineNum">    3679 </span>            :     }
<span class="lineNum">    3680 </span><span class="lineNoCov">          0 :     GMatrixEditSet(g, mds,cnt,false);</span>
<a name="3681"><span class="lineNum">    3681 </span>            : }</a>
<span class="lineNum">    3682 </span>            : 
<span class="lineNum">    3683 </span><span class="lineNoCov">          0 : static void CI_SetColorList(CharInfo *ci,Color color) {</span>
<span class="lineNum">    3684 </span>            :     int i;
<span class="lineNum">    3685 </span>            :     uint16 junk;
<span class="lineNum">    3686 </span>            : 
<span class="lineNum">    3687 </span><span class="lineNoCov">          0 :     std_colors[CUSTOM_COLOR].image = NULL;</span>
<span class="lineNum">    3688 </span><span class="lineNoCov">          0 :     for ( i=0; std_colors[i].image!=NULL; ++i ) {</span>
<span class="lineNum">    3689 </span><span class="lineNoCov">          0 :         if ( std_colors[i].userdata == (void *) (intpt) color )</span>
<span class="lineNum">    3690 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    3691 </span>            :     }
<span class="lineNum">    3692 </span><span class="lineNoCov">          0 :     if ( std_colors[i].image==NULL ) {</span>
<span class="lineNum">    3693 </span><span class="lineNoCov">          0 :         std_colors[i].image = &amp;customcolor_image;</span>
<span class="lineNum">    3694 </span><span class="lineNoCov">          0 :         customcolor_image.u.image-&gt;clut-&gt;clut[1] = color;</span>
<span class="lineNum">    3695 </span><span class="lineNoCov">          0 :         std_colors[i].userdata = (void *) (intpt) color;</span>
<span class="lineNum">    3696 </span>            :     }
<span class="lineNum">    3697 </span><span class="lineNoCov">          0 :     GGadgetSetList(GWidgetGetControl(ci-&gt;gw,CID_Color), GTextInfoArrayFromList(std_colors,&amp;junk), false);</span>
<span class="lineNum">    3698 </span><span class="lineNoCov">          0 :     GGadgetSelectOneListItem(GWidgetGetControl(ci-&gt;gw,CID_Color),i);</span>
<span class="lineNum">    3699 </span><span class="lineNoCov">          0 :     if ( color!=COLOR_DEFAULT )</span>
<span class="lineNum">    3700 </span><span class="lineNoCov">          0 :         ci-&gt;last = color;</span>
<span class="lineNum">    3701 </span><span class="lineNoCov">          0 :     ci-&gt;real_last = color;</span>
<span class="lineNum">    3702 </span><span class="lineNoCov">          0 : }</span>
<a name="3703"><span class="lineNum">    3703 </span>            : </a>
<span class="lineNum">    3704 </span>            : struct colcount { Color color; int cnt; };
<span class="lineNum">    3705 </span><span class="lineNoCov">          0 : static int colcountorder(const void *op1, const void *op2) {</span>
<span class="lineNum">    3706 </span><span class="lineNoCov">          0 :     const struct colcount *c1 = op1, *c2 = op2;</span>
<span class="lineNum">    3707 </span>            : 
<span class="lineNum">    3708 </span><span class="lineNoCov">          0 : return( c2-&gt;cnt - c1-&gt;cnt );              /* Biggest first */</span>
<a name="3709"><span class="lineNum">    3709 </span>            : }</a>
<span class="lineNum">    3710 </span>            : 
<span class="lineNum">    3711 </span><span class="lineNoCov">          0 : struct hslrgb *SFFontCols(SplineFont *sf,struct hslrgb fontcols[6]) {</span>
<span class="lineNum">    3712 </span>            :     int i, gid, cnt;
<span class="lineNum">    3713 </span>            :     struct colcount *colcount, stds[7];
<span class="lineNum">    3714 </span>            :     SplineChar *sc;
<span class="lineNum">    3715 </span>            : 
<span class="lineNum">    3716 </span><span class="lineNoCov">          0 :     memset(stds,0,sizeof(stds));</span>
<span class="lineNum">    3717 </span><span class="lineNoCov">          0 :     stds[0].color = 0xffffff;</span>
<span class="lineNum">    3718 </span><span class="lineNoCov">          0 :     stds[1].color = 0xff0000;</span>
<span class="lineNum">    3719 </span><span class="lineNoCov">          0 :     stds[2].color = 0x00ff00;</span>
<span class="lineNum">    3720 </span><span class="lineNoCov">          0 :     stds[3].color = 0x0000ff;</span>
<span class="lineNum">    3721 </span><span class="lineNoCov">          0 :     stds[4].color = 0xffff00;</span>
<span class="lineNum">    3722 </span><span class="lineNoCov">          0 :     stds[5].color = 0x00ffff;</span>
<span class="lineNum">    3723 </span><span class="lineNoCov">          0 :     stds[6].color = 0xff00ff;</span>
<span class="lineNum">    3724 </span><span class="lineNoCov">          0 :     colcount = calloc(sf-&gt;glyphcnt,sizeof(struct colcount));</span>
<span class="lineNum">    3725 </span>            : 
<span class="lineNum">    3726 </span><span class="lineNoCov">          0 :     cnt = 0;</span>
<span class="lineNum">    3727 </span><span class="lineNoCov">          0 :     for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( (sc= sf-&gt;glyphs[gid])!=NULL ) {</span>
<span class="lineNum">    3728 </span><span class="lineNoCov">          0 :         if ( sc-&gt;color==COLOR_DEFAULT )</span>
<span class="lineNum">    3729 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    3730 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;7 &amp;&amp; sc-&gt;color!=stds[i].color; ++i );</span>
<span class="lineNum">    3731 </span><span class="lineNoCov">          0 :         if ( i&lt;7 ) {</span>
<span class="lineNum">    3732 </span><span class="lineNoCov">          0 :             ++stds[i].cnt;</span>
<span class="lineNum">    3733 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    3734 </span>            :         }
<span class="lineNum">    3735 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;cnt &amp;&amp; sc-&gt;color!=colcount[i].color; ++i );</span>
<span class="lineNum">    3736 </span><span class="lineNoCov">          0 :         if ( i==cnt )</span>
<span class="lineNum">    3737 </span><span class="lineNoCov">          0 :             colcount[cnt++].color = sc-&gt;color;</span>
<span class="lineNum">    3738 </span><span class="lineNoCov">          0 :         ++colcount[i].cnt;</span>
<span class="lineNum">    3739 </span>            :     }
<span class="lineNum">    3740 </span>            : 
<span class="lineNum">    3741 </span><span class="lineNoCov">          0 :     if ( cnt&lt;6 ) {</span>
<span class="lineNum">    3742 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;cnt; ++i )</span>
<span class="lineNum">    3743 </span><span class="lineNoCov">          0 :             ++colcount[i].cnt;</span>
<span class="lineNum">    3744 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;7; ++i ) if ( stds[i].cnt!=0 ) {</span>
<span class="lineNum">    3745 </span><span class="lineNoCov">          0 :             colcount[cnt].color = stds[i].color;</span>
<span class="lineNum">    3746 </span><span class="lineNoCov">          0 :             colcount[cnt++].cnt = 1;</span>
<span class="lineNum">    3747 </span>            :         }
<span class="lineNum">    3748 </span>            :     }
<span class="lineNum">    3749 </span><span class="lineNoCov">          0 :     qsort(colcount,cnt,sizeof(struct colcount),colcountorder);</span>
<span class="lineNum">    3750 </span>            : 
<span class="lineNum">    3751 </span><span class="lineNoCov">          0 :     memset(fontcols,0,6*sizeof(struct hslrgb));</span>
<span class="lineNum">    3752 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;6 &amp;&amp; i&lt;cnt; ++i ) {</span>
<span class="lineNum">    3753 </span><span class="lineNoCov">          0 :         fontcols[i].rgb = true;</span>
<span class="lineNum">    3754 </span><span class="lineNoCov">          0 :         fontcols[i].r = ((colcount[i].color&gt;&gt;16)&amp;0xff)/255.0;</span>
<span class="lineNum">    3755 </span><span class="lineNoCov">          0 :         fontcols[i].g = ((colcount[i].color&gt;&gt;8 )&amp;0xff)/255.0;</span>
<span class="lineNum">    3756 </span><span class="lineNoCov">          0 :         fontcols[i].b = ((colcount[i].color    )&amp;0xff)/255.0;</span>
<span class="lineNum">    3757 </span>            :     }
<span class="lineNum">    3758 </span><span class="lineNoCov">          0 :     free(colcount);</span>
<span class="lineNum">    3759 </span><span class="lineNoCov">          0 :     if ( cnt==0 )</span>
<span class="lineNum">    3760 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    3761 </span>            : 
<span class="lineNum">    3762 </span><span class="lineNoCov">          0 : return(fontcols);</span>
<a name="3763"><span class="lineNum">    3763 </span>            : }</a>
<span class="lineNum">    3764 </span>            :     
<span class="lineNum">    3765 </span><span class="lineNoCov">          0 : static int CI_PickColor(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    3766 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_listselected ) {</span>
<span class="lineNum">    3767 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    3768 </span><span class="lineNoCov">          0 :         GTextInfo *ti = GGadgetGetListItemSelected(g);</span>
<span class="lineNum">    3769 </span><span class="lineNoCov">          0 :         if ( ti==NULL )</span>
<span class="lineNum">    3770 </span>            :             /* Can't happen */;
<span class="lineNum">    3771 </span><span class="lineNoCov">          0 :         else if ( ti-&gt;userdata == (void *) COLOR_CHOOSE ) {</span>
<span class="lineNum">    3772 </span>            :             struct hslrgb col, font_cols[6];
<span class="lineNum">    3773 </span><span class="lineNoCov">          0 :             memset(&amp;col,0,sizeof(col));</span>
<span class="lineNum">    3774 </span><span class="lineNoCov">          0 :             col.rgb = true;</span>
<span class="lineNum">    3775 </span><span class="lineNoCov">          0 :             col.r = ((ci-&gt;last&gt;&gt;16)&amp;0xff)/255.;</span>
<span class="lineNum">    3776 </span><span class="lineNoCov">          0 :             col.g = ((ci-&gt;last&gt;&gt;8 )&amp;0xff)/255.;</span>
<span class="lineNum">    3777 </span><span class="lineNoCov">          0 :             col.b = ((ci-&gt;last    )&amp;0xff)/255.;</span>
<span class="lineNum">    3778 </span><span class="lineNoCov">          0 :             col = GWidgetColor(_(&quot;Pick a color&quot;),&amp;col,SFFontCols(ci-&gt;sc-&gt;parent,font_cols));</span>
<span class="lineNum">    3779 </span><span class="lineNoCov">          0 :             if ( col.rgb ) {</span>
<span class="lineNum">    3780 </span><span class="lineNoCov">          0 :                 ci-&gt;last = (((int) rint(255.*col.r))&lt;&lt;16 ) |</span>
<span class="lineNum">    3781 </span><span class="lineNoCov">          0 :                             (((int) rint(255.*col.g))&lt;&lt;8 ) |</span>
<span class="lineNum">    3782 </span><span class="lineNoCov">          0 :                             (((int) rint(255.*col.b)) );</span>
<span class="lineNum">    3783 </span><span class="lineNoCov">          0 :                 CI_SetColorList(ci,ci-&gt;last);</span>
<span class="lineNum">    3784 </span>            :             } else /* Cancelled */
<span class="lineNum">    3785 </span><span class="lineNoCov">          0 :                 CI_SetColorList(ci,ci-&gt;real_last);</span>
<span class="lineNum">    3786 </span>            :         } else {
<span class="lineNum">    3787 </span><span class="lineNoCov">          0 :             if ( (intpt) ti-&gt;userdata!=COLOR_DEFAULT )</span>
<span class="lineNum">    3788 </span><span class="lineNoCov">          0 :                 ci-&gt;last = (intpt) ti-&gt;userdata;</span>
<span class="lineNum">    3789 </span><span class="lineNoCov">          0 :             ci-&gt;real_last = (intpt) ti-&gt;userdata;</span>
<span class="lineNum">    3790 </span>            :         }
<span class="lineNum">    3791 </span>            :     }
<span class="lineNum">    3792 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="3793"><span class="lineNum">    3793 </span>            : }</a>
<span class="lineNum">    3794 </span>            : 
<span class="lineNum">    3795 </span><span class="lineNoCov">          0 : static void CIFillup(CharInfo *ci) {</span>
<span class="lineNum">    3796 </span><span class="lineNoCov">          0 :     SplineChar *sc = ci-&gt;cachedsc!=NULL ? ci-&gt;cachedsc : ci-&gt;sc;</span>
<span class="lineNum">    3797 </span><span class="lineNoCov">          0 :     SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">    3798 </span>            :     unichar_t *temp;
<span class="lineNum">    3799 </span>            :     char buffer[400];
<span class="lineNum">    3800 </span>            :     char buf[200];
<span class="lineNum">    3801 </span>            :     const unichar_t *bits;
<span class="lineNum">    3802 </span>            :     int i,j,gid, isv;
<span class="lineNum">    3803 </span>            :     struct matrix_data *mds[pst_max];
<span class="lineNum">    3804 </span>            :     int cnts[pst_max];
<span class="lineNum">    3805 </span>            :     PST *pst;
<span class="lineNum">    3806 </span>            :     KernPair *kp;
<span class="lineNum">    3807 </span>            :     unichar_t ubuf[4];
<span class="lineNum">    3808 </span>            :     GTextInfo **ti;
<span class="lineNum">    3809 </span>            :     char *devtabstr;
<span class="lineNum">    3810 </span>            : 
<span class="lineNum">    3811 </span><span class="lineNoCov">          0 :     sprintf(buf,_(&quot;Glyph Info for %.40s&quot;),sc-&gt;name);</span>
<span class="lineNum">    3812 </span><span class="lineNoCov">          0 :     GDrawSetWindowTitles8(ci-&gt;gw, buf, _(&quot;Glyph Info...&quot;));</span>
<span class="lineNum">    3813 </span>            : 
<span class="lineNum">    3814 </span><span class="lineNoCov">          0 :     if ( ci-&gt;oldsc!=NULL &amp;&amp; ci-&gt;oldsc-&gt;charinfo==ci )</span>
<span class="lineNum">    3815 </span><span class="lineNoCov">          0 :         ci-&gt;oldsc-&gt;charinfo = NULL;</span>
<span class="lineNum">    3816 </span><span class="lineNoCov">          0 :     ci-&gt;sc-&gt;charinfo = ci;</span>
<span class="lineNum">    3817 </span><span class="lineNoCov">          0 :     ci-&gt;oldsc = ci-&gt;sc;</span>
<span class="lineNum">    3818 </span>            : 
<span class="lineNum">    3819 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(ci-&gt;gw,-1), ci-&gt;enc&gt;0 &amp;&amp;</span>
<span class="lineNum">    3820 </span><span class="lineNoCov">          0 :             ((gid=ci-&gt;map-&gt;map[ci-&gt;enc-1])==-1 ||</span>
<span class="lineNum">    3821 </span><span class="lineNoCov">          0 :              sf-&gt;glyphs[gid]==NULL || sf-&gt;glyphs[gid]-&gt;charinfo==NULL ||</span>
<span class="lineNum">    3822 </span><span class="lineNoCov">          0 :              gid==sc-&gt;orig_pos));</span>
<span class="lineNum">    3823 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(ci-&gt;gw,1), ci-&gt;enc&lt;ci-&gt;map-&gt;enccount-1 &amp;&amp;</span>
<span class="lineNum">    3824 </span><span class="lineNoCov">          0 :             ((gid=ci-&gt;map-&gt;map[ci-&gt;enc+1])==-1 ||</span>
<span class="lineNum">    3825 </span><span class="lineNoCov">          0 :              sf-&gt;glyphs[gid]==NULL || sf-&gt;glyphs[gid]-&gt;charinfo==NULL ||</span>
<span class="lineNum">    3826 </span><span class="lineNoCov">          0 :              gid==sc-&gt;orig_pos));</span>
<span class="lineNum">    3827 </span>            : 
<span class="lineNum">    3828 </span><span class="lineNoCov">          0 :     temp = utf82u_copy(sc-&gt;name);</span>
<span class="lineNum">    3829 </span><span class="lineNoCov">          0 :     GGadgetSetTitle(GWidgetGetControl(ci-&gt;gw,CID_UName),temp);</span>
<span class="lineNum">    3830 </span><span class="lineNoCov">          0 :     free(temp);</span>
<span class="lineNum">    3831 </span><span class="lineNoCov">          0 :     CI_SetNameList(ci,sc-&gt;unicodeenc);</span>
<span class="lineNum">    3832 </span>            : 
<span class="lineNum">    3833 </span><span class="lineNoCov">          0 :     sprintf(buffer,&quot;U+%04x&quot;, sc-&gt;unicodeenc);</span>
<span class="lineNum">    3834 </span><span class="lineNoCov">          0 :     temp = utf82u_copy(sc-&gt;unicodeenc==-1?&quot;-1&quot;:buffer);</span>
<span class="lineNum">    3835 </span><span class="lineNoCov">          0 :     GGadgetSetTitle(GWidgetGetControl(ci-&gt;gw,CID_UValue),temp);</span>
<span class="lineNum">    3836 </span><span class="lineNoCov">          0 :     free(temp);</span>
<span class="lineNum">    3837 </span>            : 
<span class="lineNum">    3838 </span><span class="lineNoCov">          0 :     ubuf[0] = sc-&gt;unicodeenc;</span>
<span class="lineNum">    3839 </span><span class="lineNoCov">          0 :     if ( sc-&gt;unicodeenc==-1 )</span>
<span class="lineNum">    3840 </span><span class="lineNoCov">          0 :         ubuf[0] = '\0';</span>
<span class="lineNum">    3841 </span><span class="lineNoCov">          0 :     ubuf[1] = '\0';</span>
<span class="lineNum">    3842 </span><span class="lineNoCov">          0 :     GGadgetSetTitle(GWidgetGetControl(ci-&gt;gw,CID_UChar),ubuf);</span>
<span class="lineNum">    3843 </span>            : 
<span class="lineNum">    3844 </span><span class="lineNoCov">          0 :     memset(cnts,0,sizeof(cnts));</span>
<span class="lineNum">    3845 </span><span class="lineNoCov">          0 :     for ( pst = sc-&gt;possub; pst!=NULL; pst=pst-&gt;next ) if ( pst-&gt;type!=pst_lcaret )</span>
<span class="lineNum">    3846 </span><span class="lineNoCov">          0 :         ++cnts[pst-&gt;type];</span>
<span class="lineNum">    3847 </span><span class="lineNoCov">          0 :     for ( isv=0; isv&lt;2; ++isv ) {</span>
<span class="lineNum">    3848 </span><span class="lineNoCov">          0 :         for ( kp=isv ? sc-&gt;vkerns : sc-&gt;kerns; kp!=NULL; kp=kp-&gt;next )</span>
<span class="lineNum">    3849 </span><span class="lineNoCov">          0 :             ++cnts[pst_pair];</span>
<span class="lineNum">    3850 </span>            :     }
<span class="lineNum">    3851 </span><span class="lineNoCov">          0 :     for ( i=pst_null+1; i&lt;pst_max &amp;&amp; i&lt;pst_lcaret ; ++i )</span>
<span class="lineNum">    3852 </span><span class="lineNoCov">          0 :         mds[i] = calloc((cnts[i]+1)*mi[i-1].col_cnt,sizeof(struct matrix_data));</span>
<span class="lineNum">    3853 </span><span class="lineNoCov">          0 :     memset(cnts,0,sizeof(cnts));</span>
<span class="lineNum">    3854 </span><span class="lineNoCov">          0 :     for ( pst = sc-&gt;possub; pst!=NULL; pst=pst-&gt;next ) if ( pst-&gt;type!=pst_lcaret ) {</span>
<span class="lineNum">    3855 </span><span class="lineNoCov">          0 :         j = (cnts[pst-&gt;type]++ * mi[pst-&gt;type-1].col_cnt);</span>
<span class="lineNum">    3856 </span><span class="lineNoCov">          0 :         mds[pst-&gt;type][j+0].u.md_ival = (intpt) pst-&gt;subtable;</span>
<span class="lineNum">    3857 </span><span class="lineNoCov">          0 :         if ( pst-&gt;type==pst_position ) {</span>
<span class="lineNum">    3858 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+SIM_DX].u.md_ival = pst-&gt;u.pos.xoff;</span>
<span class="lineNum">    3859 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+SIM_DY].u.md_ival = pst-&gt;u.pos.yoff;</span>
<span class="lineNum">    3860 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+SIM_DX_ADV].u.md_ival = pst-&gt;u.pos.h_adv_off;</span>
<span class="lineNum">    3861 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+SIM_DY_ADV].u.md_ival = pst-&gt;u.pos.v_adv_off;</span>
<span class="lineNum">    3862 </span><span class="lineNoCov">          0 :             ValDevTabToStrings(mds[pst_position],j+SIM_DX+1,pst-&gt;u.pos.adjust);</span>
<span class="lineNum">    3863 </span><span class="lineNoCov">          0 :         } else if ( pst-&gt;type==pst_pair ) {</span>
<span class="lineNum">    3864 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+1].u.md_str = copy(pst-&gt;u.pair.paired);</span>
<span class="lineNum">    3865 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+PAIR_DX1].u.md_ival = pst-&gt;u.pair.vr[0].xoff;</span>
<span class="lineNum">    3866 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+PAIR_DY1].u.md_ival = pst-&gt;u.pair.vr[0].yoff;</span>
<span class="lineNum">    3867 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+PAIR_DX_ADV1].u.md_ival = pst-&gt;u.pair.vr[0].h_adv_off;</span>
<span class="lineNum">    3868 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+PAIR_DY_ADV1].u.md_ival = pst-&gt;u.pair.vr[0].v_adv_off;</span>
<span class="lineNum">    3869 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+PAIR_DX2].u.md_ival = pst-&gt;u.pair.vr[1].xoff;</span>
<span class="lineNum">    3870 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+PAIR_DY2].u.md_ival = pst-&gt;u.pair.vr[1].yoff;</span>
<span class="lineNum">    3871 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+PAIR_DX_ADV2].u.md_ival = pst-&gt;u.pair.vr[1].h_adv_off;</span>
<span class="lineNum">    3872 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+PAIR_DY_ADV2].u.md_ival = pst-&gt;u.pair.vr[1].v_adv_off;</span>
<span class="lineNum">    3873 </span><span class="lineNoCov">          0 :             ValDevTabToStrings(mds[pst_pair],j+PAIR_DX1+1,pst-&gt;u.pair.vr[0].adjust);</span>
<span class="lineNum">    3874 </span><span class="lineNoCov">          0 :             ValDevTabToStrings(mds[pst_pair],j+PAIR_DX2+1,pst-&gt;u.pair.vr[1].adjust);</span>
<span class="lineNum">    3875 </span>            :         } else {
<span class="lineNum">    3876 </span><span class="lineNoCov">          0 :             mds[pst-&gt;type][j+1].u.md_str = SFNameList2NameUni(sf,pst-&gt;u.subs.variant);</span>
<span class="lineNum">    3877 </span>            :         }
<span class="lineNum">    3878 </span>            :     }
<span class="lineNum">    3879 </span><span class="lineNoCov">          0 :     for ( isv=0; isv&lt;2; ++isv ) {</span>
<span class="lineNum">    3880 </span><span class="lineNoCov">          0 :         for ( kp=isv ? sc-&gt;vkerns : sc-&gt;kerns; kp!=NULL; kp=kp-&gt;next ) {</span>
<span class="lineNum">    3881 </span><span class="lineNoCov">          0 :             j = (cnts[pst_pair]++ * mi[pst_pair-1].col_cnt);</span>
<span class="lineNum">    3882 </span><span class="lineNoCov">          0 :             mds[pst_pair][j+0].u.md_ival = (intpt) kp-&gt;subtable;</span>
<span class="lineNum">    3883 </span><span class="lineNoCov">          0 :             mds[pst_pair][j+1].u.md_str = SCNameUniStr(kp-&gt;sc);</span>
<span class="lineNum">    3884 </span><span class="lineNoCov">          0 :             if ( isv ) {</span>
<span class="lineNum">    3885 </span><span class="lineNoCov">          0 :                 mds[pst_pair][j+PAIR_DY_ADV1].u.md_ival = kp-&gt;off;</span>
<span class="lineNum">    3886 </span><span class="lineNoCov">          0 :                 DevTabToString(&amp;mds[pst_pair][j+PAIR_DY_ADV1+1].u.md_str,kp-&gt;adjust);</span>
<span class="lineNum">    3887 </span><span class="lineNoCov">          0 :             } else if ( kp-&gt;subtable-&gt;lookup-&gt;lookup_flags&amp;pst_r2l ) {</span>
<span class="lineNum">    3888 </span><span class="lineNoCov">          0 :                 mds[pst_pair][j+PAIR_DX_ADV2].u.md_ival = kp-&gt;off;</span>
<span class="lineNum">    3889 </span><span class="lineNoCov">          0 :                 DevTabToString(&amp;mds[pst_pair][j+PAIR_DX_ADV2+1].u.md_str,kp-&gt;adjust);</span>
<span class="lineNum">    3890 </span>            :             } else {
<span class="lineNum">    3891 </span><span class="lineNoCov">          0 :                 mds[pst_pair][j+PAIR_DX_ADV1].u.md_ival = kp-&gt;off;</span>
<span class="lineNum">    3892 </span><span class="lineNoCov">          0 :                 DevTabToString(&amp;mds[pst_pair][j+PAIR_DX_ADV1+1].u.md_str,kp-&gt;adjust);</span>
<span class="lineNum">    3893 </span>            :             }
<span class="lineNum">    3894 </span>            :         }
<span class="lineNum">    3895 </span>            :     }
<span class="lineNum">    3896 </span><span class="lineNoCov">          0 :     for ( i=pst_null+1; i&lt;pst_lcaret /* == pst_max-1 */; ++i ) {</span>
<span class="lineNum">    3897 </span><span class="lineNoCov">          0 :         GMatrixEditSet(GWidgetGetControl(ci-&gt;gw,CID_List+(i-1)*100),</span>
<span class="lineNum">    3898 </span>            :                 mds[i],cnts[i],false);
<span class="lineNum">    3899 </span>            :     }
<span class="lineNum">    3900 </span>            :     /* There's always a pane showing kerning data */
<span class="lineNum">    3901 </span><span class="lineNoCov">          0 :     CI_DoHideUnusedPair(ci);</span>
<span class="lineNum">    3902 </span><span class="lineNoCov">          0 :     CI_DoHideUnusedSingle(ci);</span>
<span class="lineNum">    3903 </span>            : 
<span class="lineNum">    3904 </span><span class="lineNoCov">          0 :     bits = SFGetAlternate(sc-&gt;parent,sc-&gt;unicodeenc,sc,true);</span>
<span class="lineNum">    3905 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_ComponentMsg),</span>
<span class="lineNum">    3906 </span>            :         bits==NULL ? _(&quot;No components&quot;) :
<span class="lineNum">    3907 </span><span class="lineNoCov">          0 :         hascomposing(sc-&gt;parent,sc-&gt;unicodeenc,sc) ? _(&quot;Accented glyph composed of:&quot;) :</span>
<span class="lineNum">    3908 </span>            :             _(&quot;Glyph composed of:&quot;));
<span class="lineNum">    3909 </span><span class="lineNoCov">          0 :     if ( bits==NULL ) {</span>
<span class="lineNum">    3910 </span><span class="lineNoCov">          0 :         ubuf[0] = '\0';</span>
<span class="lineNum">    3911 </span><span class="lineNoCov">          0 :         GGadgetSetTitle(GWidgetGetControl(ci-&gt;gw,CID_Components),ubuf);</span>
<span class="lineNum">    3912 </span>            :     } else {
<span class="lineNum">    3913 </span><span class="lineNoCov">          0 :         unichar_t *temp = malloc(11*u_strlen(bits)*sizeof(unichar_t));</span>
<span class="lineNum">    3914 </span><span class="lineNoCov">          0 :         unichar_t *upt=temp;</span>
<span class="lineNum">    3915 </span><span class="lineNoCov">          0 :         while ( *bits!='\0' ) {</span>
<span class="lineNum">    3916 </span><span class="lineNoCov">          0 :             sprintf(buffer, &quot;U+%04x &quot;, *bits );</span>
<span class="lineNum">    3917 </span><span class="lineNoCov">          0 :             uc_strcpy(upt,buffer);</span>
<span class="lineNum">    3918 </span><span class="lineNoCov">          0 :             upt += u_strlen(upt);</span>
<span class="lineNum">    3919 </span><span class="lineNoCov">          0 :             ++bits;</span>
<span class="lineNum">    3920 </span>            :         }
<span class="lineNum">    3921 </span><span class="lineNoCov">          0 :         upt[-1] = '\0';</span>
<span class="lineNum">    3922 </span><span class="lineNoCov">          0 :         GGadgetSetTitle(GWidgetGetControl(ci-&gt;gw,CID_Components),temp);</span>
<span class="lineNum">    3923 </span><span class="lineNoCov">          0 :         free(temp);</span>
<span class="lineNum">    3924 </span>            :     }
<span class="lineNum">    3925 </span>            : 
<span class="lineNum">    3926 </span><span class="lineNoCov">          0 :     GGadgetSelectOneListItem(GWidgetGetControl(ci-&gt;gw,CID_Color),0);</span>
<span class="lineNum">    3927 </span>            : 
<span class="lineNum">    3928 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(ci-&gt;gw,CID_UnlinkRmOverlap),sc-&gt;unlink_rm_ovrlp_save_undo);</span>
<span class="lineNum">    3929 </span>            : 
<span class="lineNum">    3930 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_Comment),</span>
<span class="lineNum">    3931 </span><span class="lineNoCov">          0 :             sc-&gt;comment?sc-&gt;comment:&quot;&quot;);</span>
<span class="lineNum">    3932 </span><span class="lineNoCov">          0 :     GGadgetSelectOneListItem(GWidgetGetControl(ci-&gt;gw,CID_GClass),sc-&gt;glyph_class);</span>
<span class="lineNum">    3933 </span><span class="lineNoCov">          0 :     CI_SetColorList(ci,sc-&gt;color);</span>
<span class="lineNum">    3934 </span><span class="lineNoCov">          0 :     ci-&gt;first = sc-&gt;comment==NULL;</span>
<span class="lineNum">    3935 </span>            : 
<span class="lineNum">    3936 </span><span class="lineNoCov">          0 :     ti = malloc((sc-&gt;countermask_cnt+1)*sizeof(GTextInfo *));</span>
<span class="lineNum">    3937 </span><span class="lineNoCov">          0 :     ti[sc-&gt;countermask_cnt] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">    3938 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;sc-&gt;countermask_cnt; ++i ) {</span>
<span class="lineNum">    3939 </span><span class="lineNoCov">          0 :         ti[i] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">    3940 </span><span class="lineNoCov">          0 :         ti[i]-&gt;text = CounterMaskLine(sc,&amp;sc-&gt;countermasks[i]);</span>
<span class="lineNum">    3941 </span><span class="lineNoCov">          0 :         ti[i]-&gt;fg = ti[i]-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">    3942 </span><span class="lineNoCov">          0 :         ti[i]-&gt;userdata = chunkalloc(sizeof(HintMask));</span>
<span class="lineNum">    3943 </span><span class="lineNoCov">          0 :         memcpy(ti[i]-&gt;userdata,sc-&gt;countermasks[i],sizeof(HintMask));</span>
<span class="lineNum">    3944 </span>            :     }
<span class="lineNum">    3945 </span><span class="lineNoCov">          0 :     GGadgetSetList(GWidgetGetControl(ci-&gt;gw,CID_List+600),ti,false);</span>
<span class="lineNum">    3946 </span>            : 
<span class="lineNum">    3947 </span><span class="lineNoCov">          0 :     if ( sc-&gt;tex_height!=TEX_UNDEF )</span>
<span class="lineNum">    3948 </span><span class="lineNoCov">          0 :         sprintf(buffer,&quot;%d&quot;,sc-&gt;tex_height);</span>
<span class="lineNum">    3949 </span>            :     else
<span class="lineNum">    3950 </span><span class="lineNoCov">          0 :         buffer[0] = '\0';</span>
<span class="lineNum">    3951 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TeX_Height),buffer);</span>
<span class="lineNum">    3952 </span>            : 
<span class="lineNum">    3953 </span><span class="lineNoCov">          0 :     if ( sc-&gt;tex_depth!=TEX_UNDEF )</span>
<span class="lineNum">    3954 </span><span class="lineNoCov">          0 :         sprintf(buffer,&quot;%d&quot;,sc-&gt;tex_depth);</span>
<span class="lineNum">    3955 </span>            :     else
<span class="lineNum">    3956 </span><span class="lineNoCov">          0 :         buffer[0] = '\0';</span>
<span class="lineNum">    3957 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TeX_Depth),buffer);</span>
<span class="lineNum">    3958 </span>            : 
<span class="lineNum">    3959 </span><span class="lineNoCov">          0 :     if ( sc-&gt;italic_correction!=TEX_UNDEF )</span>
<span class="lineNum">    3960 </span><span class="lineNoCov">          0 :         sprintf(buffer,&quot;%d&quot;,sc-&gt;italic_correction);</span>
<span class="lineNum">    3961 </span>            :     else
<span class="lineNum">    3962 </span><span class="lineNoCov">          0 :         buffer[0] = '\0';</span>
<span class="lineNum">    3963 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TeX_Italic),buffer);</span>
<span class="lineNum">    3964 </span><span class="lineNoCov">          0 :     DevTabToString(&amp;devtabstr,sc-&gt;italic_adjusts);</span>
<span class="lineNum">    3965 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_ItalicDevTab),devtabstr==NULL?&quot;&quot;:devtabstr);</span>
<span class="lineNum">    3966 </span><span class="lineNoCov">          0 :     free(devtabstr);</span>
<span class="lineNum">    3967 </span>            : 
<span class="lineNum">    3968 </span><span class="lineNoCov">          0 :     if ( sc-&gt;top_accent_horiz!=TEX_UNDEF )</span>
<span class="lineNum">    3969 </span><span class="lineNoCov">          0 :         sprintf(buffer,&quot;%d&quot;,sc-&gt;top_accent_horiz);</span>
<span class="lineNum">    3970 </span>            :     else
<span class="lineNum">    3971 </span><span class="lineNoCov">          0 :         buffer[0] = '\0';</span>
<span class="lineNum">    3972 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_HorAccent),buffer);</span>
<span class="lineNum">    3973 </span><span class="lineNoCov">          0 :     DevTabToString(&amp;devtabstr,sc-&gt;top_accent_adjusts);</span>
<span class="lineNum">    3974 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_AccentDevTab),devtabstr==NULL?&quot;&quot;:devtabstr);</span>
<span class="lineNum">    3975 </span><span class="lineNoCov">          0 :     free(devtabstr);</span>
<span class="lineNum">    3976 </span>            : 
<span class="lineNum">    3977 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(ci-&gt;gw,CID_IsExtended),sc-&gt;is_extended_shape);</span>
<span class="lineNum">    3978 </span>            : 
<span class="lineNum">    3979 </span>            :     {
<span class="lineNum">    3980 </span><span class="lineNoCov">          0 :         GGadget *g = GWidgetGetControl(ci-&gt;gw,CID_VariantList+0*100);</span>
<span class="lineNum">    3981 </span><span class="lineNoCov">          0 :         if ( sc-&gt;vert_variants==NULL || sc-&gt;vert_variants-&gt;variants==NULL )</span>
<span class="lineNum">    3982 </span><span class="lineNoCov">          0 :             GGadgetSetTitle8(g,&quot;&quot;);</span>
<span class="lineNum">    3983 </span>            :         else
<span class="lineNum">    3984 </span><span class="lineNoCov">          0 :             GGadgetSetTitle8(g,sc-&gt;vert_variants-&gt;variants);</span>
<span class="lineNum">    3985 </span><span class="lineNoCov">          0 :         sprintf(buffer,&quot;%d&quot;,sc-&gt;vert_variants!=NULL?sc-&gt;vert_variants-&gt;italic_correction:0);</span>
<span class="lineNum">    3986 </span><span class="lineNoCov">          0 :         GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_ExtItalicCor+0*100),buffer);</span>
<span class="lineNum">    3987 </span><span class="lineNoCov">          0 :         DevTabToString(&amp;devtabstr,sc-&gt;vert_variants!=NULL?</span>
<span class="lineNum">    3988 </span><span class="lineNoCov">          0 :                 sc-&gt;vert_variants-&gt;italic_adjusts:</span>
<span class="lineNum">    3989 </span>            :                 NULL);
<span class="lineNum">    3990 </span><span class="lineNoCov">          0 :         GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_ExtItalicDev+0*100),devtabstr==NULL?&quot;&quot;:devtabstr);</span>
<span class="lineNum">    3991 </span><span class="lineNoCov">          0 :         free(devtabstr);</span>
<span class="lineNum">    3992 </span>            : 
<span class="lineNum">    3993 </span><span class="lineNoCov">          0 :         g = GWidgetGetControl(ci-&gt;gw,CID_VariantList+1*100);</span>
<span class="lineNum">    3994 </span><span class="lineNoCov">          0 :         if ( sc-&gt;horiz_variants==NULL || sc-&gt;horiz_variants-&gt;variants==NULL )</span>
<span class="lineNum">    3995 </span><span class="lineNoCov">          0 :             GGadgetSetTitle8(g,&quot;&quot;);</span>
<span class="lineNum">    3996 </span>            :         else
<span class="lineNum">    3997 </span><span class="lineNoCov">          0 :             GGadgetSetTitle8(g,sc-&gt;horiz_variants-&gt;variants);</span>
<span class="lineNum">    3998 </span><span class="lineNoCov">          0 :         sprintf(buffer,&quot;%d&quot;,sc-&gt;horiz_variants!=NULL?sc-&gt;horiz_variants-&gt;italic_correction:0);</span>
<span class="lineNum">    3999 </span><span class="lineNoCov">          0 :         GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_ExtItalicCor+1*100),buffer);</span>
<span class="lineNum">    4000 </span><span class="lineNoCov">          0 :         DevTabToString(&amp;devtabstr,sc-&gt;horiz_variants!=NULL?</span>
<span class="lineNum">    4001 </span><span class="lineNoCov">          0 :                 sc-&gt;horiz_variants-&gt;italic_adjusts:</span>
<span class="lineNum">    4002 </span>            :                 NULL);
<span class="lineNum">    4003 </span><span class="lineNoCov">          0 :         GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_ExtItalicDev+1*100),devtabstr==NULL?&quot;&quot;:devtabstr);</span>
<span class="lineNum">    4004 </span><span class="lineNoCov">          0 :         free(devtabstr);</span>
<span class="lineNum">    4005 </span>            :     }
<span class="lineNum">    4006 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;2; ++i ) {</span>
<span class="lineNum">    4007 </span><span class="lineNoCov">          0 :         struct glyphvariants *gv = i ? sc-&gt;horiz_variants : sc-&gt;vert_variants ;</span>
<span class="lineNum">    4008 </span><span class="lineNoCov">          0 :         GGadget *g = GWidgetGetControl(ci-&gt;gw,CID_ExtensionList+i*100);</span>
<span class="lineNum">    4009 </span><span class="lineNoCov">          0 :         GV_ToMD(g, gv);</span>
<span class="lineNum">    4010 </span>            :     }
<span class="lineNum">    4011 </span><span class="lineNoCov">          0 :     GA_ToMD(GWidgetGetControl(ci-&gt;gw,CID_AltUni), sc);</span>
<span class="lineNum">    4012 </span>            : 
<span class="lineNum">    4013 </span><span class="lineNoCov">          0 :     if ( ci-&gt;sc-&gt;parent-&gt;multilayer ) {</span>
<span class="lineNum">    4014 </span><span class="lineNoCov">          0 :         int margined = sc-&gt;tile_margin!=0 || (sc-&gt;tile_bounds.minx==0 &amp;&amp; sc-&gt;tile_bounds.maxx==0);</span>
<span class="lineNum">    4015 </span>            :         char buffer[40];
<span class="lineNum">    4016 </span>            : 
<span class="lineNum">    4017 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(ci-&gt;gw,CID_IsTileMargin),margined);</span>
<span class="lineNum">    4018 </span><span class="lineNoCov">          0 :         if ( margined ) {</span>
<span class="lineNum">    4019 </span><span class="lineNoCov">          0 :             sprintf( buffer, &quot;%g&quot;, (double) sc-&gt;tile_margin );</span>
<span class="lineNum">    4020 </span><span class="lineNoCov">          0 :             GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TileMargin),buffer);</span>
<span class="lineNum">    4021 </span><span class="lineNoCov">          0 :             CI_BoundsToMargin(ci);</span>
<span class="lineNum">    4022 </span>            :         } else {
<span class="lineNum">    4023 </span><span class="lineNoCov">          0 :             GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TileMargin),&quot;0&quot;);</span>
<span class="lineNum">    4024 </span><span class="lineNoCov">          0 :             sprintf( buffer, &quot;%g&quot;, (double) sc-&gt;tile_bounds.minx );</span>
<span class="lineNum">    4025 </span><span class="lineNoCov">          0 :             GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TileBBoxMinX),buffer);</span>
<span class="lineNum">    4026 </span><span class="lineNoCov">          0 :             sprintf( buffer, &quot;%g&quot;, (double) sc-&gt;tile_bounds.miny );</span>
<span class="lineNum">    4027 </span><span class="lineNoCov">          0 :             GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TileBBoxMinY),buffer);</span>
<span class="lineNum">    4028 </span><span class="lineNoCov">          0 :             sprintf( buffer, &quot;%g&quot;, (double) sc-&gt;tile_bounds.maxx );</span>
<span class="lineNum">    4029 </span><span class="lineNoCov">          0 :             GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TileBBoxMaxX),buffer);</span>
<span class="lineNum">    4030 </span><span class="lineNoCov">          0 :             sprintf( buffer, &quot;%g&quot;, (double) sc-&gt;tile_bounds.maxy );</span>
<span class="lineNum">    4031 </span><span class="lineNoCov">          0 :             GGadgetSetTitle8(GWidgetGetControl(ci-&gt;gw,CID_TileBBoxMaxY),buffer);</span>
<span class="lineNum">    4032 </span>            :         }
<span class="lineNum">    4033 </span>            :     }
<span class="lineNum">    4034 </span>            : 
<span class="lineNum">    4035 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(ci-&gt;gw,CID_DefLCCount), !sc-&gt;lig_caret_cnt_fixed );</span>
<span class="lineNum">    4036 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(ci-&gt;gw,CID_LCCountLab), sc-&gt;lig_caret_cnt_fixed );</span>
<span class="lineNum">    4037 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(ci-&gt;gw,CID_LCCount), sc-&gt;lig_caret_cnt_fixed );</span>
<span class="lineNum">    4038 </span><span class="lineNoCov">          0 :     ci-&gt;lc_seen = false;</span>
<span class="lineNum">    4039 </span><span class="lineNoCov">          0 :     CI_NoteAspect(ci);</span>
<a name="4040"><span class="lineNum">    4040 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4041 </span>            : 
<span class="lineNum">    4042 </span><span class="lineNoCov">          0 : static int CI_NextPrev(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    4043 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    4044 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    4045 </span><span class="lineNoCov">          0 :         int enc = ci-&gt;enc + GGadgetGetCid(g);        /* cid is 1 for next, -1 for prev */</span>
<span class="lineNum">    4046 </span>            :         SplineChar *new_;
<span class="lineNum">    4047 </span>            :         struct splinecharlist *scl;
<span class="lineNum">    4048 </span>            : 
<span class="lineNum">    4049 </span><span class="lineNoCov">          0 :         if ( enc&lt;0 || enc&gt;=ci-&gt;map-&gt;enccount ) {</span>
<span class="lineNum">    4050 </span><span class="lineNoCov">          0 :             GGadgetSetEnabled(g,false);</span>
<span class="lineNum">    4051 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4052 </span>            :         }
<span class="lineNum">    4053 </span><span class="lineNoCov">          0 :         if ( !_CI_OK(ci))</span>
<span class="lineNum">    4054 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4055 </span><span class="lineNoCov">          0 :         new_ = SFMakeChar(ci-&gt;sc-&gt;parent,ci-&gt;map,enc);</span>
<span class="lineNum">    4056 </span><span class="lineNoCov">          0 :         if ( new_-&gt;charinfo!=NULL &amp;&amp; new_-&gt;charinfo!=ci ) {</span>
<span class="lineNum">    4057 </span><span class="lineNoCov">          0 :             GGadgetSetEnabled(g,false);</span>
<span class="lineNum">    4058 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4059 </span>            :         }
<span class="lineNum">    4060 </span><span class="lineNoCov">          0 :         ci-&gt;sc = new_;</span>
<span class="lineNum">    4061 </span><span class="lineNoCov">          0 :         ci-&gt;enc = enc;</span>
<span class="lineNum">    4062 </span><span class="lineNoCov">          0 :         for ( scl=ci-&gt;changes; scl!=NULL &amp;&amp; scl-&gt;sc-&gt;orig_pos!=new_-&gt;orig_pos;</span>
<span class="lineNum">    4063 </span><span class="lineNoCov">          0 :                 scl = scl-&gt;next );</span>
<span class="lineNum">    4064 </span><span class="lineNoCov">          0 :         ci-&gt;cachedsc = scl==NULL ? NULL : scl-&gt;sc;</span>
<span class="lineNum">    4065 </span><span class="lineNoCov">          0 :         CIFillup(ci);</span>
<span class="lineNum">    4066 </span>            :     }
<span class="lineNum">    4067 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="4068"><span class="lineNum">    4068 </span>            : }</a>
<span class="lineNum">    4069 </span>            : 
<span class="lineNum">    4070 </span><span class="lineNoCov">          0 : static void CI_DoCancel(CharInfo *ci) {</span>
<span class="lineNum">    4071 </span>            :     int32 i,len;
<span class="lineNum">    4072 </span><span class="lineNoCov">          0 :     GTextInfo **ti = GGadgetGetList(GWidgetGetControl(ci-&gt;gw,CID_List+600),&amp;len);</span>
<span class="lineNum">    4073 </span>            : 
<span class="lineNum">    4074 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;len; ++i )</span>
<span class="lineNum">    4075 </span><span class="lineNoCov">          0 :         chunkfree(ti[i]-&gt;userdata,sizeof(HintMask));</span>
<span class="lineNum">    4076 </span><span class="lineNoCov">          0 :     CI_Finish(ci);</span>
<a name="4077"><span class="lineNum">    4077 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4078 </span>            : 
<span class="lineNum">    4079 </span><span class="lineNoCov">          0 : static int CI_Cancel(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    4080 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    4081 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    4082 </span><span class="lineNoCov">          0 :         CI_DoCancel(ci);</span>
<span class="lineNum">    4083 </span>            :     }
<span class="lineNum">    4084 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="4085"><span class="lineNum">    4085 </span>            : }</a>
<span class="lineNum">    4086 </span>            : 
<span class="lineNum">    4087 </span><span class="lineNoCov">          0 : static int ci_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    4088 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">    4089 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(gw);</span>
<span class="lineNum">    4090 </span><span class="lineNoCov">          0 :         CI_DoCancel(ci);</span>
<span class="lineNum">    4091 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_char ) {</span>
<span class="lineNum">    4092 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(gw);</span>
<span class="lineNum">    4093 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.keysym == GK_F1 || event-&gt;u.chr.keysym == GK_Help ) {</span>
<span class="lineNum">    4094 </span><span class="lineNoCov">          0 :             help(&quot;charinfo.html&quot;);</span>
<span class="lineNum">    4095 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4096 </span><span class="lineNoCov">          0 :         } else if ( GMenuIsCommand(event,H_(&quot;Quit|Ctl+Q&quot;) )) {</span>
<span class="lineNum">    4097 </span><span class="lineNoCov">          0 :             MenuExit(NULL,NULL,NULL);</span>
<span class="lineNum">    4098 </span><span class="lineNoCov">          0 :         } else if ( GMenuIsCommand(event,H_(&quot;Close|Ctl+Shft+Q&quot;) )) {</span>
<span class="lineNum">    4099 </span><span class="lineNoCov">          0 :             CI_DoCancel(ci);</span>
<span class="lineNum">    4100 </span>            :         }
<span class="lineNum">    4101 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    4102 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_destroy ) {</span>
<span class="lineNum">    4103 </span><span class="lineNoCov">          0 :         CharInfo *ci = GDrawGetUserData(gw);</span>
<span class="lineNum">    4104 </span><span class="lineNoCov">          0 :         ci-&gt;sc-&gt;charinfo = NULL;</span>
<span class="lineNum">    4105 </span><span class="lineNoCov">          0 :         free(ci);</span>
<span class="lineNum">    4106 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_map ) {</span>
<span class="lineNum">    4107 </span>            :         /* Above palettes */
<span class="lineNum">    4108 </span><span class="lineNoCov">          0 :         GDrawRaise(gw);</span>
<span class="lineNum">    4109 </span>            :     }
<span class="lineNum">    4110 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="4111"><span class="lineNum">    4111 </span>            : }</a>
<span class="lineNum">    4112 </span>            : 
<span class="lineNum">    4113 </span><span class="lineNoCov">          0 : void SCCharInfo(SplineChar *sc,int deflayer, EncMap *map,int enc) {</span>
<span class="lineNum">    4114 </span>            :     CharInfo *ci;
<span class="lineNum">    4115 </span>            :     GRect pos;
<span class="lineNum">    4116 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    4117 </span>            :     GGadgetCreateData ugcd[14], cgcd[6], psgcd[7][7], cogcd[3], mgcd[9], tgcd[16];
<span class="lineNum">    4118 </span>            :     GGadgetCreateData lcgcd[4], vargcd[2][7];
<span class="lineNum">    4119 </span>            :     GTextInfo ulabel[14], clabel[6], pslabel[7][6], colabel[3], mlabel[9], tlabel[16];
<span class="lineNum">    4120 </span>            :     GTextInfo lclabel[4], varlabel[2][6];
<span class="lineNum">    4121 </span>            :     GGadgetCreateData mbox[4], *mvarray[7], *mharray1[7], *mharray2[8];
<span class="lineNum">    4122 </span>            :     GGadgetCreateData ubox[3], *uhvarray[29], *uharray[6];
<span class="lineNum">    4123 </span>            :     GGadgetCreateData cbox[3], *cvarray[5], *charray[4];
<span class="lineNum">    4124 </span>            :     GGadgetCreateData pstbox[7][4], *pstvarray[7][5], *pstharray1[7][8];
<span class="lineNum">    4125 </span>            :     GGadgetCreateData cobox[2], *covarray[4];
<span class="lineNum">    4126 </span>            :     GGadgetCreateData tbox[3], *thvarray[36], *tbarray[4];
<span class="lineNum">    4127 </span>            :     GGadgetCreateData lcbox[2], *lchvarray[4][4];
<span class="lineNum">    4128 </span>            :     GGadgetCreateData varbox[2][2], *varhvarray[2][5][4];
<span class="lineNum">    4129 </span>            :     GGadgetCreateData tilegcd[16], tilebox[4];
<span class="lineNum">    4130 </span>            :     GTextInfo tilelabel[16];
<span class="lineNum">    4131 </span>            :     GGadgetCreateData *tlvarray[6], *tlharray[4], *tlhvarray[4][5];
<span class="lineNum">    4132 </span>            :     int i;
<span class="lineNum">    4133 </span>            :     GTabInfo aspects[17];
<span class="lineNum">    4134 </span>            :     static GBox smallbox = { bt_raised, bs_rect, 2, 1, 0, 0, 0, 0, 0, 0, COLOR_DEFAULT, COLOR_DEFAULT, 0, 0, 0, 0, 0, 0, 0 };
<span class="lineNum">    4135 </span>            :     static int boxset=0;
<span class="lineNum">    4136 </span>            :     FontRequest rq;
<span class="lineNum">    4137 </span>            :     static GFont *font=NULL;
<span class="lineNum">    4138 </span>            : 
<span class="lineNum">    4139 </span><span class="lineNoCov">          0 :     CharInfoInit();</span>
<span class="lineNum">    4140 </span>            : 
<span class="lineNum">    4141 </span><span class="lineNoCov">          0 :     if ( sc-&gt;charinfo!=NULL ) {</span>
<span class="lineNum">    4142 </span><span class="lineNoCov">          0 :         GDrawSetVisible(sc-&gt;charinfo-&gt;gw,true);</span>
<span class="lineNum">    4143 </span><span class="lineNoCov">          0 :         GDrawRaise(sc-&gt;charinfo-&gt;gw);</span>
<span class="lineNum">    4144 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    4145 </span>            :     }
<span class="lineNum">    4146 </span>            : 
<span class="lineNum">    4147 </span><span class="lineNoCov">          0 :     ci = calloc(1,sizeof(CharInfo));</span>
<span class="lineNum">    4148 </span><span class="lineNoCov">          0 :     ci-&gt;sc = sc;</span>
<span class="lineNum">    4149 </span><span class="lineNoCov">          0 :     ci-&gt;def_layer = deflayer;</span>
<span class="lineNum">    4150 </span><span class="lineNoCov">          0 :     ci-&gt;done = false;</span>
<span class="lineNum">    4151 </span><span class="lineNoCov">          0 :     ci-&gt;map = map;</span>
<span class="lineNum">    4152 </span><span class="lineNoCov">          0 :     ci-&gt;last = 0xffffff;</span>
<span class="lineNum">    4153 </span><span class="lineNoCov">          0 :     if ( enc==-1 )</span>
<span class="lineNum">    4154 </span><span class="lineNoCov">          0 :         enc = map-&gt;backmap[sc-&gt;orig_pos];</span>
<span class="lineNum">    4155 </span><span class="lineNoCov">          0 :     ci-&gt;enc = enc;</span>
<span class="lineNum">    4156 </span>            : 
<span class="lineNum">    4157 </span><span class="lineNoCov">          0 :     if ( !boxset ) {</span>
<span class="lineNum">    4158 </span>            :         extern GBox _ggadget_Default_Box;
<span class="lineNum">    4159 </span><span class="lineNoCov">          0 :         GGadgetInit();</span>
<span class="lineNum">    4160 </span><span class="lineNoCov">          0 :         smallbox = _ggadget_Default_Box;</span>
<span class="lineNum">    4161 </span><span class="lineNoCov">          0 :         smallbox.padding = 1;</span>
<span class="lineNum">    4162 </span><span class="lineNoCov">          0 :         boxset = 1;</span>
<span class="lineNum">    4163 </span>            :     }
<span class="lineNum">    4164 </span>            : 
<span class="lineNum">    4165 </span><span class="lineNoCov">          0 :         memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    4166 </span><span class="lineNoCov">          0 :         wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_isdlg|wam_restrict;</span>
<span class="lineNum">    4167 </span><span class="lineNoCov">          0 :         wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">    4168 </span><span class="lineNoCov">          0 :         wattrs.restrict_input_to_me = false;</span>
<span class="lineNum">    4169 </span><span class="lineNoCov">          0 :         wattrs.undercursor = 1;</span>
<span class="lineNum">    4170 </span><span class="lineNoCov">          0 :         wattrs.cursor = ct_pointer;</span>
<span class="lineNum">    4171 </span><span class="lineNoCov">          0 :         wattrs.utf8_window_title =  _(&quot;Glyph Info&quot;);</span>
<span class="lineNum">    4172 </span><span class="lineNoCov">          0 :         wattrs.is_dlg = false;</span>
<span class="lineNum">    4173 </span><span class="lineNoCov">          0 :         pos.x = pos.y = 0;</span>
<span class="lineNum">    4174 </span><span class="lineNoCov">          0 :         pos.width = GGadgetScale(GDrawPointsToPixels(NULL,CI_Width+65));</span>
<span class="lineNum">    4175 </span><span class="lineNoCov">          0 :         pos.height = GDrawPointsToPixels(NULL,CI_Height);</span>
<span class="lineNum">    4176 </span><span class="lineNoCov">          0 :         ci-&gt;gw = GDrawCreateTopWindow(NULL,&amp;pos,ci_e_h,ci,&amp;wattrs);</span>
<span class="lineNum">    4177 </span>            : 
<span class="lineNum">    4178 </span><span class="lineNoCov">          0 :         memset(&amp;ugcd,0,sizeof(ugcd));</span>
<span class="lineNum">    4179 </span><span class="lineNoCov">          0 :         memset(&amp;ubox,0,sizeof(ubox));</span>
<span class="lineNum">    4180 </span><span class="lineNoCov">          0 :         memset(&amp;ulabel,0,sizeof(ulabel));</span>
<span class="lineNum">    4181 </span>            : 
<span class="lineNum">    4182 </span><span class="lineNoCov">          0 :         ulabel[0].text = (unichar_t *) _(&quot;Gl_yph Name:&quot;);</span>
<span class="lineNum">    4183 </span><span class="lineNoCov">          0 :         ulabel[0].text_is_1byte = true;</span>
<span class="lineNum">    4184 </span><span class="lineNoCov">          0 :         ulabel[0].text_in_resource = true;</span>
<span class="lineNum">    4185 </span><span class="lineNoCov">          0 :         ugcd[0].gd.label = &amp;ulabel[0];</span>
<span class="lineNum">    4186 </span><span class="lineNoCov">          0 :         ugcd[0].gd.pos.x = 5; ugcd[0].gd.pos.y = 5+4; </span>
<span class="lineNum">    4187 </span><span class="lineNoCov">          0 :         ugcd[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4188 </span><span class="lineNoCov">          0 :         ugcd[0].gd.mnemonic = 'N';</span>
<span class="lineNum">    4189 </span><span class="lineNoCov">          0 :         ugcd[0].creator = GLabelCreate;</span>
<span class="lineNum">    4190 </span><span class="lineNoCov">          0 :         uhvarray[0] = &amp;ugcd[0];</span>
<span class="lineNum">    4191 </span>            : 
<span class="lineNum">    4192 </span><span class="lineNoCov">          0 :         ugcd[1].gd.pos.x = 85; ugcd[1].gd.pos.y = 5;</span>
<span class="lineNum">    4193 </span><span class="lineNoCov">          0 :         ugcd[1].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4194 </span><span class="lineNoCov">          0 :         ugcd[1].gd.mnemonic = 'N';</span>
<span class="lineNum">    4195 </span><span class="lineNoCov">          0 :         ugcd[1].gd.cid = CID_UName;</span>
<span class="lineNum">    4196 </span><span class="lineNoCov">          0 :         ugcd[1].creator = GListFieldCreate;</span>
<span class="lineNum">    4197 </span><span class="lineNoCov">          0 :         ugcd[1].data = (void *) (-2);</span>
<span class="lineNum">    4198 </span><span class="lineNoCov">          0 :         uhvarray[1] = &amp;ugcd[1]; uhvarray[2] = NULL;</span>
<span class="lineNum">    4199 </span>            : 
<span class="lineNum">    4200 </span><span class="lineNoCov">          0 :         ulabel[2].text = (unichar_t *) _(&quot;Unicode _Value:&quot;);</span>
<span class="lineNum">    4201 </span><span class="lineNoCov">          0 :         ulabel[2].text_in_resource = true;</span>
<span class="lineNum">    4202 </span><span class="lineNoCov">          0 :         ulabel[2].text_is_1byte = true;</span>
<span class="lineNum">    4203 </span><span class="lineNoCov">          0 :         ugcd[2].gd.label = &amp;ulabel[2];</span>
<span class="lineNum">    4204 </span><span class="lineNoCov">          0 :         ugcd[2].gd.pos.x = 5; ugcd[2].gd.pos.y = 31+4; </span>
<span class="lineNum">    4205 </span><span class="lineNoCov">          0 :         ugcd[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4206 </span><span class="lineNoCov">          0 :         ugcd[2].gd.mnemonic = 'V';</span>
<span class="lineNum">    4207 </span><span class="lineNoCov">          0 :         ugcd[2].creator = GLabelCreate;</span>
<span class="lineNum">    4208 </span><span class="lineNoCov">          0 :         uhvarray[3] = &amp;ugcd[2];</span>
<span class="lineNum">    4209 </span>            : 
<span class="lineNum">    4210 </span><span class="lineNoCov">          0 :         ugcd[3].gd.pos.x = 85; ugcd[3].gd.pos.y = 31;</span>
<span class="lineNum">    4211 </span><span class="lineNoCov">          0 :         ugcd[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4212 </span><span class="lineNoCov">          0 :         ugcd[3].gd.mnemonic = 'V';</span>
<span class="lineNum">    4213 </span><span class="lineNoCov">          0 :         ugcd[3].gd.cid = CID_UValue;</span>
<span class="lineNum">    4214 </span><span class="lineNoCov">          0 :         ugcd[3].gd.handle_controlevent = CI_UValChanged;</span>
<span class="lineNum">    4215 </span><span class="lineNoCov">          0 :         ugcd[3].creator = GTextFieldCreate;</span>
<span class="lineNum">    4216 </span><span class="lineNoCov">          0 :         uhvarray[4] = &amp;ugcd[3]; uhvarray[5] = NULL;</span>
<span class="lineNum">    4217 </span>            : 
<span class="lineNum">    4218 </span><span class="lineNoCov">          0 :         ulabel[4].text = (unichar_t *) _(&quot;Unicode C_har:&quot;);</span>
<span class="lineNum">    4219 </span><span class="lineNoCov">          0 :         ulabel[4].text_in_resource = true;</span>
<span class="lineNum">    4220 </span><span class="lineNoCov">          0 :         ulabel[4].text_is_1byte = true;</span>
<span class="lineNum">    4221 </span><span class="lineNoCov">          0 :         ugcd[4].gd.label = &amp;ulabel[4];</span>
<span class="lineNum">    4222 </span><span class="lineNoCov">          0 :         ugcd[4].gd.pos.x = 5; ugcd[4].gd.pos.y = 57+4; </span>
<span class="lineNum">    4223 </span><span class="lineNoCov">          0 :         ugcd[4].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4224 </span><span class="lineNoCov">          0 :         ugcd[4].gd.mnemonic = 'h';</span>
<span class="lineNum">    4225 </span><span class="lineNoCov">          0 :         ugcd[4].creator = GLabelCreate;</span>
<span class="lineNum">    4226 </span><span class="lineNoCov">          0 :         uhvarray[6] = &amp;ugcd[4];</span>
<span class="lineNum">    4227 </span>            : 
<span class="lineNum">    4228 </span><span class="lineNoCov">          0 :         ugcd[5].gd.pos.x = 85; ugcd[5].gd.pos.y = 57;</span>
<span class="lineNum">    4229 </span><span class="lineNoCov">          0 :         ugcd[5].gd.flags = gg_enabled|gg_visible|gg_text_xim;</span>
<span class="lineNum">    4230 </span><span class="lineNoCov">          0 :         ugcd[5].gd.mnemonic = 'h';</span>
<span class="lineNum">    4231 </span><span class="lineNoCov">          0 :         ugcd[5].gd.cid = CID_UChar;</span>
<span class="lineNum">    4232 </span><span class="lineNoCov">          0 :         ugcd[5].gd.handle_controlevent = CI_CharChanged;</span>
<span class="lineNum">    4233 </span><span class="lineNoCov">          0 :         ugcd[5].creator = GTextFieldCreate;</span>
<span class="lineNum">    4234 </span><span class="lineNoCov">          0 :         uhvarray[7] = &amp;ugcd[5]; uhvarray[8] = NULL;</span>
<span class="lineNum">    4235 </span>            : 
<span class="lineNum">    4236 </span><span class="lineNoCov">          0 :         ugcd[6].gd.pos.x = 12; ugcd[6].gd.pos.y = 117;</span>
<span class="lineNum">    4237 </span><span class="lineNoCov">          0 :         ugcd[6].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4238 </span><span class="lineNoCov">          0 :         ulabel[6].text = (unichar_t *) _(&quot;Set From N_ame&quot;);</span>
<span class="lineNum">    4239 </span><span class="lineNoCov">          0 :         ulabel[6].text_is_1byte = true;</span>
<span class="lineNum">    4240 </span><span class="lineNoCov">          0 :         ulabel[6].text_in_resource = true;</span>
<span class="lineNum">    4241 </span><span class="lineNoCov">          0 :         ugcd[6].gd.mnemonic = 'a';</span>
<span class="lineNum">    4242 </span><span class="lineNoCov">          0 :         ugcd[6].gd.label = &amp;ulabel[6];</span>
<span class="lineNum">    4243 </span><span class="lineNoCov">          0 :         ugcd[6].gd.handle_controlevent = CI_SName;</span>
<span class="lineNum">    4244 </span><span class="lineNoCov">          0 :         ugcd[6].creator = GButtonCreate;</span>
<span class="lineNum">    4245 </span><span class="lineNoCov">          0 :         uharray[0] = GCD_Glue; uharray[1] = &amp;ugcd[6];</span>
<span class="lineNum">    4246 </span>            : 
<span class="lineNum">    4247 </span><span class="lineNoCov">          0 :         ugcd[7].gd.pos.x = 107; ugcd[7].gd.pos.y = 117;</span>
<span class="lineNum">    4248 </span><span class="lineNoCov">          0 :         ugcd[7].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4249 </span><span class="lineNoCov">          0 :         ulabel[7].text = (unichar_t *) _(&quot;Set From Val_ue&quot;);</span>
<span class="lineNum">    4250 </span><span class="lineNoCov">          0 :         ulabel[7].text_is_1byte = true;</span>
<span class="lineNum">    4251 </span><span class="lineNoCov">          0 :         ulabel[7].text_in_resource = true;</span>
<span class="lineNum">    4252 </span><span class="lineNoCov">          0 :         ugcd[7].gd.mnemonic = 'l';</span>
<span class="lineNum">    4253 </span><span class="lineNoCov">          0 :         ugcd[7].gd.label = &amp;ulabel[7];</span>
<span class="lineNum">    4254 </span><span class="lineNoCov">          0 :         ugcd[7].gd.handle_controlevent = CI_SValue;</span>
<span class="lineNum">    4255 </span><span class="lineNoCov">          0 :         ugcd[7].creator = GButtonCreate;</span>
<span class="lineNum">    4256 </span><span class="lineNoCov">          0 :         uharray[2] = GCD_Glue; uharray[3] = &amp;ugcd[7]; uharray[4] = GCD_Glue; uharray[5] = NULL;</span>
<span class="lineNum">    4257 </span>            : 
<span class="lineNum">    4258 </span><span class="lineNoCov">          0 :         ubox[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4259 </span><span class="lineNoCov">          0 :         ubox[2].gd.u.boxelements = uharray;</span>
<span class="lineNum">    4260 </span><span class="lineNoCov">          0 :         ubox[2].creator = GHBoxCreate;</span>
<span class="lineNum">    4261 </span><span class="lineNoCov">          0 :         uhvarray[9] = &amp;ubox[2]; uhvarray[10] = GCD_ColSpan; uhvarray[11] = NULL;</span>
<span class="lineNum">    4262 </span>            : 
<span class="lineNum">    4263 </span><span class="lineNoCov">          0 :         ugcd[8].gd.flags = gg_visible | gg_enabled|gg_utf8_popup;</span>
<span class="lineNum">    4264 </span><span class="lineNoCov">          0 :         ulabel[8].text = (unichar_t *) _(&quot;Alternate Unicode Encodings / Variation Selectors&quot;);</span>
<span class="lineNum">    4265 </span><span class="lineNoCov">          0 :         ulabel[8].text_is_1byte = true;</span>
<span class="lineNum">    4266 </span><span class="lineNoCov">          0 :         ugcd[8].gd.label = &amp;ulabel[8];</span>
<span class="lineNum">    4267 </span><span class="lineNoCov">          0 :         ugcd[8].gd.popup_msg = (unichar_t *) _(</span>
<span class="lineNum">    4268 </span>            :             &quot;Some glyphs may be used for more than one\n&quot;
<span class="lineNum">    4269 </span>            :             &quot;unicode code point -- I don't recommend\n&quot;
<span class="lineNum">    4270 </span>            :             &quot;doing this, better to use a reference --\n&quot;
<span class="lineNum">    4271 </span>            :             &quot;but it is possible.\n&quot;
<span class="lineNum">    4272 </span>            :             &quot;The latin \&quot;A\&quot;, the greek \&quot;Alpha\&quot; and the\n&quot;
<span class="lineNum">    4273 </span>            :             &quot;cyrillic \&quot;A\&quot; look very much the same.\n\n&quot;
<span class="lineNum">    4274 </span>            :             &quot;On the other hand certain Mongolian and CJK\n&quot;
<span class="lineNum">    4275 </span>            :             &quot;characters have multiple glyphs depending\n&quot;
<span class="lineNum">    4276 </span>            :             &quot;on a unicode Variation Selector.\n\n&quot;
<span class="lineNum">    4277 </span>            :             &quot;In the first case use a variation selector\n&quot;
<span class="lineNum">    4278 </span>            :             &quot;of 0, in the second use the appropriate\n&quot;
<span class="lineNum">    4279 </span>            :             &quot;codepoint.&quot;);
<span class="lineNum">    4280 </span><span class="lineNoCov">          0 :         ugcd[8].creator = GLabelCreate;</span>
<span class="lineNum">    4281 </span><span class="lineNoCov">          0 :         uhvarray[12] = &amp;ugcd[8]; uhvarray[13] = GCD_ColSpan; uhvarray[14] = NULL;</span>
<span class="lineNum">    4282 </span>            : 
<span class="lineNum">    4283 </span><span class="lineNoCov">          0 :         ugcd[9].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4284 </span><span class="lineNoCov">          0 :         ugcd[9].gd.u.matrix = &amp;mi_altuniinfo;</span>
<span class="lineNum">    4285 </span><span class="lineNoCov">          0 :         ugcd[9].gd.cid = CID_AltUni;</span>
<span class="lineNum">    4286 </span><span class="lineNoCov">          0 :         ugcd[9].gd.popup_msg = ugcd[8].gd.popup_msg;</span>
<span class="lineNum">    4287 </span><span class="lineNoCov">          0 :         ugcd[9].creator = GMatrixEditCreate;</span>
<span class="lineNum">    4288 </span><span class="lineNoCov">          0 :         uhvarray[15] = &amp;ugcd[9]; uhvarray[16] = GCD_ColSpan; uhvarray[17] = NULL;</span>
<span class="lineNum">    4289 </span>            : 
<span class="lineNum">    4290 </span><span class="lineNoCov">          0 :         ugcd[10].gd.pos.x = 5; ugcd[10].gd.pos.y = 83+4;</span>
<span class="lineNum">    4291 </span><span class="lineNoCov">          0 :         ugcd[10].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4292 </span><span class="lineNoCov">          0 :         ulabel[10].text = (unichar_t *) _(&quot;OT _Glyph Class:&quot;);</span>
<span class="lineNum">    4293 </span><span class="lineNoCov">          0 :         ulabel[10].text_is_1byte = true;</span>
<span class="lineNum">    4294 </span><span class="lineNoCov">          0 :         ulabel[10].text_in_resource = true;</span>
<span class="lineNum">    4295 </span><span class="lineNoCov">          0 :         ugcd[10].gd.label = &amp;ulabel[10];</span>
<span class="lineNum">    4296 </span><span class="lineNoCov">          0 :         ugcd[10].creator = GLabelCreate;</span>
<span class="lineNum">    4297 </span><span class="lineNoCov">          0 :         uhvarray[18] = &amp;ugcd[10];</span>
<span class="lineNum">    4298 </span>            : 
<span class="lineNum">    4299 </span><span class="lineNoCov">          0 :         ugcd[11].gd.pos.x = 85; ugcd[11].gd.pos.y = 83;</span>
<span class="lineNum">    4300 </span><span class="lineNoCov">          0 :         ugcd[11].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4301 </span><span class="lineNoCov">          0 :         ugcd[11].gd.cid = CID_GClass;</span>
<span class="lineNum">    4302 </span><span class="lineNoCov">          0 :         ugcd[11].gd.u.list = glyphclasses;</span>
<span class="lineNum">    4303 </span><span class="lineNoCov">          0 :         ugcd[11].creator = GListButtonCreate;</span>
<span class="lineNum">    4304 </span><span class="lineNoCov">          0 :         uhvarray[19] = &amp;ugcd[11]; uhvarray[20] = NULL;</span>
<span class="lineNum">    4305 </span>            : 
<span class="lineNum">    4306 </span><span class="lineNoCov">          0 :         ugcd[12].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    4307 </span><span class="lineNoCov">          0 :         ulabel[12].text = (unichar_t *) _(&quot;Mark for Unlink, Remove Overlap before Generating&quot;);</span>
<span class="lineNum">    4308 </span><span class="lineNoCov">          0 :         ulabel[12].text_is_1byte = true;</span>
<span class="lineNum">    4309 </span><span class="lineNoCov">          0 :         ulabel[12].text_in_resource = true;</span>
<span class="lineNum">    4310 </span><span class="lineNoCov">          0 :         ugcd[12].gd.label = &amp;ulabel[12];</span>
<span class="lineNum">    4311 </span><span class="lineNoCov">          0 :         ugcd[12].gd.cid = CID_UnlinkRmOverlap;</span>
<span class="lineNum">    4312 </span><span class="lineNoCov">          0 :         ugcd[12].gd.popup_msg = (unichar_t *) _(&quot;A few glyphs, like Aring, Ccedilla, Eogonek\nare composed of two overlapping references.\nOften it is desirable to retain the references\n(so that changes made to the base glyph are\nreflected in the composed glyph), but that\nmeans you are stuck with overlapping contours.\nThis flag means that just before generating\nthe font, FontForge will unlink the references\nand run remove overlap on them, while\n retaining the references in the SFD.&quot;);</span>
<span class="lineNum">    4313 </span><span class="lineNoCov">          0 :         ugcd[12].creator = GCheckBoxCreate;</span>
<span class="lineNum">    4314 </span><span class="lineNoCov">          0 :         uhvarray[21] = &amp;ugcd[12]; uhvarray[22] = GCD_ColSpan; uhvarray[23] = NULL;</span>
<span class="lineNum">    4315 </span><span class="lineNoCov">          0 :         uhvarray[24] = GCD_Glue; uhvarray[25] = GCD_Glue; uhvarray[26] = NULL;</span>
<span class="lineNum">    4316 </span><span class="lineNoCov">          0 :         uhvarray[27] = NULL;</span>
<span class="lineNum">    4317 </span>            : 
<span class="lineNum">    4318 </span><span class="lineNoCov">          0 :         ubox[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4319 </span><span class="lineNoCov">          0 :         ubox[0].gd.u.boxelements = uhvarray;</span>
<span class="lineNum">    4320 </span><span class="lineNoCov">          0 :         ubox[0].creator = GHVBoxCreate;</span>
<span class="lineNum">    4321 </span>            : 
<span class="lineNum">    4322 </span>            : 
<span class="lineNum">    4323 </span><span class="lineNoCov">          0 :         memset(&amp;cgcd,0,sizeof(cgcd));</span>
<span class="lineNum">    4324 </span><span class="lineNoCov">          0 :         memset(&amp;cbox,0,sizeof(cbox));</span>
<span class="lineNum">    4325 </span><span class="lineNoCov">          0 :         memset(&amp;clabel,0,sizeof(clabel));</span>
<span class="lineNum">    4326 </span>            : 
<span class="lineNum">    4327 </span><span class="lineNoCov">          0 :         clabel[0].text = (unichar_t *) _(&quot;Comment&quot;);</span>
<span class="lineNum">    4328 </span><span class="lineNoCov">          0 :         clabel[0].text_is_1byte = true;</span>
<span class="lineNum">    4329 </span><span class="lineNoCov">          0 :         cgcd[0].gd.label = &amp;clabel[0];</span>
<span class="lineNum">    4330 </span><span class="lineNoCov">          0 :         cgcd[0].gd.pos.x = 5; cgcd[0].gd.pos.y = 5; </span>
<span class="lineNum">    4331 </span><span class="lineNoCov">          0 :         cgcd[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4332 </span><span class="lineNoCov">          0 :         cgcd[0].creator = GLabelCreate;</span>
<span class="lineNum">    4333 </span><span class="lineNoCov">          0 :         cvarray[0] = &amp;cgcd[0];</span>
<span class="lineNum">    4334 </span>            : 
<span class="lineNum">    4335 </span><span class="lineNoCov">          0 :         cgcd[1].gd.pos.x = 5; cgcd[1].gd.pos.y = cgcd[0].gd.pos.y+13;</span>
<span class="lineNum">    4336 </span><span class="lineNoCov">          0 :         cgcd[1].gd.pos.height = 7*12+6;</span>
<span class="lineNum">    4337 </span><span class="lineNoCov">          0 :         cgcd[1].gd.flags = gg_enabled|gg_visible|gg_textarea_wrap|gg_text_xim;</span>
<span class="lineNum">    4338 </span><span class="lineNoCov">          0 :         cgcd[1].gd.cid = CID_Comment;</span>
<span class="lineNum">    4339 </span><span class="lineNoCov">          0 :         cgcd[1].gd.handle_controlevent = CI_CommentChanged;</span>
<span class="lineNum">    4340 </span><span class="lineNoCov">          0 :         cgcd[1].creator = GTextAreaCreate;</span>
<span class="lineNum">    4341 </span><span class="lineNoCov">          0 :         cvarray[1] = &amp;cgcd[1]; cvarray[2] = GCD_Glue;</span>
<span class="lineNum">    4342 </span>            : 
<span class="lineNum">    4343 </span><span class="lineNoCov">          0 :         clabel[2].text = (unichar_t *) _(&quot;Color:&quot;);</span>
<span class="lineNum">    4344 </span><span class="lineNoCov">          0 :         clabel[2].text_is_1byte = true;</span>
<span class="lineNum">    4345 </span><span class="lineNoCov">          0 :         cgcd[2].gd.label = &amp;clabel[2];</span>
<span class="lineNum">    4346 </span><span class="lineNoCov">          0 :         cgcd[2].gd.pos.x = 5; cgcd[2].gd.pos.y = cgcd[1].gd.pos.y+cgcd[1].gd.pos.height+5+6; </span>
<span class="lineNum">    4347 </span><span class="lineNoCov">          0 :         cgcd[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4348 </span><span class="lineNoCov">          0 :         cgcd[2].creator = GLabelCreate;</span>
<span class="lineNum">    4349 </span><span class="lineNoCov">          0 :         charray[0] = &amp;cgcd[2];</span>
<span class="lineNum">    4350 </span>            : 
<span class="lineNum">    4351 </span><span class="lineNoCov">          0 :         cgcd[3].gd.pos.x = cgcd[3].gd.pos.x; cgcd[3].gd.pos.y = cgcd[2].gd.pos.y-6;</span>
<span class="lineNum">    4352 </span><span class="lineNoCov">          0 :         cgcd[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4353 </span><span class="lineNoCov">          0 :         cgcd[3].gd.cid = CID_Color;</span>
<span class="lineNum">    4354 </span><span class="lineNoCov">          0 :         cgcd[3].gd.handle_controlevent = CI_PickColor;</span>
<span class="lineNum">    4355 </span><span class="lineNoCov">          0 :         std_colors[0].image = GGadgetImageCache(&quot;colorwheel.png&quot;);</span>
<span class="lineNum">    4356 </span><span class="lineNoCov">          0 :         cgcd[3].gd.u.list = std_colors;</span>
<span class="lineNum">    4357 </span><span class="lineNoCov">          0 :         cgcd[3].creator = GListButtonCreate;</span>
<span class="lineNum">    4358 </span><span class="lineNoCov">          0 :         charray[1] = &amp;cgcd[3]; charray[2] = GCD_Glue; charray[3] = NULL;</span>
<span class="lineNum">    4359 </span>            : 
<span class="lineNum">    4360 </span><span class="lineNoCov">          0 :         cbox[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4361 </span><span class="lineNoCov">          0 :         cbox[2].gd.u.boxelements = charray;</span>
<span class="lineNum">    4362 </span><span class="lineNoCov">          0 :         cbox[2].creator = GHBoxCreate;</span>
<span class="lineNum">    4363 </span><span class="lineNoCov">          0 :         cvarray[3] = &amp;cbox[2]; cvarray[4] = NULL;</span>
<span class="lineNum">    4364 </span>            : 
<span class="lineNum">    4365 </span><span class="lineNoCov">          0 :         cbox[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4366 </span><span class="lineNoCov">          0 :         cbox[0].gd.u.boxelements = cvarray;</span>
<span class="lineNum">    4367 </span><span class="lineNoCov">          0 :         cbox[0].creator = GVBoxCreate;</span>
<span class="lineNum">    4368 </span>            : 
<span class="lineNum">    4369 </span><span class="lineNoCov">          0 :         memset(&amp;psgcd,0,sizeof(psgcd));</span>
<span class="lineNum">    4370 </span><span class="lineNoCov">          0 :         memset(&amp;pstbox,0,sizeof(pstbox));</span>
<span class="lineNum">    4371 </span><span class="lineNoCov">          0 :         memset(&amp;pslabel,0,sizeof(pslabel));</span>
<span class="lineNum">    4372 </span>            : 
<span class="lineNum">    4373 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;6; ++i ) {</span>
<span class="lineNum">    4374 </span><span class="lineNoCov">          0 :             psgcd[i][0].gd.pos.x = 5; psgcd[i][0].gd.pos.y = 5;</span>
<span class="lineNum">    4375 </span><span class="lineNoCov">          0 :             psgcd[i][0].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4376 </span><span class="lineNoCov">          0 :             psgcd[i][0].gd.cid = CID_List+i*100;</span>
<span class="lineNum">    4377 </span><span class="lineNoCov">          0 :             psgcd[i][0].gd.u.matrix = &amp;mi[i];</span>
<span class="lineNum">    4378 </span><span class="lineNoCov">          0 :             mi[i].col_init[0].enum_vals = SFSubtableListOfType(sc-&gt;parent, pst2lookuptype[i+1], false, false);</span>
<span class="lineNum">    4379 </span><span class="lineNoCov">          0 :             psgcd[i][0].creator = GMatrixEditCreate;</span>
<span class="lineNum">    4380 </span>            :         }
<span class="lineNum">    4381 </span><span class="lineNoCov">          0 :         for ( i=pst_position; i&lt;=pst_pair; ++i ) {</span>
<span class="lineNum">    4382 </span><span class="lineNoCov">          0 :             pslabel[i-1][1].text = (unichar_t *) _(&quot;_Hide Unused Columns&quot;);</span>
<span class="lineNum">    4383 </span><span class="lineNoCov">          0 :             pslabel[i-1][1].text_is_1byte = true;</span>
<span class="lineNum">    4384 </span><span class="lineNoCov">          0 :             pslabel[i-1][1].text_in_resource = true;</span>
<span class="lineNum">    4385 </span><span class="lineNoCov">          0 :             psgcd[i-1][1].gd.label = &amp;pslabel[i-1][1];</span>
<span class="lineNum">    4386 </span><span class="lineNoCov">          0 :             psgcd[i-1][1].gd.pos.x = 5; psgcd[i-1][1].gd.pos.y = 5+4; </span>
<span class="lineNum">    4387 </span><span class="lineNoCov">          0 :             psgcd[i-1][1].gd.flags = lookup_hideunused ? (gg_enabled|gg_visible|gg_cb_on|gg_utf8_popup) : (gg_enabled|gg_visible|gg_utf8_popup);</span>
<span class="lineNum">    4388 </span><span class="lineNoCov">          0 :             psgcd[i-1][1].gd.popup_msg = (unichar_t *) _(&quot;Don't display columns of 0s.\nThe OpenType lookup allows for up to 8 kinds\nof data, but almost all kerning lookups will use just one.\nOmitting the others makes the behavior clearer.&quot;);</span>
<span class="lineNum">    4389 </span><span class="lineNoCov">          0 :             psgcd[i-1][1].gd.handle_controlevent = i==pst_position ? CI_HideUnusedSingle : CI_HideUnusedPair;</span>
<span class="lineNum">    4390 </span><span class="lineNoCov">          0 :             psgcd[i-1][1].creator = GCheckBoxCreate;</span>
<span class="lineNum">    4391 </span><span class="lineNoCov">          0 :             pstvarray[i-1][0] = &amp;psgcd[i-1][0];</span>
<span class="lineNum">    4392 </span><span class="lineNoCov">          0 :             pstvarray[i-1][1] = &amp;psgcd[i-1][1];</span>
<span class="lineNum">    4393 </span><span class="lineNoCov">          0 :             pstvarray[i-1][2] = NULL;</span>
<span class="lineNum">    4394 </span>            : 
<span class="lineNum">    4395 </span><span class="lineNoCov">          0 :             pstbox[i-1][0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4396 </span><span class="lineNoCov">          0 :             pstbox[i-1][0].gd.u.boxelements = pstvarray[i-1];</span>
<span class="lineNum">    4397 </span><span class="lineNoCov">          0 :             pstbox[i-1][0].creator = GVBoxCreate;</span>
<span class="lineNum">    4398 </span>            :         }
<span class="lineNum">    4399 </span>            : 
<span class="lineNum">    4400 </span><span class="lineNoCov">          0 :             psgcd[6][0].gd.pos.x = 5; psgcd[6][0].gd.pos.y = 5;</span>
<span class="lineNum">    4401 </span><span class="lineNoCov">          0 :             psgcd[6][0].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4402 </span><span class="lineNoCov">          0 :             psgcd[6][0].gd.cid = CID_List+6*100;</span>
<span class="lineNum">    4403 </span><span class="lineNoCov">          0 :             psgcd[6][0].gd.handle_controlevent = CI_CounterSelChanged;</span>
<span class="lineNum">    4404 </span><span class="lineNoCov">          0 :             psgcd[6][0].gd.box = &amp;smallbox;</span>
<span class="lineNum">    4405 </span><span class="lineNoCov">          0 :             psgcd[6][0].creator = GListCreate;</span>
<span class="lineNum">    4406 </span><span class="lineNoCov">          0 :             pstvarray[6][0] = &amp;psgcd[6][0];</span>
<span class="lineNum">    4407 </span>            : 
<span class="lineNum">    4408 </span><span class="lineNoCov">          0 :             psgcd[6][1].gd.pos.x = 10; psgcd[6][1].gd.pos.y = psgcd[6][0].gd.pos.y+psgcd[6][0].gd.pos.height+4;</span>
<span class="lineNum">    4409 </span><span class="lineNoCov">          0 :             psgcd[6][1].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4410 </span><span class="lineNoCov">          0 :             pslabel[6][1].text = (unichar_t *) S_(&quot;CounterHint|_New...&quot;);</span>
<span class="lineNum">    4411 </span><span class="lineNoCov">          0 :             pslabel[6][1].text_is_1byte = true;</span>
<span class="lineNum">    4412 </span><span class="lineNoCov">          0 :             pslabel[6][1].text_in_resource = true;</span>
<span class="lineNum">    4413 </span><span class="lineNoCov">          0 :             psgcd[6][1].gd.label = &amp;pslabel[6][1];</span>
<span class="lineNum">    4414 </span><span class="lineNoCov">          0 :             psgcd[6][1].gd.cid = CID_New+6*100;</span>
<span class="lineNum">    4415 </span><span class="lineNoCov">          0 :             psgcd[6][1].gd.handle_controlevent = CI_NewCounter;</span>
<span class="lineNum">    4416 </span><span class="lineNoCov">          0 :             psgcd[6][1].gd.box = &amp;smallbox;</span>
<span class="lineNum">    4417 </span><span class="lineNoCov">          0 :             psgcd[6][1].creator = GButtonCreate;</span>
<span class="lineNum">    4418 </span><span class="lineNoCov">          0 :             pstharray1[6][0] = GCD_Glue; pstharray1[6][1] = &amp;psgcd[6][1];</span>
<span class="lineNum">    4419 </span>            : 
<span class="lineNum">    4420 </span><span class="lineNoCov">          0 :             psgcd[6][2].gd.pos.x = 20+GIntGetResource(_NUM_Buttonsize)*100/GIntGetResource(_NUM_ScaleFactor); psgcd[6][2].gd.pos.y = psgcd[6][1].gd.pos.y;</span>
<span class="lineNum">    4421 </span><span class="lineNoCov">          0 :             psgcd[6][2].gd.flags = gg_visible;</span>
<span class="lineNum">    4422 </span><span class="lineNoCov">          0 :             pslabel[6][2].text = (unichar_t *) _(&quot;_Delete&quot;);</span>
<span class="lineNum">    4423 </span><span class="lineNoCov">          0 :             pslabel[6][2].text_is_1byte = true;</span>
<span class="lineNum">    4424 </span><span class="lineNoCov">          0 :             pslabel[6][2].text_in_resource = true;</span>
<span class="lineNum">    4425 </span><span class="lineNoCov">          0 :             psgcd[6][2].gd.label = &amp;pslabel[6][2];</span>
<span class="lineNum">    4426 </span><span class="lineNoCov">          0 :             psgcd[6][2].gd.cid = CID_Delete+6*100;</span>
<span class="lineNum">    4427 </span><span class="lineNoCov">          0 :             psgcd[6][2].gd.handle_controlevent = CI_DeleteCounter;</span>
<span class="lineNum">    4428 </span><span class="lineNoCov">          0 :             psgcd[6][2].gd.box = &amp;smallbox;</span>
<span class="lineNum">    4429 </span><span class="lineNoCov">          0 :             psgcd[6][2].creator = GButtonCreate;</span>
<span class="lineNum">    4430 </span><span class="lineNoCov">          0 :             pstharray1[6][2] = GCD_Glue; pstharray1[6][3] = &amp;psgcd[6][2];</span>
<span class="lineNum">    4431 </span>            : 
<span class="lineNum">    4432 </span><span class="lineNoCov">          0 :             psgcd[6][3].gd.pos.x = -10; psgcd[6][3].gd.pos.y = psgcd[6][1].gd.pos.y;</span>
<span class="lineNum">    4433 </span><span class="lineNoCov">          0 :             psgcd[6][3].gd.flags = gg_visible;</span>
<span class="lineNum">    4434 </span><span class="lineNoCov">          0 :             pslabel[6][3].text = (unichar_t *) _(&quot;_Edit...&quot;);</span>
<span class="lineNum">    4435 </span><span class="lineNoCov">          0 :             pslabel[6][3].text_is_1byte = true;</span>
<span class="lineNum">    4436 </span><span class="lineNoCov">          0 :             pslabel[6][3].text_in_resource = true;</span>
<span class="lineNum">    4437 </span><span class="lineNoCov">          0 :             psgcd[6][3].gd.label = &amp;pslabel[6][3];</span>
<span class="lineNum">    4438 </span><span class="lineNoCov">          0 :             psgcd[6][3].gd.cid = CID_Edit+6*100;</span>
<span class="lineNum">    4439 </span><span class="lineNoCov">          0 :             psgcd[6][3].gd.handle_controlevent = CI_EditCounter;</span>
<span class="lineNum">    4440 </span><span class="lineNoCov">          0 :             psgcd[6][3].gd.box = &amp;smallbox;</span>
<span class="lineNum">    4441 </span><span class="lineNoCov">          0 :             psgcd[6][3].creator = GButtonCreate;</span>
<span class="lineNum">    4442 </span><span class="lineNoCov">          0 :             pstharray1[6][4] = GCD_Glue; pstharray1[6][5] = &amp;psgcd[6][3]; pstharray1[6][6] = GCD_Glue; pstharray1[6][7] = NULL;</span>
<span class="lineNum">    4443 </span>            : 
<span class="lineNum">    4444 </span><span class="lineNoCov">          0 :             pstbox[6][2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4445 </span><span class="lineNoCov">          0 :             pstbox[6][2].gd.u.boxelements = pstharray1[6];</span>
<span class="lineNum">    4446 </span><span class="lineNoCov">          0 :             pstbox[6][2].creator = GHBoxCreate;</span>
<span class="lineNum">    4447 </span><span class="lineNoCov">          0 :             pstvarray[6][1] = &amp;pstbox[6][2]; pstvarray[6][2] = NULL;</span>
<span class="lineNum">    4448 </span>            : 
<span class="lineNum">    4449 </span><span class="lineNoCov">          0 :             pstbox[6][0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4450 </span><span class="lineNoCov">          0 :             pstbox[6][0].gd.u.boxelements = pstvarray[6];</span>
<span class="lineNum">    4451 </span><span class="lineNoCov">          0 :             pstbox[6][0].creator = GVBoxCreate;</span>
<span class="lineNum">    4452 </span><span class="lineNoCov">          0 :         psgcd[6][4].gd.flags = psgcd[6][5].gd.flags = 0;        /* No copy, paste for hint masks */</span>
<span class="lineNum">    4453 </span>            : 
<span class="lineNum">    4454 </span><span class="lineNoCov">          0 :         memset(&amp;cogcd,0,sizeof(cogcd));</span>
<span class="lineNum">    4455 </span><span class="lineNoCov">          0 :         memset(&amp;cobox,0,sizeof(cobox));</span>
<span class="lineNum">    4456 </span><span class="lineNoCov">          0 :         memset(&amp;colabel,0,sizeof(colabel));</span>
<span class="lineNum">    4457 </span>            : 
<span class="lineNum">    4458 </span><span class="lineNoCov">          0 :         colabel[0].text = (unichar_t *) _(&quot;Accented glyph composed of:&quot;);</span>
<span class="lineNum">    4459 </span><span class="lineNoCov">          0 :         colabel[0].text_is_1byte = true;</span>
<span class="lineNum">    4460 </span><span class="lineNoCov">          0 :         cogcd[0].gd.label = &amp;colabel[0];</span>
<span class="lineNum">    4461 </span><span class="lineNoCov">          0 :         cogcd[0].gd.pos.x = 5; cogcd[0].gd.pos.y = 5; </span>
<span class="lineNum">    4462 </span><span class="lineNoCov">          0 :         cogcd[0].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4463 </span><span class="lineNoCov">          0 :         cogcd[0].gd.cid = CID_ComponentMsg;</span>
<span class="lineNum">    4464 </span><span class="lineNoCov">          0 :         cogcd[0].creator = GLabelCreate;</span>
<span class="lineNum">    4465 </span>            : 
<span class="lineNum">    4466 </span><span class="lineNoCov">          0 :         cogcd[1].gd.pos.x = 5; cogcd[1].gd.pos.y = cogcd[0].gd.pos.y+12;</span>
<span class="lineNum">    4467 </span><span class="lineNoCov">          0 :         cogcd[1].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4468 </span><span class="lineNoCov">          0 :         cogcd[1].gd.cid = CID_Components;</span>
<span class="lineNum">    4469 </span><span class="lineNoCov">          0 :         cogcd[1].creator = GLabelCreate;</span>
<span class="lineNum">    4470 </span>            : 
<span class="lineNum">    4471 </span><span class="lineNoCov">          0 :         covarray[0] = &amp;cogcd[0]; covarray[1] = &amp;cogcd[1]; covarray[2] = GCD_Glue; covarray[3] = NULL;</span>
<span class="lineNum">    4472 </span><span class="lineNoCov">          0 :         cobox[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4473 </span><span class="lineNoCov">          0 :         cobox[0].gd.u.boxelements = covarray;</span>
<span class="lineNum">    4474 </span><span class="lineNoCov">          0 :         cobox[0].creator = GVBoxCreate;</span>
<span class="lineNum">    4475 </span>            :         
<span class="lineNum">    4476 </span>            : 
<span class="lineNum">    4477 </span>            : 
<span class="lineNum">    4478 </span><span class="lineNoCov">          0 :         memset(&amp;tgcd,0,sizeof(tgcd));</span>
<span class="lineNum">    4479 </span><span class="lineNoCov">          0 :         memset(&amp;tbox,0,sizeof(tbox));</span>
<span class="lineNum">    4480 </span><span class="lineNoCov">          0 :         memset(&amp;tlabel,0,sizeof(tlabel));</span>
<span class="lineNum">    4481 </span>            : 
<span class="lineNum">    4482 </span><span class="lineNoCov">          0 :         tlabel[0].text = (unichar_t *) _(&quot;Height:&quot;);</span>
<span class="lineNum">    4483 </span><span class="lineNoCov">          0 :         tlabel[0].text_is_1byte = true;</span>
<span class="lineNum">    4484 </span><span class="lineNoCov">          0 :         tgcd[0].gd.label = &amp;tlabel[0];</span>
<span class="lineNum">    4485 </span><span class="lineNoCov">          0 :         tgcd[0].gd.pos.x = 5; tgcd[0].gd.pos.y = 5+4; </span>
<span class="lineNum">    4486 </span><span class="lineNoCov">          0 :         tgcd[0].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4487 </span><span class="lineNoCov">          0 :         tgcd[0].gd.popup_msg = (unichar_t *) _(&quot;The height and depth fields are the metrics fields used\nby TeX, they are corrected for optical distortion.\nSo 'x' and 'o' probably have the same height.&quot;);</span>
<span class="lineNum">    4488 </span><span class="lineNoCov">          0 :         tgcd[0].creator = GLabelCreate;</span>
<span class="lineNum">    4489 </span><span class="lineNoCov">          0 :         thvarray[0] = &amp;tgcd[0];</span>
<span class="lineNum">    4490 </span>            : 
<span class="lineNum">    4491 </span><span class="lineNoCov">          0 :         tgcd[1].gd.pos.x = 85; tgcd[1].gd.pos.y = 5;</span>
<span class="lineNum">    4492 </span><span class="lineNoCov">          0 :         tgcd[1].gd.pos.width = 60;</span>
<span class="lineNum">    4493 </span><span class="lineNoCov">          0 :         tgcd[1].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4494 </span><span class="lineNoCov">          0 :         tgcd[1].gd.cid = CID_TeX_Height;</span>
<span class="lineNum">    4495 </span><span class="lineNoCov">          0 :         tgcd[1].creator = GTextFieldCreate;</span>
<span class="lineNum">    4496 </span><span class="lineNoCov">          0 :         tgcd[1].gd.popup_msg = tgcd[0].gd.popup_msg;</span>
<span class="lineNum">    4497 </span><span class="lineNoCov">          0 :         thvarray[1] = &amp;tgcd[1];</span>
<span class="lineNum">    4498 </span>            : 
<span class="lineNum">    4499 </span><span class="lineNoCov">          0 :         tlabel[2].text = (unichar_t *) _(&quot;Guess&quot;);</span>
<span class="lineNum">    4500 </span><span class="lineNoCov">          0 :         tlabel[2].text_is_1byte = true;</span>
<span class="lineNum">    4501 </span><span class="lineNoCov">          0 :         tgcd[2].gd.label = &amp;tlabel[2];</span>
<span class="lineNum">    4502 </span><span class="lineNoCov">          0 :         tgcd[2].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4503 </span><span class="lineNoCov">          0 :         tgcd[2].gd.cid = CID_TeX_HeightD;</span>
<span class="lineNum">    4504 </span><span class="lineNoCov">          0 :         tgcd[2].gd.handle_controlevent = TeX_Default;</span>
<span class="lineNum">    4505 </span><span class="lineNoCov">          0 :         tgcd[2].creator = GButtonCreate;</span>
<span class="lineNum">    4506 </span><span class="lineNoCov">          0 :         tgcd[2].gd.popup_msg = tgcd[0].gd.popup_msg;</span>
<span class="lineNum">    4507 </span><span class="lineNoCov">          0 :         thvarray[2] = &amp;tgcd[2]; thvarray[3] = GCD_Glue; thvarray[4] = NULL;</span>
<span class="lineNum">    4508 </span>            : 
<span class="lineNum">    4509 </span><span class="lineNoCov">          0 :         tlabel[3].text = (unichar_t *) _(&quot;Depth:&quot;);</span>
<span class="lineNum">    4510 </span><span class="lineNoCov">          0 :         tlabel[3].text_is_1byte = true;</span>
<span class="lineNum">    4511 </span><span class="lineNoCov">          0 :         tgcd[3].gd.label = &amp;tlabel[3];</span>
<span class="lineNum">    4512 </span><span class="lineNoCov">          0 :         tgcd[3].gd.pos.x = 5; tgcd[3].gd.pos.y = 31+4; </span>
<span class="lineNum">    4513 </span><span class="lineNoCov">          0 :         tgcd[3].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4514 </span><span class="lineNoCov">          0 :         tgcd[3].gd.popup_msg = tgcd[0].gd.popup_msg;</span>
<span class="lineNum">    4515 </span><span class="lineNoCov">          0 :         tgcd[3].creator = GLabelCreate;</span>
<span class="lineNum">    4516 </span><span class="lineNoCov">          0 :         thvarray[5] = &amp;tgcd[3];</span>
<span class="lineNum">    4517 </span>            : 
<span class="lineNum">    4518 </span><span class="lineNoCov">          0 :         tgcd[4].gd.pos.x = 85; tgcd[4].gd.pos.y = 31;</span>
<span class="lineNum">    4519 </span><span class="lineNoCov">          0 :         tgcd[4].gd.pos.width = 60;</span>
<span class="lineNum">    4520 </span><span class="lineNoCov">          0 :         tgcd[4].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4521 </span><span class="lineNoCov">          0 :         tgcd[4].gd.cid = CID_TeX_Depth;</span>
<span class="lineNum">    4522 </span><span class="lineNoCov">          0 :         tgcd[4].creator = GTextFieldCreate;</span>
<span class="lineNum">    4523 </span><span class="lineNoCov">          0 :         tgcd[4].gd.popup_msg = tgcd[0].gd.popup_msg;</span>
<span class="lineNum">    4524 </span><span class="lineNoCov">          0 :         thvarray[6] = &amp;tgcd[4];</span>
<span class="lineNum">    4525 </span>            : 
<span class="lineNum">    4526 </span><span class="lineNoCov">          0 :         tlabel[5].text = (unichar_t *) _(&quot;Guess&quot;);</span>
<span class="lineNum">    4527 </span><span class="lineNoCov">          0 :         tlabel[5].text_is_1byte = true;</span>
<span class="lineNum">    4528 </span><span class="lineNoCov">          0 :         tgcd[5].gd.label = &amp;tlabel[5];</span>
<span class="lineNum">    4529 </span><span class="lineNoCov">          0 :         tgcd[5].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4530 </span><span class="lineNoCov">          0 :         tgcd[5].gd.cid = CID_TeX_DepthD;</span>
<span class="lineNum">    4531 </span><span class="lineNoCov">          0 :         tgcd[5].gd.handle_controlevent = TeX_Default;</span>
<span class="lineNum">    4532 </span><span class="lineNoCov">          0 :         tgcd[5].creator = GButtonCreate;</span>
<span class="lineNum">    4533 </span><span class="lineNoCov">          0 :         tgcd[5].gd.popup_msg = tgcd[0].gd.popup_msg;</span>
<span class="lineNum">    4534 </span><span class="lineNoCov">          0 :         thvarray[7] = &amp;tgcd[5];  thvarray[8] = GCD_Glue; thvarray[9] = NULL;</span>
<span class="lineNum">    4535 </span>            : 
<span class="lineNum">    4536 </span><span class="lineNoCov">          0 :         tlabel[6].text = (unichar_t *) _(&quot;Italic Correction:&quot;);</span>
<span class="lineNum">    4537 </span><span class="lineNoCov">          0 :         tlabel[6].text_is_1byte = true;</span>
<span class="lineNum">    4538 </span><span class="lineNoCov">          0 :         tgcd[6].gd.label = &amp;tlabel[6];</span>
<span class="lineNum">    4539 </span><span class="lineNoCov">          0 :         tgcd[6].gd.pos.x = 5; tgcd[6].gd.pos.y = 57+4; </span>
<span class="lineNum">    4540 </span><span class="lineNoCov">          0 :         tgcd[6].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4541 </span><span class="lineNoCov">          0 :         tgcd[6].creator = GLabelCreate;</span>
<span class="lineNum">    4542 </span><span class="lineNoCov">          0 :         tgcd[6].gd.popup_msg = (unichar_t *) _(&quot;The Italic correction field is used by both TeX and the MS 'MATH'\ntable. It is used when joining slanted text (italic) to upright.\nIt is the amount of extra white space needed so the slanted text\nwill not run into the upright text.&quot;);</span>
<span class="lineNum">    4543 </span><span class="lineNoCov">          0 :         thvarray[10] = &amp;tgcd[6];</span>
<span class="lineNum">    4544 </span>            : 
<span class="lineNum">    4545 </span><span class="lineNoCov">          0 :         tgcd[7].gd.pos.x = 85; tgcd[7].gd.pos.y = 57;</span>
<span class="lineNum">    4546 </span><span class="lineNoCov">          0 :         tgcd[7].gd.pos.width = 60;</span>
<span class="lineNum">    4547 </span><span class="lineNoCov">          0 :         tgcd[7].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4548 </span><span class="lineNoCov">          0 :         tgcd[7].gd.cid = CID_TeX_Italic;</span>
<span class="lineNum">    4549 </span><span class="lineNoCov">          0 :         tgcd[7].creator = GTextFieldCreate;</span>
<span class="lineNum">    4550 </span><span class="lineNoCov">          0 :         tgcd[7].gd.popup_msg = tgcd[6].gd.popup_msg;</span>
<span class="lineNum">    4551 </span><span class="lineNoCov">          0 :         thvarray[11] = &amp;tgcd[7];</span>
<span class="lineNum">    4552 </span>            : 
<span class="lineNum">    4553 </span><span class="lineNoCov">          0 :         tlabel[8].text = (unichar_t *) _(&quot;Guess&quot;);</span>
<span class="lineNum">    4554 </span><span class="lineNoCov">          0 :         tlabel[8].text_is_1byte = true;</span>
<span class="lineNum">    4555 </span><span class="lineNoCov">          0 :         tgcd[8].gd.label = &amp;tlabel[8];</span>
<span class="lineNum">    4556 </span><span class="lineNoCov">          0 :         tgcd[8].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4557 </span><span class="lineNoCov">          0 :         tgcd[8].gd.cid = CID_TeX_ItalicD;</span>
<span class="lineNum">    4558 </span><span class="lineNoCov">          0 :         tgcd[8].gd.handle_controlevent = TeX_Default;</span>
<span class="lineNum">    4559 </span><span class="lineNoCov">          0 :         tgcd[8].creator = GButtonCreate;</span>
<span class="lineNum">    4560 </span><span class="lineNoCov">          0 :         tgcd[8].gd.popup_msg = tgcd[6].gd.popup_msg;</span>
<span class="lineNum">    4561 </span><span class="lineNoCov">          0 :         thvarray[12] = &amp;tgcd[8];</span>
<span class="lineNum">    4562 </span>            : 
<span class="lineNum">    4563 </span><span class="lineNoCov">          0 :         tgcd[9].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4564 </span><span class="lineNoCov">          0 :         tgcd[9].gd.cid = CID_ItalicDevTab;</span>
<span class="lineNum">    4565 </span><span class="lineNoCov">          0 :         tgcd[9].creator = GTextFieldCreate;</span>
<span class="lineNum">    4566 </span><span class="lineNoCov">          0 :         tgcd[9].gd.popup_msg = (unichar_t *) _(&quot;A device table for italic correction.\nExpects a comma separated list of &lt;pixelsize&gt;\&quot;:\&quot;&lt;adjustment&gt;\nAs \&quot;9:-1,12:1,13:1\&quot;&quot;);</span>
<span class="lineNum">    4567 </span><span class="lineNoCov">          0 :         thvarray[13] = &amp;tgcd[9]; thvarray[14] = NULL;</span>
<span class="lineNum">    4568 </span>            : 
<span class="lineNum">    4569 </span><span class="lineNoCov">          0 :         tlabel[10].text = (unichar_t *) _(&quot;Top Accent Pos:&quot;);</span>
<span class="lineNum">    4570 </span><span class="lineNoCov">          0 :         tlabel[10].text_is_1byte = true;</span>
<span class="lineNum">    4571 </span><span class="lineNoCov">          0 :         tgcd[10].gd.label = &amp;tlabel[10];</span>
<span class="lineNum">    4572 </span><span class="lineNoCov">          0 :         tgcd[10].gd.pos.x = 5; tgcd[10].gd.pos.y = 57+4; </span>
<span class="lineNum">    4573 </span><span class="lineNoCov">          0 :         tgcd[10].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4574 </span><span class="lineNoCov">          0 :         tgcd[10].gd.popup_msg = tgcd[9].gd.popup_msg;</span>
<span class="lineNum">    4575 </span><span class="lineNoCov">          0 :         tgcd[10].creator = GLabelCreate;</span>
<span class="lineNum">    4576 </span><span class="lineNoCov">          0 :         tgcd[10].gd.popup_msg = (unichar_t *) _(&quot;In the MS 'MATH' table this value specifies where (horizontally)\nan accent should be placed above the glyph. Vertical placement\nis handled by other means&quot;);</span>
<span class="lineNum">    4577 </span><span class="lineNoCov">          0 :         thvarray[15] = &amp;tgcd[10];</span>
<span class="lineNum">    4578 </span>            : 
<span class="lineNum">    4579 </span><span class="lineNoCov">          0 :         tgcd[11].gd.pos.x = 85; tgcd[11].gd.pos.y = 57;</span>
<span class="lineNum">    4580 </span><span class="lineNoCov">          0 :         tgcd[11].gd.pos.width = 60;</span>
<span class="lineNum">    4581 </span><span class="lineNoCov">          0 :         tgcd[11].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4582 </span><span class="lineNoCov">          0 :         tgcd[11].gd.cid = CID_HorAccent;</span>
<span class="lineNum">    4583 </span><span class="lineNoCov">          0 :         tgcd[11].creator = GTextFieldCreate;</span>
<span class="lineNum">    4584 </span><span class="lineNoCov">          0 :         tgcd[11].gd.popup_msg = tgcd[10].gd.popup_msg;</span>
<span class="lineNum">    4585 </span><span class="lineNoCov">          0 :         thvarray[16] = &amp;tgcd[11];</span>
<span class="lineNum">    4586 </span>            : 
<span class="lineNum">    4587 </span><span class="lineNoCov">          0 :         tlabel[12].text = (unichar_t *) _(&quot;Guess&quot;);</span>
<span class="lineNum">    4588 </span><span class="lineNoCov">          0 :         tlabel[12].text_is_1byte = true;</span>
<span class="lineNum">    4589 </span><span class="lineNoCov">          0 :         tgcd[12].gd.label = &amp;tlabel[12];</span>
<span class="lineNum">    4590 </span><span class="lineNoCov">          0 :         tgcd[12].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4591 </span><span class="lineNoCov">          0 :         tgcd[12].gd.cid = CID_HorAccentD;</span>
<span class="lineNum">    4592 </span><span class="lineNoCov">          0 :         tgcd[12].gd.handle_controlevent = TeX_Default;</span>
<span class="lineNum">    4593 </span><span class="lineNoCov">          0 :         tgcd[12].creator = GButtonCreate;</span>
<span class="lineNum">    4594 </span><span class="lineNoCov">          0 :         tgcd[12].gd.popup_msg = tgcd[10].gd.popup_msg;</span>
<span class="lineNum">    4595 </span><span class="lineNoCov">          0 :         thvarray[17] = &amp;tgcd[12];</span>
<span class="lineNum">    4596 </span>            : 
<span class="lineNum">    4597 </span><span class="lineNoCov">          0 :         tgcd[13].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4598 </span><span class="lineNoCov">          0 :         tgcd[13].gd.cid = CID_AccentDevTab;</span>
<span class="lineNum">    4599 </span><span class="lineNoCov">          0 :         tgcd[13].creator = GTextFieldCreate;</span>
<span class="lineNum">    4600 </span><span class="lineNoCov">          0 :         tgcd[13].gd.popup_msg = (unichar_t *) _(&quot;A device table for horizontal accent positioning.\nExpects a comma separated list of &lt;pixelsize&gt;\&quot;:\&quot;&lt;adjustment&gt;\nAs \&quot;9:-1,12:1,13:1\&quot;&quot;);</span>
<span class="lineNum">    4601 </span><span class="lineNoCov">          0 :         thvarray[18] = &amp;tgcd[13]; thvarray[19] = NULL;</span>
<span class="lineNum">    4602 </span>            : 
<span class="lineNum">    4603 </span><span class="lineNoCov">          0 :         tlabel[14].text = (unichar_t *) _(&quot;Is Extended Shape&quot;);</span>
<span class="lineNum">    4604 </span><span class="lineNoCov">          0 :         tlabel[14].text_is_1byte = true;</span>
<span class="lineNum">    4605 </span><span class="lineNoCov">          0 :         tgcd[14].gd.label = &amp;tlabel[14];</span>
<span class="lineNum">    4606 </span><span class="lineNoCov">          0 :         tgcd[14].gd.pos.x = 5; tgcd[14].gd.pos.y = 57+4; </span>
<span class="lineNum">    4607 </span><span class="lineNoCov">          0 :         tgcd[14].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4608 </span><span class="lineNoCov">          0 :         tgcd[14].gd.cid = CID_IsExtended;</span>
<span class="lineNum">    4609 </span><span class="lineNoCov">          0 :         tgcd[14].creator = GCheckBoxCreate;</span>
<span class="lineNum">    4610 </span><span class="lineNoCov">          0 :         tgcd[14].gd.popup_msg = (unichar_t *) _(&quot;Is this an extended shape (like a tall parenthesis)?\nExtended shapes need special attention for vertical\nsuperscript placement.&quot;);</span>
<span class="lineNum">    4611 </span><span class="lineNoCov">          0 :         thvarray[20] = &amp;tgcd[14];</span>
<span class="lineNum">    4612 </span><span class="lineNoCov">          0 :         thvarray[21] = thvarray[22] = GCD_ColSpan; thvarray[23] = GCD_Glue; thvarray[24] = NULL;</span>
<span class="lineNum">    4613 </span>            : 
<span class="lineNum">    4614 </span><span class="lineNoCov">          0 :         tlabel[15].text = (unichar_t *) _(&quot;Math Kerning&quot;);    /* Graphical */</span>
<span class="lineNum">    4615 </span><span class="lineNoCov">          0 :         tlabel[15].text_is_1byte = true;</span>
<span class="lineNum">    4616 </span><span class="lineNoCov">          0 :         tgcd[15].gd.label = &amp;tlabel[15];</span>
<span class="lineNum">    4617 </span><span class="lineNoCov">          0 :         tgcd[15].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4618 </span><span class="lineNoCov">          0 :         tgcd[15].gd.handle_controlevent = CI_SubSuperPositionings;</span>
<span class="lineNum">    4619 </span><span class="lineNoCov">          0 :         tgcd[15].creator = GButtonCreate;</span>
<span class="lineNum">    4620 </span><span class="lineNoCov">          0 :         tgcd[15].gd.popup_msg = (unichar_t *) _(&quot;Brings up a dialog which gives fine control over\nhorizontal positioning of subscripts and superscripts\ndepending on their vertical positioning.&quot;);</span>
<span class="lineNum">    4621 </span><span class="lineNoCov">          0 :         tbarray[0] = GCD_Glue; tbarray[1] = &amp;tgcd[15]; tbarray[2] = GCD_Glue; tbarray[3] = NULL;</span>
<span class="lineNum">    4622 </span>            : 
<span class="lineNum">    4623 </span><span class="lineNoCov">          0 :         tbox[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4624 </span><span class="lineNoCov">          0 :         tbox[2].gd.u.boxelements = tbarray;</span>
<span class="lineNum">    4625 </span><span class="lineNoCov">          0 :         tbox[2].creator = GHBoxCreate;</span>
<span class="lineNum">    4626 </span>            : 
<span class="lineNum">    4627 </span><span class="lineNoCov">          0 :         thvarray[25] = &amp;tbox[2];</span>
<span class="lineNum">    4628 </span><span class="lineNoCov">          0 :         thvarray[26] = thvarray[27] = thvarray[28] = GCD_ColSpan; thvarray[29] = NULL;</span>
<span class="lineNum">    4629 </span>            : 
<span class="lineNum">    4630 </span><span class="lineNoCov">          0 :         thvarray[30] = thvarray[31] = thvarray[32] = thvarray[33] = GCD_Glue; thvarray[34] = NULL;</span>
<span class="lineNum">    4631 </span><span class="lineNoCov">          0 :         thvarray[35] = NULL;</span>
<span class="lineNum">    4632 </span>            : 
<span class="lineNum">    4633 </span><span class="lineNoCov">          0 :         tbox[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4634 </span><span class="lineNoCov">          0 :         tbox[0].gd.u.boxelements = thvarray;</span>
<span class="lineNum">    4635 </span><span class="lineNoCov">          0 :         tbox[0].creator = GHVBoxCreate;</span>
<span class="lineNum">    4636 </span>            : 
<span class="lineNum">    4637 </span><span class="lineNoCov">          0 :         memset(&amp;lcgcd,0,sizeof(lcgcd));</span>
<span class="lineNum">    4638 </span><span class="lineNoCov">          0 :         memset(&amp;lcbox,0,sizeof(lcbox));</span>
<span class="lineNum">    4639 </span><span class="lineNoCov">          0 :         memset(&amp;lclabel,0,sizeof(lclabel));</span>
<span class="lineNum">    4640 </span>            : 
<span class="lineNum">    4641 </span><span class="lineNoCov">          0 :         lclabel[0].text = (unichar_t *) _(&quot;Default Ligature Caret Count&quot;);</span>
<span class="lineNum">    4642 </span><span class="lineNoCov">          0 :         lclabel[0].text_is_1byte = true;</span>
<span class="lineNum">    4643 </span><span class="lineNoCov">          0 :         lclabel[0].text_in_resource = true;</span>
<span class="lineNum">    4644 </span><span class="lineNoCov">          0 :         lcgcd[0].gd.cid = CID_DefLCCount;</span>
<span class="lineNum">    4645 </span><span class="lineNoCov">          0 :         lcgcd[0].gd.label = &amp;lclabel[0];</span>
<span class="lineNum">    4646 </span><span class="lineNoCov">          0 :         lcgcd[0].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4647 </span><span class="lineNoCov">          0 :         lcgcd[0].gd.popup_msg = (unichar_t *) _(&quot;Ligature caret locations are used by a text editor\nwhen it needs to draw a text edit caret inside a\nligature. This means there should be a caret between\neach ligature component so if there are n components\nthere should be n-1 caret locations.\n  You may adjust the caret locations themselves in the\noutline glyph view (drag them from to origin to the\nappropriate place).&quot; );</span>
<span class="lineNum">    4648 </span><span class="lineNoCov">          0 :         lcgcd[0].gd.handle_controlevent = CI_DefLCChange;</span>
<span class="lineNum">    4649 </span><span class="lineNoCov">          0 :         lcgcd[0].creator = GCheckBoxCreate;</span>
<span class="lineNum">    4650 </span><span class="lineNoCov">          0 :         lchvarray[0][0] = &amp;lcgcd[0];</span>
<span class="lineNum">    4651 </span><span class="lineNoCov">          0 :         lchvarray[0][1] = lchvarray[0][2] = GCD_Glue; lchvarray[0][3] = NULL;</span>
<span class="lineNum">    4652 </span>            : 
<span class="lineNum">    4653 </span><span class="lineNoCov">          0 :         lclabel[1].text = (unichar_t *) _(&quot;Ligature Caret Count:&quot;);</span>
<span class="lineNum">    4654 </span><span class="lineNoCov">          0 :         lclabel[1].text_is_1byte = true;</span>
<span class="lineNum">    4655 </span><span class="lineNoCov">          0 :         lclabel[1].text_in_resource = true;</span>
<span class="lineNum">    4656 </span><span class="lineNoCov">          0 :         lcgcd[1].gd.label = &amp;lclabel[1];</span>
<span class="lineNum">    4657 </span><span class="lineNoCov">          0 :         lcgcd[1].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4658 </span><span class="lineNoCov">          0 :         lcgcd[1].gd.cid = CID_LCCountLab;</span>
<span class="lineNum">    4659 </span><span class="lineNoCov">          0 :         lcgcd[1].gd.popup_msg = (unichar_t *) _(&quot;Ligature caret locations are used by a text editor\nwhen it needs to draw a text edit caret inside a\nligature. This means there should be a caret between\neach ligature component so if there are n components\nthere should be n-1 caret locations.\n  You may adjust the caret locations themselves in the\noutline glyph view (drag them from to origin to the\nappropriate place).&quot; );</span>
<span class="lineNum">    4660 </span><span class="lineNoCov">          0 :         lcgcd[1].creator = GLabelCreate;</span>
<span class="lineNum">    4661 </span><span class="lineNoCov">          0 :         lchvarray[1][0] = &amp;lcgcd[1];</span>
<span class="lineNum">    4662 </span>            : 
<span class="lineNum">    4663 </span><span class="lineNoCov">          0 :         lcgcd[2].gd.pos.width = 50;</span>
<span class="lineNum">    4664 </span><span class="lineNoCov">          0 :         lcgcd[2].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4665 </span><span class="lineNoCov">          0 :         lcgcd[2].gd.cid = CID_LCCount;</span>
<span class="lineNum">    4666 </span><span class="lineNoCov">          0 :         lcgcd[2].gd.popup_msg = (unichar_t *) _(&quot;Ligature caret locations are used by a text editor\nwhen it needs to draw a text edit caret inside a\nligature. This means there should be a caret between\neach ligature component so if there are n components\nthere should be n-1 caret locations.\n  You may adjust the caret locations themselves in the\noutline glyph view (drag them from to origin to the\nappropriate place).&quot; );</span>
<span class="lineNum">    4667 </span><span class="lineNoCov">          0 :         lcgcd[2].creator = GNumericFieldCreate;</span>
<span class="lineNum">    4668 </span><span class="lineNoCov">          0 :         lchvarray[1][1] = &amp;lcgcd[2]; lchvarray[1][2] = GCD_Glue; lchvarray[1][3] = NULL;</span>
<span class="lineNum">    4669 </span>            : 
<span class="lineNum">    4670 </span><span class="lineNoCov">          0 :         lchvarray[2][0] = lchvarray[2][1] = lchvarray[2][2] = GCD_Glue;</span>
<span class="lineNum">    4671 </span><span class="lineNoCov">          0 :         lchvarray[2][3] = lchvarray[3][0] = NULL;</span>
<span class="lineNum">    4672 </span>            : 
<span class="lineNum">    4673 </span><span class="lineNoCov">          0 :         lcbox[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4674 </span><span class="lineNoCov">          0 :         lcbox[0].gd.u.boxelements = lchvarray[0];</span>
<span class="lineNum">    4675 </span><span class="lineNoCov">          0 :         lcbox[0].creator = GHVBoxCreate;</span>
<span class="lineNum">    4676 </span>            : 
<span class="lineNum">    4677 </span><span class="lineNoCov">          0 :         memset(&amp;vargcd,0,sizeof(vargcd));</span>
<span class="lineNum">    4678 </span><span class="lineNoCov">          0 :         memset(&amp;varbox,0,sizeof(varbox));</span>
<span class="lineNum">    4679 </span><span class="lineNoCov">          0 :         memset(&amp;varlabel,0,sizeof(varlabel));</span>
<span class="lineNum">    4680 </span>            : 
<span class="lineNum">    4681 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;2; ++i ) {</span>
<span class="lineNum">    4682 </span><span class="lineNoCov">          0 :             varlabel[i][0].text = (unichar_t *) _(&quot;Variant Glyphs:&quot;);</span>
<span class="lineNum">    4683 </span><span class="lineNoCov">          0 :             varlabel[i][0].text_is_1byte = true;</span>
<span class="lineNum">    4684 </span><span class="lineNoCov">          0 :             vargcd[i][0].gd.label = &amp;varlabel[i][0];</span>
<span class="lineNum">    4685 </span><span class="lineNoCov">          0 :             vargcd[i][0].gd.pos.x = 5; vargcd[i][0].gd.pos.y = 57+4; </span>
<span class="lineNum">    4686 </span><span class="lineNoCov">          0 :             vargcd[i][0].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4687 </span><span class="lineNoCov">          0 :             vargcd[i][0].creator = GLabelCreate;</span>
<span class="lineNum">    4688 </span><span class="lineNoCov">          0 :             vargcd[i][0].gd.popup_msg = (unichar_t *) _(&quot;A list of the names of pre defined glyphs which represent\nbigger versions of the current glyph.&quot;);</span>
<span class="lineNum">    4689 </span><span class="lineNoCov">          0 :             varhvarray[i][0][0] = &amp;vargcd[i][0];</span>
<span class="lineNum">    4690 </span>            : 
<span class="lineNum">    4691 </span><span class="lineNoCov">          0 :             vargcd[i][1].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4692 </span><span class="lineNoCov">          0 :             vargcd[i][1].gd.cid = CID_VariantList+i*100;</span>
<span class="lineNum">    4693 </span><span class="lineNoCov">          0 :             vargcd[i][1].creator = GTextCompletionCreate;</span>
<span class="lineNum">    4694 </span><span class="lineNoCov">          0 :             vargcd[i][1].gd.popup_msg = vargcd[i][0].gd.popup_msg;</span>
<span class="lineNum">    4695 </span><span class="lineNoCov">          0 :             varhvarray[i][0][1] = &amp;vargcd[i][1]; varhvarray[i][0][2] = GCD_ColSpan; varhvarray[i][0][3] = NULL;</span>
<span class="lineNum">    4696 </span>            : 
<span class="lineNum">    4697 </span><span class="lineNoCov">          0 :             varlabel[i][2].text = (unichar_t *) _(&quot;Glyph Extension Components&quot;);</span>
<span class="lineNum">    4698 </span><span class="lineNoCov">          0 :             varlabel[i][2].text_is_1byte = true;</span>
<span class="lineNum">    4699 </span><span class="lineNoCov">          0 :             vargcd[i][2].gd.label = &amp;varlabel[i][2];</span>
<span class="lineNum">    4700 </span><span class="lineNoCov">          0 :             vargcd[i][2].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4701 </span><span class="lineNoCov">          0 :             vargcd[i][2].creator = GLabelCreate;</span>
<span class="lineNum">    4702 </span><span class="lineNoCov">          0 :             vargcd[i][2].gd.popup_msg = (unichar_t *) _(&quot;A really big version of this glyph may be made up of the\nfollowing component glyphs. They will be stacked either\nhorizontally or vertically. Glyphs marked as Extenders may\nbe removed or repeated (to make shorter or longer versions).\nThe StartLength is the length of the flat section at the\nstart of the glyph which may be overlapped with the previous\nglyph, while the EndLength is the similar region at the end\nof the glyph. The FullLength is the full length of the glyph.&quot; );</span>
<span class="lineNum">    4703 </span><span class="lineNoCov">          0 :             varhvarray[i][1][0] = &amp;vargcd[i][2];</span>
<span class="lineNum">    4704 </span><span class="lineNoCov">          0 :             varhvarray[i][1][1] = varhvarray[i][1][2] = GCD_ColSpan; varhvarray[i][1][3] = NULL;</span>
<span class="lineNum">    4705 </span>            : 
<span class="lineNum">    4706 </span>            : /* GT: &quot;Cor&quot; is an abbreviation for correction */
<span class="lineNum">    4707 </span><span class="lineNoCov">          0 :             varlabel[i][3].text = (unichar_t *) _(&quot;Italic Cor:&quot;);</span>
<span class="lineNum">    4708 </span><span class="lineNoCov">          0 :             varlabel[i][3].text_is_1byte = true;</span>
<span class="lineNum">    4709 </span><span class="lineNoCov">          0 :             vargcd[i][3].gd.label = &amp;varlabel[i][3];</span>
<span class="lineNum">    4710 </span><span class="lineNoCov">          0 :             vargcd[i][3].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4711 </span><span class="lineNoCov">          0 :             vargcd[i][3].creator = GLabelCreate;</span>
<span class="lineNum">    4712 </span><span class="lineNoCov">          0 :             vargcd[i][3].gd.popup_msg = (unichar_t *) _(&quot;The italic correction of the composed glyph. Should be independent of glyph size&quot;);</span>
<span class="lineNum">    4713 </span><span class="lineNoCov">          0 :             varhvarray[i][2][0] = &amp;vargcd[i][3];</span>
<span class="lineNum">    4714 </span>            : 
<span class="lineNum">    4715 </span><span class="lineNoCov">          0 :             vargcd[i][4].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4716 </span><span class="lineNoCov">          0 :             vargcd[i][4].gd.pos.width = 60;</span>
<span class="lineNum">    4717 </span><span class="lineNoCov">          0 :             vargcd[i][4].gd.cid = CID_ExtItalicCor+i*100;</span>
<span class="lineNum">    4718 </span><span class="lineNoCov">          0 :             vargcd[i][4].creator = GTextFieldCreate;</span>
<span class="lineNum">    4719 </span><span class="lineNoCov">          0 :             vargcd[i][4].gd.popup_msg = vargcd[i][3].gd.popup_msg;</span>
<span class="lineNum">    4720 </span><span class="lineNoCov">          0 :             varhvarray[i][2][1] = &amp;vargcd[i][4];</span>
<span class="lineNum">    4721 </span>            : 
<span class="lineNum">    4722 </span><span class="lineNoCov">          0 :             vargcd[i][5].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4723 </span><span class="lineNoCov">          0 :             vargcd[i][5].gd.pos.width = 60;</span>
<span class="lineNum">    4724 </span><span class="lineNoCov">          0 :             vargcd[i][5].gd.cid = CID_ExtItalicDev+i*100;</span>
<span class="lineNum">    4725 </span><span class="lineNoCov">          0 :             vargcd[i][5].creator = GTextFieldCreate;</span>
<span class="lineNum">    4726 </span><span class="lineNoCov">          0 :             vargcd[i][5].gd.popup_msg = vargcd[i][3].gd.popup_msg;</span>
<span class="lineNum">    4727 </span><span class="lineNoCov">          0 :             varhvarray[i][2][2] = &amp;vargcd[i][5];</span>
<span class="lineNum">    4728 </span><span class="lineNoCov">          0 :             varhvarray[i][2][3] = NULL;</span>
<span class="lineNum">    4729 </span>            : 
<span class="lineNum">    4730 </span><span class="lineNoCov">          0 :             vargcd[i][6].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    4731 </span><span class="lineNoCov">          0 :             vargcd[i][6].gd.u.matrix = &amp;mi_extensionpart;</span>
<span class="lineNum">    4732 </span><span class="lineNoCov">          0 :             vargcd[i][6].gd.cid = CID_ExtensionList+i*100;</span>
<span class="lineNum">    4733 </span><span class="lineNoCov">          0 :             vargcd[i][6].creator = GMatrixEditCreate;</span>
<span class="lineNum">    4734 </span><span class="lineNoCov">          0 :             varhvarray[i][3][0] = &amp;vargcd[i][6];</span>
<span class="lineNum">    4735 </span><span class="lineNoCov">          0 :             varhvarray[i][3][1] = varhvarray[i][3][2] = GCD_ColSpan; varhvarray[i][3][3] = NULL;</span>
<span class="lineNum">    4736 </span>            : 
<span class="lineNum">    4737 </span><span class="lineNoCov">          0 :             varhvarray[i][4][0] = NULL;</span>
<span class="lineNum">    4738 </span>            : 
<span class="lineNum">    4739 </span><span class="lineNoCov">          0 :             varbox[i][0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4740 </span><span class="lineNoCov">          0 :             varbox[i][0].gd.u.boxelements = varhvarray[i][0];</span>
<span class="lineNum">    4741 </span><span class="lineNoCov">          0 :             varbox[i][0].creator = GHVBoxCreate;</span>
<span class="lineNum">    4742 </span>            :         }
<span class="lineNum">    4743 </span>            : 
<span class="lineNum">    4744 </span><span class="lineNoCov">          0 :         memset(&amp;tilegcd,0,sizeof(tilegcd));</span>
<span class="lineNum">    4745 </span><span class="lineNoCov">          0 :         memset(&amp;tilebox,0,sizeof(tilebox));</span>
<span class="lineNum">    4746 </span><span class="lineNoCov">          0 :         memset(&amp;tilelabel,0,sizeof(tilelabel));</span>
<span class="lineNum">    4747 </span>            : 
<span class="lineNum">    4748 </span><span class="lineNoCov">          0 :         i=0;</span>
<span class="lineNum">    4749 </span><span class="lineNoCov">          0 :         tilelabel[i].text = (unichar_t *) _(</span>
<span class="lineNum">    4750 </span>            :             &quot;If this glyph is used as a pattern to tile\n&quot;
<span class="lineNum">    4751 </span>            :             &quot;some other glyph then it is useful to specify\n&quot;
<span class="lineNum">    4752 </span>            :             &quot;the amount of whitespace surrounding the tile.\n&quot;
<span class="lineNum">    4753 </span>            :             &quot;Either specify a margin to extend the bounding\n&quot;
<span class="lineNum">    4754 </span>            :             &quot;box of the contents, or specify the bounds\n&quot;
<span class="lineNum">    4755 </span>            :             &quot;explicitly.&quot;);
<span class="lineNum">    4756 </span><span class="lineNoCov">          0 :         tilelabel[i].text_is_1byte = true;</span>
<span class="lineNum">    4757 </span><span class="lineNoCov">          0 :         tilelabel[i].text_in_resource = true;</span>
<span class="lineNum">    4758 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.label = &amp;tilelabel[i];</span>
<span class="lineNum">    4759 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4760 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GLabelCreate;</span>
<span class="lineNum">    4761 </span><span class="lineNoCov">          0 :         tlvarray[0] = &amp;tilegcd[i-1];</span>
<span class="lineNum">    4762 </span>            : 
<span class="lineNum">    4763 </span><span class="lineNoCov">          0 :         tilelabel[i].text = (unichar_t *) _(&quot;Tile Margin:&quot;);</span>
<span class="lineNum">    4764 </span><span class="lineNoCov">          0 :         tilelabel[i].text_is_1byte = true;</span>
<span class="lineNum">    4765 </span><span class="lineNoCov">          0 :         tilelabel[i].text_in_resource = true;</span>
<span class="lineNum">    4766 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.label = &amp;tilelabel[i];</span>
<span class="lineNum">    4767 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4768 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.cid = CID_IsTileMargin;</span>
<span class="lineNum">    4769 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GRadioCreate;</span>
<span class="lineNum">    4770 </span><span class="lineNoCov">          0 :         tlharray[0] = &amp;tilegcd[i-1];</span>
<span class="lineNum">    4771 </span>            : 
<span class="lineNum">    4772 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.pos.width = 60;</span>
<span class="lineNum">    4773 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4774 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.cid = CID_TileMargin;</span>
<span class="lineNum">    4775 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.handle_controlevent = CI_TileMarginChange;</span>
<span class="lineNum">    4776 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GTextFieldCreate;</span>
<span class="lineNum">    4777 </span><span class="lineNoCov">          0 :         tlharray[1] = &amp;tilegcd[i-1]; tlharray[2] = GCD_Glue; tlharray[3] = NULL;</span>
<span class="lineNum">    4778 </span>            : 
<span class="lineNum">    4779 </span><span class="lineNoCov">          0 :         tilebox[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4780 </span><span class="lineNoCov">          0 :         tilebox[2].gd.u.boxelements = tlharray;</span>
<span class="lineNum">    4781 </span><span class="lineNoCov">          0 :         tilebox[2].creator = GHBoxCreate;</span>
<span class="lineNum">    4782 </span><span class="lineNoCov">          0 :         tlvarray[1] = &amp;tilebox[2];</span>
<span class="lineNum">    4783 </span>            : 
<span class="lineNum">    4784 </span><span class="lineNoCov">          0 :         tilelabel[i].text = (unichar_t *) _(&quot;Tile Bounding Box:&quot;);</span>
<span class="lineNum">    4785 </span><span class="lineNoCov">          0 :         tilelabel[i].text_is_1byte = true;</span>
<span class="lineNum">    4786 </span><span class="lineNoCov">          0 :         tilelabel[i].text_in_resource = true;</span>
<span class="lineNum">    4787 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.label = &amp;tilelabel[i];</span>
<span class="lineNum">    4788 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4789 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.cid = CID_IsTileBBox;</span>
<span class="lineNum">    4790 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GRadioCreate;</span>
<span class="lineNum">    4791 </span><span class="lineNoCov">          0 :         tlvarray[2] = &amp;tilegcd[i-1];</span>
<span class="lineNum">    4792 </span>            : 
<span class="lineNum">    4793 </span><span class="lineNoCov">          0 :         tlhvarray[0][0] = GCD_Glue;</span>
<span class="lineNum">    4794 </span>            : 
<span class="lineNum">    4795 </span><span class="lineNoCov">          0 :         tilelabel[i].text = (unichar_t *) _(&quot;  X&quot;);</span>
<span class="lineNum">    4796 </span><span class="lineNoCov">          0 :         tilelabel[i].text_is_1byte = true;</span>
<span class="lineNum">    4797 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.label = &amp;tilelabel[i];</span>
<span class="lineNum">    4798 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4799 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GLabelCreate;</span>
<span class="lineNum">    4800 </span><span class="lineNoCov">          0 :         tlhvarray[0][1] = &amp;tilegcd[i-1];</span>
<span class="lineNum">    4801 </span>            : 
<span class="lineNum">    4802 </span><span class="lineNoCov">          0 :         tilelabel[i].text = (unichar_t *) _(&quot;  Y&quot;);</span>
<span class="lineNum">    4803 </span><span class="lineNoCov">          0 :         tilelabel[i].text_is_1byte = true;</span>
<span class="lineNum">    4804 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.label = &amp;tilelabel[i];</span>
<span class="lineNum">    4805 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4806 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GLabelCreate;</span>
<span class="lineNum">    4807 </span><span class="lineNoCov">          0 :         tlhvarray[0][2] = &amp;tilegcd[i-1]; tlhvarray[0][3] = GCD_Glue; tlhvarray[0][4] = NULL;</span>
<span class="lineNum">    4808 </span>            : 
<span class="lineNum">    4809 </span><span class="lineNoCov">          0 :         tilelabel[i].text = (unichar_t *) _(&quot;Min&quot;);</span>
<span class="lineNum">    4810 </span><span class="lineNoCov">          0 :         tilelabel[i].text_is_1byte = true;</span>
<span class="lineNum">    4811 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.label = &amp;tilelabel[i];</span>
<span class="lineNum">    4812 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4813 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GLabelCreate;</span>
<span class="lineNum">    4814 </span><span class="lineNoCov">          0 :         tlhvarray[1][0] = &amp;tilegcd[i-1];</span>
<span class="lineNum">    4815 </span>            : 
<span class="lineNum">    4816 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4817 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.cid = CID_TileBBoxMinX;</span>
<span class="lineNum">    4818 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GTextFieldCreate;</span>
<span class="lineNum">    4819 </span><span class="lineNoCov">          0 :         tlhvarray[1][1] = &amp;tilegcd[i-1];</span>
<span class="lineNum">    4820 </span>            : 
<span class="lineNum">    4821 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4822 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.cid = CID_TileBBoxMinY;</span>
<span class="lineNum">    4823 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GTextFieldCreate;</span>
<span class="lineNum">    4824 </span><span class="lineNoCov">          0 :         tlhvarray[1][2] = &amp;tilegcd[i-1]; tlhvarray[1][3] = GCD_Glue; tlhvarray[1][4] = NULL;</span>
<span class="lineNum">    4825 </span>            : 
<span class="lineNum">    4826 </span><span class="lineNoCov">          0 :         tilelabel[i].text = (unichar_t *) _(&quot;Max&quot;);</span>
<span class="lineNum">    4827 </span><span class="lineNoCov">          0 :         tilelabel[i].text_is_1byte = true;</span>
<span class="lineNum">    4828 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.label = &amp;tilelabel[i];</span>
<span class="lineNum">    4829 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4830 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GLabelCreate;</span>
<span class="lineNum">    4831 </span><span class="lineNoCov">          0 :         tlhvarray[2][0] = &amp;tilegcd[i-1];</span>
<span class="lineNum">    4832 </span>            : 
<span class="lineNum">    4833 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4834 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.cid = CID_TileBBoxMaxX;</span>
<span class="lineNum">    4835 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GTextFieldCreate;</span>
<span class="lineNum">    4836 </span><span class="lineNoCov">          0 :         tlhvarray[2][1] = &amp;tilegcd[i-1];</span>
<span class="lineNum">    4837 </span>            : 
<span class="lineNum">    4838 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4839 </span><span class="lineNoCov">          0 :         tilegcd[i].gd.cid = CID_TileBBoxMaxY;</span>
<span class="lineNum">    4840 </span><span class="lineNoCov">          0 :         tilegcd[i++].creator = GTextFieldCreate;</span>
<span class="lineNum">    4841 </span><span class="lineNoCov">          0 :         tlhvarray[2][2] = &amp;tilegcd[i-1]; tlhvarray[2][3] = GCD_Glue; tlhvarray[2][4] = NULL;</span>
<span class="lineNum">    4842 </span><span class="lineNoCov">          0 :         tlhvarray[3][0] = NULL;</span>
<span class="lineNum">    4843 </span>            : 
<span class="lineNum">    4844 </span><span class="lineNoCov">          0 :         tilebox[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4845 </span><span class="lineNoCov">          0 :         tilebox[3].gd.u.boxelements = tlhvarray[0];</span>
<span class="lineNum">    4846 </span><span class="lineNoCov">          0 :         tilebox[3].creator = GHVBoxCreate;</span>
<span class="lineNum">    4847 </span><span class="lineNoCov">          0 :         tlvarray[3] = &amp;tilebox[3]; tlvarray[4] = GCD_Glue; tlvarray[5] = NULL;</span>
<span class="lineNum">    4848 </span>            : 
<span class="lineNum">    4849 </span><span class="lineNoCov">          0 :         tilebox[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4850 </span><span class="lineNoCov">          0 :         tilebox[0].gd.u.boxelements = tlvarray;</span>
<span class="lineNum">    4851 </span><span class="lineNoCov">          0 :         tilebox[0].creator = GVBoxCreate;</span>
<span class="lineNum">    4852 </span>            : 
<span class="lineNum">    4853 </span><span class="lineNoCov">          0 :         memset(&amp;mgcd,0,sizeof(mgcd));</span>
<span class="lineNum">    4854 </span><span class="lineNoCov">          0 :         memset(&amp;mbox,0,sizeof(mbox));</span>
<span class="lineNum">    4855 </span><span class="lineNoCov">          0 :         memset(&amp;mlabel,0,sizeof(mlabel));</span>
<span class="lineNum">    4856 </span><span class="lineNoCov">          0 :         memset(&amp;aspects,'\0',sizeof(aspects));</span>
<span class="lineNum">    4857 </span>            : 
<span class="lineNum">    4858 </span><span class="lineNoCov">          0 :         i = 0;</span>
<span class="lineNum">    4859 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) _(&quot;Unicode&quot;);</span>
<span class="lineNum">    4860 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4861 </span><span class="lineNoCov">          0 :         aspects[i].selected = true;</span>
<span class="lineNum">    4862 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = ubox;</span>
<span class="lineNum">    4863 </span>            : 
<span class="lineNum">    4864 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) _(&quot;Comment&quot;);</span>
<span class="lineNum">    4865 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4866 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = cbox;</span>
<span class="lineNum">    4867 </span>            : 
<span class="lineNum">    4868 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) _(&quot;Positionings&quot;);</span>
<span class="lineNum">    4869 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4870 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = pstbox[pst_position-1];</span>
<span class="lineNum">    4871 </span>            : 
<span class="lineNum">    4872 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) _(&quot;Pairwise Pos&quot;);</span>
<span class="lineNum">    4873 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4874 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = pstbox[pst_pair-1];</span>
<span class="lineNum">    4875 </span>            : 
<span class="lineNum">    4876 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) _(&quot;Substitutions&quot;);</span>
<span class="lineNum">    4877 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4878 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = psgcd[2];</span>
<span class="lineNum">    4879 </span>            : 
<span class="lineNum">    4880 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) _(&quot;Alt Subs&quot;);</span>
<span class="lineNum">    4881 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4882 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = psgcd[3];</span>
<span class="lineNum">    4883 </span>            : 
<span class="lineNum">    4884 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) _(&quot;Mult Subs&quot;);</span>
<span class="lineNum">    4885 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4886 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = psgcd[4];</span>
<span class="lineNum">    4887 </span>            : 
<span class="lineNum">    4888 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) _(&quot;Ligatures&quot;);</span>
<span class="lineNum">    4889 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4890 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = psgcd[5];</span>
<span class="lineNum">    4891 </span>            : 
<span class="lineNum">    4892 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) _(&quot;Components&quot;);</span>
<span class="lineNum">    4893 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4894 </span><span class="lineNoCov">          0 :         aspects[i].nesting = 1;</span>
<span class="lineNum">    4895 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = cobox;</span>
<span class="lineNum">    4896 </span>            : 
<span class="lineNum">    4897 </span><span class="lineNoCov">          0 :         ci-&gt;lc_aspect = i;</span>
<span class="lineNum">    4898 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) _(&quot;Lig. Carets&quot;);</span>
<span class="lineNum">    4899 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4900 </span><span class="lineNoCov">          0 :         aspects[i].nesting = 1;</span>
<span class="lineNum">    4901 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = lcbox;</span>
<span class="lineNum">    4902 </span>            : 
<span class="lineNum">    4903 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) _(&quot;Counters&quot;);</span>
<span class="lineNum">    4904 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4905 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = pstbox[6];</span>
<span class="lineNum">    4906 </span>            : 
<span class="lineNum">    4907 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) U_(&quot;ΤεΧ &amp; Math&quot;);      /* TeX */</span>
<span class="lineNum">    4908 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4909 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = tbox;</span>
<span class="lineNum">    4910 </span>            : 
<span class="lineNum">    4911 </span><span class="lineNoCov">          0 :         ci-&gt;vert_aspect = i;</span>
<span class="lineNum">    4912 </span>            : /* GT: &quot;Vert.&quot; is an abbreviation for Vertical */
<span class="lineNum">    4913 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) U_(&quot;Vert. Variants&quot;);</span>
<span class="lineNum">    4914 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4915 </span><span class="lineNoCov">          0 :         aspects[i].nesting = 1;</span>
<span class="lineNum">    4916 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = varbox[0];</span>
<span class="lineNum">    4917 </span>            : 
<span class="lineNum">    4918 </span>            : /* GT: &quot;Horiz.&quot; is an abbreviation for Horizontal */
<span class="lineNum">    4919 </span><span class="lineNoCov">          0 :         aspects[i].text = (unichar_t *) U_(&quot;Horiz. Variants&quot;);</span>
<span class="lineNum">    4920 </span><span class="lineNoCov">          0 :         aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4921 </span><span class="lineNoCov">          0 :         aspects[i].nesting = 1;</span>
<span class="lineNum">    4922 </span><span class="lineNoCov">          0 :         aspects[i++].gcd = varbox[1];</span>
<span class="lineNum">    4923 </span>            : 
<span class="lineNum">    4924 </span><span class="lineNoCov">          0 :         if ( sc-&gt;parent-&gt;multilayer ) {</span>
<span class="lineNum">    4925 </span><span class="lineNoCov">          0 :             aspects[i].text = (unichar_t *) U_(&quot;Tile Size&quot;);</span>
<span class="lineNum">    4926 </span><span class="lineNoCov">          0 :             aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4927 </span><span class="lineNoCov">          0 :             aspects[i++].gcd = tilebox;</span>
<span class="lineNum">    4928 </span>            :         }
<span class="lineNum">    4929 </span>            : 
<span class="lineNum">    4930 </span><span class="lineNoCov">          0 :         if ( last_gi_aspect&lt;i )</span>
<span class="lineNum">    4931 </span><span class="lineNoCov">          0 :             aspects[last_gi_aspect].selected = true;</span>
<span class="lineNum">    4932 </span>            : 
<span class="lineNum">    4933 </span><span class="lineNoCov">          0 :         mgcd[0].gd.pos.x = 4; mgcd[0].gd.pos.y = 6;</span>
<span class="lineNum">    4934 </span><span class="lineNoCov">          0 :         mgcd[0].gd.u.tabs = aspects;</span>
<span class="lineNum">    4935 </span><span class="lineNoCov">          0 :         mgcd[0].gd.flags = gg_visible | gg_enabled | gg_tabset_vert;</span>
<span class="lineNum">    4936 </span><span class="lineNoCov">          0 :         mgcd[0].gd.cid = CID_Tabs;</span>
<span class="lineNum">    4937 </span><span class="lineNoCov">          0 :         mgcd[0].gd.handle_controlevent = CI_AspectChange;</span>
<span class="lineNum">    4938 </span><span class="lineNoCov">          0 :         mgcd[0].creator = GTabSetCreate;</span>
<span class="lineNum">    4939 </span><span class="lineNoCov">          0 :         mvarray[0] = &amp;mgcd[0]; mvarray[1] = NULL;</span>
<span class="lineNum">    4940 </span>            : 
<span class="lineNum">    4941 </span><span class="lineNoCov">          0 :         mgcd[1].gd.pos.x = 40; mgcd[1].gd.pos.y = mgcd[0].gd.pos.y+mgcd[0].gd.pos.height+3;</span>
<span class="lineNum">    4942 </span><span class="lineNoCov">          0 :         mgcd[1].gd.flags = gg_visible | gg_enabled ;</span>
<span class="lineNum">    4943 </span><span class="lineNoCov">          0 :         mlabel[1].text = (unichar_t *) _(&quot;&lt; _Prev&quot;);</span>
<span class="lineNum">    4944 </span><span class="lineNoCov">          0 :         mlabel[1].text_is_1byte = true;</span>
<span class="lineNum">    4945 </span><span class="lineNoCov">          0 :         mlabel[1].text_in_resource = true;</span>
<span class="lineNum">    4946 </span><span class="lineNoCov">          0 :         mgcd[1].gd.mnemonic = 'P';</span>
<span class="lineNum">    4947 </span><span class="lineNoCov">          0 :         mgcd[1].gd.label = &amp;mlabel[1];</span>
<span class="lineNum">    4948 </span><span class="lineNoCov">          0 :         mgcd[1].gd.handle_controlevent = CI_NextPrev;</span>
<span class="lineNum">    4949 </span><span class="lineNoCov">          0 :         mgcd[1].gd.cid = -1;</span>
<span class="lineNum">    4950 </span><span class="lineNoCov">          0 :         mharray1[0] = GCD_Glue; mharray1[1] = &amp;mgcd[1]; mharray1[2] = GCD_Glue;</span>
<span class="lineNum">    4951 </span><span class="lineNoCov">          0 :         mgcd[1].creator = GButtonCreate;</span>
<span class="lineNum">    4952 </span>            : 
<span class="lineNum">    4953 </span><span class="lineNoCov">          0 :         mgcd[2].gd.pos.x = -40; mgcd[2].gd.pos.y = mgcd[1].gd.pos.y;</span>
<span class="lineNum">    4954 </span><span class="lineNoCov">          0 :         mgcd[2].gd.flags = gg_visible | gg_enabled ;</span>
<span class="lineNum">    4955 </span><span class="lineNoCov">          0 :         mlabel[2].text = (unichar_t *) _(&quot;_Next &gt;&quot;);</span>
<span class="lineNum">    4956 </span><span class="lineNoCov">          0 :         mlabel[2].text_is_1byte = true;</span>
<span class="lineNum">    4957 </span><span class="lineNoCov">          0 :         mlabel[2].text_in_resource = true;</span>
<span class="lineNum">    4958 </span><span class="lineNoCov">          0 :         mgcd[2].gd.label = &amp;mlabel[2];</span>
<span class="lineNum">    4959 </span><span class="lineNoCov">          0 :         mgcd[2].gd.mnemonic = 'N';</span>
<span class="lineNum">    4960 </span><span class="lineNoCov">          0 :         mgcd[2].gd.handle_controlevent = CI_NextPrev;</span>
<span class="lineNum">    4961 </span><span class="lineNoCov">          0 :         mgcd[2].gd.cid = 1;</span>
<span class="lineNum">    4962 </span><span class="lineNoCov">          0 :         mharray1[3] = GCD_Glue; mharray1[4] = &amp;mgcd[2]; mharray1[5] = GCD_Glue; mharray1[6] = NULL;</span>
<span class="lineNum">    4963 </span><span class="lineNoCov">          0 :         mgcd[2].creator = GButtonCreate;</span>
<span class="lineNum">    4964 </span>            : 
<span class="lineNum">    4965 </span><span class="lineNoCov">          0 :         mbox[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4966 </span><span class="lineNoCov">          0 :         mbox[2].gd.u.boxelements = mharray1;</span>
<span class="lineNum">    4967 </span><span class="lineNoCov">          0 :         mbox[2].creator = GHBoxCreate;</span>
<span class="lineNum">    4968 </span><span class="lineNoCov">          0 :         mvarray[2] = &amp;mbox[2]; mvarray[3] = NULL;</span>
<span class="lineNum">    4969 </span>            : 
<span class="lineNum">    4970 </span><span class="lineNoCov">          0 :         mgcd[3].gd.pos.x = 25-3; mgcd[3].gd.pos.y = CI_Height-31-3;</span>
<span class="lineNum">    4971 </span><span class="lineNoCov">          0 :         mgcd[3].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">    4972 </span><span class="lineNoCov">          0 :         mlabel[3].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">    4973 </span><span class="lineNoCov">          0 :         mlabel[3].text_is_1byte = true;</span>
<span class="lineNum">    4974 </span><span class="lineNoCov">          0 :         mlabel[3].text_in_resource = true;</span>
<span class="lineNum">    4975 </span><span class="lineNoCov">          0 :         mgcd[3].gd.mnemonic = 'O';</span>
<span class="lineNum">    4976 </span><span class="lineNoCov">          0 :         mgcd[3].gd.label = &amp;mlabel[3];</span>
<span class="lineNum">    4977 </span><span class="lineNoCov">          0 :         mgcd[3].gd.handle_controlevent = CI_OK;</span>
<span class="lineNum">    4978 </span><span class="lineNoCov">          0 :         mharray2[0] = GCD_Glue; mharray2[1] = &amp;mgcd[3]; mharray2[2] = GCD_Glue; mharray2[3] = GCD_Glue;</span>
<span class="lineNum">    4979 </span><span class="lineNoCov">          0 :         mgcd[3].creator = GButtonCreate;</span>
<span class="lineNum">    4980 </span>            : 
<span class="lineNum">    4981 </span><span class="lineNoCov">          0 :         mgcd[4].gd.pos.x = -25; mgcd[4].gd.pos.y = mgcd[3].gd.pos.y+3;</span>
<span class="lineNum">    4982 </span><span class="lineNoCov">          0 :         mgcd[4].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">    4983 </span><span class="lineNoCov">          0 :         mlabel[4].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    4984 </span><span class="lineNoCov">          0 :         mlabel[4].text_is_1byte = true;</span>
<span class="lineNum">    4985 </span><span class="lineNoCov">          0 :         mlabel[4].text_in_resource = true;</span>
<span class="lineNum">    4986 </span><span class="lineNoCov">          0 :         mgcd[4].gd.label = &amp;mlabel[4];</span>
<span class="lineNum">    4987 </span><span class="lineNoCov">          0 :         mgcd[4].gd.handle_controlevent = CI_Cancel;</span>
<span class="lineNum">    4988 </span><span class="lineNoCov">          0 :         mgcd[4].gd.cid = CID_Cancel;</span>
<span class="lineNum">    4989 </span><span class="lineNoCov">          0 :         mharray2[4] = GCD_Glue; mharray2[5] = &amp;mgcd[4]; mharray2[6] = GCD_Glue; mharray2[7] = NULL;</span>
<span class="lineNum">    4990 </span><span class="lineNoCov">          0 :         mgcd[4].creator = GButtonCreate;</span>
<span class="lineNum">    4991 </span>            : 
<span class="lineNum">    4992 </span><span class="lineNoCov">          0 :         mbox[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4993 </span><span class="lineNoCov">          0 :         mbox[3].gd.u.boxelements = mharray2;</span>
<span class="lineNum">    4994 </span><span class="lineNoCov">          0 :         mbox[3].creator = GHBoxCreate;</span>
<span class="lineNum">    4995 </span><span class="lineNoCov">          0 :         mvarray[4] = &amp;mbox[3]; mvarray[5] = NULL;</span>
<span class="lineNum">    4996 </span><span class="lineNoCov">          0 :         mvarray[6] = NULL;</span>
<span class="lineNum">    4997 </span>            : 
<span class="lineNum">    4998 </span><span class="lineNoCov">          0 :         mbox[0].gd.pos.x = mbox[0].gd.pos.y = 2;</span>
<span class="lineNum">    4999 </span><span class="lineNoCov">          0 :         mbox[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    5000 </span><span class="lineNoCov">          0 :         mbox[0].gd.u.boxelements = mvarray;</span>
<span class="lineNum">    5001 </span><span class="lineNoCov">          0 :         mbox[0].creator = GHVGroupCreate;</span>
<span class="lineNum">    5002 </span>            : 
<span class="lineNum">    5003 </span><span class="lineNoCov">          0 :         GGadgetsCreate(ci-&gt;gw,mbox);</span>
<span class="lineNum">    5004 </span>            : 
<span class="lineNum">    5005 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(mbox[0].ret,0);</span>
<span class="lineNum">    5006 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(mbox[2].ret,gb_expandgluesame);</span>
<span class="lineNum">    5007 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(mbox[3].ret,gb_expandgluesame);</span>
<span class="lineNum">    5008 </span>            : 
<span class="lineNum">    5009 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(ubox[0].ret,gb_expandglue);</span>
<span class="lineNum">    5010 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(ubox[0].ret,1);</span>
<span class="lineNum">    5011 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(ubox[2].ret,gb_expandgluesame);</span>
<span class="lineNum">    5012 </span>            : 
<span class="lineNum">    5013 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(cbox[0].ret,1);</span>
<span class="lineNum">    5014 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(cbox[2].ret,gb_expandglue);</span>
<span class="lineNum">    5015 </span>            : 
<span class="lineNum">    5016 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;6; ++i ) {</span>
<span class="lineNum">    5017 </span><span class="lineNoCov">          0 :             GGadget *g = GWidgetGetControl(ci-&gt;gw,CID_List+i*100);</span>
<span class="lineNum">    5018 </span><span class="lineNoCov">          0 :             GMatrixEditSetNewText(g, newstrings[i]);</span>
<span class="lineNum">    5019 </span><span class="lineNoCov">          0 :             if ( i==pst_substitution-1 || i==pst_pair-1 )</span>
<span class="lineNum">    5020 </span><span class="lineNoCov">          0 :                 GMatrixEditSetColumnCompletion(g,1,CI_GlyphNameCompletion);</span>
<span class="lineNum">    5021 </span><span class="lineNoCov">          0 :             else if ( i==pst_alternate-1 || i==pst_multiple-1 ||</span>
<span class="lineNum">    5022 </span>            :                     i==pst_ligature-1)
<span class="lineNum">    5023 </span><span class="lineNoCov">          0 :                 GMatrixEditSetColumnCompletion(g,1,CI_GlyphListCompletion);</span>
<span class="lineNum">    5024 </span>            :         }
<span class="lineNum">    5025 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(pstbox[pst_pair-1][0].ret,0);</span>
<span class="lineNum">    5026 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;6; ++i )</span>
<span class="lineNum">    5027 </span><span class="lineNoCov">          0 :             GMatrixEditSetMouseMoveReporter(psgcd[i][0].ret,CI_SubsPopupPrepare);</span>
<span class="lineNum">    5028 </span><span class="lineNoCov">          0 :         GMatrixEditSetMouseMoveReporter(psgcd[pst_pair-1][0].ret,CI_KerningPopupPrepare);</span>
<span class="lineNum">    5029 </span><span class="lineNoCov">          0 :         for ( i=6; i&lt;7; ++i ) {</span>
<span class="lineNum">    5030 </span><span class="lineNoCov">          0 :             GHVBoxSetExpandableRow(pstbox[i][0].ret,0);</span>
<span class="lineNum">    5031 </span><span class="lineNoCov">          0 :             GHVBoxSetExpandableCol(pstbox[i][2].ret,gb_expandgluesame);</span>
<span class="lineNum">    5032 </span>            :         }
<span class="lineNum">    5033 </span>            : 
<span class="lineNum">    5034 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(cobox[0].ret,gb_expandglue);</span>
<span class="lineNum">    5035 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(tbox[0].ret,gb_expandglue);</span>
<span class="lineNum">    5036 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(tbox[0].ret,gb_expandglue);</span>
<span class="lineNum">    5037 </span><span class="lineNoCov">          0 :         GHVBoxSetPadding(tbox[0].ret,6,4);</span>
<span class="lineNum">    5038 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(tbox[2].ret,gb_expandglue);</span>
<span class="lineNum">    5039 </span>            : 
<span class="lineNum">    5040 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(lcbox[0].ret,gb_expandglue);</span>
<span class="lineNum">    5041 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(lcbox[0].ret,gb_expandglue);</span>
<span class="lineNum">    5042 </span>            : 
<span class="lineNum">    5043 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(varbox[0][0].ret,3);</span>
<span class="lineNum">    5044 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(varbox[1][0].ret,3);</span>
<span class="lineNum">    5045 </span>            : 
<span class="lineNum">    5046 </span><span class="lineNoCov">          0 :         if ( sc-&gt;parent-&gt;multilayer ) {</span>
<span class="lineNum">    5047 </span><span class="lineNoCov">          0 :             GHVBoxSetExpandableRow(tilebox[0].ret,gb_expandglue);</span>
<span class="lineNum">    5048 </span><span class="lineNoCov">          0 :             GHVBoxSetExpandableCol(tilebox[2].ret,gb_expandglue);</span>
<span class="lineNum">    5049 </span><span class="lineNoCov">          0 :             GHVBoxSetExpandableCol(tilebox[3].ret,gb_expandglue);</span>
<span class="lineNum">    5050 </span>            :         }
<span class="lineNum">    5051 </span>            : 
<span class="lineNum">    5052 </span><span class="lineNoCov">          0 :         GHVBoxFitWindow(mbox[0].ret);</span>
<span class="lineNum">    5053 </span>            : 
<span class="lineNum">    5054 </span><span class="lineNoCov">          0 :         if ( font==NULL ) {</span>
<span class="lineNum">    5055 </span><span class="lineNoCov">          0 :             memset(&amp;rq,0,sizeof(rq));</span>
<span class="lineNum">    5056 </span><span class="lineNoCov">          0 :             rq.utf8_family_name = MONO_UI_FAMILIES;</span>
<span class="lineNum">    5057 </span><span class="lineNoCov">          0 :             rq.point_size = 12;</span>
<span class="lineNum">    5058 </span><span class="lineNoCov">          0 :             rq.weight = 400;</span>
<span class="lineNum">    5059 </span><span class="lineNoCov">          0 :             font = GDrawInstanciateFont(ci-&gt;gw,&amp;rq);</span>
<span class="lineNum">    5060 </span><span class="lineNoCov">          0 :             font = GResourceFindFont(&quot;GlyphInfo.Font&quot;,font);</span>
<span class="lineNum">    5061 </span>            :         }
<span class="lineNum">    5062 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;5; ++i )</span>
<span class="lineNum">    5063 </span><span class="lineNoCov">          0 :             GGadgetSetFont(psgcd[i][0].ret,font);</span>
<span class="lineNum">    5064 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;2; ++i ) {</span>
<span class="lineNum">    5065 </span><span class="lineNoCov">          0 :             GCompletionFieldSetCompletion(vargcd[i][1].ret,CI_GlyphNameCompletion);</span>
<span class="lineNum">    5066 </span><span class="lineNoCov">          0 :             GCompletionFieldSetCompletionMode(vargcd[i][1].ret,true);</span>
<span class="lineNum">    5067 </span><span class="lineNoCov">          0 :             GMatrixEditSetColumnCompletion(vargcd[i][6].ret,0,CI_GlyphNameCompletion);</span>
<span class="lineNum">    5068 </span><span class="lineNoCov">          0 :             GMatrixEditSetMouseMoveReporter(vargcd[i][6].ret,CI_ConstructionPopupPrepare);</span>
<span class="lineNum">    5069 </span>            :         }
<span class="lineNum">    5070 </span>            : 
<span class="lineNum">    5071 </span><span class="lineNoCov">          0 :     CIFillup(ci);</span>
<span class="lineNum">    5072 </span>            : 
<span class="lineNum">    5073 </span><span class="lineNoCov">          0 :     GWidgetHidePalettes();</span>
<span class="lineNum">    5074 </span><span class="lineNoCov">          0 :     GDrawSetVisible(ci-&gt;gw,true);</span>
<a name="5075"><span class="lineNum">    5075 </span>            : }</a>
<span class="lineNum">    5076 </span>            : 
<span class="lineNum">    5077 </span><span class="lineNoCov">          0 : void CharInfoDestroy(CharInfo *ci) {</span>
<span class="lineNum">    5078 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(ci-&gt;gw);</span>
<span class="lineNum">    5079 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    5080 </span>            : 
<span class="lineNum">    5081 </span>            : struct sel_dlg {
<span class="lineNum">    5082 </span>            :     int done;
<span class="lineNum">    5083 </span>            :     int ok;
<span class="lineNum">    5084 </span>            :     FontView *fv;
<a name="5085"><span class="lineNum">    5085 </span>            : };</a>
<span class="lineNum">    5086 </span>            : 
<span class="lineNum">    5087 </span><span class="lineNoCov">          0 : int FVParseSelectByPST(FontView *fv,struct lookup_subtable *sub,</span>
<span class="lineNum">    5088 </span>            :         int search_type) {
<span class="lineNum">    5089 </span>            :     int first;
<span class="lineNum">    5090 </span>            : 
<span class="lineNum">    5091 </span><span class="lineNoCov">          0 :     first = FVBParseSelectByPST((FontViewBase *) fv,sub,search_type);</span>
<span class="lineNum">    5092 </span>            : 
<span class="lineNum">    5093 </span><span class="lineNoCov">          0 :     if ( first!=-1 )</span>
<span class="lineNum">    5094 </span><span class="lineNoCov">          0 :         FVScrollToChar(fv,first);</span>
<span class="lineNum">    5095 </span><span class="lineNoCov">          0 :     else if ( !no_windowing_ui )</span>
<span class="lineNum">    5096 </span><span class="lineNoCov">          0 :         ff_post_notice(_(&quot;Select By ATT...&quot;),_(&quot;No glyphs matched&quot;));</span>
<span class="lineNum">    5097 </span><span class="lineNoCov">          0 :     if (  !no_windowing_ui )</span>
<span class="lineNum">    5098 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(fv-&gt;v,NULL,false);</span>
<span class="lineNum">    5099 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="5100"><span class="lineNum">    5100 </span>            : }</a>
<span class="lineNum">    5101 </span>            :     
<span class="lineNum">    5102 </span><span class="lineNoCov">          0 : static int SelectStuff(struct sel_dlg *sld,GWindow gw) {</span>
<span class="lineNum">    5103 </span><span class="lineNoCov">          0 :     struct lookup_subtable *sub = GGadgetGetListItemSelected(GWidgetGetControl(gw,CID_PST))-&gt;userdata;</span>
<span class="lineNum">    5104 </span><span class="lineNoCov">          0 :     int search_type = GGadgetIsChecked(GWidgetGetControl(gw,CID_SelectResults)) ? 1 :</span>
<span class="lineNum">    5105 </span><span class="lineNoCov">          0 :             GGadgetIsChecked(GWidgetGetControl(gw,CID_MergeResults)) ? 2 :</span>
<span class="lineNum">    5106 </span>            :                 3;
<span class="lineNum">    5107 </span><span class="lineNoCov">          0 : return( FVParseSelectByPST(sld-&gt;fv, sub, search_type));</span>
<a name="5108"><span class="lineNum">    5108 </span>            : }</a>
<span class="lineNum">    5109 </span>            : 
<span class="lineNum">    5110 </span><span class="lineNoCov">          0 : static int selpst_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    5111 </span><span class="lineNoCov">          0 :     struct sel_dlg *sld = GDrawGetUserData(gw);</span>
<span class="lineNum">    5112 </span>            : 
<span class="lineNum">    5113 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">    5114 </span><span class="lineNoCov">          0 :         sld-&gt;done = true;</span>
<span class="lineNum">    5115 </span><span class="lineNoCov">          0 :         sld-&gt;ok = false;</span>
<span class="lineNum">    5116 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_char ) {</span>
<span class="lineNum">    5117 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.keysym == GK_F1 || event-&gt;u.chr.keysym == GK_Help ) {</span>
<span class="lineNum">    5118 </span><span class="lineNoCov">          0 :             help(&quot;selectbyatt.html&quot;);</span>
<span class="lineNum">    5119 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    5120 </span>            :         }
<span class="lineNum">    5121 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    5122 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_controlevent &amp;&amp; event-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    5123 </span><span class="lineNoCov">          0 :         sld-&gt;ok = GGadgetGetCid(event-&gt;u.control.g);</span>
<span class="lineNum">    5124 </span><span class="lineNoCov">          0 :         if ( !sld-&gt;ok || SelectStuff(sld,gw))</span>
<span class="lineNum">    5125 </span><span class="lineNoCov">          0 :             sld-&gt;done = true;</span>
<span class="lineNum">    5126 </span>            :     }
<span class="lineNum">    5127 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="5128"><span class="lineNum">    5128 </span>            : }</a>
<span class="lineNum">    5129 </span>            : 
<span class="lineNum">    5130 </span><span class="lineNoCov">          0 : void FVSelectByPST(FontView *fv) {</span>
<span class="lineNum">    5131 </span>            :     struct sel_dlg sld;
<span class="lineNum">    5132 </span>            :     GWindow gw;
<span class="lineNum">    5133 </span>            :     GRect pos;
<span class="lineNum">    5134 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    5135 </span>            :     GGadgetCreateData gcd[14];
<span class="lineNum">    5136 </span>            :     GTextInfo label[14];
<span class="lineNum">    5137 </span>            :     GGadgetCreateData *varray[20], *harray[8];
<span class="lineNum">    5138 </span>            :     int i,j,isgpos, cnt;
<span class="lineNum">    5139 </span>            :     OTLookup *otl;
<span class="lineNum">    5140 </span>            :     struct lookup_subtable *sub;
<span class="lineNum">    5141 </span>            :     GTextInfo *ti;
<span class="lineNum">    5142 </span><span class="lineNoCov">          0 :     SplineFont *sf = fv-&gt;b.sf;</span>
<span class="lineNum">    5143 </span>            : 
<span class="lineNum">    5144 </span><span class="lineNoCov">          0 :     if ( sf-&gt;cidmaster ) sf = sf-&gt;cidmaster;</span>
<span class="lineNum">    5145 </span><span class="lineNoCov">          0 :     ti = NULL;</span>
<span class="lineNum">    5146 </span><span class="lineNoCov">          0 :     for ( j=0; j&lt;2; ++j ) {</span>
<span class="lineNum">    5147 </span><span class="lineNoCov">          0 :         cnt = 0;</span>
<span class="lineNum">    5148 </span><span class="lineNoCov">          0 :         for ( isgpos=0; isgpos&lt;2; ++isgpos ) {</span>
<span class="lineNum">    5149 </span><span class="lineNoCov">          0 :             for ( otl = isgpos ? sf-&gt;gpos_lookups : sf-&gt;gsub_lookups ; otl!=NULL; otl=otl-&gt;next ) {</span>
<span class="lineNum">    5150 </span><span class="lineNoCov">          0 :                 if ( otl-&gt;lookup_type== gsub_single ||</span>
<span class="lineNum">    5151 </span><span class="lineNoCov">          0 :                         otl-&gt;lookup_type== gsub_multiple ||</span>
<span class="lineNum">    5152 </span><span class="lineNoCov">          0 :                         otl-&gt;lookup_type== gsub_alternate ||</span>
<span class="lineNum">    5153 </span><span class="lineNoCov">          0 :                         otl-&gt;lookup_type== gsub_ligature ||</span>
<span class="lineNum">    5154 </span><span class="lineNoCov">          0 :                         otl-&gt;lookup_type== gpos_single ||</span>
<span class="lineNum">    5155 </span><span class="lineNoCov">          0 :                         otl-&gt;lookup_type== gpos_pair ||</span>
<span class="lineNum">    5156 </span><span class="lineNoCov">          0 :                         otl-&gt;lookup_type== gpos_cursive ||</span>
<span class="lineNum">    5157 </span><span class="lineNoCov">          0 :                         otl-&gt;lookup_type== gpos_mark2base ||</span>
<span class="lineNum">    5158 </span><span class="lineNoCov">          0 :                         otl-&gt;lookup_type== gpos_mark2ligature ||</span>
<span class="lineNum">    5159 </span><span class="lineNoCov">          0 :                         otl-&gt;lookup_type== gpos_mark2mark )</span>
<span class="lineNum">    5160 </span><span class="lineNoCov">          0 :                     for ( sub=otl-&gt;subtables; sub!=NULL; sub=sub-&gt;next )</span>
<span class="lineNum">    5161 </span><span class="lineNoCov">          0 :                         if ( sub-&gt;kc==NULL ) {</span>
<span class="lineNum">    5162 </span><span class="lineNoCov">          0 :                             if ( ti!=NULL ) {</span>
<span class="lineNum">    5163 </span><span class="lineNoCov">          0 :                                 ti[cnt].text = (unichar_t *) copy(sub-&gt;subtable_name);</span>
<span class="lineNum">    5164 </span><span class="lineNoCov">          0 :                                 ti[cnt].text_is_1byte = true;</span>
<span class="lineNum">    5165 </span><span class="lineNoCov">          0 :                                 ti[cnt].userdata = sub;</span>
<span class="lineNum">    5166 </span><span class="lineNoCov">          0 :                                 ti[cnt].selected = cnt==0;</span>
<span class="lineNum">    5167 </span>            :                             }
<span class="lineNum">    5168 </span><span class="lineNoCov">          0 :                             ++cnt;</span>
<span class="lineNum">    5169 </span>            :                         }
<span class="lineNum">    5170 </span>            :             }
<span class="lineNum">    5171 </span>            :         }
<span class="lineNum">    5172 </span><span class="lineNoCov">          0 :         if ( cnt==0 ) {</span>
<span class="lineNum">    5173 </span><span class="lineNoCov">          0 :             ff_post_notice(_(&quot;No Lookups&quot;), _(&quot;No applicable lookup subtables&quot;));</span>
<span class="lineNum">    5174 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5175 </span>            :         }
<span class="lineNum">    5176 </span><span class="lineNoCov">          0 :         if ( ti==NULL )</span>
<span class="lineNum">    5177 </span><span class="lineNoCov">          0 :             ti = calloc(cnt+1,sizeof(GTextInfo));</span>
<span class="lineNum">    5178 </span>            :     }
<span class="lineNum">    5179 </span>            : 
<span class="lineNum">    5180 </span><span class="lineNoCov">          0 :     CharInfoInit();</span>
<span class="lineNum">    5181 </span>            : 
<span class="lineNum">    5182 </span><span class="lineNoCov">          0 :     memset(&amp;sld,0,sizeof(sld));</span>
<span class="lineNum">    5183 </span><span class="lineNoCov">          0 :     sld.fv = fv;</span>
<span class="lineNum">    5184 </span><span class="lineNoCov">          0 :         memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    5185 </span><span class="lineNoCov">          0 :         wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_isdlg|wam_restrict;</span>
<span class="lineNum">    5186 </span><span class="lineNoCov">          0 :         wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">    5187 </span><span class="lineNoCov">          0 :         wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">    5188 </span><span class="lineNoCov">          0 :         wattrs.undercursor = 1;</span>
<span class="lineNum">    5189 </span><span class="lineNoCov">          0 :         wattrs.cursor = ct_pointer;</span>
<span class="lineNum">    5190 </span><span class="lineNoCov">          0 :         wattrs.utf8_window_title =  _(&quot;Select By Lookup Subtable&quot;);</span>
<span class="lineNum">    5191 </span><span class="lineNoCov">          0 :         wattrs.is_dlg = true;</span>
<span class="lineNum">    5192 </span><span class="lineNoCov">          0 :         pos.x = pos.y = 0;</span>
<span class="lineNum">    5193 </span><span class="lineNoCov">          0 :         pos.width = GGadgetScale(GDrawPointsToPixels(NULL,160));</span>
<span class="lineNum">    5194 </span><span class="lineNoCov">          0 :         pos.height = GDrawPointsToPixels(NULL,204);</span>
<span class="lineNum">    5195 </span><span class="lineNoCov">          0 :         gw = GDrawCreateTopWindow(NULL,&amp;pos,selpst_e_h,&amp;sld,&amp;wattrs);</span>
<span class="lineNum">    5196 </span>            : 
<span class="lineNum">    5197 </span><span class="lineNoCov">          0 :         memset(&amp;gcd,0,sizeof(gcd));</span>
<span class="lineNum">    5198 </span><span class="lineNoCov">          0 :         memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">    5199 </span>            : 
<span class="lineNum">    5200 </span><span class="lineNoCov">          0 :         i=j=0;</span>
<span class="lineNum">    5201 </span>            : 
<span class="lineNum">    5202 </span><span class="lineNoCov">          0 :         label[i].text = (unichar_t *) _(&quot;Select Glyphs in lookup subtable&quot;);</span>
<span class="lineNum">    5203 </span><span class="lineNoCov">          0 :         label[i].text_is_1byte = true;</span>
<span class="lineNum">    5204 </span><span class="lineNoCov">          0 :         gcd[i].gd.label = &amp;label[i];</span>
<span class="lineNum">    5205 </span><span class="lineNoCov">          0 :         gcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    5206 </span><span class="lineNoCov">          0 :         gcd[i++].creator = GLabelCreate;</span>
<span class="lineNum">    5207 </span><span class="lineNoCov">          0 :         varray[j++] = &amp;gcd[i-1]; varray[j++] = NULL;</span>
<span class="lineNum">    5208 </span>            : 
<span class="lineNum">    5209 </span><span class="lineNoCov">          0 :         gcd[i].gd.label = &amp;ti[0];</span>
<span class="lineNum">    5210 </span><span class="lineNoCov">          0 :         gcd[i].gd.pos.x = 10; gcd[i].gd.pos.y = 5+4;</span>
<span class="lineNum">    5211 </span><span class="lineNoCov">          0 :         gcd[i].gd.flags = gg_enabled|gg_visible/*|gg_list_exactlyone*/;</span>
<span class="lineNum">    5212 </span><span class="lineNoCov">          0 :         gcd[i].gd.u.list = ti;</span>
<span class="lineNum">    5213 </span><span class="lineNoCov">          0 :         gcd[i].gd.cid = CID_PST;</span>
<span class="lineNum">    5214 </span><span class="lineNoCov">          0 :         gcd[i++].creator = GListButtonCreate;</span>
<span class="lineNum">    5215 </span><span class="lineNoCov">          0 :         varray[j++] = &amp;gcd[i-1]; varray[j++] = NULL;</span>
<span class="lineNum">    5216 </span><span class="lineNoCov">          0 :         varray[j++] = GCD_Glue; varray[j++] = NULL;</span>
<span class="lineNum">    5217 </span>            : 
<span class="lineNum">    5218 </span><span class="lineNoCov">          0 :         label[i].text = (unichar_t *) _(&quot;Select Results&quot;);</span>
<span class="lineNum">    5219 </span><span class="lineNoCov">          0 :         label[i].text_is_1byte = true;</span>
<span class="lineNum">    5220 </span><span class="lineNoCov">          0 :         gcd[i].gd.label = &amp;label[i];</span>
<span class="lineNum">    5221 </span><span class="lineNoCov">          0 :         gcd[i].gd.pos.x = 5; gcd[i].gd.pos.y = gcd[i-1].gd.pos.y+26; </span>
<span class="lineNum">    5222 </span><span class="lineNoCov">          0 :         gcd[i].gd.flags = gg_enabled|gg_visible|gg_cb_on|gg_utf8_popup;</span>
<span class="lineNum">    5223 </span><span class="lineNoCov">          0 :         gcd[i].gd.popup_msg = (unichar_t *) _(&quot;Set the selection of the font view to the glyphs\nfound by this search&quot;);</span>
<span class="lineNum">    5224 </span><span class="lineNoCov">          0 :         gcd[i].gd.cid = CID_SelectResults;</span>
<span class="lineNum">    5225 </span><span class="lineNoCov">          0 :         gcd[i++].creator = GRadioCreate;</span>
<span class="lineNum">    5226 </span><span class="lineNoCov">          0 :         varray[j++] = &amp;gcd[i-1]; varray[j++] = NULL;</span>
<span class="lineNum">    5227 </span>            : 
<span class="lineNum">    5228 </span><span class="lineNoCov">          0 :         label[i].text = (unichar_t *) _(&quot;Merge Results&quot;);</span>
<span class="lineNum">    5229 </span><span class="lineNoCov">          0 :         label[i].text_is_1byte = true;</span>
<span class="lineNum">    5230 </span><span class="lineNoCov">          0 :         gcd[i].gd.label = &amp;label[i];</span>
<span class="lineNum">    5231 </span><span class="lineNoCov">          0 :         gcd[i].gd.pos.x = 5; gcd[i].gd.pos.y = gcd[i-1].gd.pos.y+15; </span>
<span class="lineNum">    5232 </span><span class="lineNoCov">          0 :         gcd[i].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    5233 </span><span class="lineNoCov">          0 :         gcd[i].gd.popup_msg = (unichar_t *) _(&quot;Expand the selection of the font view to include\nall the glyphs found by this search&quot;);</span>
<span class="lineNum">    5234 </span><span class="lineNoCov">          0 :         gcd[i].gd.cid = CID_MergeResults;</span>
<span class="lineNum">    5235 </span><span class="lineNoCov">          0 :         gcd[i++].creator = GRadioCreate;</span>
<span class="lineNum">    5236 </span><span class="lineNoCov">          0 :         varray[j++] = &amp;gcd[i-1]; varray[j++] = NULL;</span>
<span class="lineNum">    5237 </span>            : 
<span class="lineNum">    5238 </span><span class="lineNoCov">          0 :         label[i].text = (unichar_t *) _(&quot;Restrict Selection&quot;);</span>
<span class="lineNum">    5239 </span><span class="lineNoCov">          0 :         label[i].text_is_1byte = true;</span>
<span class="lineNum">    5240 </span><span class="lineNoCov">          0 :         gcd[i].gd.label = &amp;label[i];</span>
<span class="lineNum">    5241 </span><span class="lineNoCov">          0 :         gcd[i].gd.pos.x = 5; gcd[i].gd.pos.y = gcd[i-1].gd.pos.y+15; </span>
<span class="lineNum">    5242 </span><span class="lineNoCov">          0 :         gcd[i].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    5243 </span><span class="lineNoCov">          0 :         gcd[i].gd.popup_msg = (unichar_t *) _(&quot;Only search the selected glyphs, and unselect\nany characters which do not match this search&quot;);</span>
<span class="lineNum">    5244 </span><span class="lineNoCov">          0 :         gcd[i].gd.cid = CID_RestrictSelection;</span>
<span class="lineNum">    5245 </span><span class="lineNoCov">          0 :         gcd[i++].creator = GRadioCreate;</span>
<span class="lineNum">    5246 </span><span class="lineNoCov">          0 :         varray[j++] = &amp;gcd[i-1]; varray[j++] = NULL;</span>
<span class="lineNum">    5247 </span><span class="lineNoCov">          0 :         varray[j++] = GCD_Glue; varray[j++] = NULL;</span>
<span class="lineNum">    5248 </span>            : 
<span class="lineNum">    5249 </span><span class="lineNoCov">          0 :         gcd[i].gd.pos.x = 15-3; gcd[i].gd.pos.y = gcd[i-1].gd.pos.y+22;</span>
<span class="lineNum">    5250 </span><span class="lineNoCov">          0 :         gcd[i].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">    5251 </span><span class="lineNoCov">          0 :         label[i].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">    5252 </span><span class="lineNoCov">          0 :         label[i].text_is_1byte = true;</span>
<span class="lineNum">    5253 </span><span class="lineNoCov">          0 :         label[i].text_in_resource = true;</span>
<span class="lineNum">    5254 </span><span class="lineNoCov">          0 :         gcd[i].gd.mnemonic = 'O';</span>
<span class="lineNum">    5255 </span><span class="lineNoCov">          0 :         gcd[i].gd.label = &amp;label[i];</span>
<span class="lineNum">    5256 </span><span class="lineNoCov">          0 :         gcd[i].gd.cid = true;</span>
<span class="lineNum">    5257 </span><span class="lineNoCov">          0 :         gcd[i++].creator = GButtonCreate;</span>
<span class="lineNum">    5258 </span><span class="lineNoCov">          0 :         harray[0] = GCD_Glue; harray[1] = &amp;gcd[i-1]; harray[2] = GCD_Glue;</span>
<span class="lineNum">    5259 </span>            : 
<span class="lineNum">    5260 </span><span class="lineNoCov">          0 :         gcd[i].gd.pos.x = -15; gcd[i].gd.pos.y = gcd[i-1].gd.pos.y+3;</span>
<span class="lineNum">    5261 </span><span class="lineNoCov">          0 :         gcd[i].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">    5262 </span><span class="lineNoCov">          0 :         label[i].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    5263 </span><span class="lineNoCov">          0 :         label[i].text_is_1byte = true;</span>
<span class="lineNum">    5264 </span><span class="lineNoCov">          0 :         label[i].text_in_resource = true;</span>
<span class="lineNum">    5265 </span><span class="lineNoCov">          0 :         gcd[i].gd.label = &amp;label[i];</span>
<span class="lineNum">    5266 </span><span class="lineNoCov">          0 :         gcd[i].gd.mnemonic = 'C';</span>
<span class="lineNum">    5267 </span><span class="lineNoCov">          0 :         gcd[i].gd.cid = false;</span>
<span class="lineNum">    5268 </span><span class="lineNoCov">          0 :         gcd[i++].creator = GButtonCreate;</span>
<span class="lineNum">    5269 </span><span class="lineNoCov">          0 :         harray[3] = GCD_Glue; harray[4] = &amp;gcd[i-1]; harray[5] = GCD_Glue;</span>
<span class="lineNum">    5270 </span><span class="lineNoCov">          0 :         harray[6] = NULL;</span>
<span class="lineNum">    5271 </span>            : 
<span class="lineNum">    5272 </span><span class="lineNoCov">          0 :         gcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    5273 </span><span class="lineNoCov">          0 :         gcd[i].gd.u.boxelements = harray;</span>
<span class="lineNum">    5274 </span><span class="lineNoCov">          0 :         gcd[i].creator = GHBoxCreate;</span>
<span class="lineNum">    5275 </span><span class="lineNoCov">          0 :         varray[j++] = &amp;gcd[i++]; varray[j++] = NULL; varray[j++] = NULL;</span>
<span class="lineNum">    5276 </span>            : 
<span class="lineNum">    5277 </span><span class="lineNoCov">          0 :         gcd[i].gd.pos.x = gcd[i].gd.pos.y = 2;</span>
<span class="lineNum">    5278 </span><span class="lineNoCov">          0 :         gcd[i].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    5279 </span><span class="lineNoCov">          0 :         gcd[i].gd.u.boxelements = varray;</span>
<span class="lineNum">    5280 </span><span class="lineNoCov">          0 :         gcd[i].creator = GHVGroupCreate;</span>
<span class="lineNum">    5281 </span>            : 
<span class="lineNum">    5282 </span><span class="lineNoCov">          0 :         GGadgetsCreate(gw,gcd+i);</span>
<span class="lineNum">    5283 </span><span class="lineNoCov">          0 :         GTextInfoListFree(ti);</span>
<span class="lineNum">    5284 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(gcd[i].ret,gb_expandglue);</span>
<span class="lineNum">    5285 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(gcd[i-1].ret,gb_expandgluesame);</span>
<span class="lineNum">    5286 </span><span class="lineNoCov">          0 :         GHVBoxFitWindow(gcd[i].ret);</span>
<span class="lineNum">    5287 </span>            : 
<span class="lineNum">    5288 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<span class="lineNum">    5289 </span><span class="lineNoCov">          0 :     while ( !sld.done )</span>
<span class="lineNum">    5290 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">    5291 </span><span class="lineNoCov">          0 :     if ( sld.ok ) {</span>
<span class="lineNum">    5292 </span>            :     }
<span class="lineNum">    5293 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(gw);</span>
<a name="5294"><span class="lineNum">    5294 </span>            : }</a>
<span class="lineNum">    5295 </span>            : 
<span class="lineNum">    5296 </span><span class="lineNoCov">          0 : void CharInfoInit(void) {</span>
<span class="lineNum">    5297 </span>            :     static GTextInfo *lists[] = { glyphclasses, std_colors, truefalse, NULL };
<span class="lineNum">    5298 </span>            :     static int done = 0;
<span class="lineNum">    5299 </span>            :     int i, j;
<span class="lineNum">    5300 </span>            :     static char **cnames[] = { newstrings, NULL };
<span class="lineNum">    5301 </span>            :     static struct col_init *col_inits[] = { extensionpart, altuniinfo,
<span class="lineNum">    5302 </span>            :         devtabci,
<span class="lineNum">    5303 </span>            :         simplesubsci, ligatureci, altsubsci, multsubsci, simpleposci,
<span class="lineNum">    5304 </span>            :         pairposci, NULL };
<span class="lineNum">    5305 </span>            : 
<span class="lineNum">    5306 </span><span class="lineNoCov">          0 :     if ( done )</span>
<span class="lineNum">    5307 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5308 </span><span class="lineNoCov">          0 :     done = true;</span>
<span class="lineNum">    5309 </span><span class="lineNoCov">          0 :     for ( i=0; lists[i]!=NULL; ++i )</span>
<span class="lineNum">    5310 </span><span class="lineNoCov">          0 :         for ( j=0; lists[i][j].text!=NULL; ++j )</span>
<span class="lineNum">    5311 </span><span class="lineNoCov">          0 :             lists[i][j].text = (unichar_t *) S_((char *) lists[i][j].text);</span>
<span class="lineNum">    5312 </span><span class="lineNoCov">          0 :     for ( i=0; cnames[i]!=NULL; ++i )</span>
<span class="lineNum">    5313 </span><span class="lineNoCov">          0 :         for ( j=0; cnames[i][j]!=NULL; ++j )</span>
<span class="lineNum">    5314 </span><span class="lineNoCov">          0 :             cnames[i][j] = _(cnames[i][j]);</span>
<span class="lineNum">    5315 </span><span class="lineNoCov">          0 :     for ( i=0; col_inits[i]!=NULL; ++i )</span>
<span class="lineNum">    5316 </span><span class="lineNoCov">          0 :         for ( j=0; col_inits[i][j].title!=NULL; ++j )</span>
<span class="lineNum">    5317 </span><span class="lineNoCov">          0 :             col_inits[i][j].title=_(col_inits[i][j].title);</span>
<span class="lineNum">    5318 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
