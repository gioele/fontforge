<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd) - fontforgeexe/anchorsaway.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">fontforgeexe</a> - anchorsaway.c<span style="font-size: 80%;"> (source / <a href="anchorsaway.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd)</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">1000</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-08-04</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">36</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* Copyright (C) 2005-2012 by George Williams */</a>
<span class="lineNum">       2 </span>            : /*
<span class="lineNum">       3 </span>            :  * Redistribution and use in source and binary forms, with or without
<span class="lineNum">       4 </span>            :  * modification, are permitted provided that the following conditions are met:
<span class="lineNum">       5 </span>            : 
<span class="lineNum">       6 </span>            :  * Redistributions of source code must retain the above copyright notice, this
<span class="lineNum">       7 </span>            :  * list of conditions and the following disclaimer.
<span class="lineNum">       8 </span>            : 
<span class="lineNum">       9 </span>            :  * Redistributions in binary form must reproduce the above copyright notice,
<span class="lineNum">      10 </span>            :  * this list of conditions and the following disclaimer in the documentation
<span class="lineNum">      11 </span>            :  * and/or other materials provided with the distribution.
<span class="lineNum">      12 </span>            : 
<span class="lineNum">      13 </span>            :  * The name of the author may not be used to endorse or promote products
<span class="lineNum">      14 </span>            :  * derived from this software without specific prior written permission.
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            :  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
<span class="lineNum">      17 </span>            :  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
<span class="lineNum">      18 </span>            :  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
<span class="lineNum">      19 </span>            :  * EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span class="lineNum">      20 </span>            :  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
<span class="lineNum">      21 </span>            :  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
<span class="lineNum">      22 </span>            :  * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
<span class="lineNum">      23 </span>            :  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
<span class="lineNum">      24 </span>            :  * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
<span class="lineNum">      25 </span>            :  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span class="lineNum">      26 </span>            :  */
<span class="lineNum">      27 </span>            : #include &quot;fontforgeui.h&quot;
<span class="lineNum">      28 </span>            : #include &quot;fvfonts.h&quot;
<span class="lineNum">      29 </span>            : #include &quot;splinefill.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;splineutil.h&quot;
<span class="lineNum">      31 </span>            : #include &lt;gkeysym.h&gt;
<span class="lineNum">      32 </span>            : #include &lt;string.h&gt;
<span class="lineNum">      33 </span>            : #include &lt;ustring.h&gt;
<span class="lineNum">      34 </span>            : #include &lt;utype.h&gt;
<span class="lineNum">      35 </span>            : #include &lt;math.h&gt;
<span class="lineNum">      36 </span>            : 
<span class="lineNum">      37 </span>            : int aa_pixelsize = 150;
<span class="lineNum">      38 </span>            : 
<span class="lineNum">      39 </span>            : /* The dialog should contain a lig index !!!! */
<span class="lineNum">      40 </span>            : 
<span class="lineNum">      41 </span>            : struct apmatch {
<span class="lineNum">      42 </span>            :     SplineChar *sc;
<span class="lineNum">      43 </span>            :     AnchorPoint *ap;
<span class="lineNum">      44 </span>            :     BDFChar *bdfc;
<span class="lineNum">      45 </span>            :     int off;            /* a mark-to-mark display might have the same */
<span class="lineNum">      46 </span>            :     int size;           /* odd positioning problems as above */
<span class="lineNum">      47 </span>            :     int xstart;         /* This is scaled by factor, others are not */
<span class="lineNum">      48 </span>            : };
<span class="lineNum">      49 </span>            : 
<span class="lineNum">      50 </span>            : struct state {
<span class="lineNum">      51 </span>            :     SplineChar *sc;
<span class="lineNum">      52 </span>            :     int changed;
<span class="lineNum">      53 </span>            :     AnchorPoint *ap_pt;
<span class="lineNum">      54 </span>            :     AnchorPoint ap_vals;
<span class="lineNum">      55 </span>            :     struct state *next;
<span class="lineNum">      56 </span>            : };
<span class="lineNum">      57 </span>            : 
<span class="lineNum">      58 </span>            : typedef struct anchord {
<span class="lineNum">      59 </span>            :     GWindow gw;
<span class="lineNum">      60 </span>            :     int ctl_len;
<span class="lineNum">      61 </span>            :     GGadget *hsb;
<span class="lineNum">      62 </span>            :     int sb_base;
<span class="lineNum">      63 </span>            :     int sb_width;
<span class="lineNum">      64 </span>            :     int sb_height;
<span class="lineNum">      65 </span>            :     int full_width, full_height;
<span class="lineNum">      66 </span>            : 
<span class="lineNum">      67 </span>            :     SplineChar *sc;             /* This is the character whose anchor we are */
<span class="lineNum">      68 </span>            :     AnchorPoint *ap;            /*  interested in, and this is that anchor */
<span class="lineNum">      69 </span>            :     BasePoint apos;             /* Modified anchor position */
<span class="lineNum">      70 </span>            :     DeviceTable xadjust;        /* Modified adjustments */
<span class="lineNum">      71 </span>            :     DeviceTable yadjust;
<span class="lineNum">      72 </span>            :     BDFChar *bdfc;
<span class="lineNum">      73 </span>            :     int char_off;               /* Mark characters are often positioned oddly */
<span class="lineNum">      74 </span>            :     int char_size;              /*  and have zero advance widths, this corrects*/
<span class="lineNum">      75 </span>            :     int ymin, ymax;             /* For all combos */
<span class="lineNum">      76 </span>            : 
<span class="lineNum">      77 </span>            :     int pixelsize;
<span class="lineNum">      78 </span>            :     double scale;               /* Does not include mag factor */
<span class="lineNum">      79 </span>            :     int magfactor;
<span class="lineNum">      80 </span>            :     int baseline;
<span class="lineNum">      81 </span>            : 
<span class="lineNum">      82 </span>            :     int xoff;                   /* for scroll bar */
<span class="lineNum">      83 </span>            :     int xlen;                   /* sum of all the following lengths       */
<span class="lineNum">      84 </span>            :     int cnt;                    /* Number of anchors we join with         */
<span class="lineNum">      85 </span>            :         /* joining can happen in four ways:                               */
<span class="lineNum">      86 </span>            :         /*   we might be a base char, we see all the accents              */
<span class="lineNum">      87 </span>            :         /*      (all apmatches will be the same length (bdfc-&gt;width above)*/
<span class="lineNum">      88 </span>            :         /*   we might be a mark, we see all the bases (ligs may happen twice) */
<span class="lineNum">      89 </span>            :         /*      (each base provides the length)                           */
<span class="lineNum">      90 </span>            :         /*   we might be cursive entry, we see all the exits that attach  */
<span class="lineNum">      91 </span>            :         /*      (length is bdfc-&gt;width + apmatch-&gt;width                     */
<span class="lineNum">      92 </span>            :         /*      left to right/right to left is important here!            */
<span class="lineNum">      93 </span>            :         /*   we might be cursive exit, we see all the entries that attach */
<span class="lineNum">      94 </span>            :     struct apmatch *apmatch;
<span class="lineNum">      95 </span>            :     void *freetypecontext;
<span class="lineNum">      96 </span>            :     int combo, on_ap;
<span class="lineNum">      97 </span>            :     BasePoint orig_pos;
<span class="lineNum">      98 </span>            :     int done;
<span class="lineNum">      99 </span>            :     /* If they change more than one anchor, retain the original values so that */
<span class="lineNum">     100 </span>            :     /*  we can revert to them */
<span class="lineNum">     101 </span>            :     struct state *orig_vals;
<span class="lineNum">     102 </span>            :     int layer;
<span class="lineNum">     103 </span>            : } AnchorDlg;
<span class="lineNum">     104 </span>            : 
<span class="lineNum">     105 </span>            : #define CID_X           1001
<span class="lineNum">     106 </span>            : #define CID_Y           1002
<span class="lineNum">     107 </span>            : #define CID_XCor        1003
<span class="lineNum">     108 </span>            : #define CID_YCor        1004
<span class="lineNum">     109 </span>            : #define CID_DisplaySize 1005
<span class="lineNum">     110 </span>            : #define CID_Mag         1006
<span class="lineNum">     111 </span>            : #define CID_Glyph       1007
<span class="lineNum">     112 </span>            : 
<span class="lineNum">     113 </span>            : #define Add_Mark        (void *) (-1)
<a name="114"><span class="lineNum">     114 </span>            : #define Add_Base        (void *) (-3)</a>
<span class="lineNum">     115 </span>            : 
<span class="lineNum">     116 </span><span class="lineNoCov">          0 : static void AnchorD_FreeChar(AnchorDlg *a) {</span>
<span class="lineNum">     117 </span>            :     int i;
<span class="lineNum">     118 </span>            : 
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :     BDFCharFree(a-&gt;bdfc); a-&gt;bdfc = NULL;</span>
<span class="lineNum">     120 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;a-&gt;cnt; ++i )</span>
<span class="lineNum">     121 </span><span class="lineNoCov">          0 :         BDFCharFree(a-&gt;apmatch[i].bdfc);</span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :     free(a-&gt;apmatch); a-&gt;apmatch = NULL;</span>
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :     if ( a-&gt;freetypecontext!=NULL ) {</span>
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :         FreeTypeFreeContext(a-&gt;freetypecontext);</span>
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :         a-&gt;freetypecontext = NULL;</span>
<span class="lineNum">     126 </span>            :     }
<a name="127"><span class="lineNum">     127 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     128 </span>            : 
<span class="lineNum">     129 </span><span class="lineNoCov">          0 : static void AnchorD_FreeAll(AnchorDlg *a) {</span>
<span class="lineNum">     130 </span>            :     struct state *old, *oldnext;
<span class="lineNum">     131 </span>            : 
<span class="lineNum">     132 </span><span class="lineNoCov">          0 :     free(a-&gt;xadjust.corrections);</span>
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :     free(a-&gt;yadjust.corrections);</span>
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :     for ( old = a-&gt;orig_vals; old!=NULL; old=oldnext ) {</span>
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :         oldnext = old-&gt;next;</span>
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :         chunkfree(old,sizeof(struct state));</span>
<span class="lineNum">     137 </span>            :     }
<span class="lineNum">     138 </span><span class="lineNoCov">          0 :     AnchorD_FreeChar(a);</span>
<a name="139"><span class="lineNum">     139 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     140 </span>            : 
<span class="lineNum">     141 </span><span class="lineNoCov">          0 : static GTextInfo **AnchorD_GlyphsInClass(AnchorDlg *a) {</span>
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :     SplineFont *_sf = a-&gt;sc-&gt;parent, *sf;</span>
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :     AnchorClass *ac = a-&gt;ap-&gt;anchor;</span>
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :     int bcnt, mcnt, btot=0, j, k, gid;</span>
<span class="lineNum">     145 </span>            :     GTextInfo **ti;
<span class="lineNum">     146 </span>            :     AnchorPoint *ap;
<span class="lineNum">     147 </span>            : 
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :     if ( _sf-&gt;cidmaster!=NULL )</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :         _sf = _sf-&gt;cidmaster;</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :     for ( j=0; j&lt;2; ++j ) {</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :         k = 0;</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :         bcnt = mcnt = 1;        /* Reserve two spots for labels (marks vs base glyphs) */</span>
<span class="lineNum">     153 </span>            :         do {
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :             sf = _sf-&gt;subfontcnt==0 ? _sf : _sf-&gt;subfonts[k];</span>
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :             for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( sf-&gt;glyphs[gid]!=NULL ) {</span>
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :                 for ( ap= sf-&gt;glyphs[gid]-&gt;anchor; ap!=NULL; ap=ap-&gt;next ) {</span>
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :                     if ( ap-&gt;anchor == ac ) {</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :                         if ( ap-&gt;type==at_mark || ap-&gt;type == at_centry ) {</span>
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :                             if ( j ) {</span>
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :                                 ti[btot+1+mcnt] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :                                 ti[btot+1+mcnt]-&gt;text = utf82u_copy(sf-&gt;glyphs[gid]-&gt;name);</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :                                 ti[btot+1+mcnt]-&gt;fg = ti[btot+1+mcnt]-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :                                 ti[btot+1+mcnt]-&gt;userdata = ap;</span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :                                 ti[btot+1+mcnt]-&gt;selected = a-&gt;ap == ap;</span>
<span class="lineNum">     165 </span>            :                             }
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :                             ++mcnt;</span>
<span class="lineNum">     167 </span>            :                         } else {
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :                             if ( j ) {</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :                                 ti[bcnt] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :                                 ti[bcnt]-&gt;text = utf82u_copy(sf-&gt;glyphs[gid]-&gt;name);</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :                                 ti[bcnt]-&gt;fg = ti[bcnt]-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :                                 ti[bcnt]-&gt;userdata = ap;</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :                                 ti[bcnt]-&gt;selected = a-&gt;ap == ap;</span>
<span class="lineNum">     174 </span>            :                             }
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :                             ++bcnt;</span>
<span class="lineNum">     176 </span>            :                         }
<span class="lineNum">     177 </span>            :                     }
<span class="lineNum">     178 </span>            :                 }
<span class="lineNum">     179 </span>            :             }
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :             ++k;</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :         } while ( k&lt;_sf-&gt;subfontcnt );</span>
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :         if ( !j ) {</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :             btot = bcnt;</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :             ti = calloc(bcnt+mcnt+5,sizeof(GTextInfo*));</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :             ti[0] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :             ti[0]-&gt;text = utf82u_copy(ac-&gt;type==act_curs ? _(&quot;Exits&quot;) : _(&quot;Bases&quot;));</span>
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :             ti[0]-&gt;fg = ti[0]-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :             ti[0]-&gt;disabled = true;</span>
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :             ti[btot] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :             ti[btot]-&gt;line = true;</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :             ti[btot]-&gt;fg = ti[btot]-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :             ti[btot+1] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :             ti[btot+1]-&gt;text = utf82u_copy(ac-&gt;type==act_curs ? _(&quot;Entries&quot;) : _(&quot;Marks&quot;));</span>
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :             ti[btot+1]-&gt;fg = ti[btot+1]-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :             ti[btot+1]-&gt;disabled = true;</span>
<span class="lineNum">     196 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+1] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+1]-&gt;line = true;</span>
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+1]-&gt;fg = ti[btot+mcnt+1]-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+2] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+2]-&gt;text = utf82u_copy(ac-&gt;type==act_curs ? _(&quot;Add Exit Anchor...&quot;) : _(&quot;Add Base Anchor...&quot;));</span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+2]-&gt;fg = ti[btot+mcnt+2]-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+2]-&gt;userdata = Add_Base;</span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+3] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+3]-&gt;text = utf82u_copy(ac-&gt;type==act_curs ? _(&quot;Add Entry Anchor...&quot;) : _(&quot;Add Mark Anchor...&quot;));</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+3]-&gt;fg = ti[btot+mcnt+3]-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+3]-&gt;userdata = Add_Mark;</span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :             ti[btot+mcnt+4] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     208 </span>            :         }
<span class="lineNum">     209 </span>            :     }
<span class="lineNum">     210 </span><span class="lineNoCov">          0 : return( ti );</span>
<a name="211"><span class="lineNum">     211 </span>            : }</a>
<span class="lineNum">     212 </span>            : 
<span class="lineNum">     213 </span><span class="lineNoCov">          0 : static void AnchorD_SetTitle(AnchorDlg *a) {</span>
<span class="lineNum">     214 </span>            :     char buffer[300];
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :     snprintf(buffer,sizeof(buffer),_(&quot;Anchor Control for class %.100s in glyph %.100s as %.20s&quot;),</span>
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :             a-&gt;ap-&gt;anchor-&gt;name, a-&gt;sc-&gt;name,</span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :             a-&gt;ap-&gt;type == at_mark ? _(&quot;mark&quot;) :</span>
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :             a-&gt;ap-&gt;type == at_centry ? _(&quot;cursive entry&quot;) :</span>
<span class="lineNum">     219 </span><span class="lineNoCov">          0 :             a-&gt;ap-&gt;type == at_cexit ? _(&quot;cursive exit&quot;) :</span>
<span class="lineNum">     220 </span>            :                 _(&quot;base&quot;) );
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :     GDrawSetWindowTitles8(a-&gt;gw,buffer,_(&quot;Anchor Control&quot;));</span>
<a name="222"><span class="lineNum">     222 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     223 </span>            :     
<span class="lineNum">     224 </span><span class="lineNoCov">          0 : static void AnchorD_FindComplements(AnchorDlg *a) {</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :     AnchorClass *ac = a-&gt;ap-&gt;anchor;</span>
<span class="lineNum">     226 </span>            :     enum anchor_type match;
<span class="lineNum">     227 </span>            :     AnchorPoint *ap;
<span class="lineNum">     228 </span>            :     int i, k, j, cnt;
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :     SplineFont *_sf = a-&gt;sc-&gt;parent, *sf;</span>
<span class="lineNum">     230 </span>            :     uint8 *sel, *oldsel;
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :     FontView *fv = (FontView *) _sf-&gt;fv;</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :     EncMap *map = fv-&gt;b.map;</span>
<span class="lineNum">     233 </span>            : 
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :     switch ( a-&gt;ap-&gt;type ) {</span>
<span class="lineNum">     235 </span>            :       case at_mark:
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :         switch ( a-&gt;ap-&gt;anchor-&gt;type ) {</span>
<span class="lineNum">     237 </span>            :           case act_mark:
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :             match = at_basechar;</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     240 </span>            :           case act_mklg:
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :             match = at_baselig;</span>
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     243 </span>            :           case act_mkmk:
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :             match = at_basemark;</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     246 </span>            :           default:
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :             IError( &quot;Unexpected anchor class type&quot; );</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :             match = at_basechar;</span>
<span class="lineNum">     249 </span>            :         }
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     251 </span>            :       case at_basechar: case at_baselig: case at_basemark:
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :         match = at_mark;</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     254 </span>            :       case at_centry:
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :         match = at_cexit;</span>
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     257 </span>            :       case at_cexit:
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :         match = at_centry;</span>
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     260 </span>            :       default:
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :         match = at_max;</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     263 </span>            :     }
<span class="lineNum">     264 </span>            : 
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :     if ( _sf-&gt;cidmaster!=NULL )</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :         _sf = _sf-&gt;cidmaster;</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :     for ( j=0; j&lt;2; ++j ) {</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :         k = cnt = 0;</span>
<span class="lineNum">     269 </span>            :         do {
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :             sf = _sf-&gt;subfontcnt==0 ? _sf : _sf-&gt;subfonts[k];</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;sf-&gt;glyphcnt; ++i ) if ( sf-&gt;glyphs[i]!=NULL ) {</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :                 for ( ap= sf-&gt;glyphs[i]-&gt;anchor; ap!=NULL; ap=ap-&gt;next ) {</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :                     if ( ap-&gt;anchor == ac &amp;&amp; ap-&gt;type==match ) {</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :                         if ( j ) {</span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :                             a-&gt;apmatch[cnt].ap = ap;</span>
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :                             a-&gt;apmatch[cnt++].sc = sf-&gt;glyphs[i];</span>
<span class="lineNum">     277 </span>            :                         } else
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :                             ++cnt;</span>
<span class="lineNum">     279 </span>            :                         /* Don't break out of the loop as ligatures can have multiple locations */
<span class="lineNum">     280 </span>            :                     }
<span class="lineNum">     281 </span>            :                 }
<span class="lineNum">     282 </span>            :             }
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :             ++k;</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :         } while ( k&lt;_sf-&gt;subfontcnt );</span>
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :         a-&gt;cnt = cnt;</span>
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :         if ( cnt==0 )</span>
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :         if ( j==0 )</span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :             a-&gt;apmatch = calloc(cnt,sizeof(struct apmatch));</span>
<span class="lineNum">     290 </span>            :     }
<span class="lineNum">     291 </span>            : 
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :     if ( hasFreeType() &amp;&amp; _sf-&gt;subfontcnt==0 ) {</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :         int enc = map-&gt;backmap[a-&gt;sc-&gt;orig_pos];</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :         if ( enc!=-1 ) {</span>
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :             sel = calloc(map-&gt;enccount,1);</span>
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :             sel[enc] = true;</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;sf-&gt;glyphcnt; ++i ) if ( sf-&gt;glyphs[i]!=NULL ) {</span>
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :                 enc = map-&gt;backmap[i];</span>
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :                 if ( enc!=-1 ) {</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :                     for ( ap= sf-&gt;glyphs[i]-&gt;anchor; ap!=NULL; ap=ap-&gt;next ) {</span>
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :                         if ( ap-&gt;anchor == ac &amp;&amp; ap-&gt;type==match ) {</span>
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :                             sel[enc] = true;</span>
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :                     break;</span>
<span class="lineNum">     304 </span>            :                         }
<span class="lineNum">     305 </span>            :                     }
<span class="lineNum">     306 </span>            :                 }
<span class="lineNum">     307 </span>            :             }
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :             oldsel = fv-&gt;b.selected;</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :             fv-&gt;b.selected = sel;</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :             a-&gt;freetypecontext = FreeTypeFontContext(_sf,NULL,(FontViewBase *) fv,a-&gt;layer);</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :             fv-&gt;b.selected = oldsel;</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :             free(sel);</span>
<span class="lineNum">     313 </span>            :         }
<span class="lineNum">     314 </span>            :     }
<a name="315"><span class="lineNum">     315 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     316 </span>            : 
<span class="lineNum">     317 </span><span class="lineNoCov">          0 : static BDFChar *APRasterize(void *freetypecontext, SplineChar *sc,int layer, int *off,int *size,int pixelsize) {</span>
<span class="lineNum">     318 </span>            :     BDFChar *bdfc;
<span class="lineNum">     319 </span>            : 
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :     if ( freetypecontext ) {</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :         bdfc = SplineCharFreeTypeRasterize(freetypecontext,sc-&gt;orig_pos,pixelsize,72,8);</span>
<span class="lineNum">     322 </span>            :     } else
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :         bdfc = SplineCharAntiAlias(sc,layer,pixelsize,4);</span>
<span class="lineNum">     324 </span>            : 
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :     if ( bdfc-&gt;xmin&lt;=0 ) {</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :         *off = 1-bdfc-&gt;xmin;</span>
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :         if ( bdfc-&gt;width&gt;bdfc-&gt;xmax-bdfc-&gt;xmin )</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :             *size = bdfc-&gt;width;</span>
<span class="lineNum">     329 </span>            :         else
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :             *size = bdfc-&gt;xmax + *off;</span>
<span class="lineNum">     331 </span>            :     } else {
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :         *off = 0;</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :         if ( bdfc-&gt;width&gt;bdfc-&gt;xmax )</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :             *size = bdfc-&gt;width;</span>
<span class="lineNum">     335 </span>            :         else
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :             *size = bdfc-&gt;xmax + 1;</span>
<span class="lineNum">     337 </span>            :     }
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :     ++*size;</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 : return( bdfc );</span>
<a name="340"><span class="lineNum">     340 </span>            : }</a>
<span class="lineNum">     341 </span>            : 
<span class="lineNum">     342 </span><span class="lineNoCov">          0 : static void AnchorD_SetSB(AnchorDlg *a) {</span>
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :     GScrollBarSetBounds(a-&gt;hsb,0,a-&gt;xlen,a-&gt;sb_width);</span>
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :     if ( a-&gt;xoff+a-&gt;sb_width &gt; a-&gt;xlen )</span>
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :         a-&gt;xoff = a-&gt;xlen - a-&gt;sb_width;</span>
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :     if ( a-&gt;xoff&lt;0 ) a-&gt;xoff = 0;</span>
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :     GScrollBarSetPos(a-&gt;hsb,a-&gt;xoff);</span>
<a name="348"><span class="lineNum">     348 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     349 </span>            : 
<span class="lineNum">     350 </span><span class="lineNoCov">          0 : static void AnchorD_Resize(AnchorDlg *a) {</span>
<span class="lineNum">     351 </span>            :     GRect size;
<span class="lineNum">     352 </span>            :     int i, extra;
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :     int factor = a-&gt;magfactor;</span>
<span class="lineNum">     354 </span>            : 
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :     GDrawGetSize(a-&gt;gw,&amp;size);</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :     a-&gt;full_width = size.width;</span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :     a-&gt;full_height = size.height;</span>
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :     a-&gt;sb_base = a-&gt;full_height - a-&gt;sb_height;</span>
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :     if ( a-&gt;ctl_len+a-&gt;magfactor*a-&gt;char_size + 20 &lt; a-&gt;full_width ) {</span>
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :         a-&gt;sb_width = a-&gt;full_width - (a-&gt;ctl_len+a-&gt;magfactor*a-&gt;char_size);</span>
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :         GGadgetResize(a-&gt;hsb,a-&gt;sb_width, a-&gt;sb_height);</span>
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :         GGadgetMove(a-&gt;hsb,a-&gt;ctl_len+a-&gt;magfactor*a-&gt;char_size,a-&gt;sb_base);</span>
<span class="lineNum">     363 </span>            :     }
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :     AnchorD_SetSB(a);</span>
<span class="lineNum">     365 </span>            : 
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;a-&gt;cnt; ++i ) {</span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :         if ( i==0 )</span>
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :             a-&gt;apmatch[i].xstart = a-&gt;ctl_len+a-&gt;char_size*factor;</span>
<span class="lineNum">     369 </span>            :         else
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :             a-&gt;apmatch[i].xstart = a-&gt;apmatch[i-1].xstart +</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :                                     a-&gt;apmatch[i-1].size*factor;</span>
<span class="lineNum">     372 </span>            :     }
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :     if ( i==0 )</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :         a-&gt;xlen = 0;</span>
<span class="lineNum">     375 </span>            :     else
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :         a-&gt;xlen = a-&gt;apmatch[i-1].xstart - a-&gt;apmatch[0].xstart +</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :                 a-&gt;apmatch[i-1].size*factor;</span>
<span class="lineNum">     378 </span>            : 
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :     if ( a-&gt;ymin&gt;0 &amp;&amp; a-&gt;sb_base- a-&gt;ymax*factor &gt;=0 )</span>
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :         extra = (a-&gt;sb_base - a-&gt;ymax*factor)/2;</span>
<span class="lineNum">     381 </span>            :     else
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :         extra = (a-&gt;sb_base - (a-&gt;ymax-a-&gt;ymin)*factor)/2;</span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :     a-&gt;baseline = a-&gt;ymax*factor + extra;</span>
<span class="lineNum">     384 </span>            : 
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(a-&gt;gw,NULL,false);</span>
<a name="386"><span class="lineNum">     386 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     387 </span>            : 
<span class="lineNum">     388 </span><span class="lineNoCov">          0 : static void AnchorD_ChangeMag(AnchorDlg *a) {</span>
<span class="lineNum">     389 </span>            : 
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :     AnchorD_Resize(a);</span>
<a name="391"><span class="lineNum">     391 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     392 </span>            : 
<span class="lineNum">     393 </span><span class="lineNoCov">          0 : static void AnchorD_ChangeSize(AnchorDlg *a) {</span>
<span class="lineNum">     394 </span>            :     int i, off;
<span class="lineNum">     395 </span>            : 
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :     GDrawSetCursor(a-&gt;gw,ct_watch);</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :     GDrawSync(NULL);</span>
<span class="lineNum">     398 </span>            :     /* GDrawProcessPendingEvents(NULL); */ /* Any expose events on the current dlg will cause a crash as there are no bdfc's now */
<span class="lineNum">     399 </span>            : 
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :     a-&gt;scale = a-&gt;pixelsize / (double) (a-&gt;sc-&gt;parent-&gt;ascent + a-&gt;sc-&gt;parent-&gt;descent);</span>
<span class="lineNum">     401 </span>            : 
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :     BDFCharFree(a-&gt;bdfc);</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :     a-&gt;bdfc = APRasterize(a-&gt;freetypecontext,a-&gt;sc,a-&gt;layer,&amp;a-&gt;char_off,&amp;a-&gt;char_size,a-&gt;pixelsize);</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :     a-&gt;ymin = a-&gt;bdfc-&gt;ymin; a-&gt;ymax = a-&gt;bdfc-&gt;ymax;</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;a-&gt;cnt; ++i ) {</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :         BDFCharFree(a-&gt;apmatch[i].bdfc);</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :         a-&gt;apmatch[i].bdfc = APRasterize(a-&gt;freetypecontext,a-&gt;apmatch[i].sc,a-&gt;layer,&amp;a-&gt;apmatch[i].off,&amp;a-&gt;apmatch[i].size,a-&gt;pixelsize);</span>
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :         if ( a-&gt;ap-&gt;type==at_centry || a-&gt;ap-&gt;type==at_cexit )</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :             a-&gt;apmatch[i].size += a-&gt;char_size;</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :         else if ( a-&gt;ap-&gt;type!=at_mark )</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :             a-&gt;apmatch[i].size = a-&gt;char_size;</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :         switch ( a-&gt;ap-&gt;type ) {</span>
<span class="lineNum">     413 </span>            :           case at_cexit:
<span class="lineNum">     414 </span>            :           case at_basechar: case at_baselig: case at_basemark:
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :             off = rint((-a-&gt;apos.y + a-&gt;apmatch[i].ap-&gt;me.y)*a-&gt;scale);</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :             if ( a-&gt;apmatch[i].bdfc-&gt;ymax+off &gt; a-&gt;ymax )</span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :                 a-&gt;ymax = a-&gt;apmatch[i].bdfc-&gt;ymax+off;</span>
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :             if ( a-&gt;apmatch[i].bdfc-&gt;ymin+off &lt; a-&gt;ymin )</span>
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :                 a-&gt;ymin = a-&gt;apmatch[i].bdfc-&gt;ymin+off;</span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     421 </span>            :           case at_centry:
<span class="lineNum">     422 </span>            :           case at_mark:
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :             if ( a-&gt;apmatch[i].bdfc-&gt;ymax &gt; a-&gt;ymax )</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :                 a-&gt;ymax = a-&gt;apmatch[i].bdfc-&gt;ymax;</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :             if ( a-&gt;apmatch[i].bdfc-&gt;ymin &lt; a-&gt;ymin )</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :                 a-&gt;ymin = a-&gt;apmatch[i].bdfc-&gt;ymin;</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :             off = rint((-a-&gt;apmatch[i].ap-&gt;me.y + a-&gt;apos.y)*a-&gt;scale);</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :             if ( a-&gt;bdfc-&gt;ymax+off &gt; a-&gt;ymax )</span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :                 a-&gt;ymax = a-&gt;bdfc-&gt;ymax+off;</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :             if ( a-&gt;bdfc-&gt;ymin+off &lt; a-&gt;ymin )</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :                 a-&gt;ymin = a-&gt;bdfc-&gt;ymin+off;</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     433 </span>            :         }
<span class="lineNum">     434 </span>            :     }
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :     AnchorD_ChangeMag(a);</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :     GDrawSetCursor(a-&gt;gw,ct_pointer);</span>
<a name="437"><span class="lineNum">     437 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     438 </span>            : 
<span class="lineNum">     439 </span><span class="lineNoCov">          0 : static int DevTabFind(DeviceTable *adjust,int pixelsize) {</span>
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :     if ( adjust==NULL || adjust-&gt;corrections==NULL ||</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :             pixelsize&lt;adjust-&gt;first_pixel_size ||</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :             pixelsize&gt;adjust-&gt;last_pixel_size )</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 : return( 0 );</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 : return( adjust-&gt;corrections[pixelsize-adjust-&gt;first_pixel_size]);</span>
<a name="445"><span class="lineNum">     445 </span>            : }</a>
<span class="lineNum">     446 </span>            : 
<span class="lineNum">     447 </span><span class="lineNoCov">          0 : static void AnchorD_Expose(AnchorDlg *a,GWindow pixmap,GEvent *event) {</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :     GRect *area = &amp;event-&gt;u.expose.rect;</span>
<span class="lineNum">     449 </span>            :     GRect clip, old1, old2;
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :     int expose_end = area-&gt;x+area-&gt;width;</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :     int factor = a-&gt;magfactor;</span>
<span class="lineNum">     452 </span>            :     int i,x,y;
<span class="lineNum">     453 </span>            : 
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :     if ( expose_end&lt;a-&gt;ctl_len )</span>
<span class="lineNum">     455 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     456 </span>            : 
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :     GDrawPushClip(pixmap,area,&amp;old1);</span>
<span class="lineNum">     458 </span>            : 
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :     if ( area-&gt;x&lt;a-&gt;ctl_len+a-&gt;char_size*factor ) {</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :         GDrawDrawLine(pixmap,a-&gt;ctl_len,0,a-&gt;ctl_len,a-&gt;full_height,0x000000);</span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :         KCD_DrawGlyph(pixmap,a-&gt;char_off*factor+a-&gt;ctl_len,a-&gt;baseline,a-&gt;bdfc,factor);</span>
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :         DrawAnchorPoint(pixmap,</span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :             a-&gt;char_off*factor+a-&gt;ctl_len + ((int) rint(a-&gt;apos.x*a-&gt;scale))*factor,</span>
<span class="lineNum">     464 </span><span class="lineNoCov">          0 :             a-&gt;baseline - ((int) rint(a-&gt;apos.y*a-&gt;scale))*factor,</span>
<span class="lineNum">     465 </span>            :             false);
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :         GDrawDrawLine(pixmap,a-&gt;ctl_len+a-&gt;char_size*factor,0,a-&gt;ctl_len+a-&gt;char_size*factor,a-&gt;full_height,0x000000);</span>
<span class="lineNum">     467 </span>            :     }
<span class="lineNum">     468 </span>            : 
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :     if ( expose_end&gt;a-&gt;ctl_len+a-&gt;char_size &amp;&amp; area-&gt;y&lt;a-&gt;sb_base ) {</span>
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :         int xcor=0, ycor=0;</span>
<span class="lineNum">     471 </span>            :         unichar_t *end;
<span class="lineNum">     472 </span>            :         const unichar_t *ret;
<span class="lineNum">     473 </span>            : 
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :         ret = _GGadgetGetTitle(GWidgetGetControl(a-&gt;gw,CID_XCor));</span>
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :         xcor = u_strtol(ret,&amp;end,10);</span>
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :         while ( *end==' ' ) ++end;</span>
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :         if ( *end!='\0' || xcor&lt;-128 || xcor&gt;127 )</span>
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :             xcor = 0;</span>
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :         ret = _GGadgetGetTitle(GWidgetGetControl(a-&gt;gw,CID_YCor));</span>
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :         ycor = u_strtol(ret,&amp;end,10);</span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :         while ( *end==' ' ) ++end;</span>
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :         if ( *end!='\0' || ycor&lt;-128 || ycor&gt;127 )</span>
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :             ycor = 0;</span>
<span class="lineNum">     484 </span>            : 
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :         clip = *area;</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :         if ( area-&gt;x&lt;=a-&gt;ctl_len+a-&gt;char_size ) {</span>
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :             clip.width -= a-&gt;ctl_len+a-&gt;char_size+1 - area-&gt;x;</span>
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :             clip.x = a-&gt;ctl_len+a-&gt;char_size+1;</span>
<span class="lineNum">     489 </span>            :         }
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :         if ( area-&gt;y+area-&gt;height &gt; a-&gt;sb_base )</span>
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :             clip.height = a-&gt;sb_base-area-&gt;y;</span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :         GDrawPushClip(pixmap,&amp;clip,&amp;old2);</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;a-&gt;cnt; ++i ) {</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :             if ( a-&gt;apmatch[i].xstart - a-&gt;xoff &gt; clip.x+clip.width )</span>
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :             if ( a-&gt;apmatch[i].xstart+a-&gt;apmatch[i].size*factor - a-&gt;xoff &lt; clip.x )</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">     498 </span>            : 
<span class="lineNum">     499 </span><span class="lineNoCov">          0 :             y = a-&gt;baseline;</span>
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :             if ( i!=0 )</span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,a-&gt;apmatch[i].xstart-a-&gt;xoff,0,</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :                         a-&gt;apmatch[i].xstart-a-&gt;xoff,a-&gt;sb_base,0x808080);</span>
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :             if ( a-&gt;ap-&gt;type==at_cexit ||</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :                     a-&gt;ap-&gt;type==at_basechar || a-&gt;ap-&gt;type==at_baselig ||</span>
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :                     a-&gt;ap-&gt;type==at_basemark ) {</span>
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :                 x = a-&gt;apmatch[i].xstart+a-&gt;char_off*factor - a-&gt;xoff;</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :                 KCD_DrawGlyph(pixmap,x,y,a-&gt;bdfc,factor);</span>
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :                 x += ((int) rint((-a-&gt;apmatch[i].ap-&gt;me.x + a-&gt;apos.x)*a-&gt;scale) +</span>
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :                         xcor - DevTabFind(&amp;a-&gt;apmatch[i].ap-&gt;xadjust,a-&gt;pixelsize))*factor;</span>
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :                 y += ((int) rint((a-&gt;apmatch[i].ap-&gt;me.y - a-&gt;apos.y)*a-&gt;scale) +</span>
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :                         -ycor + DevTabFind(&amp;a-&gt;apmatch[i].ap-&gt;yadjust,a-&gt;pixelsize))*factor;</span>
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :                 KCD_DrawGlyph(pixmap,x,y,a-&gt;apmatch[i].bdfc,factor);</span>
<span class="lineNum">     513 </span>            :             } else {
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :                 x = a-&gt;apmatch[i].xstart+a-&gt;apmatch[i].off*factor - a-&gt;xoff;</span>
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :                 KCD_DrawGlyph(pixmap,x,y,a-&gt;apmatch[i].bdfc,factor);</span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :                 x += ((int) rint((a-&gt;apmatch[i].ap-&gt;me.x - a-&gt;apos.x)*a-&gt;scale) +</span>
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :                         DevTabFind(&amp;a-&gt;apmatch[i].ap-&gt;xadjust,a-&gt;pixelsize)-xcor)*factor;</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :                 y += ((int) rint((-a-&gt;apmatch[i].ap-&gt;me.y + a-&gt;apos.y)*a-&gt;scale) +</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :                         -DevTabFind(&amp;a-&gt;apmatch[i].ap-&gt;yadjust,a-&gt;pixelsize)+ycor)*factor;</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :                 KCD_DrawGlyph(pixmap,x,y,a-&gt;bdfc,factor);</span>
<span class="lineNum">     521 </span>            :             }
<span class="lineNum">     522 </span>            :         }
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :         if ( i&gt;0 )</span>
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :             GDrawDrawLine(pixmap,a-&gt;apmatch[i-1].xstart+a-&gt;apmatch[i-1].size*factor-a-&gt;xoff,0,</span>
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :                     a-&gt;apmatch[i-1].xstart+a-&gt;apmatch[i-1].size*factor-a-&gt;xoff,a-&gt;sb_base,0x808080);</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :         GDrawPopClip(pixmap,&amp;old2);</span>
<span class="lineNum">     527 </span>            :     }
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :     GDrawPopClip(pixmap,&amp;old1);</span>
<a name="529"><span class="lineNum">     529 </span>            : }</a>
<span class="lineNum">     530 </span>            : 
<span class="lineNum">     531 </span><span class="lineNoCov">          0 : static void AnchorD_FigurePos(AnchorDlg *a,GEvent *event) {</span>
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :     int x = (event-&gt;u.mouse.x - a-&gt;ctl_len)/a-&gt;magfactor;</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :     int y = (a-&gt;baseline - event-&gt;u.mouse.y)/a-&gt;magfactor;</span>
<span class="lineNum">     534 </span>            : 
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :     a-&gt;apos.x = rint((x-a-&gt;char_off)/a-&gt;scale);</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :     a-&gt;apos.y = rint(y/a-&gt;scale);</span>
<a name="537"><span class="lineNum">     537 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     538 </span>            : 
<span class="lineNum">     539 </span><span class="lineNoCov">          0 : static void AnchorD_ClearCorrections(AnchorDlg *a) {</span>
<span class="lineNum">     540 </span>            :     unichar_t ubuf[2];
<span class="lineNum">     541 </span>            : 
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :     ubuf[0] = '0'; ubuf[1] = '\0';</span>
<span class="lineNum">     543 </span><span class="lineNoCov">          0 :     free(a-&gt;xadjust.corrections); memset(&amp;a-&gt;xadjust,0,sizeof(DeviceTable));</span>
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :     free(a-&gt;yadjust.corrections); memset(&amp;a-&gt;yadjust,0,sizeof(DeviceTable));</span>
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :     GGadgetSetTitle(GWidgetGetControl(a-&gt;gw,CID_XCor),ubuf);</span>
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :     GGadgetSetTitle(GWidgetGetControl(a-&gt;gw,CID_YCor),ubuf);</span>
<a name="547"><span class="lineNum">     547 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     548 </span>            : 
<span class="lineNum">     549 </span><span class="lineNoCov">          0 : static void AnchorD_DrawPos(AnchorDlg *a) {</span>
<span class="lineNum">     550 </span>            :     GRect r;
<span class="lineNum">     551 </span>            :     char buffer[20];
<span class="lineNum">     552 </span>            :     unichar_t ubuf[20];
<span class="lineNum">     553 </span>            : 
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :     sprintf( buffer, &quot;%g&quot;, (double) a-&gt;apos.x );</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :     uc_strcpy(ubuf,buffer);</span>
<span class="lineNum">     556 </span><span class="lineNoCov">          0 :     GGadgetSetTitle(GWidgetGetControl(a-&gt;gw,CID_X),ubuf);</span>
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :     sprintf( buffer, &quot;%g&quot;, (double) a-&gt;apos.y );</span>
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :     uc_strcpy(ubuf,buffer);</span>
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :     GGadgetSetTitle(GWidgetGetControl(a-&gt;gw,CID_Y),ubuf);</span>
<span class="lineNum">     560 </span>            : 
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :     r.x = a-&gt;ctl_len;</span>
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :     r.y = 0;</span>
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :     r.width = a-&gt;char_size*a-&gt;magfactor;</span>
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :     r.height = a-&gt;full_height;</span>
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(a-&gt;gw,&amp;r,false);</span>
<a name="566"><span class="lineNum">     566 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     567 </span>            : 
<span class="lineNum">     568 </span><span class="lineNoCov">          0 : static void AnchorD_SelectGlyph(AnchorDlg *a, AnchorPoint *ap) {</span>
<span class="lineNum">     569 </span>            :     int i;
<span class="lineNum">     570 </span>            :     int32 len;
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :     GTextInfo **ti = GGadgetGetList(GWidgetGetControl(a-&gt;gw,CID_Glyph),&amp;len);</span>
<span class="lineNum">     572 </span>            : 
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;len; ++i )</span>
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :         if ( ti[i]-&gt;userdata == ap )</span>
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :     if ( i!=len )</span>
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :         GGadgetSelectOneListItem(GWidgetGetControl(a-&gt;gw,CID_Glyph),i);</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     579 </span>            : 
<a name="580"><span class="lineNum">     580 </span>            : static int AnchorD_ChangeGlyph(AnchorDlg *a, SplineChar *sc, AnchorPoint *ap);</a>
<span class="lineNum">     581 </span>            : 
<span class="lineNum">     582 </span><span class="lineNoCov">          0 : static int AnchorD_Mouse(AnchorDlg *a,GEvent *event) {</span>
<span class="lineNum">     583 </span><span class="lineNoCov">          0 :     int on_combo = -1;</span>
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :     int on_ap = 0;</span>
<span class="lineNum">     585 </span>            :     int i;
<span class="lineNum">     586 </span>            : 
<span class="lineNum">     587 </span><span class="lineNoCov">          0 :     if ( event-&gt;u.mouse.x&lt;a-&gt;ctl_len || event-&gt;u.mouse.y&gt;=a-&gt;sb_base )</span>
<span class="lineNum">     588 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :     if ( a-&gt;xlen&gt;0 &amp;&amp; event-&gt;u.mouse.x&gt;=a-&gt;apmatch[0].xstart ) {</span>
<span class="lineNum">     590 </span><span class="lineNoCov">          0 :         int x = event-&gt;u.mouse.x + a-&gt;xoff;</span>
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;a-&gt;cnt; ++i ) {</span>
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :             if ( x&gt;=a-&gt;apmatch[i].xstart &amp;&amp;</span>
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :                     x&lt;a-&gt;apmatch[i].xstart + a-&gt;apmatch[i].size*a-&gt;magfactor ) {</span>
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :                 on_combo = i;</span>
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     596 </span>            :             }
<span class="lineNum">     597 </span>            :         }
<span class="lineNum">     598 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;u.mouse.x&gt;=a-&gt;ctl_len &amp;&amp; event-&gt;u.mouse.x&lt;a-&gt;ctl_len+ a-&gt;magfactor*a-&gt;char_size ) {</span>
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :         int x = event-&gt;u.mouse.x - a-&gt;ctl_len;</span>
<span class="lineNum">     600 </span><span class="lineNoCov">          0 :         int y = a-&gt;baseline - event-&gt;u.mouse.y;</span>
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :         int ax = (a-&gt;char_off + (int) rint(a-&gt;apos.x*a-&gt;scale))*a-&gt;magfactor;</span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :         int ay = (int) rint(a-&gt;apos.y*a-&gt;scale)*a-&gt;magfactor;</span>
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :         if ( x&gt;ax-4 &amp;&amp; x&lt;ax+4 &amp;&amp; y&gt;ay-4 &amp;&amp; y&lt;ay+4 )</span>
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :             on_ap = 2;</span>
<span class="lineNum">     605 </span>            :         else
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :             on_ap = 1;</span>
<span class="lineNum">     607 </span>            :     }
<span class="lineNum">     608 </span>            : 
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :     if ( event-&gt;type == et_mousedown ) {</span>
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :         if ( on_combo!=-1 )</span>
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :             a-&gt;combo = on_combo+1;</span>
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :         else if ( on_ap==2 ) {</span>
<span class="lineNum">     613 </span><span class="lineNoCov">          0 :             a-&gt;on_ap = true;</span>
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :             a-&gt;orig_pos = a-&gt;apos;</span>
<span class="lineNum">     615 </span>            :         }
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_mouseup ) {</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :         if ( on_combo!=-1 &amp;&amp; on_combo+1==a-&gt;combo ) {</span>
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :             AnchorPoint *ap = a-&gt;apmatch[on_combo].ap;</span>
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :             a-&gt;combo = 0;</span>
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :             AnchorD_ChangeGlyph(a,a-&gt;apmatch[on_combo].sc,a-&gt;apmatch[on_combo].ap);</span>
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :             AnchorD_SelectGlyph(a,ap);</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :         } else if ( on_ap &amp;&amp; a-&gt;on_ap ) {</span>
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :             AnchorD_FigurePos(a,event);</span>
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :             AnchorD_ClearCorrections(a);</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :             AnchorD_DrawPos(a);</span>
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(a-&gt;gw,NULL,false);</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :         } else if ( a-&gt;combo!=0 ) {</span>
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :         } else if ( a-&gt;on_ap ) {</span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :             a-&gt;apos = a-&gt;orig_pos;</span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :             AnchorD_DrawPos(a);</span>
<span class="lineNum">     631 </span>            :         }
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :         a-&gt;on_ap = 0;</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :         a-&gt;combo = 0;</span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :     } else if ( a-&gt;on_ap ) {</span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :         AnchorD_FigurePos(a,event);</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :         AnchorD_DrawPos(a);</span>
<span class="lineNum">     637 </span>            :     }
<span class="lineNum">     638 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="639"><span class="lineNum">     639 </span>            : }</a>
<span class="lineNum">     640 </span>            : 
<span class="lineNum">     641 </span><span class="lineNoCov">          0 : static void AnchorD_HScroll(AnchorDlg *a,struct sbevent *sb) {</span>
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :     int newpos = a-&gt;xoff;</span>
<span class="lineNum">     643 </span>            :     GRect rect;
<span class="lineNum">     644 </span>            : 
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :     switch( sb-&gt;type ) {</span>
<span class="lineNum">     646 </span>            :       case et_sb_top:
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :         newpos = 0;</span>
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     649 </span>            :       case et_sb_uppage:
<span class="lineNum">     650 </span><span class="lineNoCov">          0 :         newpos -= a-&gt;sb_width;</span>
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     652 </span>            :       case et_sb_up:
<span class="lineNum">     653 </span><span class="lineNoCov">          0 :         newpos -= a-&gt;pixelsize*a-&gt;magfactor/2;</span>
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     655 </span>            :       case et_sb_down:
<span class="lineNum">     656 </span><span class="lineNoCov">          0 :         newpos = a-&gt;pixelsize*a-&gt;magfactor/2;</span>
<span class="lineNum">     657 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     658 </span>            :       case et_sb_downpage:
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :         newpos += a-&gt;sb_width;</span>
<span class="lineNum">     660 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     661 </span>            :       case et_sb_bottom:
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :         newpos = a-&gt;xlen - a-&gt;sb_width;</span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     664 </span>            :       case et_sb_thumb:
<span class="lineNum">     665 </span>            :       case et_sb_thumbrelease:
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :         newpos = sb-&gt;pos;</span>
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     668 </span>            :     }
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :     if ( newpos + a-&gt;sb_width &gt;= a-&gt;xlen )</span>
<span class="lineNum">     670 </span><span class="lineNoCov">          0 :         newpos = a-&gt;xlen - a-&gt;sb_width;</span>
<span class="lineNum">     671 </span><span class="lineNoCov">          0 :     if ( newpos &lt; 0 ) newpos = 0;</span>
<span class="lineNum">     672 </span><span class="lineNoCov">          0 :     if ( newpos!=a-&gt;xoff ) {</span>
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :         int diff = newpos-a-&gt;xoff;</span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 :         a-&gt;xoff = newpos;</span>
<span class="lineNum">     675 </span><span class="lineNoCov">          0 :         GScrollBarSetPos(a-&gt;hsb,newpos);</span>
<span class="lineNum">     676 </span><span class="lineNoCov">          0 :         if ( a-&gt;cnt!=0 ) {</span>
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :             rect.x = a-&gt;apmatch[0].xstart+1; rect.y = 0;</span>
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :             rect.width = a-&gt;sb_width;</span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :             rect.height = a-&gt;sb_base;</span>
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :             GDrawScroll(a-&gt;gw,&amp;rect,-diff,0);</span>
<span class="lineNum">     681 </span>            :         }
<span class="lineNum">     682 </span>            :     }
<a name="683"><span class="lineNum">     683 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     684 </span>            : 
<span class="lineNum">     685 </span><span class="lineNoCov">          0 : static SplinePoint *SCFindPoint(SplineChar *sc,int layer,int ptnum) {</span>
<span class="lineNum">     686 </span>            :     /* We're going to want to move this point, so a point in a reference */
<span class="lineNum">     687 </span>            :     /*  is totally useless to us (we'd have to move the entire reference */
<span class="lineNum">     688 </span>            :     /*  and it's probably better just to detach the anchor in that case. */
<span class="lineNum">     689 </span>            :     SplineSet *ss;
<span class="lineNum">     690 </span>            :     SplinePoint *sp;
<span class="lineNum">     691 </span>            : 
<span class="lineNum">     692 </span><span class="lineNoCov">          0 :     for ( ss = sc-&gt;layers[layer].splines; ss!=NULL; ss=ss-&gt;next ) {</span>
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :         for ( sp=ss-&gt;first; ; ) {</span>
<span class="lineNum">     694 </span><span class="lineNoCov">          0 :             if ( sp-&gt;ttfindex==ptnum )</span>
<span class="lineNum">     695 </span><span class="lineNoCov">          0 : return( sp );</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :             if ( sp-&gt;next==NULL )</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :             sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :             if ( sp==ss-&gt;first )</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     702 </span>            :     }
<span class="lineNum">     703 </span><span class="lineNoCov">          0 : return( NULL );</span>
<a name="704"><span class="lineNum">     704 </span>            : }</a>
<span class="lineNum">     705 </span>            : 
<span class="lineNum">     706 </span><span class="lineNoCov">          0 : static void SetAnchor(SplineChar *sc,int layer, AnchorPoint *ap,DeviceTable *xadjust, DeviceTable *yadjust, BasePoint *pos) {</span>
<span class="lineNum">     707 </span>            :     int ly;
<span class="lineNum">     708 </span>            : 
<span class="lineNum">     709 </span><span class="lineNoCov">          0 :     free(ap-&gt;xadjust.corrections);</span>
<span class="lineNum">     710 </span><span class="lineNoCov">          0 :     if ( xadjust-&gt;corrections==NULL ) {</span>
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :         memset(&amp;ap-&gt;xadjust,0,sizeof(DeviceTable));</span>
<span class="lineNum">     712 </span>            :     } else {
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :         ap-&gt;xadjust = *xadjust;</span>
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :         xadjust-&gt;corrections = NULL;</span>
<span class="lineNum">     715 </span>            :     }
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :     free(ap-&gt;yadjust.corrections);</span>
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :     if ( yadjust-&gt;corrections==NULL ) {</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :         memset(&amp;ap-&gt;yadjust,0,sizeof(DeviceTable));</span>
<span class="lineNum">     719 </span>            :     } else {
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :         ap-&gt;yadjust = *yadjust;</span>
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :         yadjust-&gt;corrections = NULL;</span>
<span class="lineNum">     722 </span>            :     }
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :     ap-&gt;me = *pos;</span>
<span class="lineNum">     724 </span>            :     /* If the anchor is bound to a truetype point we must move the point too */
<span class="lineNum">     725 </span>            :     /*  or the anchor will just snap back to the point */
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :     ly = ly_none;</span>
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :     if ( ap-&gt;has_ttf_pt &amp;&amp; ap-&gt;ttf_pt_index!=0xffff ) {</span>
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :         int any = false;</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :         for ( ly=ly_fore; ly&lt;sc-&gt;layer_cnt; ++ly ) if ( sc-&gt;layers[ly].order2 ) {</span>
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :             SplinePoint *sp = SCFindPoint(sc,layer,ap-&gt;ttf_pt_index);</span>
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :             if ( sp!=NULL ) {</span>
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :                 sp-&gt;nextcp.x += pos-&gt;x - sp-&gt;me.x;</span>
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :                 sp-&gt;prevcp.x += pos-&gt;x - sp-&gt;me.x;</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :                 sp-&gt;nextcp.y += pos-&gt;y - sp-&gt;me.y;</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :                 sp-&gt;prevcp.y += pos-&gt;y - sp-&gt;me.y;</span>
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :                 sp-&gt;me = *pos;</span>
<span class="lineNum">     737 </span><span class="lineNoCov">          0 :                 any = true;</span>
<span class="lineNum">     738 </span>            :             }
<span class="lineNum">     739 </span>            :         }
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :         if ( !any ) {</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :             ff_post_notice(_(&quot;Detaching Anchor Point&quot;),_(&quot;This anchor was attached to point %d, but that's not a point I can move. I'm detaching the anchor from the point.&quot;) );</span>
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :             ap-&gt;has_ttf_pt = false;</span>
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :             ly = ly_none;</span>
<span class="lineNum">     744 </span>            :         }
<span class="lineNum">     745 </span>            :     }
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :     SCCharChangedUpdate(sc,ly);</span>
<a name="747"><span class="lineNum">     747 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     748 </span>            : 
<span class="lineNum">     749 </span><span class="lineNoCov">          0 : static void AnchorD_DoCancel(AnchorDlg *a) {</span>
<span class="lineNum">     750 </span>            :     struct state *old;
<span class="lineNum">     751 </span>            : 
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :     for ( old = a-&gt;orig_vals; old!=NULL; old=old-&gt;next ) {</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :         SetAnchor(old-&gt;sc,a-&gt;layer,old-&gt;ap_pt,&amp;old-&gt;ap_vals.xadjust,&amp;old-&gt;ap_vals.yadjust,&amp;old-&gt;ap_vals.me);</span>
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :         old-&gt;ap_pt-&gt;has_ttf_pt = old-&gt;ap_vals.has_ttf_pt;</span>
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :         old-&gt;sc-&gt;changed = old-&gt;changed;       /* Must come after the charchangedupdate */</span>
<span class="lineNum">     756 </span>            :     }
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :     if ( a-&gt;orig_vals!=NULL ) {</span>
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :         FVRefreshAll(a-&gt;sc-&gt;parent);</span>
<span class="lineNum">     759 </span>            :     }
<span class="lineNum">     760 </span>            :         
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :     a-&gt;done = true;</span>
<a name="762"><span class="lineNum">     762 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     763 </span>            : 
<span class="lineNum">     764 </span><span class="lineNoCov">          0 : static int AnchorD_MagnificationChanged(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :     AnchorDlg *a = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_listselected ) {</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :         int mag = GGadgetGetFirstListSelectedItem(GWidgetGetControl(a-&gt;gw,CID_Mag));</span>
<span class="lineNum">     768 </span>            : 
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :         if ( mag!=-1 &amp;&amp; mag!=a-&gt;magfactor-1 ) {</span>
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :             a-&gt;xoff = (mag+1)*a-&gt;xoff/a-&gt;magfactor;</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :             a-&gt;magfactor = mag+1;</span>
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :             AnchorD_ChangeMag(a);</span>
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(a-&gt;gw,NULL,false);</span>
<span class="lineNum">     774 </span>            :         }
<span class="lineNum">     775 </span>            :     }
<span class="lineNum">     776 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="777"><span class="lineNum">     777 </span>            : }</a>
<span class="lineNum">     778 </span>            : 
<span class="lineNum">     779 </span><span class="lineNoCov">          0 : static int AnchorD_DisplaySizeChanged(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :     AnchorDlg *a = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textchanged ) {</span>
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :         const unichar_t *ret = _GGadgetGetTitle(GWidgetGetControl(a-&gt;gw,CID_DisplaySize));</span>
<span class="lineNum">     783 </span>            :         unichar_t *end;
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :         int pixelsize = u_strtol(ret,&amp;end,10);</span>
<span class="lineNum">     785 </span>            : 
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :         while ( *end==' ' ) ++end;</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :         if ( pixelsize&gt;4 &amp;&amp; pixelsize&lt;400 &amp;&amp; *end=='\0' ) {</span>
<span class="lineNum">     788 </span>            :             unichar_t ubuf[20]; char buffer[20];
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :             ubuf[0] = '0'; ubuf[1] = '\0';</span>
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :             if ( a-&gt;xadjust.corrections!=NULL &amp;&amp;</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :                     pixelsize&gt;=a-&gt;xadjust.first_pixel_size &amp;&amp;</span>
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :                     pixelsize&lt;=a-&gt;xadjust.last_pixel_size ) {</span>
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :                 sprintf( buffer, &quot;%d&quot;, a-&gt;xadjust.corrections[</span>
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :                         pixelsize-a-&gt;xadjust.first_pixel_size]);</span>
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :                 uc_strcpy(ubuf,buffer);</span>
<span class="lineNum">     796 </span>            :             }
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :             GGadgetSetTitle(GWidgetGetControl(a-&gt;gw,CID_XCor),ubuf);</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :             ubuf[0] = '0'; ubuf[1] = '\0';</span>
<span class="lineNum">     799 </span><span class="lineNoCov">          0 :             if ( a-&gt;yadjust.corrections!=NULL &amp;&amp;</span>
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :                     pixelsize&gt;=a-&gt;yadjust.first_pixel_size &amp;&amp;</span>
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :                     pixelsize&lt;=a-&gt;yadjust.last_pixel_size ) {</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :                 sprintf( buffer, &quot;%d&quot;, a-&gt;yadjust.corrections[</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :                         pixelsize-a-&gt;yadjust.first_pixel_size]);</span>
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :                 uc_strcpy(ubuf,buffer);</span>
<span class="lineNum">     805 </span>            :             }
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :             GGadgetSetTitle(GWidgetGetControl(a-&gt;gw,CID_YCor),ubuf);</span>
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :             a-&gt;xoff = pixelsize*a-&gt;xoff/a-&gt;pixelsize;</span>
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :             a-&gt;pixelsize = aa_pixelsize = pixelsize;</span>
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :             AnchorD_ChangeSize(a);</span>
<span class="lineNum">     810 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(a-&gt;gw,NULL,false);</span>
<span class="lineNum">     811 </span>            :         }
<span class="lineNum">     812 </span>            :     }
<span class="lineNum">     813 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="814"><span class="lineNum">     814 </span>            : }</a>
<span class="lineNum">     815 </span>            : 
<span class="lineNum">     816 </span><span class="lineNoCov">          0 : static int AnchorD_CorrectionChanged(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     817 </span><span class="lineNoCov">          0 :     AnchorDlg *a = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     818 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textchanged ) {</span>
<span class="lineNum">     819 </span><span class="lineNoCov">          0 :         const unichar_t *ret = _GGadgetGetTitle(g);</span>
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :         int is_y = GGadgetGetCid(g)==CID_YCor;</span>
<span class="lineNum">     821 </span>            :         unichar_t *end;
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :         int correction = u_strtol(ret,&amp;end,10);</span>
<span class="lineNum">     823 </span>            : 
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :         while ( *end==' ' ) ++end;</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :         if ( *end!='\0' )</span>
<span class="lineNum">     826 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :         if ( correction&lt;-128 || correction&gt;127 ) {</span>
<span class="lineNum">     828 </span><span class="lineNoCov">          0 :             ff_post_error( _(&quot;Out of Range&quot;), _(&quot;Corrections must be between -128 and 127 (and should be smaller)&quot;) );</span>
<span class="lineNum">     829 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     830 </span>            :         }
<span class="lineNum">     831 </span>            : 
<span class="lineNum">     832 </span><span class="lineNoCov">          0 :         DeviceTableSet(is_y?&amp;a-&gt;yadjust:&amp;a-&gt;xadjust,a-&gt;pixelsize,correction);</span>
<span class="lineNum">     833 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(a-&gt;gw,NULL,false);</span>
<span class="lineNum">     834 </span>            :     }
<span class="lineNum">     835 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="836"><span class="lineNum">     836 </span>            : }</a>
<span class="lineNum">     837 </span>            : 
<span class="lineNum">     838 </span><span class="lineNoCov">          0 : static int AnchorD_PositionChanged(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :     AnchorDlg *a = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textchanged ) {</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :         const unichar_t *ret = _GGadgetGetTitle(g);</span>
<span class="lineNum">     842 </span><span class="lineNoCov">          0 :         int is_y = GGadgetGetCid(g)==CID_Y;</span>
<span class="lineNum">     843 </span>            :         unichar_t *end;
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :         int val = u_strtol(ret,&amp;end,10);</span>
<span class="lineNum">     845 </span>            : 
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :         while ( *end==' ' ) ++end;</span>
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :         if ( *end!='\0' )</span>
<span class="lineNum">     848 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     849 </span>            : 
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :         if ( (is_y &amp;&amp; a-&gt;apos.y==val) || (!is_y &amp;&amp; a-&gt;apos.x==val))</span>
<span class="lineNum">     851 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :         if ( is_y )</span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :             a-&gt;apos.y = val;</span>
<span class="lineNum">     854 </span>            :         else
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :             a-&gt;apos.x = val;</span>
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :         AnchorD_ClearCorrections(a);</span>
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(a-&gt;gw,NULL,false);</span>
<span class="lineNum">     858 </span>            :     }
<span class="lineNum">     859 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="860"><span class="lineNum">     860 </span>            : }</a>
<span class="lineNum">     861 </span>            : 
<span class="lineNum">     862 </span><span class="lineNoCov">          0 : static int AnchorD_Cancel(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :         AnchorDlg *a = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :         AnchorD_DoCancel(a);</span>
<span class="lineNum">     866 </span>            :     }
<span class="lineNum">     867 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="868"><span class="lineNum">     868 </span>            : }</a>
<span class="lineNum">     869 </span>            : 
<span class="lineNum">     870 </span><span class="lineNoCov">          0 : static int AnchorD_Apply(AnchorDlg *a) {</span>
<span class="lineNum">     871 </span><span class="lineNoCov">          0 :     SetAnchor(a-&gt;sc,a-&gt;layer,a-&gt;ap,&amp;a-&gt;xadjust,&amp;a-&gt;yadjust,&amp;a-&gt;apos);</span>
<span class="lineNum">     872 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="873"><span class="lineNum">     873 </span>            : }</a>
<span class="lineNum">     874 </span>            : 
<span class="lineNum">     875 </span><span class="lineNoCov">          0 : static int AnchorD_OK(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :         AnchorDlg *a = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     878 </span><span class="lineNoCov">          0 :         AnchorD_Apply(a);</span>
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :         a-&gt;done = true;</span>
<span class="lineNum">     880 </span>            :     }
<span class="lineNum">     881 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="882"><span class="lineNum">     882 </span>            : }</a>
<span class="lineNum">     883 </span>            : 
<span class="lineNum">     884 </span><span class="lineNoCov">          0 : static void AnchorD_SetDevTabs(AnchorDlg *a) {</span>
<span class="lineNum">     885 </span>            :     char buffer[20];
<span class="lineNum">     886 </span>            :     unichar_t ubuf[20];
<span class="lineNum">     887 </span>            :     int min, max;
<span class="lineNum">     888 </span>            : 
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :     GGadgetClearList(GWidgetGetControl(a-&gt;gw,CID_DisplaySize));</span>
<span class="lineNum">     890 </span><span class="lineNoCov">          0 :     min = 1; max = 0;</span>
<span class="lineNum">     891 </span><span class="lineNoCov">          0 :     if ( a-&gt;xadjust.corrections!=NULL ) {</span>
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :         min = a-&gt;xadjust.first_pixel_size;</span>
<span class="lineNum">     893 </span><span class="lineNoCov">          0 :         max = a-&gt;xadjust.last_pixel_size;</span>
<span class="lineNum">     894 </span>            :     }
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :     if ( a-&gt;yadjust.corrections!=NULL ) {</span>
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :         if ( a-&gt;yadjust.first_pixel_size&lt;min ) min = a-&gt;yadjust.first_pixel_size;</span>
<span class="lineNum">     897 </span><span class="lineNoCov">          0 :         if ( a-&gt;yadjust.last_pixel_size&gt;max ) max = a-&gt;yadjust.last_pixel_size;</span>
<span class="lineNum">     898 </span>            :     }
<span class="lineNum">     899 </span><span class="lineNoCov">          0 :     if ( max&gt;min ) {</span>
<span class="lineNum">     900 </span>            :         int i;
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :         int len = max-min+1;</span>
<span class="lineNum">     902 </span>            :         char buffer[20];
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :         GTextInfo **ti = malloc((len+1)*sizeof(GTextInfo *));</span>
<span class="lineNum">     904 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;len; ++i ) {</span>
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :             ti[i] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :             sprintf( buffer, &quot;%d&quot;, i+min );</span>
<span class="lineNum">     907 </span><span class="lineNoCov">          0 :             ti[i]-&gt;text = uc_copy(buffer);</span>
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :             ti[i]-&gt;fg = ti[i]-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">     909 </span>            :         }
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :         ti[i] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :         GGadgetSetList(GWidgetGetControl(a-&gt;gw,CID_DisplaySize),ti,false);</span>
<span class="lineNum">     912 </span>            :     }
<span class="lineNum">     913 </span><span class="lineNoCov">          0 :     ubuf[0] = '0'; ubuf[1] = '\0';</span>
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :     if ( a-&gt;xadjust.corrections!=NULL &amp;&amp;</span>
<span class="lineNum">     915 </span><span class="lineNoCov">          0 :             a-&gt;pixelsize&gt;=a-&gt;xadjust.first_pixel_size &amp;&amp;</span>
<span class="lineNum">     916 </span><span class="lineNoCov">          0 :             a-&gt;pixelsize&lt;=a-&gt;xadjust.last_pixel_size ) {</span>
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :         sprintf( buffer, &quot;%d&quot;, a-&gt;xadjust.corrections[</span>
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :                 a-&gt;pixelsize-a-&gt;xadjust.first_pixel_size]);</span>
<span class="lineNum">     919 </span><span class="lineNoCov">          0 :         uc_strcpy(ubuf,buffer);</span>
<span class="lineNum">     920 </span>            :     }
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :     GGadgetSetTitle(GWidgetGetControl(a-&gt;gw,CID_XCor),ubuf);</span>
<span class="lineNum">     922 </span><span class="lineNoCov">          0 :     ubuf[0] = '0'; ubuf[1] = '\0';</span>
<span class="lineNum">     923 </span><span class="lineNoCov">          0 :     if ( a-&gt;yadjust.corrections!=NULL &amp;&amp;</span>
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :             a-&gt;pixelsize&gt;=a-&gt;yadjust.first_pixel_size &amp;&amp;</span>
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :             a-&gt;pixelsize&lt;=a-&gt;yadjust.last_pixel_size ) {</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :         sprintf( buffer, &quot;%d&quot;, a-&gt;yadjust.corrections[</span>
<span class="lineNum">     927 </span><span class="lineNoCov">          0 :                 a-&gt;pixelsize-a-&gt;yadjust.first_pixel_size]);</span>
<span class="lineNum">     928 </span><span class="lineNoCov">          0 :         uc_strcpy(ubuf,buffer);</span>
<span class="lineNum">     929 </span>            :     }
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :     GGadgetSetTitle(GWidgetGetControl(a-&gt;gw,CID_YCor),ubuf);</span>
<a name="931"><span class="lineNum">     931 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     932 </span>            : 
<span class="lineNum">     933 </span><span class="lineNoCov">          0 : static int AnchorD_ChangeGlyph(AnchorDlg *a, SplineChar *sc, AnchorPoint *ap) {</span>
<span class="lineNum">     934 </span>            :     char buf[32];
<span class="lineNum">     935 </span>            :     struct state *old;
<span class="lineNum">     936 </span>            : 
<span class="lineNum">     937 </span><span class="lineNoCov">          0 :     if ( ap==NULL || sc==NULL )</span>
<span class="lineNum">     938 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :     if ( a-&gt;ap==ap )</span>
<span class="lineNum">     940 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     941 </span>            :     /* Do we already have an entry for the current anchor? */
<span class="lineNum">     942 </span><span class="lineNoCov">          0 :     for ( old = a-&gt;orig_vals; old!=NULL &amp;&amp; old-&gt;ap_pt!=a-&gt;ap; old=old-&gt;next );</span>
<span class="lineNum">     943 </span>            :     /* If so we've already noted its original state and need do nothing more */
<span class="lineNum">     944 </span>            :     /*  but otherwise we must store the current state */
<span class="lineNum">     945 </span><span class="lineNoCov">          0 :     if ( old==NULL ) {</span>
<span class="lineNum">     946 </span><span class="lineNoCov">          0 :         old = chunkalloc(sizeof(struct state));</span>
<span class="lineNum">     947 </span><span class="lineNoCov">          0 :         old-&gt;sc = a-&gt;sc;</span>
<span class="lineNum">     948 </span><span class="lineNoCov">          0 :         old-&gt;changed = a-&gt;sc-&gt;changed;</span>
<span class="lineNum">     949 </span><span class="lineNoCov">          0 :         old-&gt;ap_pt = a-&gt;ap;</span>
<span class="lineNum">     950 </span><span class="lineNoCov">          0 :         old-&gt;ap_vals = *a-&gt;ap;</span>
<span class="lineNum">     951 </span><span class="lineNoCov">          0 :         memset(&amp;a-&gt;ap-&gt;xadjust,0,sizeof(DeviceTable));</span>
<span class="lineNum">     952 </span><span class="lineNoCov">          0 :         memset(&amp;a-&gt;ap-&gt;yadjust,0,sizeof(DeviceTable));</span>
<span class="lineNum">     953 </span><span class="lineNoCov">          0 :         old-&gt;next = a-&gt;orig_vals;</span>
<span class="lineNum">     954 </span><span class="lineNoCov">          0 :         a-&gt;orig_vals = old;</span>
<span class="lineNum">     955 </span>            :     }
<span class="lineNum">     956 </span><span class="lineNoCov">          0 :     AnchorD_Apply(a);</span>
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :     AnchorD_FreeChar(a);</span>
<span class="lineNum">     958 </span>            : 
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :     a-&gt;ap = ap;</span>
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :     a-&gt;sc = sc;</span>
<span class="lineNum">     961 </span><span class="lineNoCov">          0 :     a-&gt;apos = ap-&gt;me;</span>
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :     sprintf( buf, &quot;%d&quot;, (int) rint(ap-&gt;me.x) );</span>
<span class="lineNum">     963 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(a-&gt;gw,CID_X),buf);</span>
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :     sprintf( buf, &quot;%d&quot;, (int) rint(ap-&gt;me.y) );</span>
<span class="lineNum">     965 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(GWidgetGetControl(a-&gt;gw,CID_Y),buf);</span>
<span class="lineNum">     966 </span>            : 
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :     AnchorD_FindComplements(a);</span>
<span class="lineNum">     968 </span><span class="lineNoCov">          0 :     AnchorD_SetDevTabs(a);</span>
<span class="lineNum">     969 </span><span class="lineNoCov">          0 :     AnchorD_ChangeSize(a);</span>
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :     AnchorD_SetTitle(a);</span>
<span class="lineNum">     971 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="972"><span class="lineNum">     972 </span>            : }</a>
<span class="lineNum">     973 </span>            : 
<span class="lineNum">     974 </span><span class="lineNoCov">          0 : static SplineChar *AddAnchor(AnchorDlg *a, SplineFont *sf, AnchorClass *ac,</span>
<span class="lineNum">     975 </span>            :         int ismarklike) {
<span class="lineNum">     976 </span>            :     char *ret, *def;
<span class="lineNum">     977 </span>            :     SplineChar *sc;
<span class="lineNum">     978 </span><span class="lineNoCov">          0 :     int isliga = false, ismrk=false, maxlig=-1;</span>
<span class="lineNum">     979 </span>            :     AnchorPoint *ap;
<span class="lineNum">     980 </span>            :     PST *pst;
<span class="lineNum">     981 </span>            :     int i;
<span class="lineNum">     982 </span>            : 
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :     def = copy(&quot;.notdef&quot;);</span>
<span class="lineNum">     984 </span>            :     for (;;) {
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :         ret = gwwv_ask_string(_(&quot;Provide a glyph name&quot;),def,_(&quot;Please identify a glyph by name, and FontForge will add an anchor to that glyph.&quot;));</span>
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :         free(def);</span>
<span class="lineNum">     987 </span><span class="lineNoCov">          0 :         if ( ret==NULL )</span>
<span class="lineNum">     988 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :         sc = SFGetChar(sf,-1,ret);</span>
<span class="lineNum">     990 </span><span class="lineNoCov">          0 :         def = ret;</span>
<span class="lineNum">     991 </span><span class="lineNoCov">          0 :         if ( sc==NULL )</span>
<span class="lineNum">     992 </span><span class="lineNoCov">          0 :             ff_post_error(_(&quot;Non-existant glyph&quot;), _(&quot;The glyph, %.80s, is not in the font&quot;), ret );</span>
<span class="lineNum">     993 </span>            :         else {
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :             isliga = ismrk = false;</span>
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :             for ( ap=sc-&gt;anchor ; ap!=NULL; ap=ap-&gt;next ) {</span>
<span class="lineNum">     996 </span><span class="lineNoCov">          0 :                 if ( ap-&gt;type == at_baselig )</span>
<span class="lineNum">     997 </span><span class="lineNoCov">          0 :                     isliga = true;</span>
<span class="lineNum">     998 </span><span class="lineNoCov">          0 :                 else if ( ap-&gt;type == at_basemark || ap-&gt;type == at_mark )</span>
<span class="lineNum">     999 </span><span class="lineNoCov">          0 :                     ismrk = true;</span>
<span class="lineNum">    1000 </span><span class="lineNoCov">          0 :                 if ( ap-&gt;anchor == ac ) {</span>
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 :                     if ( (ap-&gt;type == at_centry ||</span>
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 :                             (ap-&gt;type == at_mark &amp;&amp; ac-&gt;type==act_mkmk) ||</span>
<span class="lineNum">    1003 </span><span class="lineNoCov">          0 :                             ap-&gt;type == at_baselig ) &amp;&amp; ismarklike==-1 )</span>
<span class="lineNum">    1004 </span><span class="lineNoCov">          0 :                         ismarklike = false;</span>
<span class="lineNum">    1005 </span><span class="lineNoCov">          0 :                     else if ( (ap-&gt;type == at_cexit || (ap-&gt;type == at_basemark &amp;&amp; ac-&gt;type==act_mkmk)) &amp;&amp; ismarklike==-1 )</span>
<span class="lineNum">    1006 </span><span class="lineNoCov">          0 :                         ismarklike = true;</span>
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 :                     else if ( ap-&gt;type != at_baselig ||</span>
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 :                               ( ap-&gt;type == at_baselig &amp;&amp; ismarklike&gt;0 ))</span>
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 :                         ff_post_error(_(&quot;Duplicate Anchor Class&quot;), _(&quot;The glyph, %.80s, already contains an anchor in this class, %.80s.&quot;), ret, ac-&gt;name );</span>
<span class="lineNum">    1010 </span><span class="lineNoCov">          0 :                     else if ( maxlig&lt;ap-&gt;lig_index )</span>
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :                         maxlig = ap-&gt;lig_index;</span>
<span class="lineNum">    1012 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1013 </span>            :                 }
<span class="lineNum">    1014 </span>            :             }
<span class="lineNum">    1015 </span><span class="lineNoCov">          0 :             if ( ap==NULL )</span>
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1017 </span>            :         }
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1019 </span>            : 
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 :     ap = chunkalloc(sizeof(AnchorPoint));</span>
<span class="lineNum">    1021 </span><span class="lineNoCov">          0 :     ap-&gt;anchor = ac;</span>
<span class="lineNum">    1022 </span><span class="lineNoCov">          0 :     ap-&gt;me.x = ap-&gt;me.y = 0;</span>
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 :     ap-&gt;next = sc-&gt;anchor;</span>
<span class="lineNum">    1024 </span><span class="lineNoCov">          0 :     sc-&gt;anchor = ap;</span>
<span class="lineNum">    1025 </span><span class="lineNoCov">          0 :     SCCharChangedUpdate(sc,ly_none);</span>
<span class="lineNum">    1026 </span>            : 
<span class="lineNum">    1027 </span><span class="lineNoCov">          0 :     if ( sc-&gt;width==0 ) ismrk = true;</span>
<span class="lineNum">    1028 </span><span class="lineNoCov">          0 :     for ( pst=sc-&gt;possub; pst!=NULL; pst=pst-&gt;next ) {</span>
<span class="lineNum">    1029 </span><span class="lineNoCov">          0 :         if ( pst-&gt;type == pst_ligature || pst-&gt;type == pst_lcaret ) {</span>
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 :             isliga = true;</span>
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1032 </span>            :         }
<span class="lineNum">    1033 </span>            :     }
<span class="lineNum">    1034 </span>            : 
<span class="lineNum">    1035 </span><span class="lineNoCov">          0 :     if ( isliga || (ac-&gt;type==act_mklg &amp;&amp; ismarklike==0 ) ) {</span>
<span class="lineNum">    1036 </span><span class="lineNoCov">          0 :         ap-&gt;type = at_baselig;</span>
<span class="lineNum">    1037 </span><span class="lineNoCov">          0 :         ap-&gt;lig_index = maxlig+1;</span>
<span class="lineNum">    1038 </span><span class="lineNoCov">          0 :     } else if ( ismrk &amp;&amp; ismarklike!=0 )</span>
<span class="lineNum">    1039 </span><span class="lineNoCov">          0 :         ap-&gt;type = at_mark;</span>
<span class="lineNum">    1040 </span><span class="lineNoCov">          0 :     else if ( ismarklike==0 &amp;&amp; (ismrk || ac-&gt;type==act_mkmk) )</span>
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 :         ap-&gt;type = at_basemark;</span>
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :     else if ( ac-&gt;type == act_curs ) {</span>
<span class="lineNum">    1043 </span><span class="lineNoCov">          0 :         if ( ismarklike==true )</span>
<span class="lineNum">    1044 </span><span class="lineNoCov">          0 :             ap-&gt;type = at_centry;</span>
<span class="lineNum">    1045 </span>            :         else
<span class="lineNum">    1046 </span><span class="lineNoCov">          0 :             ap-&gt;type = at_cexit;</span>
<span class="lineNum">    1047 </span><span class="lineNoCov">          0 :     } else if ( ismarklike==true )</span>
<span class="lineNum">    1048 </span><span class="lineNoCov">          0 :         ap-&gt;type = at_mark;</span>
<span class="lineNum">    1049 </span>            :     else
<span class="lineNum">    1050 </span><span class="lineNoCov">          0 :         ap-&gt;type = at_basechar;</span>
<span class="lineNum">    1051 </span>            : 
<span class="lineNum">    1052 </span><span class="lineNoCov">          0 :     if ( a!=NULL ) {</span>
<span class="lineNum">    1053 </span><span class="lineNoCov">          0 :         GTextInfo **ti = AnchorD_GlyphsInClass(a);</span>
<span class="lineNum">    1054 </span><span class="lineNoCov">          0 :         GGadgetSetList(GWidgetGetControl(a-&gt;gw,CID_Glyph),ti,false);</span>
<span class="lineNum">    1055 </span><span class="lineNoCov">          0 :         for ( i=0; ti[i]-&gt;text!=NULL || ti[i]-&gt;line; ++i ) {</span>
<span class="lineNum">    1056 </span><span class="lineNoCov">          0 :             if ( ti[i]-&gt;userdata == ap ) {</span>
<span class="lineNum">    1057 </span><span class="lineNoCov">          0 :                 GGadgetSelectOneListItem(GWidgetGetControl(a-&gt;gw,CID_Glyph),i);</span>
<span class="lineNum">    1058 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1059 </span>            :             }
<span class="lineNum">    1060 </span>            :         }
<span class="lineNum">    1061 </span><span class="lineNoCov">          0 :         AnchorD_ChangeGlyph(a,sc,ap);</span>
<span class="lineNum">    1062 </span>            :     }
<span class="lineNum">    1063 </span><span class="lineNoCov">          0 : return( sc );</span>
<a name="1064"><span class="lineNum">    1064 </span>            : }</a>
<span class="lineNum">    1065 </span>            : 
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 : static int AnchorD_GlyphChanged(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :     AnchorDlg *a = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    1068 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_listselected ) {</span>
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :         GTextInfo *sel = GGadgetGetListItemSelected(g);</span>
<span class="lineNum">    1070 </span>            : 
<span class="lineNum">    1071 </span><span class="lineNoCov">          0 :         if ( sel!=NULL ) {</span>
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 :             AnchorPoint *ap = sel-&gt;userdata;</span>
<span class="lineNum">    1073 </span><span class="lineNoCov">          0 :             if ( ap==Add_Mark )</span>
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :                 AddAnchor(a,a-&gt;sc-&gt;parent,a-&gt;ap-&gt;anchor,true);</span>
<span class="lineNum">    1075 </span><span class="lineNoCov">          0 :             else if ( ap==Add_Base )</span>
<span class="lineNum">    1076 </span><span class="lineNoCov">          0 :                 AddAnchor(a,a-&gt;sc-&gt;parent,a-&gt;ap-&gt;anchor,false);</span>
<span class="lineNum">    1077 </span>            :             else {
<span class="lineNum">    1078 </span><span class="lineNoCov">          0 :                 char *name = u2utf8_copy(sel-&gt;text);</span>
<span class="lineNum">    1079 </span><span class="lineNoCov">          0 :                 SplineChar *sc = SFGetChar(a-&gt;sc-&gt;parent,-1,name);</span>
<span class="lineNum">    1080 </span>            : 
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 :                 free(name);</span>
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :                 AnchorD_ChangeGlyph(a,sc,ap);</span>
<span class="lineNum">    1083 </span>            :             }
<span class="lineNum">    1084 </span>            :         }
<span class="lineNum">    1085 </span>            :     }
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1087"><span class="lineNum">    1087 </span>            : }</a>
<span class="lineNum">    1088 </span>            : 
<span class="lineNum">    1089 </span><span class="lineNoCov">          0 : static void AnchorD_NextPrev(AnchorDlg *a,int incr) {</span>
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :     GGadget *g = GWidgetGetControl(a-&gt;gw,CID_Glyph);</span>
<span class="lineNum">    1091 </span>            :     int len;
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :     GTextInfo **ti = GGadgetGetList(g,&amp;len);</span>
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 :     int sel = GGadgetGetFirstListSelectedItem(g);</span>
<span class="lineNum">    1094 </span>            : 
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 :     for ( sel += incr; sel&gt;0 &amp;&amp; sel&lt;len; sel+=incr ) {</span>
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 :         if ( !( ti[sel]-&gt;userdata == Add_Mark ||</span>
<span class="lineNum">    1097 </span><span class="lineNoCov">          0 :                 ti[sel]-&gt;userdata == Add_Base ||</span>
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :                 ti[sel]-&gt;line ||</span>
<span class="lineNum">    1099 </span><span class="lineNoCov">          0 :                 ti[sel]-&gt;disabled ))</span>
<span class="lineNum">    1100 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1101 </span>            :     }
<span class="lineNum">    1102 </span><span class="lineNoCov">          0 :     if ( sel==0 || sel&gt;=len )</span>
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :         GDrawBeep(NULL);</span>
<span class="lineNum">    1104 </span>            :     else {
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :         char *name = u2utf8_copy(ti[sel]-&gt;text);</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :         SplineChar *sc = SFGetChar(a-&gt;sc-&gt;parent,-1,name);</span>
<span class="lineNum">    1107 </span>            : 
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :         free(name);</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :         GGadgetSelectOneListItem(g,sel);</span>
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :         AnchorD_ChangeGlyph(a,sc,ti[sel]-&gt;userdata);</span>
<span class="lineNum">    1111 </span>            :     }
<a name="1112"><span class="lineNum">    1112 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1113 </span>            : 
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 : static int anchord_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :     AnchorDlg *a = GDrawGetUserData(gw);</span>
<span class="lineNum">    1116 </span>            : 
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :     switch ( event-&gt;type ) {</span>
<span class="lineNum">    1118 </span>            :       case et_close:
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 :         AnchorD_DoCancel(a);</span>
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1121 </span>            :       case et_char:
<span class="lineNum">    1122 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.keysym == GK_F1 || event-&gt;u.chr.keysym == GK_Help ) {</span>
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :             help(&quot;anchorcontrol.html&quot;);</span>
<span class="lineNum">    1124 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 :         } else if ( event-&gt;u.chr.keysym == GK_Page_Down || event-&gt;u.chr.keysym == GK_KP_Page_Down ) {</span>
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :             AnchorD_NextPrev(a,1);</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1128 </span><span class="lineNoCov">          0 :         } else if ( event-&gt;u.chr.keysym == GK_Page_Up || event-&gt;u.chr.keysym == GK_KP_Page_Up ) {</span>
<span class="lineNum">    1129 </span><span class="lineNoCov">          0 :             AnchorD_NextPrev(a,-1);</span>
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1131 </span>            :         }
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1133 </span>            :       break;
<span class="lineNum">    1134 </span>            :       case et_mouseup: case et_mousemove: case et_mousedown:
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 : return( AnchorD_Mouse(a,event));</span>
<span class="lineNum">    1136 </span>            :       break;
<span class="lineNum">    1137 </span>            :       case et_expose:
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 :         AnchorD_Expose(a,gw,event);</span>
<span class="lineNum">    1139 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1140 </span>            :       case et_resize:
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :         AnchorD_Resize(a);</span>
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(a-&gt;gw,NULL,false);</span>
<span class="lineNum">    1143 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1144 </span>            :       case et_controlevent:
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :         switch( event-&gt;u.control.subtype ) {</span>
<span class="lineNum">    1146 </span>            :           case et_scrollbarchange:
<span class="lineNum">    1147 </span><span class="lineNoCov">          0 :             AnchorD_HScroll(a,&amp;event-&gt;u.control.u.sb);</span>
<span class="lineNum">    1148 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1149 </span>            :         }
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1151 </span>            :     }
<span class="lineNum">    1152 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1153 </span>            : }
<span class="lineNum">    1154 </span>            : 
<span class="lineNum">    1155 </span>            : static GTextInfo magnifications[] = {
<span class="lineNum">    1156 </span>            :     { (unichar_t *) &quot;100%&quot;, NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 1, 0, 1, 0, 0, '\0'},
<span class="lineNum">    1157 </span>            :     { (unichar_t *) &quot;200%&quot;, NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0'},
<span class="lineNum">    1158 </span>            :     { (unichar_t *) &quot;300%&quot;, NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0'},
<span class="lineNum">    1159 </span>            :     { (unichar_t *) &quot;400%&quot;, NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0'},
<span class="lineNum">    1160 </span>            :     GTEXTINFO_EMPTY
<a name="1161"><span class="lineNum">    1161 </span>            : };</a>
<span class="lineNum">    1162 </span>            :     
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 : void AnchorControl(SplineChar *sc,AnchorPoint *ap,int layer) {</span>
<span class="lineNum">    1164 </span>            :     GRect pos;
<span class="lineNum">    1165 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    1166 </span>            :     AnchorDlg a;
<span class="lineNum">    1167 </span>            :     GWindow gw;
<span class="lineNum">    1168 </span>            :     GGadgetCreateData gcd[15], buttonbox, maingcd[3], *hvarray[60], *buttonarray[8];
<span class="lineNum">    1169 </span>            :     GGadgetCreateData glyphbox, *glypharray[5];
<span class="lineNum">    1170 </span>            :     GTextInfo label[16];
<span class="lineNum">    1171 </span>            :     int k, hv;
<span class="lineNum">    1172 </span>            :     extern int _GScrollBar_Width;
<span class="lineNum">    1173 </span>            :     char buffer[20], xbuf[20], ybuf[20];
<span class="lineNum">    1174 </span>            :     GRect boxsize;
<span class="lineNum">    1175 </span>            : 
<span class="lineNum">    1176 </span><span class="lineNoCov">          0 :     memset(&amp;a,0,sizeof(a));</span>
<span class="lineNum">    1177 </span><span class="lineNoCov">          0 :     a.sc = sc;</span>
<span class="lineNum">    1178 </span><span class="lineNoCov">          0 :     a.ap = ap;</span>
<span class="lineNum">    1179 </span><span class="lineNoCov">          0 :     a.apos = ap-&gt;me;</span>
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :     a.pixelsize = aa_pixelsize;</span>
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 :     a.magfactor = 1;</span>
<span class="lineNum">    1182 </span><span class="lineNoCov">          0 :     a.layer = layer;</span>
<span class="lineNum">    1183 </span><span class="lineNoCov">          0 :     if ( ap-&gt;xadjust.corrections!=NULL ) {</span>
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :         int len = ap-&gt;xadjust.last_pixel_size-ap-&gt;xadjust.first_pixel_size+1;</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :         a.xadjust = ap-&gt;xadjust;</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :         a.xadjust.corrections = malloc(len);</span>
<span class="lineNum">    1187 </span><span class="lineNoCov">          0 :         memcpy(a.xadjust.corrections,ap-&gt;xadjust.corrections,len);</span>
<span class="lineNum">    1188 </span>            :     }
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 :     if ( ap-&gt;yadjust.corrections!=NULL ) {</span>
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :         int len = ap-&gt;yadjust.last_pixel_size-ap-&gt;yadjust.first_pixel_size+1;</span>
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 :         a.yadjust = ap-&gt;yadjust;</span>
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :         a.yadjust.corrections = malloc(len);</span>
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :         memcpy(a.yadjust.corrections,ap-&gt;yadjust.corrections,len);</span>
<span class="lineNum">    1194 </span>            :     }
<span class="lineNum">    1195 </span>            : 
<span class="lineNum">    1196 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    1197 </span>            : 
<span class="lineNum">    1198 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_isdlg|wam_restrict;</span>
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :     wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">    1200 </span><span class="lineNoCov">          0 :     wattrs.restrict_input_to_me = true;</span>
<span class="lineNum">    1201 </span><span class="lineNoCov">          0 :     wattrs.undercursor = 1;</span>
<span class="lineNum">    1202 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_pointer;</span>
<span class="lineNum">    1203 </span><span class="lineNoCov">          0 :     wattrs.utf8_window_title = _(&quot;Anchor Control...&quot;);</span>
<span class="lineNum">    1204 </span><span class="lineNoCov">          0 :     wattrs.is_dlg = true;</span>
<span class="lineNum">    1205 </span><span class="lineNoCov">          0 :     GDrawGetSize(GDrawGetRoot(NULL),&amp;pos);</span>
<span class="lineNum">    1206 </span><span class="lineNoCov">          0 :     pos.x = pos.y = 0;</span>
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :     pos.height = GDrawPointsToPixels(NULL,210);</span>
<span class="lineNum">    1208 </span><span class="lineNoCov">          0 :     if ( pos.height&lt;aa_pixelsize+40+25 )</span>
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :         pos.height = aa_pixelsize+40+25;</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :     pos.width -= 50;</span>
<span class="lineNum">    1211 </span><span class="lineNoCov">          0 :     a.gw = gw = GDrawCreateTopWindow(NULL,&amp;pos,anchord_e_h,&amp;a,&amp;wattrs);</span>
<span class="lineNum">    1212 </span>            : 
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :     a.ctl_len = GDrawPointsToPixels(gw,140);</span>
<span class="lineNum">    1214 </span><span class="lineNoCov">          0 :     a.sb_height = GDrawPointsToPixels(gw,_GScrollBar_Width);</span>
<span class="lineNum">    1215 </span><span class="lineNoCov">          0 :     a.sb_base = pos.height - a.sb_height;</span>
<span class="lineNum">    1216 </span>            : 
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 :     memset(maingcd,0,sizeof(maingcd));</span>
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :     memset(&amp;buttonbox,0,sizeof(buttonbox));</span>
<span class="lineNum">    1219 </span><span class="lineNoCov">          0 :     memset(&amp;glyphbox,0,sizeof(glyphbox));</span>
<span class="lineNum">    1220 </span><span class="lineNoCov">          0 :     memset(gcd,0,sizeof(gcd));</span>
<span class="lineNum">    1221 </span><span class="lineNoCov">          0 :     memset(label,0,sizeof(label));</span>
<span class="lineNum">    1222 </span><span class="lineNoCov">          0 :     k = hv = 0;</span>
<span class="lineNum">    1223 </span>            : 
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled ;</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_Glyph;</span>
<span class="lineNum">    1226 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = AnchorD_GlyphChanged;</span>
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GListButtonCreate;</span>
<span class="lineNum">    1228 </span>            : 
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :     glypharray[0] = GCD_Glue; glypharray[1] = &amp;gcd[k-1]; glypharray[2] = GCD_Glue; glypharray[3] = NULL;</span>
<span class="lineNum">    1230 </span>            : 
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :     glyphbox.gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :     glyphbox.gd.u.boxelements = glypharray;</span>
<span class="lineNum">    1233 </span><span class="lineNoCov">          0 :     glyphbox.creator = GHBoxCreate;</span>
<span class="lineNum">    1234 </span>            : 
<span class="lineNum">    1235 </span><span class="lineNoCov">          0 :     hvarray[hv++] = &amp;glyphbox; hvarray[hv++] = GCD_ColSpan; hvarray[hv++] = GCD_ColSpan;</span>
<span class="lineNum">    1236 </span><span class="lineNoCov">          0 :     hvarray[hv++] = GCD_ColSpan; hvarray[hv++] = GCD_Glue; hvarray[hv++] = NULL;</span>
<span class="lineNum">    1237 </span>            : 
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;_Size:&quot;);</span>
<span class="lineNum">    1239 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 :     label[k].text_in_resource = true;</span>
<span class="lineNum">    1241 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 5; gcd[k].gd.pos.y = 9;</span>
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled  | gg_utf8_popup;</span>
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :     hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_ColSpan;</span>
<span class="lineNum">    1246 </span>            : 
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :     sprintf( buffer, &quot;%d&quot;, a.pixelsize );</span>
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) buffer;</span>
<span class="lineNum">    1249 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 40; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y-4;</span>
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = 60;</span>
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled | gg_utf8_popup ;</span>
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_DisplaySize;</span>
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = AnchorD_DisplaySizeChanged;</span>
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = gcd[k-1].gd.popup_msg = (unichar_t *)</span>
<span class="lineNum">    1257 </span><span class="lineNoCov">          0 :             _(&quot;The size at which the current glyph is rasterized.\nFor small pixelsize you may want to use the magnification\nfactor below to get a clearer view.\n\nThe pulldown list contains the pixelsizes at which there\nare device table corrections.&quot;);</span>
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GListFieldCreate;</span>
<span class="lineNum">    1259 </span><span class="lineNoCov">          0 :     hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_ColSpan; hvarray[hv++] = GCD_Glue; hvarray[hv++] = NULL;</span>
<span class="lineNum">    1260 </span>            : 
<span class="lineNum">    1261 </span>            : /* GT: Short for: Magnification */
<span class="lineNum">    1262 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Mag:&quot;);</span>
<span class="lineNum">    1263 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1265 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = gcd[k-2].gd.pos.y+26;</span>
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled  | gg_utf8_popup ;</span>
<span class="lineNum">    1267 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    1268 </span><span class="lineNoCov">          0 :     hvarray[hv++] = GCD_HPad10; hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_ColSpan;</span>
<span class="lineNum">    1269 </span>            : 
<span class="lineNum">    1270 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 45; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y-4;</span>
<span class="lineNum">    1271 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled  | gg_utf8_popup ;</span>
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_Mag;</span>
<span class="lineNum">    1273 </span><span class="lineNoCov">          0 :     gcd[k].gd.u.list = magnifications;</span>
<span class="lineNum">    1274 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = AnchorD_MagnificationChanged;</span>
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = gcd[k-1].gd.popup_msg = (unichar_t *)</span>
<span class="lineNum">    1276 </span><span class="lineNoCov">          0 :             _(&quot;The glyph is rasterized at the size above, but it\nmay be difficult to see the alignment errors\nthat can happen at small pixelsizes. This allows\nyou to expand each pixel to show potential problems\nbetter.&quot;);</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GListButtonCreate;</span>
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 :     hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_Glue; hvarray[hv++] = NULL;</span>
<span class="lineNum">    1279 </span>            : 
<span class="lineNum">    1280 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;_X&quot;);</span>
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1282 </span><span class="lineNoCov">          0 :     label[k].text_in_resource = true;</span>
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 5; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+30;</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled  | gg_utf8_popup ;</span>
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :     hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_ColSpan;</span>
<span class="lineNum">    1288 </span>            : 
<span class="lineNum">    1289 </span><span class="lineNoCov">          0 :     sprintf( xbuf, &quot;%d&quot;, (int) rint(ap-&gt;me.x) );</span>
<span class="lineNum">    1290 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) xbuf;</span>
<span class="lineNum">    1291 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1292 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1293 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 40; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y-4;</span>
<span class="lineNum">    1294 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = 60;</span>
<span class="lineNum">    1295 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled  | gg_utf8_popup ;</span>
<span class="lineNum">    1296 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_X;</span>
<span class="lineNum">    1297 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = AnchorD_PositionChanged;</span>
<span class="lineNum">    1298 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = gcd[k-1].gd.popup_msg = (unichar_t *)</span>
<span class="lineNum">    1299 </span><span class="lineNoCov">          0 :             _(&quot;The X coordinate of the anchor point in this glyph&quot;);</span>
<span class="lineNum">    1300 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GNumericFieldCreate;</span>
<span class="lineNum">    1301 </span><span class="lineNoCov">          0 :     hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_ColSpan; hvarray[hv++] = GCD_Glue; hvarray[hv++] = NULL;</span>
<span class="lineNum">    1302 </span>            : 
<span class="lineNum">    1303 </span>            : /* GT: Short for Correction */
<span class="lineNum">    1304 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Cor:&quot;);</span>
<span class="lineNum">    1305 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1306 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1307 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+30;</span>
<span class="lineNum">    1308 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled | gg_utf8_popup ;</span>
<span class="lineNum">    1309 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Correction in pixels to the horizontal positioning of this anchor point\nwhen rasterizing at the given pixelsize.\n(Lives in a Device Table)&quot;);</span>
<span class="lineNum">    1310 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    1311 </span><span class="lineNoCov">          0 :     hvarray[hv++] = GCD_HPad10; hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_ColSpan;</span>
<span class="lineNum">    1312 </span>            : 
<span class="lineNum">    1313 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) &quot;0&quot;;</span>
<span class="lineNum">    1314 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1315 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 45; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y-4;</span>
<span class="lineNum">    1317 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = 60;</span>
<span class="lineNum">    1318 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled  | gg_utf8_popup ;</span>
<span class="lineNum">    1319 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_XCor;</span>
<span class="lineNum">    1320 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = AnchorD_CorrectionChanged;</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = gcd[k-1].gd.popup_msg = (unichar_t *)</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 :             _(&quot;This is the number of pixels by which the anchor\nshould be moved horizontally when the glyph is\nrasterized at the above size.  This information\nis part of the device table for this anchor.\nDevice tables are particularly important at small\npixelsizes where rounding errors will have a\nproportionally greater effect.&quot;);</span>
<span class="lineNum">    1323 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GNumericFieldCreate;</span>
<span class="lineNum">    1324 </span><span class="lineNoCov">          0 :     hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_Glue; hvarray[hv++] = NULL;</span>
<span class="lineNum">    1325 </span>            : 
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;_Y&quot;);</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 :     label[k].text_in_resource = true;</span>
<span class="lineNum">    1329 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1330 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 5; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+30;</span>
<span class="lineNum">    1331 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled  | gg_utf8_popup ;</span>
<span class="lineNum">    1332 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    1333 </span><span class="lineNoCov">          0 :     hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_ColSpan;</span>
<span class="lineNum">    1334 </span>            : 
<span class="lineNum">    1335 </span><span class="lineNoCov">          0 :     sprintf( ybuf, &quot;%d&quot;, (int) rint(ap-&gt;me.y) );</span>
<span class="lineNum">    1336 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) ybuf;</span>
<span class="lineNum">    1337 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 40; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y-4;</span>
<span class="lineNum">    1340 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = 60;</span>
<span class="lineNum">    1341 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled  | gg_utf8_popup ;</span>
<span class="lineNum">    1342 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_Y;</span>
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = AnchorD_PositionChanged;</span>
<span class="lineNum">    1344 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = gcd[k-1].gd.popup_msg = (unichar_t *)</span>
<span class="lineNum">    1345 </span><span class="lineNoCov">          0 :             _(&quot;The Y coordinate of the anchor point in this glyph&quot;);</span>
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GNumericFieldCreate;</span>
<span class="lineNum">    1347 </span><span class="lineNoCov">          0 :     hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_ColSpan; hvarray[hv++] = GCD_Glue; hvarray[hv++] = NULL;</span>
<span class="lineNum">    1348 </span>            : 
<span class="lineNum">    1349 </span>            : /* GT: Short for Correction */
<span class="lineNum">    1350 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Cor:&quot;);</span>
<span class="lineNum">    1351 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1352 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1353 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+30;</span>
<span class="lineNum">    1354 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled | gg_utf8_popup ;</span>
<span class="lineNum">    1355 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Correction in pixels to the horizontal positioning of this anchor point\nwhen rasterizing at the given pixelsize.\n(Lives in a Device Table)&quot;);</span>
<span class="lineNum">    1356 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    1357 </span><span class="lineNoCov">          0 :     hvarray[hv++] = GCD_HPad10; hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_ColSpan;</span>
<span class="lineNum">    1358 </span>            : 
<span class="lineNum">    1359 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) &quot;0&quot;;</span>
<span class="lineNum">    1360 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1361 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1362 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 45; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y-4;</span>
<span class="lineNum">    1363 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = 60;</span>
<span class="lineNum">    1364 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled  | gg_utf8_popup ;</span>
<span class="lineNum">    1365 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_YCor;</span>
<span class="lineNum">    1366 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = AnchorD_CorrectionChanged;</span>
<span class="lineNum">    1367 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = gcd[k-1].gd.popup_msg = (unichar_t *)</span>
<span class="lineNum">    1368 </span><span class="lineNoCov">          0 :             _(&quot;This is the number of pixels by which the anchor\nshould be moved vertically when the glyph is\nrasterized at the above size.  This information\nis part of the device table for this anchor.\nDevice tables are particularly important at small\npixelsizes where rounding errors will have a\nproportionally greater effect.&quot;);</span>
<span class="lineNum">    1369 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GNumericFieldCreate;</span>
<span class="lineNum">    1370 </span><span class="lineNoCov">          0 :     hvarray[hv++] = &amp;gcd[k-1]; hvarray[hv++] = GCD_Glue; hvarray[hv++] = NULL;</span>
<span class="lineNum">    1371 </span>            : 
<span class="lineNum">    1372 </span><span class="lineNoCov">          0 :     hvarray[hv++] = GCD_Glue; hvarray[hv++] = GCD_Glue; hvarray[hv++] = GCD_Glue;</span>
<span class="lineNum">    1373 </span><span class="lineNoCov">          0 :     hvarray[hv++] = GCD_Glue; hvarray[hv++] = GCD_Glue; hvarray[hv++] = NULL;</span>
<span class="lineNum">    1374 </span>            : 
<span class="lineNum">    1375 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">    1376 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :     label[k].text_in_resource = true;</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1379 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 5; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+40;</span>
<span class="lineNum">    1380 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = -1;</span>
<span class="lineNum">    1381 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled|gg_but_default;</span>
<span class="lineNum">    1382 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = AnchorD_OK;</span>
<span class="lineNum">    1383 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GButtonCreate;</span>
<span class="lineNum">    1384 </span><span class="lineNoCov">          0 :     buttonarray[0] = GCD_Glue; buttonarray[1] = &amp;gcd[k-1]; buttonarray[2] = GCD_Glue;</span>
<span class="lineNum">    1385 </span>            : 
<span class="lineNum">    1386 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    1387 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    1388 </span><span class="lineNoCov">          0 :     label[k].text_in_resource = true;</span>
<span class="lineNum">    1389 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    1390 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 80; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+3;</span>
<span class="lineNum">    1391 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = -1;</span>
<span class="lineNum">    1392 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible|gg_enabled|gg_but_cancel;</span>
<span class="lineNum">    1393 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = AnchorD_Cancel;</span>
<span class="lineNum">    1394 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GButtonCreate;</span>
<span class="lineNum">    1395 </span><span class="lineNoCov">          0 :     buttonarray[3] = GCD_Glue; buttonarray[4] = &amp;gcd[k-1]; buttonarray[5] = GCD_Glue;</span>
<span class="lineNum">    1396 </span><span class="lineNoCov">          0 :     buttonarray[6] = NULL;</span>
<span class="lineNum">    1397 </span>            : 
<span class="lineNum">    1398 </span><span class="lineNoCov">          0 :     buttonbox.gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1399 </span><span class="lineNoCov">          0 :     buttonbox.gd.u.boxelements = buttonarray;</span>
<span class="lineNum">    1400 </span><span class="lineNoCov">          0 :     buttonbox.creator = GHBoxCreate;</span>
<span class="lineNum">    1401 </span>            : 
<span class="lineNum">    1402 </span><span class="lineNoCov">          0 :     hvarray[hv++] = &amp;buttonbox; hvarray[hv++] = GCD_ColSpan; hvarray[hv++] = GCD_ColSpan;</span>
<span class="lineNum">    1403 </span><span class="lineNoCov">          0 :     hvarray[hv++] = GCD_ColSpan; hvarray[hv++] = GCD_Glue; hvarray[hv++] = NULL;</span>
<span class="lineNum">    1404 </span><span class="lineNoCov">          0 :     hvarray[hv++] = NULL;</span>
<span class="lineNum">    1405 </span>            : 
<span class="lineNum">    1406 </span><span class="lineNoCov">          0 :     maingcd[0].gd.pos.x = maingcd[0].gd.pos.y = 5;</span>
<span class="lineNum">    1407 </span><span class="lineNoCov">          0 :     maingcd[0].gd.pos.height = pos.height - 10;</span>
<span class="lineNum">    1408 </span>            : /*    maingcd[0].gd.pos.width = a.ctl_len - 10; */
<span class="lineNum">    1409 </span><span class="lineNoCov">          0 :     maingcd[0].gd.flags = gg_enabled|gg_visible|gg_pos_in_pixels;</span>
<span class="lineNum">    1410 </span><span class="lineNoCov">          0 :     maingcd[0].gd.u.boxelements = hvarray;</span>
<span class="lineNum">    1411 </span><span class="lineNoCov">          0 :     maingcd[0].creator = GHVBoxCreate;</span>
<span class="lineNum">    1412 </span>            : 
<span class="lineNum">    1413 </span><span class="lineNoCov">          0 :     maingcd[1].gd.pos.x = 300;</span>
<span class="lineNum">    1414 </span><span class="lineNoCov">          0 :     maingcd[1].gd.pos.y = pos.height-a.sb_height;</span>
<span class="lineNum">    1415 </span><span class="lineNoCov">          0 :     maingcd[1].gd.pos.height = a.sb_height;</span>
<span class="lineNum">    1416 </span><span class="lineNoCov">          0 :     maingcd[1].gd.pos.width = pos.width-300;</span>
<span class="lineNum">    1417 </span><span class="lineNoCov">          0 :     maingcd[1].gd.flags = gg_visible|gg_enabled|gg_pos_in_pixels;</span>
<span class="lineNum">    1418 </span><span class="lineNoCov">          0 :     maingcd[1].creator = GScrollBarCreate;</span>
<span class="lineNum">    1419 </span>            : 
<span class="lineNum">    1420 </span><span class="lineNoCov">          0 :     GGadgetsCreate(a.gw,maingcd);</span>
<span class="lineNum">    1421 </span><span class="lineNoCov">          0 :     GGadgetSetList(gcd[0].ret,AnchorD_GlyphsInClass(&amp;a),false);</span>
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 :     GTextInfoListFree(gcd[0].gd.u.list);</span>
<span class="lineNum">    1423 </span>            : 
<span class="lineNum">    1424 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(maingcd[0].ret,gb_expandglue);</span>
<span class="lineNum">    1425 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(maingcd[0].ret,4);</span>
<span class="lineNum">    1426 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(buttonbox.ret,gb_expandgluesame);</span>
<span class="lineNum">    1427 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(glyphbox.ret,gb_expandglue);</span>
<span class="lineNum">    1428 </span><span class="lineNoCov">          0 :     GGadgetGetDesiredSize(maingcd[0].ret,&amp;boxsize,NULL);</span>
<span class="lineNum">    1429 </span><span class="lineNoCov">          0 :     a.ctl_len = boxsize.width + 10;</span>
<span class="lineNum">    1430 </span>            :     
<span class="lineNum">    1431 </span><span class="lineNoCov">          0 :     a.hsb = maingcd[1].ret;</span>
<span class="lineNum">    1432 </span>            : 
<span class="lineNum">    1433 </span><span class="lineNoCov">          0 :     AnchorD_FindComplements(&amp;a);</span>
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :     AnchorD_SetDevTabs(&amp;a);</span>
<span class="lineNum">    1435 </span><span class="lineNoCov">          0 :     AnchorD_ChangeSize(&amp;a);</span>
<span class="lineNum">    1436 </span><span class="lineNoCov">          0 :     AnchorD_SetTitle(&amp;a);</span>
<span class="lineNum">    1437 </span>            : 
<span class="lineNum">    1438 </span><span class="lineNoCov">          0 :     GDrawSetVisible(a.gw,true);</span>
<span class="lineNum">    1439 </span><span class="lineNoCov">          0 :     while ( !a.done )</span>
<span class="lineNum">    1440 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">    1441 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(a.gw);</span>
<span class="lineNum">    1442 </span><span class="lineNoCov">          0 :     AnchorD_FreeAll(&amp;a);</span>
<a name="1443"><span class="lineNum">    1443 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1444 </span>            : 
<span class="lineNum">    1445 </span><span class="lineNoCov">          0 : void AnchorControlClass(SplineFont *_sf,AnchorClass *ac,int layer) {</span>
<span class="lineNum">    1446 </span>            :     /* Pick a random glyph with an anchor point in the class. If no glyph, */
<span class="lineNum">    1447 </span>            :     /*  give user the chance to create one */
<span class="lineNum">    1448 </span><span class="lineNoCov">          0 :     SplineChar *sc, *scmark = NULL;</span>
<span class="lineNum">    1449 </span><span class="lineNoCov">          0 :     AnchorPoint *ap, *apmark = NULL;</span>
<span class="lineNum">    1450 </span>            :     SplineFont *sf;
<span class="lineNum">    1451 </span>            :     int k, gid;
<span class="lineNum">    1452 </span>            : 
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :     if ( _sf-&gt;cidmaster!=NULL ) _sf = _sf-&gt;cidmaster;</span>
<span class="lineNum">    1454 </span><span class="lineNoCov">          0 :     k=0;</span>
<span class="lineNum">    1455 </span><span class="lineNoCov">          0 :     ap = NULL;</span>
<span class="lineNum">    1456 </span>            :     do {
<span class="lineNum">    1457 </span><span class="lineNoCov">          0 :         sf = _sf-&gt;subfontcnt==0 ? _sf : _sf-&gt;subfonts[k];</span>
<span class="lineNum">    1458 </span><span class="lineNoCov">          0 :         for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( (sc = sf-&gt;glyphs[gid])!=NULL ) {</span>
<span class="lineNum">    1459 </span><span class="lineNoCov">          0 :             for ( ap=sc-&gt;anchor; ap!=NULL; ap=ap-&gt;next ) {</span>
<span class="lineNum">    1460 </span><span class="lineNoCov">          0 :                 if ( ap-&gt;anchor==ac ) {</span>
<span class="lineNum">    1461 </span><span class="lineNoCov">          0 :                     if ( ap-&gt;type!=at_mark &amp;&amp; ap-&gt;type!=at_centry )</span>
<span class="lineNum">    1462 </span>            :             break;
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 :                     else if ( scmark==NULL ) {</span>
<span class="lineNum">    1464 </span><span class="lineNoCov">          0 :                         scmark = sc;</span>
<span class="lineNum">    1465 </span><span class="lineNoCov">          0 :                         apmark = ap;</span>
<span class="lineNum">    1466 </span>            :                     }
<span class="lineNum">    1467 </span>            :                 }
<span class="lineNum">    1468 </span>            :             }
<span class="lineNum">    1469 </span><span class="lineNoCov">          0 :             if ( ap!=NULL )</span>
<span class="lineNum">    1470 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1471 </span>            :         }
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 :         if ( ap!=NULL )</span>
<span class="lineNum">    1473 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1474 </span><span class="lineNoCov">          0 :         ++k;</span>
<span class="lineNum">    1475 </span><span class="lineNoCov">          0 :     } while ( k&lt;_sf-&gt;subfontcnt );</span>
<span class="lineNum">    1476 </span>            : 
<span class="lineNum">    1477 </span><span class="lineNoCov">          0 :     if ( ap==NULL ) {</span>
<span class="lineNum">    1478 </span><span class="lineNoCov">          0 :         sc = scmark;</span>
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 :         ap = apmark;</span>
<span class="lineNum">    1480 </span>            :     }
<span class="lineNum">    1481 </span><span class="lineNoCov">          0 :     if ( ap==NULL ) {</span>
<span class="lineNum">    1482 </span><span class="lineNoCov">          0 :         sc = AddAnchor(NULL,_sf,ac,-1);</span>
<span class="lineNum">    1483 </span><span class="lineNoCov">          0 :         if ( sc==NULL )</span>
<span class="lineNum">    1484 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1485 </span><span class="lineNoCov">          0 :         for ( ap=sc-&gt;anchor; ap!=NULL; ap=ap-&gt;next ) {</span>
<span class="lineNum">    1486 </span><span class="lineNoCov">          0 :             if ( ap-&gt;anchor==ac )</span>
<span class="lineNum">    1487 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1488 </span>            :         }
<span class="lineNum">    1489 </span><span class="lineNoCov">          0 :         if ( ap==NULL )         /* Can't happen */</span>
<span class="lineNum">    1490 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1491 </span>            :     }
<span class="lineNum">    1492 </span>            :         
<span class="lineNum">    1493 </span><span class="lineNoCov">          0 :     AnchorControl(sc,ap,layer);</span>
<span class="lineNum">    1494 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
