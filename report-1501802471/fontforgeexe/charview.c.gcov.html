<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd) - fontforgeexe/charview.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">fontforgeexe</a> - charview.c<span style="font-size: 80%;"> (source / <a href="charview.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd)</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">92</td>
            <td class="headerCovTableEntry">8080</td>
            <td class="headerCovTableEntryLo">1.1 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-08-04</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">9</td>
            <td class="headerCovTableEntry">433</td>
            <td class="headerCovTableEntryLo">2.1 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* Copyright (C) 2000-2012 by George Williams */</a>
<span class="lineNum">       2 </span>            : /*
<span class="lineNum">       3 </span>            :  * Redistribution and use in source and binary forms, with or without
<span class="lineNum">       4 </span>            :  * modification, are permitted provided that the following conditions are met:
<span class="lineNum">       5 </span>            : 
<span class="lineNum">       6 </span>            :  * Redistributions of source code must retain the above copyright notice, this
<span class="lineNum">       7 </span>            :  * list of conditions and the following disclaimer.
<span class="lineNum">       8 </span>            : 
<span class="lineNum">       9 </span>            :  * Redistributions in binary form must reproduce the above copyright notice,
<span class="lineNum">      10 </span>            :  * this list of conditions and the following disclaimer in the documentation
<span class="lineNum">      11 </span>            :  * and/or other materials provided with the distribution.
<span class="lineNum">      12 </span>            : 
<span class="lineNum">      13 </span>            :  * The name of the author may not be used to endorse or promote products
<span class="lineNum">      14 </span>            :  * derived from this software without specific prior written permission.
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            :  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
<span class="lineNum">      17 </span>            :  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
<span class="lineNum">      18 </span>            :  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
<span class="lineNum">      19 </span>            :  * EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span class="lineNum">      20 </span>            :  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
<span class="lineNum">      21 </span>            :  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
<span class="lineNum">      22 </span>            :  * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
<span class="lineNum">      23 </span>            :  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
<span class="lineNum">      24 </span>            :  * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
<span class="lineNum">      25 </span>            :  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span class="lineNum">      26 </span>            :  */
<span class="lineNum">      27 </span>            : #include &lt;fontforge-config.h&gt;
<span class="lineNum">      28 </span>            : 
<span class="lineNum">      29 </span>            : #include &quot;autohint.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;autosave.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;autotrace.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;autowidth.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;cvruler.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;cvundoes.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;dumppfa.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;encoding.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;fontforgeui.h&quot;
<span class="lineNum">      38 </span>            : #include &quot;fvcomposite.h&quot;
<span class="lineNum">      39 </span>            : #include &quot;fvfonts.h&quot;
<span class="lineNum">      40 </span>            : #include &quot;lookups.h&quot;
<span class="lineNum">      41 </span>            : #include &quot;mm.h&quot;
<span class="lineNum">      42 </span>            : #include &quot;namelist.h&quot;
<span class="lineNum">      43 </span>            : #include &quot;sfd.h&quot;
<span class="lineNum">      44 </span>            : #include &quot;spiro.h&quot;
<span class="lineNum">      45 </span>            : #include &quot;splinefill.h&quot;
<span class="lineNum">      46 </span>            : #include &quot;splineorder2.h&quot;
<span class="lineNum">      47 </span>            : #include &quot;splineoverlap.h&quot;
<span class="lineNum">      48 </span>            : #include &quot;splinesaveafm.h&quot;
<span class="lineNum">      49 </span>            : #include &quot;splineutil.h&quot;
<span class="lineNum">      50 </span>            : #include &quot;splineutil2.h&quot;
<span class="lineNum">      51 </span>            : #include &lt;math.h&gt;
<span class="lineNum">      52 </span>            : #include &lt;locale.h&gt;
<span class="lineNum">      53 </span>            : #include &lt;ustring.h&gt;
<span class="lineNum">      54 </span>            : #include &lt;utype.h&gt;
<span class="lineNum">      55 </span>            : #include &lt;gresource.h&gt;
<span class="lineNum">      56 </span>            : #include &lt;gresedit.h&gt;
<span class="lineNum">      57 </span>            : #include &lt;dlist.h&gt;
<span class="lineNum">      58 </span>            : extern int _GScrollBar_Width;
<span class="lineNum">      59 </span>            : #include &lt;gkeysym.h&gt;
<span class="lineNum">      60 </span>            : #ifdef HAVE_IEEEFP_H
<span class="lineNum">      61 </span>            : # include &lt;ieeefp.h&gt;              /* Solaris defines isnan in ieeefp rather than math.h */
<span class="lineNum">      62 </span>            : #endif
<span class="lineNum">      63 </span>            : #include &quot;dlist.h&quot;
<span class="lineNum">      64 </span>            : #include &quot;c-strtod.h&quot;
<span class="lineNum">      65 </span>            : 
<span class="lineNum">      66 </span>            : #include &quot;gutils/prefs.h&quot;
<span class="lineNum">      67 </span>            : #include &quot;collabclientui.h&quot;
<span class="lineNum">      68 </span>            : #include &quot;gutils/unicodelibinfo.h&quot;
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span>            : #include &quot;gdraw/hotkeys.h&quot;
<span class="lineNum">      71 </span>            : #include &quot;wordlistparser.h&quot;
<span class="lineNum">      72 </span>            : 
<span class="lineNum">      73 </span>            : #include &quot;charview_private.h&quot;
<span class="lineNum">      74 </span>            : 
<span class="lineNum">      75 </span>            : /* Barry wants to be able to redefine menu bindings only in the charview (I think) */
<span class="lineNum">      76 </span>            : /*  the menu parser will first check for something like &quot;CV*Open|Ctl+O&quot;, and */
<span class="lineNum">      77 </span>            : /*  if that fails will strip off &quot;CV*&quot; and check for &quot;Open|Ctl+O&quot; */
<span class="lineNum">      78 </span>            : #undef H_
<span class="lineNum">      79 </span>            : #define H_(str) (&quot;CV*&quot; str)
<span class="lineNum">      80 </span>            : 
<span class="lineNum">      81 </span>            : extern void UndoesFreeButRetainFirstN( Undoes** undopp, int retainAmount );
<span class="lineNum">      82 </span>            : static void CVMoveInWordListByOffset( CharView* cv, int offset );
<span class="lineNum">      83 </span>            : extern void CVDebugFree( DebugView *dv );
<span class="lineNum">      84 </span>            : 
<span class="lineNum">      85 </span>            : int additionalCharsToShowLimit = 50;
<span class="lineNum">      86 </span>            : 
<span class="lineNum">      87 </span>            : int ItalicConstrained=true;
<span class="lineNum">      88 </span>            : float arrowAmount=1;
<span class="lineNum">      89 </span>            : float arrowAccelFactor=10.;
<span class="lineNum">      90 </span>            : float snapdistance=3.5;
<span class="lineNum">      91 </span>            : float snapdistancemeasuretool=3.5;
<span class="lineNum">      92 </span>            : int xorrubberlines=false;
<span class="lineNum">      93 </span>            : int updateflex = false;
<span class="lineNum">      94 </span>            : extern int clear_tt_instructions_when_needed;
<span class="lineNum">      95 </span>            : int use_freetype_with_aa_fill_cv = 1;
<span class="lineNum">      96 </span>            : int interpCPsOnMotion=false;
<span class="lineNum">      97 </span>            : int DrawOpenPathsWithHighlight = 1;
<span class="lineNum">      98 </span>            : #define default_cv_width 540
<span class="lineNum">      99 </span>            : #define default_cv_height 540
<span class="lineNum">     100 </span>            : int cv_width = default_cv_width;
<span class="lineNum">     101 </span>            : int cv_height = default_cv_height;
<span class="lineNum">     102 </span>            : int cv_show_fill_with_space = 1;
<span class="lineNum">     103 </span>            : 
<span class="lineNum">     104 </span>            : #define prefs_cvEditHandleSize_default 5.0
<span class="lineNum">     105 </span>            : float prefs_cvEditHandleSize = prefs_cvEditHandleSize_default;
<span class="lineNum">     106 </span>            : 
<span class="lineNum">     107 </span>            : int   prefs_cvInactiveHandleAlpha = 255;
<span class="lineNum">     108 </span>            : 
<span class="lineNum">     109 </span>            : int prefs_cv_show_control_points_always_initially = 0;
<span class="lineNum">     110 </span>            : int prefs_create_dragging_comparison_outline = 0;
<span class="lineNum">     111 </span>            : 
<span class="lineNum">     112 </span>            : extern struct lconv localeinfo;
<span class="lineNum">     113 </span>            : extern char *coord_sep;
<span class="lineNum">     114 </span>            : struct cvshows CVShows = {
<span class="lineNum">     115 </span>            :         1,              /* show foreground */
<span class="lineNum">     116 </span>            :         1,              /* show background */
<span class="lineNum">     117 </span>            :         1,              /* show grid plane */
<span class="lineNum">     118 </span>            :         1,              /* show horizontal hints */
<span class="lineNum">     119 </span>            :         1,              /* show vertical hints */
<span class="lineNum">     120 </span>            :         1,              /* show diagonal hints */
<span class="lineNum">     121 </span>            :         1,              /* show points */
<span class="lineNum">     122 </span>            :         0,              /* show filled */
<span class="lineNum">     123 </span>            :         1,              /* show rulers */
<span class="lineNum">     124 </span>            :         1,              /* show points which are to be rounded to the ttf grid and aren't on hints */
<span class="lineNum">     125 </span>            :         1,              /* show x minimum distances */
<span class="lineNum">     126 </span>            :         1,              /* show y minimum distances */
<span class="lineNum">     127 </span>            :         1,              /* show horizontal metrics */
<span class="lineNum">     128 </span>            :         0,              /* show vertical metrics */
<span class="lineNum">     129 </span>            :         0,              /* mark extrema */
<span class="lineNum">     130 </span>            :         0,              /* show points of inflection */
<span class="lineNum">     131 </span>            :         1,              /* show blue values */
<span class="lineNum">     132 </span>            :         1,              /* show family blues too */
<span class="lineNum">     133 </span>            :         1,              /* show anchor points */
<span class="lineNum">     134 </span>            :         0,              /* show control point info when moving them */
<span class="lineNum">     135 </span>            :         1,              /* show tabs containing names of former glyphs */
<span class="lineNum">     136 </span>            :         1,              /* show side bearings */
<span class="lineNum">     137 </span>            :         1,              /* show the names of references */
<span class="lineNum">     138 </span>            :         1,              /* snap outlines to pixel grid */
<span class="lineNum">     139 </span>            :         0,              /* show lines which are almost, but not exactly horizontal or vertical */
<span class="lineNum">     140 </span>            :         0,              /* show curves which are almost, but not exactly horizontal or vertical at the end-points */
<span class="lineNum">     141 </span>            :         3,              /* number of em-units a coord difference must be less than to qualify for almost hv */
<span class="lineNum">     142 </span>            :         1,              /* Check for self-intersections in the element view */
<span class="lineNum">     143 </span>            :         1               /* In tt debugging, mark changed rasters differently */
<span class="lineNum">     144 </span>            : };
<span class="lineNum">     145 </span>            : struct cvshows CVShowsPrevewToggleSavedState;
<span class="lineNum">     146 </span>            : 
<span class="lineNum">     147 </span>            : #define CID_Base              1001
<span class="lineNum">     148 </span>            : #define CID_getValueFromUser  CID_Base + 1
<span class="lineNum">     149 </span>            : 
<span class="lineNum">     150 </span>            : 
<span class="lineNum">     151 </span>            : // Note that the default values supplied in CVColInit over-ride these values.
<span class="lineNum">     152 </span>            : static Color pointcol = 0xff0000;
<span class="lineNum">     153 </span>            : static Color subcol = 0xffffff;
<span class="lineNum">     154 </span>            : static Color firstpointcol = 0x707000;
<span class="lineNum">     155 </span>            : static Color selectedpointcol = 0xc8c800;
<span class="lineNum">     156 </span>            : static int selectedpointwidth = 2;
<span class="lineNum">     157 </span>            : static Color extremepointcol = 0xCAA80A;
<span class="lineNum">     158 </span>            : static Color pointofinflectioncol = 0x008080;
<span class="lineNum">     159 </span>            : static Color almosthvcol = 0x00ff80;
<span class="lineNum">     160 </span>            : Color nextcpcol = 0x007090;
<span class="lineNum">     161 </span>            : Color prevcpcol = 0xcc00cc;
<span class="lineNum">     162 </span>            : static Color selectedcpcol = 0xffffff;
<span class="lineNum">     163 </span>            : static Color coordcol = 0x808080;
<span class="lineNum">     164 </span>            : Color widthcol = 0x000000;
<span class="lineNum">     165 </span>            : static Color widthselcol = 0x00ff00;
<span class="lineNum">     166 </span>            : static Color lbearingselcol = 0x00ff00;
<span class="lineNum">     167 </span>            : static Color widthgridfitcol = 0x009800;
<span class="lineNum">     168 </span>            : static Color lcaretcol = 0x909040;
<span class="lineNum">     169 </span>            : static Color rastercol = 0xffa0a0a0;            /* Translucent */
<span class="lineNum">     170 </span>            : static Color rasternewcol = 0xff909090;
<span class="lineNum">     171 </span>            : static Color rasteroldcol = 0xffc0c0c0;
<span class="lineNum">     172 </span>            : static Color rastergridcol = 0xffb0b0ff;
<span class="lineNum">     173 </span>            : static Color rasterdarkcol = 0xff606060;
<span class="lineNum">     174 </span>            : static Color deltagridcol = 0xcc0000;
<span class="lineNum">     175 </span>            : static Color italiccoordcol = 0x909090;
<span class="lineNum">     176 </span>            : static Color metricslabelcol = 0x00000;
<span class="lineNum">     177 </span>            : static Color hintlabelcol = 0x00cccc;
<span class="lineNum">     178 </span>            : static Color bluevalstipplecol = 0x808080ff;    /* Translucent */
<span class="lineNum">     179 </span>            : static Color fambluestipplecol = 0x80ff7070;    /* Translucent */
<span class="lineNum">     180 </span>            : static Color mdhintcol = 0x80e04040;            /* Translucent */
<span class="lineNum">     181 </span>            : static Color dhintcol = 0x80d0a0a0;             /* Translucent */
<span class="lineNum">     182 </span>            : static Color hhintcol = 0x80a0d0a0;             /* Translucent */
<span class="lineNum">     183 </span>            : static Color vhintcol = 0x80c0c0ff;             /* Translucent */
<span class="lineNum">     184 </span>            : static Color hflexhintcol = 0x00ff00;
<span class="lineNum">     185 </span>            : static Color vflexhintcol = 0x00ff00;
<span class="lineNum">     186 </span>            : static Color conflicthintcol = 0x00ffff;
<span class="lineNum">     187 </span>            : static Color hhintactivecol = 0x00a000;
<span class="lineNum">     188 </span>            : static Color vhintactivecol = 0x0000ff;
<span class="lineNum">     189 </span>            : static Color anchorcol = 0x0040ff;
<span class="lineNum">     190 </span>            : static Color anchoredoutlinecol = 0x0040ff;
<span class="lineNum">     191 </span>            : static Color templateoutlinecol = 0x009800;
<span class="lineNum">     192 </span>            : static Color oldoutlinecol = 0x008000;
<span class="lineNum">     193 </span>            : static Color transformorigincol = 0x000000;
<span class="lineNum">     194 </span>            : static Color guideoutlinecol = 0x808080;
<span class="lineNum">     195 </span>            : static Color gridfitoutlinecol = 0x009800;
<span class="lineNum">     196 </span>            : static Color backoutlinecol = 0x009800;
<span class="lineNum">     197 </span>            : static Color foreoutlinecol = 0x000000;
<span class="lineNum">     198 </span>            : static Color clippathcol = 0x0000ff;
<span class="lineNum">     199 </span>            : static Color openpathcol = 0x660000;
<span class="lineNum">     200 </span>            : static Color backimagecol = 0x707070;
<span class="lineNum">     201 </span>            : static Color fillcol = 0x80707070;              /* Translucent */
<span class="lineNum">     202 </span>            : static Color tracecol = 0x008000;
<span class="lineNum">     203 </span>            : static Color rulerbigtickcol = 0x008000;
<span class="lineNum">     204 </span>            : static Color previewfillcol = 0x0f0f0f;
<span class="lineNum">     205 </span>            : static Color DraggingComparisonOutlineColor = 0x8800BB00;
<span class="lineNum">     206 </span>            : static Color DraggingComparisonAlphaChannelOverride = 0x88000000;
<span class="lineNum">     207 </span>            : static Color foreoutthicklinecol = 0x20707070;
<span class="lineNum">     208 </span>            : static Color backoutthicklinecol = 0x20707070;
<span class="lineNum">     209 </span>            : int prefs_cv_outline_thickness = 1;
<span class="lineNum">     210 </span>            : int cvbutton3d = 1;
<span class="lineNum">     211 </span>            : Color cvbutton3dedgelightcol = 0xe0e0e0;
<span class="lineNum">     212 </span>            : Color cvbutton3dedgedarkcol = 0x707070;
<span class="lineNum">     213 </span>            : 
<span class="lineNum">     214 </span>            : // Format is 0x AA RR GG BB.
<span class="lineNum">     215 </span>            : 
<span class="lineNum">     216 </span>            : static void isAnyControlPointSelectedVisitor(SplinePoint* splfirst, Spline* s, SplinePoint* sp, void* udata );
<span class="lineNum">     217 </span>            : static int CV_OnCharSelectorTextChanged( GGadget *g, GEvent *e );
<span class="lineNum">     218 </span>            : static void CVHScrollSetPos( CharView *cv, int newpos );
<span class="lineNum">     219 </span>            : 
<span class="lineNum">     220 </span>            : static void CVClear(GWindow,GMenuItem *mi, GEvent *);
<span class="lineNum">     221 </span>            : static void CVMouseMove(CharView *cv, GEvent *event );
<span class="lineNum">     222 </span>            : static void CVMouseUp(CharView *cv, GEvent *event );
<span class="lineNum">     223 </span>            : static void CVHScroll(CharView *cv,struct sbevent *sb);
<span class="lineNum">     224 </span>            : static void CVVScroll(CharView *cv,struct sbevent *sb);
<span class="lineNum">     225 </span>            : /*static void CVElide(GWindow gw,struct gmenuitem *mi,GEvent *e);*/
<span class="lineNum">     226 </span>            : static void CVMenuSimplify(GWindow gw,struct gmenuitem *mi,GEvent *e);
<span class="lineNum">     227 </span>            : static void CVMenuSimplifyMore(GWindow gw,struct gmenuitem *mi,GEvent *e);
<span class="lineNum">     228 </span>            : static void CVPreviewModeSet(GWindow gw, int checked);
<span class="lineNum">     229 </span>            : 
<span class="lineNum">     230 </span>            : static int cvcolsinited = false;
<span class="lineNum">     231 </span>            : 
<span class="lineNum">     232 </span>            : // Note that the GResource names for these preferences are defined separately in CVColInit.
<span class="lineNum">     233 </span>            : // It would be wise to match any changes to these data structures with changes to the values in CVColInit.
<span class="lineNum">     234 </span>            : 
<span class="lineNum">     235 </span>            : static struct resed charview_re[] = {
<span class="lineNum">     236 </span>            :     { N_(&quot;Point Color&quot;), &quot;PointColor&quot;, rt_color, &amp;pointcol, N_(&quot;The color of an on-curve point&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     237 </span>            :     { N_(&quot;First Point Color&quot;), &quot;FirstPointColor&quot;, rt_color, &amp;firstpointcol, N_(&quot;The color of the point which is the start of a contour&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     238 </span>            :     { N_(&quot;Selected Point Color&quot;), &quot;SelectedPointColor&quot;, rt_color, &amp;selectedpointcol, N_(&quot;The color of a selected point&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     239 </span>            :     { N_(&quot;Selected Point Width&quot;), &quot;SelectedPointWidth&quot;, rt_int, &amp;selectedpointwidth, N_(&quot;The width of the line used to draw selected points&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     240 </span>            :     { N_(&quot;Extrema Point Color&quot;), &quot;ExtremePointColor&quot;, rt_color, &amp;extremepointcol, N_(&quot;The color used to draw points at extrema (if that mode is active)&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     241 </span>            :     { N_(&quot;Point of Inflection Color&quot;), &quot;PointOfInflectionColor&quot;, rt_color, &amp;pointofinflectioncol, N_(&quot;The color used to draw points of inflection (if that mode is active)&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     242 </span>            :     { N_(&quot;Almost H/V Color&quot;), &quot;AlmostHVColor&quot;, rt_color, &amp;almosthvcol, N_(&quot;The color used to draw markers for splines which are almost, but not quite horizontal or vertical at their end-points&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     243 </span>            :     { N_(&quot;Next CP Color&quot;), &quot;NextCPColor&quot;, rt_color, &amp;nextcpcol, N_(&quot;The color used to draw the \&quot;next\&quot; control point of an on-curve point&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     244 </span>            :     { N_(&quot;Prev CP Color&quot;), &quot;PrevCPColor&quot;, rt_color, &amp;prevcpcol, N_(&quot;The color used to draw the \&quot;previous\&quot; control point of an on-curve point&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     245 </span>            :     { N_(&quot;Selected CP Color&quot;), &quot;SelectedCPColor&quot;, rt_color, &amp;selectedcpcol, N_(&quot;The color used to draw a selected control point of an on-curve point&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     246 </span>            :     { N_(&quot;Coordinate Line Color&quot;), &quot;CoordinateLineColor&quot;, rt_color, &amp;coordcol, NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     247 </span>            :     { N_(&quot;Italic Coord. Color&quot;), &quot;ItalicCoordColor&quot;, rt_color, &amp;italiccoordcol, NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     248 </span>            :     { N_(&quot;Metrics Label Color&quot;), &quot;MetricsLabelColor&quot;, rt_color, &amp;metricslabelcol, NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     249 </span>            :     { N_(&quot;Hint Label Color&quot;), &quot;HintLabelColor&quot;, rt_color, &amp;hintlabelcol,NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     250 </span>            :     { N_(&quot;Blue Values Color&quot;), &quot;BlueValuesStippledColor&quot;, rt_coloralpha, &amp;bluevalstipplecol, N_(&quot;The color used to mark blue zones in the blue values entry of the private dictionary&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     251 </span>            :     { N_(&quot;Family Blue Color&quot;), &quot;FamilyBlueStippledColor&quot;, rt_coloralpha, &amp;fambluestipplecol, N_(&quot;The color used to mark blue zones in the family blues entry of the private dictionary&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     252 </span>            :     { N_(&quot;Diagonal Hint Color&quot;), &quot;DHintColor&quot;, rt_coloralpha, &amp;dhintcol, N_(&quot;The color used to draw diagonal hints&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     253 </span>            :     { N_(&quot;Horiz. Hint Color&quot;), &quot;HHintColor&quot;, rt_coloralpha, &amp;hhintcol, N_(&quot;The color used to draw horizontal hints&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     254 </span>            :     { N_(&quot;Vert. Hint Color&quot;), &quot;VHintColor&quot;, rt_coloralpha, &amp;vhintcol, N_(&quot;The color used to draw vertical hints&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     255 </span>            :     { N_(&quot;HFlex Hint Color&quot;), &quot;HFlexHintColor&quot;, rt_color, &amp;hflexhintcol, NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     256 </span>            :     { N_(&quot;VFlex Hint Color&quot;), &quot;VFlexHintColor&quot;, rt_color, &amp;vflexhintcol, NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     257 </span>            :     { N_(&quot;Conflict Hint Color&quot;), &quot;ConflictHintColor&quot;, rt_color, &amp;conflicthintcol, N_(&quot;The color used to draw a hint which conflicts with another&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     258 </span>            :     { N_(&quot;HHint Active Color&quot;), &quot;HHintActiveColor&quot;, rt_color, &amp;hhintactivecol, N_(&quot;The color used to draw the active horizontal hint which the Review Hints dialog is examining&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     259 </span>            :     { N_(&quot;VHint Active Color&quot;), &quot;VHintActiveColor&quot;, rt_color, &amp;vhintactivecol, N_(&quot;The color used to draw the active vertical hint which the Review Hints dialog is examining&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     260 </span>            :     { N_(&quot;Dragging Comparison Outline Color&quot;), &quot;DraggingComparisonOutlineColor&quot;, rt_coloralpha, &amp;DraggingComparisonOutlineColor, N_(&quot;The color used to draw the outline of the old spline when you are interactively modifying a glyph&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     261 </span>            :     { N_(&quot;Dragging Comparison Outline Color&quot;), &quot;DraggingComparisonAlphaChannelOverride&quot;, rt_coloralpha, &amp;DraggingComparisonAlphaChannelOverride, N_(&quot;Only the alpha value is used and if non zero it will set the alpha channel for the control points, bezier information and other non spline indicators for the Dragging Comparison Outline spline&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     262 </span>            :     RESED_EMPTY
<span class="lineNum">     263 </span>            : };
<span class="lineNum">     264 </span>            : 
<span class="lineNum">     265 </span>            : static struct resed charview2_re[] = {
<span class="lineNum">     266 </span>            :     { N_(&quot;Width Color&quot;), &quot;WidthColor&quot;, rt_color, &amp;widthcol, N_(&quot;The color of the line marking the advance width&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     267 </span>            :     { N_(&quot;Selected Width Color&quot;), &quot;WidthSelColor&quot;, rt_color, &amp;widthselcol, N_(&quot;The color of the line marking the advance width when it is selected&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     268 </span>            :     { N_(&quot;Selected LBearing Color&quot;), &quot;LBearingSelColor&quot;, rt_color, &amp;lbearingselcol, N_(&quot;The color of the line marking the left bearing when it is selected&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     269 </span>            :     { N_(&quot;Grid Fit Width Color&quot;), &quot;GridFitWidthColor&quot;, rt_color, &amp;widthgridfitcol, N_(&quot;The color of the line marking the grid-fit advance width&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     270 </span>            :     { N_(&quot;Ligature Caret Color&quot;), &quot;LigatureCaretColor&quot;, rt_color, &amp;lcaretcol, N_(&quot;The color of the line(s) marking ligature carets&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     271 </span>            :     { N_(&quot;Anchor Color&quot;), &quot;AnchorColor&quot;, rt_color, &amp;anchorcol, N_(&quot;The color of anchor stars&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     272 </span>            :     { N_(&quot;Anchored Line Color&quot;), &quot;AnchoredOutlineColor&quot;, rt_color, &amp;anchoredoutlinecol, N_(&quot;The color of another glyph drawn in the current view to show where it would be placed by an anchor lookup&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     273 </span>            :     { N_(&quot;Template Color&quot;), &quot;TemplateOutlineColor&quot;, rt_color, &amp;templateoutlinecol, NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     274 </span>            :     { N_(&quot;Old Outline Color&quot;), &quot;OldOutlineColor&quot;, rt_color, &amp;oldoutlinecol, NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     275 </span>            :     { N_(&quot;Original Color&quot;), &quot;TransformOriginColor&quot;, rt_color, &amp;transformorigincol, NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     276 </span>            :     { N_(&quot;Guide Layer Color&quot;), &quot;GuideOutlineColor&quot;, rt_color, &amp;guideoutlinecol, NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     277 </span>            :     { N_(&quot;Grid Fit Color&quot;), &quot;GridFitOutlineColor&quot;, rt_color, &amp;gridfitoutlinecol, N_(&quot;The color of grid-fit outlines&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     278 </span>            :     { N_(&quot;Inactive Layer Color&quot;), &quot;BackgroundOutlineColor&quot;, rt_color, &amp;backoutlinecol, N_(&quot;The color of outlines in inactive layers&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     279 </span>            :     { N_(&quot;Active Layer Color&quot;), &quot;ForegroundOutlineColor&quot;, rt_color, &amp;foreoutlinecol, N_(&quot;The color of outlines in the active layer&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     280 </span>            :     { N_(&quot;Inactive Thick Layer Color&quot;), &quot;BackgroundThickOutlineColor&quot;, rt_coloralpha, &amp;backoutthicklinecol, N_(&quot;The color of thick outlines in inactive layers&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     281 </span>            :     { N_(&quot;Active Thick Layer Color&quot;), &quot;ForegroundThickOutlineColor&quot;, rt_coloralpha, &amp;foreoutthicklinecol, N_(&quot;The color of thick outlines in the active layer&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     282 </span>            :     { N_(&quot;Clip Path Color&quot;), &quot;ClipPathColor&quot;, rt_color, &amp;clippathcol, N_(&quot;The color of the clip path&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     283 </span>            :     { N_(&quot;Open Path Color&quot;), &quot;OpenPathColor&quot;, rt_color, &amp;openpathcol, N_(&quot;The color of the open path&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     284 </span>            :     { N_(&quot;Background Image Color&quot;), &quot;BackgroundImageColor&quot;, rt_coloralpha, &amp;backimagecol, N_(&quot;The color used to draw bitmap (single bit) images which do not specify a clut&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     285 </span>            :     { N_(&quot;Fill Color&quot;), &quot;FillColor&quot;, rt_coloralpha, &amp;fillcol, N_(&quot;The color used to fill the outline if that mode is active&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     286 </span>            :     { N_(&quot;Preview Fill Color&quot;), &quot;PreviewFillColor&quot;, rt_coloralpha, &amp;previewfillcol, N_(&quot;The color used to fill the outline when in preview mode&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     287 </span>            :     { N_(&quot;Trace Color&quot;), &quot;TraceColor&quot;, rt_color, &amp;tracecol, NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     288 </span>            :     { N_(&quot;Raster Color&quot;), &quot;RasterColor&quot;, rt_coloralpha, &amp;rastercol, N_(&quot;The color of grid-fit (and other) raster blocks&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     289 </span>            :     { N_(&quot;Raster New Color&quot;), &quot;RasterNewColor&quot;, rt_coloralpha, &amp;rasternewcol, N_(&quot;The color of raster blocks which have just been turned on (in the debugger when an instruction moves a point)&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     290 </span>            :     { N_(&quot;Raster Old Color&quot;), &quot;RasterOldColor&quot;, rt_coloralpha, &amp;rasteroldcol, N_(&quot;The color of raster blocks which have just been turned off (in the debugger when an instruction moves a point)&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     291 </span>            :     { N_(&quot;Raster Grid Color&quot;), &quot;RasterGridColor&quot;, rt_coloralpha, &amp;rastergridcol, NULL, NULL, { 0 }, 0, 0 },
<span class="lineNum">     292 </span>            :     { N_(&quot;Raster Dark Color&quot;), &quot;RasterDarkColor&quot;, rt_coloralpha, &amp;rasterdarkcol, N_(&quot;When debugging in grey-scale this is the color of a raster block which is fully covered.&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     293 </span>            :     { N_(&quot;Delta Grid Color&quot;), &quot;DeltaGridColor&quot;, rt_color, &amp;deltagridcol, N_(&quot;Indicates a notable grid pixel when suggesting deltas.&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     294 </span>            :     { N_(&quot;Ruler Big Tick Color&quot;), &quot;RulerBigTickColor&quot;, rt_color, &amp;rulerbigtickcol, N_(&quot;The color used to draw the large tick marks in rulers.&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     295 </span>            :     { N_(&quot;Measure Tool Line Color&quot;), &quot;MeasureToolLineColor&quot;, rt_color, &amp;measuretoollinecol, N_(&quot;The color used to draw the measure tool line.&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     296 </span>            :     { N_(&quot;Measure Tool Point Color&quot;), &quot;MeasureToolPointColor&quot;, rt_color, &amp;measuretoolpointcol, N_(&quot;The color used to draw the measure tool points.&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     297 </span>            :     { N_(&quot;Measure Tool Point Snapped Color&quot;), &quot;MeasureToolPointSnappedColor&quot;, rt_color, &amp;measuretoolpointsnappedcol, N_(&quot;The color used to draw the measure tool points when snapped.&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     298 </span>            :     { N_(&quot;Measure Tool Canvas Number Color&quot;), &quot;MeasureToolCanvasNumbersColor&quot;, rt_color, &amp;measuretoolcanvasnumberscol, N_(&quot;The color used to draw the measure tool numbers on the canvas.&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     299 </span>            :     { N_(&quot;Measure Tool Canvas Number Snapped Color&quot;), &quot;MeasureToolCanvasNumbersSnappedColor&quot;, rt_color, &amp;measuretoolcanvasnumberssnappedcol, N_(&quot;The color used to draw the measure tool numbers on the canvas when snapped.&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     300 </span>            :     { N_(&quot;Measure Tool Windows Foreground Color&quot;), &quot;MeasureToolWindowForeground&quot;, rt_color, &amp;measuretoolwindowforegroundcol, N_(&quot;The measure tool window foreground color.&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     301 </span>            :     { N_(&quot;Measure Tool Windows Background Color&quot;), &quot;MeasureToolWindowBackground&quot;, rt_color, &amp;measuretoolwindowbackgroundcol, N_(&quot;The measure tool window background color.&quot;), NULL, { 0 }, 0, 0 },
<span class="lineNum">     302 </span>            :     RESED_EMPTY
<span class="lineNum">     303 </span>            : };
<a name="304"><span class="lineNum">     304 </span>            : </a>
<span class="lineNum">     305 </span>            : /* return 1 if anything changed */
<span class="lineNum">     306 </span><span class="lineNoCov">          0 : static void update_spacebar_hand_tool(CharView *cv) {</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :     if ( GDrawKeyState(' ') ) {</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :         if ( !cv-&gt;spacebar_hold  &amp;&amp; !cv_auto_goto ) {</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :             cv-&gt;spacebar_hold = 1;</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :             cv-&gt;b1_tool_old = cv-&gt;b1_tool;</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :             cv-&gt;b1_tool = cvt_hand;</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :             cv-&gt;active_tool = cvt_hand;</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :             CVMouseDownHand(cv);</span>
<span class="lineNum">     314 </span><span class="lineNoCov">          0 :             CVPreviewModeSet(cv-&gt;gw, cv_show_fill_with_space);</span>
<span class="lineNum">     315 </span>            :         }
<span class="lineNum">     316 </span>            :     } else {
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :         if ( cv-&gt;spacebar_hold ) {</span>
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :             cv-&gt;spacebar_hold = 0;</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :             cv-&gt;b1_tool = cv-&gt;b1_tool_old;</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :             cv-&gt;active_tool = cvt_none;</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :             cv-&gt;b1_tool_old = cvt_none;</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :             CVPreviewModeSet(cv-&gt;gw, false);</span>
<span class="lineNum">     323 </span>            :         }
<span class="lineNum">     324 </span>            :     }
<span class="lineNum">     325 </span><span class="lineNoCov">          0 : }</span>
<a name="326"><span class="lineNum">     326 </span>            : </a>
<span class="lineNum">     327 </span>            : 
<span class="lineNum">     328 </span><span class="lineNoCov">          0 : int CVInSpiro( CharView *cv )</span>
<span class="lineNum">     329 </span>            : {
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :     int inspiro = 0;</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :     int canspiro = hasspiro();</span>
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :     if( cv ) </span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :         inspiro = canspiro &amp;&amp; cv-&gt;b.sc-&gt;inspiro;</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :     return inspiro;</span>
<span class="lineNum">     335 </span>            : }
<span class="lineNum">     336 </span>            : 
<span class="lineNum">     337 </span>            : /**
<span class="lineNum">     338 </span>            :  * Returns the number of points which are currently selected in this
<span class="lineNum">     339 </span>            :  * charview. Handy for menus and the like which might like to grey out
<a name="340"><span class="lineNum">     340 </span>            :  * if there are &lt;2, or &lt;3 points actively selected.</a>
<span class="lineNum">     341 </span>            :  */
<span class="lineNum">     342 </span><span class="lineNoCov">          0 : int CVCountSelectedPoints(CharView *cv) {</span>
<span class="lineNum">     343 </span>            :     SplinePointList *spl;
<span class="lineNum">     344 </span>            :     Spline *spline, *first;
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :     int ret = 0;</span>
<span class="lineNum">     346 </span>            : 
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :         first = NULL;</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :         for ( spline = spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :             if( spline == spl-&gt;first-&gt;next ) {</span>
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :                 if ( spline-&gt;from-&gt;selected ) {</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :                     ret++;</span>
<span class="lineNum">     353 </span>            :                 }
<span class="lineNum">     354 </span>            :             }
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :             if ( spline-&gt;to-&gt;selected ) {</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :                 if( spline-&gt;to != spl-&gt;first-&gt;next-&gt;from )</span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :                     ret++;</span>
<span class="lineNum">     358 </span>            :             }
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :             if ( first==NULL ) {</span>
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :                 first = spline;</span>
<span class="lineNum">     361 </span>            :             }
<span class="lineNum">     362 </span>            :         }
<span class="lineNum">     363 </span>            :     }
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :     return ret;</span>
<span class="lineNum">     365 </span>            : }
<span class="lineNum">     366 </span>            : 
<span class="lineNum">     367 </span>            : 
<span class="lineNum">     368 </span>            : 
<span class="lineNum">     369 </span>            : /* floor(pt) would _not_ be more correct, as we want
<a name="370"><span class="lineNum">     370 </span>            :  * shapes not to cross axes multiple times while scaling.</a>
<span class="lineNum">     371 </span>            :  */
<span class="lineNum">     372 </span><span class="lineNoCov">          0 : static double rpt(CharView *cv, double pt) {</span>
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :     return cv-&gt;snapoutlines ? rint(pt) : pt;</span>
<a name="374"><span class="lineNum">     374 </span>            : }</a>
<span class="lineNum">     375 </span>            : 
<span class="lineNum">     376 </span><span class="lineNoCov">          0 : static int shouldShowFilledUsingCairo(CharView *cv) {</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showfilled &amp;&amp; GDrawHasCairo(cv-&gt;v) &amp; gc_buildpath ) {</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :         return 1;</span>
<span class="lineNum">     379 </span>            :     }
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :     return 0;</span>
<a name="381"><span class="lineNum">     381 </span>            : }</a>
<span class="lineNum">     382 </span>            : 
<span class="lineNum">     383 </span><span class="lineNoCov">          0 : void CVColInit( void ) {</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :     if ( cvcolsinited )</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :     GResEditFind( charview_re, &quot;CharView.&quot;);</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :     GResEditFind( charview2_re, &quot;CharView.&quot;);</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :     cvcolsinited = true;</span>
<span class="lineNum">     389 </span>            : 
<span class="lineNum">     390 </span>            :   // These value over-ride the static initializers.
<span class="lineNum">     391 </span>            :   // Note that the base resource names are copied from charview_re and charview2_re.
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :   pointcol = GResourceFindColor(&quot;CharView.PointColor&quot;,0xff0000);</span>
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :   firstpointcol = GResourceFindColor(&quot;CharView.FirstPointColor&quot;,0x707000);</span>
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :   selectedpointcol = GResourceFindColor(&quot;CharView.SelectedPointColor&quot;,0xc8c800);</span>
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :   selectedpointwidth = GResourceFindInt(&quot;CharView.SelectedPointWidth&quot;,2);</span>
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :   extremepointcol = GResourceFindColor(&quot;CharView.ExtremePointColor&quot;,0xc00080);</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :   pointofinflectioncol = GResourceFindColor(&quot;CharView.PointOfInflectionColor&quot;,0x008080);</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :   almosthvcol = GResourceFindColor(&quot;CharView.AlmostHVColor&quot;,0x00ff80);</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :   nextcpcol = GResourceFindColor(&quot;CharView.NextCPColor&quot;,0x007090);</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :   prevcpcol = GResourceFindColor(&quot;CharView.PointColor&quot;,0xcc00cc);</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :   selectedcpcol = GResourceFindColor(&quot;CharView.SelectedCPColor&quot;,0xffffff);</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :   coordcol = GResourceFindColor(&quot;CharView.CoordinateColor&quot;,0x808080);</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :   widthcol = GResourceFindColor(&quot;CharView.WidthColor&quot;,0x000000);</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :   widthselcol = GResourceFindColor(&quot;CharView.WidthSelColor&quot;,0x00ff00);</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :   lbearingselcol = GResourceFindColor(&quot;CharView.LBearingSelColor&quot;,0x00ff00);</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :   widthgridfitcol = GResourceFindColor(&quot;CharView.GridFitWidthColor&quot;,0x009800);</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :   lcaretcol = GResourceFindColor(&quot;CharView.LigatureCaretColor&quot;,0x909040);</span>
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :   rastercol = GResourceFindColor(&quot;CharView.RasterColor&quot;,0xffa0a0a0);          /* Translucent */</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :   rasternewcol = GResourceFindColor(&quot;CharView.RasterNewColor&quot;,0xff909090);</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :   rasteroldcol = GResourceFindColor(&quot;CharView.RasterOldColor&quot;,0xffc0c0c0);</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :   rastergridcol = GResourceFindColor(&quot;CharView.RasterGridColor&quot;,0xffb0b0ff);</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :   rasterdarkcol = GResourceFindColor(&quot;CharView.RasterDarkColor&quot;,0xff606060);</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :   deltagridcol = GResourceFindColor(&quot;CharView.DeltaGridColor&quot;,0xcc0000);</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :   italiccoordcol = GResourceFindColor(&quot;CharView.ItalicCoordColor&quot;,0x909090);</span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :   metricslabelcol = GResourceFindColor(&quot;CharView.MetricsLabelColor&quot;,0x00000);</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :   hintlabelcol = GResourceFindColor(&quot;CharView.HintLabelColor&quot;,0x00cccc);</span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :   bluevalstipplecol = GResourceFindColor(&quot;CharView.BlueValuesStippledColor&quot;,0x808080ff);      /* Translucent */</span>
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :   fambluestipplecol = GResourceFindColor(&quot;CharView.FamilyBlueStippledColor&quot;,0x80ff7070);      /* Translucent */</span>
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :   mdhintcol = GResourceFindColor(&quot;CharView.xxxxxx&quot;,0x80e04040);               /* Translucent */</span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :   dhintcol = GResourceFindColor(&quot;CharView.DHintColor&quot;,0x80d0a0a0);            /* Translucent */</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :   hhintcol = GResourceFindColor(&quot;CharView.HHintColor&quot;,0x80a0d0a0);            /* Translucent */</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :   vhintcol = GResourceFindColor(&quot;CharView.VHintColor&quot;,0x80c0c0ff);            /* Translucent */</span>
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :   hflexhintcol = GResourceFindColor(&quot;CharView.HFlexHintColor&quot;,0x00ff00);</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :   vflexhintcol = GResourceFindColor(&quot;CharView.VFlexHintColor&quot;,0x00ff00);</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :   conflicthintcol = GResourceFindColor(&quot;CharView.ConflictHintColor&quot;,0x00ffff);</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :   hhintactivecol = GResourceFindColor(&quot;CharView.HHintActiveColor&quot;,0x00a000);</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :   vhintactivecol = GResourceFindColor(&quot;CharView.VHintActiveColor&quot;,0x0000ff);</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :   anchorcol = GResourceFindColor(&quot;CharView.AnchorColor&quot;,0x0040ff);</span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :   anchoredoutlinecol = GResourceFindColor(&quot;CharView.AnchoredOutlineColor&quot;,0x0040ff);</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :   templateoutlinecol = GResourceFindColor(&quot;CharView.TemplateOutlineColor&quot;,0x009800);</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :   oldoutlinecol = GResourceFindColor(&quot;CharView.OldOutlineColor&quot;,0x008000);</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :   transformorigincol = GResourceFindColor(&quot;CharView.TransformOriginColor&quot;,0x000000);</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :   guideoutlinecol = GResourceFindColor(&quot;CharView.GuideOutlineColor&quot;,0x808080);</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :   gridfitoutlinecol = GResourceFindColor(&quot;CharView.GridFitOutlineColor&quot;,0x009800);</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :   backoutlinecol = GResourceFindColor(&quot;CharView.BackgroundOutlineColor&quot;,0x009800);</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :   foreoutlinecol = GResourceFindColor(&quot;CharView.ForegroundOutlineColor&quot;,0x000000);</span>
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :   clippathcol = GResourceFindColor(&quot;CharView.ClipPathColor&quot;,0x0000ff);</span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :   openpathcol = GResourceFindColor(&quot;CharView.OpenPathColor&quot;,0x660000);</span>
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :   backimagecol = GResourceFindColor(&quot;CharView.BackgroundImageColor&quot;,0x707070);</span>
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :   fillcol = GResourceFindColor(&quot;CharView.FillColor&quot;,0x80707070);              /* Translucent */</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :   tracecol = GResourceFindColor(&quot;CharView.TraceColor&quot;,0x008000);</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :   rulerbigtickcol = GResourceFindColor(&quot;CharView.RulerBigTickColor&quot;,0x008000);</span>
<span class="lineNum">     443 </span>            :   // previewfillcol = GResourceFindColor(,0x0f0f0f);
<span class="lineNum">     444 </span>            :   // The code below defaults differently from the static initializer (from which we copied this value).
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :     if( GResourceFindColor(&quot;CharView.PreviewFillColor&quot;, COLOR_UNKNOWN) == COLOR_UNKNOWN ) {</span>
<span class="lineNum">     446 </span>            :         // no explicit previewfillcolor
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :         previewfillcol = fillcol;</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :         if( GResourceFindColor(&quot;CharView.FillColor&quot;, COLOR_UNKNOWN) == COLOR_UNKNOWN ) {</span>
<span class="lineNum">     449 </span>            :             // no explicit fill color either
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :             previewfillcol = 0x000000;</span>
<span class="lineNum">     451 </span>            :         }
<span class="lineNum">     452 </span>            :     }
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :   DraggingComparisonOutlineColor = GResourceFindColor(&quot;CharView.DraggingComparisonOutlineColor&quot;,0x8800BB00);</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :   DraggingComparisonAlphaChannelOverride = GResourceFindColor(&quot;CharView.DraggingComparisonAlphaChannelOverride&quot;,0x88000000);</span>
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :   foreoutthicklinecol = GResourceFindColor(&quot;CharView.ForegroundThickOutlineColor&quot;,0x20707070);</span>
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :   backoutthicklinecol = GResourceFindColor(&quot;CharView.BackgroundThickOutlineColor&quot;,0x20707070);</span>
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :   cvbutton3d = GResourceFindInt(&quot;CharView.Button3D&quot;, 1);</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :   cvbutton3dedgelightcol = GResourceFindColor(&quot;CharView.Button3DEdgeLightColor&quot;, 0xe0e0e0);</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :   cvbutton3dedgedarkcol = GResourceFindColor(&quot;CharView.Button3DEdgeDarkColor&quot;, 0x707070);</span>
<span class="lineNum">     460 </span>            : }
<span class="lineNum">     461 </span>            : 
<span class="lineNum">     462 </span>            : 
<span class="lineNum">     463 </span>            : GDevEventMask input_em[] = {
<span class="lineNum">     464 </span>            :         /* Event masks for wacom devices */
<span class="lineNum">     465 </span>            :     /* negative utility in opening Mouse1 */
<span class="lineNum">     466 </span>            :     /* No point in distinguishing cursor from core mouse */
<span class="lineNum">     467 </span>            :     { (1&lt;&lt;et_mousemove)|(1&lt;&lt;et_mousedown)|(1&lt;&lt;et_mouseup)|(1&lt;&lt;et_char), &quot;stylus&quot; },
<span class="lineNum">     468 </span>            :     { (1&lt;&lt;et_mousemove)|(1&lt;&lt;et_mousedown)|(1&lt;&lt;et_mouseup), &quot;eraser&quot; },
<span class="lineNum">     469 </span>            :     { 0, NULL }
<span class="lineNum">     470 </span>            : };
<span class="lineNum">     471 </span>            : const int input_em_cnt = sizeof(input_em)/sizeof(input_em[0])-1;
<span class="lineNum">     472 </span>            : 
<span class="lineNum">     473 </span>            : /* Positions on the info line */
<span class="lineNum">     474 </span>            : #define RPT_BASE        5               /* Place to draw the pointer icon */
<span class="lineNum">     475 </span>            : #define RPT_DATA        13              /* x,y text after above */
<span class="lineNum">     476 </span>            : #define SPT_BASE        83              /* Place to draw selected pt icon */
<span class="lineNum">     477 </span>            : #define SPT_DATA        97              /* Any text for it */
<span class="lineNum">     478 </span>            : #define SOF_BASE        157             /* Place to draw selection to pointer icon */
<span class="lineNum">     479 </span>            : #define SOF_DATA        179             /* Any text for it */
<span class="lineNum">     480 </span>            : #define SDS_BASE        259             /* Place to draw distance icon */
<span class="lineNum">     481 </span>            : #define SDS_DATA        281             /* Any text for it */
<span class="lineNum">     482 </span>            : #define SAN_BASE        331             /* Place to draw angle icon */
<span class="lineNum">     483 </span>            : #define SAN_DATA        353             /* Any text for it */
<span class="lineNum">     484 </span>            : #define MAG_BASE        383             /* Place to draw magnification icon */
<span class="lineNum">     485 </span>            : #define MAG_DATA        394             /* Any text for it */
<span class="lineNum">     486 </span>            : #define LAYER_DATA      454             /* Text to show the current layer */
<span class="lineNum">     487 </span>            : #define CODERANGE_DATA  574             /* Text to show the current code range (if the debugger be active) */
<a name="488"><span class="lineNum">     488 </span>            : #define FLAGS_DATA      724             /* Text to show the current drawmode flags */</a>
<span class="lineNum">     489 </span>            : 
<span class="lineNum">     490 </span><span class="lineNoCov">          0 : void CVDrawRubberRect(GWindow pixmap, CharView *cv) {</span>
<span class="lineNum">     491 </span>            :     GRect r;
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :     if ( !cv-&gt;p.rubberbanding )</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :     r.x =  cv-&gt;xoff + rint(cv-&gt;p.cx*cv-&gt;scale);</span>
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :     r.y = -cv-&gt;yoff + cv-&gt;height - rint(cv-&gt;p.cy*cv-&gt;scale);</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :     r.width = rint( (cv-&gt;p.ex-cv-&gt;p.cx)*cv-&gt;scale );</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :     r.height = -rint( (cv-&gt;p.ey-cv-&gt;p.cy)*cv-&gt;scale );</span>
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :     if ( r.width&lt;0 ) {</span>
<span class="lineNum">     499 </span><span class="lineNoCov">          0 :         r.x += r.width;</span>
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :         r.width = -r.width;</span>
<span class="lineNum">     501 </span>            :     }
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :     if ( r.height&lt;0 ) {</span>
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :         r.y += r.height;</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :         r.height = -r.height;</span>
<span class="lineNum">     505 </span>            :     }
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :     GDrawSetDashedLine(pixmap,2,2,0);</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :     GDrawSetLineWidth(pixmap,0);</span>
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :     GDrawSetXORMode(pixmap);</span>
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :     GDrawSetXORBase(pixmap,view_bgcol);</span>
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :     GDrawDrawRect(pixmap,&amp;r,oldoutlinecol);</span>
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :     GDrawSetCopyMode(pixmap);</span>
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :     GDrawSetDashedLine(pixmap,0,0,0);</span>
<a name="513"><span class="lineNum">     513 </span>            : }</a>
<span class="lineNum">     514 </span>            : 
<span class="lineNum">     515 </span><span class="lineNoCov">          0 : static void CVDrawRubberLine(GWindow pixmap, CharView *cv) {</span>
<span class="lineNum">     516 </span>            :     int x,y, xend,yend;
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :     Color col = cv-&gt;active_tool==cvt_ruler ? measuretoollinecol : oldoutlinecol;</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :     if ( !cv-&gt;p.rubberlining )</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :     x =  cv-&gt;xoff + rint(cv-&gt;p.cx*cv-&gt;scale);</span>
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :     y = -cv-&gt;yoff + cv-&gt;height - rint(cv-&gt;p.cy*cv-&gt;scale);</span>
<span class="lineNum">     522 </span><span class="lineNoCov">          0 :     xend =  cv-&gt;xoff + rint(cv-&gt;info.x*cv-&gt;scale);</span>
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :     yend = -cv-&gt;yoff + cv-&gt;height - rint(cv-&gt;info.y*cv-&gt;scale);</span>
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :     if ( xorrubberlines ) {             /* XOR prevents use of CAIRO for these lines */</span>
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :         GDrawSetXORMode(pixmap);</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :         GDrawSetLineWidth(pixmap,0);</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :         GDrawSetXORBase(pixmap,GDrawGetDefaultBackground(NULL));</span>
<span class="lineNum">     528 </span>            :     } else {
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :         GDrawSetCopyMode(pixmap);</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :         GDrawSetLineWidth(pixmap,0);</span>
<span class="lineNum">     531 </span>            :     }
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap,x,y,xend,yend,col);</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :     GDrawSetCopyMode(pixmap);</span>
<a name="534"><span class="lineNum">     534 </span>            : }</a>
<span class="lineNum">     535 </span>            : 
<span class="lineNum">     536 </span><span class="lineNoCov">          0 : static void CVDrawBB(CharView *cv, GWindow pixmap, DBounds *bb) {</span>
<span class="lineNum">     537 </span>            :     GRect r;
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :     int off = cv-&gt;xoff+cv-&gt;height-cv-&gt;yoff;</span>
<span class="lineNum">     539 </span>            : 
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :     r.x =  cv-&gt;xoff + rint(bb-&gt;minx*cv-&gt;scale);</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :     r.y = -cv-&gt;yoff + cv-&gt;height - rint(bb-&gt;maxy*cv-&gt;scale);</span>
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :     r.width = rint((bb-&gt;maxx-bb-&gt;minx)*cv-&gt;scale);</span>
<span class="lineNum">     543 </span><span class="lineNoCov">          0 :     r.height = rint((bb-&gt;maxy-bb-&gt;miny)*cv-&gt;scale);</span>
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :     GDrawSetDashedLine(pixmap,1,1,off);</span>
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :     GDrawDrawRect(pixmap,&amp;r,GDrawGetDefaultForeground(NULL));</span>
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :     GDrawSetDashedLine(pixmap,0,0,0);</span>
<span class="lineNum">     547 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     548 </span>            : 
<a name="549"><span class="lineNum">     549 </span>            : /* Sigh. I have to do my own clipping because at large magnifications */</a>
<span class="lineNum">     550 </span>            : /*  things can easily exceed 16 bits */
<span class="lineNum">     551 </span><span class="lineNoCov">          0 : static int CVSplineOutside(CharView *cv, Spline *spline) {</span>
<span class="lineNum">     552 </span>            :     int x[4], y[4];
<span class="lineNum">     553 </span>            : 
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :     x[0] =  cv-&gt;xoff + rint(spline-&gt;from-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :     y[0] = -cv-&gt;yoff + cv-&gt;height - rint(spline-&gt;from-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">     556 </span>            : 
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :     x[1] =  cv-&gt;xoff + rint(spline-&gt;to-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :     y[1] = -cv-&gt;yoff + cv-&gt;height - rint(spline-&gt;to-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">     559 </span>            : 
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :     if ( spline-&gt;from-&gt;nonextcp &amp;&amp; spline-&gt;to-&gt;noprevcp ) {</span>
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :         if ( (x[0]&lt;0 &amp;&amp; x[1]&lt;0) || (x[0]&gt;=cv-&gt;width &amp;&amp; x[1]&gt;=cv-&gt;width) ||</span>
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :                 (y[0]&lt;0 &amp;&amp; y[1]&lt;0) || (y[0]&gt;=cv-&gt;height &amp;&amp; y[1]&gt;=cv-&gt;height) )</span>
<span class="lineNum">     563 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     564 </span>            :     } else {
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :         x[2] =  cv-&gt;xoff + rint(spline-&gt;from-&gt;nextcp.x*cv-&gt;scale);</span>
<span class="lineNum">     566 </span><span class="lineNoCov">          0 :         y[2] = -cv-&gt;yoff + cv-&gt;height - rint(spline-&gt;from-&gt;nextcp.y*cv-&gt;scale);</span>
<span class="lineNum">     567 </span><span class="lineNoCov">          0 :         x[3] =  cv-&gt;xoff + rint(spline-&gt;to-&gt;prevcp.x*cv-&gt;scale);</span>
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :         y[3] = -cv-&gt;yoff + cv-&gt;height - rint(spline-&gt;to-&gt;prevcp.y*cv-&gt;scale);</span>
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :         if ( (x[0]&lt;0 &amp;&amp; x[1]&lt;0 &amp;&amp; x[2]&lt;0 &amp;&amp; x[3]&lt;0) ||</span>
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :                 (x[0]&gt;=cv-&gt;width &amp;&amp; x[1]&gt;=cv-&gt;width &amp;&amp; x[2]&gt;=cv-&gt;width &amp;&amp; x[3]&gt;=cv-&gt;width ) ||</span>
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :                 (y[0]&lt;0 &amp;&amp; y[1]&lt;0 &amp;&amp; y[2]&lt;0 &amp;&amp; y[3]&lt;0 ) ||</span>
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :                 (y[0]&gt;=cv-&gt;height &amp;&amp; y[1]&gt;=cv-&gt;height &amp;&amp; y[2]&gt;=cv-&gt;height &amp;&amp; y[3]&gt;=cv-&gt;height) )</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     574 </span>            :     }
<span class="lineNum">     575 </span>            : 
<span class="lineNum">     576 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="577"><span class="lineNum">     577 </span>            : }</a>
<span class="lineNum">     578 </span>            : 
<span class="lineNum">     579 </span><span class="lineNoCov">          0 : static int CVLinesIntersectScreen(CharView *cv, LinearApprox *lap) {</span>
<span class="lineNum">     580 </span>            :     LineList *l;
<span class="lineNum">     581 </span><span class="lineNoCov">          0 :     int any = false;</span>
<span class="lineNum">     582 </span>            :     int x,y;
<span class="lineNum">     583 </span>            :     int bothout;
<span class="lineNum">     584 </span>            : 
<span class="lineNum">     585 </span><span class="lineNoCov">          0 :     for ( l=lap-&gt;lines; l!=NULL; l=l-&gt;next ) {</span>
<span class="lineNum">     586 </span><span class="lineNoCov">          0 :         l-&gt;asend.x = l-&gt;asstart.x = cv-&gt;xoff + l-&gt;here.x;</span>
<span class="lineNum">     587 </span><span class="lineNoCov">          0 :         l-&gt;asend.y = l-&gt;asstart.y = -cv-&gt;yoff + cv-&gt;height-l-&gt;here.y;</span>
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :         l-&gt;flags = 0;</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :         if ( l-&gt;asend.x&lt;0 || l-&gt;asend.x&gt;=cv-&gt;width || l-&gt;asend.y&lt;0 || l-&gt;asend.y&gt;=cv-&gt;height ) {</span>
<span class="lineNum">     590 </span><span class="lineNoCov">          0 :             l-&gt;flags = cvli_clipped;</span>
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :             any = true;</span>
<span class="lineNum">     592 </span>            :         }
<span class="lineNum">     593 </span>            :     }
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :     if ( !any ) {</span>
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :         for ( l=lap-&gt;lines; l!=NULL; l=l-&gt;next )</span>
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :             l-&gt;flags = cvli_onscreen;</span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :         lap-&gt;any = true;</span>
<span class="lineNum">     598 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     599 </span>            :     }
<span class="lineNum">     600 </span>            : 
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :     any = false;</span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :     for ( l=lap-&gt;lines; l-&gt;next!=NULL; l=l-&gt;next ) {</span>
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :         if ( !(l-&gt;flags&amp;cvli_clipped) &amp;&amp; !(l-&gt;next-&gt;flags&amp;cvli_clipped) )</span>
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :             l-&gt;flags = cvli_onscreen;</span>
<span class="lineNum">     605 </span>            :         else {
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :             bothout = (l-&gt;flags&amp;cvli_clipped) &amp;&amp; (l-&gt;next-&gt;flags&amp;cvli_clipped);</span>
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :             if (( l-&gt;asstart.x&lt;0 &amp;&amp; l-&gt;next-&gt;asend.x&gt;0 ) ||</span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :                     ( l-&gt;asstart.x&gt;0 &amp;&amp; l-&gt;next-&gt;asend.x&lt;0 )) {</span>
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :                 y = -(l-&gt;next-&gt;asend.y-l-&gt;asstart.y)*(double)l-&gt;asstart.x/(l-&gt;next-&gt;asend.x-l-&gt;asstart.x) +</span>
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :                         l-&gt;asstart.y;</span>
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :                 if ( l-&gt;asstart.x&lt;0 ) {</span>
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :                     l-&gt;asstart.x = 0;</span>
<span class="lineNum">     613 </span><span class="lineNoCov">          0 :                     l-&gt;asstart.y = y;</span>
<span class="lineNum">     614 </span>            :                 } else {
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :                     l-&gt;next-&gt;asend.x = 0;</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :                     l-&gt;next-&gt;asend.y = y;</span>
<span class="lineNum">     617 </span>            :                 }
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :             } else if ( l-&gt;asstart.x&lt;0 &amp;&amp; l-&gt;next-&gt;asend.x&lt;0 )</span>
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :             if (( l-&gt;asstart.x&lt;cv-&gt;width &amp;&amp; l-&gt;next-&gt;asend.x&gt;cv-&gt;width ) ||</span>
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :                     ( l-&gt;asstart.x&gt;cv-&gt;width &amp;&amp; l-&gt;next-&gt;asend.x&lt;cv-&gt;width )) {</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :                 y = (l-&gt;next-&gt;asend.y-l-&gt;asstart.y)*(double)(cv-&gt;width-l-&gt;asstart.x)/(l-&gt;next-&gt;asend.x-l-&gt;asstart.x) +</span>
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :                         l-&gt;asstart.y;</span>
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :                 if ( l-&gt;asstart.x&gt;cv-&gt;width ) {</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :                     l-&gt;asstart.x = cv-&gt;width;</span>
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :                     l-&gt;asstart.y = y;</span>
<span class="lineNum">     627 </span>            :                 } else {
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :                     l-&gt;next-&gt;asend.x = cv-&gt;width;</span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :                     l-&gt;next-&gt;asend.y = y;</span>
<span class="lineNum">     630 </span>            :                 }
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :             } else if ( l-&gt;asstart.x&gt;cv-&gt;width &amp;&amp; l-&gt;next-&gt;asend.x&gt;cv-&gt;width )</span>
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :             if (( l-&gt;asstart.y&lt;0 &amp;&amp; l-&gt;next-&gt;asend.y&gt;0 ) ||</span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :                     ( l-&gt;asstart.y&gt;0 &amp;&amp; l-&gt;next-&gt;asend.y&lt;0 )) {</span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :                 x = -(l-&gt;next-&gt;asend.x-l-&gt;asstart.x)*(double)l-&gt;asstart.y/(l-&gt;next-&gt;asend.y-l-&gt;asstart.y) +</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :                         l-&gt;asstart.x;</span>
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :                 if (( x&lt;0 || x&gt;=cv-&gt;width ) &amp;&amp; bothout )</span>
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :     continue;                   /* Not on screen */;</span>
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :                 if ( l-&gt;asstart.y&lt;0 ) {</span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :                     l-&gt;asstart.y = 0;</span>
<span class="lineNum">     641 </span><span class="lineNoCov">          0 :                     l-&gt;asstart.x = x;</span>
<span class="lineNum">     642 </span>            :                 } else {
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :                     l-&gt;next-&gt;asend.y = 0;</span>
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :                     l-&gt;next-&gt;asend.x = x;</span>
<span class="lineNum">     645 </span>            :                 }
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :             } else if ( l-&gt;asstart.y&lt;0 &amp;&amp; l-&gt;next-&gt;asend.y&lt; 0 )</span>
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :             if (( l-&gt;asstart.y&lt;cv-&gt;height &amp;&amp; l-&gt;next-&gt;asend.y&gt;cv-&gt;height ) ||</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :                     ( l-&gt;asstart.y&gt;cv-&gt;height &amp;&amp; l-&gt;next-&gt;asend.y&lt;cv-&gt;height )) {</span>
<span class="lineNum">     650 </span><span class="lineNoCov">          0 :                 x = (l-&gt;next-&gt;asend.x-l-&gt;asstart.x)*(double)(cv-&gt;height-l-&gt;asstart.y)/(l-&gt;next-&gt;asend.y-l-&gt;asstart.y) +</span>
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :                         l-&gt;asstart.x;</span>
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :                 if (( x&lt;0 || x&gt;=cv-&gt;width ) &amp;&amp; bothout )</span>
<span class="lineNum">     653 </span><span class="lineNoCov">          0 :     continue;                   /* Not on screen */;</span>
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :                 if ( l-&gt;asstart.y&gt;cv-&gt;height ) {</span>
<span class="lineNum">     655 </span><span class="lineNoCov">          0 :                     l-&gt;asstart.y = cv-&gt;height;</span>
<span class="lineNum">     656 </span><span class="lineNoCov">          0 :                     l-&gt;asstart.x = x;</span>
<span class="lineNum">     657 </span>            :                 } else {
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :                     l-&gt;next-&gt;asend.y = cv-&gt;height;</span>
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :                     l-&gt;next-&gt;asend.x = x;</span>
<span class="lineNum">     660 </span>            :                 }
<span class="lineNum">     661 </span><span class="lineNoCov">          0 :             } else if ( l-&gt;asstart.y&gt;cv-&gt;height &amp;&amp; l-&gt;next-&gt;asend.y&gt;cv-&gt;height )</span>
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :             l-&gt;flags |= cvli_onscreen;</span>
<span class="lineNum">     664 </span><span class="lineNoCov">          0 :             any = true;</span>
<span class="lineNum">     665 </span>            :         }
<span class="lineNum">     666 </span>            :     }
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :     lap-&gt;any = any;</span>
<span class="lineNum">     668 </span><span class="lineNoCov">          0 : return( any );</span>
<span class="lineNum">     669 </span>            : }
<span class="lineNum">     670 </span>            : 
<a name="671"><span class="lineNum">     671 </span>            : typedef struct gpl { struct gpl *next; GPoint *gp; int cnt; } GPointList;</a>
<span class="lineNum">     672 </span>            : 
<span class="lineNum">     673 </span><span class="lineNoCov">          0 : static void GPLFree(GPointList *gpl) {</span>
<span class="lineNum">     674 </span>            :     GPointList *next;
<span class="lineNum">     675 </span>            : 
<span class="lineNum">     676 </span><span class="lineNoCov">          0 :     while ( gpl!=NULL ) {</span>
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :         next = gpl-&gt;next;</span>
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :         free( gpl-&gt;gp );</span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :         free( gpl );</span>
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :         gpl = next;</span>
<span class="lineNum">     681 </span>            :     }
<span class="lineNum">     682 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     683 </span>            : 
<span class="lineNum">     684 </span>            : /* Before we did clipping this was a single polygon. Now it is a set of */
<span class="lineNum">     685 </span>            : /*  sets of line segments. If no clipping is done, then we end up with */
<a name="686"><span class="lineNum">     686 </span>            : /*  one set which is the original polygon, otherwise we get the segments */</a>
<span class="lineNum">     687 </span>            : /*  which are inside the screen. Each set of segments is contiguous */
<span class="lineNum">     688 </span><span class="lineNoCov">          0 : static GPointList *MakePoly(CharView *cv, SplinePointList *spl) {</span>
<span class="lineNum">     689 </span>            :     int i, len;
<span class="lineNum">     690 </span>            :     LinearApprox *lap;
<span class="lineNum">     691 </span>            :     LineList *line, *prev;
<span class="lineNum">     692 </span>            :     Spline *spline, *first;
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :     GPointList *head=NULL, *last=NULL, *cur;</span>
<span class="lineNum">     694 </span>            :     int closed;
<span class="lineNum">     695 </span>            : 
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;2; ++i ) {</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :         len = 0; first = NULL;</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :         closed = true;</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :         cur = NULL;</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :         for ( spline = spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 :             if ( !CVSplineOutside(cv,spline) &amp;&amp; !isnan(spline-&gt;splines[0].a) &amp;&amp; !isnan(spline-&gt;splines[1].a)) {</span>
<span class="lineNum">     702 </span><span class="lineNoCov">          0 :                 lap = SplineApproximate(spline,cv-&gt;scale);</span>
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :                 if ( i==0 )</span>
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :                     CVLinesIntersectScreen(cv,lap);</span>
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :                 if ( lap-&gt;any ) {</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :                     for ( prev = lap-&gt;lines, line=prev-&gt;next; line!=NULL; prev=line, line=line-&gt;next ) {</span>
<span class="lineNum">     707 </span><span class="lineNoCov">          0 :                         if ( !(prev-&gt;flags&amp;cvli_onscreen) ) {</span>
<span class="lineNum">     708 </span><span class="lineNoCov">          0 :                             closed = true;</span>
<span class="lineNum">     709 </span><span class="lineNoCov">          0 :                     continue;</span>
<span class="lineNum">     710 </span>            :                         }
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :                         if ( closed || (prev-&gt;flags&amp;cvli_clipped) ) {</span>
<span class="lineNum">     712 </span><span class="lineNoCov">          0 :                             if ( i==0 ) {</span>
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :                                 cur = calloc(1,sizeof(GPointList));</span>
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :                                 if ( head==NULL )</span>
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :                                     head = cur;</span>
<span class="lineNum">     716 </span>            :                                 else {
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :                                     last-&gt;cnt = len;</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :                                     last-&gt;next = cur;</span>
<span class="lineNum">     719 </span>            :                                 }
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :                                 last = cur;</span>
<span class="lineNum">     721 </span>            :                             } else {
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :                                 if ( cur==NULL )</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :                                     cur = head;</span>
<span class="lineNum">     724 </span>            :                                 else
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :                                     cur = cur-&gt;next;</span>
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :                                 cur-&gt;gp = malloc(cur-&gt;cnt*sizeof(GPoint));</span>
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :                                 cur-&gt;gp[0].x = prev-&gt;asstart.x;</span>
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :                                 cur-&gt;gp[0].y = prev-&gt;asstart.y;</span>
<span class="lineNum">     729 </span>            :                             }
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :                             len=1;</span>
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :                             closed = false;</span>
<span class="lineNum">     732 </span>            :                         }
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :                         if ( i!=0 ) {</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :                             if ( len&gt;=cur-&gt;cnt )</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :                                 fprintf( stderr, &quot;Clipping is screwed up, about to die %d (should be less than %d)\n&quot;, len, cur-&gt;cnt );</span>
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :                             cur-&gt;gp[len].x = line-&gt;asend.x;</span>
<span class="lineNum">     737 </span><span class="lineNoCov">          0 :                             cur-&gt;gp[len].y = line-&gt;asend.y;</span>
<span class="lineNum">     738 </span>            :                         }
<span class="lineNum">     739 </span><span class="lineNoCov">          0 :                         ++len;</span>
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :                         if ( line-&gt;flags&amp;cvli_clipped )</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :                             closed = true;</span>
<span class="lineNum">     742 </span>            :                     }
<span class="lineNum">     743 </span>            :                 } else
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :                     closed = true;</span>
<span class="lineNum">     745 </span>            :             } else
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :                 closed = true;</span>
<span class="lineNum">     747 </span><span class="lineNoCov">          0 :             if ( first==NULL ) first = spline;</span>
<span class="lineNum">     748 </span>            :         }
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :         if ( i==0 &amp;&amp; cur!=NULL )</span>
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :             cur-&gt;cnt = len;</span>
<span class="lineNum">     751 </span>            :     }
<span class="lineNum">     752 </span><span class="lineNoCov">          0 : return( head );</span>
<a name="753"><span class="lineNum">     753 </span>            : }</a>
<span class="lineNum">     754 </span>            : 
<span class="lineNum">     755 </span><span class="lineNoCov">          0 : static void DrawTangentPoint( GWindow pixmap, int x, int y,</span>
<span class="lineNum">     756 </span>            :                               BasePoint *unit, int outline, Color col )
<span class="lineNum">     757 </span>            : {
<span class="lineNum">     758 </span>            :     int dir;
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :     const int gp_sz = 4;</span>
<span class="lineNum">     760 </span>            :     GPoint gp[5];
<span class="lineNum">     761 </span>            : 
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :     dir = 0;</span>
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :     if ( unit-&gt;x!=0 || unit-&gt;y!=0 ) {</span>
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :         float dx = unit-&gt;x, dy = unit-&gt;y;</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :         if ( dx&lt;0 ) dx= -dx;</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :         if ( dy&lt;0 ) dy= -dy;</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :         if ( dx&gt;2*dy ) {</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :             if ( unit-&gt;x&gt;0 ) dir = 0 /* right */;</span>
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :             else dir = 1 /* left */;</span>
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :         } else if ( dy&gt;2*dx ) {</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :             if ( unit-&gt;y&gt;0 ) dir = 2 /* up */;</span>
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :             else dir = 3 /* down */;</span>
<span class="lineNum">     773 </span>            :         } else {
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :             if ( unit-&gt;y&gt;0 &amp;&amp; unit-&gt;x&gt;0 ) dir=4;</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :             else if ( unit-&gt;x&gt;0 ) dir=5;</span>
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :             else if ( unit-&gt;y&gt;0 ) dir=7;</span>
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :             else dir = 6;</span>
<span class="lineNum">     778 </span>            :         }
<span class="lineNum">     779 </span>            :     }
<span class="lineNum">     780 </span>            : 
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :     float sizedelta = 4;</span>
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :     if( prefs_cvEditHandleSize &gt; prefs_cvEditHandleSize_default )</span>
<span class="lineNum">     783 </span><span class="lineNoCov">          0 :         sizedelta *= prefs_cvEditHandleSize / prefs_cvEditHandleSize_default;</span>
<span class="lineNum">     784 </span>            : 
<span class="lineNum">     785 </span><span class="lineNoCov">          0 :     if ( dir==1 /* left */ || dir==0 /* right */) {</span>
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :         gp[0].y = y; gp[0].x = (dir==0)?x+sizedelta:x-sizedelta;</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :         gp[1].y = y-sizedelta; gp[1].x = x;</span>
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :         gp[2].y = y+sizedelta; gp[2].x = x;</span>
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :     } else if ( dir==2 /* up */ || dir==3 /* down */ ) {</span>
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :         gp[0].x = x; gp[0].y = dir==2?y-sizedelta:y+sizedelta;  /* remember screen coordinates are backwards in y from character coords */</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :         gp[1].x = x-sizedelta; gp[1].y = y;</span>
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :         gp[2].x = x+sizedelta; gp[2].y = y;</span>
<span class="lineNum">     793 </span>            :     } else {
<span class="lineNum">     794 </span>            :         /* at a 45 angle, a value of 4 looks too small. I probably want 4*1.414 */
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :         sizedelta = 5;</span>
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :         if( prefs_cvEditHandleSize &gt; prefs_cvEditHandleSize_default )</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :             sizedelta *= prefs_cvEditHandleSize / prefs_cvEditHandleSize_default;</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :         int xdiff = unit-&gt;x &gt; 0 ?   sizedelta  : -1*sizedelta;</span>
<span class="lineNum">     799 </span><span class="lineNoCov">          0 :         int ydiff = unit-&gt;y &gt; 0 ? -1*sizedelta :    sizedelta;</span>
<span class="lineNum">     800 </span>            : 
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :         gp[0].x = x+xdiff/2; gp[0].y = y+ydiff/2;</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :         gp[1].x = gp[0].x-xdiff; gp[1].y = gp[0].y;</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :         gp[2].x = gp[0].x; gp[2].y = gp[0].y-ydiff;</span>
<span class="lineNum">     804 </span>            :     }
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :     gp[3] = gp[0];</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :     if ( outline )</span>
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :         GDrawDrawPoly(pixmap,gp,gp_sz,col);</span>
<span class="lineNum">     808 </span>            :     else
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :         GDrawFillPoly(pixmap,gp,4,col);</span>
<a name="810"><span class="lineNum">     810 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     811 </span>            : 
<span class="lineNum">     812 </span><span class="lineNoCov">          0 : static GRect* DrawPoint_SetupRectForSize( GRect* r, int cx, int cy, float sz )</span>
<span class="lineNum">     813 </span>            : {
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :     float sizedelta = sz;</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :     if( prefs_cvEditHandleSize &gt; prefs_cvEditHandleSize_default )</span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :         sizedelta *= prefs_cvEditHandleSize / prefs_cvEditHandleSize_default;</span>
<span class="lineNum">     817 </span>            : 
<span class="lineNum">     818 </span><span class="lineNoCov">          0 :     r-&gt;x = cx - sizedelta;</span>
<span class="lineNum">     819 </span><span class="lineNoCov">          0 :     r-&gt;y = cy - sizedelta;</span>
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :     r-&gt;width  = 1 + sizedelta * 2;</span>
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :     r-&gt;height = 1 + sizedelta * 2;</span>
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :     return r;</span>
<span class="lineNum">     823 </span>            : }
<a name="824"><span class="lineNum">     824 </span>            : </a>
<span class="lineNum">     825 </span>            : 
<span class="lineNum">     826 </span><span class="lineNoCov">          0 : static Color MaybeMaskColorToAlphaChannelOverride( Color c, Color AlphaChannelOverride )</span>
<span class="lineNum">     827 </span>            : {
<span class="lineNum">     828 </span><span class="lineNoCov">          0 :     if( AlphaChannelOverride )</span>
<span class="lineNum">     829 </span>            :     {
<span class="lineNum">     830 </span><span class="lineNoCov">          0 :         c &amp;= 0x00FFFFFF;</span>
<span class="lineNum">     831 </span><span class="lineNoCov">          0 :         c |= (AlphaChannelOverride &amp; 0xFF000000);</span>
<span class="lineNum">     832 </span>            :     }
<span class="lineNum">     833 </span><span class="lineNoCov">          0 :     return c;</span>
<span class="lineNum">     834 </span>            : }
<span class="lineNum">     835 </span>            : 
<span class="lineNum">     836 </span>            : /*
<span class="lineNum">     837 </span>            :  * Format the given real value to .001 precision, discarding trailing
<a name="838"><span class="lineNum">     838 </span>            :  * zeroes, and the decimal point if not needed.</a>
<span class="lineNum">     839 </span>            :  */
<span class="lineNum">     840 </span><span class="lineNoCov">          0 : static int FmtReal(char *buf, int buflen, real r)</span>
<span class="lineNum">     841 </span>            : {
<span class="lineNum">     842 </span><span class="lineNoCov">          0 :     if (buf &amp;&amp; buflen &gt; 0) {</span>
<span class="lineNum">     843 </span>            :         int ct;
<span class="lineNum">     844 </span>            : 
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :         if ((ct = snprintf(buf, buflen, &quot;%.3f&quot;, r)) &gt;= buflen)</span>
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :             ct = buflen-1;</span>
<span class="lineNum">     847 </span>            :     
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :         if (strchr(buf, '.')) {</span>
<span class="lineNum">     849 </span><span class="lineNoCov">          0 :             while (buf[ct-1] == '0') {</span>
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :                 --ct;</span>
<span class="lineNum">     851 </span>            :             }
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :             if (buf[ct-1] == '.') {</span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :                 --ct;</span>
<span class="lineNum">     854 </span>            :             }
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :             buf[ct] = '\0';</span>
<span class="lineNum">     856 </span>            :         }
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :         return ct;</span>
<span class="lineNum">     858 </span>            :     }
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :     return -1;</span>
<span class="lineNum">     860 </span>            : }           
<span class="lineNum">     861 </span>            :         
<span class="lineNum">     862 </span>            : /*
<span class="lineNum">     863 </span>            :  * Write the given spline point's coordinates in the form (xxx,yyy)
<span class="lineNum">     864 </span>            :  * into the buffer provided, rounding fractions to the nearest .001
<a name="865"><span class="lineNum">     865 </span>            :  * and discarding trailing zeroes.</a>
<span class="lineNum">     866 </span>            :  */ 
<span class="lineNum">     867 </span><span class="lineNoCov">          0 : static int SplinePointCoords(char *buf, int buflen, SplinePoint *sp)</span>
<span class="lineNum">     868 </span>            : {
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :     if (buf &amp;&amp; buflen &gt; 0) {</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :         int ct = 0, clen;</span>
<span class="lineNum">     871 </span>            : 
<span class="lineNum">     872 </span>            :         /* 4 chars for parens, comma and trailing NUL, then divide what
<span class="lineNum">     873 </span>            :            remains between the two coords */
<span class="lineNum">     874 </span><span class="lineNoCov">          0 :         clen = (buflen - 4) / 2;</span>
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :         if (clen &gt; 0) {</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :             buf[ct++] = '(';</span>
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :             ct += FmtReal(buf+ct, clen, sp-&gt;me.x);</span>
<span class="lineNum">     878 </span><span class="lineNoCov">          0 :             buf[ct++] = ',';</span>
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :             ct += FmtReal(buf+ct, clen, sp-&gt;me.y);</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :             buf[ct++] = ')';</span>
<span class="lineNum">     881 </span>            :         }
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :         buf[ct] = '\0';</span>
<span class="lineNum">     883 </span>            : 
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :         return ct;</span>
<span class="lineNum">     885 </span>            :     }
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :     return -1;</span>
<a name="887"><span class="lineNum">     887 </span>            : }</a>
<span class="lineNum">     888 </span>            : 
<span class="lineNum">     889 </span><span class="lineNoCov">          0 : static void DrawPoint( CharView *cv, GWindow pixmap, SplinePoint *sp,</span>
<span class="lineNum">     890 </span>            :                        SplineSet *spl, int onlynumber, int truetype_markup,
<span class="lineNum">     891 </span>            :                        Color AlphaChannelOverride )
<span class="lineNum">     892 </span>            : {
<span class="lineNum">     893 </span>            :     GRect r;
<span class="lineNum">     894 </span>            :     int x, y, cx, cy;
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :     Color col = sp==spl-&gt;first ? firstpointcol : pointcol;</span>
<span class="lineNum">     896 </span>            :     int pnum;
<span class="lineNum">     897 </span>            :     char buf[16];
<span class="lineNum">     898 </span>            :     int isfake;
<span class="lineNum">     899 </span>            : 
<span class="lineNum">     900 </span><span class="lineNoCov">          0 :     if ( DrawOpenPathsWithHighlight</span>
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :          &amp;&amp; cv-&gt;b.drawmode==dm_fore</span>
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :          &amp;&amp; spl-&gt;first</span>
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :          &amp;&amp; spl-&gt;first-&gt;prev==NULL )</span>
<span class="lineNum">     904 </span>            :     {
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :         if( sp!=spl-&gt;first )</span>
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :             col = openpathcol;</span>
<span class="lineNum">     907 </span>            :     }
<span class="lineNum">     908 </span>            : 
<span class="lineNum">     909 </span>            : 
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :     if ( cv-&gt;markextrema &amp;&amp; SpIsExtremum(sp) )</span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :          col = extremepointcol;</span>
<span class="lineNum">     912 </span><span class="lineNoCov">          0 :     if ( sp-&gt;selected )</span>
<span class="lineNum">     913 </span><span class="lineNoCov">          0 :          col = selectedpointcol;</span>
<span class="lineNum">     914 </span>            : 
<span class="lineNum">     915 </span><span class="lineNoCov">          0 :     if ( DrawOpenPathsWithHighlight</span>
<span class="lineNum">     916 </span><span class="lineNoCov">          0 :          &amp;&amp; cv-&gt;b.drawmode==dm_fore</span>
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :          &amp;&amp; spl-&gt;first</span>
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :          &amp;&amp; spl-&gt;first-&gt;prev==NULL )</span>
<span class="lineNum">     919 </span>            :     {
<span class="lineNum">     920 </span>            :     }
<span class="lineNum">     921 </span>            :     else
<span class="lineNum">     922 </span>            :     {
<span class="lineNum">     923 </span><span class="lineNoCov">          0 :         if( !sp-&gt;selected )</span>
<span class="lineNum">     924 </span>            :         {
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :             col = col&amp;0x00ffffff;</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :             col |= prefs_cvInactiveHandleAlpha &lt;&lt; 24;</span>
<span class="lineNum">     927 </span>            :         }
<span class="lineNum">     928 </span>            :     }
<span class="lineNum">     929 </span>            : 
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :     col = MaybeMaskColorToAlphaChannelOverride( col, AlphaChannelOverride );</span>
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :     Color subcolmasked    = MaybeMaskColorToAlphaChannelOverride( subcol, AlphaChannelOverride );</span>
<span class="lineNum">     932 </span><span class="lineNoCov">          0 :     Color nextcpcolmasked = MaybeMaskColorToAlphaChannelOverride( nextcpcol, AlphaChannelOverride );</span>
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :     Color prevcpcolmasked = MaybeMaskColorToAlphaChannelOverride( prevcpcol, AlphaChannelOverride );</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :     Color selectedpointcolmasked = MaybeMaskColorToAlphaChannelOverride( selectedpointcol, AlphaChannelOverride );</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :     Color selectedcpcolmasked = MaybeMaskColorToAlphaChannelOverride( selectedcpcol, AlphaChannelOverride );</span>
<span class="lineNum">     936 </span>            : 
<span class="lineNum">     937 </span><span class="lineNoCov">          0 :     x =  cv-&gt;xoff + rint(sp-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">     938 </span><span class="lineNoCov">          0 :     y = -cv-&gt;yoff + cv-&gt;height - rint(sp-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :     if ( x&lt;-4000 || y&lt;-4000 || x&gt;cv-&gt;width+4000 || y&gt;=cv-&gt;height+4000 )</span>
<span class="lineNum">     940 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     941 </span>            : 
<span class="lineNum">     942 </span>            :     /* draw the control points if it's selected */
<span class="lineNum">     943 </span><span class="lineNoCov">          0 :     if ( sp-&gt;selected</span>
<span class="lineNum">     944 </span><span class="lineNoCov">          0 :          || cv-&gt;showpointnumbers</span>
<span class="lineNum">     945 </span><span class="lineNoCov">          0 :          || cv-&gt;alwaysshowcontrolpoints</span>
<span class="lineNum">     946 </span><span class="lineNoCov">          0 :          || cv-&gt;show_ft_results</span>
<span class="lineNum">     947 </span><span class="lineNoCov">          0 :          || cv-&gt;dv )</span>
<span class="lineNum">     948 </span>            :     {
<span class="lineNum">     949 </span><span class="lineNoCov">          0 :         if ( !sp-&gt;nonextcp ) {</span>
<span class="lineNum">     950 </span><span class="lineNoCov">          0 :             cx =  cv-&gt;xoff + rint(sp-&gt;nextcp.x*cv-&gt;scale);</span>
<span class="lineNum">     951 </span><span class="lineNoCov">          0 :             cy = -cv-&gt;yoff + cv-&gt;height - rint(sp-&gt;nextcp.y*cv-&gt;scale);</span>
<span class="lineNum">     952 </span><span class="lineNoCov">          0 :             if ( cx&lt;-100 ) {         /* Clip */</span>
<span class="lineNum">     953 </span><span class="lineNoCov">          0 :                 cy = cx==x ? x : (cy-y) * (double)(-100-x)/(cx-x) + y;</span>
<span class="lineNum">     954 </span><span class="lineNoCov">          0 :                 cx = -100;</span>
<span class="lineNum">     955 </span><span class="lineNoCov">          0 :             } else if ( cx&gt;cv-&gt;width+100 ) {</span>
<span class="lineNum">     956 </span><span class="lineNoCov">          0 :                 cy = cx==x ? x : (cy-y) * (double)(cv-&gt;width+100-x)/(cx-x) + y;</span>
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :                 cx = cv-&gt;width+100;</span>
<span class="lineNum">     958 </span>            :             }
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :             if ( cy&lt;-100 ) {</span>
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :                 cx = cy==y ? y : (cx-x) * (double)(-100-y)/(cy-y) + x;</span>
<span class="lineNum">     961 </span><span class="lineNoCov">          0 :                 cy = -100;</span>
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :             } else if ( cy&gt;cv-&gt;height+100 ) {</span>
<span class="lineNum">     963 </span><span class="lineNoCov">          0 :                 cx = cy==y ? y : (cx-x) * (double)(cv-&gt;height+100-y)/(cy-y) + x;</span>
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :                 cy = cv-&gt;height+100;</span>
<span class="lineNum">     965 </span>            :             }
<span class="lineNum">     966 </span><span class="lineNoCov">          0 :             subcolmasked = nextcpcolmasked;</span>
<span class="lineNum">     967 </span>            : 
<span class="lineNum">     968 </span>            :             //
<span class="lineNum">     969 </span>            :             // If the next BCP is selected we should decorate the
<span class="lineNum">     970 </span>            :             // drawing to let the user know that. The primary (last)
<span class="lineNum">     971 </span>            :             // selected BCP is drawn with a backing rectangle of size
<span class="lineNum">     972 </span>            :             // 3, the secondary BCP (2nd, 3rd, 4th last selected BCP)
<span class="lineNum">     973 </span>            :             // are drawn with slightly smaller highlights.
<span class="lineNum">     974 </span>            :             //
<span class="lineNum">     975 </span><span class="lineNoCov">          0 :             if( !onlynumber &amp;&amp; SPIsNextCPSelected( sp, cv ))</span>
<span class="lineNum">     976 </span><span class="lineNoCov">          0 :             {</span>
<span class="lineNum">     977 </span><span class="lineNoCov">          0 :                 float sz = 2;</span>
<span class="lineNum">     978 </span><span class="lineNoCov">          0 :                 if( SPIsNextCPSelectedSingle( sp, cv ))</span>
<span class="lineNum">     979 </span><span class="lineNoCov">          0 :                     sz *= 1.5;</span>
<span class="lineNum">     980 </span>            : 
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :                 DrawPoint_SetupRectForSize( &amp;r, cx, cy, sz );</span>
<span class="lineNum">     982 </span><span class="lineNoCov">          0 :                 GDrawFillRect(pixmap,&amp;r, nextcpcol);</span>
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :                 subcolmasked = selectedcpcolmasked;</span>
<span class="lineNum">     984 </span>            :             }
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :             else if ( truetype_markup )</span>
<span class="lineNum">     986 </span>            :             {
<span class="lineNum">     987 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;flexy ) {</span>
<span class="lineNum">     988 </span>            :                     /* cp is about to be moved (or changed in some other way) */
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :                     DrawPoint_SetupRectForSize( &amp;r, cx, cy, 3 );</span>
<span class="lineNum">     990 </span><span class="lineNoCov">          0 :                     GDrawFillRect(pixmap,&amp;r, selectedpointcol);</span>
<span class="lineNum">     991 </span>            :                 }
<span class="lineNum">     992 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;flexx ) {</span>
<span class="lineNum">     993 </span>            :                     /* cp is a reference point */
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :                     DrawPoint_SetupRectForSize( &amp;r, cx, cy, 5 );</span>
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :                     GDrawDrawElipse(pixmap,&amp;r,selectedpointcol );</span>
<span class="lineNum">     996 </span>            :                 }
<span class="lineNum">     997 </span>            :             }
<span class="lineNum">     998 </span><span class="lineNoCov">          0 :             if ( !onlynumber )</span>
<span class="lineNum">     999 </span>            :             {
<span class="lineNum">    1000 </span><span class="lineNoCov">          0 :                 float sizedelta = 3;</span>
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 :                 if( prefs_cvEditHandleSize &gt; prefs_cvEditHandleSize_default )</span>
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 :                     sizedelta *= prefs_cvEditHandleSize / prefs_cvEditHandleSize_default;</span>
<span class="lineNum">    1003 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,x,y,cx,cy, nextcpcolmasked );</span>
<span class="lineNum">    1004 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,cx-sizedelta,cy-sizedelta,cx+sizedelta,cy+sizedelta,subcolmasked);</span>
<span class="lineNum">    1005 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,cx+sizedelta,cy-sizedelta,cx-sizedelta,cy+sizedelta,subcolmasked);</span>
<span class="lineNum">    1006 </span>            :             }
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 :             if ( cv-&gt;showpointnumbers || cv-&gt;show_ft_results || cv-&gt;dv ) {</span>
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 :                 pnum = sp-&gt;nextcpindex;</span>
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 :                 if ( pnum!=0xffff &amp;&amp; pnum!=0xfffe ) {</span>
<span class="lineNum">    1010 </span><span class="lineNoCov">          0 :                     if (cv-&gt;showpointnumbers == 2)</span>
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :                         SplinePointCoords( buf, sizeof(buf), sp);</span>
<span class="lineNum">    1012 </span>            :                     else
<span class="lineNum">    1013 </span><span class="lineNoCov">          0 :                         sprintf( buf,&quot;%d&quot;, pnum );</span>
<span class="lineNum">    1014 </span><span class="lineNoCov">          0 :                     GDrawDrawText8(pixmap,cx,cy-6,buf,-1,nextcpcol);</span>
<span class="lineNum">    1015 </span>            :                 }
<span class="lineNum">    1016 </span>            :             }
<span class="lineNum">    1017 </span>            :         }
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :         if ( !sp-&gt;noprevcp ) {</span>
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :             cx =  cv-&gt;xoff + rint(sp-&gt;prevcp.x*cv-&gt;scale);</span>
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 :             cy = -cv-&gt;yoff + cv-&gt;height - rint(sp-&gt;prevcp.y*cv-&gt;scale);</span>
<span class="lineNum">    1021 </span><span class="lineNoCov">          0 :             if ( cx&lt;-100 ) {         /* Clip */</span>
<span class="lineNum">    1022 </span><span class="lineNoCov">          0 :                 cy = cx==x ? x : (cy-y) * (double)(-100-x)/(cx-x) + y;</span>
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 :                 cx = -100;</span>
<span class="lineNum">    1024 </span><span class="lineNoCov">          0 :             } else if ( cx&gt;cv-&gt;width+100 ) {</span>
<span class="lineNum">    1025 </span><span class="lineNoCov">          0 :                 cy = cx==x ? x : (cy-y) * (double)(cv-&gt;width+100-x)/(cx-x) + y;</span>
<span class="lineNum">    1026 </span><span class="lineNoCov">          0 :                 cx = cv-&gt;width+100;</span>
<span class="lineNum">    1027 </span>            :             }
<span class="lineNum">    1028 </span><span class="lineNoCov">          0 :             if ( cy&lt;-100 ) {</span>
<span class="lineNum">    1029 </span><span class="lineNoCov">          0 :                 cx = cy==y ? y : (cx-x) * (double)(-100-y)/(cy-y) + x;</span>
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 :                 cy = -100;</span>
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :             } else if ( cy&gt;cv-&gt;height+100 ) {</span>
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :                 cx = cy==y ? y : (cx-x) * (double)(cv-&gt;height+100-y)/(cy-y) + x;</span>
<span class="lineNum">    1033 </span><span class="lineNoCov">          0 :                 cy = cv-&gt;height+100;</span>
<span class="lineNum">    1034 </span>            :             }
<span class="lineNum">    1035 </span><span class="lineNoCov">          0 :             subcolmasked = prevcpcolmasked;</span>
<span class="lineNum">    1036 </span><span class="lineNoCov">          0 :             if( !onlynumber &amp;&amp; SPIsPrevCPSelected( sp, cv ))</span>
<span class="lineNum">    1037 </span>            :             {
<span class="lineNum">    1038 </span><span class="lineNoCov">          0 :                 float sz = 2;</span>
<span class="lineNum">    1039 </span><span class="lineNoCov">          0 :                 if( SPIsPrevCPSelectedSingle( sp, cv ))</span>
<span class="lineNum">    1040 </span><span class="lineNoCov">          0 :                     sz *= 1.5;</span>
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 :                 DrawPoint_SetupRectForSize( &amp;r, cx, cy, sz );</span>
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :                 GDrawFillRect(pixmap,&amp;r, prevcpcol);</span>
<span class="lineNum">    1043 </span><span class="lineNoCov">          0 :                 subcolmasked = selectedcpcolmasked;</span>
<span class="lineNum">    1044 </span>            :             }
<span class="lineNum">    1045 </span><span class="lineNoCov">          0 :             if ( !onlynumber ) {</span>
<span class="lineNum">    1046 </span><span class="lineNoCov">          0 :                 float sizedelta = 3;</span>
<span class="lineNum">    1047 </span><span class="lineNoCov">          0 :                 if( prefs_cvEditHandleSize &gt; prefs_cvEditHandleSize_default )</span>
<span class="lineNum">    1048 </span><span class="lineNoCov">          0 :                     sizedelta *= prefs_cvEditHandleSize / prefs_cvEditHandleSize_default;</span>
<span class="lineNum">    1049 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,x,y,cx,cy, prevcpcolmasked);</span>
<span class="lineNum">    1050 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,cx-sizedelta,cy-sizedelta,cx+sizedelta,cy+sizedelta,subcolmasked);</span>
<span class="lineNum">    1051 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,cx+sizedelta,cy-sizedelta,cx-sizedelta,cy+sizedelta,subcolmasked);</span>
<span class="lineNum">    1052 </span>            :             }
<span class="lineNum">    1053 </span>            :         }
<span class="lineNum">    1054 </span>            :     }
<span class="lineNum">    1055 </span>            : 
<span class="lineNum">    1056 </span><span class="lineNoCov">          0 :     if ( x&lt;-4 || y&lt;-4 || x&gt;cv-&gt;width+4 || y&gt;=cv-&gt;height+4 )</span>
<span class="lineNum">    1057 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1058 </span><span class="lineNoCov">          0 :     r.x = x-2;</span>
<span class="lineNum">    1059 </span><span class="lineNoCov">          0 :     r.y = y-2;</span>
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :     r.width = r.height = 0;</span>
<span class="lineNum">    1061 </span><span class="lineNoCov">          0 :     r.width  += prefs_cvEditHandleSize;</span>
<span class="lineNum">    1062 </span><span class="lineNoCov">          0 :     r.height += prefs_cvEditHandleSize;</span>
<span class="lineNum">    1063 </span><span class="lineNoCov">          0 :     if ( sp-&gt;selected )</span>
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :         GDrawSetLineWidth(pixmap,selectedpointwidth);</span>
<span class="lineNum">    1065 </span><span class="lineNoCov">          0 :     isfake = false;</span>
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2 &amp;&amp;</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :             cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs==NULL )</span>
<span class="lineNum">    1068 </span>            :     {
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :         int mightbe_fake = SPInterpolate(sp);</span>
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :         if ( !mightbe_fake &amp;&amp; sp-&gt;ttfindex==0xffff )</span>
<span class="lineNum">    1071 </span><span class="lineNoCov">          0 :             sp-&gt;ttfindex = 0xfffe;   /* if we have no instructions we won't call instrcheck and won't notice when a point stops being fake */</span>
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 :         else if ( mightbe_fake )</span>
<span class="lineNum">    1073 </span><span class="lineNoCov">          0 :             sp-&gt;ttfindex = 0xffff;</span>
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :         isfake = sp-&gt;ttfindex==0xffff;</span>
<span class="lineNum">    1075 </span>            :     }
<span class="lineNum">    1076 </span><span class="lineNoCov">          0 :     if ( onlynumber )</span>
<span class="lineNum">    1077 </span>            :     {
<span class="lineNum">    1078 </span>            :         /* Draw Nothing */;
<span class="lineNum">    1079 </span>            :     }
<span class="lineNum">    1080 </span><span class="lineNoCov">          0 :     else if ( sp-&gt;pointtype==pt_curve )</span>
<span class="lineNum">    1081 </span>            :     {
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :         r.width +=2; r.height += 2;</span>
<span class="lineNum">    1083 </span><span class="lineNoCov">          0 :         r.x = x - r.width  / 2;</span>
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :         r.y = y - r.height / 2;</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">          0 :         if ( sp-&gt;selected || isfake )</span>
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :             GDrawDrawElipse(pixmap,&amp;r,col);</span>
<span class="lineNum">    1087 </span>            :         else
<span class="lineNum">    1088 </span><span class="lineNoCov">          0 :             GDrawFillElipse(pixmap,&amp;r,col);</span>
<span class="lineNum">    1089 </span>            :     }
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :     else if ( sp-&gt;pointtype==pt_corner )</span>
<span class="lineNum">    1091 </span>            :     {
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :         r.x = x - r.width  / 2;</span>
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 :         r.y = y - r.height / 2;</span>
<span class="lineNum">    1094 </span><span class="lineNoCov">          0 :         if ( sp-&gt;selected || isfake )</span>
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 :             GDrawDrawRect(pixmap,&amp;r,col);</span>
<span class="lineNum">    1096 </span>            :         else
<span class="lineNum">    1097 </span><span class="lineNoCov">          0 :             GDrawFillRect(pixmap,&amp;r,col);</span>
<span class="lineNum">    1098 </span>            :     }
<span class="lineNum">    1099 </span><span class="lineNoCov">          0 :     else if ( sp-&gt;pointtype==pt_hvcurve )</span>
<span class="lineNum">    1100 </span>            :     {
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :         const int gp_sz = 5;</span>
<span class="lineNum">    1102 </span>            :         GPoint gp[5];
<span class="lineNum">    1103 </span>            : 
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :         float sizedelta = 3;</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :         float offsetdelta = 0; // 4 * cv-&gt;scale;</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :         if( prefs_cvEditHandleSize &gt; prefs_cvEditHandleSize_default )</span>
<span class="lineNum">    1107 </span>            :         {
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :             sizedelta   *= prefs_cvEditHandleSize / prefs_cvEditHandleSize_default;</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :             offsetdelta *= prefs_cvEditHandleSize / prefs_cvEditHandleSize_default;</span>
<span class="lineNum">    1110 </span>            :         }
<span class="lineNum">    1111 </span>            : 
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :         float basex = r.x + 3 + offsetdelta;</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :         float basey = r.y + 3 + offsetdelta;</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :         gp[0].x = basex - sizedelta; gp[0].y = basey + 0;</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :         gp[1].x = basex + 0;         gp[1].y = basey + sizedelta;</span>
<span class="lineNum">    1116 </span><span class="lineNoCov">          0 :         gp[2].x = basex + sizedelta; gp[2].y = basey + 0;</span>
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :         gp[3].x = basex + 0;         gp[3].y = basey - sizedelta;</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :         gp[4] = gp[0];</span>
<span class="lineNum">    1119 </span>            : 
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 :         if ( sp-&gt;selected || isfake )</span>
<span class="lineNum">    1121 </span><span class="lineNoCov">          0 :             GDrawDrawPoly(pixmap,gp,gp_sz,col);</span>
<span class="lineNum">    1122 </span>            :         else
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :             GDrawFillPoly(pixmap,gp,gp_sz,col);</span>
<span class="lineNum">    1124 </span>            :     }
<span class="lineNum">    1125 </span>            :     else
<span class="lineNum">    1126 </span>            :     {
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 :         BasePoint *cp=NULL;</span>
<span class="lineNum">    1128 </span>            :         BasePoint unit;
<span class="lineNum">    1129 </span>            : 
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :         if ( !sp-&gt;nonextcp )</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 :             cp = &amp;sp-&gt;nextcp;</span>
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 :         else if ( !sp-&gt;noprevcp )</span>
<span class="lineNum">    1133 </span><span class="lineNoCov">          0 :             cp = &amp;sp-&gt;prevcp;</span>
<span class="lineNum">    1134 </span><span class="lineNoCov">          0 :         memset(&amp;unit,0,sizeof(unit));</span>
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 :         if ( cp!=NULL ) {</span>
<span class="lineNum">    1136 </span><span class="lineNoCov">          0 :             unit.x = cp-&gt;x-sp-&gt;me.x; unit.y = cp-&gt;y-sp-&gt;me.y;</span>
<span class="lineNum">    1137 </span>            :         }
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 :         DrawTangentPoint(pixmap, x, y, &amp;unit, sp-&gt;selected || isfake, col);</span>
<span class="lineNum">    1139 </span>            :     }
<span class="lineNum">    1140 </span><span class="lineNoCov">          0 :     GDrawSetLineWidth(pixmap,0);</span>
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :     if ( (cv-&gt;showpointnumbers || cv-&gt;show_ft_results || cv-&gt;dv )</span>
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :          &amp;&amp; sp-&gt;ttfindex!=0xffff )</span>
<span class="lineNum">    1143 </span>            :     {
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :         if ( sp-&gt;ttfindex==0xfffe )</span>
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :             strcpy(buf,&quot;??&quot;);</span>
<span class="lineNum">    1146 </span><span class="lineNoCov">          0 :         else if (cv-&gt;showpointnumbers == 2)</span>
<span class="lineNum">    1147 </span><span class="lineNoCov">          0 :             SplinePointCoords(buf, sizeof(buf), sp);</span>
<span class="lineNum">    1148 </span>            :         else
<span class="lineNum">    1149 </span><span class="lineNoCov">          0 :             sprintf( buf,&quot;%d&quot;, sp-&gt;ttfindex );</span>
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :         GDrawDrawText8(pixmap,x,y-6,buf,-1,col);</span>
<span class="lineNum">    1151 </span>            :     }
<span class="lineNum">    1152 </span><span class="lineNoCov">          0 :     if ( truetype_markup &amp;&amp; sp-&gt;roundx ) {</span>
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :         r.x = x-5; r.y = y-5;</span>
<span class="lineNum">    1154 </span><span class="lineNoCov">          0 :         r.width = r.height = 11;</span>
<span class="lineNum">    1155 </span><span class="lineNoCov">          0 :         GDrawDrawElipse(pixmap,&amp;r,selectedpointcolmasked);</span>
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :     } else if ( !onlynumber &amp;&amp; !truetype_markup ) {</span>
<span class="lineNum">    1157 </span><span class="lineNoCov">          0 :         if ((( sp-&gt;roundx || sp-&gt;roundy ) &amp;&amp;</span>
<span class="lineNum">    1158 </span><span class="lineNoCov">          0 :                  (((cv-&gt;showrounds&amp;1) &amp;&amp; cv-&gt;scale&gt;=.3) || (cv-&gt;showrounds&amp;2))) ||</span>
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 :                 (sp-&gt;watched &amp;&amp; cv-&gt;dv!=NULL) ||</span>
<span class="lineNum">    1160 </span><span class="lineNoCov">          0 :                 sp-&gt;hintmask!=NULL ) {</span>
<span class="lineNum">    1161 </span><span class="lineNoCov">          0 :             r.x = x-5; r.y = y-5;</span>
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :             r.width = r.height = 11;</span>
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 :             GDrawDrawElipse(pixmap,&amp;r,col);</span>
<span class="lineNum">    1164 </span>            :         }
<span class="lineNum">    1165 </span><span class="lineNoCov">          0 :         if (( sp-&gt;flexx &amp;&amp; cv-&gt;showhhints ) || (sp-&gt;flexy &amp;&amp; cv-&gt;showvhints)) {</span>
<span class="lineNum">    1166 </span><span class="lineNoCov">          0 :             r.x = x-5; r.y = y-5;</span>
<span class="lineNum">    1167 </span><span class="lineNoCov">          0 :             r.width = r.height = 11;</span>
<span class="lineNum">    1168 </span><span class="lineNoCov">          0 :             GDrawDrawElipse(pixmap,&amp;r,</span>
<span class="lineNum">    1169 </span><span class="lineNoCov">          0 :                             MaybeMaskColorToAlphaChannelOverride( sp-&gt;flexx ? hflexhintcol : vflexhintcol,</span>
<span class="lineNum">    1170 </span>            :                                                                   AlphaChannelOverride ));
<span class="lineNum">    1171 </span>            :         }
<span class="lineNum">    1172 </span>            :     }
<a name="1173"><span class="lineNum">    1173 </span>            : }</a>
<span class="lineNum">    1174 </span>            : 
<span class="lineNum">    1175 </span><span class="lineNoCov">          0 : static void DrawSpiroPoint( CharView *cv, GWindow pixmap, spiro_cp *cp,</span>
<span class="lineNum">    1176 </span>            :                             SplineSet *spl, int cp_i, Color AlphaChannelOverride )
<span class="lineNum">    1177 </span>            : {
<span class="lineNum">    1178 </span>            :     GRect r;
<span class="lineNum">    1179 </span>            :     int x, y;
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :     Color col = cp==&amp;spl-&gt;spiros[0] ? firstpointcol : pointcol;</span>
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 :     char ty = cp-&gt;ty&amp;0x7f;</span>
<span class="lineNum">    1182 </span><span class="lineNoCov">          0 :     int selected = SPIRO_SELECTED(cp);</span>
<span class="lineNum">    1183 </span>            :     GPoint gp[5];
<span class="lineNum">    1184 </span>            : 
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :     if ( selected )</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :          col = selectedpointcol;</span>
<span class="lineNum">    1187 </span>            : 
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :     if( !selected )</span>
<span class="lineNum">    1189 </span>            :     {
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :         col = col &amp; 0x00ffffff;</span>
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 :         col |= prefs_cvInactiveHandleAlpha &lt;&lt; 24;</span>
<span class="lineNum">    1192 </span>            :     }
<span class="lineNum">    1193 </span>            : 
<span class="lineNum">    1194 </span><span class="lineNoCov">          0 :     col = MaybeMaskColorToAlphaChannelOverride( col, AlphaChannelOverride );</span>
<span class="lineNum">    1195 </span>            : 
<span class="lineNum">    1196 </span>            : 
<span class="lineNum">    1197 </span><span class="lineNoCov">          0 :     x =  cv-&gt;xoff + rint(cp-&gt;x*cv-&gt;scale);</span>
<span class="lineNum">    1198 </span><span class="lineNoCov">          0 :     y = -cv-&gt;yoff + cv-&gt;height - rint(cp-&gt;y*cv-&gt;scale);</span>
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :     if ( x&lt;-4 || y&lt;-4 || x&gt;cv-&gt;width+4 || y&gt;=cv-&gt;height+4 )</span>
<span class="lineNum">    1200 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1201 </span>            : 
<span class="lineNum">    1202 </span><span class="lineNoCov">          0 :     DrawPoint_SetupRectForSize( &amp;r, x, y, 2 );</span>
<span class="lineNum">    1203 </span>            :     /* r.x = x-2; */
<span class="lineNum">    1204 </span>            :     /* r.y = y-2; */
<span class="lineNum">    1205 </span>            :     /* r.width = r.height = 5; */
<span class="lineNum">    1206 </span><span class="lineNoCov">          0 :     if ( selected )</span>
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :         GDrawSetLineWidth(pixmap,selectedpointwidth);</span>
<span class="lineNum">    1208 </span>            : 
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :     float sizedelta = 3;</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :     if( prefs_cvEditHandleSize &gt; prefs_cvEditHandleSize_default )</span>
<span class="lineNum">    1211 </span><span class="lineNoCov">          0 :         sizedelta *= prefs_cvEditHandleSize / prefs_cvEditHandleSize_default;</span>
<span class="lineNum">    1212 </span>            : 
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :     if ( ty == SPIRO_RIGHT ) {</span>
<span class="lineNum">    1214 </span><span class="lineNoCov">          0 :         GDrawSetLineWidth(pixmap,2);</span>
<span class="lineNum">    1215 </span><span class="lineNoCov">          0 :         gp[0].x = x-sizedelta; gp[0].y = y-sizedelta;</span>
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 :         gp[1].x = x;           gp[1].y = y-sizedelta;</span>
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 :         gp[2].x = x;           gp[2].y = y+sizedelta;</span>
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :         gp[3].x = x-sizedelta; gp[3].y = y+sizedelta;</span>
<span class="lineNum">    1219 </span><span class="lineNoCov">          0 :         GDrawDrawPoly(pixmap,gp,4,col);</span>
<span class="lineNum">    1220 </span><span class="lineNoCov">          0 :     } else if ( ty == SPIRO_LEFT ) {</span>
<span class="lineNum">    1221 </span><span class="lineNoCov">          0 :         GDrawSetLineWidth(pixmap,2);</span>
<span class="lineNum">    1222 </span><span class="lineNoCov">          0 :         gp[0].x = x+sizedelta; gp[0].y = y-sizedelta;</span>
<span class="lineNum">    1223 </span><span class="lineNoCov">          0 :         gp[1].x = x;           gp[1].y = y-sizedelta;</span>
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :         gp[2].x = x;           gp[2].y = y+sizedelta;</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :         gp[3].x = x+sizedelta; gp[3].y = y+sizedelta;</span>
<span class="lineNum">    1226 </span><span class="lineNoCov">          0 :         GDrawDrawPoly(pixmap,gp,4,col);</span>
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :     } else if ( ty == SPIRO_G2 ) {</span>
<span class="lineNum">    1228 </span>            :         GPoint gp[5];
<span class="lineNum">    1229 </span>            : 
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :         float sizedelta = 3;</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :         float offsetdelta = 1;</span>
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :         if( prefs_cvEditHandleSize &gt; prefs_cvEditHandleSize_default )</span>
<span class="lineNum">    1233 </span>            :         {
<span class="lineNum">    1234 </span><span class="lineNoCov">          0 :             sizedelta   *= prefs_cvEditHandleSize / prefs_cvEditHandleSize_default;</span>
<span class="lineNum">    1235 </span><span class="lineNoCov">          0 :             offsetdelta *= prefs_cvEditHandleSize / prefs_cvEditHandleSize_default;</span>
<span class="lineNum">    1236 </span>            :         }
<span class="lineNum">    1237 </span>            : 
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :         float basex = r.x + 1 + offsetdelta;</span>
<span class="lineNum">    1239 </span><span class="lineNoCov">          0 :         float basey = r.y + 1 + offsetdelta;</span>
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 :         gp[0].x = basex - sizedelta; gp[0].y = basey + 0;</span>
<span class="lineNum">    1241 </span><span class="lineNoCov">          0 :         gp[1].x = basex + 0;         gp[1].y = basey + sizedelta;</span>
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :         gp[2].x = basex + sizedelta; gp[2].y = basey + 0;</span>
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :         gp[3].x = basex + 0;         gp[3].y = basey - sizedelta;</span>
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :         gp[4] = gp[0];</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :         if ( selected )</span>
<span class="lineNum">    1246 </span><span class="lineNoCov">          0 :             GDrawDrawPoly(pixmap,gp,5,col);</span>
<span class="lineNum">    1247 </span>            :         else
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 :             GDrawFillPoly(pixmap,gp,5,col);</span>
<span class="lineNum">    1249 </span><span class="lineNoCov">          0 :     } else if ( ty==SPIRO_CORNER ) {</span>
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :         if ( selected )</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :             GDrawDrawRect(pixmap,&amp;r,col);</span>
<span class="lineNum">    1252 </span>            :         else
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :             GDrawFillRect(pixmap,&amp;r,col);</span>
<span class="lineNum">    1254 </span>            :     } else {
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 :         --r.x; --r.y; r.width +=2; r.height += 2;</span>
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :         if ( selected )</span>
<span class="lineNum">    1257 </span><span class="lineNoCov">          0 :             GDrawDrawElipse(pixmap,&amp;r,col);</span>
<span class="lineNum">    1258 </span>            :         else
<span class="lineNum">    1259 </span><span class="lineNoCov">          0 :             GDrawFillElipse(pixmap,&amp;r,col);</span>
<span class="lineNum">    1260 </span>            :     }
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 :     GDrawSetLineWidth(pixmap,0);</span>
<a name="1262"><span class="lineNum">    1262 </span>            : }</a>
<span class="lineNum">    1263 </span>            : 
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 : static void DrawLine(CharView *cv, GWindow pixmap,</span>
<span class="lineNum">    1265 </span>            :         real x1, real y1, real x2, real y2, Color fg) {
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :     int ix1 = cv-&gt;xoff + rint(x1*cv-&gt;scale);</span>
<span class="lineNum">    1267 </span><span class="lineNoCov">          0 :     int iy1 = -cv-&gt;yoff + cv-&gt;height - rint(y1*cv-&gt;scale);</span>
<span class="lineNum">    1268 </span><span class="lineNoCov">          0 :     int ix2 = cv-&gt;xoff + rint(x2*cv-&gt;scale);</span>
<span class="lineNum">    1269 </span><span class="lineNoCov">          0 :     int iy2 = -cv-&gt;yoff + cv-&gt;height - rint(y2*cv-&gt;scale);</span>
<span class="lineNum">    1270 </span><span class="lineNoCov">          0 :     if ( iy1==iy2 ) {</span>
<span class="lineNum">    1271 </span><span class="lineNoCov">          0 :         if ( iy1&lt;0 || iy1&gt;cv-&gt;height )</span>
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1273 </span><span class="lineNoCov">          0 :         if ( ix1&lt;0 ) ix1 = 0;</span>
<span class="lineNum">    1274 </span><span class="lineNoCov">          0 :         if ( ix2&gt;cv-&gt;width ) ix2 = cv-&gt;width;</span>
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :     } else if ( ix1==ix2 ) {</span>
<span class="lineNum">    1276 </span><span class="lineNoCov">          0 :         if ( ix1&lt;0 || ix1&gt;cv-&gt;width )</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 :         if ( iy1&lt;0 ) iy1 = 0;</span>
<span class="lineNum">    1279 </span><span class="lineNoCov">          0 :         if ( iy2&lt;0 ) iy2 = 0;</span>
<span class="lineNum">    1280 </span><span class="lineNoCov">          0 :         if ( iy1&gt;cv-&gt;height ) iy1 = cv-&gt;height;</span>
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :         if ( iy2&gt;cv-&gt;height ) iy2 = cv-&gt;height;</span>
<span class="lineNum">    1282 </span>            :     }
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap, ix1,iy1, ix2,iy2, fg );</span>
<a name="1284"><span class="lineNum">    1284 </span>            : }</a>
<span class="lineNum">    1285 </span>            : 
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 : static void DrawDirection(CharView *cv,GWindow pixmap, SplinePoint *sp) {</span>
<span class="lineNum">    1287 </span>            :     BasePoint dir, *other;
<span class="lineNum">    1288 </span>            :     double len;
<span class="lineNum">    1289 </span>            :     int x,y,xe,ye;
<span class="lineNum">    1290 </span>            :     SplinePoint *test;
<span class="lineNum">    1291 </span>            : 
<span class="lineNum">    1292 </span><span class="lineNoCov">          0 :     if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1293 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1294 </span>            : 
<span class="lineNum">    1295 </span><span class="lineNoCov">          0 :     x = cv-&gt;xoff + rint(sp-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    1296 </span><span class="lineNoCov">          0 :     y = -cv-&gt;yoff + cv-&gt;height - rint(sp-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    1297 </span><span class="lineNoCov">          0 :     if ( x&lt;0 || y&lt;0 || x&gt;cv-&gt;width || y&gt;cv-&gt;width )</span>
<span class="lineNum">    1298 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1299 </span>            : 
<span class="lineNum">    1300 </span>            :     /* Werner complained when the first point and the second point were at */
<span class="lineNum">    1301 </span>            :     /*  the same location... */ /* Damn. They weren't at the same location */
<span class="lineNum">    1302 </span>            :     /*  the were off by a rounding error. I'm not going to fix for that */
<span class="lineNum">    1303 </span><span class="lineNoCov">          0 :     for ( test=sp; ; ) {</span>
<span class="lineNum">    1304 </span><span class="lineNoCov">          0 :         if ( test-&gt;me.x!=sp-&gt;me.x || test-&gt;me.y!=sp-&gt;me.y ) {</span>
<span class="lineNum">    1305 </span><span class="lineNoCov">          0 :             other = &amp;test-&gt;me;</span>
<span class="lineNum">    1306 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1307 </span><span class="lineNoCov">          0 :         } else if ( !test-&gt;nonextcp ) {</span>
<span class="lineNum">    1308 </span><span class="lineNoCov">          0 :             other = &amp;test-&gt;nextcp;</span>
<span class="lineNum">    1309 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1310 </span>            :         }
<span class="lineNum">    1311 </span><span class="lineNoCov">          0 :         if ( test-&gt;next==NULL )</span>
<span class="lineNum">    1312 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1313 </span><span class="lineNoCov">          0 :         test = test-&gt;next-&gt;to;</span>
<span class="lineNum">    1314 </span><span class="lineNoCov">          0 :         if ( test==sp )</span>
<span class="lineNum">    1315 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1317 </span>            : 
<span class="lineNum">    1318 </span><span class="lineNoCov">          0 :     dir.x = other-&gt;x-sp-&gt;me.x;</span>
<span class="lineNum">    1319 </span><span class="lineNoCov">          0 :     dir.y = sp-&gt;me.y-other-&gt;y;            /* screen coordinates are the mirror of user coords */</span>
<span class="lineNum">    1320 </span><span class="lineNoCov">          0 :     len = sqrt(dir.x*dir.x + dir.y*dir.y);</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :     dir.x /= len; dir.y /= len;</span>
<span class="lineNum">    1322 </span>            : 
<span class="lineNum">    1323 </span><span class="lineNoCov">          0 :     x += rint(5*dir.y);</span>
<span class="lineNum">    1324 </span><span class="lineNoCov">          0 :     y -= rint(5*dir.x);</span>
<span class="lineNum">    1325 </span><span class="lineNoCov">          0 :     xe = x + rint(7*dir.x);</span>
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :     ye = y + rint(7*dir.y);</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap,x,y,xe,ye,firstpointcol);</span>
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap,xe,ye,xe+rint(2*(dir.y-dir.x)),ye+rint(2*(-dir.y-dir.x)), firstpointcol);</span>
<span class="lineNum">    1329 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap,xe,ye,xe+rint(2*(-dir.y-dir.x)),ye+rint(2*(dir.x-dir.y)), firstpointcol);</span>
<a name="1330"><span class="lineNum">    1330 </span>            : }</a>
<span class="lineNum">    1331 </span>            : 
<span class="lineNum">    1332 </span><span class="lineNoCov">          0 : static void CVMarkInterestingLocations(CharView *cv, GWindow pixmap,</span>
<span class="lineNum">    1333 </span>            :         SplinePointList *spl) {
<span class="lineNum">    1334 </span>            :     Spline *s, *first;
<span class="lineNum">    1335 </span>            :     extended interesting[6];
<span class="lineNum">    1336 </span>            :     int i, ecnt, cnt;
<span class="lineNum">    1337 </span>            :     GRect r;
<span class="lineNum">    1338 </span>            : 
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 :     for ( s=spl-&gt;first-&gt;next, first=NULL; s!=NULL &amp;&amp; s!=first; s=s-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1340 </span><span class="lineNoCov">          0 :         if ( first==NULL ) first = s;</span>
<span class="lineNum">    1341 </span><span class="lineNoCov">          0 :         cnt = ecnt = 0;</span>
<span class="lineNum">    1342 </span><span class="lineNoCov">          0 :         if ( cv-&gt;markextrema )</span>
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 :             ecnt = cnt = Spline2DFindExtrema(s,interesting);</span>
<span class="lineNum">    1344 </span>            : 
<span class="lineNum">    1345 </span><span class="lineNoCov">          0 :         if ( cv-&gt;markpoi ) {</span>
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :             cnt += Spline2DFindPointsOfInflection(s,interesting+cnt);</span>
<span class="lineNum">    1347 </span>            :         }
<span class="lineNum">    1348 </span><span class="lineNoCov">          0 :         r.width = r.height = 9;</span>
<span class="lineNum">    1349 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;cnt; ++i ) if ( interesting[i]&gt;0 &amp;&amp; interesting[i]&lt;1.0 ) {</span>
<span class="lineNum">    1350 </span><span class="lineNoCov">          0 :             Color col = i&lt;ecnt ? extremepointcol : pointofinflectioncol;</span>
<span class="lineNum">    1351 </span><span class="lineNoCov">          0 :             double x = ((s-&gt;splines[0].a*interesting[i]+s-&gt;splines[0].b)*interesting[i]+s-&gt;splines[0].c)*interesting[i]+s-&gt;splines[0].d;</span>
<span class="lineNum">    1352 </span><span class="lineNoCov">          0 :             double y = ((s-&gt;splines[1].a*interesting[i]+s-&gt;splines[1].b)*interesting[i]+s-&gt;splines[1].c)*interesting[i]+s-&gt;splines[1].d;</span>
<span class="lineNum">    1353 </span><span class="lineNoCov">          0 :             double sx =  cv-&gt;xoff + rint(x*cv-&gt;scale);</span>
<span class="lineNum">    1354 </span><span class="lineNoCov">          0 :             double sy = -cv-&gt;yoff + cv-&gt;height - rint(y*cv-&gt;scale);</span>
<span class="lineNum">    1355 </span><span class="lineNoCov">          0 :             if ( sx&lt;-5 || sy&lt;-5 || sx&gt;10000 || sy&gt;10000 )</span>
<span class="lineNum">    1356 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    1357 </span><span class="lineNoCov">          0 :             GDrawDrawLine(pixmap,sx-4,sy,sx+4,sy, col);</span>
<span class="lineNum">    1358 </span><span class="lineNoCov">          0 :             GDrawDrawLine(pixmap,sx,sy-4,sx,sy+4, col);</span>
<span class="lineNum">    1359 </span><span class="lineNoCov">          0 :             r.x = sx-4; r.y = sy-4;</span>
<span class="lineNum">    1360 </span><span class="lineNoCov">          0 :             GDrawDrawElipse(pixmap,&amp;r,col);</span>
<span class="lineNum">    1361 </span>            :         }
<span class="lineNum">    1362 </span>            :     }
<a name="1363"><span class="lineNum">    1363 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1364 </span>            : 
<span class="lineNum">    1365 </span><span class="lineNoCov">          0 : static void CVMarkAlmostHV(CharView *cv, GWindow pixmap,</span>
<span class="lineNum">    1366 </span>            :         SplinePointList *spl) {
<span class="lineNum">    1367 </span>            :     Spline *s, *first;
<span class="lineNum">    1368 </span>            :     double dx, dy;
<span class="lineNum">    1369 </span>            :     int x1,x2,y1,y2;
<span class="lineNum">    1370 </span>            : 
<span class="lineNum">    1371 </span><span class="lineNoCov">          0 :     for ( s=spl-&gt;first-&gt;next, first=NULL; s!=NULL &amp;&amp; s!=first; s=s-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1372 </span><span class="lineNoCov">          0 :         if ( first==NULL ) first = s;</span>
<span class="lineNum">    1373 </span>            : 
<span class="lineNum">    1374 </span><span class="lineNoCov">          0 :         if ( s-&gt;islinear ) {</span>
<span class="lineNum">    1375 </span><span class="lineNoCov">          0 :             if ( !cv-&gt;showalmosthvlines )</span>
<span class="lineNum">    1376 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :             if ( (dx = s-&gt;from-&gt;me.x - s-&gt;to-&gt;me.x)&lt;0 ) dx = -dx;</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 :             if ( (dy = s-&gt;from-&gt;me.y - s-&gt;to-&gt;me.y)&lt;0 ) dy = -dy;</span>
<span class="lineNum">    1379 </span><span class="lineNoCov">          0 :             if ( dx&lt;=cv-&gt;hvoffset &amp;&amp; dy&lt;=cv-&gt;hvoffset )</span>
<span class="lineNum">    1380 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    1381 </span><span class="lineNoCov">          0 :             if ( dx==0 || dy==0 )</span>
<span class="lineNum">    1382 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    1383 </span><span class="lineNoCov">          0 :             if ( dx&lt;cv-&gt;hvoffset || dy&lt;cv-&gt;hvoffset ) {</span>
<span class="lineNum">    1384 </span><span class="lineNoCov">          0 :                 x1 =  cv-&gt;xoff + rint(s-&gt;from-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    1385 </span><span class="lineNoCov">          0 :                 y1 = -cv-&gt;yoff + cv-&gt;height - rint(s-&gt;from-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    1386 </span><span class="lineNoCov">          0 :                 x2 =  cv-&gt;xoff + rint(s-&gt;to-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    1387 </span><span class="lineNoCov">          0 :                 y2 = -cv-&gt;yoff + cv-&gt;height - rint(s-&gt;to-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    1388 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,x1,y1,x2,y2,almosthvcol);</span>
<span class="lineNum">    1389 </span>            :             }
<span class="lineNum">    1390 </span>            :         } else {
<span class="lineNum">    1391 </span><span class="lineNoCov">          0 :             if ( !cv-&gt;showalmosthvcurves )</span>
<span class="lineNum">    1392 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    1393 </span><span class="lineNoCov">          0 :             if ( (dx = s-&gt;from-&gt;me.x - s-&gt;from-&gt;nextcp.x)&lt;0 ) dx = -dx;</span>
<span class="lineNum">    1394 </span><span class="lineNoCov">          0 :             if ( (dy = s-&gt;from-&gt;me.y - s-&gt;from-&gt;nextcp.y)&lt;0 ) dy = -dy;</span>
<span class="lineNum">    1395 </span><span class="lineNoCov">          0 :             if ( dx&lt;=cv-&gt;hvoffset &amp;&amp; dy&lt;=cv-&gt;hvoffset )</span>
<span class="lineNum">    1396 </span>            :                 /* Ignore */;
<span class="lineNum">    1397 </span><span class="lineNoCov">          0 :             else if ( dx==0 || dy==0 )</span>
<span class="lineNum">    1398 </span>            :                 /* It's right */;
<span class="lineNum">    1399 </span><span class="lineNoCov">          0 :             else if ( dx&lt;cv-&gt;hvoffset || dy&lt;cv-&gt;hvoffset ) {</span>
<span class="lineNum">    1400 </span><span class="lineNoCov">          0 :                 x2 = x1 =  cv-&gt;xoff + rint(s-&gt;from-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    1401 </span><span class="lineNoCov">          0 :                 y2 = y1 = -cv-&gt;yoff + cv-&gt;height - rint(s-&gt;from-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    1402 </span><span class="lineNoCov">          0 :                 if ( dx&lt;cv-&gt;hvoffset ) {</span>
<span class="lineNum">    1403 </span><span class="lineNoCov">          0 :                     if ( s-&gt;from-&gt;me.y&lt;s-&gt;from-&gt;nextcp.y )</span>
<span class="lineNum">    1404 </span><span class="lineNoCov">          0 :                         y2 += 15;</span>
<span class="lineNum">    1405 </span>            :                     else
<span class="lineNum">    1406 </span><span class="lineNoCov">          0 :                         y2 -= 15;</span>
<span class="lineNum">    1407 </span>            :                 } else {
<span class="lineNum">    1408 </span><span class="lineNoCov">          0 :                     if ( s-&gt;from-&gt;me.x&lt;s-&gt;from-&gt;nextcp.x )</span>
<span class="lineNum">    1409 </span><span class="lineNoCov">          0 :                         x2 += 15;</span>
<span class="lineNum">    1410 </span>            :                     else
<span class="lineNum">    1411 </span><span class="lineNoCov">          0 :                         x2 -= 15;</span>
<span class="lineNum">    1412 </span>            :                 }
<span class="lineNum">    1413 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,x1,y1,x2,y2,almosthvcol);</span>
<span class="lineNum">    1414 </span>            :             }
<span class="lineNum">    1415 </span>            : 
<span class="lineNum">    1416 </span><span class="lineNoCov">          0 :             if ( (dx = s-&gt;to-&gt;me.x - s-&gt;to-&gt;prevcp.x)&lt;0 ) dx = -dx;</span>
<span class="lineNum">    1417 </span><span class="lineNoCov">          0 :             if ( (dy = s-&gt;to-&gt;me.y - s-&gt;to-&gt;prevcp.y)&lt;0 ) dy = -dy;</span>
<span class="lineNum">    1418 </span><span class="lineNoCov">          0 :             if ( dx&lt;=cv-&gt;hvoffset &amp;&amp; dy&lt;=cv-&gt;hvoffset )</span>
<span class="lineNum">    1419 </span>            :                 /* Ignore */;
<span class="lineNum">    1420 </span><span class="lineNoCov">          0 :             else if ( dx==0 || dy==0 )</span>
<span class="lineNum">    1421 </span>            :                 /* It's right */;
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 :             else if ( dx&lt;cv-&gt;hvoffset || dy&lt;cv-&gt;hvoffset ) {</span>
<span class="lineNum">    1423 </span><span class="lineNoCov">          0 :                 x2 = x1 =  cv-&gt;xoff + rint(s-&gt;to-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    1424 </span><span class="lineNoCov">          0 :                 y2 = y1 = -cv-&gt;yoff + cv-&gt;height - rint(s-&gt;to-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    1425 </span><span class="lineNoCov">          0 :                 if ( dx&lt;cv-&gt;hvoffset ) {</span>
<span class="lineNum">    1426 </span><span class="lineNoCov">          0 :                     if ( s-&gt;to-&gt;me.y&lt;s-&gt;to-&gt;prevcp.y )</span>
<span class="lineNum">    1427 </span><span class="lineNoCov">          0 :                         y2 += 15;</span>
<span class="lineNum">    1428 </span>            :                     else
<span class="lineNum">    1429 </span><span class="lineNoCov">          0 :                         y2 -= 15;</span>
<span class="lineNum">    1430 </span>            :                 } else {
<span class="lineNum">    1431 </span><span class="lineNoCov">          0 :                     if ( s-&gt;to-&gt;me.x&lt;s-&gt;to-&gt;prevcp.x )</span>
<span class="lineNum">    1432 </span><span class="lineNoCov">          0 :                         x2 += 15;</span>
<span class="lineNum">    1433 </span>            :                     else
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :                         x2 -= 15;</span>
<span class="lineNum">    1435 </span>            :                 }
<span class="lineNum">    1436 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,x1,y1,x2,y2,almosthvcol);</span>
<span class="lineNum">    1437 </span>            :             }
<span class="lineNum">    1438 </span>            :         }
<span class="lineNum">    1439 </span>            :     }
<a name="1440"><span class="lineNum">    1440 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1441 </span>            : 
<span class="lineNum">    1442 </span><span class="lineNoCov">          0 : static void CVDrawPointName(CharView *cv, GWindow pixmap, SplinePoint *sp, Color fg)</span>
<span class="lineNum">    1443 </span>            : {
<span class="lineNum">    1444 </span><span class="lineNoCov">          0 :     if (sp-&gt;name &amp;&amp; *sp-&gt;name) {</span>
<span class="lineNum">    1445 </span>            :         int32 theight;
<span class="lineNum">    1446 </span>            : 
<span class="lineNum">    1447 </span><span class="lineNoCov">          0 :         GDrawSetFont(pixmap, cv-&gt;normal);</span>
<span class="lineNum">    1448 </span><span class="lineNoCov">          0 :         theight = GDrawGetText8Height(pixmap, sp-&gt;name, -1);</span>
<span class="lineNum">    1449 </span><span class="lineNoCov">          0 :         GDrawDrawText8(pixmap,</span>
<span class="lineNum">    1450 </span><span class="lineNoCov">          0 :                        cv-&gt;xoff + rint(sp-&gt;me.x*cv-&gt;scale),</span>
<span class="lineNum">    1451 </span><span class="lineNoCov">          0 :                        cv-&gt;height-cv-&gt;yoff - rint(sp-&gt;me.y*cv-&gt;scale) + theight + 3,</span>
<span class="lineNum">    1452 </span><span class="lineNoCov">          0 :                        sp-&gt;name,-1,fg);</span>
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :         GDrawSetFont(pixmap,cv-&gt;small);      /* For point numbers */</span>
<span class="lineNum">    1454 </span>            :     }
<a name="1455"><span class="lineNum">    1455 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1456 </span>            : 
<span class="lineNum">    1457 </span><span class="lineNoCov">          0 : static void CVDrawContourName(CharView *cv, GWindow pixmap, SplinePointList *ss,</span>
<span class="lineNum">    1458 </span>            :         Color fg ) {
<span class="lineNum">    1459 </span>            :     SplinePoint *sp, *topright;
<span class="lineNum">    1460 </span>            :     GPoint tr;
<span class="lineNum">    1461 </span>            : 
<span class="lineNum">    1462 </span>            :     /* Find the top right point of the contour. This is where we will put the */
<span class="lineNum">    1463 </span>            :     /*  label */
<span class="lineNum">    1464 </span><span class="lineNoCov">          0 :     for ( sp = topright = ss-&gt;first; ; ) {</span>
<span class="lineNum">    1465 </span><span class="lineNoCov">          0 :         if ( sp-&gt;me.y&gt;topright-&gt;me.y || (sp-&gt;me.y==topright-&gt;me.y &amp;&amp; sp-&gt;me.x&gt;topright-&gt;me.x) )</span>
<span class="lineNum">    1466 </span><span class="lineNoCov">          0 :             topright = sp;</span>
<span class="lineNum">    1467 </span><span class="lineNoCov">          0 :         if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1468 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1469 </span><span class="lineNoCov">          0 :         sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1470 </span><span class="lineNoCov">          0 :         if ( sp==ss-&gt;first )</span>
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1473 </span><span class="lineNoCov">          0 :     tr.x = cv-&gt;xoff + rint(topright-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    1474 </span><span class="lineNoCov">          0 :     tr.y = cv-&gt;height-cv-&gt;yoff - rint(topright-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    1475 </span>            : 
<span class="lineNum">    1476 </span>            :     /* If the top edge of the contour is off the bottom of the screen */
<span class="lineNum">    1477 </span>            :     /*  then the contour won't show */
<span class="lineNum">    1478 </span><span class="lineNoCov">          0 :     if ( tr.y&gt;cv-&gt;height )</span>
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1480 </span>            : 
<span class="lineNum">    1481 </span><span class="lineNoCov">          0 :     GDrawSetFont(pixmap,cv-&gt;normal);</span>
<span class="lineNum">    1482 </span>            : 
<span class="lineNum">    1483 </span><span class="lineNoCov">          0 :     if ( ss-&gt;first-&gt;prev==NULL &amp;&amp; ss-&gt;first-&gt;next!=NULL &amp;&amp;</span>
<span class="lineNum">    1484 </span><span class="lineNoCov">          0 :             ss-&gt;first-&gt;next-&gt;to-&gt;next==NULL &amp;&amp; ss-&gt;first-&gt;next-&gt;knownlinear &amp;&amp;</span>
<span class="lineNum">    1485 </span><span class="lineNoCov">          0 :             (tr.y &lt; cv-&gt;nfh || tr.x&gt;cv-&gt;width-cv-&gt;nfh) ) {</span>
<span class="lineNum">    1486 </span>            :         /* It's a simple line */
<span class="lineNum">    1487 </span>            :         /* A special case because: It's common, and it's important to get it */
<span class="lineNum">    1488 </span>            :         /*  right and label lines even if the point to which we'd normally */
<span class="lineNum">    1489 </span>            :         /*  attach a label is offscreen */
<span class="lineNum">    1490 </span><span class="lineNoCov">          0 :         SplinePoint *sp1 = ss-&gt;first, *sp2 = ss-&gt;first-&gt;next-&gt;to;</span>
<span class="lineNum">    1491 </span>            :         double dx, dy, slope, off, yinter, xinter;
<span class="lineNum">    1492 </span>            : 
<span class="lineNum">    1493 </span><span class="lineNoCov">          0 :         if ( (dx = sp1-&gt;me.x-sp2-&gt;me.x)&lt;0 ) dx = -dx;</span>
<span class="lineNum">    1494 </span><span class="lineNoCov">          0 :         if ( (dy = sp1-&gt;me.y-sp2-&gt;me.y)&lt;0 ) dy = -dy;</span>
<span class="lineNum">    1495 </span><span class="lineNoCov">          0 :         if ( dx==0 ) {</span>
<span class="lineNum">    1496 </span>            :             /* Vertical line */
<span class="lineNum">    1497 </span><span class="lineNoCov">          0 :             tr.y = cv-&gt;nfh;</span>
<span class="lineNum">    1498 </span><span class="lineNoCov">          0 :             tr.x += 2;</span>
<span class="lineNum">    1499 </span><span class="lineNoCov">          0 :         } else if ( dy==0 ) {</span>
<span class="lineNum">    1500 </span>            :             /* Horizontal line */
<span class="lineNum">    1501 </span><span class="lineNoCov">          0 :             tr.x = cv-&gt;width - cv-&gt;nfh - GDrawGetText8Width(pixmap,ss-&gt;contour_name,-1);</span>
<span class="lineNum">    1502 </span>            :         } else {
<span class="lineNum">    1503 </span>            :             /* y = slope*x + off; */
<span class="lineNum">    1504 </span><span class="lineNoCov">          0 :             slope = (sp1-&gt;me.y-sp2-&gt;me.y)/(sp1-&gt;me.x-sp2-&gt;me.x);</span>
<span class="lineNum">    1505 </span><span class="lineNoCov">          0 :             off = sp1-&gt;me.y - slope*sp1-&gt;me.x;</span>
<span class="lineNum">    1506 </span>            :             /* Now translate to screen coords */
<span class="lineNum">    1507 </span><span class="lineNoCov">          0 :             off = (cv-&gt;height-cv-&gt;yoff)+slope*cv-&gt;xoff - cv-&gt;scale*off;</span>
<span class="lineNum">    1508 </span><span class="lineNoCov">          0 :             slope = -slope;</span>
<span class="lineNum">    1509 </span><span class="lineNoCov">          0 :             xinter = (0-off)/slope;</span>
<span class="lineNum">    1510 </span><span class="lineNoCov">          0 :             yinter = slope*cv-&gt;width + off;</span>
<span class="lineNum">    1511 </span><span class="lineNoCov">          0 :             if ( xinter&gt;0 &amp;&amp; xinter&lt;cv-&gt;width ) {</span>
<span class="lineNum">    1512 </span><span class="lineNoCov">          0 :                 tr.x = xinter+2;</span>
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 :                 tr.y = cv-&gt;nfh;</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">          0 :             } else if ( yinter&gt;0 &amp;&amp; yinter&lt;cv-&gt;height ) {</span>
<span class="lineNum">    1515 </span><span class="lineNoCov">          0 :                 tr.x = cv-&gt;width - cv-&gt;nfh - GDrawGetText8Width(pixmap,ss-&gt;contour_name,-1);</span>
<span class="lineNum">    1516 </span><span class="lineNoCov">          0 :                 tr.y = yinter;</span>
<span class="lineNum">    1517 </span>            :             }
<span class="lineNum">    1518 </span>            :         }
<span class="lineNum">    1519 </span>            :     } else {
<span class="lineNum">    1520 </span><span class="lineNoCov">          0 :         tr.y -= cv-&gt;nfh/2;</span>
<span class="lineNum">    1521 </span><span class="lineNoCov">          0 :         tr.x -= GDrawGetText8Width(pixmap,ss-&gt;contour_name,-1)/2;</span>
<span class="lineNum">    1522 </span>            :     }
<span class="lineNum">    1523 </span>            : 
<span class="lineNum">    1524 </span><span class="lineNoCov">          0 :     GDrawDrawText8(pixmap,tr.x,tr.y,ss-&gt;contour_name,-1,fg);</span>
<span class="lineNum">    1525 </span><span class="lineNoCov">          0 :     GDrawSetFont(pixmap,cv-&gt;small);  /* For point numbers */</span>
<a name="1526"><span class="lineNum">    1526 </span>            : }</a>
<span class="lineNum">    1527 </span>            : 
<span class="lineNum">    1528 </span><span class="lineNoCov">          0 : void CVDrawSplineSet(CharView *cv, GWindow pixmap, SplinePointList *set,</span>
<span class="lineNum">    1529 </span>            :         Color fg, int dopoints, DRect *clip ) {
<span class="lineNum">    1530 </span><span class="lineNoCov">          0 :     CVDrawSplineSetSpecialized( cv, pixmap, set, fg, dopoints, clip,</span>
<span class="lineNum">    1531 </span>            :                                 sfm_stroke, 0 );
<span class="lineNum">    1532 </span><span class="lineNoCov">          0 : }</span>
<a name="1533"><span class="lineNum">    1533 </span>            : </a>
<span class="lineNum">    1534 </span>            : 
<span class="lineNum">    1535 </span><span class="lineNoCov">          0 : void CVDrawSplineSetOutlineOnly(CharView *cv, GWindow pixmap, SplinePointList *set,</span>
<span class="lineNum">    1536 </span>            :                                 Color fg, int dopoints, DRect *clip, enum outlinesfm_flags strokeFillMode ) {
<span class="lineNum">    1537 </span>            :     SplinePointList *spl;
<span class="lineNum">    1538 </span><span class="lineNoCov">          0 :     int currentSplineCounter = 0;</span>
<span class="lineNum">    1539 </span><span class="lineNoCov">          0 :     int activelayer = CVLayer(&amp;cv-&gt;b);</span>
<span class="lineNum">    1540 </span>            : 
<span class="lineNum">    1541 </span><span class="lineNoCov">          0 :     if( strokeFillMode == sfm_fill ) {</span>
<span class="lineNum">    1542 </span><span class="lineNoCov">          0 :         GDrawFillRuleSetWinding(pixmap);</span>
<span class="lineNum">    1543 </span>            :     }
<span class="lineNum">    1544 </span>            : 
<span class="lineNum">    1545 </span><span class="lineNoCov">          0 :     for ( spl = set; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">    1546 </span>            : 
<span class="lineNum">    1547 </span><span class="lineNoCov">          0 :         Color fc  = spl-&gt;is_clip_path ? clippathcol : fg;</span>
<span class="lineNum">    1548 </span>            :         /**
<span class="lineNum">    1549 </span>            :          * Only make the outline red if this is not a grid layer
<span class="lineNum">    1550 </span>            :          * and we want to highlight open paths
<span class="lineNum">    1551 </span>            :          * and the activelayer is sane
<span class="lineNum">    1552 </span>            :          * and the activelayer contains the given splinepointlist
<span class="lineNum">    1553 </span>            :          * and the path is open
<span class="lineNum">    1554 </span>            :          */
<span class="lineNum">    1555 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.drawmode!=dm_grid</span>
<span class="lineNum">    1556 </span><span class="lineNoCov">          0 :              &amp;&amp; DrawOpenPathsWithHighlight</span>
<span class="lineNum">    1557 </span><span class="lineNoCov">          0 :              &amp;&amp; activelayer &lt; cv-&gt;b.sc-&gt;layer_cnt</span>
<span class="lineNum">    1558 </span><span class="lineNoCov">          0 :              &amp;&amp; activelayer &gt;= 0</span>
<span class="lineNum">    1559 </span><span class="lineNoCov">          0 :              &amp;&amp; SplinePointListContains( cv-&gt;b.sc-&gt;layers[activelayer].splines, spl )</span>
<span class="lineNum">    1560 </span><span class="lineNoCov">          0 :              &amp;&amp; spl-&gt;first</span>
<span class="lineNum">    1561 </span><span class="lineNoCov">          0 :              &amp;&amp; spl-&gt;first-&gt;prev==NULL )</span>
<span class="lineNum">    1562 </span>            :         {
<span class="lineNum">    1563 </span><span class="lineNoCov">          0 :             fc = openpathcol;</span>
<span class="lineNum">    1564 </span>            :         }
<span class="lineNum">    1565 </span>            : 
<span class="lineNum">    1566 </span><span class="lineNoCov">          0 :         if ( GDrawHasCairo(pixmap)&amp;gc_buildpath ) {</span>
<span class="lineNum">    1567 </span>            :             Spline *first, *spline;
<span class="lineNum">    1568 </span>            :             double x,y, cx1, cy1, cx2, cy2, dx,dy;
<span class="lineNum">    1569 </span><span class="lineNoCov">          0 :             GDrawPathStartSubNew(pixmap);</span>
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 :             x = rpt(cv,  cv-&gt;xoff + spl-&gt;first-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    1571 </span><span class="lineNoCov">          0 :             y = rpt(cv, -cv-&gt;yoff + cv-&gt;height - spl-&gt;first-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    1572 </span><span class="lineNoCov">          0 :             GDrawPathMoveTo(pixmap,x+.5,y+.5);</span>
<span class="lineNum">    1573 </span><span class="lineNoCov">          0 :             currentSplineCounter++;</span>
<span class="lineNum">    1574 </span><span class="lineNoCov">          0 :             for ( spline=spl-&gt;first-&gt;next, first=NULL; spline!=first &amp;&amp; spline!=NULL; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1575 </span><span class="lineNoCov">          0 :                 x = rpt(cv,  cv-&gt;xoff + spline-&gt;to-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    1576 </span><span class="lineNoCov">          0 :                 y = rpt(cv, -cv-&gt;yoff + cv-&gt;height - spline-&gt;to-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    1577 </span><span class="lineNoCov">          0 :                 if ( spline-&gt;knownlinear )</span>
<span class="lineNum">    1578 </span><span class="lineNoCov">          0 :                     GDrawPathLineTo(pixmap,x+.5,y+.5);</span>
<span class="lineNum">    1579 </span><span class="lineNoCov">          0 :                 else if ( spline-&gt;order2 ) {</span>
<span class="lineNum">    1580 </span><span class="lineNoCov">          0 :                     dx = rint(spline-&gt;from-&gt;me.x*cv-&gt;scale) - spline-&gt;from-&gt;me.x*cv-&gt;scale;</span>
<span class="lineNum">    1581 </span><span class="lineNoCov">          0 :                     dy = rint(spline-&gt;from-&gt;me.y*cv-&gt;scale) - spline-&gt;from-&gt;me.y*cv-&gt;scale;</span>
<span class="lineNum">    1582 </span><span class="lineNoCov">          0 :                     cx1 = spline-&gt;from-&gt;me.x + spline-&gt;splines[0].c/3;</span>
<span class="lineNum">    1583 </span><span class="lineNoCov">          0 :                     cy1 = spline-&gt;from-&gt;me.y + spline-&gt;splines[1].c/3;</span>
<span class="lineNum">    1584 </span><span class="lineNoCov">          0 :                     cx2 = cx1 + (spline-&gt;splines[0].b+spline-&gt;splines[0].c)/3;</span>
<span class="lineNum">    1585 </span><span class="lineNoCov">          0 :                     cy2 = cy1 + (spline-&gt;splines[1].b+spline-&gt;splines[1].c)/3;</span>
<span class="lineNum">    1586 </span><span class="lineNoCov">          0 :                     cx1 = cv-&gt;xoff + cx1*cv-&gt;scale + dx;</span>
<span class="lineNum">    1587 </span><span class="lineNoCov">          0 :                     cy1 = -cv-&gt;yoff + cv-&gt;height - cy1*cv-&gt;scale - dy;</span>
<span class="lineNum">    1588 </span><span class="lineNoCov">          0 :                     dx = rint(spline-&gt;to-&gt;me.x*cv-&gt;scale) - spline-&gt;to-&gt;me.x*cv-&gt;scale;</span>
<span class="lineNum">    1589 </span><span class="lineNoCov">          0 :                     dy = rint(spline-&gt;to-&gt;me.y*cv-&gt;scale) - spline-&gt;to-&gt;me.y*cv-&gt;scale;</span>
<span class="lineNum">    1590 </span><span class="lineNoCov">          0 :                     cx2 = cv-&gt;xoff + cx2*cv-&gt;scale + dx;</span>
<span class="lineNum">    1591 </span><span class="lineNoCov">          0 :                     cy2 = -cv-&gt;yoff + cv-&gt;height - cy2*cv-&gt;scale - dy;</span>
<span class="lineNum">    1592 </span><span class="lineNoCov">          0 :                     GDrawPathCurveTo(pixmap,cx1+.5,cy1+.5,cx2+.5,cy2+.5,x+.5,y+.5);</span>
<span class="lineNum">    1593 </span>            :                 } else {
<span class="lineNum">    1594 </span><span class="lineNoCov">          0 :                     dx = rint(spline-&gt;from-&gt;me.x*cv-&gt;scale) - spline-&gt;from-&gt;me.x*cv-&gt;scale;</span>
<span class="lineNum">    1595 </span><span class="lineNoCov">          0 :                     dy = rint(spline-&gt;from-&gt;me.y*cv-&gt;scale) - spline-&gt;from-&gt;me.y*cv-&gt;scale;</span>
<span class="lineNum">    1596 </span><span class="lineNoCov">          0 :                     cx1 = cv-&gt;xoff + spline-&gt;from-&gt;nextcp.x*cv-&gt;scale + dx;</span>
<span class="lineNum">    1597 </span><span class="lineNoCov">          0 :                     cy1 = -cv-&gt;yoff + cv-&gt;height - spline-&gt;from-&gt;nextcp.y*cv-&gt;scale - dy;</span>
<span class="lineNum">    1598 </span><span class="lineNoCov">          0 :                     dx = rint(spline-&gt;to-&gt;me.x*cv-&gt;scale) - spline-&gt;to-&gt;me.x*cv-&gt;scale;</span>
<span class="lineNum">    1599 </span><span class="lineNoCov">          0 :                     dy = rint(spline-&gt;to-&gt;me.y*cv-&gt;scale) - spline-&gt;to-&gt;me.y*cv-&gt;scale;</span>
<span class="lineNum">    1600 </span><span class="lineNoCov">          0 :                     cx2 = cv-&gt;xoff + spline-&gt;to-&gt;prevcp.x*cv-&gt;scale + dx;</span>
<span class="lineNum">    1601 </span><span class="lineNoCov">          0 :                     cy2 = -cv-&gt;yoff + cv-&gt;height - spline-&gt;to-&gt;prevcp.y*cv-&gt;scale - dy;</span>
<span class="lineNum">    1602 </span><span class="lineNoCov">          0 :                     GDrawPathCurveTo(pixmap,cx1+.5,cy1+.5,cx2+.5,cy2+.5,x+.5,y+.5);</span>
<span class="lineNum">    1603 </span>            :                 }
<span class="lineNum">    1604 </span><span class="lineNoCov">          0 :                 if ( first==NULL )</span>
<span class="lineNum">    1605 </span><span class="lineNoCov">          0 :                     first = spline;</span>
<span class="lineNum">    1606 </span>            :             }
<span class="lineNum">    1607 </span><span class="lineNoCov">          0 :             if ( spline!=NULL )</span>
<span class="lineNum">    1608 </span><span class="lineNoCov">          0 :                 GDrawPathClose(pixmap);</span>
<span class="lineNum">    1609 </span>            : 
<span class="lineNum">    1610 </span><span class="lineNoCov">          0 :             switch( strokeFillMode ) {</span>
<span class="lineNum">    1611 </span>            :             case sfm_stroke_trans:
<span class="lineNum">    1612 </span><span class="lineNoCov">          0 :                 GDrawPathStroke( pixmap, fc );</span>
<span class="lineNum">    1613 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1614 </span>            :             case sfm_stroke:
<span class="lineNum">    1615 </span><span class="lineNoCov">          0 :                 GDrawPathStroke( pixmap, fc | 0xff000000 );</span>
<span class="lineNum">    1616 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1617 </span>            :             case sfm_clip_preserve:
<span class="lineNum">    1618 </span><span class="lineNoCov">          0 :                 GDrawClipPreserve( pixmap );</span>
<span class="lineNum">    1619 </span>            :             case sfm_fill:
<span class="lineNum">    1620 </span>            :             case sfm_nothing:
<span class="lineNum">    1621 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1622 </span>            :             }
<span class="lineNum">    1623 </span>            :         } else {
<span class="lineNum">    1624 </span><span class="lineNoCov">          0 :             GPointList *gpl = MakePoly(cv,spl), *cur;</span>
<span class="lineNum">    1625 </span><span class="lineNoCov">          0 :             for ( cur=gpl; cur!=NULL; cur=cur-&gt;next )</span>
<span class="lineNum">    1626 </span><span class="lineNoCov">          0 :                 GDrawDrawPoly(pixmap,cur-&gt;gp,cur-&gt;cnt,fc);</span>
<span class="lineNum">    1627 </span><span class="lineNoCov">          0 :             GPLFree(gpl);</span>
<span class="lineNum">    1628 </span>            :         }
<span class="lineNum">    1629 </span>            :     }
<span class="lineNum">    1630 </span>            : 
<span class="lineNum">    1631 </span><span class="lineNoCov">          0 :     Color c = fillcol;</span>
<span class="lineNum">    1632 </span><span class="lineNoCov">          0 :     switch( strokeFillMode ) {</span>
<span class="lineNum">    1633 </span>            :         case sfm_fill:
<span class="lineNum">    1634 </span><span class="lineNoCov">          0 :             if( cv-&gt;inPreviewMode ) {</span>
<span class="lineNum">    1635 </span><span class="lineNoCov">          0 :                 c = previewfillcol;</span>
<span class="lineNum">    1636 </span>            :             }
<span class="lineNum">    1637 </span><span class="lineNoCov">          0 :             GDrawPathFill( pixmap, c|0xff000000);</span>
<span class="lineNum">    1638 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1639 </span>            :         case sfm_stroke:
<span class="lineNum">    1640 </span>            :         case sfm_nothing:
<span class="lineNum">    1641 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1642 </span>            :     }
<span class="lineNum">    1643 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1644 </span>            : 
<a name="1645"><span class="lineNum">    1645 </span>            : </a>
<span class="lineNum">    1646 </span>            : 
<span class="lineNum">    1647 </span><span class="lineNoCov">          0 : void CVDrawSplineSetSpecialized( CharView *cv, GWindow pixmap, SplinePointList *set,</span>
<span class="lineNum">    1648 </span>            :                                  Color fg, int dopoints, DRect *clip,
<span class="lineNum">    1649 </span>            :                                  enum outlinesfm_flags strokeFillMode,
<span class="lineNum">    1650 </span>            :                                  Color AlphaChannelOverride )
<span class="lineNum">    1651 </span>            : {
<span class="lineNum">    1652 </span>            :     Spline *spline, *first;
<span class="lineNum">    1653 </span>            :     SplinePointList *spl;
<span class="lineNum">    1654 </span><span class="lineNoCov">          0 :     int truetype_markup = set==cv-&gt;b.gridfit &amp;&amp; cv-&gt;dv!=NULL;</span>
<span class="lineNum">    1655 </span>            : 
<span class="lineNum">    1656 </span><span class="lineNoCov">          0 :     if ( cv-&gt;inactive )</span>
<span class="lineNum">    1657 </span><span class="lineNoCov">          0 :         dopoints = false;</span>
<span class="lineNum">    1658 </span>            : 
<span class="lineNum">    1659 </span><span class="lineNoCov">          0 :     if( strokeFillMode == sfm_fill ) {</span>
<span class="lineNum">    1660 </span><span class="lineNoCov">          0 :         CVDrawSplineSetOutlineOnly( cv, pixmap, set,</span>
<span class="lineNum">    1661 </span>            :                                     fg, dopoints, clip, strokeFillMode );
<span class="lineNum">    1662 </span>            :     }
<span class="lineNum">    1663 </span>            : 
<span class="lineNum">    1664 </span><span class="lineNoCov">          0 :     GDrawSetFont(pixmap,cv-&gt;small);          /* For point numbers */</span>
<span class="lineNum">    1665 </span><span class="lineNoCov">          0 :     for ( spl = set; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">    1666 </span><span class="lineNoCov">          0 :         if ( spl-&gt;contour_name!=NULL )</span>
<span class="lineNum">    1667 </span><span class="lineNoCov">          0 :             CVDrawContourName(cv,pixmap,spl,fg);</span>
<span class="lineNum">    1668 </span><span class="lineNoCov">          0 :         if ( dopoints&gt;0 || (dopoints==-1 &amp;&amp; cv-&gt;showpointnumbers) ) {</span>
<span class="lineNum">    1669 </span><span class="lineNoCov">          0 :             first = NULL;</span>
<span class="lineNum">    1670 </span><span class="lineNoCov">          0 :             if ( dopoints&gt;0 )</span>
<span class="lineNum">    1671 </span><span class="lineNoCov">          0 :                 DrawDirection(cv,pixmap,spl-&gt;first);</span>
<span class="lineNum">    1672 </span><span class="lineNoCov">          0 :             if ( cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro()) {</span>
<span class="lineNum">    1673 </span><span class="lineNoCov">          0 :                 if ( dopoints&gt;=0 ) {</span>
<span class="lineNum">    1674 </span>            :                     int i;
<span class="lineNum">    1675 </span><span class="lineNoCov">          0 :                     if ( spl-&gt;spiros==NULL ) {</span>
<span class="lineNum">    1676 </span><span class="lineNoCov">          0 :                         spl-&gt;spiros = SplineSet2SpiroCP(spl,&amp;spl-&gt;spiro_cnt);</span>
<span class="lineNum">    1677 </span><span class="lineNoCov">          0 :                         spl-&gt;spiro_max = spl-&gt;spiro_cnt;</span>
<span class="lineNum">    1678 </span>            :                     }
<span class="lineNum">    1679 </span><span class="lineNoCov">          0 :                     for ( i=0; i&lt;spl-&gt;spiro_cnt-1; ++i )</span>
<span class="lineNum">    1680 </span><span class="lineNoCov">          0 :                         DrawSpiroPoint(cv,pixmap,&amp;spl-&gt;spiros[i],spl,i, AlphaChannelOverride );</span>
<span class="lineNum">    1681 </span>            :                 }
<span class="lineNum">    1682 </span>            :             } else {
<span class="lineNum">    1683 </span><span class="lineNoCov">          0 :                 for ( spline = spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1684 </span><span class="lineNoCov">          0 :                     DrawPoint(cv,pixmap,spline-&gt;from,spl,dopoints&lt;0,truetype_markup, AlphaChannelOverride );</span>
<span class="lineNum">    1685 </span><span class="lineNoCov">          0 :                     CVDrawPointName(cv,pixmap,spline-&gt;from,fg);</span>
<span class="lineNum">    1686 </span><span class="lineNoCov">          0 :                     if ( first==NULL ) first = spline;</span>
<span class="lineNum">    1687 </span>            :                 }
<span class="lineNum">    1688 </span><span class="lineNoCov">          0 :                 if ( spline==NULL ) {</span>
<span class="lineNum">    1689 </span><span class="lineNoCov">          0 :                     DrawPoint(cv,pixmap,spl-&gt;last,spl,dopoints&lt;0,truetype_markup, AlphaChannelOverride );</span>
<span class="lineNum">    1690 </span><span class="lineNoCov">          0 :                     CVDrawPointName(cv,pixmap,spl-&gt;last,fg);</span>
<span class="lineNum">    1691 </span>            :                 }
<span class="lineNum">    1692 </span>            :             }
<span class="lineNum">    1693 </span>            :         }
<span class="lineNum">    1694 </span>            :     }
<span class="lineNum">    1695 </span>            : 
<span class="lineNum">    1696 </span><span class="lineNoCov">          0 :     if( strokeFillMode != sfm_nothing ) {</span>
<span class="lineNum">    1697 </span>            : 
<span class="lineNum">    1698 </span>            :         /*
<span class="lineNum">    1699 </span>            :          * If we were filling, we have to stroke the outline again to properly show
<span class="lineNum">    1700 </span>            :          * clip path splines which will possibly have a different stroke color
<span class="lineNum">    1701 </span>            :          */
<span class="lineNum">    1702 </span><span class="lineNoCov">          0 :         Color thinfgcolor = fg;</span>
<span class="lineNum">    1703 </span><span class="lineNoCov">          0 :         enum outlinesfm_flags fgstrokeFillMode = sfm_stroke;</span>
<span class="lineNum">    1704 </span><span class="lineNoCov">          0 :         if( strokeFillMode==sfm_stroke_trans )</span>
<span class="lineNum">    1705 </span><span class="lineNoCov">          0 :             fgstrokeFillMode = sfm_stroke_trans;</span>
<span class="lineNum">    1706 </span><span class="lineNoCov">          0 :         if( shouldShowFilledUsingCairo(cv) ) {</span>
<span class="lineNum">    1707 </span><span class="lineNoCov">          0 :             if (cv-&gt;inPreviewMode)</span>
<span class="lineNum">    1708 </span><span class="lineNoCov">          0 :                 thinfgcolor = (thinfgcolor | 0x01000000) &amp; 0x01ffffff;</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">          0 :             fgstrokeFillMode = sfm_stroke_trans;</span>
<span class="lineNum">    1710 </span>            :         }
<span class="lineNum">    1711 </span><span class="lineNoCov">          0 :         CVDrawSplineSetOutlineOnly( cv, pixmap, set,</span>
<span class="lineNum">    1712 </span>            :                                     thinfgcolor, dopoints, clip,
<span class="lineNum">    1713 </span>            :                                     fgstrokeFillMode );
<span class="lineNum">    1714 </span>            : 
<span class="lineNum">    1715 </span><span class="lineNoCov">          0 :     if( prefs_cv_outline_thickness &gt; 1 )</span>
<span class="lineNum">    1716 </span>            :     {
<span class="lineNum">    1717 </span><span class="lineNoCov">          0 :         SplinePointList *spl = 0;</span>
<span class="lineNum">    1718 </span><span class="lineNoCov">          0 :         for ( spl = set; spl!=NULL; spl = spl-&gt;next )</span>
<span class="lineNum">    1719 </span>            :         {
<span class="lineNum">    1720 </span>            :             // we only draw the inner half, so we double the user's expected
<span class="lineNum">    1721 </span>            :             // thickness here.
<span class="lineNum">    1722 </span><span class="lineNoCov">          0 :             int strokeWidth = prefs_cv_outline_thickness * 2 * cv-&gt;scale;</span>
<span class="lineNum">    1723 </span><span class="lineNoCov">          0 :             Color strokefg = foreoutthicklinecol;</span>
<span class="lineNum">    1724 </span>            : 
<span class="lineNum">    1725 </span><span class="lineNoCov">          0 :             if( shouldShowFilledUsingCairo(cv) &amp;&amp; cv-&gt;inPreviewMode ) {</span>
<span class="lineNum">    1726 </span><span class="lineNoCov">          0 :                 strokefg = (strokefg | 0x01000000) &amp; 0x01ffffff;</span>
<span class="lineNum">    1727 </span>            :             }
<span class="lineNum">    1728 </span>            : 
<span class="lineNum">    1729 </span>            :             GRect old;
<span class="lineNum">    1730 </span><span class="lineNoCov">          0 :             GDrawPushClipOnly( pixmap );</span>
<span class="lineNum">    1731 </span><span class="lineNoCov">          0 :             CVDrawSplineSetOutlineOnly( cv, pixmap, spl,</span>
<span class="lineNum">    1732 </span>            :                                         strokefg, dopoints, clip,
<span class="lineNum">    1733 </span>            :                                         sfm_clip_preserve );
<span class="lineNum">    1734 </span><span class="lineNoCov">          0 :             int16 oldwidth = GDrawGetLineWidth( pixmap );</span>
<span class="lineNum">    1735 </span><span class="lineNoCov">          0 :             GDrawSetLineWidth( pixmap, strokeWidth );</span>
<span class="lineNum">    1736 </span><span class="lineNoCov">          0 :             CVDrawSplineSetOutlineOnly( cv, pixmap, spl,</span>
<span class="lineNum">    1737 </span>            :                                         strokefg, dopoints, clip,
<span class="lineNum">    1738 </span>            :                                         sfm_stroke_trans );
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 :             GDrawPopClip( pixmap, &amp;old );</span>
<span class="lineNum">    1740 </span><span class="lineNoCov">          0 :             GDrawSetLineWidth( pixmap, oldwidth );</span>
<span class="lineNum">    1741 </span>            :         }
<span class="lineNum">    1742 </span>            :     }
<span class="lineNum">    1743 </span>            :     
<span class="lineNum">    1744 </span>            :     
<span class="lineNum">    1745 </span>            :     }
<span class="lineNum">    1746 </span>            : 
<span class="lineNum">    1747 </span><span class="lineNoCov">          0 :     for ( spl = set; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">    1748 </span><span class="lineNoCov">          0 :         if (( cv-&gt;markextrema || cv-&gt;markpoi ) &amp;&amp; dopoints &amp;&amp; !cv-&gt;b.sc-&gt;inspiro )</span>
<span class="lineNum">    1749 </span><span class="lineNoCov">          0 :             CVMarkInterestingLocations(cv,pixmap,spl);</span>
<span class="lineNum">    1750 </span><span class="lineNoCov">          0 :         if ( (cv-&gt;showalmosthvlines || cv-&gt;showalmosthvcurves ) &amp;&amp; dopoints )</span>
<span class="lineNum">    1751 </span><span class="lineNoCov">          0 :             CVMarkAlmostHV(cv,pixmap,spl);</span>
<span class="lineNum">    1752 </span>            :     }
<a name="1753"><span class="lineNum">    1753 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1754 </span>            : 
<span class="lineNum">    1755 </span><span class="lineNoCov">          0 : static void CVDrawLayerSplineSet(CharView *cv, GWindow pixmap, Layer *layer,</span>
<span class="lineNum">    1756 </span>            :         Color fg, int dopoints, DRect *clip, enum outlinesfm_flags strokeFillMode ) {
<span class="lineNum">    1757 </span><span class="lineNoCov">          0 :     int active = cv-&gt;b.layerheads[cv-&gt;b.drawmode]==layer;</span>
<span class="lineNum">    1758 </span><span class="lineNoCov">          0 :     int ml = cv-&gt;b.sc-&gt;parent-&gt;multilayer;</span>
<span class="lineNum">    1759 </span>            : 
<span class="lineNum">    1760 </span><span class="lineNoCov">          0 :     if ( ml &amp;&amp; layer-&gt;dostroke ) {</span>
<span class="lineNum">    1761 </span><span class="lineNoCov">          0 :         if ( layer-&gt;stroke_pen.brush.col!=COLOR_INHERITED &amp;&amp;</span>
<span class="lineNum">    1762 </span><span class="lineNoCov">          0 :                 layer-&gt;stroke_pen.brush.col!=view_bgcol )</span>
<span class="lineNum">    1763 </span><span class="lineNoCov">          0 :             fg = layer-&gt;stroke_pen.brush.col;</span>
<span class="lineNum">    1764 </span>            :     }
<span class="lineNum">    1765 </span><span class="lineNoCov">          0 :     if ( ml &amp;&amp; layer-&gt;dofill ) {</span>
<span class="lineNum">    1766 </span><span class="lineNoCov">          0 :         if ( layer-&gt;fill_brush.col!=COLOR_INHERITED &amp;&amp;</span>
<span class="lineNum">    1767 </span><span class="lineNoCov">          0 :                 layer-&gt;fill_brush.col!=view_bgcol )</span>
<span class="lineNum">    1768 </span><span class="lineNoCov">          0 :             fg = layer-&gt;fill_brush.col;</span>
<span class="lineNum">    1769 </span>            :     }
<span class="lineNum">    1770 </span>            : 
<span class="lineNum">    1771 </span><span class="lineNoCov">          0 :     if ( ml &amp;&amp; !active &amp;&amp; layer!=&amp;cv-&gt;b.sc-&gt;layers[ly_back] )</span>
<span class="lineNum">    1772 </span><span class="lineNoCov">          0 :         GDrawSetDashedLine(pixmap,5,5,cv-&gt;xoff+cv-&gt;height-cv-&gt;yoff);</span>
<span class="lineNum">    1773 </span>            :     
<span class="lineNum">    1774 </span><span class="lineNoCov">          0 :     CVDrawSplineSetSpecialized( cv, pixmap, layer-&gt;splines,</span>
<span class="lineNum">    1775 </span>            :                                 fg, dopoints &amp;&amp; active, clip,
<span class="lineNum">    1776 </span>            :                                 strokeFillMode, 0 );
<span class="lineNum">    1777 </span>            :     
<span class="lineNum">    1778 </span><span class="lineNoCov">          0 :     if ( ml &amp;&amp; !active &amp;&amp; layer!=&amp;cv-&gt;b.sc-&gt;layers[ly_back] )</span>
<span class="lineNum">    1779 </span><span class="lineNoCov">          0 :         GDrawSetDashedLine(pixmap,0,0,0);</span>
<a name="1780"><span class="lineNum">    1780 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1781 </span>            : 
<span class="lineNum">    1782 </span><span class="lineNoCov">          0 : static void CVDrawTemplates(CharView *cv,GWindow pixmap,SplineChar *template,DRect *clip) {</span>
<span class="lineNum">    1783 </span>            :     RefChar *r;
<span class="lineNum">    1784 </span>            : 
<span class="lineNum">    1785 </span><span class="lineNoCov">          0 :     CVDrawSplineSet(cv,pixmap,template-&gt;layers[ly_fore].splines,templateoutlinecol,false,clip);</span>
<span class="lineNum">    1786 </span><span class="lineNoCov">          0 :     for ( r=template-&gt;layers[ly_fore].refs; r!=NULL; r=r-&gt;next )</span>
<span class="lineNum">    1787 </span><span class="lineNoCov">          0 :         CVDrawSplineSet(cv,pixmap,r-&gt;layers[0].splines,templateoutlinecol,false,clip);</span>
<a name="1788"><span class="lineNum">    1788 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1789 </span>            : 
<span class="lineNum">    1790 </span><span class="lineNoCov">          0 : static void CVShowDHintInstance(CharView *cv, GWindow pixmap, BasePoint *bp) {</span>
<span class="lineNum">    1791 </span>            :     IPoint ip[40], ip2[40];
<span class="lineNum">    1792 </span>            :     GPoint clipped[13];
<span class="lineNum">    1793 </span>            :     int i,j, tot,last;
<span class="lineNum">    1794 </span>            : 
<span class="lineNum">    1795 </span><span class="lineNoCov">          0 :     ip[0].x = cv-&gt;xoff + rint( bp[0].x*cv-&gt;scale );</span>
<span class="lineNum">    1796 </span><span class="lineNoCov">          0 :     ip[0].y = -cv-&gt;yoff + cv-&gt;height - rint( bp[0].y*cv-&gt;scale );</span>
<span class="lineNum">    1797 </span><span class="lineNoCov">          0 :     ip[1].x = cv-&gt;xoff + rint(bp[1].x*cv-&gt;scale);</span>
<span class="lineNum">    1798 </span><span class="lineNoCov">          0 :     ip[1].y = -cv-&gt;yoff + cv-&gt;height - rint( bp[1].y*cv-&gt;scale );</span>
<span class="lineNum">    1799 </span><span class="lineNoCov">          0 :     ip[2].x = cv-&gt;xoff + rint( bp[2].x*cv-&gt;scale );</span>
<span class="lineNum">    1800 </span><span class="lineNoCov">          0 :     ip[2].y = -cv-&gt;yoff + cv-&gt;height - rint( bp[2].y*cv-&gt;scale );</span>
<span class="lineNum">    1801 </span><span class="lineNoCov">          0 :     ip[3].x = cv-&gt;xoff + rint( bp[3].x*cv-&gt;scale );</span>
<span class="lineNum">    1802 </span><span class="lineNoCov">          0 :     ip[3].y = -cv-&gt;yoff + cv-&gt;height - rint( bp[3].y*cv-&gt;scale );</span>
<span class="lineNum">    1803 </span>            : 
<span class="lineNum">    1804 </span><span class="lineNoCov">          0 :     if (( ip[0].x&lt;0 &amp;&amp; ip[1].x&lt;0 &amp;&amp; ip[2].x&lt;0 &amp;&amp; ip[3].x&lt;0 ) ||</span>
<span class="lineNum">    1805 </span><span class="lineNoCov">          0 :             ( ip[0].x&gt;=cv-&gt;width &amp;&amp; ip[1].x&gt;=cv-&gt;width &amp;&amp; ip[2].x&gt;=cv-&gt;width &amp;&amp; ip[3].x&gt;=cv-&gt;width ) ||</span>
<span class="lineNum">    1806 </span><span class="lineNoCov">          0 :             ( ip[0].y&lt;0 &amp;&amp; ip[1].y&lt;0 &amp;&amp; ip[2].y&lt;0 &amp;&amp; ip[3].y&lt;0 ) ||</span>
<span class="lineNum">    1807 </span><span class="lineNoCov">          0 :             ( ip[0].y&gt;=cv-&gt;height &amp;&amp; ip[1].y&gt;=cv-&gt;height &amp;&amp; ip[2].y&gt;=cv-&gt;height &amp;&amp; ip[3].y&gt;=cv-&gt;height ))</span>
<span class="lineNum">    1808 </span><span class="lineNoCov">          0 : return;         /* Offscreen */</span>
<span class="lineNum">    1809 </span>            : 
<span class="lineNum">    1810 </span>            :     /* clip to left edge */
<span class="lineNum">    1811 </span><span class="lineNoCov">          0 :     tot = 4;</span>
<span class="lineNum">    1812 </span><span class="lineNoCov">          0 :     for ( i=j=0; i&lt;tot; ++i ) {</span>
<span class="lineNum">    1813 </span><span class="lineNoCov">          0 :         last = i==0?tot-1:i-1;</span>
<span class="lineNum">    1814 </span><span class="lineNoCov">          0 :         if ( ip[i].x&gt;=0 &amp;&amp; ip[last].x&gt;=0) {</span>
<span class="lineNum">    1815 </span><span class="lineNoCov">          0 :             ip2[j++] = ip[i];</span>
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 :         } else if ( ip[i].x&lt;0 &amp;&amp; ip[last].x&lt;0 ) {</span>
<span class="lineNum">    1817 </span><span class="lineNoCov">          0 :             if ( j==0 || ip2[j-1].x!=0 || ip2[j-1].y!=ip[i].y ) {</span>
<span class="lineNum">    1818 </span><span class="lineNoCov">          0 :                 ip2[j].x = 0;</span>
<span class="lineNum">    1819 </span><span class="lineNoCov">          0 :                 ip2[j++].y = ip[i].y;</span>
<span class="lineNum">    1820 </span>            :             }
<span class="lineNum">    1821 </span>            :         } else {
<span class="lineNum">    1822 </span><span class="lineNoCov">          0 :             ip2[j].x = 0;</span>
<span class="lineNum">    1823 </span><span class="lineNoCov">          0 :             ip2[j++].y = ip[last].y - ip[last].x * ((real) (ip[i].y-ip[last].y))/(ip[i].x-ip[last].x);</span>
<span class="lineNum">    1824 </span><span class="lineNoCov">          0 :             if ( ip[i].x&gt;0 )</span>
<span class="lineNum">    1825 </span><span class="lineNoCov">          0 :                 ip2[j++] = ip[i];</span>
<span class="lineNum">    1826 </span>            :             else {
<span class="lineNum">    1827 </span><span class="lineNoCov">          0 :                 ip2[j].x = 0;</span>
<span class="lineNum">    1828 </span><span class="lineNoCov">          0 :                 ip2[j++].y = ip[i].y;</span>
<span class="lineNum">    1829 </span>            :             }
<span class="lineNum">    1830 </span>            :         }
<span class="lineNum">    1831 </span>            :     }
<span class="lineNum">    1832 </span>            :     /* clip to right edge */
<span class="lineNum">    1833 </span><span class="lineNoCov">          0 :     tot = j;</span>
<span class="lineNum">    1834 </span><span class="lineNoCov">          0 :     for ( i=j=0; i&lt;tot; ++i ) {</span>
<span class="lineNum">    1835 </span><span class="lineNoCov">          0 :         last = i==0?tot-1:i-1;</span>
<span class="lineNum">    1836 </span><span class="lineNoCov">          0 :         if ( ip2[i].x&lt;cv-&gt;width &amp;&amp; ip2[last].x&lt;cv-&gt;width ) {</span>
<span class="lineNum">    1837 </span><span class="lineNoCov">          0 :             ip[j++] = ip2[i];</span>
<span class="lineNum">    1838 </span><span class="lineNoCov">          0 :         } else if ( ip2[i].x&gt;=cv-&gt;width &amp;&amp; ip2[last].x&gt;=cv-&gt;width ) {</span>
<span class="lineNum">    1839 </span><span class="lineNoCov">          0 :             if ( j==0 || ip[j-1].x!=cv-&gt;width-1 || ip[j-1].y!=ip2[i].y ) {</span>
<span class="lineNum">    1840 </span><span class="lineNoCov">          0 :                 ip[j].x = cv-&gt;width-1;</span>
<span class="lineNum">    1841 </span><span class="lineNoCov">          0 :                 ip[j++].y = ip2[i].y;</span>
<span class="lineNum">    1842 </span>            :             }
<span class="lineNum">    1843 </span>            :         } else {
<span class="lineNum">    1844 </span><span class="lineNoCov">          0 :             ip[j].x = cv-&gt;width-1;</span>
<span class="lineNum">    1845 </span><span class="lineNoCov">          0 :             ip[j++].y = ip2[last].y + (cv-&gt;width-1- ip2[last].x) * ((real) (ip2[i].y-ip2[last].y))/(ip2[i].x-ip2[last].x);</span>
<span class="lineNum">    1846 </span><span class="lineNoCov">          0 :             if ( ip2[i].x&lt;cv-&gt;width )</span>
<span class="lineNum">    1847 </span><span class="lineNoCov">          0 :                 ip[j++] = ip2[i];</span>
<span class="lineNum">    1848 </span>            :             else {
<span class="lineNum">    1849 </span><span class="lineNoCov">          0 :                 ip[j].x = cv-&gt;width-1;</span>
<span class="lineNum">    1850 </span><span class="lineNoCov">          0 :                 ip[j++].y = ip2[i].y;</span>
<span class="lineNum">    1851 </span>            :             }
<span class="lineNum">    1852 </span>            :         }
<span class="lineNum">    1853 </span>            :     }
<span class="lineNum">    1854 </span>            :     /* clip to bottom edge */
<span class="lineNum">    1855 </span><span class="lineNoCov">          0 :     tot = j;</span>
<span class="lineNum">    1856 </span><span class="lineNoCov">          0 :     for ( i=j=0; i&lt;tot; ++i ) {</span>
<span class="lineNum">    1857 </span><span class="lineNoCov">          0 :         last = i==0?tot-1:i-1;</span>
<span class="lineNum">    1858 </span><span class="lineNoCov">          0 :         if ( ip[i].y&gt;=0 &amp;&amp; ip[last].y&gt;=0) {</span>
<span class="lineNum">    1859 </span><span class="lineNoCov">          0 :             ip2[j++] = ip[i];</span>
<span class="lineNum">    1860 </span><span class="lineNoCov">          0 :         } else if ( ip[i].y&lt;0 &amp;&amp; ip[last].y&lt;0 ) {</span>
<span class="lineNum">    1861 </span><span class="lineNoCov">          0 :             ip2[j].y = 0;</span>
<span class="lineNum">    1862 </span><span class="lineNoCov">          0 :             ip2[j++].x = ip[i].x;</span>
<span class="lineNum">    1863 </span>            :         } else {
<span class="lineNum">    1864 </span><span class="lineNoCov">          0 :             ip2[j].y = 0;</span>
<span class="lineNum">    1865 </span><span class="lineNoCov">          0 :             ip2[j++].x = ip[last].x - ip[last].y * ((real) (ip[i].x-ip[last].x))/(ip[i].y-ip[last].y);</span>
<span class="lineNum">    1866 </span><span class="lineNoCov">          0 :             if ( ip[i].y&gt;0 )</span>
<span class="lineNum">    1867 </span><span class="lineNoCov">          0 :                 ip2[j++] = ip[i];</span>
<span class="lineNum">    1868 </span>            :             else {
<span class="lineNum">    1869 </span><span class="lineNoCov">          0 :                 ip2[j].y = 0;</span>
<span class="lineNum">    1870 </span><span class="lineNoCov">          0 :                 ip2[j++].x = ip[i].x;</span>
<span class="lineNum">    1871 </span>            :             }
<span class="lineNum">    1872 </span>            :         }
<span class="lineNum">    1873 </span>            :     }
<span class="lineNum">    1874 </span>            :     /* clip to top edge */
<span class="lineNum">    1875 </span><span class="lineNoCov">          0 :     tot = j;</span>
<span class="lineNum">    1876 </span><span class="lineNoCov">          0 :     for ( i=j=0; i&lt;tot; ++i ) {</span>
<span class="lineNum">    1877 </span><span class="lineNoCov">          0 :         last = i==0?tot-1:i-1;</span>
<span class="lineNum">    1878 </span><span class="lineNoCov">          0 :         if ( ip2[i].y&lt;cv-&gt;height &amp;&amp; ip2[last].y&lt;cv-&gt;height ) {</span>
<span class="lineNum">    1879 </span><span class="lineNoCov">          0 :             ip[j++] = ip2[i];</span>
<span class="lineNum">    1880 </span><span class="lineNoCov">          0 :         } else if ( ip2[i].y&gt;=cv-&gt;height &amp;&amp; ip2[last].y&gt;=cv-&gt;height ) {</span>
<span class="lineNum">    1881 </span><span class="lineNoCov">          0 :             ip[j].y = cv-&gt;height-1;</span>
<span class="lineNum">    1882 </span><span class="lineNoCov">          0 :             ip[j++].x = ip2[i].x;</span>
<span class="lineNum">    1883 </span>            :         } else {
<span class="lineNum">    1884 </span><span class="lineNoCov">          0 :             ip[j].y = cv-&gt;height-1;</span>
<span class="lineNum">    1885 </span><span class="lineNoCov">          0 :             ip[j++].x = ip2[last].x + (cv-&gt;height-1- ip2[last].y) * ((real) (ip2[i].x-ip2[last].x))/(ip2[i].y-ip2[last].y);</span>
<span class="lineNum">    1886 </span><span class="lineNoCov">          0 :             if ( ip2[i].y&lt;cv-&gt;height )</span>
<span class="lineNum">    1887 </span><span class="lineNoCov">          0 :                 ip[j++] = ip2[i];</span>
<span class="lineNum">    1888 </span>            :             else {
<span class="lineNum">    1889 </span><span class="lineNoCov">          0 :                 ip[j].y = cv-&gt;height-1;</span>
<span class="lineNum">    1890 </span><span class="lineNoCov">          0 :                 ip[j++].x = ip2[i].x;</span>
<span class="lineNum">    1891 </span>            :             }
<span class="lineNum">    1892 </span>            :         }
<span class="lineNum">    1893 </span>            :     }
<span class="lineNum">    1894 </span>            : 
<span class="lineNum">    1895 </span><span class="lineNoCov">          0 :     tot=j;</span>
<span class="lineNum">    1896 </span><span class="lineNoCov">          0 :     clipped[0].x = ip[0].x; clipped[0].y = ip[0].y;</span>
<span class="lineNum">    1897 </span><span class="lineNoCov">          0 :     for ( i=j=1; i&lt;tot; ++i ) {</span>
<span class="lineNum">    1898 </span><span class="lineNoCov">          0 :         if ( ip[i].x!=ip[i-1].x || ip[i].y!=ip[i-1].y ) {</span>
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :             clipped[j].x = ip[i].x; clipped[j++].y = ip[i].y;</span>
<span class="lineNum">    1900 </span>            :         }
<span class="lineNum">    1901 </span>            :     }
<span class="lineNum">    1902 </span><span class="lineNoCov">          0 :     clipped[j++] = clipped[0];</span>
<span class="lineNum">    1903 </span><span class="lineNoCov">          0 :     GDrawFillPoly(pixmap,clipped,j,dhintcol);</span>
<a name="1904"><span class="lineNum">    1904 </span>            : }</a>
<span class="lineNum">    1905 </span>            : 
<span class="lineNum">    1906 </span><span class="lineNoCov">          0 : static void CVShowDHint ( CharView *cv, GWindow pixmap, DStemInfo *dstem ) {</span>
<span class="lineNum">    1907 </span>            :     BasePoint bp[4];
<span class="lineNum">    1908 </span>            :     HintInstance *hi;
<span class="lineNum">    1909 </span>            :     double roff;
<span class="lineNum">    1910 </span>            : 
<span class="lineNum">    1911 </span><span class="lineNoCov">          0 :     roff =  ( dstem-&gt;right.x - dstem-&gt;left.x ) * dstem-&gt;unit.x +</span>
<span class="lineNum">    1912 </span><span class="lineNoCov">          0 :             ( dstem-&gt;right.y - dstem-&gt;left.y ) * dstem-&gt;unit.y;</span>
<span class="lineNum">    1913 </span>            : 
<span class="lineNum">    1914 </span><span class="lineNoCov">          0 :     for ( hi=dstem-&gt;where; hi!=NULL; hi=hi-&gt;next ) {</span>
<span class="lineNum">    1915 </span><span class="lineNoCov">          0 :         bp[0].x = dstem-&gt;left.x + dstem-&gt;unit.x * hi-&gt;begin;</span>
<span class="lineNum">    1916 </span><span class="lineNoCov">          0 :         bp[0].y = dstem-&gt;left.y + dstem-&gt;unit.y * hi-&gt;begin;</span>
<span class="lineNum">    1917 </span><span class="lineNoCov">          0 :         bp[1].x = dstem-&gt;right.x + dstem-&gt;unit.x * ( hi-&gt;begin - roff );</span>
<span class="lineNum">    1918 </span><span class="lineNoCov">          0 :         bp[1].y = dstem-&gt;right.y + dstem-&gt;unit.y * ( hi-&gt;begin - roff );</span>
<span class="lineNum">    1919 </span><span class="lineNoCov">          0 :         bp[2].x = dstem-&gt;right.x + dstem-&gt;unit.x * ( hi-&gt;end - roff );</span>
<span class="lineNum">    1920 </span><span class="lineNoCov">          0 :         bp[2].y = dstem-&gt;right.y + dstem-&gt;unit.y * ( hi-&gt;end - roff );</span>
<span class="lineNum">    1921 </span><span class="lineNoCov">          0 :         bp[3].x = dstem-&gt;left.x + dstem-&gt;unit.x * hi-&gt;end;</span>
<span class="lineNum">    1922 </span><span class="lineNoCov">          0 :         bp[3].y = dstem-&gt;left.y + dstem-&gt;unit.y * hi-&gt;end;</span>
<span class="lineNum">    1923 </span><span class="lineNoCov">          0 :         CVShowDHintInstance( cv, pixmap, bp );</span>
<span class="lineNum">    1924 </span>            :     }
<a name="1925"><span class="lineNum">    1925 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1926 </span>            : 
<span class="lineNum">    1927 </span><span class="lineNoCov">          0 : static void CVShowMinimumDistance(CharView *cv, GWindow pixmap,MinimumDistance *md) {</span>
<span class="lineNum">    1928 </span>            :     int x1,y1, x2,y2;
<span class="lineNum">    1929 </span>            :     int xa, ya;
<span class="lineNum">    1930 </span><span class="lineNoCov">          0 :     int off = cv-&gt;xoff+cv-&gt;height-cv-&gt;yoff;</span>
<span class="lineNum">    1931 </span>            : 
<span class="lineNum">    1932 </span><span class="lineNoCov">          0 :     if (( md-&gt;x &amp;&amp; !cv-&gt;showmdx ) || (!md-&gt;x &amp;&amp; !cv-&gt;showmdy))</span>
<span class="lineNum">    1933 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1934 </span><span class="lineNoCov">          0 :     if ( md-&gt;sp1==NULL &amp;&amp; md-&gt;sp2==NULL )</span>
<span class="lineNum">    1935 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1936 </span><span class="lineNoCov">          0 :     if ( md-&gt;sp1!=NULL ) {</span>
<span class="lineNum">    1937 </span><span class="lineNoCov">          0 :         x1 = cv-&gt;xoff + rint( md-&gt;sp1-&gt;me.x*cv-&gt;scale );</span>
<span class="lineNum">    1938 </span><span class="lineNoCov">          0 :         y1 = -cv-&gt;yoff + cv-&gt;height - rint(md-&gt;sp1-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    1939 </span>            :     } else {
<span class="lineNum">    1940 </span><span class="lineNoCov">          0 :         x1 = cv-&gt;xoff + rint( cv-&gt;b.sc-&gt;width*cv-&gt;scale );</span>
<span class="lineNum">    1941 </span><span class="lineNoCov">          0 :         y1 = 0x80000000;</span>
<span class="lineNum">    1942 </span>            :     }
<span class="lineNum">    1943 </span><span class="lineNoCov">          0 :     if ( md-&gt;sp2!=NULL ) {</span>
<span class="lineNum">    1944 </span><span class="lineNoCov">          0 :         x2 = cv-&gt;xoff + rint( md-&gt;sp2-&gt;me.x*cv-&gt;scale );</span>
<span class="lineNum">    1945 </span><span class="lineNoCov">          0 :         y2 = -cv-&gt;yoff + cv-&gt;height - rint(md-&gt;sp2-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    1946 </span>            :     } else {
<span class="lineNum">    1947 </span><span class="lineNoCov">          0 :         x2 = cv-&gt;xoff + rint( cv-&gt;b.sc-&gt;width*cv-&gt;scale );</span>
<span class="lineNum">    1948 </span><span class="lineNoCov">          0 :         y2 = y1-8;</span>
<span class="lineNum">    1949 </span>            :     }
<span class="lineNum">    1950 </span><span class="lineNoCov">          0 :     if ( y1==0x80000000 )</span>
<span class="lineNum">    1951 </span><span class="lineNoCov">          0 :         y1 = y2-8;</span>
<span class="lineNum">    1952 </span><span class="lineNoCov">          0 :     if ( md-&gt;x ) {</span>
<span class="lineNum">    1953 </span><span class="lineNoCov">          0 :         ya = (y1+y2)/2;</span>
<span class="lineNum">    1954 </span><span class="lineNoCov">          0 :         GDrawDrawArrow(pixmap, x1,ya, x2,ya, 2, mdhintcol);</span>
<span class="lineNum">    1955 </span><span class="lineNoCov">          0 :         GDrawSetDashedLine(pixmap,5,5,off);</span>
<span class="lineNum">    1956 </span><span class="lineNoCov">          0 :         GDrawDrawLine(pixmap, x1,ya, x1,y1, mdhintcol);</span>
<span class="lineNum">    1957 </span><span class="lineNoCov">          0 :         GDrawDrawLine(pixmap, x2,ya, x2,y2, mdhintcol);</span>
<span class="lineNum">    1958 </span>            :     } else {
<span class="lineNum">    1959 </span><span class="lineNoCov">          0 :         xa = (x1+x2)/2;</span>
<span class="lineNum">    1960 </span><span class="lineNoCov">          0 :         GDrawDrawArrow(pixmap, xa,y1, xa,y2, 2, mdhintcol);</span>
<span class="lineNum">    1961 </span><span class="lineNoCov">          0 :         GDrawSetDashedLine(pixmap,5,5,off);</span>
<span class="lineNum">    1962 </span><span class="lineNoCov">          0 :         GDrawDrawLine(pixmap, xa,y1, x1,y1, mdhintcol);</span>
<span class="lineNum">    1963 </span><span class="lineNoCov">          0 :         GDrawDrawLine(pixmap, xa,y2, x2,y2, mdhintcol);</span>
<span class="lineNum">    1964 </span>            :     }
<span class="lineNum">    1965 </span><span class="lineNoCov">          0 :     GDrawSetDashedLine(pixmap,0,0,0);</span>
<a name="1966"><span class="lineNum">    1966 </span>            : }</a>
<span class="lineNum">    1967 </span>            : 
<span class="lineNum">    1968 </span><span class="lineNoCov">          0 : static void dtos(char *buf,real val) {</span>
<span class="lineNum">    1969 </span>            :     char *pt;
<span class="lineNum">    1970 </span>            : 
<span class="lineNum">    1971 </span><span class="lineNoCov">          0 :     sprintf( buf,&quot;%.1f&quot;, (double) val);</span>
<span class="lineNum">    1972 </span><span class="lineNoCov">          0 :     pt = buf+strlen(buf);</span>
<span class="lineNum">    1973 </span><span class="lineNoCov">          0 :     if ( pt[-1]=='0' &amp;&amp; pt[-2]=='.' ) pt[-2] = '\0';</span>
<a name="1974"><span class="lineNum">    1974 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1975 </span>            : 
<span class="lineNum">    1976 </span><span class="lineNoCov">          0 : static void CVDrawBlues(CharView *cv,GWindow pixmap,char *bluevals,char *others,</span>
<span class="lineNum">    1977 </span>            :         Color col) {
<span class="lineNum">    1978 </span>            :     double blues[24];
<span class="lineNum">    1979 </span>            :     char *pt, *end;
<span class="lineNum">    1980 </span><span class="lineNoCov">          0 :     int i=0, bcnt=0;</span>
<span class="lineNum">    1981 </span>            :     GRect r;
<span class="lineNum">    1982 </span>            :     char buf[20];
<span class="lineNum">    1983 </span>            :     int len,len2;
<span class="lineNum">    1984 </span>            : 
<span class="lineNum">    1985 </span><span class="lineNoCov">          0 :     if ( bluevals!=NULL ) {</span>
<span class="lineNum">    1986 </span><span class="lineNoCov">          0 :         for ( pt = bluevals; isspace( *pt ) || *pt=='['; ++pt);</span>
<span class="lineNum">    1987 </span><span class="lineNoCov">          0 :         while ( i&lt;14 &amp;&amp; *pt!='\0' &amp;&amp; *pt!=']' ) {</span>
<span class="lineNum">    1988 </span><span class="lineNoCov">          0 :             blues[i] = c_strtod(pt,&amp;end);</span>
<span class="lineNum">    1989 </span><span class="lineNoCov">          0 :             if ( pt==end )</span>
<span class="lineNum">    1990 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1991 </span><span class="lineNoCov">          0 :             ++i;</span>
<span class="lineNum">    1992 </span><span class="lineNoCov">          0 :             pt = end;</span>
<span class="lineNum">    1993 </span><span class="lineNoCov">          0 :             while ( isspace( *pt )) ++pt;</span>
<span class="lineNum">    1994 </span>            :         }
<span class="lineNum">    1995 </span><span class="lineNoCov">          0 :         if ( i&amp;1 ) --i;</span>
<span class="lineNum">    1996 </span>            :     }
<span class="lineNum">    1997 </span><span class="lineNoCov">          0 :     if ( others!=NULL ) {</span>
<span class="lineNum">    1998 </span><span class="lineNoCov">          0 :         for ( pt = others; isspace( *pt ) || *pt=='['; ++pt);</span>
<span class="lineNum">    1999 </span><span class="lineNoCov">          0 :         while ( i&lt;24 &amp;&amp; *pt!='\0' &amp;&amp; *pt!=']' ) {</span>
<span class="lineNum">    2000 </span><span class="lineNoCov">          0 :             blues[i] = c_strtod(pt,&amp;end);</span>
<span class="lineNum">    2001 </span><span class="lineNoCov">          0 :             if ( pt==end )</span>
<span class="lineNum">    2002 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2003 </span><span class="lineNoCov">          0 :             ++i;</span>
<span class="lineNum">    2004 </span><span class="lineNoCov">          0 :             pt = end;</span>
<span class="lineNum">    2005 </span><span class="lineNoCov">          0 :             while ( isspace( *pt )) ++pt;</span>
<span class="lineNum">    2006 </span>            :         }
<span class="lineNum">    2007 </span><span class="lineNoCov">          0 :         if ( i&amp;1 ) --i;</span>
<span class="lineNum">    2008 </span>            :     }
<span class="lineNum">    2009 </span><span class="lineNoCov">          0 :     bcnt = i;</span>
<span class="lineNum">    2010 </span><span class="lineNoCov">          0 :     if ( i==0 )</span>
<span class="lineNum">    2011 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2012 </span>            : 
<span class="lineNum">    2013 </span><span class="lineNoCov">          0 :     r.x = 0; r.width = cv-&gt;width;</span>
<span class="lineNum">    2014 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;bcnt; i += 2 ) {</span>
<span class="lineNum">    2015 </span>            :         int first, other;
<span class="lineNum">    2016 </span><span class="lineNoCov">          0 :         first = -cv-&gt;yoff + cv-&gt;height - rint(blues[i]*cv-&gt;scale);</span>
<span class="lineNum">    2017 </span><span class="lineNoCov">          0 :         other = -cv-&gt;yoff + cv-&gt;height - rint(blues[i+1]*cv-&gt;scale);</span>
<span class="lineNum">    2018 </span><span class="lineNoCov">          0 :         r.y = first;</span>
<span class="lineNum">    2019 </span><span class="lineNoCov">          0 :         if ( ( r.y&lt;0 &amp;&amp; other&lt;0 ) || (r.y&gt;cv-&gt;height &amp;&amp; other&gt;cv-&gt;height))</span>
<span class="lineNum">    2020 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    2021 </span><span class="lineNoCov">          0 :         if ( r.y&lt;0 ) r.y = 0;</span>
<span class="lineNum">    2022 </span><span class="lineNoCov">          0 :         else if ( r.y&gt;cv-&gt;height ) r.y = cv-&gt;height;</span>
<span class="lineNum">    2023 </span><span class="lineNoCov">          0 :         if ( other&lt;0 ) other = 0;</span>
<span class="lineNum">    2024 </span><span class="lineNoCov">          0 :         else if ( other&gt;cv-&gt;height ) other = cv-&gt;height;</span>
<span class="lineNum">    2025 </span><span class="lineNoCov">          0 :         if ( other&lt;r.y ) {</span>
<span class="lineNum">    2026 </span><span class="lineNoCov">          0 :             r.height = r.y-other;</span>
<span class="lineNum">    2027 </span><span class="lineNoCov">          0 :             r.y = other;</span>
<span class="lineNum">    2028 </span>            :         } else
<span class="lineNum">    2029 </span><span class="lineNoCov">          0 :             r.height = other-r.y;</span>
<span class="lineNum">    2030 </span><span class="lineNoCov">          0 :         if ( r.height==0 ) r.height = 1;        /* show something */</span>
<span class="lineNum">    2031 </span><span class="lineNoCov">          0 :         GDrawSetStippled(pixmap,2, 0,0);</span>
<span class="lineNum">    2032 </span><span class="lineNoCov">          0 :         GDrawFillRect(pixmap,&amp;r,col);</span>
<span class="lineNum">    2033 </span><span class="lineNoCov">          0 :         GDrawSetStippled(pixmap,0, 0,0);</span>
<span class="lineNum">    2034 </span>            : 
<span class="lineNum">    2035 </span><span class="lineNoCov">          0 :         if ( first&gt;-20 &amp;&amp; first&lt;cv-&gt;height+20 ) {</span>
<span class="lineNum">    2036 </span><span class="lineNoCov">          0 :             dtos( buf, blues[i]);</span>
<span class="lineNum">    2037 </span><span class="lineNoCov">          0 :             len = GDrawGetText8Width(pixmap,buf,-1);</span>
<span class="lineNum">    2038 </span><span class="lineNoCov">          0 :             GDrawDrawText8(pixmap,cv-&gt;width-len-5,first-3,buf,-1,hintlabelcol);</span>
<span class="lineNum">    2039 </span>            :         } else
<span class="lineNum">    2040 </span><span class="lineNoCov">          0 :             len = 0;</span>
<span class="lineNum">    2041 </span><span class="lineNoCov">          0 :         if ( other&gt;-20 &amp;&amp; other&lt;cv-&gt;height+20 ) {</span>
<span class="lineNum">    2042 </span><span class="lineNoCov">          0 :             dtos( buf, blues[i+1]-blues[i]);</span>
<span class="lineNum">    2043 </span><span class="lineNoCov">          0 :             len2 = GDrawGetText8Width(pixmap,buf,-1);</span>
<span class="lineNum">    2044 </span><span class="lineNoCov">          0 :             GDrawDrawText8(pixmap,cv-&gt;width-len-5-len2-5,other+cv-&gt;sas-3,buf,-1,hintlabelcol);</span>
<span class="lineNum">    2045 </span>            :         }
<span class="lineNum">    2046 </span>            :     }
<a name="2047"><span class="lineNum">    2047 </span>            : }</a>
<span class="lineNum">    2048 </span>            : 
<span class="lineNum">    2049 </span><span class="lineNoCov">          0 : static void CVShowHints(CharView *cv, GWindow pixmap) {</span>
<span class="lineNum">    2050 </span>            :     StemInfo *hint;
<span class="lineNum">    2051 </span>            :     GRect r;
<span class="lineNum">    2052 </span>            :     HintInstance *hi;
<span class="lineNum">    2053 </span>            :     int end;
<span class="lineNum">    2054 </span>            :     Color col;
<span class="lineNum">    2055 </span>            :     DStemInfo *dstem;
<span class="lineNum">    2056 </span>            :     MinimumDistance *md;
<span class="lineNum">    2057 </span>            :     char *blues, *others;
<span class="lineNum">    2058 </span><span class="lineNoCov">          0 :     struct psdict *private = cv-&gt;b.sc-&gt;parent-&gt;private;</span>
<span class="lineNum">    2059 </span>            :     char buf[20];
<span class="lineNum">    2060 </span>            :     int len, len2;
<span class="lineNum">    2061 </span>            :     SplinePoint *sp;
<span class="lineNum">    2062 </span>            :     SplineSet *spl;
<span class="lineNum">    2063 </span>            : 
<span class="lineNum">    2064 </span><span class="lineNoCov">          0 :     GDrawSetFont(pixmap,cv-&gt;small);</span>
<span class="lineNum">    2065 </span><span class="lineNoCov">          0 :     blues = PSDictHasEntry(private,&quot;BlueValues&quot;); others = PSDictHasEntry(private,&quot;OtherBlues&quot;);</span>
<span class="lineNum">    2066 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showblues &amp;&amp; (blues!=NULL || others!=NULL))</span>
<span class="lineNum">    2067 </span><span class="lineNoCov">          0 :         CVDrawBlues(cv,pixmap,blues,others,bluevalstipplecol);</span>
<span class="lineNum">    2068 </span><span class="lineNoCov">          0 :     blues = PSDictHasEntry(private,&quot;FamilyBlues&quot;); others = PSDictHasEntry(private,&quot;FamilyOtherBlues&quot;);</span>
<span class="lineNum">    2069 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showfamilyblues &amp;&amp; (blues!=NULL || others!=NULL))</span>
<span class="lineNum">    2070 </span><span class="lineNoCov">          0 :         CVDrawBlues(cv,pixmap,blues,others,fambluestipplecol);</span>
<span class="lineNum">    2071 </span>            : 
<span class="lineNum">    2072 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showdhints ) for ( dstem = cv-&gt;b.sc-&gt;dstem; dstem!=NULL; dstem = dstem-&gt;next ) {</span>
<span class="lineNum">    2073 </span><span class="lineNoCov">          0 :         CVShowDHint(cv,pixmap,dstem);</span>
<span class="lineNum">    2074 </span>            :     }
<span class="lineNum">    2075 </span>            : 
<span class="lineNum">    2076 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showhhints &amp;&amp; cv-&gt;b.sc-&gt;hstem!=NULL ) {</span>
<span class="lineNum">    2077 </span><span class="lineNoCov">          0 :         GDrawSetDashedLine(pixmap,5,5,cv-&gt;xoff);</span>
<span class="lineNum">    2078 </span><span class="lineNoCov">          0 :         for ( hint = cv-&gt;b.sc-&gt;hstem; hint!=NULL; hint = hint-&gt;next ) {</span>
<span class="lineNum">    2079 </span><span class="lineNoCov">          0 :             if ( hint-&gt;width&lt;0 ) {</span>
<span class="lineNum">    2080 </span><span class="lineNoCov">          0 :                 r.y = -cv-&gt;yoff + cv-&gt;height - rint(hint-&gt;start*cv-&gt;scale);</span>
<span class="lineNum">    2081 </span><span class="lineNoCov">          0 :                 r.height = rint(-hint-&gt;width*cv-&gt;scale)+1;</span>
<span class="lineNum">    2082 </span>            :             } else {
<span class="lineNum">    2083 </span><span class="lineNoCov">          0 :                 r.y = -cv-&gt;yoff + cv-&gt;height - rint((hint-&gt;start+hint-&gt;width)*cv-&gt;scale);</span>
<span class="lineNum">    2084 </span><span class="lineNoCov">          0 :                 r.height = rint(hint-&gt;width*cv-&gt;scale)+1;</span>
<span class="lineNum">    2085 </span>            :             }
<span class="lineNum">    2086 </span><span class="lineNoCov">          0 :             col = hint-&gt;active ? hhintactivecol : hhintcol;</span>
<span class="lineNum">    2087 </span>            :             /* XRectangles are shorts! */
<span class="lineNum">    2088 </span><span class="lineNoCov">          0 :             if ( r.y&lt;32767 &amp;&amp; r.y+r.height&gt;-32768 ) {</span>
<span class="lineNum">    2089 </span><span class="lineNoCov">          0 :                 if ( r.y&lt;-32768 ) {</span>
<span class="lineNum">    2090 </span><span class="lineNoCov">          0 :                     r.height -= (-32768-r.y);</span>
<span class="lineNum">    2091 </span><span class="lineNoCov">          0 :                     r.y = -32768;</span>
<span class="lineNum">    2092 </span>            :                 }
<span class="lineNum">    2093 </span><span class="lineNoCov">          0 :                 if ( r.y+r.height&gt;32767 )</span>
<span class="lineNum">    2094 </span><span class="lineNoCov">          0 :                     r.height = 32767-r.y;</span>
<span class="lineNum">    2095 </span><span class="lineNoCov">          0 :                 for ( hi=hint-&gt;where; hi!=NULL; hi=hi-&gt;next ) {</span>
<span class="lineNum">    2096 </span><span class="lineNoCov">          0 :                     r.x = cv-&gt;xoff + rint(hi-&gt;begin*cv-&gt;scale);</span>
<span class="lineNum">    2097 </span><span class="lineNoCov">          0 :                     end = cv-&gt;xoff + rint(hi-&gt;end*cv-&gt;scale);</span>
<span class="lineNum">    2098 </span><span class="lineNoCov">          0 :                     if ( end&gt;=0 &amp;&amp; r.x&lt;=cv-&gt;width ) {</span>
<span class="lineNum">    2099 </span><span class="lineNoCov">          0 :                         r.width = end-r.x+1;</span>
<span class="lineNum">    2100 </span><span class="lineNoCov">          0 :                         GDrawFillRect(pixmap,&amp;r,col);</span>
<span class="lineNum">    2101 </span>            :                     }
<span class="lineNum">    2102 </span>            :                 }
<span class="lineNum">    2103 </span>            :             }
<span class="lineNum">    2104 </span><span class="lineNoCov">          0 :             col = (!hint-&gt;active &amp;&amp; hint-&gt;hasconflicts) ? conflicthintcol : col;</span>
<span class="lineNum">    2105 </span><span class="lineNoCov">          0 :             if ( r.y&gt;=0 &amp;&amp; r.y&lt;=cv-&gt;height )</span>
<span class="lineNum">    2106 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,0,r.y,cv-&gt;width,r.y,col);</span>
<span class="lineNum">    2107 </span><span class="lineNoCov">          0 :             if ( r.y+r.height&gt;=0 &amp;&amp; r.y+r.height&lt;=cv-&gt;width )</span>
<span class="lineNum">    2108 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,0,r.y+r.height-1,cv-&gt;width,r.y+r.height-1,col);</span>
<span class="lineNum">    2109 </span>            : 
<span class="lineNum">    2110 </span><span class="lineNoCov">          0 :             r.y = -cv-&gt;yoff + cv-&gt;height - rint(hint-&gt;start*cv-&gt;scale);</span>
<span class="lineNum">    2111 </span><span class="lineNoCov">          0 :             r.y += ( hint-&gt;width&gt;0 ) ? -3 : cv-&gt;sas+3;</span>
<span class="lineNum">    2112 </span><span class="lineNoCov">          0 :             if ( r.y&gt;-20 &amp;&amp; r.y&lt;cv-&gt;height+20 ) {</span>
<span class="lineNum">    2113 </span><span class="lineNoCov">          0 :                 dtos( buf, hint-&gt;start);</span>
<span class="lineNum">    2114 </span><span class="lineNoCov">          0 :                 len = GDrawGetText8Width(pixmap,buf,-1);</span>
<span class="lineNum">    2115 </span><span class="lineNoCov">          0 :                 GDrawDrawText8(pixmap,cv-&gt;width-len-5,r.y,buf,-1,hintlabelcol);</span>
<span class="lineNum">    2116 </span>            :             } else
<span class="lineNum">    2117 </span><span class="lineNoCov">          0 :                 len = 0;</span>
<span class="lineNum">    2118 </span><span class="lineNoCov">          0 :             r.y = -cv-&gt;yoff + cv-&gt;height - rint((hint-&gt;start+hint-&gt;width)*cv-&gt;scale);</span>
<span class="lineNum">    2119 </span><span class="lineNoCov">          0 :             r.y += ( hint-&gt;width&gt;0 ) ? cv-&gt;sas+3 : -3;</span>
<span class="lineNum">    2120 </span><span class="lineNoCov">          0 :             if ( r.y&gt;-20 &amp;&amp; r.y&lt;cv-&gt;height+20 ) {</span>
<span class="lineNum">    2121 </span><span class="lineNoCov">          0 :                 if ( hint-&gt;ghost ) {</span>
<span class="lineNum">    2122 </span><span class="lineNoCov">          0 :                     buf[0] = 'G';</span>
<span class="lineNum">    2123 </span><span class="lineNoCov">          0 :                     buf[1] = ' ';</span>
<span class="lineNum">    2124 </span><span class="lineNoCov">          0 :                     dtos(buf+2, hint-&gt;width);</span>
<span class="lineNum">    2125 </span>            :                 } else
<span class="lineNum">    2126 </span><span class="lineNoCov">          0 :                     dtos( buf, hint-&gt;width);</span>
<span class="lineNum">    2127 </span><span class="lineNoCov">          0 :                 len2 = GDrawGetText8Width(pixmap,buf,-1);</span>
<span class="lineNum">    2128 </span><span class="lineNoCov">          0 :                 GDrawDrawText8(pixmap,cv-&gt;width-len-5-len2-5,r.y,buf,-1,hintlabelcol);</span>
<span class="lineNum">    2129 </span>            :             }
<span class="lineNum">    2130 </span>            :         }
<span class="lineNum">    2131 </span>            :     }
<span class="lineNum">    2132 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showvhints &amp;&amp; cv-&gt;b.sc-&gt;vstem!=NULL ) {</span>
<span class="lineNum">    2133 </span><span class="lineNoCov">          0 :         GDrawSetDashedLine(pixmap,5,5,cv-&gt;height-cv-&gt;yoff);</span>
<span class="lineNum">    2134 </span><span class="lineNoCov">          0 :         for ( hint = cv-&gt;b.sc-&gt;vstem; hint!=NULL; hint = hint-&gt;next ) {</span>
<span class="lineNum">    2135 </span><span class="lineNoCov">          0 :             if ( hint-&gt;width&lt;0 ) {</span>
<span class="lineNum">    2136 </span><span class="lineNoCov">          0 :                 r.x = cv-&gt;xoff + rint( (hint-&gt;start+hint-&gt;width)*cv-&gt;scale );</span>
<span class="lineNum">    2137 </span><span class="lineNoCov">          0 :                 r.width = rint(-hint-&gt;width*cv-&gt;scale)+1;</span>
<span class="lineNum">    2138 </span>            :             } else {
<span class="lineNum">    2139 </span><span class="lineNoCov">          0 :                 r.x = cv-&gt;xoff + rint(hint-&gt;start*cv-&gt;scale);</span>
<span class="lineNum">    2140 </span><span class="lineNoCov">          0 :                 r.width = rint(hint-&gt;width*cv-&gt;scale)+1;</span>
<span class="lineNum">    2141 </span>            :             }
<span class="lineNum">    2142 </span><span class="lineNoCov">          0 :             col = hint-&gt;active ? vhintactivecol : vhintcol;</span>
<span class="lineNum">    2143 </span><span class="lineNoCov">          0 :             if ( r.x&lt;32767 &amp;&amp; r.x+r.width&gt;-32768 ) {</span>
<span class="lineNum">    2144 </span><span class="lineNoCov">          0 :                 if ( r.x&lt;-32768 ) {</span>
<span class="lineNum">    2145 </span><span class="lineNoCov">          0 :                     r.width -= (-32768-r.x);</span>
<span class="lineNum">    2146 </span><span class="lineNoCov">          0 :                     r.x = -32768;</span>
<span class="lineNum">    2147 </span>            :                 }
<span class="lineNum">    2148 </span><span class="lineNoCov">          0 :                 if ( r.x+r.width&gt;32767 )</span>
<span class="lineNum">    2149 </span><span class="lineNoCov">          0 :                     r.width = 32767-r.x;</span>
<span class="lineNum">    2150 </span><span class="lineNoCov">          0 :                 for ( hi=hint-&gt;where; hi!=NULL; hi=hi-&gt;next ) {</span>
<span class="lineNum">    2151 </span><span class="lineNoCov">          0 :                     r.y = -cv-&gt;yoff + cv-&gt;height - rint(hi-&gt;end*cv-&gt;scale);</span>
<span class="lineNum">    2152 </span><span class="lineNoCov">          0 :                     end = -cv-&gt;yoff + cv-&gt;height - rint(hi-&gt;begin*cv-&gt;scale);</span>
<span class="lineNum">    2153 </span><span class="lineNoCov">          0 :                     if ( end&gt;=0 &amp;&amp; r.y&lt;=cv-&gt;height ) {</span>
<span class="lineNum">    2154 </span><span class="lineNoCov">          0 :                         r.height = end-r.y+1;</span>
<span class="lineNum">    2155 </span><span class="lineNoCov">          0 :                         GDrawFillRect(pixmap,&amp;r,col);</span>
<span class="lineNum">    2156 </span>            :                     }
<span class="lineNum">    2157 </span>            :                 }
<span class="lineNum">    2158 </span>            :             }
<span class="lineNum">    2159 </span><span class="lineNoCov">          0 :             col = (!hint-&gt;active &amp;&amp; hint-&gt;hasconflicts) ? conflicthintcol : col;</span>
<span class="lineNum">    2160 </span><span class="lineNoCov">          0 :             if ( r.x&gt;=0 &amp;&amp; r.x&lt;=cv-&gt;width )</span>
<span class="lineNum">    2161 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,r.x,0,r.x,cv-&gt;height,col);</span>
<span class="lineNum">    2162 </span><span class="lineNoCov">          0 :             if ( r.x+r.width&gt;=0 &amp;&amp; r.x+r.width&lt;=cv-&gt;width )</span>
<span class="lineNum">    2163 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,r.x+r.width-1,0,r.x+r.width-1,cv-&gt;height,col);</span>
<span class="lineNum">    2164 </span>            : 
<span class="lineNum">    2165 </span><span class="lineNoCov">          0 :             r.x = cv-&gt;xoff + rint(hint-&gt;start*cv-&gt;scale);</span>
<span class="lineNum">    2166 </span><span class="lineNoCov">          0 :             if ( r.x&gt;-60 &amp;&amp; r.x&lt;cv-&gt;width+20 ) {</span>
<span class="lineNum">    2167 </span><span class="lineNoCov">          0 :                 dtos( buf, hint-&gt;start);</span>
<span class="lineNum">    2168 </span><span class="lineNoCov">          0 :                 len = GDrawGetText8Width(pixmap,buf,-1);</span>
<span class="lineNum">    2169 </span><span class="lineNoCov">          0 :                 r.x += ( hint-&gt;width&gt;0 ) ? 3 : -len-3;</span>
<span class="lineNum">    2170 </span><span class="lineNoCov">          0 :                 GDrawDrawText8(pixmap,r.x,cv-&gt;sas+3,buf,-1,hintlabelcol);</span>
<span class="lineNum">    2171 </span>            :             }
<span class="lineNum">    2172 </span><span class="lineNoCov">          0 :             r.x = cv-&gt;xoff + rint((hint-&gt;start+hint-&gt;width)*cv-&gt;scale);</span>
<span class="lineNum">    2173 </span><span class="lineNoCov">          0 :             if ( r.x&gt;-60 &amp;&amp; r.x&lt;cv-&gt;width+20 ) {</span>
<span class="lineNum">    2174 </span><span class="lineNoCov">          0 :                 if ( hint-&gt;ghost ) {</span>
<span class="lineNum">    2175 </span><span class="lineNoCov">          0 :                     buf[0] = 'G';</span>
<span class="lineNum">    2176 </span><span class="lineNoCov">          0 :                     buf[1] = ' ';</span>
<span class="lineNum">    2177 </span><span class="lineNoCov">          0 :                     dtos(buf+2, hint-&gt;width);</span>
<span class="lineNum">    2178 </span>            :                 } else
<span class="lineNum">    2179 </span><span class="lineNoCov">          0 :                     dtos( buf, hint-&gt;width);</span>
<span class="lineNum">    2180 </span><span class="lineNoCov">          0 :                 len = GDrawGetText8Width(pixmap,buf,-1);</span>
<span class="lineNum">    2181 </span><span class="lineNoCov">          0 :                 r.x += ( hint-&gt;width&gt;0 ) ? -len-3 : 3;</span>
<span class="lineNum">    2182 </span><span class="lineNoCov">          0 :                 GDrawDrawText8(pixmap,r.x,cv-&gt;sas+cv-&gt;sfh+3,buf,-1,hintlabelcol);</span>
<span class="lineNum">    2183 </span>            :             }
<span class="lineNum">    2184 </span>            :         }
<span class="lineNum">    2185 </span>            :     }
<span class="lineNum">    2186 </span><span class="lineNoCov">          0 :     GDrawSetDashedLine(pixmap,0,0,0);</span>
<span class="lineNum">    2187 </span>            : 
<span class="lineNum">    2188 </span><span class="lineNoCov">          0 :     for ( md=cv-&gt;b.sc-&gt;md; md!=NULL; md=md-&gt;next )</span>
<span class="lineNum">    2189 </span><span class="lineNoCov">          0 :         CVShowMinimumDistance(cv, pixmap,md);</span>
<span class="lineNum">    2190 </span>            : 
<span class="lineNum">    2191 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showvhints || cv-&gt;showhhints ) {</span>
<span class="lineNum">    2192 </span><span class="lineNoCov">          0 :         for ( spl=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl=spl-&gt;next ) {</span>
<span class="lineNum">    2193 </span><span class="lineNoCov">          0 :             if ( spl-&gt;first-&gt;prev!=NULL ) for ( sp=spl-&gt;first ; ; ) {</span>
<span class="lineNum">    2194 </span><span class="lineNoCov">          0 :                 if ( cv-&gt;showhhints &amp;&amp; sp-&gt;flexx ) {</span>
<span class="lineNum">    2195 </span>            :                     double x,y,end;
<span class="lineNum">    2196 </span><span class="lineNoCov">          0 :                     x = cv-&gt;xoff + rint(sp-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    2197 </span><span class="lineNoCov">          0 :                     y = -cv-&gt;yoff + cv-&gt;height - rint(sp-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    2198 </span><span class="lineNoCov">          0 :                     end = cv-&gt;xoff + rint(sp-&gt;next-&gt;to-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    2199 </span><span class="lineNoCov">          0 :                     if ( x&gt;-4096 &amp;&amp; x&lt;32767 &amp;&amp; y&gt;-4096 &amp;&amp; y&lt;32767 ) {</span>
<span class="lineNum">    2200 </span><span class="lineNoCov">          0 :                         GDrawDrawLine(pixmap,x,y,end,y,hflexhintcol);</span>
<span class="lineNum">    2201 </span>            :                     }
<span class="lineNum">    2202 </span>            :                 }
<span class="lineNum">    2203 </span><span class="lineNoCov">          0 :                 if ( cv-&gt;showvhints &amp;&amp; sp-&gt;flexy ) {</span>
<span class="lineNum">    2204 </span>            :                     double x,y,end;
<span class="lineNum">    2205 </span><span class="lineNoCov">          0 :                     x = cv-&gt;xoff + rint(sp-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    2206 </span><span class="lineNoCov">          0 :                     y = -cv-&gt;yoff + cv-&gt;height - rint(sp-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    2207 </span><span class="lineNoCov">          0 :                     end = -cv-&gt;yoff + cv-&gt;height - rint(sp-&gt;next-&gt;to-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    2208 </span><span class="lineNoCov">          0 :                     if ( x&gt;-4096 &amp;&amp; x&lt;32767 &amp;&amp; y&gt;-4096 &amp;&amp; y&lt;32767 ) {</span>
<span class="lineNum">    2209 </span><span class="lineNoCov">          0 :                         GDrawDrawLine(pixmap,x,y,x,end,vflexhintcol);</span>
<span class="lineNum">    2210 </span>            :                     }
<span class="lineNum">    2211 </span>            :                 }
<span class="lineNum">    2212 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )                /* This can happen if we get an internal error inside of RemoveOverlap when the pointlist is not in good shape */</span>
<span class="lineNum">    2213 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2214 </span><span class="lineNoCov">          0 :                 sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    2215 </span><span class="lineNoCov">          0 :                 if ( sp==spl-&gt;first )</span>
<span class="lineNum">    2216 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2217 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">    2218 </span>            :         }
<span class="lineNum">    2219 </span>            :     }
<a name="2220"><span class="lineNum">    2220 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2221 </span>            : 
<span class="lineNum">    2222 </span><span class="lineNoCov">          0 : static void CVDrawRefName(CharView *cv,GWindow pixmap,RefChar *ref,int fg) {</span>
<span class="lineNum">    2223 </span>            :     int x,y, len;
<span class="lineNum">    2224 </span>            :     GRect size;
<span class="lineNum">    2225 </span>            : 
<span class="lineNum">    2226 </span><span class="lineNoCov">          0 :     x = cv-&gt;xoff + rint(ref-&gt;top.x*cv-&gt;scale);</span>
<span class="lineNum">    2227 </span><span class="lineNoCov">          0 :     y = -cv-&gt;yoff + cv-&gt;height - rint(ref-&gt;top.y*cv-&gt;scale);</span>
<span class="lineNum">    2228 </span><span class="lineNoCov">          0 :     y -= 5;</span>
<span class="lineNum">    2229 </span><span class="lineNoCov">          0 :     if ( x&lt;-400 || y&lt;-40 || x&gt;cv-&gt;width+400 || y&gt;cv-&gt;height )</span>
<span class="lineNum">    2230 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2231 </span>            : 
<span class="lineNum">    2232 </span><span class="lineNoCov">          0 :     GDrawLayoutInit(pixmap,ref-&gt;sc-&gt;name,-1,cv-&gt;small);</span>
<span class="lineNum">    2233 </span><span class="lineNoCov">          0 :     GDrawLayoutExtents(pixmap,&amp;size);</span>
<span class="lineNum">    2234 </span><span class="lineNoCov">          0 :     GDrawLayoutDraw(pixmap,x-size.width/2,y,fg);</span>
<span class="lineNum">    2235 </span><span class="lineNoCov">          0 :     len = size.width;</span>
<span class="lineNum">    2236 </span><span class="lineNoCov">          0 :     if ( ref-&gt;use_my_metrics )</span>
<span class="lineNum">    2237 </span><span class="lineNoCov">          0 :         GDrawDrawImage(pixmap,&amp;GIcon_lock,NULL,x+len+3,y-cv-&gt;sas);</span>
<a name="2238"><span class="lineNum">    2238 </span>            : }</a>
<span class="lineNum">    2239 </span>            : 
<span class="lineNum">    2240 </span><span class="lineNoCov">          0 : void DrawAnchorPoint(GWindow pixmap,int x, int y,int selected) {</span>
<span class="lineNum">    2241 </span>            :     GPoint gp[9];
<span class="lineNum">    2242 </span><span class="lineNoCov">          0 :     Color col = anchorcol;</span>
<span class="lineNum">    2243 </span>            : 
<span class="lineNum">    2244 </span><span class="lineNoCov">          0 :     gp[0].x = x-1; gp[0].y = y-1;</span>
<span class="lineNum">    2245 </span><span class="lineNoCov">          0 :     gp[1].x = x;   gp[1].y = y-6;</span>
<span class="lineNum">    2246 </span><span class="lineNoCov">          0 :     gp[2].x = x+1; gp[2].y = y-1;</span>
<span class="lineNum">    2247 </span><span class="lineNoCov">          0 :     gp[3].x = x+6; gp[3].y = y;</span>
<span class="lineNum">    2248 </span><span class="lineNoCov">          0 :     gp[4].x = x+1; gp[4].y = y+1;</span>
<span class="lineNum">    2249 </span><span class="lineNoCov">          0 :     gp[5].x = x;   gp[5].y = y+6;</span>
<span class="lineNum">    2250 </span><span class="lineNoCov">          0 :     gp[6].x = x-1; gp[6].y = y+1;</span>
<span class="lineNum">    2251 </span><span class="lineNoCov">          0 :     gp[7].x = x-6; gp[7].y = y;</span>
<span class="lineNum">    2252 </span><span class="lineNoCov">          0 :     gp[8] = gp[0];</span>
<span class="lineNum">    2253 </span><span class="lineNoCov">          0 :     if ( selected )</span>
<span class="lineNum">    2254 </span><span class="lineNoCov">          0 :         GDrawDrawPoly(pixmap,gp,9,col);</span>
<span class="lineNum">    2255 </span>            :     else
<span class="lineNum">    2256 </span><span class="lineNoCov">          0 :         GDrawFillPoly(pixmap,gp,9,col);</span>
<a name="2257"><span class="lineNum">    2257 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2258 </span>            : 
<span class="lineNum">    2259 </span><span class="lineNoCov">          0 : static void CVDrawAnchorPoints(CharView *cv,GWindow pixmap) {</span>
<span class="lineNum">    2260 </span>            :     int x,y, len, sel;
<span class="lineNum">    2261 </span><span class="lineNoCov">          0 :     Color col = anchorcol;</span>
<span class="lineNum">    2262 </span>            :     AnchorPoint *ap;
<span class="lineNum">    2263 </span>            :     char *name, ubuf[50];
<span class="lineNum">    2264 </span>            :     GRect r;
<span class="lineNum">    2265 </span>            : 
<span class="lineNum">    2266 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.drawmode!=dm_fore || cv-&gt;b.sc-&gt;anchor==NULL || !cv-&gt;showanchor )</span>
<span class="lineNum">    2267 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2268 </span><span class="lineNoCov">          0 :     GDrawSetFont(pixmap,cv-&gt;normal);</span>
<span class="lineNum">    2269 </span>            : 
<span class="lineNum">    2270 </span><span class="lineNoCov">          0 :     for ( sel=0; sel&lt;2; ++sel ) {</span>
<span class="lineNum">    2271 </span><span class="lineNoCov">          0 :         for ( ap = cv-&gt;b.sc-&gt;anchor; ap!=NULL; ap=ap-&gt;next ) if ( ap-&gt;selected==sel ) {</span>
<span class="lineNum">    2272 </span><span class="lineNoCov">          0 :             x = cv-&gt;xoff + rint(ap-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    2273 </span><span class="lineNoCov">          0 :             y = -cv-&gt;yoff + cv-&gt;height - rint(ap-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    2274 </span><span class="lineNoCov">          0 :             if ( x&lt;-400 || y&lt;-40 || x&gt;cv-&gt;width+400 || y&gt;cv-&gt;height )</span>
<span class="lineNum">    2275 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    2276 </span>            : 
<span class="lineNum">    2277 </span><span class="lineNoCov">          0 :             DrawAnchorPoint(pixmap,x,y,ap-&gt;selected);</span>
<span class="lineNum">    2278 </span><span class="lineNoCov">          0 :             ubuf[30]=0;</span>
<span class="lineNum">    2279 </span><span class="lineNoCov">          0 :             if ( ap-&gt;anchor-&gt;type==act_mkmk ) {</span>
<span class="lineNum">    2280 </span><span class="lineNoCov">          0 :                 cc_strncpy(ubuf,ap-&gt;anchor-&gt;name,30);</span>
<span class="lineNum">    2281 </span><span class="lineNoCov">          0 :                 strcat(ubuf,&quot; &quot;);</span>
<span class="lineNum">    2282 </span><span class="lineNoCov">          0 :                 strcat(ubuf,ap-&gt;type==at_basemark ? _(&quot;Base&quot;) : _(&quot;Mark&quot;) );</span>
<span class="lineNum">    2283 </span><span class="lineNoCov">          0 :                 name = ubuf;</span>
<span class="lineNum">    2284 </span><span class="lineNoCov">          0 :             } else if ( ap-&gt;type==at_basechar || ap-&gt;type==at_mark || ap-&gt;type==at_basemark ) {</span>
<span class="lineNum">    2285 </span><span class="lineNoCov">          0 :                 name = ap-&gt;anchor-&gt;name;</span>
<span class="lineNum">    2286 </span><span class="lineNoCov">          0 :             } else if ( ap-&gt;type==at_centry || ap-&gt;type==at_cexit ) {</span>
<span class="lineNum">    2287 </span><span class="lineNoCov">          0 :                 cc_strncpy(ubuf,ap-&gt;anchor-&gt;name,30);</span>
<span class="lineNum">    2288 </span><span class="lineNoCov">          0 :                 strcat(ubuf,ap-&gt;type==at_centry ? _(&quot;Entry&quot;) : _(&quot;Exit&quot;) );</span>
<span class="lineNum">    2289 </span><span class="lineNoCov">          0 :                 name = ubuf;</span>
<span class="lineNum">    2290 </span><span class="lineNoCov">          0 :             } else if ( ap-&gt;type==at_baselig ) {</span>
<span class="lineNum">    2291 </span><span class="lineNoCov">          0 :                 cc_strncpy(ubuf,ap-&gt;anchor-&gt;name,30);</span>
<span class="lineNum">    2292 </span><span class="lineNoCov">          0 :                 sprintf(ubuf+strlen(ubuf),&quot;#%d&quot;, ap-&gt;lig_index);</span>
<span class="lineNum">    2293 </span><span class="lineNoCov">          0 :                 name = ubuf;</span>
<span class="lineNum">    2294 </span>            :             } else
<span class="lineNum">    2295 </span><span class="lineNoCov">          0 :                 name = NULL;            /* Should never happen */</span>
<span class="lineNum">    2296 </span>            : 
<span class="lineNum">    2297 </span>            :             GRect size;
<span class="lineNum">    2298 </span><span class="lineNoCov">          0 :             GDrawLayoutInit(pixmap,name,-1,NULL);</span>
<span class="lineNum">    2299 </span><span class="lineNoCov">          0 :             GDrawLayoutExtents(pixmap,&amp;size);</span>
<span class="lineNum">    2300 </span><span class="lineNoCov">          0 :             len = size.width;</span>
<span class="lineNum">    2301 </span>            : 
<span class="lineNum">    2302 </span><span class="lineNoCov">          0 :             r.x = x-len/2; r.width = len;</span>
<span class="lineNum">    2303 </span><span class="lineNoCov">          0 :             r.y = y+7; r.height = cv-&gt;nfh;</span>
<span class="lineNum">    2304 </span><span class="lineNoCov">          0 :             GDrawFillRect(pixmap,&amp;r,view_bgcol );</span>
<span class="lineNum">    2305 </span><span class="lineNoCov">          0 :             GDrawLayoutDraw(pixmap,x-len/2,y+7+cv-&gt;nas,col);</span>
<span class="lineNum">    2306 </span>            :         }
<span class="lineNum">    2307 </span>            :     }
<a name="2308"><span class="lineNum">    2308 </span>            : }</a>
<span class="lineNum">    2309 </span>            : 
<span class="lineNum">    2310 </span><span class="lineNoCov">          0 : static void DrawImageList(CharView *cv,GWindow pixmap,ImageList *backimages) {</span>
<span class="lineNum">    2311 </span>            :     GRect size, temp;
<span class="lineNum">    2312 </span>            :     int x,y;
<span class="lineNum">    2313 </span>            : 
<span class="lineNum">    2314 </span><span class="lineNoCov">          0 :     GDrawGetSize(pixmap,&amp;size);</span>
<span class="lineNum">    2315 </span>            : 
<span class="lineNum">    2316 </span><span class="lineNoCov">          0 :     while ( backimages!=NULL ) {</span>
<span class="lineNum">    2317 </span><span class="lineNoCov">          0 :         struct _GImage *base = backimages-&gt;image-&gt;list_len==0?</span>
<span class="lineNum">    2318 </span><span class="lineNoCov">          0 :                 backimages-&gt;image-&gt;u.image:backimages-&gt;image-&gt;u.images[0];</span>
<span class="lineNum">    2319 </span>            : 
<span class="lineNum">    2320 </span><span class="lineNoCov">          0 :         temp = size;</span>
<span class="lineNum">    2321 </span><span class="lineNoCov">          0 :         x = (int) (cv-&gt;xoff + rint(backimages-&gt;xoff * cv-&gt;scale));</span>
<span class="lineNum">    2322 </span><span class="lineNoCov">          0 :         y = (int) (-cv-&gt;yoff + cv-&gt;height - rint(backimages-&gt;yoff*cv-&gt;scale));</span>
<span class="lineNum">    2323 </span><span class="lineNoCov">          0 :         temp.x -= x; temp.y -= y;</span>
<span class="lineNum">    2324 </span><span class="lineNoCov">          0 :         temp.width += x; temp.height += y;</span>
<span class="lineNum">    2325 </span>            : 
<span class="lineNum">    2326 </span><span class="lineNoCov">          0 :         GDrawDrawImageMagnified(pixmap, backimages-&gt;image, &amp;temp,</span>
<span class="lineNum">    2327 </span>            :                 x,y,
<span class="lineNum">    2328 </span><span class="lineNoCov">          0 :                 (int) rint((base-&gt;width*backimages-&gt;xscale*cv-&gt;scale)),</span>
<span class="lineNum">    2329 </span><span class="lineNoCov">          0 :                 (int) rint((base-&gt;height*backimages-&gt;yscale*cv-&gt;scale)));</span>
<span class="lineNum">    2330 </span><span class="lineNoCov">          0 :         backimages = backimages-&gt;next;</span>
<span class="lineNum">    2331 </span>            :     }
<a name="2332"><span class="lineNum">    2332 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2333 </span>            : 
<span class="lineNum">    2334 </span><span class="lineNoCov">          0 : static void DrawSelImageList(CharView *cv,GWindow pixmap,ImageList *images) {</span>
<span class="lineNum">    2335 </span><span class="lineNoCov">          0 :     while ( images!=NULL ) {</span>
<span class="lineNum">    2336 </span><span class="lineNoCov">          0 :         if ( images-&gt;selected )</span>
<span class="lineNum">    2337 </span><span class="lineNoCov">          0 :             CVDrawBB(cv,pixmap,&amp;images-&gt;bb);</span>
<span class="lineNum">    2338 </span><span class="lineNoCov">          0 :         images = images-&gt;next;</span>
<span class="lineNum">    2339 </span>            :     }
<a name="2340"><span class="lineNum">    2340 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2341 </span>            : 
<span class="lineNum">    2342 </span><span class="lineNoCov">          0 : static void DrawOldState(CharView *cv, GWindow pixmap, Undoes *undo, DRect *clip) {</span>
<span class="lineNum">    2343 </span>            :     RefChar *refs;
<span class="lineNum">    2344 </span>            : 
<span class="lineNum">    2345 </span><span class="lineNoCov">          0 :     if ( undo==NULL )</span>
<span class="lineNum">    2346 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2347 </span>            : 
<span class="lineNum">    2348 </span><span class="lineNoCov">          0 :     CVDrawSplineSet(cv,pixmap,undo-&gt;u.state.splines,oldoutlinecol,false,clip);</span>
<span class="lineNum">    2349 </span><span class="lineNoCov">          0 :     for ( refs=undo-&gt;u.state.refs; refs!=NULL; refs=refs-&gt;next )</span>
<span class="lineNum">    2350 </span><span class="lineNoCov">          0 :         if ( refs-&gt;layers[0].splines!=NULL )</span>
<span class="lineNum">    2351 </span><span class="lineNoCov">          0 :             CVDrawSplineSet(cv,pixmap,refs-&gt;layers[0].splines,oldoutlinecol,false,clip);</span>
<span class="lineNum">    2352 </span>            :     /* Don't do images... */
<a name="2353"><span class="lineNum">    2353 </span>            : }</a>
<span class="lineNum">    2354 </span>            : 
<span class="lineNum">    2355 </span><span class="lineNoCov">          0 : static void DrawTransOrigin(CharView *cv, GWindow pixmap) {</span>
<span class="lineNum">    2356 </span><span class="lineNoCov">          0 :     int x = rint(cv-&gt;p.cx*cv-&gt;scale) + cv-&gt;xoff, y = cv-&gt;height-cv-&gt;yoff-rint(cv-&gt;p.cy*cv-&gt;scale);</span>
<span class="lineNum">    2357 </span>            : 
<span class="lineNum">    2358 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap,x-4,y,x+4,y,transformorigincol);</span>
<span class="lineNum">    2359 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap,x,y-4,x,y+4,transformorigincol);</span>
<a name="2360"><span class="lineNum">    2360 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2361 </span>            : 
<span class="lineNum">    2362 </span><span class="lineNoCov">          0 : static void DrawVLine(CharView *cv,GWindow pixmap,real pos,Color fg, int flags,</span>
<span class="lineNum">    2363 </span>            :         GImage *lock, char *name) {
<span class="lineNum">    2364 </span>            :     char buf[20];
<span class="lineNum">    2365 </span><span class="lineNoCov">          0 :     int x = cv-&gt;xoff + rint(pos*cv-&gt;scale);</span>
<span class="lineNum">    2366 </span><span class="lineNoCov">          0 :     DrawLine(cv,pixmap,pos,-32768,pos,32767,fg);</span>
<span class="lineNum">    2367 </span><span class="lineNoCov">          0 :     if ( x&gt;-400 &amp;&amp; x&lt;cv-&gt;width+400 ) {</span>
<span class="lineNum">    2368 </span><span class="lineNoCov">          0 :         if ( flags&amp;1 ) {</span>
<span class="lineNum">    2369 </span><span class="lineNoCov">          0 :             dtos( buf, pos);</span>
<span class="lineNum">    2370 </span><span class="lineNoCov">          0 :             GDrawSetFont(pixmap,cv-&gt;small);</span>
<span class="lineNum">    2371 </span><span class="lineNoCov">          0 :             GDrawDrawText8(pixmap,x+5,cv-&gt;sas+3,buf,-1,metricslabelcol);</span>
<span class="lineNum">    2372 </span><span class="lineNoCov">          0 :             if ( lock!=NULL )</span>
<span class="lineNum">    2373 </span><span class="lineNoCov">          0 :                 GDrawDrawImage(pixmap,lock,NULL,x+5,3+cv-&gt;sfh);</span>
<span class="lineNum">    2374 </span>            :         }
<span class="lineNum">    2375 </span><span class="lineNoCov">          0 :         if ( name!=NULL )</span>
<span class="lineNum">    2376 </span><span class="lineNoCov">          0 :             GDrawDrawText8(pixmap,x+5,cv-&gt;sas+cv-&gt;sfh*(1+lock!=NULL)+3,name,-1,metricslabelcol);</span>
<span class="lineNum">    2377 </span>            :     }
<span class="lineNum">    2378 </span><span class="lineNoCov">          0 :     if ( ItalicConstrained &amp;&amp; cv-&gt;b.sc-&gt;parent-&gt;italicangle!=0 ) {</span>
<span class="lineNum">    2379 </span><span class="lineNoCov">          0 :         double t = tan(-cv-&gt;b.sc-&gt;parent-&gt;italicangle*3.1415926535897932/180.);</span>
<span class="lineNum">    2380 </span><span class="lineNoCov">          0 :         int xoff = rint(8096*t);</span>
<span class="lineNum">    2381 </span><span class="lineNoCov">          0 :         DrawLine(cv,pixmap,pos-xoff,-8096,pos+xoff,8096,italiccoordcol);</span>
<span class="lineNum">    2382 </span>            :     }
<a name="2383"><span class="lineNum">    2383 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2384 </span>            : 
<span class="lineNum">    2385 </span><span class="lineNoCov">          0 : static void DrawMMGhosts(CharView *cv,GWindow pixmap,DRect *clip) {</span>
<span class="lineNum">    2386 </span>            :     /* In an MM font, draw any selected alternate versions of the current char */
<span class="lineNum">    2387 </span><span class="lineNoCov">          0 :     MMSet *mm = cv-&gt;b.sc-&gt;parent-&gt;mm;</span>
<span class="lineNum">    2388 </span>            :     int j;
<span class="lineNum">    2389 </span>            :     SplineFont *sub;
<span class="lineNum">    2390 </span>            :     SplineChar *sc;
<span class="lineNum">    2391 </span>            :     RefChar *rf;
<span class="lineNum">    2392 </span>            : 
<span class="lineNum">    2393 </span><span class="lineNoCov">          0 :     if ( mm==NULL )</span>
<span class="lineNum">    2394 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2395 </span><span class="lineNoCov">          0 :     for ( j = 0; j&lt;mm-&gt;instance_count+1; ++j ) {</span>
<span class="lineNum">    2396 </span><span class="lineNoCov">          0 :         if ( j==0 )</span>
<span class="lineNum">    2397 </span><span class="lineNoCov">          0 :             sub = mm-&gt;normal;</span>
<span class="lineNum">    2398 </span>            :         else
<span class="lineNum">    2399 </span><span class="lineNoCov">          0 :             sub = mm-&gt;instances[j-1];</span>
<span class="lineNum">    2400 </span><span class="lineNoCov">          0 :         sc = NULL;</span>
<span class="lineNum">    2401 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.sc-&gt;parent!=sub &amp;&amp; (cv-&gt;mmvisible &amp; (1&lt;&lt;j)) &amp;&amp;</span>
<span class="lineNum">    2402 </span><span class="lineNoCov">          0 :                 cv-&gt;b.sc-&gt;orig_pos&lt;sub-&gt;glyphcnt )</span>
<span class="lineNum">    2403 </span><span class="lineNoCov">          0 :             sc = sub-&gt;glyphs[cv-&gt;b.sc-&gt;orig_pos];</span>
<span class="lineNum">    2404 </span><span class="lineNoCov">          0 :         if ( sc!=NULL ) {</span>
<span class="lineNum">    2405 </span><span class="lineNoCov">          0 :             for ( rf=sc-&gt;layers[ly_fore].refs; rf!=NULL; rf = rf-&gt;next )</span>
<span class="lineNum">    2406 </span><span class="lineNoCov">          0 :                 CVDrawSplineSet(cv,pixmap,rf-&gt;layers[0].splines,backoutlinecol,false,clip);</span>
<span class="lineNum">    2407 </span><span class="lineNoCov">          0 :             CVDrawSplineSet(cv,pixmap,sc-&gt;layers[ly_fore].splines,backoutlinecol,false,clip);</span>
<span class="lineNum">    2408 </span>            :         }
<span class="lineNum">    2409 </span>            :     }
<a name="2410"><span class="lineNum">    2410 </span>            : }</a>
<span class="lineNum">    2411 </span>            : 
<span class="lineNum">    2412 </span><span class="lineNoCov">          0 : static void CVDrawGridRaster(CharView *cv, GWindow pixmap, DRect *clip ) {</span>
<span class="lineNum">    2413 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showgrids ) {</span>
<span class="lineNum">    2414 </span>            :         /* Draw ppem grid, and the raster for truetype debugging, grid fit */
<span class="lineNum">    2415 </span>            :         GRect pixel;
<span class="lineNum">    2416 </span><span class="lineNoCov">          0 :         real ygrid_spacing = (cv-&gt;b.sc-&gt;parent-&gt;ascent+cv-&gt;b.sc-&gt;parent-&gt;descent) / (real) cv-&gt;ft_ppemy;</span>
<span class="lineNum">    2417 </span><span class="lineNoCov">          0 :         real xgrid_spacing = (cv-&gt;b.sc-&gt;parent-&gt;ascent+cv-&gt;b.sc-&gt;parent-&gt;descent) / (real) cv-&gt;ft_ppemx;</span>
<span class="lineNum">    2418 </span>            :         int max,jmax,ii,i,jj,j;
<span class="lineNum">    2419 </span><span class="lineNoCov">          0 :         int minx, maxx, miny, maxy, r,or=0;</span>
<span class="lineNum">    2420 </span>            :         Color clut[256];
<span class="lineNum">    2421 </span>            : 
<span class="lineNum">    2422 </span><span class="lineNoCov">          0 :         pixel.width = xgrid_spacing*cv-&gt;scale+1;</span>
<span class="lineNum">    2423 </span><span class="lineNoCov">          0 :         pixel.height = ygrid_spacing*cv-&gt;scale+1;</span>
<span class="lineNum">    2424 </span><span class="lineNoCov">          0 :         if ( cv-&gt;raster!=NULL ) {</span>
<span class="lineNum">    2425 </span><span class="lineNoCov">          0 :             if ( cv-&gt;raster-&gt;num_greys&gt;2 ) {</span>
<span class="lineNum">    2426 </span>            :                 int rb, gb, bb, rd, gd, bd;
<span class="lineNum">    2427 </span><span class="lineNoCov">          0 :                 clut[0] = view_bgcol ;</span>
<span class="lineNum">    2428 </span><span class="lineNoCov">          0 :                 rb = COLOR_RED(clut[0]); gb = COLOR_GREEN(clut[0]); bb = COLOR_BLUE(clut[0]);</span>
<span class="lineNum">    2429 </span><span class="lineNoCov">          0 :                 rd = COLOR_RED(rasterdarkcol)-rb;</span>
<span class="lineNum">    2430 </span><span class="lineNoCov">          0 :                 gd = COLOR_GREEN(rasterdarkcol)-gb;</span>
<span class="lineNum">    2431 </span><span class="lineNoCov">          0 :                 bd = COLOR_BLUE(rasterdarkcol)-bb;</span>
<span class="lineNum">    2432 </span><span class="lineNoCov">          0 :                 for ( i=1; i&lt;256; ++i ) {</span>
<span class="lineNum">    2433 </span><span class="lineNoCov">          0 :                     clut[i] = ( (rb +rd*(i)/0xff)&lt;&lt;16 ) |</span>
<span class="lineNum">    2434 </span><span class="lineNoCov">          0 :                             ( (gb+gd*(i)/0xff)&lt;&lt;8 ) |</span>
<span class="lineNum">    2435 </span><span class="lineNoCov">          0 :                             ( (bb+bd*(i)/0xff) );</span>
<span class="lineNum">    2436 </span>            :                 }
<span class="lineNum">    2437 </span>            :             }
<span class="lineNum">    2438 </span><span class="lineNoCov">          0 :             minx = cv-&gt;raster-&gt;lb; maxx = minx+cv-&gt;raster-&gt;cols;</span>
<span class="lineNum">    2439 </span><span class="lineNoCov">          0 :             maxy = cv-&gt;raster-&gt;as; miny = maxy-cv-&gt;raster-&gt;rows;</span>
<span class="lineNum">    2440 </span><span class="lineNoCov">          0 :             if ( cv-&gt;oldraster!=NULL ) {</span>
<span class="lineNum">    2441 </span><span class="lineNoCov">          0 :                 if ( cv-&gt;oldraster-&gt;lb&lt;minx ) minx = cv-&gt;oldraster-&gt;lb;</span>
<span class="lineNum">    2442 </span><span class="lineNoCov">          0 :                 if ( cv-&gt;oldraster-&gt;lb+cv-&gt;oldraster-&gt;cols&gt;maxx ) maxx = cv-&gt;oldraster-&gt;lb+cv-&gt;oldraster-&gt;cols;</span>
<span class="lineNum">    2443 </span><span class="lineNoCov">          0 :                 if ( cv-&gt;oldraster-&gt;as&gt;maxy ) maxy = cv-&gt;oldraster-&gt;as;</span>
<span class="lineNum">    2444 </span><span class="lineNoCov">          0 :                 if ( cv-&gt;oldraster-&gt;as-cv-&gt;oldraster-&gt;rows&lt;miny ) miny = cv-&gt;oldraster-&gt;as-cv-&gt;oldraster-&gt;rows;</span>
<span class="lineNum">    2445 </span>            :             }
<span class="lineNum">    2446 </span><span class="lineNoCov">          0 :             for ( ii=maxy; ii&gt;miny; --ii ) {</span>
<span class="lineNum">    2447 </span><span class="lineNoCov">          0 :                 for ( jj=minx; jj&lt;maxx; ++jj ) {</span>
<span class="lineNum">    2448 </span><span class="lineNoCov">          0 :                     i = cv-&gt;raster-&gt;as-ii; j = jj-cv-&gt;raster-&gt;lb;</span>
<span class="lineNum">    2449 </span><span class="lineNoCov">          0 :                     if ( i&lt;0 || i&gt;=cv-&gt;raster-&gt;rows || j&lt;0 || j&gt;=cv-&gt;raster-&gt;cols )</span>
<span class="lineNum">    2450 </span><span class="lineNoCov">          0 :                         r = 0;</span>
<span class="lineNum">    2451 </span><span class="lineNoCov">          0 :                     else if ( cv-&gt;raster-&gt;num_greys&lt;=2 )</span>
<span class="lineNum">    2452 </span><span class="lineNoCov">          0 :                         r = cv-&gt;raster-&gt;bitmap[i*cv-&gt;raster-&gt;bytes_per_row+(j&gt;&gt;3)] &amp; (1&lt;&lt;(7-(j&amp;7)));</span>
<span class="lineNum">    2453 </span>            :                     else
<span class="lineNum">    2454 </span><span class="lineNoCov">          0 :                         r = cv-&gt;raster-&gt;bitmap[i*cv-&gt;raster-&gt;bytes_per_row+j];</span>
<span class="lineNum">    2455 </span><span class="lineNoCov">          0 :                     if ( cv-&gt;oldraster==NULL || cv-&gt;oldraster-&gt;num_greys!=cv-&gt;raster-&gt;num_greys)</span>
<span class="lineNum">    2456 </span><span class="lineNoCov">          0 :                         or = r;</span>
<span class="lineNum">    2457 </span>            :                     else {
<span class="lineNum">    2458 </span><span class="lineNoCov">          0 :                         i = cv-&gt;oldraster-&gt;as-ii; j = jj-cv-&gt;oldraster-&gt;lb;</span>
<span class="lineNum">    2459 </span><span class="lineNoCov">          0 :                         if ( i&lt;0 || i&gt;=cv-&gt;oldraster-&gt;rows || j&lt;0 || j&gt;=cv-&gt;oldraster-&gt;cols )</span>
<span class="lineNum">    2460 </span><span class="lineNoCov">          0 :                             or = 0;</span>
<span class="lineNum">    2461 </span><span class="lineNoCov">          0 :                         else if ( cv-&gt;oldraster-&gt;num_greys&lt;=2 )</span>
<span class="lineNum">    2462 </span><span class="lineNoCov">          0 :                             or = cv-&gt;oldraster-&gt;bitmap[i*cv-&gt;oldraster-&gt;bytes_per_row+(j&gt;&gt;3)] &amp; (1&lt;&lt;(7-(j&amp;7)));</span>
<span class="lineNum">    2463 </span>            :                         else
<span class="lineNum">    2464 </span><span class="lineNoCov">          0 :                             or = cv-&gt;oldraster-&gt;bitmap[i*cv-&gt;oldraster-&gt;bytes_per_row+j];</span>
<span class="lineNum">    2465 </span>            :                     }
<span class="lineNum">    2466 </span><span class="lineNoCov">          0 :                     if ( r || ( or &amp;&amp; cv-&gt;showdebugchanges)) {</span>
<span class="lineNum">    2467 </span><span class="lineNoCov">          0 :                         pixel.x = jj*xgrid_spacing*cv-&gt;scale + cv-&gt;xoff+1;</span>
<span class="lineNum">    2468 </span><span class="lineNoCov">          0 :                         pixel.y = cv-&gt;height-cv-&gt;yoff - rint(ii*ygrid_spacing*cv-&gt;scale);</span>
<span class="lineNum">    2469 </span><span class="lineNoCov">          0 :                         if ( cv-&gt;showdebugchanges ) {</span>
<span class="lineNum">    2470 </span><span class="lineNoCov">          0 :                             if ( cv-&gt;raster-&gt;num_greys&lt;=2 )</span>
<span class="lineNum">    2471 </span><span class="lineNoCov">          0 :                                 GDrawFillRect(pixmap,&amp;pixel,(r &amp;&amp; or) ? rastercol : r ? rasternewcol : rasteroldcol );</span>
<span class="lineNum">    2472 </span>            :                             else
<span class="lineNum">    2473 </span><span class="lineNoCov">          0 :                                 GDrawFillRect(pixmap,&amp;pixel,(r-or&gt;-16 &amp;&amp; r-or&lt;16) ? clut[r] : (clut[r]&amp;0x00ff00) );</span>
<span class="lineNum">    2474 </span>            :                         } else {
<span class="lineNum">    2475 </span><span class="lineNoCov">          0 :                             if ( cv-&gt;raster-&gt;num_greys&lt;=2 )</span>
<span class="lineNum">    2476 </span><span class="lineNoCov">          0 :                                 GDrawFillRect(pixmap,&amp;pixel, rastercol );</span>
<span class="lineNum">    2477 </span>            :                             else
<span class="lineNum">    2478 </span><span class="lineNoCov">          0 :                                 GDrawFillRect(pixmap,&amp;pixel, clut[r] );</span>
<span class="lineNum">    2479 </span>            :                         }
<span class="lineNum">    2480 </span>            :                     }
<span class="lineNum">    2481 </span>            :                 }
<span class="lineNum">    2482 </span>            :             }
<span class="lineNum">    2483 </span>            :         }
<span class="lineNum">    2484 </span>            : 
<span class="lineNum">    2485 </span><span class="lineNoCov">          0 :         for ( i = floor( clip-&gt;x/xgrid_spacing ), max = ceil((clip-&gt;x+clip-&gt;width)/xgrid_spacing);</span>
<span class="lineNum">    2486 </span><span class="lineNoCov">          0 :                 i&lt;=max; ++i )</span>
<span class="lineNum">    2487 </span><span class="lineNoCov">          0 :             DrawLine(cv,pixmap,i*xgrid_spacing,-32768,i*xgrid_spacing,32767,i==0?coordcol:rastergridcol);</span>
<span class="lineNum">    2488 </span><span class="lineNoCov">          0 :         for ( i = floor( clip-&gt;y/ygrid_spacing ), max = ceil((clip-&gt;y+clip-&gt;height)/ygrid_spacing);</span>
<span class="lineNum">    2489 </span><span class="lineNoCov">          0 :                 i&lt;=max; ++i )</span>
<span class="lineNum">    2490 </span><span class="lineNoCov">          0 :             DrawLine(cv,pixmap,-32768,i*ygrid_spacing,32767,i*ygrid_spacing,i==0?coordcol:rastergridcol);</span>
<span class="lineNum">    2491 </span><span class="lineNoCov">          0 :         if ( xgrid_spacing*cv-&gt;scale&gt;=7 &amp;&amp; ygrid_spacing*cv-&gt;scale&gt;=7) {</span>
<span class="lineNum">    2492 </span><span class="lineNoCov">          0 :             for ( i = floor( clip-&gt;x/xgrid_spacing ), max = ceil((clip-&gt;x+clip-&gt;width)/xgrid_spacing);</span>
<span class="lineNum">    2493 </span><span class="lineNoCov">          0 :                     i&lt;=max; ++i )</span>
<span class="lineNum">    2494 </span><span class="lineNoCov">          0 :                 for ( j = floor( clip-&gt;y/ygrid_spacing ), jmax = ceil((clip-&gt;y+clip-&gt;height)/ygrid_spacing);</span>
<span class="lineNum">    2495 </span><span class="lineNoCov">          0 :                         j&lt;=jmax; ++j ) {</span>
<span class="lineNum">    2496 </span><span class="lineNoCov">          0 :                     int x = (i+.5)*xgrid_spacing*cv-&gt;scale + cv-&gt;xoff;</span>
<span class="lineNum">    2497 </span><span class="lineNoCov">          0 :                     int y = cv-&gt;height-cv-&gt;yoff - rint((j+.5)*ygrid_spacing*cv-&gt;scale);</span>
<span class="lineNum">    2498 </span><span class="lineNoCov">          0 :                     GDrawDrawLine(pixmap,x-2,y,x+2,y,rastergridcol);</span>
<span class="lineNum">    2499 </span><span class="lineNoCov">          0 :                     GDrawDrawLine(pixmap,x,y-2,x,y+2,rastergridcol);</span>
<span class="lineNum">    2500 </span>            :                 }
<span class="lineNum">    2501 </span>            :         }
<span class="lineNum">    2502 </span><span class="lineNoCov">          0 :         if ( cv-&gt;qg!=NULL ) {</span>
<span class="lineNum">    2503 </span><span class="lineNoCov">          0 :             pixel.x = cv-&gt;note_x*xgrid_spacing*cv-&gt;scale + cv-&gt;xoff;</span>
<span class="lineNum">    2504 </span><span class="lineNoCov">          0 :             pixel.y = cv-&gt;height-cv-&gt;yoff - rint(cv-&gt;note_y*ygrid_spacing*cv-&gt;scale)</span>
<span class="lineNum">    2505 </span><span class="lineNoCov">          0 :                 - pixel.height;</span>
<span class="lineNum">    2506 </span><span class="lineNoCov">          0 :             if ( pixel.height&gt;=20 )</span>
<span class="lineNum">    2507 </span><span class="lineNoCov">          0 :                 GDrawSetLineWidth(pixmap,3);</span>
<span class="lineNum">    2508 </span><span class="lineNoCov">          0 :             else if ( pixel.height&gt;10 )</span>
<span class="lineNum">    2509 </span><span class="lineNoCov">          0 :                 GDrawSetLineWidth(pixmap,2);</span>
<span class="lineNum">    2510 </span><span class="lineNoCov">          0 :             GDrawDrawRect(pixmap,&amp;pixel,deltagridcol);</span>
<span class="lineNum">    2511 </span><span class="lineNoCov">          0 :             GDrawSetLineWidth(pixmap,0);</span>
<span class="lineNum">    2512 </span>            :             {
<span class="lineNum">    2513 </span><span class="lineNoCov">          0 :                 int x = (cv-&gt;note_x+.5)*xgrid_spacing*cv-&gt;scale + cv-&gt;xoff;</span>
<span class="lineNum">    2514 </span><span class="lineNoCov">          0 :                 int y = cv-&gt;height-cv-&gt;yoff - rint((cv-&gt;note_y+.5)*ygrid_spacing*cv-&gt;scale);</span>
<span class="lineNum">    2515 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,x-2,y,x+2,y,deltagridcol);</span>
<span class="lineNum">    2516 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,x,y-2,x,y+2,deltagridcol);</span>
<span class="lineNum">    2517 </span>            :             }
<span class="lineNum">    2518 </span>            :         }
<span class="lineNum">    2519 </span>            :     }
<span class="lineNum">    2520 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showback[0]&amp;1 ) {</span>
<span class="lineNum">    2521 </span><span class="lineNoCov">          0 :         CVDrawSplineSet(cv,pixmap,cv-&gt;b.gridfit,gridfitoutlinecol,</span>
<span class="lineNum">    2522 </span><span class="lineNoCov">          0 :                 cv-&gt;showpoints,clip);</span>
<span class="lineNum">    2523 </span>            :     }
<a name="2524"><span class="lineNum">    2524 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2525 </span>            : 
<span class="lineNum">    2526 </span><span class="lineNoCov">          0 : static int APinSC(AnchorPoint *ap,SplineChar *sc) {</span>
<span class="lineNum">    2527 </span>            :     /* Anchor points can be deleted ... */
<span class="lineNum">    2528 </span>            :     AnchorPoint *test;
<span class="lineNum">    2529 </span>            : 
<span class="lineNum">    2530 </span><span class="lineNoCov">          0 :     for ( test=sc-&gt;anchor; test!=NULL &amp;&amp; test!=ap; test = test-&gt;next );</span>
<span class="lineNum">    2531 </span><span class="lineNoCov">          0 : return( test==ap );</span>
<a name="2532"><span class="lineNum">    2532 </span>            : }</a>
<span class="lineNum">    2533 </span>            : 
<span class="lineNum">    2534 </span><span class="lineNoCov">          0 : static void DrawAPMatch(CharView *cv,GWindow pixmap,DRect *clip) {</span>
<span class="lineNum">    2535 </span><span class="lineNoCov">          0 :     SplineChar *sc = cv-&gt;b.sc, *apsc = cv-&gt;apsc;</span>
<span class="lineNum">    2536 </span><span class="lineNoCov">          0 :     SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">    2537 </span>            :     real trans[6];
<span class="lineNum">    2538 </span>            :     SplineSet *head, *tail, *temp;
<span class="lineNum">    2539 </span>            :     RefChar *ref;
<span class="lineNum">    2540 </span><span class="lineNoCov">          0 :     int layer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    2541 </span>            : 
<span class="lineNum">    2542 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.drawmode==dm_grid )</span>
<span class="lineNum">    2543 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2544 </span>            : 
<span class="lineNum">    2545 </span>            :     /* The other glyph might have been removed from the font */
<span class="lineNum">    2546 </span>            :     /* Either anchor might have been deleted. Be prepared for that to happen */
<span class="lineNum">    2547 </span><span class="lineNoCov">          0 :     if ( (apsc-&gt;orig_pos&gt;=sf-&gt;glyphcnt || apsc-&gt;orig_pos&lt;0) ||</span>
<span class="lineNum">    2548 </span><span class="lineNoCov">          0 :             sf-&gt;glyphs[apsc-&gt;orig_pos]!=apsc ||</span>
<span class="lineNum">    2549 </span><span class="lineNoCov">          0 :             !APinSC(cv-&gt;apmine,sc) || !APinSC(cv-&gt;apmatch,apsc)) {</span>
<span class="lineNum">    2550 </span><span class="lineNoCov">          0 :         cv-&gt;apmine = cv-&gt;apmatch = NULL;</span>
<span class="lineNum">    2551 </span><span class="lineNoCov">          0 :         cv-&gt;apsc =NULL;</span>
<span class="lineNum">    2552 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2553 </span>            :     }
<span class="lineNum">    2554 </span>            : 
<span class="lineNum">    2555 </span>            :     /* Ok this isn't very accurate, but we are going to use the current glyph's*/
<span class="lineNum">    2556 </span>            :     /*  coordinate system (because we're showing the current glyph), we should */
<span class="lineNum">    2557 </span>            :     /*  always use the base character's coordinates, but that would screw up   */
<span class="lineNum">    2558 </span>            :     /*  editing of the current glyph if it happened to be the mark */
<span class="lineNum">    2559 </span><span class="lineNoCov">          0 :     trans[0] = trans[3] = 1;</span>
<span class="lineNum">    2560 </span><span class="lineNoCov">          0 :     trans[1] = trans[2] = 0;</span>
<span class="lineNum">    2561 </span><span class="lineNoCov">          0 :     trans[4] = cv-&gt;apmine-&gt;me.x - cv-&gt;apmatch-&gt;me.x;</span>
<span class="lineNum">    2562 </span><span class="lineNoCov">          0 :     trans[5] = cv-&gt;apmine-&gt;me.y - cv-&gt;apmatch-&gt;me.y;</span>
<span class="lineNum">    2563 </span>            : 
<span class="lineNum">    2564 </span><span class="lineNoCov">          0 :     head = tail = SplinePointListCopy(apsc-&gt;layers[layer].splines);</span>
<span class="lineNum">    2565 </span><span class="lineNoCov">          0 :     for ( ref = apsc-&gt;layers[layer].refs; ref!=NULL; ref = ref-&gt;next ) {</span>
<span class="lineNum">    2566 </span><span class="lineNoCov">          0 :         temp = SplinePointListCopy(ref-&gt;layers[0].splines);</span>
<span class="lineNum">    2567 </span><span class="lineNoCov">          0 :         if ( head!=NULL ) {</span>
<span class="lineNum">    2568 </span><span class="lineNoCov">          0 :             for ( ; tail-&gt;next!=NULL; tail = tail-&gt;next );</span>
<span class="lineNum">    2569 </span><span class="lineNoCov">          0 :             tail-&gt;next = temp;</span>
<span class="lineNum">    2570 </span>            :         } else
<span class="lineNum">    2571 </span><span class="lineNoCov">          0 :             head = tail = temp;</span>
<span class="lineNum">    2572 </span>            :     }
<span class="lineNum">    2573 </span><span class="lineNoCov">          0 :     head = SplinePointListTransform(head,trans,tpt_AllPoints);</span>
<span class="lineNum">    2574 </span><span class="lineNoCov">          0 :     CVDrawSplineSet(cv,pixmap,head,anchoredoutlinecol,</span>
<span class="lineNum">    2575 </span>            :             false,clip);
<span class="lineNum">    2576 </span><span class="lineNoCov">          0 :     SplinePointListsFree(head);</span>
<span class="lineNum">    2577 </span><span class="lineNoCov">          0 :     if ( cv-&gt;apmine-&gt;type==at_mark || cv-&gt;apmine-&gt;type==at_centry ) {</span>
<span class="lineNum">    2578 </span><span class="lineNoCov">          0 :         DrawVLine(cv,pixmap,trans[4],anchoredoutlinecol,false,NULL,NULL);</span>
<span class="lineNum">    2579 </span><span class="lineNoCov">          0 :         DrawLine(cv,pixmap,-8096,trans[5],8096,trans[5],anchoredoutlinecol);</span>
<span class="lineNum">    2580 </span>            :     }
<a name="2581"><span class="lineNum">    2581 </span>            : }</a>
<span class="lineNum">    2582 </span>            : 
<span class="lineNum">    2583 </span><span class="lineNoCov">          0 : static void DrawPLine(CharView *cv,GWindow pixmap,int x1, int y1, int x2, int y2,Color col) {</span>
<span class="lineNum">    2584 </span>            : 
<span class="lineNum">    2585 </span><span class="lineNoCov">          0 :     if ( x1==x2 || y1==y2 ) {</span>
<span class="lineNum">    2586 </span><span class="lineNoCov">          0 :         if ( x1&lt;0 ) x1=0;</span>
<span class="lineNum">    2587 </span><span class="lineNoCov">          0 :         else if ( x1&gt;cv-&gt;width ) x1 = cv-&gt;width;</span>
<span class="lineNum">    2588 </span><span class="lineNoCov">          0 :         if ( x2&lt;0 ) x2=0;</span>
<span class="lineNum">    2589 </span><span class="lineNoCov">          0 :         else if ( x2&gt;cv-&gt;width ) x2 = cv-&gt;width;</span>
<span class="lineNum">    2590 </span><span class="lineNoCov">          0 :         if ( y1&lt;0 ) y1=0;</span>
<span class="lineNum">    2591 </span><span class="lineNoCov">          0 :         else if ( y1&gt;cv-&gt;height ) y1 = cv-&gt;height;</span>
<span class="lineNum">    2592 </span><span class="lineNoCov">          0 :         if ( y2&lt;0 ) y2=0;</span>
<span class="lineNum">    2593 </span><span class="lineNoCov">          0 :         else if ( y2&gt;cv-&gt;height ) y2 = cv-&gt;height;</span>
<span class="lineNum">    2594 </span><span class="lineNoCov">          0 :     } else if ( y1&lt;-1000 || y2&lt;-1000 || x1&lt;-1000 || x2&lt;-1000 ||</span>
<span class="lineNum">    2595 </span><span class="lineNoCov">          0 :             y1&gt;cv-&gt;height+1000 || y2&gt;cv-&gt;height+1000 ||</span>
<span class="lineNum">    2596 </span><span class="lineNoCov">          0 :             x1&gt;cv-&gt;width+1000 || x2&gt;cv-&gt;width+1000 )</span>
<span class="lineNum">    2597 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2598 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap,x1,y1,x2,y2,col);</span>
<a name="2599"><span class="lineNum">    2599 </span>            : }</a>
<span class="lineNum">    2600 </span>            : 
<span class="lineNum">    2601 </span><span class="lineNoCov">          0 : static void FindQuickBounds(SplineSet *ss,BasePoint **bounds) {</span>
<span class="lineNum">    2602 </span>            :     SplinePoint *sp;
<span class="lineNum">    2603 </span>            : 
<span class="lineNum">    2604 </span><span class="lineNoCov">          0 :     for ( ; ss!=NULL; ss=ss-&gt;next ) {</span>
<span class="lineNum">    2605 </span><span class="lineNoCov">          0 :         sp = ss-&gt;first;</span>
<span class="lineNum">    2606 </span><span class="lineNoCov">          0 :         if ( sp-&gt;next==NULL || sp-&gt;next-&gt;to==sp )      /* Ignore contours with one point. Often tt points for moving references or anchors */</span>
<span class="lineNum">    2607 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    2608 </span>            :         for (;;) {
<span class="lineNum">    2609 </span><span class="lineNoCov">          0 :             if ( bounds[0]==NULL )</span>
<span class="lineNum">    2610 </span><span class="lineNoCov">          0 :                 bounds[0] = bounds[1] = bounds[2] = bounds[3] = &amp;sp-&gt;me;</span>
<span class="lineNum">    2611 </span>            :             else {
<span class="lineNum">    2612 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;me.x&lt;bounds[0]-&gt;x ) bounds[0] = &amp;sp-&gt;me;</span>
<span class="lineNum">    2613 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;me.x&gt;bounds[1]-&gt;x ) bounds[1] = &amp;sp-&gt;me;</span>
<span class="lineNum">    2614 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;me.y&lt;bounds[2]-&gt;y ) bounds[2] = &amp;sp-&gt;me;</span>
<span class="lineNum">    2615 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;me.y&gt;bounds[3]-&gt;y ) bounds[3] = &amp;sp-&gt;me;</span>
<span class="lineNum">    2616 </span>            :             }
<span class="lineNum">    2617 </span><span class="lineNoCov">          0 :             if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    2618 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2619 </span><span class="lineNoCov">          0 :             sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    2620 </span><span class="lineNoCov">          0 :             if ( sp==ss-&gt;first )</span>
<span class="lineNum">    2621 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2622 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2623 </span>            :     }
<a name="2624"><span class="lineNum">    2624 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2625 </span>            : 
<span class="lineNum">    2626 </span><span class="lineNoCov">          0 : static void SSFindItalicBounds(SplineSet *ss,double t,SplinePoint **left, SplinePoint **right) {</span>
<span class="lineNum">    2627 </span>            :     SplinePoint *sp;
<span class="lineNum">    2628 </span>            : 
<span class="lineNum">    2629 </span><span class="lineNoCov">          0 :     if ( t==0 )</span>
<span class="lineNum">    2630 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2631 </span>            : 
<span class="lineNum">    2632 </span><span class="lineNoCov">          0 :     for ( ; ss!=NULL; ss=ss-&gt;next ) {</span>
<span class="lineNum">    2633 </span><span class="lineNoCov">          0 :         sp = ss-&gt;first;</span>
<span class="lineNum">    2634 </span><span class="lineNoCov">          0 :         if ( sp-&gt;next==NULL || sp-&gt;next-&gt;to==sp )      /* Ignore contours with one point. Often tt points for moving references or anchors */</span>
<span class="lineNum">    2635 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    2636 </span>            :         for (;;) {
<span class="lineNum">    2637 </span><span class="lineNoCov">          0 :             if ( *left==NULL )</span>
<span class="lineNum">    2638 </span><span class="lineNoCov">          0 :                 *left = *right = sp;</span>
<span class="lineNum">    2639 </span>            :             else {
<span class="lineNum">    2640 </span><span class="lineNoCov">          0 :                 double xoff = sp-&gt;me.y*t;</span>
<span class="lineNum">    2641 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;me.x-xoff &lt; (*left)-&gt;me.x - (*left)-&gt;me.y*t ) *left = sp;</span>
<span class="lineNum">    2642 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;me.x-xoff &gt; (*right)-&gt;me.x - (*right)-&gt;me.y*t ) *right = sp;</span>
<span class="lineNum">    2643 </span>            :             }
<span class="lineNum">    2644 </span><span class="lineNoCov">          0 :             if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    2645 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2646 </span><span class="lineNoCov">          0 :             sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    2647 </span><span class="lineNoCov">          0 :             if ( sp==ss-&gt;first )</span>
<span class="lineNum">    2648 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2649 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2650 </span>            :     }
<a name="2651"><span class="lineNum">    2651 </span>            : }</a>
<span class="lineNum">    2652 </span>            : 
<span class="lineNum">    2653 </span><span class="lineNoCov">          0 : static void CVSideBearings(GWindow pixmap, CharView *cv) {</span>
<span class="lineNum">    2654 </span><span class="lineNoCov">          0 :     SplineChar *sc = cv-&gt;b.sc;</span>
<span class="lineNum">    2655 </span>            :     RefChar *ref;
<span class="lineNum">    2656 </span>            :     BasePoint *bounds[4];
<span class="lineNum">    2657 </span>            :     int layer,last, first,l;
<span class="lineNum">    2658 </span>            :     int x,y, x2, y2;
<span class="lineNum">    2659 </span>            :     char buf[20];
<span class="lineNum">    2660 </span>            : 
<span class="lineNum">    2661 </span><span class="lineNoCov">          0 :     memset(bounds,0,sizeof(bounds));</span>
<span class="lineNum">    2662 </span><span class="lineNoCov">          0 :     if ( sc-&gt;parent-&gt;multilayer ) {</span>
<span class="lineNum">    2663 </span><span class="lineNoCov">          0 :         last = sc-&gt;layer_cnt-1;</span>
<span class="lineNum">    2664 </span><span class="lineNoCov">          0 :         first = ly_fore;</span>
<span class="lineNum">    2665 </span>            :     } else {
<span class="lineNum">    2666 </span><span class="lineNoCov">          0 :         first = last = CVLayer( (CharViewBase *) cv);</span>
<span class="lineNum">    2667 </span><span class="lineNoCov">          0 :         if ( first==ly_grid )</span>
<span class="lineNum">    2668 </span><span class="lineNoCov">          0 :             first = last = ly_fore;</span>
<span class="lineNum">    2669 </span>            :     }
<span class="lineNum">    2670 </span><span class="lineNoCov">          0 :     for ( layer = first ; layer&lt;=last; ++layer ) {</span>
<span class="lineNum">    2671 </span><span class="lineNoCov">          0 :         FindQuickBounds(sc-&gt;layers[layer].splines,bounds);</span>
<span class="lineNum">    2672 </span><span class="lineNoCov">          0 :         for ( ref=sc-&gt;layers[layer].refs; ref!=NULL; ref=ref-&gt;next )</span>
<span class="lineNum">    2673 </span><span class="lineNoCov">          0 :             for ( l=0; l&lt;ref-&gt;layer_cnt; ++l )</span>
<span class="lineNum">    2674 </span><span class="lineNoCov">          0 :                 FindQuickBounds(ref-&gt;layers[l].splines,bounds);</span>
<span class="lineNum">    2675 </span>            :     }
<span class="lineNum">    2676 </span>            : 
<span class="lineNum">    2677 </span><span class="lineNoCov">          0 :     if ( bounds[0]==NULL )</span>
<span class="lineNum">    2678 </span><span class="lineNoCov">          0 : return;                         /* no points. no side bearings */</span>
<span class="lineNum">    2679 </span>            : 
<span class="lineNum">    2680 </span><span class="lineNoCov">          0 :     GDrawSetFont(pixmap,cv-&gt;small);</span>
<span class="lineNum">    2681 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showhmetrics ) {</span>
<span class="lineNum">    2682 </span><span class="lineNoCov">          0 :         if ( bounds[0]-&gt;x!=0 ) {</span>
<span class="lineNum">    2683 </span><span class="lineNoCov">          0 :             x = rint(bounds[0]-&gt;x*cv-&gt;scale) + cv-&gt;xoff;</span>
<span class="lineNum">    2684 </span><span class="lineNoCov">          0 :             y = cv-&gt;height-cv-&gt;yoff-rint(bounds[0]-&gt;y*cv-&gt;scale);</span>
<span class="lineNum">    2685 </span><span class="lineNoCov">          0 :             DrawPLine(cv,pixmap,cv-&gt;xoff,y,x,y,metricslabelcol);</span>
<span class="lineNum">    2686 </span>            :              /* arrow heads */
<span class="lineNum">    2687 </span><span class="lineNoCov">          0 :              DrawPLine(cv,pixmap,cv-&gt;xoff,y,cv-&gt;xoff+4,y+4,metricslabelcol);</span>
<span class="lineNum">    2688 </span><span class="lineNoCov">          0 :              DrawPLine(cv,pixmap,cv-&gt;xoff,y,cv-&gt;xoff+4,y-4,metricslabelcol);</span>
<span class="lineNum">    2689 </span><span class="lineNoCov">          0 :              DrawPLine(cv,pixmap,x,y,x-4,y-4,metricslabelcol);</span>
<span class="lineNum">    2690 </span><span class="lineNoCov">          0 :              DrawPLine(cv,pixmap,x,y,x-4,y+4,metricslabelcol);</span>
<span class="lineNum">    2691 </span><span class="lineNoCov">          0 :             dtos( buf, bounds[0]-&gt;x);</span>
<span class="lineNum">    2692 </span><span class="lineNoCov">          0 :             x = cv-&gt;xoff + (x-cv-&gt;xoff-GDrawGetText8Width(pixmap,buf,-1))/2;</span>
<span class="lineNum">    2693 </span><span class="lineNoCov">          0 :             GDrawDrawText8(pixmap,x,y-4,buf,-1,metricslabelcol);</span>
<span class="lineNum">    2694 </span>            :         }
<span class="lineNum">    2695 </span>            : 
<span class="lineNum">    2696 </span><span class="lineNoCov">          0 :         if ( sc-&gt;width != bounds[1]-&gt;x ) {</span>
<span class="lineNum">    2697 </span><span class="lineNoCov">          0 :             x = rint(bounds[1]-&gt;x*cv-&gt;scale) + cv-&gt;xoff;</span>
<span class="lineNum">    2698 </span><span class="lineNoCov">          0 :             y = cv-&gt;height-cv-&gt;yoff-rint(bounds[1]-&gt;y*cv-&gt;scale);</span>
<span class="lineNum">    2699 </span><span class="lineNoCov">          0 :             x2 = rint(sc-&gt;width*cv-&gt;scale) + cv-&gt;xoff;</span>
<span class="lineNum">    2700 </span><span class="lineNoCov">          0 :             DrawPLine(cv,pixmap,x,y,x2,y,metricslabelcol);</span>
<span class="lineNum">    2701 </span>            :              /* arrow heads */
<span class="lineNum">    2702 </span><span class="lineNoCov">          0 :              DrawPLine(cv,pixmap,x,y,x+4,y+4,metricslabelcol);</span>
<span class="lineNum">    2703 </span><span class="lineNoCov">          0 :              DrawPLine(cv,pixmap,x,y,x+4,y-4,metricslabelcol);</span>
<span class="lineNum">    2704 </span><span class="lineNoCov">          0 :              DrawPLine(cv,pixmap,x2,y,x2-4,y-4,metricslabelcol);</span>
<span class="lineNum">    2705 </span><span class="lineNoCov">          0 :              DrawPLine(cv,pixmap,x2,y,x2-4,y+4,metricslabelcol);</span>
<span class="lineNum">    2706 </span><span class="lineNoCov">          0 :             dtos( buf, sc-&gt;width-bounds[1]-&gt;x);</span>
<span class="lineNum">    2707 </span><span class="lineNoCov">          0 :             x = x + (x2-x-GDrawGetText8Width(pixmap,buf,-1))/2;</span>
<span class="lineNum">    2708 </span><span class="lineNoCov">          0 :             GDrawDrawText8(pixmap,x,y-4,buf,-1,metricslabelcol);</span>
<span class="lineNum">    2709 </span>            :         }
<span class="lineNum">    2710 </span><span class="lineNoCov">          0 :         if ( ItalicConstrained &amp;&amp; cv-&gt;b.sc-&gt;parent-&gt;italicangle!=0 ) {</span>
<span class="lineNum">    2711 </span><span class="lineNoCov">          0 :             double t = tan(-cv-&gt;b.sc-&gt;parent-&gt;italicangle*3.1415926535897932/180.);</span>
<span class="lineNum">    2712 </span><span class="lineNoCov">          0 :             if ( t!=0 ) {</span>
<span class="lineNum">    2713 </span><span class="lineNoCov">          0 :                 SplinePoint *leftmost=NULL, *rightmost=NULL;</span>
<span class="lineNum">    2714 </span><span class="lineNoCov">          0 :                 for ( layer=first; layer&lt;=last; ++layer ) {</span>
<span class="lineNum">    2715 </span><span class="lineNoCov">          0 :                     SSFindItalicBounds(sc-&gt;layers[layer].splines,t,&amp;leftmost,&amp;rightmost);</span>
<span class="lineNum">    2716 </span><span class="lineNoCov">          0 :                     for ( ref=sc-&gt;layers[layer].refs; ref!=NULL; ref=ref-&gt;next )</span>
<span class="lineNum">    2717 </span><span class="lineNoCov">          0 :                         for ( l=0; l&lt;ref-&gt;layer_cnt; ++l )</span>
<span class="lineNum">    2718 </span><span class="lineNoCov">          0 :                             SSFindItalicBounds(ref-&gt;layers[l].splines,t,&amp;leftmost,&amp;rightmost);</span>
<span class="lineNum">    2719 </span>            :                 }
<span class="lineNum">    2720 </span><span class="lineNoCov">          0 :                 if ( leftmost!=NULL ) {</span>
<span class="lineNum">    2721 </span><span class="lineNoCov">          0 :                     x = rint(leftmost-&gt;me.y*t*cv-&gt;scale) + cv-&gt;xoff;</span>
<span class="lineNum">    2722 </span><span class="lineNoCov">          0 :                     x2 = rint(leftmost-&gt;me.x*cv-&gt;scale) + cv-&gt;xoff;</span>
<span class="lineNum">    2723 </span><span class="lineNoCov">          0 :                     y = cv-&gt;height-cv-&gt;yoff-rint(leftmost-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    2724 </span><span class="lineNoCov">          0 :                     DrawPLine(cv,pixmap,x,y,x2,y,italiccoordcol);</span>
<span class="lineNum">    2725 </span>            :                      /* arrow heads */
<span class="lineNum">    2726 </span><span class="lineNoCov">          0 :                      DrawPLine(cv,pixmap,x,y,x+4,y+4,italiccoordcol);</span>
<span class="lineNum">    2727 </span><span class="lineNoCov">          0 :                      DrawPLine(cv,pixmap,x,y,x+4,y-4,italiccoordcol);</span>
<span class="lineNum">    2728 </span><span class="lineNoCov">          0 :                      DrawPLine(cv,pixmap,x2,y,x2-4,y-4,italiccoordcol);</span>
<span class="lineNum">    2729 </span><span class="lineNoCov">          0 :                      DrawPLine(cv,pixmap,x2,y,x2-4,y+4,italiccoordcol);</span>
<span class="lineNum">    2730 </span><span class="lineNoCov">          0 :                     dtos( buf, leftmost-&gt;me.x-leftmost-&gt;me.y*t);</span>
<span class="lineNum">    2731 </span><span class="lineNoCov">          0 :                     x = x + (x2-x-GDrawGetText8Width(pixmap,buf,-1))/2;</span>
<span class="lineNum">    2732 </span><span class="lineNoCov">          0 :                     GDrawDrawText8(pixmap,x,y+12,buf,-1,italiccoordcol);</span>
<span class="lineNum">    2733 </span>            :                 }
<span class="lineNum">    2734 </span><span class="lineNoCov">          0 :                 if ( rightmost!=NULL ) {</span>
<span class="lineNum">    2735 </span><span class="lineNoCov">          0 :                     x = rint(rightmost-&gt;me.x*cv-&gt;scale) + cv-&gt;xoff;</span>
<span class="lineNum">    2736 </span><span class="lineNoCov">          0 :                     y = cv-&gt;height-cv-&gt;yoff-rint(rightmost-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    2737 </span><span class="lineNoCov">          0 :                     x2 = rint((sc-&gt;width + rightmost-&gt;me.y*t)*cv-&gt;scale) + cv-&gt;xoff;</span>
<span class="lineNum">    2738 </span><span class="lineNoCov">          0 :                     DrawPLine(cv,pixmap,x,y,x2,y,italiccoordcol);</span>
<span class="lineNum">    2739 </span>            :                      /* arrow heads */
<span class="lineNum">    2740 </span><span class="lineNoCov">          0 :                      DrawPLine(cv,pixmap,x,y,x+4,y+4,italiccoordcol);</span>
<span class="lineNum">    2741 </span><span class="lineNoCov">          0 :                      DrawPLine(cv,pixmap,x,y,x+4,y-4,italiccoordcol);</span>
<span class="lineNum">    2742 </span><span class="lineNoCov">          0 :                      DrawPLine(cv,pixmap,x2,y,x2-4,y-4,italiccoordcol);</span>
<span class="lineNum">    2743 </span><span class="lineNoCov">          0 :                      DrawPLine(cv,pixmap,x2,y,x2-4,y+4,italiccoordcol);</span>
<span class="lineNum">    2744 </span><span class="lineNoCov">          0 :                     dtos( buf, sc-&gt;width+rightmost-&gt;me.y*t-rightmost-&gt;me.x);</span>
<span class="lineNum">    2745 </span><span class="lineNoCov">          0 :                     x = x + (x2-x-GDrawGetText8Width(pixmap,buf,-1))/2;</span>
<span class="lineNum">    2746 </span><span class="lineNoCov">          0 :                     GDrawDrawText8(pixmap,x,y+12,buf,-1,italiccoordcol);</span>
<span class="lineNum">    2747 </span>            :                 }
<span class="lineNum">    2748 </span>            :             }
<span class="lineNum">    2749 </span>            :         }
<span class="lineNum">    2750 </span>            :     }
<span class="lineNum">    2751 </span>            : 
<span class="lineNum">    2752 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showvmetrics ) {</span>
<span class="lineNum">    2753 </span><span class="lineNoCov">          0 :         x = rint(bounds[2]-&gt;x*cv-&gt;scale) + cv-&gt;xoff;</span>
<span class="lineNum">    2754 </span><span class="lineNoCov">          0 :         y = cv-&gt;height-cv-&gt;yoff-rint(bounds[2]-&gt;y*cv-&gt;scale);</span>
<span class="lineNum">    2755 </span><span class="lineNoCov">          0 :         y2 = cv-&gt;height-cv-&gt;yoff-rint(-sc-&gt;parent-&gt;descent*cv-&gt;scale);</span>
<span class="lineNum">    2756 </span><span class="lineNoCov">          0 :         DrawPLine(cv,pixmap,x,y,x,y2,metricslabelcol);</span>
<span class="lineNum">    2757 </span>            :          /* arrow heads */
<span class="lineNum">    2758 </span><span class="lineNoCov">          0 :          DrawPLine(cv,pixmap,x,y,x-4,y-4,metricslabelcol);</span>
<span class="lineNum">    2759 </span><span class="lineNoCov">          0 :          DrawPLine(cv,pixmap,x,y,x+4,y-4,metricslabelcol);</span>
<span class="lineNum">    2760 </span><span class="lineNoCov">          0 :          DrawPLine(cv,pixmap,x,y2,x+4,y2+4,metricslabelcol);</span>
<span class="lineNum">    2761 </span><span class="lineNoCov">          0 :          DrawPLine(cv,pixmap,x,y2,x-4,y2+4,metricslabelcol);</span>
<span class="lineNum">    2762 </span><span class="lineNoCov">          0 :         dtos( buf, bounds[2]-&gt;y-sc-&gt;parent-&gt;descent);</span>
<span class="lineNum">    2763 </span><span class="lineNoCov">          0 :         y = y + (y-y2-cv-&gt;sfh)/2;</span>
<span class="lineNum">    2764 </span><span class="lineNoCov">          0 :         GDrawDrawText8(pixmap,x+4,y,buf,-1,metricslabelcol);</span>
<span class="lineNum">    2765 </span>            : 
<span class="lineNum">    2766 </span><span class="lineNoCov">          0 :         x = rint(bounds[3]-&gt;x*cv-&gt;scale) + cv-&gt;xoff;</span>
<span class="lineNum">    2767 </span><span class="lineNoCov">          0 :         y = cv-&gt;height-cv-&gt;yoff-rint(bounds[3]-&gt;y*cv-&gt;scale);</span>
<span class="lineNum">    2768 </span><span class="lineNoCov">          0 :         y2 = cv-&gt;height-cv-&gt;yoff-rint(sc-&gt;parent-&gt;ascent*cv-&gt;scale);</span>
<span class="lineNum">    2769 </span><span class="lineNoCov">          0 :         DrawPLine(cv,pixmap,x,y,x,y2,metricslabelcol);</span>
<span class="lineNum">    2770 </span>            :          /* arrow heads */
<span class="lineNum">    2771 </span><span class="lineNoCov">          0 :          DrawPLine(cv,pixmap,x,y,x-4,y-4,metricslabelcol);</span>
<span class="lineNum">    2772 </span><span class="lineNoCov">          0 :          DrawPLine(cv,pixmap,x,y,x+4,y-4,metricslabelcol);</span>
<span class="lineNum">    2773 </span><span class="lineNoCov">          0 :          DrawPLine(cv,pixmap,x,y2,x+4,y2+4,metricslabelcol);</span>
<span class="lineNum">    2774 </span><span class="lineNoCov">          0 :          DrawPLine(cv,pixmap,x,y2,x-4,y2+4,metricslabelcol);</span>
<span class="lineNum">    2775 </span><span class="lineNoCov">          0 :         dtos( buf, sc-&gt;vwidth-bounds[3]-&gt;y);</span>
<span class="lineNum">    2776 </span><span class="lineNoCov">          0 :         x = x + (x2-x-GDrawGetText8Width(pixmap,buf,-1))/2;</span>
<span class="lineNum">    2777 </span><span class="lineNoCov">          0 :         GDrawDrawText8(pixmap,x,y-4,buf,-1,metricslabelcol);</span>
<span class="lineNum">    2778 </span>            :     }
<a name="2779"><span class="lineNum">    2779 </span>            : }</a>
<span class="lineNum">    2780 </span>            : 
<span class="lineNum">    2781 </span><span class="lineNoCov">          0 : static int CVExposeGlyphFill(CharView *cv, GWindow pixmap, GEvent *event, DRect* clip ) {</span>
<span class="lineNum">    2782 </span><span class="lineNoCov">          0 :     int layer, cvlayer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    2783 </span><span class="lineNoCov">          0 :     int filled = 0;</span>
<span class="lineNum">    2784 </span>            : 
<span class="lineNum">    2785 </span><span class="lineNoCov">          0 :     if( shouldShowFilledUsingCairo(cv) ) {</span>
<span class="lineNum">    2786 </span><span class="lineNoCov">          0 :         layer = cvlayer;</span>
<span class="lineNum">    2787 </span><span class="lineNoCov">          0 :         if ( layer&gt;=0 ) {</span>
<span class="lineNum">    2788 </span><span class="lineNoCov">          0 :             CVDrawLayerSplineSet(cv,pixmap,&amp;cv-&gt;b.sc-&gt;layers[layer],foreoutlinecol,</span>
<span class="lineNum">    2789 </span><span class="lineNoCov">          0 :                                  cv-&gt;showpoints, clip, sfm_fill );</span>
<span class="lineNum">    2790 </span><span class="lineNoCov">          0 :             filled = 1;</span>
<span class="lineNum">    2791 </span>            :         }
<span class="lineNum">    2792 </span>            :     } else {
<span class="lineNum">    2793 </span><span class="lineNoCov">          0 :         if (( cv-&gt;showfore || cv-&gt;b.drawmode==dm_fore ) &amp;&amp; cv-&gt;showfilled &amp;&amp; </span>
<span class="lineNum">    2794 </span><span class="lineNoCov">          0 :             cv-&gt;filled!=NULL ) {</span>
<span class="lineNum">    2795 </span><span class="lineNoCov">          0 :             GDrawDrawImage(pixmap, &amp;cv-&gt;gi, NULL,</span>
<span class="lineNum">    2796 </span><span class="lineNoCov">          0 :                            cv-&gt;xoff + cv-&gt;filled-&gt;xmin,</span>
<span class="lineNum">    2797 </span><span class="lineNoCov">          0 :                            -cv-&gt;yoff + cv-&gt;height-cv-&gt;filled-&gt;ymax);</span>
<span class="lineNum">    2798 </span><span class="lineNoCov">          0 :             filled = 1;</span>
<span class="lineNum">    2799 </span>            :         }
<span class="lineNum">    2800 </span>            :     }
<span class="lineNum">    2801 </span><span class="lineNoCov">          0 :     return(filled);</span>
<span class="lineNum">    2802 </span>            : }
<span class="lineNum">    2803 </span>            : 
<span class="lineNum">    2804 </span>            : struct CVExpose_PreTransformSPL_ud
<span class="lineNum">    2805 </span>            : {
<span class="lineNum">    2806 </span>            :     int dopoints;
<span class="lineNum">    2807 </span>            :     CharView *cv;
<span class="lineNum">    2808 </span>            :     GWindow pixmap;
<span class="lineNum">    2809 </span>            :     Color fg;
<span class="lineNum">    2810 </span>            :     DRect* clip;
<span class="lineNum">    2811 </span>            :     enum outlinesfm_flags strokeFillMode;
<span class="lineNum">    2812 </span>            : };
<a name="2813"><span class="lineNum">    2813 </span>            : </a>
<span class="lineNum">    2814 </span>            : 
<span class="lineNum">    2815 </span><span class="lineNoCov">          0 : static void CVExpose_PreTransformSPL_fe( SplinePointList *spl, struct CVExpose_PreTransformSPL_ud* d )</span>
<span class="lineNum">    2816 </span>            : {
<span class="lineNum">    2817 </span><span class="lineNoCov">          0 :     CVDrawSplineSetSpecialized( d-&gt;cv, d-&gt;pixmap, spl,</span>
<span class="lineNum">    2818 </span>            :                                 d-&gt;fg, d-&gt;dopoints, d-&gt;clip, d-&gt;strokeFillMode,
<span class="lineNum">    2819 </span>            :                                 DraggingComparisonAlphaChannelOverride );
<a name="2820"><span class="lineNum">    2820 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2821 </span>            : 
<span class="lineNum">    2822 </span><span class="lineNoCov">          0 : static void CVExposeReferences( CharView *cv, GWindow pixmap, SplineChar* sc, int layer, DRect* clip )</span>
<span class="lineNum">    2823 </span>            : {
<span class="lineNum">    2824 </span><span class="lineNoCov">          0 :     RefChar *rf = 0;</span>
<span class="lineNum">    2825 </span><span class="lineNoCov">          0 :     int rlayer = 0;</span>
<span class="lineNum">    2826 </span>            :     
<span class="lineNum">    2827 </span><span class="lineNoCov">          0 :     for ( rf = sc-&gt;layers[layer].refs; rf!=NULL; rf = rf-&gt;next )</span>
<span class="lineNum">    2828 </span>            :     {
<span class="lineNum">    2829 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showrefnames )</span>
<span class="lineNum">    2830 </span><span class="lineNoCov">          0 :             CVDrawRefName(cv,pixmap,rf,0);</span>
<span class="lineNum">    2831 </span><span class="lineNoCov">          0 :         enum outlinesfm_flags refsfm = sfm_stroke;</span>
<span class="lineNum">    2832 </span><span class="lineNoCov">          0 :         if( shouldShowFilledUsingCairo(cv) ) {</span>
<span class="lineNum">    2833 </span><span class="lineNoCov">          0 :             refsfm = sfm_fill;</span>
<span class="lineNum">    2834 </span>            :         }
<span class="lineNum">    2835 </span>            : 
<span class="lineNum">    2836 </span><span class="lineNoCov">          0 :         for ( rlayer=0; rlayer&lt;rf-&gt;layer_cnt; ++rlayer )</span>
<span class="lineNum">    2837 </span><span class="lineNoCov">          0 :             CVDrawSplineSetSpecialized(cv,pixmap,rf-&gt;layers[rlayer].splines,foreoutlinecol,-1,clip, refsfm, 0);</span>
<span class="lineNum">    2838 </span><span class="lineNoCov">          0 :         if ( rf-&gt;selected &amp;&amp; cv-&gt;b.layerheads[cv-&gt;b.drawmode]==&amp;sc-&gt;layers[layer])</span>
<span class="lineNum">    2839 </span><span class="lineNoCov">          0 :             CVDrawBB(cv,pixmap,&amp;rf-&gt;bb);</span>
<span class="lineNum">    2840 </span>            :     }
<span class="lineNum">    2841 </span><span class="lineNoCov">          0 : }</span>
<a name="2842"><span class="lineNum">    2842 </span>            : </a>
<span class="lineNum">    2843 </span>            : 
<span class="lineNum">    2844 </span><span class="lineNoCov">          0 : static void CVExpose(CharView *cv, GWindow pixmap, GEvent *event ) {</span>
<span class="lineNum">    2845 </span><span class="lineNoCov">          0 :     SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">    2846 </span>            :     RefChar *rf;
<span class="lineNum">    2847 </span>            :     GRect old;
<span class="lineNum">    2848 </span>            :     DRect clip;
<span class="lineNum">    2849 </span>            :     char buf[20];
<span class="lineNum">    2850 </span>            :     PST *pst;
<span class="lineNum">    2851 </span><span class="lineNoCov">          0 :     int i, layer, rlayer, cvlayer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    2852 </span><span class="lineNoCov">          0 :     enum outlinesfm_flags strokeFillMode = sfm_stroke;</span>
<span class="lineNum">    2853 </span><span class="lineNoCov">          0 :     int GlyphHasBeenFilled = 0;</span>
<span class="lineNum">    2854 </span>            : 
<span class="lineNum">    2855 </span><span class="lineNoCov">          0 :     GDrawPushClip(pixmap,&amp;event-&gt;u.expose.rect,&amp;old);</span>
<span class="lineNum">    2856 </span>            : 
<span class="lineNum">    2857 </span><span class="lineNoCov">          0 :     if( shouldShowFilledUsingCairo(cv) ) {</span>
<span class="lineNum">    2858 </span><span class="lineNoCov">          0 :         strokeFillMode = sfm_fill;</span>
<span class="lineNum">    2859 </span>            :     }
<span class="lineNum">    2860 </span>            : 
<span class="lineNum">    2861 </span><span class="lineNoCov">          0 :     clip.width = event-&gt;u.expose.rect.width/cv-&gt;scale;</span>
<span class="lineNum">    2862 </span><span class="lineNoCov">          0 :     clip.height = event-&gt;u.expose.rect.height/cv-&gt;scale;</span>
<span class="lineNum">    2863 </span><span class="lineNoCov">          0 :     clip.x = (event-&gt;u.expose.rect.x-cv-&gt;xoff)/cv-&gt;scale;</span>
<span class="lineNum">    2864 </span><span class="lineNoCov">          0 :     clip.y = (cv-&gt;height-event-&gt;u.expose.rect.y-event-&gt;u.expose.rect.height-cv-&gt;yoff)/cv-&gt;scale;</span>
<span class="lineNum">    2865 </span>            : 
<span class="lineNum">    2866 </span><span class="lineNoCov">          0 :     GDrawSetFont(pixmap,cv-&gt;small);</span>
<span class="lineNum">    2867 </span><span class="lineNoCov">          0 :     GDrawSetLineWidth(pixmap,0);</span>
<span class="lineNum">    2868 </span>            : 
<span class="lineNum">    2869 </span><span class="lineNoCov">          0 :     if ( !cv-&gt;show_ft_results &amp;&amp; cv-&gt;dv==NULL ) {</span>
<span class="lineNum">    2870 </span>            : 
<span class="lineNum">    2871 </span><span class="lineNoCov">          0 :         if ( cv-&gt;backimgs==NULL &amp;&amp; !(GDrawHasCairo(cv-&gt;v)&amp;gc_buildpath))</span>
<span class="lineNum">    2872 </span><span class="lineNoCov">          0 :             cv-&gt;backimgs = GDrawCreatePixmap(GDrawGetDisplayOfWindow(cv-&gt;v),cv-&gt;width,cv-&gt;height);</span>
<span class="lineNum">    2873 </span><span class="lineNoCov">          0 :         if ( GDrawHasCairo(cv-&gt;v)&amp;gc_buildpath ) {</span>
<span class="lineNum">    2874 </span><span class="lineNoCov">          0 :             for ( layer = ly_back; layer&lt;cv-&gt;b.sc-&gt;layer_cnt; ++layer ) if ( cv-&gt;b.sc-&gt;layers[layer].images!=NULL ) {</span>
<span class="lineNum">    2875 </span><span class="lineNoCov">          0 :                 if (( sf-&gt;multilayer &amp;&amp; ((( cv-&gt;showback[0]&amp;1 || cvlayer==layer) &amp;&amp; layer==ly_back ) ||</span>
<span class="lineNum">    2876 </span><span class="lineNoCov">          0 :                             ((cv-&gt;showfore || cvlayer==layer) &amp;&amp; layer&gt;ly_back)) ) ||</span>
<span class="lineNum">    2877 </span><span class="lineNoCov">          0 :                     ( !sf-&gt;multilayer &amp;&amp; (((cv-&gt;showfore &amp;&amp; cvlayer==layer) &amp;&amp; layer==ly_fore) ||</span>
<span class="lineNum">    2878 </span><span class="lineNoCov">          0 :                             (((cv-&gt;showback[layer&gt;&gt;5]&amp;(1&lt;&lt;(layer&amp;31))) || cvlayer==layer) &amp;&amp; layer!=ly_fore))) ) {</span>
<span class="lineNum">    2879 </span>            :                     /* This really should be after the grids, but then it would completely*/
<span class="lineNum">    2880 </span>            :                     /*  hide them. */
<span class="lineNum">    2881 </span><span class="lineNoCov">          0 :                     DrawImageList(cv,pixmap,cv-&gt;b.sc-&gt;layers[layer].images);</span>
<span class="lineNum">    2882 </span>            :                 }
<span class="lineNum">    2883 </span>            :             }
<span class="lineNum">    2884 </span><span class="lineNoCov">          0 :             cv-&gt;back_img_out_of_date = false;</span>
<span class="lineNum">    2885 </span><span class="lineNoCov">          0 :             if ( cv-&gt;showhhints || cv-&gt;showvhints || cv-&gt;showdhints || cv-&gt;showblues || cv-&gt;showfamilyblues)</span>
<span class="lineNum">    2886 </span><span class="lineNoCov">          0 :                 CVShowHints(cv,pixmap);</span>
<span class="lineNum">    2887 </span><span class="lineNoCov">          0 :         } else if ( cv-&gt;back_img_out_of_date ) {</span>
<span class="lineNum">    2888 </span><span class="lineNoCov">          0 :             GDrawFillRect(cv-&gt;backimgs,NULL,view_bgcol);</span>
<span class="lineNum">    2889 </span><span class="lineNoCov">          0 :             if ( cv-&gt;showhhints || cv-&gt;showvhints || cv-&gt;showdhints || cv-&gt;showblues || cv-&gt;showfamilyblues)</span>
<span class="lineNum">    2890 </span><span class="lineNoCov">          0 :                 CVShowHints(cv,cv-&gt;backimgs);</span>
<span class="lineNum">    2891 </span><span class="lineNoCov">          0 :             for ( layer = ly_back; layer&lt;cv-&gt;b.sc-&gt;layer_cnt; ++layer ) if ( cv-&gt;b.sc-&gt;layers[layer].images!=NULL ) {</span>
<span class="lineNum">    2892 </span><span class="lineNoCov">          0 :                 if (( sf-&gt;multilayer &amp;&amp; ((( cv-&gt;showback[0]&amp;1 || cvlayer==layer) &amp;&amp; layer==ly_back ) ||</span>
<span class="lineNum">    2893 </span><span class="lineNoCov">          0 :                             ((cv-&gt;showfore || cvlayer==layer) &amp;&amp; layer&gt;ly_back)) ) ||</span>
<span class="lineNum">    2894 </span><span class="lineNoCov">          0 :                     ( !sf-&gt;multilayer &amp;&amp; (((cv-&gt;showfore &amp;&amp; cvlayer==layer) &amp;&amp; layer==ly_fore) ||</span>
<span class="lineNum">    2895 </span><span class="lineNoCov">          0 :                             (((cv-&gt;showback[layer&gt;&gt;5]&amp;(1&lt;&lt;(layer&amp;31))) || cvlayer==layer) &amp;&amp; layer!=ly_fore))) ) {</span>
<span class="lineNum">    2896 </span>            :                     /* This really should be after the grids, but then it would completely*/
<span class="lineNum">    2897 </span>            :                     /*  hide them. */
<span class="lineNum">    2898 </span><span class="lineNoCov">          0 :                     if ( cv-&gt;back_img_out_of_date )</span>
<span class="lineNum">    2899 </span><span class="lineNoCov">          0 :                         DrawImageList(cv,cv-&gt;backimgs,cv-&gt;b.sc-&gt;layers[layer].images);</span>
<span class="lineNum">    2900 </span>            :                 }
<span class="lineNum">    2901 </span>            :             }
<span class="lineNum">    2902 </span><span class="lineNoCov">          0 :             cv-&gt;back_img_out_of_date = false;</span>
<span class="lineNum">    2903 </span>            :         }
<span class="lineNum">    2904 </span><span class="lineNoCov">          0 :         if ( cv-&gt;backimgs!=NULL ) {</span>
<span class="lineNum">    2905 </span>            :             GRect r;
<span class="lineNum">    2906 </span><span class="lineNoCov">          0 :             r.x = r.y = 0; r.width = cv-&gt;width; r.height = cv-&gt;height;</span>
<span class="lineNum">    2907 </span><span class="lineNoCov">          0 :             GDrawDrawPixmap(pixmap,cv-&gt;backimgs,&amp;r,0,0);</span>
<span class="lineNum">    2908 </span><span class="lineNoCov">          0 :         } else if ( !(GDrawHasCairo(cv-&gt;v)&amp;gc_buildpath) &amp;&amp;</span>
<span class="lineNum">    2909 </span><span class="lineNoCov">          0 :                 ( cv-&gt;showhhints || cv-&gt;showvhints || cv-&gt;showdhints || cv-&gt;showblues || cv-&gt;showfamilyblues)) {</span>
<span class="lineNum">    2910 </span>            :             /* if we've got bg images (and we're showing them) then the hints live in */
<span class="lineNum">    2911 </span>            :             /*  the bg image pixmap (else they get overwritten by the pixmap) */
<span class="lineNum">    2912 </span><span class="lineNoCov">          0 :             CVShowHints(cv,pixmap);</span>
<span class="lineNum">    2913 </span>            :         }
<span class="lineNum">    2914 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showgrids || cv-&gt;b.drawmode==dm_grid ) {</span>
<span class="lineNum">    2915 </span><span class="lineNoCov">          0 :             CVDrawSplineSet(cv,pixmap,cv-&gt;b.fv-&gt;sf-&gt;grid.splines,guideoutlinecol,</span>
<span class="lineNum">    2916 </span><span class="lineNoCov">          0 :                     cv-&gt;showpoints &amp;&amp; cv-&gt;b.drawmode==dm_grid,&amp;clip);</span>
<span class="lineNum">    2917 </span>            :         }
<span class="lineNum">    2918 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showhmetrics ) {</span>
<span class="lineNum">    2919 </span><span class="lineNoCov">          0 :             Color lbcolor = (!cv-&gt;inactive &amp;&amp; cv-&gt;lbearingsel) ? lbearingselcol : coordcol;</span>
<span class="lineNum">    2920 </span><span class="lineNoCov">          0 :             DrawVLine(cv,pixmap,0,lbcolor,false,NULL,NULL);</span>
<span class="lineNum">    2921 </span><span class="lineNoCov">          0 :             DrawLine(cv,pixmap,-8096,0,8096,0,coordcol);</span>
<span class="lineNum">    2922 </span><span class="lineNoCov">          0 :             DrawLine(cv,pixmap,-8096,sf-&gt;ascent,8096,sf-&gt;ascent,coordcol);</span>
<span class="lineNum">    2923 </span><span class="lineNoCov">          0 :             DrawLine(cv,pixmap,-8096,-sf-&gt;descent,8096,-sf-&gt;descent,coordcol);</span>
<span class="lineNum">    2924 </span>            :         }
<span class="lineNum">    2925 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showvmetrics ) {</span>
<span class="lineNum">    2926 </span><span class="lineNoCov">          0 :             DrawLine(cv,pixmap,(sf-&gt;ascent+sf-&gt;descent)/2,-8096,(sf-&gt;ascent+sf-&gt;descent)/2,8096,coordcol);</span>
<span class="lineNum">    2927 </span>            :             /*DrawLine(cv,pixmap,-8096,sf-&gt;vertical_origin,8096,sf-&gt;vertical_origin,coordcol);*/
<span class="lineNum">    2928 </span>            :         }
<span class="lineNum">    2929 </span>            : 
<span class="lineNum">    2930 </span><span class="lineNoCov">          0 :         DrawSelImageList(cv,pixmap,cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images);</span>
<span class="lineNum">    2931 </span>            : 
<span class="lineNum">    2932 </span>            :         /* Wrong order, I know. But it is useful to have the background */
<span class="lineNum">    2933 </span>            :         /*  visible on top of the fill... */
<span class="lineNum">    2934 </span><span class="lineNoCov">          0 :         GlyphHasBeenFilled = CVExposeGlyphFill(cv, pixmap, event, &amp;clip );</span>
<span class="lineNum">    2935 </span>            :     } else {
<span class="lineNum">    2936 </span>            :         /* Draw FreeType Results */
<span class="lineNum">    2937 </span><span class="lineNoCov">          0 :         CVDrawGridRaster(cv,pixmap,&amp;clip);</span>
<span class="lineNum">    2938 </span>            :     }
<span class="lineNum">    2939 </span>            : 
<span class="lineNum">    2940 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes!=NULL &amp;&amp;</span>
<span class="lineNum">    2941 </span><span class="lineNoCov">          0 :             cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes-&gt;undotype==ut_tstate )</span>
<span class="lineNum">    2942 </span><span class="lineNoCov">          0 :         DrawOldState(cv,pixmap,cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes, &amp;clip);</span>
<span class="lineNum">    2943 </span>            : 
<span class="lineNum">    2944 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showfore )</span>
<span class="lineNum">    2945 </span><span class="lineNoCov">          0 :         cv-&gt;showback[0] |= (1&lt;&lt;ly_fore);</span>
<span class="lineNum">    2946 </span>            :     else
<span class="lineNum">    2947 </span><span class="lineNoCov">          0 :         cv-&gt;showback[0] &amp;= ~(1&lt;&lt;ly_fore);</span>
<span class="lineNum">    2948 </span>            : 
<span class="lineNum">    2949 </span><span class="lineNoCov">          0 :     for ( layer=ly_back; layer&lt;cv-&gt;b.sc-&gt;layer_cnt; ++layer ) if ( layer!=cvlayer ) {</span>
<span class="lineNum">    2950 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showback[layer&gt;&gt;5]&amp;(1&lt;&lt;(layer&amp;31)) ) {</span>
<span class="lineNum">    2951 </span>            :             /* Used to draw the image list here, but that's too slow. Optimization*/
<span class="lineNum">    2952 </span>            :             /*  is to draw to pixmap, dump pixmap a bit earlier */
<span class="lineNum">    2953 </span>            :             /* Then when we moved the fill image around, we had to deal with the */
<span class="lineNum">    2954 </span>            :             /*  images before the fill... */
<span class="lineNum">    2955 </span><span class="lineNoCov">          0 :             int activelayer = CVLayer(&amp;cv-&gt;b);</span>
<span class="lineNum">    2956 </span>            : 
<span class="lineNum">    2957 </span><span class="lineNoCov">          0 :             enum outlinesfm_flags strokeFillMode = sfm_stroke;</span>
<span class="lineNum">    2958 </span><span class="lineNoCov">          0 :             if( cv-&gt;inPreviewMode )</span>
<span class="lineNum">    2959 </span><span class="lineNoCov">          0 :                 strokeFillMode = sfm_nothing;</span>
<span class="lineNum">    2960 </span><span class="lineNoCov">          0 :             if( layer == activelayer &amp;&amp; layer &gt;= ly_back )</span>
<span class="lineNum">    2961 </span><span class="lineNoCov">          0 :                 strokeFillMode = sfm_fill;</span>
<span class="lineNum">    2962 </span>            : 
<span class="lineNum">    2963 </span><span class="lineNoCov">          0 :             CVDrawLayerSplineSet(cv,pixmap,&amp;cv-&gt;b.sc-&gt;layers[layer],</span>
<span class="lineNum">    2964 </span><span class="lineNoCov">          0 :                                  !sf-&gt;multilayer || layer==ly_back ? backoutlinecol : foreoutlinecol,</span>
<span class="lineNum">    2965 </span>            :                                  false,&amp;clip,strokeFillMode);
<span class="lineNum">    2966 </span><span class="lineNoCov">          0 :             for ( rf=cv-&gt;b.sc-&gt;layers[layer].refs; rf!=NULL; rf = rf-&gt;next ) {</span>
<span class="lineNum">    2967 </span><span class="lineNoCov">          0 :                 if ( /* cv-&gt;b.drawmode==dm_back &amp;&amp;*/ cv-&gt;showrefnames )</span>
<span class="lineNum">    2968 </span><span class="lineNoCov">          0 :                     CVDrawRefName(cv,pixmap,rf,0);</span>
<span class="lineNum">    2969 </span><span class="lineNoCov">          0 :                 for ( rlayer=0; rlayer&lt;rf-&gt;layer_cnt; ++rlayer )</span>
<span class="lineNum">    2970 </span><span class="lineNoCov">          0 :                     CVDrawSplineSet(cv,pixmap,rf-&gt;layers[rlayer].splines, backoutlinecol,false,&amp;clip);</span>
<span class="lineNum">    2971 </span><span class="lineNoCov">          0 :                 if ( rf-&gt;selected &amp;&amp; cv-&gt;b.layerheads[cv-&gt;b.drawmode]==&amp;cv-&gt;b.sc-&gt;layers[layer])</span>
<span class="lineNum">    2972 </span><span class="lineNoCov">          0 :                     CVDrawBB(cv,pixmap,&amp;rf-&gt;bb);</span>
<span class="lineNum">    2973 </span>            :             }
<span class="lineNum">    2974 </span>            :         }
<span class="lineNum">    2975 </span>            :     }
<span class="lineNum">    2976 </span><span class="lineNoCov">          0 :     if ( cv-&gt;mmvisible!=0 )</span>
<span class="lineNum">    2977 </span><span class="lineNoCov">          0 :         DrawMMGhosts(cv,pixmap,&amp;clip);</span>
<span class="lineNum">    2978 </span><span class="lineNoCov">          0 :     if ( cv-&gt;template1!=NULL )</span>
<span class="lineNum">    2979 </span><span class="lineNoCov">          0 :         CVDrawTemplates(cv,pixmap,cv-&gt;template1,&amp;clip);</span>
<span class="lineNum">    2980 </span><span class="lineNoCov">          0 :     if ( cv-&gt;template2!=NULL )</span>
<span class="lineNum">    2981 </span><span class="lineNoCov">          0 :         CVDrawTemplates(cv,pixmap,cv-&gt;template2,&amp;clip);</span>
<span class="lineNum">    2982 </span>            : 
<span class="lineNum">    2983 </span>            :     /* Draw the active layer last so its splines are on top. */
<span class="lineNum">    2984 </span>            :     /* Note that we don't check whether the layer is visible or not, we always*/
<span class="lineNum">    2985 </span>            :     /*  draw the current layer -- unless they've turned on grid fit. Then they*/
<span class="lineNum">    2986 </span>            :     /*  might want to hide the active layer. */
<span class="lineNum">    2987 </span><span class="lineNoCov">          0 :     layer = cvlayer;</span>
<span class="lineNum">    2988 </span>            : 
<span class="lineNum">    2989 </span>            : 
<span class="lineNum">    2990 </span>            :     /*
<span class="lineNum">    2991 </span>            :      * If we have a pretransform_spl and the user wants to see it then show it to them
<span class="lineNum">    2992 </span>            :      */
<span class="lineNum">    2993 </span><span class="lineNoCov">          0 :      if( cv-&gt;p.pretransform_spl )</span>
<span class="lineNum">    2994 </span>            :      {
<span class="lineNum">    2995 </span>            :          struct CVExpose_PreTransformSPL_ud d;
<span class="lineNum">    2996 </span><span class="lineNoCov">          0 :          d.dopoints = 1;</span>
<span class="lineNum">    2997 </span><span class="lineNoCov">          0 :          d.cv = cv;</span>
<span class="lineNum">    2998 </span><span class="lineNoCov">          0 :          d.pixmap = pixmap;</span>
<span class="lineNum">    2999 </span><span class="lineNoCov">          0 :          d.fg = DraggingComparisonOutlineColor;</span>
<span class="lineNum">    3000 </span><span class="lineNoCov">          0 :          d.clip = &amp;clip;</span>
<span class="lineNum">    3001 </span><span class="lineNoCov">          0 :          d.strokeFillMode = sfm_stroke_trans;</span>
<span class="lineNum">    3002 </span><span class="lineNoCov">          0 :          g_list_foreach( cv-&gt;p.pretransform_spl, (GFunc)CVExpose_PreTransformSPL_fe, &amp;d );</span>
<span class="lineNum">    3003 </span>            :      }
<span class="lineNum">    3004 </span>            : 
<span class="lineNum">    3005 </span>            :     /* The call to CVExposeGlyphFill() above will have rendered a filled glyph already. */
<span class="lineNum">    3006 </span>            :     /* We draw the outline only at this stage so as to have it layered */
<span class="lineNum">    3007 </span>            :     /* over the control points if they are currently visible. */
<span class="lineNum">    3008 </span>            :     /* CVDrawLayerSplineSet() will draw both the control points, and the font outline over those */
<span class="lineNum">    3009 </span>            :     /* NB:
<span class="lineNum">    3010 </span>            :      *     Drawing the stroked outline may also use the color
<span class="lineNum">    3011 </span>            :      *     clippathcol for some splines, so we can't really avoid a
<span class="lineNum">    3012 </span>            :      *     restroke unless we are sure
<span class="lineNum">    3013 </span>            :      *     FOR-ALL(splines):spl-&gt;is_clip_path==0 */
<span class="lineNum">    3014 </span><span class="lineNoCov">          0 :     if( shouldShowFilledUsingCairo(cv) ) {</span>
<span class="lineNum">    3015 </span><span class="lineNoCov">          0 :         strokeFillMode = sfm_stroke;</span>
<span class="lineNum">    3016 </span>            :     }
<span class="lineNum">    3017 </span><span class="lineNoCov">          0 :     if( GlyphHasBeenFilled ) {</span>
<span class="lineNum">    3018 </span><span class="lineNoCov">          0 :         strokeFillMode = sfm_stroke_trans;</span>
<span class="lineNum">    3019 </span>            :     }
<span class="lineNum">    3020 </span>            : 
<span class="lineNum">    3021 </span><span class="lineNoCov">          0 :     if ( layer&lt;0 ) /* Guide lines are special */</span>
<span class="lineNum">    3022 </span><span class="lineNoCov">          0 :         CVDrawLayerSplineSet( cv,pixmap,cv-&gt;b.layerheads[cv-&gt;b.drawmode],foreoutlinecol,</span>
<span class="lineNum">    3023 </span><span class="lineNoCov">          0 :                               cv-&gt;showpoints ,&amp;clip, strokeFillMode );</span>
<span class="lineNum">    3024 </span><span class="lineNoCov">          0 :     else if ( (cv-&gt;showback[layer&gt;&gt;5]&amp;(1&lt;&lt;(layer&amp;31))) ||</span>
<span class="lineNum">    3025 </span><span class="lineNoCov">          0 :             (!cv-&gt;show_ft_results &amp;&amp; cv-&gt;dv==NULL ))</span>
<span class="lineNum">    3026 </span>            :     {
<span class="lineNum">    3027 </span><span class="lineNoCov">          0 :         CVExposeReferences( cv, pixmap, cv-&gt;b.sc, layer, &amp;clip );</span>
<span class="lineNum">    3028 </span>            :     }
<span class="lineNum">    3029 </span><span class="lineNoCov">          0 :     if ( layer&gt;=0 )</span>
<span class="lineNum">    3030 </span>            :     {
<span class="lineNum">    3031 </span><span class="lineNoCov">          0 :         if( cv-&gt;dv &amp;&amp; !(cv-&gt;showback[layer&gt;&gt;5]&amp;(1&lt;&lt;(layer&amp;31))))</span>
<span class="lineNum">    3032 </span>            :         {
<span class="lineNum">    3033 </span>            :             // MIQ 2013 feb: issue/168
<span class="lineNum">    3034 </span>            :             // turn off the glyph outline if we are in debug mode and
<span class="lineNum">    3035 </span>            :             // the layer is not visible
<span class="lineNum">    3036 </span>            :         }
<span class="lineNum">    3037 </span>            :         else
<span class="lineNum">    3038 </span>            :         {
<span class="lineNum">    3039 </span><span class="lineNoCov">          0 :             CVDrawLayerSplineSet( cv,pixmap,&amp;cv-&gt;b.sc-&gt;layers[layer],foreoutlinecol,</span>
<span class="lineNum">    3040 </span><span class="lineNoCov">          0 :                                   cv-&gt;showpoints ,&amp;clip, strokeFillMode );</span>
<span class="lineNum">    3041 </span>            : 
<span class="lineNum">    3042 </span>            :             
<span class="lineNum">    3043 </span><span class="lineNoCov">          0 :             int showpoints = 0;</span>
<span class="lineNum">    3044 </span><span class="lineNoCov">          0 :             enum outlinesfm_flags sm = sfm_stroke;</span>
<span class="lineNum">    3045 </span><span class="lineNoCov">          0 :             if( cv-&gt;inPreviewMode ) {</span>
<span class="lineNum">    3046 </span><span class="lineNoCov">          0 :                 sm = sfm_fill;</span>
<span class="lineNum">    3047 </span>            :             }
<span class="lineNum">    3048 </span>            : 
<span class="lineNum">    3049 </span><span class="lineNoCov">          0 :             int ridx = cv-&gt;additionalCharsToShowActiveIndex+1;</span>
<span class="lineNum">    3050 </span>            : //          TRACE(&quot;expose(b) additionalCharsToShowActiveIndex:%d\n&quot;, cv-&gt;additionalCharsToShowActiveIndex );
<span class="lineNum">    3051 </span><span class="lineNoCov">          0 :             if( cv-&gt;additionalCharsToShow[ ridx ] )</span>
<span class="lineNum">    3052 </span>            :             {
<span class="lineNum">    3053 </span><span class="lineNoCov">          0 :                 int i = 1;</span>
<span class="lineNum">    3054 </span><span class="lineNoCov">          0 :                 int originalxoff = cv-&gt;xoff;</span>
<span class="lineNum">    3055 </span><span class="lineNoCov">          0 :                 int offset = cv-&gt;scale * cv-&gt;b.sc-&gt;width;</span>
<span class="lineNum">    3056 </span><span class="lineNoCov">          0 :                 for( i=ridx; i &lt; additionalCharsToShowLimit; i++ )</span>
<span class="lineNum">    3057 </span>            :                 {
<span class="lineNum">    3058 </span>            : //                  TRACE(&quot;expose(right) loop:%d\n&quot;, i );
<span class="lineNum">    3059 </span><span class="lineNoCov">          0 :                     SplineChar* xc = cv-&gt;additionalCharsToShow[i];</span>
<span class="lineNum">    3060 </span><span class="lineNoCov">          0 :                     if( !xc )</span>
<span class="lineNum">    3061 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    3062 </span>            : 
<span class="lineNum">    3063 </span><span class="lineNoCov">          0 :                     cv-&gt;xoff += offset;</span>
<span class="lineNum">    3064 </span><span class="lineNoCov">          0 :                     CVExposeReferences(   cv, pixmap, xc, layer, &amp;clip );</span>
<span class="lineNum">    3065 </span><span class="lineNoCov">          0 :                     CVDrawLayerSplineSet( cv, pixmap, &amp;xc-&gt;layers[layer], foreoutlinecol,</span>
<span class="lineNum">    3066 </span>            :                                           showpoints ,&amp;clip, sm );
<span class="lineNum">    3067 </span><span class="lineNoCov">          0 :                     offset = cv-&gt;scale * xc-&gt;width;</span>
<span class="lineNum">    3068 </span>            :                 }
<span class="lineNum">    3069 </span><span class="lineNoCov">          0 :                 cv-&gt;xoff = originalxoff;</span>
<span class="lineNum">    3070 </span>            :             }
<span class="lineNum">    3071 </span>            : 
<span class="lineNum">    3072 </span>            : 
<span class="lineNum">    3073 </span>            :             
<span class="lineNum">    3074 </span><span class="lineNoCov">          0 :             if( cv-&gt;additionalCharsToShowActiveIndex &gt; 0 )</span>
<span class="lineNum">    3075 </span>            :             {
<span class="lineNum">    3076 </span><span class="lineNoCov">          0 :                 int i = 1;</span>
<span class="lineNum">    3077 </span><span class="lineNoCov">          0 :                 int originalxoff = cv-&gt;xoff;</span>
<span class="lineNum">    3078 </span><span class="lineNoCov">          0 :                 int offset = 0;</span>
<span class="lineNum">    3079 </span>            :                     
<span class="lineNum">    3080 </span><span class="lineNoCov">          0 :                 for( i=cv-&gt;additionalCharsToShowActiveIndex-1; i &gt;= 0; i-- )</span>
<span class="lineNum">    3081 </span>            :                 {
<span class="lineNum">    3082 </span>            : //                  TRACE(&quot;expose(left) loop:%d\n&quot;, i );
<span class="lineNum">    3083 </span><span class="lineNoCov">          0 :                     SplineChar* xc = cv-&gt;additionalCharsToShow[i];</span>
<span class="lineNum">    3084 </span><span class="lineNoCov">          0 :                     if( !xc )</span>
<span class="lineNum">    3085 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    3086 </span>            : 
<span class="lineNum">    3087 </span><span class="lineNoCov">          0 :                     offset = cv-&gt;scale * xc-&gt;width;</span>
<span class="lineNum">    3088 </span><span class="lineNoCov">          0 :                     cv-&gt;xoff -= offset;</span>
<span class="lineNum">    3089 </span><span class="lineNoCov">          0 :                     CVExposeReferences(   cv, pixmap, xc, layer, &amp;clip );</span>
<span class="lineNum">    3090 </span><span class="lineNoCov">          0 :                     CVDrawLayerSplineSet( cv, pixmap, &amp;xc-&gt;layers[layer], foreoutlinecol,</span>
<span class="lineNum">    3091 </span>            :                                           showpoints ,&amp;clip, sm );
<span class="lineNum">    3092 </span>            :                 }
<span class="lineNum">    3093 </span><span class="lineNoCov">          0 :                 cv-&gt;xoff = originalxoff;</span>
<span class="lineNum">    3094 </span>            :             }
<span class="lineNum">    3095 </span>            :                 
<span class="lineNum">    3096 </span>            : //          TRACE(&quot;expose(e) ridx:%d\n&quot;, ridx );
<span class="lineNum">    3097 </span>            : 
<span class="lineNum">    3098 </span>            :         }
<span class="lineNum">    3099 </span>            :     }
<span class="lineNum">    3100 </span>            : 
<span class="lineNum">    3101 </span>            : 
<span class="lineNum">    3102 </span><span class="lineNoCov">          0 :     if ( cv-&gt;freehand.current_trace )</span>
<span class="lineNum">    3103 </span><span class="lineNoCov">          0 :         CVDrawSplineSet( cv,pixmap,cv-&gt;freehand.current_trace,tracecol,</span>
<span class="lineNum">    3104 </span>            :                          false,&amp;clip);
<span class="lineNum">    3105 </span>            : 
<span class="lineNum">    3106 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showhmetrics &amp;&amp; (cv-&gt;b.container==NULL || cv-&gt;b.container-&gt;funcs-&gt;type==cvc_mathkern) ) {</span>
<span class="lineNum">    3107 </span><span class="lineNoCov">          0 :         RefChar *lock = HasUseMyMetrics(cv-&gt;b.sc,cvlayer);</span>
<span class="lineNum">    3108 </span><span class="lineNoCov">          0 :         if ( lock!=NULL ) cv-&gt;b.sc-&gt;width = lock-&gt;sc-&gt;width;</span>
<span class="lineNum">    3109 </span><span class="lineNoCov">          0 :         DrawVLine(cv,pixmap,cv-&gt;b.sc-&gt;width,(!cv-&gt;inactive &amp;&amp; cv-&gt;widthsel)?widthselcol:widthcol,true,</span>
<span class="lineNum">    3110 </span>            :                 lock!=NULL ? &amp;GIcon_lock : NULL, NULL);
<span class="lineNum">    3111 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.sc-&gt;italic_correction!=TEX_UNDEF &amp;&amp; cv-&gt;b.sc-&gt;italic_correction!=0 ) {</span>
<span class="lineNum">    3112 </span><span class="lineNoCov">          0 :             GDrawSetDashedLine(pixmap,2,2,0);</span>
<span class="lineNum">    3113 </span><span class="lineNoCov">          0 :             DrawVLine(cv,pixmap,cv-&gt;b.sc-&gt;width+cv-&gt;b.sc-&gt;italic_correction,(!cv-&gt;inactive &amp;&amp; cv-&gt;icsel)?widthselcol:widthcol,</span>
<span class="lineNum">    3114 </span>            : /* GT: Italic Correction */
<span class="lineNum">    3115 </span>            :                     false, NULL,_(&quot;ItalicCor.&quot;));
<span class="lineNum">    3116 </span><span class="lineNoCov">          0 :             GDrawSetDashedLine(pixmap,0,0,0);</span>
<span class="lineNum">    3117 </span>            :         }
<span class="lineNum">    3118 </span>            :     }
<span class="lineNum">    3119 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showhmetrics &amp;&amp; cv-&gt;b.container==NULL ) {</span>
<span class="lineNum">    3120 </span><span class="lineNoCov">          0 :         for ( pst=cv-&gt;b.sc-&gt;possub; pst!=NULL &amp;&amp; pst-&gt;type!=pst_lcaret; pst=pst-&gt;next );</span>
<span class="lineNum">    3121 </span><span class="lineNoCov">          0 :         if ( pst!=NULL ) {</span>
<span class="lineNum">    3122 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;pst-&gt;u.lcaret.cnt; ++i )</span>
<span class="lineNum">    3123 </span><span class="lineNoCov">          0 :                 DrawVLine(cv,pixmap,pst-&gt;u.lcaret.carets[i],lcaretcol,true,NULL,_(&quot;Lig.Caret&quot;));</span>
<span class="lineNum">    3124 </span>            :         }
<span class="lineNum">    3125 </span><span class="lineNoCov">          0 :         if ( cv-&gt;show_ft_results || cv-&gt;dv!=NULL )</span>
<span class="lineNum">    3126 </span><span class="lineNoCov">          0 :             DrawVLine(cv,pixmap,cv-&gt;b.ft_gridfitwidth,widthgridfitcol,true,NULL,NULL);</span>
<span class="lineNum">    3127 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.sc-&gt;top_accent_horiz!=TEX_UNDEF )</span>
<span class="lineNum">    3128 </span><span class="lineNoCov">          0 :             DrawVLine(cv,pixmap,cv-&gt;b.sc-&gt;top_accent_horiz,(!cv-&gt;inactive &amp;&amp; cv-&gt;tah_sel)?widthselcol:anchorcol,true,</span>
<span class="lineNum">    3129 </span>            :                     NULL,_(&quot;TopAccent&quot;));
<span class="lineNum">    3130 </span>            :     }
<span class="lineNum">    3131 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showvmetrics ) {</span>
<span class="lineNum">    3132 </span><span class="lineNoCov">          0 :         int len, y = -cv-&gt;yoff + cv-&gt;height - rint((/*sf-&gt;vertical_origin*/-cv-&gt;b.sc-&gt;vwidth)*cv-&gt;scale);</span>
<span class="lineNum">    3133 </span><span class="lineNoCov">          0 :         DrawLine(cv,pixmap,-32768,/*sf-&gt;vertical_origin*/-cv-&gt;b.sc-&gt;vwidth,</span>
<span class="lineNum">    3134 </span><span class="lineNoCov">          0 :                             32767,/*sf-&gt;vertical_origin*/-cv-&gt;b.sc-&gt;vwidth,</span>
<span class="lineNum">    3135 </span><span class="lineNoCov">          0 :                 (!cv-&gt;inactive &amp;&amp; cv-&gt;vwidthsel)?widthselcol:widthcol);</span>
<span class="lineNum">    3136 </span><span class="lineNoCov">          0 :         if ( y&gt;-40 &amp;&amp; y&lt;cv-&gt;height+40 ) {</span>
<span class="lineNum">    3137 </span><span class="lineNoCov">          0 :             dtos( buf, cv-&gt;b.sc-&gt;vwidth);</span>
<span class="lineNum">    3138 </span><span class="lineNoCov">          0 :             GDrawSetFont(pixmap,cv-&gt;small);</span>
<span class="lineNum">    3139 </span><span class="lineNoCov">          0 :             len = GDrawGetText8Width(pixmap,buf,-1);</span>
<span class="lineNum">    3140 </span><span class="lineNoCov">          0 :             GDrawDrawText8(pixmap,cv-&gt;width-len-5,y,buf,-1,metricslabelcol);</span>
<span class="lineNum">    3141 </span>            :         }
<span class="lineNum">    3142 </span>            :     }
<span class="lineNum">    3143 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showsidebearings &amp;&amp; cv-&gt;showfore &amp;&amp;</span>
<span class="lineNum">    3144 </span><span class="lineNoCov">          0 :             (cv-&gt;showvmetrics || cv-&gt;showhmetrics))</span>
<span class="lineNum">    3145 </span><span class="lineNoCov">          0 :         CVSideBearings(pixmap,cv);</span>
<span class="lineNum">    3146 </span>            : 
<span class="lineNum">    3147 </span><span class="lineNoCov">          0 :     if ((( cv-&gt;active_tool &gt;= cvt_scale &amp;&amp; cv-&gt;active_tool &lt;= cvt_perspective ) ||</span>
<span class="lineNum">    3148 </span><span class="lineNoCov">          0 :                 cv-&gt;active_shape!=NULL ) &amp;&amp;</span>
<span class="lineNum">    3149 </span>            :             cv-&gt;p.pressed )
<span class="lineNum">    3150 </span><span class="lineNoCov">          0 :         DrawTransOrigin(cv,pixmap);</span>
<span class="lineNum">    3151 </span><span class="lineNoCov">          0 :     if ( cv-&gt;dv==NULL || (cv-&gt;showback[ly_fore&gt;&gt;5]&amp;(1&lt;&lt;(ly_fore&amp;31))) )</span>
<span class="lineNum">    3152 </span><span class="lineNoCov">          0 :         CVDrawAnchorPoints(cv,pixmap);</span>
<span class="lineNum">    3153 </span><span class="lineNoCov">          0 :     if ( cv-&gt;apmine!=NULL )</span>
<span class="lineNum">    3154 </span><span class="lineNoCov">          0 :         DrawAPMatch(cv,pixmap,&amp;clip);</span>
<span class="lineNum">    3155 </span>            : 
<span class="lineNum">    3156 </span><span class="lineNoCov">          0 :     if ( cv-&gt;p.rubberbanding || cv-&gt;p.rubberlining ) {</span>
<span class="lineNum">    3157 </span><span class="lineNoCov">          0 :         if ( cv-&gt;p.rubberbanding )</span>
<span class="lineNum">    3158 </span><span class="lineNoCov">          0 :             CVDrawRubberRect(pixmap,cv);</span>
<span class="lineNum">    3159 </span><span class="lineNoCov">          0 :         if ( cv-&gt;p.rubberlining )</span>
<span class="lineNum">    3160 </span><span class="lineNoCov">          0 :             CVDrawRubberLine(pixmap,cv);</span>
<span class="lineNum">    3161 </span>            :     }
<span class="lineNum">    3162 </span><span class="lineNoCov">          0 :     CVRulerExpose(pixmap,cv);</span>
<span class="lineNum">    3163 </span>            : 
<span class="lineNum">    3164 </span><span class="lineNoCov">          0 :     GDrawPopClip(pixmap,&amp;old);</span>
<a name="3165"><span class="lineNum">    3165 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3166 </span>            : 
<span class="lineNum">    3167 </span><span class="lineCov">       6159 : static void SC_UpdateAll(SplineChar *sc) {</span>
<span class="lineNum">    3168 </span>            :     CharView *cv;
<span class="lineNum">    3169 </span>            :     struct splinecharlist *dlist;
<span class="lineNum">    3170 </span>            :     MetricsView *mv;
<span class="lineNum">    3171 </span>            :     FontView *fv;
<span class="lineNum">    3172 </span>            : 
<span class="lineNum">    3173 </span><span class="lineCov">       6159 :     for ( cv=(CharView *) (sc-&gt;views); cv!=NULL; cv=(CharView *) (cv-&gt;b.next) )</span>
<span class="lineNum">    3174 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">    3175 </span><span class="lineCov">       8747 :     for ( dlist=sc-&gt;dependents; dlist!=NULL; dlist=dlist-&gt;next )</span>
<span class="lineNum">    3176 </span><span class="lineCov">       2588 :         SCUpdateAll(dlist-&gt;sc);</span>
<span class="lineNum">    3177 </span><span class="lineCov">       6159 :     if ( sc-&gt;parent!=NULL ) {</span>
<span class="lineNum">    3178 </span><span class="lineCov">      12318 :         for ( fv = (FontView *) (sc-&gt;parent-&gt;fv); fv!=NULL; fv=(FontView *) (fv-&gt;b.nextsame) )</span>
<span class="lineNum">    3179 </span><span class="lineCov">       6159 :             FVRegenChar(fv,sc);</span>
<span class="lineNum">    3180 </span><span class="lineCov">       6159 :         for ( mv = sc-&gt;parent-&gt;metrics; mv!=NULL; mv=mv-&gt;next )</span>
<span class="lineNum">    3181 </span><span class="lineNoCov">          0 :             MVRegenChar(mv,sc);</span>
<span class="lineNum">    3182 </span>            :     }
<a name="3183"><span class="lineNum">    3183 </span><span class="lineCov">       6159 : }</span></a>
<span class="lineNum">    3184 </span>            : 
<span class="lineNum">    3185 </span><span class="lineCov">       2684 : static void SC_OutOfDateBackground(SplineChar *sc) {</span>
<span class="lineNum">    3186 </span>            :     CharView *cv;
<span class="lineNum">    3187 </span>            : 
<span class="lineNum">    3188 </span><span class="lineCov">       2684 :     for ( cv=(CharView *) (sc-&gt;views); cv!=NULL; cv=(CharView *) (cv-&gt;b.next) )</span>
<span class="lineNum">    3189 </span><span class="lineNoCov">          0 :         cv-&gt;back_img_out_of_date = true;</span>
<span class="lineNum">    3190 </span><span class="lineCov">       2684 : }</span>
<span class="lineNum">    3191 </span>            : 
<a name="3192"><span class="lineNum">    3192 </span>            : /* CVRegenFill() regenerates data used to show or not show paths as filled */</a>
<span class="lineNum">    3193 </span>            : /* This is not static so that it can be called from the layers palette */
<span class="lineNum">    3194 </span><span class="lineNoCov">          0 : void CVRegenFill(CharView *cv) {</span>
<span class="lineNum">    3195 </span><span class="lineNoCov">          0 :     BDFCharFree(cv-&gt;filled);</span>
<span class="lineNum">    3196 </span><span class="lineNoCov">          0 :     cv-&gt;filled = NULL;</span>
<span class="lineNum">    3197 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showfilled &amp;&amp; !shouldShowFilledUsingCairo(cv) ) {</span>
<span class="lineNum">    3198 </span>            :         extern int use_freetype_to_rasterize_fv;
<span class="lineNum">    3199 </span><span class="lineNoCov">          0 :         int layer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    3200 </span><span class="lineNoCov">          0 :         int size = cv-&gt;scale*(cv-&gt;b.fv-&gt;sf-&gt;ascent+cv-&gt;b.fv-&gt;sf-&gt;descent);</span>
<span class="lineNum">    3201 </span><span class="lineNoCov">          0 :         int clut_len= 2;</span>
<span class="lineNum">    3202 </span>            : 
<span class="lineNum">    3203 </span><span class="lineNoCov">          0 :         if ( layer==ly_grid ) layer=ly_fore; /* otherwise crashes when using guides layer! */</span>
<span class="lineNum">    3204 </span>            : 
<span class="lineNum">    3205 </span>            :         /* Generally I don't think there's much point in doing an anti-aliased*/
<span class="lineNum">    3206 </span>            :         /*  fill. But on the &quot;M&quot; (and &quot;W&quot;) glyph of extravigant caps, ft won't*/
<span class="lineNum">    3207 </span>            :         /*  do a mono fill */
<span class="lineNum">    3208 </span><span class="lineNoCov">          0 :         if ( use_freetype_to_rasterize_fv &amp;&amp; hasFreeType()) {</span>
<span class="lineNum">    3209 </span><span class="lineNoCov">          0 :             int depth = 1;</span>
<span class="lineNum">    3210 </span><span class="lineNoCov">          0 :             if( use_freetype_with_aa_fill_cv ) {</span>
<span class="lineNum">    3211 </span><span class="lineNoCov">          0 :                 depth = 4;</span>
<span class="lineNum">    3212 </span><span class="lineNoCov">          0 :                 clut_len = 16;</span>
<span class="lineNum">    3213 </span>            :             }
<span class="lineNum">    3214 </span><span class="lineNoCov">          0 :             cv-&gt;filled = SplineCharFreeTypeRasterizeNoHints(cv-&gt;b.sc,layer,</span>
<span class="lineNum">    3215 </span>            :                 size,72, depth);
<span class="lineNum">    3216 </span><span class="lineNoCov">          0 :             if ( cv-&gt;filled==NULL &amp;&amp; size&lt;2000 ) {</span>
<span class="lineNum">    3217 </span>            :                 /* There are some glyphs which freetype won't rasterize in */
<span class="lineNum">    3218 </span>            :                 /* mono mode, but will in grey scale. Don't ask me why */
<span class="lineNum">    3219 </span><span class="lineNoCov">          0 :                 cv-&gt;filled = SplineCharFreeTypeRasterizeNoHints(cv-&gt;b.sc,</span>
<span class="lineNum">    3220 </span>            :                     layer, size, 72, 4);
<span class="lineNum">    3221 </span><span class="lineNoCov">          0 :                 clut_len = 16;</span>
<span class="lineNum">    3222 </span>            :             }
<span class="lineNum">    3223 </span>            :         }
<span class="lineNum">    3224 </span><span class="lineNoCov">          0 :         if ( cv-&gt;filled==NULL )</span>
<span class="lineNum">    3225 </span><span class="lineNoCov">          0 :             cv-&gt;filled = SplineCharRasterize(cv-&gt;b.sc,layer,size+.1);</span>
<span class="lineNum">    3226 </span><span class="lineNoCov">          0 :         if ( cv-&gt;filled==NULL )</span>
<span class="lineNum">    3227 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3228 </span><span class="lineNoCov">          0 :         cv-&gt;gi.u.image-&gt;image_type = clut_len==2 ? it_mono : it_index;</span>
<span class="lineNum">    3229 </span><span class="lineNoCov">          0 :         cv-&gt;gi.u.image-&gt;data = cv-&gt;filled-&gt;bitmap;</span>
<span class="lineNum">    3230 </span><span class="lineNoCov">          0 :         cv-&gt;gi.u.image-&gt;bytes_per_line = cv-&gt;filled-&gt;bytes_per_line;</span>
<span class="lineNum">    3231 </span><span class="lineNoCov">          0 :         cv-&gt;gi.u.image-&gt;width = cv-&gt;filled-&gt;xmax-cv-&gt;filled-&gt;xmin+1;</span>
<span class="lineNum">    3232 </span><span class="lineNoCov">          0 :         cv-&gt;gi.u.image-&gt;height = cv-&gt;filled-&gt;ymax-cv-&gt;filled-&gt;ymin+1;</span>
<span class="lineNum">    3233 </span><span class="lineNoCov">          0 :         if ( clut_len!=cv-&gt;gi.u.image-&gt;clut-&gt;clut_len ) {</span>
<span class="lineNum">    3234 </span><span class="lineNoCov">          0 :             GClut *clut = cv-&gt;gi.u.image-&gt;clut;</span>
<span class="lineNum">    3235 </span>            :             int i;
<span class="lineNum">    3236 </span><span class="lineNoCov">          0 :             Color bg = view_bgcol;</span>
<span class="lineNum">    3237 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;clut_len; ++i ) {</span>
<span class="lineNum">    3238 </span>            :                 int r,g,b;
<span class="lineNum">    3239 </span><span class="lineNoCov">          0 :                 r = ((bg&gt;&gt;16)&amp;0xff)*(clut_len-1-i) + ((fillcol&gt;&gt;16)&amp;0xff)*i;</span>
<span class="lineNum">    3240 </span><span class="lineNoCov">          0 :                 g = ((bg&gt;&gt;8 )&amp;0xff)*(clut_len-1-i) + ((fillcol&gt;&gt;8 )&amp;0xff)*i;</span>
<span class="lineNum">    3241 </span><span class="lineNoCov">          0 :                 b = ((bg    )&amp;0xff)*(clut_len-1-i) + ((fillcol    )&amp;0xff)*i;</span>
<span class="lineNum">    3242 </span><span class="lineNoCov">          0 :                 clut-&gt;clut[i] = COLOR_CREATE(r/(clut_len-1),g/(clut_len-1),b/(clut_len-1));</span>
<span class="lineNum">    3243 </span>            :             }
<span class="lineNum">    3244 </span><span class="lineNoCov">          0 :             clut-&gt;clut_len = clut_len;</span>
<span class="lineNum">    3245 </span>            :         }
<span class="lineNum">    3246 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">    3247 </span>            :     }
<span class="lineNum">    3248 </span>            : }
<a name="3249"><span class="lineNum">    3249 </span>            : </a>
<span class="lineNum">    3250 </span>            : 
<span class="lineNum">    3251 </span><span class="lineNoCov">          0 : static void FVRedrawAllCharViewsSF(SplineFont *sf)</span>
<span class="lineNum">    3252 </span>            : {
<span class="lineNum">    3253 </span>            :     int i;
<span class="lineNum">    3254 </span>            :     CharView *cv;
<span class="lineNum">    3255 </span>            : 
<span class="lineNum">    3256 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;sf-&gt;glyphcnt; ++i ) if ( sf-&gt;glyphs[i]!=NULL )</span>
<span class="lineNum">    3257 </span><span class="lineNoCov">          0 :         for ( cv = (CharView *) (sf-&gt;glyphs[i]-&gt;views); cv!=NULL; cv=(CharView *) (cv-&gt;b.next) )</span>
<span class="lineNum">    3258 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="3259"><span class="lineNum">    3259 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3260 </span>            : 
<span class="lineNum">    3261 </span><span class="lineNoCov">          0 : void FVRedrawAllCharViews(FontView *fv)</span>
<span class="lineNum">    3262 </span>            : {
<span class="lineNum">    3263 </span><span class="lineNoCov">          0 :     FVRedrawAllCharViewsSF( fv-&gt;b.sf );</span>
<a name="3264"><span class="lineNum">    3264 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3265 </span>            : 
<span class="lineNum">    3266 </span><span class="lineCov">        895 : static void SCRegenFills(SplineChar *sc) {</span>
<span class="lineNum">    3267 </span>            :     struct splinecharlist *dlist;
<span class="lineNum">    3268 </span>            :     CharView *cv;
<span class="lineNum">    3269 </span>            : 
<span class="lineNum">    3270 </span><span class="lineCov">        895 :     for ( cv = (CharView *) (sc-&gt;views); cv!=NULL; cv=(CharView *) (cv-&gt;b.next) )</span>
<span class="lineNum">    3271 </span><span class="lineNoCov">          0 :         CVRegenFill(cv);</span>
<span class="lineNum">    3272 </span><span class="lineCov">        895 :     for ( dlist=sc-&gt;dependents; dlist!=NULL; dlist=dlist-&gt;next )</span>
<span class="lineNum">    3273 </span><span class="lineNoCov">          0 :         SCRegenFills(dlist-&gt;sc);</span>
<a name="3274"><span class="lineNum">    3274 </span><span class="lineCov">        895 : }</span></a>
<span class="lineNum">    3275 </span>            : 
<span class="lineNum">    3276 </span><span class="lineCov">        895 : static void SCRegenDependents(SplineChar *sc, int layer) {</span>
<span class="lineNum">    3277 </span>            :     struct splinecharlist *dlist;
<span class="lineNum">    3278 </span>            :     FontView *fv;
<span class="lineNum">    3279 </span>            :     int first, last;
<span class="lineNum">    3280 </span>            : 
<span class="lineNum">    3281 </span><span class="lineCov">        895 :     first = last = layer;</span>
<span class="lineNum">    3282 </span><span class="lineCov">        895 :     if ( layer==ly_all ) {</span>
<span class="lineNum">    3283 </span><span class="lineCov">        895 :         first = 0; last = sc-&gt;layer_cnt-1;</span>
<span class="lineNum">    3284 </span>            :     }
<span class="lineNum">    3285 </span><span class="lineCov">       2685 :     for ( layer = first; layer&lt;=last; ++layer ) {</span>
<span class="lineNum">    3286 </span><span class="lineCov">       3580 :         for ( fv = (FontView *) (sc-&gt;parent-&gt;fv); fv!=NULL; fv=(FontView *) (fv-&gt;b.nextsame) ) {</span>
<span class="lineNum">    3287 </span><span class="lineCov">       1790 :             if ( fv-&gt;sv!=NULL &amp;&amp; layer&lt;=ly_fore ) {</span>
<span class="lineNum">    3288 </span><span class="lineNoCov">          0 :                 SCReinstanciateRef(&amp;fv-&gt;sv-&gt;sd.sc_srch,sc,layer);</span>
<span class="lineNum">    3289 </span><span class="lineNoCov">          0 :                 SCReinstanciateRef(&amp;fv-&gt;sv-&gt;sd.sc_rpl,sc,layer);</span>
<span class="lineNum">    3290 </span>            :             }
<span class="lineNum">    3291 </span>            :         }
<span class="lineNum">    3292 </span>            : 
<span class="lineNum">    3293 </span><span class="lineCov">       1790 :         for ( dlist=sc-&gt;dependents; dlist!=NULL; dlist=dlist-&gt;next ) {</span>
<span class="lineNum">    3294 </span><span class="lineNoCov">          0 :             SCReinstanciateRef(dlist-&gt;sc,sc,layer);</span>
<span class="lineNum">    3295 </span><span class="lineNoCov">          0 :             SCRegenDependents(dlist-&gt;sc,layer);</span>
<span class="lineNum">    3296 </span>            :         }
<span class="lineNum">    3297 </span>            :     }
<a name="3298"><span class="lineNum">    3298 </span><span class="lineCov">        895 : }</span></a>
<span class="lineNum">    3299 </span>            : 
<span class="lineNum">    3300 </span><span class="lineNoCov">          0 : static void CVUpdateInfo(CharView *cv, GEvent *event) {</span>
<span class="lineNum">    3301 </span>            : 
<span class="lineNum">    3302 </span><span class="lineNoCov">          0 :     cv-&gt;info_within = true;</span>
<span class="lineNum">    3303 </span><span class="lineNoCov">          0 :     cv-&gt;e.x = event-&gt;u.mouse.x; cv-&gt;e.y = event-&gt;u.mouse.y;</span>
<span class="lineNum">    3304 </span><span class="lineNoCov">          0 :     cv-&gt;info.x = (event-&gt;u.mouse.x-cv-&gt;xoff)/cv-&gt;scale;</span>
<span class="lineNum">    3305 </span><span class="lineNoCov">          0 :     cv-&gt;info.y = (cv-&gt;height-event-&gt;u.mouse.y-cv-&gt;yoff)/cv-&gt;scale;</span>
<span class="lineNum">    3306 </span><span class="lineNoCov">          0 :     CVInfoDraw(cv,cv-&gt;gw);</span>
<a name="3307"><span class="lineNum">    3307 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3308 </span>            : 
<span class="lineNum">    3309 </span><span class="lineNoCov">          0 : static void CVNewScale(CharView *cv) {</span>
<span class="lineNum">    3310 </span>            :     GEvent e;
<span class="lineNum">    3311 </span>            : 
<span class="lineNum">    3312 </span><span class="lineNoCov">          0 :     CVRegenFill(cv);</span>
<span class="lineNum">    3313 </span><span class="lineNoCov">          0 :     cv-&gt;back_img_out_of_date = true;</span>
<span class="lineNum">    3314 </span>            : 
<span class="lineNum">    3315 </span><span class="lineNoCov">          0 :     GScrollBarSetBounds(cv-&gt;vsb,-20000*cv-&gt;scale,8000*cv-&gt;scale,cv-&gt;height);</span>
<span class="lineNum">    3316 </span><span class="lineNoCov">          0 :     GScrollBarSetBounds(cv-&gt;hsb,-8000*cv-&gt;scale,32000*cv-&gt;scale,cv-&gt;width);</span>
<span class="lineNum">    3317 </span><span class="lineNoCov">          0 :     GScrollBarSetPos(cv-&gt;vsb,cv-&gt;yoff-cv-&gt;height);</span>
<span class="lineNum">    3318 </span><span class="lineNoCov">          0 :     GScrollBarSetPos(cv-&gt;hsb,-cv-&gt;xoff);</span>
<span class="lineNum">    3319 </span>            : 
<span class="lineNum">    3320 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">    3321 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showrulers )</span>
<span class="lineNum">    3322 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(cv-&gt;gw,NULL,false);</span>
<span class="lineNum">    3323 </span><span class="lineNoCov">          0 :     GDrawGetPointerPosition(cv-&gt;v,&amp;e);</span>
<span class="lineNum">    3324 </span><span class="lineNoCov">          0 :     CVUpdateInfo(cv,&amp;e);</span>
<a name="3325"><span class="lineNum">    3325 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3326 </span>            : 
<span class="lineNum">    3327 </span><span class="lineNoCov">          0 : static void _CVFit(CharView *cv,DBounds *b, int integral) {</span>
<span class="lineNum">    3328 </span>            :     real left, right, top, bottom, hsc, wsc;
<span class="lineNum">    3329 </span>            :     extern int palettes_docked;
<span class="lineNum">    3330 </span><span class="lineNoCov">          0 :     int offset = palettes_docked ? 90 : 0;</span>
<span class="lineNum">    3331 </span><span class="lineNoCov">          0 :     int em = cv-&gt;b.sc-&gt;parent-&gt;ascent + cv-&gt;b.sc-&gt;parent-&gt;descent;</span>
<span class="lineNum">    3332 </span><span class="lineNoCov">          0 :     int hsmall = true;</span>
<span class="lineNum">    3333 </span>            : 
<span class="lineNum">    3334 </span><span class="lineNoCov">          0 :     if ( offset&gt;cv-&gt;width ) offset = 0;</span>
<span class="lineNum">    3335 </span>            : 
<span class="lineNum">    3336 </span><span class="lineNoCov">          0 :     bottom = b-&gt;miny;</span>
<span class="lineNum">    3337 </span><span class="lineNoCov">          0 :     top = b-&gt;maxy;</span>
<span class="lineNum">    3338 </span><span class="lineNoCov">          0 :     left = b-&gt;minx;</span>
<span class="lineNum">    3339 </span><span class="lineNoCov">          0 :     right = b-&gt;maxx;</span>
<span class="lineNum">    3340 </span>            : 
<span class="lineNum">    3341 </span><span class="lineNoCov">          0 :     if ( top&lt;bottom ) IError(&quot;Bottom bigger than top!&quot;);</span>
<span class="lineNum">    3342 </span><span class="lineNoCov">          0 :     if ( right&lt;left ) IError(&quot;Left bigger than right!&quot;);</span>
<span class="lineNum">    3343 </span><span class="lineNoCov">          0 :     top -= bottom;</span>
<span class="lineNum">    3344 </span><span class="lineNoCov">          0 :     right -= left;</span>
<span class="lineNum">    3345 </span><span class="lineNoCov">          0 :     if ( top==0 ) top = em;</span>
<span class="lineNum">    3346 </span><span class="lineNoCov">          0 :     if ( right==0 ) right = em;</span>
<span class="lineNum">    3347 </span><span class="lineNoCov">          0 :     wsc = (cv-&gt;width-offset) / right;</span>
<span class="lineNum">    3348 </span><span class="lineNoCov">          0 :     hsc = cv-&gt;height / top;</span>
<span class="lineNum">    3349 </span><span class="lineNoCov">          0 :     if ( wsc&lt;hsc ) { hsc = wsc; hsmall = false ; }</span>
<span class="lineNum">    3350 </span>            : 
<span class="lineNum">    3351 </span><span class="lineNoCov">          0 :     cv-&gt;scale = hsc;</span>
<span class="lineNum">    3352 </span><span class="lineNoCov">          0 :     if ( integral ) {</span>
<span class="lineNum">    3353 </span><span class="lineNoCov">          0 :         if ( cv-&gt;scale &gt; 1.0 ) {</span>
<span class="lineNum">    3354 </span><span class="lineNoCov">          0 :             cv-&gt;scale = floor(cv-&gt;scale);</span>
<span class="lineNum">    3355 </span>            :         } else {
<span class="lineNum">    3356 </span><span class="lineNoCov">          0 :             cv-&gt;scale = 1/ceil(1/cv-&gt;scale);</span>
<span class="lineNum">    3357 </span>            :         }
<span class="lineNum">    3358 </span>            :     } else {
<span class="lineNum">    3359 </span><span class="lineNoCov">          0 :         if ( cv-&gt;scale &gt; 1.0 ) {</span>
<span class="lineNum">    3360 </span><span class="lineNoCov">          0 :             cv-&gt;scale = floor(2*cv-&gt;scale)/2;</span>
<span class="lineNum">    3361 </span>            :         } else {
<span class="lineNum">    3362 </span><span class="lineNoCov">          0 :             cv-&gt;scale = 2/ceil(2/cv-&gt;scale);</span>
<span class="lineNum">    3363 </span>            :         }
<span class="lineNum">    3364 </span>            :     }
<span class="lineNum">    3365 </span>            : 
<span class="lineNum">    3366 </span>            :     /* Center glyph horizontally */
<span class="lineNum">    3367 </span><span class="lineNoCov">          0 :     cv-&gt;xoff = ( (cv-&gt;width-offset) - (right*cv-&gt;scale) )/2 + offset  - b-&gt;minx*cv-&gt;scale;</span>
<span class="lineNum">    3368 </span><span class="lineNoCov">          0 :     if ( hsmall )</span>
<span class="lineNum">    3369 </span><span class="lineNoCov">          0 :         cv-&gt;yoff = -bottom*cv-&gt;scale;</span>
<span class="lineNum">    3370 </span>            :     else
<span class="lineNum">    3371 </span><span class="lineNoCov">          0 :         cv-&gt;yoff = -(bottom+top/2)*cv-&gt;scale + cv-&gt;height/2;</span>
<span class="lineNum">    3372 </span>            : 
<span class="lineNum">    3373 </span><span class="lineNoCov">          0 :     CVNewScale(cv);</span>
<a name="3374"><span class="lineNum">    3374 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3375 </span>            : 
<span class="lineNum">    3376 </span><span class="lineNoCov">          0 : static void CVFit(CharView *cv) {</span>
<span class="lineNum">    3377 </span>            :     DBounds b;
<span class="lineNum">    3378 </span>            :     double center;
<span class="lineNum">    3379 </span>            : 
<span class="lineNum">    3380 </span><span class="lineNoCov">          0 :     SplineCharFindBounds(cv-&gt;b.sc,&amp;b);</span>
<span class="lineNum">    3381 </span><span class="lineNoCov">          0 :     if ( b.miny==0 &amp;&amp; b.maxy==0 ) {</span>
<span class="lineNum">    3382 </span><span class="lineNoCov">          0 :         b.maxy =cv-&gt;b.sc-&gt;parent-&gt;ascent;</span>
<span class="lineNum">    3383 </span><span class="lineNoCov">          0 :         b.miny = -cv-&gt;b.sc-&gt;parent-&gt;descent;</span>
<span class="lineNum">    3384 </span>            :     }
<span class="lineNum">    3385 </span>            :     /* FF used to normalize bounding boxes making maxx positive. But this */
<span class="lineNum">    3386 </span>            :     /* may result into an incorrect positioning for combining marks, which */
<span class="lineNum">    3387 </span>            :     /* usually have both bearings negative. So keep negative values as they are. */
<span class="lineNum">    3388 </span>            :     /* As for the Y axis, we only ensure the minimum value doesn't exceed zero, */
<span class="lineNum">    3389 </span>            :     /* so that the baseline is always visible. */
<span class="lineNum">    3390 </span>            : 
<span class="lineNum">    3391 </span><span class="lineNoCov">          0 :     if ( b.miny&gt;0 ) b.miny = 0;</span>
<span class="lineNum">    3392 </span>            : 
<span class="lineNum">    3393 </span>            :     /* Now give some extra space around the interesting stuff */
<span class="lineNum">    3394 </span><span class="lineNoCov">          0 :     center = (b.maxx+b.minx)/2;</span>
<span class="lineNum">    3395 </span><span class="lineNoCov">          0 :     b.minx = center - (center - b.minx)*1.2;</span>
<span class="lineNum">    3396 </span><span class="lineNoCov">          0 :     b.maxx = center + (b.maxx - center)*1.2;</span>
<span class="lineNum">    3397 </span><span class="lineNoCov">          0 :     center = (b.maxy+b.miny)/2;</span>
<span class="lineNum">    3398 </span><span class="lineNoCov">          0 :     b.miny = center - (center - b.miny)*1.2;</span>
<span class="lineNum">    3399 </span><span class="lineNoCov">          0 :     b.maxy = center + (b.maxy - center)*1.2;</span>
<span class="lineNum">    3400 </span>            : 
<span class="lineNum">    3401 </span><span class="lineNoCov">          0 :     _CVFit(cv,&amp;b,true);</span>
<a name="3402"><span class="lineNum">    3402 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3403 </span>            : 
<span class="lineNum">    3404 </span><span class="lineNoCov">          0 : static void CVUnlinkView(CharView *cv ) {</span>
<span class="lineNum">    3405 </span>            :     CharView *test;
<span class="lineNum">    3406 </span>            : 
<span class="lineNum">    3407 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc-&gt;views == (CharViewBase *) cv ) {</span>
<span class="lineNum">    3408 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;views = cv-&gt;b.next;</span>
<span class="lineNum">    3409 </span>            :     } else {
<span class="lineNum">    3410 </span><span class="lineNoCov">          0 :         for ( test=(CharView *) (cv-&gt;b.sc-&gt;views);</span>
<span class="lineNum">    3411 </span><span class="lineNoCov">          0 :                 test-&gt;b.next!=(CharViewBase *) cv &amp;&amp; test-&gt;b.next!=NULL;</span>
<span class="lineNum">    3412 </span><span class="lineNoCov">          0 :                 test=(CharView *) (test-&gt;b.next) );</span>
<span class="lineNum">    3413 </span><span class="lineNoCov">          0 :         if ( test-&gt;b.next==(CharViewBase *) cv )</span>
<span class="lineNum">    3414 </span><span class="lineNoCov">          0 :             test-&gt;b.next = cv-&gt;b.next;</span>
<span class="lineNum">    3415 </span>            :     }
<a name="3416"><span class="lineNum">    3416 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3417 </span>            : 
<span class="lineNum">    3418 </span><span class="lineNoCov">          0 : static GWindow CharIcon(CharView *cv, FontView *fv) {</span>
<span class="lineNum">    3419 </span><span class="lineNoCov">          0 :     SplineChar *sc = cv-&gt;b.sc;</span>
<span class="lineNum">    3420 </span>            :     BDFFont *bdf, *bdf2;
<span class="lineNum">    3421 </span>            :     BDFChar *bdfc;
<span class="lineNum">    3422 </span><span class="lineNoCov">          0 :     GWindow icon = cv-&gt;icon;</span>
<span class="lineNum">    3423 </span>            :     GRect r;
<span class="lineNum">    3424 </span>            : 
<span class="lineNum">    3425 </span><span class="lineNoCov">          0 :     r.x = r.y = 0; r.width = r.height = fv-&gt;cbw-1;</span>
<span class="lineNum">    3426 </span><span class="lineNoCov">          0 :     if ( icon == NULL )</span>
<span class="lineNum">    3427 </span><span class="lineNoCov">          0 :         cv-&gt;icon = icon = GDrawCreatePixmap(NULL,r.width,r.width);</span>
<span class="lineNum">    3428 </span><span class="lineNoCov">          0 :     GDrawFillRect(icon,&amp;r,0x0);             /* for some reason icons seem to be color reversed by my defn */</span>
<span class="lineNum">    3429 </span>            : 
<span class="lineNum">    3430 </span><span class="lineNoCov">          0 :     bdf = NULL; bdfc = NULL;</span>
<span class="lineNum">    3431 </span><span class="lineNoCov">          0 :     if ( sc-&gt;layers[ly_fore].refs!=NULL || sc-&gt;layers[ly_fore].splines!=NULL ) {</span>
<span class="lineNum">    3432 </span><span class="lineNoCov">          0 :         bdf = fv-&gt;show;</span>
<span class="lineNum">    3433 </span><span class="lineNoCov">          0 :         if ( sc-&gt;orig_pos&gt;=bdf-&gt;glyphcnt || bdf-&gt;glyphs[sc-&gt;orig_pos]==NULL )</span>
<span class="lineNum">    3434 </span><span class="lineNoCov">          0 :             bdf = fv-&gt;filled;</span>
<span class="lineNum">    3435 </span><span class="lineNoCov">          0 :         if ( sc-&gt;orig_pos&gt;=bdf-&gt;glyphcnt || bdf-&gt;glyphs[sc-&gt;orig_pos]==NULL ) {</span>
<span class="lineNum">    3436 </span><span class="lineNoCov">          0 :             bdf2 = NULL; bdfc = NULL;</span>
<span class="lineNum">    3437 </span><span class="lineNoCov">          0 :             for ( bdf=fv-&gt;b.sf-&gt;bitmaps; bdf!=NULL &amp;&amp; bdf-&gt;pixelsize&lt;24 ; bdf=bdf-&gt;next )</span>
<span class="lineNum">    3438 </span><span class="lineNoCov">          0 :                 bdf2 = bdf;</span>
<span class="lineNum">    3439 </span><span class="lineNoCov">          0 :             if ( bdf2!=NULL &amp;&amp; bdf!=NULL ) {</span>
<span class="lineNum">    3440 </span><span class="lineNoCov">          0 :                 if ( 24-bdf2-&gt;pixelsize &lt; bdf-&gt;pixelsize-24 )</span>
<span class="lineNum">    3441 </span><span class="lineNoCov">          0 :                     bdf = bdf2;</span>
<span class="lineNum">    3442 </span><span class="lineNoCov">          0 :             } else if ( bdf==NULL )</span>
<span class="lineNum">    3443 </span><span class="lineNoCov">          0 :                 bdf = bdf2;</span>
<span class="lineNum">    3444 </span>            :         }
<span class="lineNum">    3445 </span><span class="lineNoCov">          0 :         if ( bdf!=NULL &amp;&amp; sc-&gt;orig_pos&lt;bdf-&gt;glyphcnt )</span>
<span class="lineNum">    3446 </span><span class="lineNoCov">          0 :             bdfc = bdf-&gt;glyphs[sc-&gt;orig_pos];</span>
<span class="lineNum">    3447 </span>            :     }
<span class="lineNum">    3448 </span>            : 
<span class="lineNum">    3449 </span><span class="lineNoCov">          0 :     if ( bdfc!=NULL ) {</span>
<span class="lineNum">    3450 </span>            :         GClut clut;
<span class="lineNum">    3451 </span>            :         struct _GImage base;
<span class="lineNum">    3452 </span>            :         GImage gi;
<span class="lineNum">    3453 </span>            :         /* if not empty, use the font's own shape, otherwise use a standard */
<span class="lineNum">    3454 </span>            :         /*  font */
<span class="lineNum">    3455 </span><span class="lineNoCov">          0 :         memset(&amp;gi,'\0',sizeof(gi));</span>
<span class="lineNum">    3456 </span><span class="lineNoCov">          0 :         memset(&amp;base,'\0',sizeof(base));</span>
<span class="lineNum">    3457 </span><span class="lineNoCov">          0 :         memset(&amp;clut,'\0',sizeof(clut));</span>
<span class="lineNum">    3458 </span><span class="lineNoCov">          0 :         gi.u.image = &amp;base;</span>
<span class="lineNum">    3459 </span><span class="lineNoCov">          0 :         base.trans = -1;</span>
<span class="lineNum">    3460 </span><span class="lineNoCov">          0 :         base.clut = &amp;clut;</span>
<span class="lineNum">    3461 </span><span class="lineNoCov">          0 :         if ( bdfc-&gt;byte_data ) { int i;</span>
<span class="lineNum">    3462 </span><span class="lineNoCov">          0 :             base.image_type = it_index;</span>
<span class="lineNum">    3463 </span><span class="lineNoCov">          0 :             clut.clut_len = bdf-&gt;clut-&gt;clut_len;</span>
<span class="lineNum">    3464 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;clut.clut_len; ++i ) {</span>
<span class="lineNum">    3465 </span><span class="lineNoCov">          0 :                 int v = 255-i*255/(clut.clut_len-1);</span>
<span class="lineNum">    3466 </span><span class="lineNoCov">          0 :                 clut.clut[i] = COLOR_CREATE(v,v,v);</span>
<span class="lineNum">    3467 </span>            :             }
<span class="lineNum">    3468 </span><span class="lineNoCov">          0 :             clut.trans_index = -1;</span>
<span class="lineNum">    3469 </span>            :         } else {
<span class="lineNum">    3470 </span><span class="lineNoCov">          0 :             base.image_type = it_mono;</span>
<span class="lineNum">    3471 </span><span class="lineNoCov">          0 :             clut.clut_len = 2;</span>
<span class="lineNum">    3472 </span><span class="lineNoCov">          0 :             clut.clut[1] = 0xffffff;</span>
<span class="lineNum">    3473 </span>            :         }
<span class="lineNum">    3474 </span><span class="lineNoCov">          0 :         base.data = bdfc-&gt;bitmap;</span>
<span class="lineNum">    3475 </span><span class="lineNoCov">          0 :         base.bytes_per_line = bdfc-&gt;bytes_per_line;</span>
<span class="lineNum">    3476 </span><span class="lineNoCov">          0 :         base.width = bdfc-&gt;xmax-bdfc-&gt;xmin+1;</span>
<span class="lineNum">    3477 </span><span class="lineNoCov">          0 :         base.height = bdfc-&gt;ymax-bdfc-&gt;ymin+1;</span>
<span class="lineNum">    3478 </span><span class="lineNoCov">          0 :         GDrawDrawImage(icon,&amp;gi,NULL,(r.width-base.width)/2,(r.height-base.height)/2);</span>
<span class="lineNum">    3479 </span><span class="lineNoCov">          0 :     } else if ( sc-&gt;unicodeenc!=-1 ) {</span>
<span class="lineNum">    3480 </span>            :         FontRequest rq;
<span class="lineNum">    3481 </span>            :         GFont *font;
<span class="lineNum">    3482 </span>            :         unichar_t text[2];
<span class="lineNum">    3483 </span>            :         int as, ds, ld, width;
<span class="lineNum">    3484 </span>            : 
<span class="lineNum">    3485 </span><span class="lineNoCov">          0 :         memset(&amp;rq,0,sizeof(rq));</span>
<span class="lineNum">    3486 </span><span class="lineNoCov">          0 :         rq.utf8_family_name = SERIF_UI_FAMILIES;</span>
<span class="lineNum">    3487 </span><span class="lineNoCov">          0 :         rq.point_size = 24;</span>
<span class="lineNum">    3488 </span><span class="lineNoCov">          0 :         rq.weight = 400;</span>
<span class="lineNum">    3489 </span><span class="lineNoCov">          0 :         font = GDrawInstanciateFont(NULL,&amp;rq);</span>
<span class="lineNum">    3490 </span><span class="lineNoCov">          0 :         GDrawSetFont(icon,font);</span>
<span class="lineNum">    3491 </span><span class="lineNoCov">          0 :         text[0] = sc-&gt;unicodeenc; text[1] = 0;</span>
<span class="lineNum">    3492 </span><span class="lineNoCov">          0 :         GDrawWindowFontMetrics(icon,font,&amp;as,&amp;ds,&amp;ld);</span>
<span class="lineNum">    3493 </span><span class="lineNoCov">          0 :         width = GDrawGetTextWidth(icon,text,1);</span>
<span class="lineNum">    3494 </span><span class="lineNoCov">          0 :         GDrawDrawText(icon,(r.width-width)/2,(r.height-as-ds)/2+as,text,1,0xffffff);</span>
<span class="lineNum">    3495 </span>            :     }
<span class="lineNum">    3496 </span><span class="lineNoCov">          0 : return( icon );</span>
<a name="3497"><span class="lineNum">    3497 </span>            : }</a>
<span class="lineNum">    3498 </span>            : 
<span class="lineNum">    3499 </span><span class="lineNoCov">          0 : static int CVCurEnc(CharView *cv)</span>
<span class="lineNum">    3500 </span>            : {
<span class="lineNum">    3501 </span><span class="lineNoCov">          0 :     if ( cv-&gt;map_of_enc == ((FontView *) (cv-&gt;b.fv))-&gt;b.map &amp;&amp; cv-&gt;enc!=-1 )</span>
<span class="lineNum">    3502 </span><span class="lineNoCov">          0 :         return( cv-&gt;enc );</span>
<span class="lineNum">    3503 </span>            : 
<span class="lineNum">    3504 </span><span class="lineNoCov">          0 :     return( ((FontView *) (cv-&gt;b.fv))-&gt;b.map-&gt;backmap[cv-&gt;b.sc-&gt;orig_pos] );</span>
<a name="3505"><span class="lineNum">    3505 </span>            : }</a>
<span class="lineNum">    3506 </span>            : 
<span class="lineNum">    3507 </span><span class="lineNoCov">          0 : static char *CVMakeTitles(CharView *cv,char *buf,size_t len) {</span>
<span class="lineNum">    3508 </span>            :     char *title;
<span class="lineNum">    3509 </span><span class="lineNoCov">          0 :     SplineChar *sc = cv-&gt;b.sc;</span>
<span class="lineNum">    3510 </span><span class="lineNoCov">          0 :     SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">    3511 </span>            :     char *uniname;
<span class="lineNum">    3512 </span>            :     size_t used;
<span class="lineNum">    3513 </span>            : 
<span class="lineNum">    3514 </span>            : /* GT: This is the title for a window showing an outline character */
<span class="lineNum">    3515 </span>            : /* GT: It will look something like: */
<span class="lineNum">    3516 </span>            : /* GT:  exclam at 33 from Arial */
<span class="lineNum">    3517 </span>            : /* GT: $1 is the name of the glyph */
<span class="lineNum">    3518 </span>            : /* GT: $2 is the glyph's encoding */
<span class="lineNum">    3519 </span>            : /* GT: $3 is the font name */
<span class="lineNum">    3520 </span>            : /* GT: $4 is the changed flag ('*' for the changed items)*/
<span class="lineNum">    3521 </span><span class="lineNoCov">          0 :     used = snprintf(buf,len,_(&quot;%1$.80s at %2$d from %3$.90s%4$s&quot;),</span>
<span class="lineNum">    3522 </span>            :                     sc-&gt;name, CVCurEnc(cv), sf-&gt;fontname,
<span class="lineNum">    3523 </span><span class="lineNoCov">          0 :                     sc-&gt;changed ? &quot;*&quot; : &quot;&quot;);</span>
<span class="lineNum">    3524 </span><span class="lineNoCov">          0 :     title = copy(buf);</span>
<span class="lineNum">    3525 </span>            : 
<span class="lineNum">    3526 </span><span class="lineNoCov">          0 :     if (used &lt; len) {</span>
<span class="lineNum">    3527 </span>            :         /* Enhance 'buf' description with Nameslist.txt unicode name definition */
<span class="lineNum">    3528 </span><span class="lineNoCov">          0 :         if ( (uniname=unicode_name(sc-&gt;unicodeenc))!=NULL ) {</span>
<span class="lineNum">    3529 </span><span class="lineNoCov">          0 :             used += snprintf(buf+used, len-used, &quot; %s&quot;, uniname);</span>
<span class="lineNum">    3530 </span><span class="lineNoCov">          0 :             free(uniname);</span>
<span class="lineNum">    3531 </span>            :         }
<span class="lineNum">    3532 </span>            :     }
<span class="lineNum">    3533 </span>            : 
<span class="lineNum">    3534 </span><span class="lineNoCov">          0 :     if (used &lt; len &amp;&amp; ( cv-&gt;show_ft_results || cv-&gt;dv )) {</span>
<span class="lineNum">    3535 </span><span class="lineNoCov">          0 :         snprintf(buf+used, len-used, &quot; (%gpt, %ddpi)&quot;, (double) cv-&gt;ft_pointsizey, cv-&gt;ft_dpi );</span>
<span class="lineNum">    3536 </span>            :     }
<span class="lineNum">    3537 </span>            : 
<span class="lineNum">    3538 </span><span class="lineNoCov">          0 :     return( title );</span>
<a name="3539"><span class="lineNum">    3539 </span>            : }</a>
<span class="lineNum">    3540 </span>            : 
<span class="lineNum">    3541 </span><span class="lineCov">       3750 : static void SC_RefreshTitles(SplineChar *sc) {</span>
<span class="lineNum">    3542 </span>            :     /* Called if the user changes the unicode encoding or the character name */
<span class="lineNum">    3543 </span>            :     CharView *cv;
<span class="lineNum">    3544 </span>            :     char buf[300], *title;
<span class="lineNum">    3545 </span>            : 
<span class="lineNum">    3546 </span><span class="lineCov">       3750 :     if ( (CharView *) (sc-&gt;views)==NULL )</span>
<span class="lineNum">    3547 </span><span class="lineCov">       7500 : return;</span>
<span class="lineNum">    3548 </span><span class="lineNoCov">          0 :     for ( cv = (CharView *) (sc-&gt;views); cv!=NULL; cv=(CharView *) (cv-&gt;b.next) ) {</span>
<span class="lineNum">    3549 </span><span class="lineNoCov">          0 :         title = CVMakeTitles(cv,buf,sizeof(buf));</span>
<span class="lineNum">    3550 </span>            :         /* Could be different if one window is debugging and one is not */
<span class="lineNum">    3551 </span><span class="lineNoCov">          0 :         GDrawSetWindowTitles8(cv-&gt;gw,buf,title);</span>
<span class="lineNum">    3552 </span><span class="lineNoCov">          0 :         free(title);</span>
<span class="lineNum">    3553 </span>            :     }
<a name="3554"><span class="lineNum">    3554 </span>            : }</a>
<span class="lineNum">    3555 </span>            : 
<span class="lineNum">    3556 </span><span class="lineNoCov">          0 : static void CVChangeTabsVisibility(CharView *cv,int makevisible) {</span>
<span class="lineNum">    3557 </span>            :     GRect gsize, pos, sbsize;
<span class="lineNum">    3558 </span>            : 
<span class="lineNum">    3559 </span><span class="lineNoCov">          0 :     if ( cv-&gt;tabs==NULL || GGadgetIsVisible(cv-&gt;tabs)==makevisible )</span>
<span class="lineNum">    3560 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3561 </span><span class="lineNoCov">          0 :     GGadgetGetSize(cv-&gt;tabs,&amp;gsize);</span>
<span class="lineNum">    3562 </span><span class="lineNoCov">          0 :     GGadgetGetSize(cv-&gt;vsb,&amp;sbsize);</span>
<span class="lineNum">    3563 </span><span class="lineNoCov">          0 :     if ( makevisible ) {</span>
<span class="lineNum">    3564 </span><span class="lineNoCov">          0 :         cv-&gt;mbh += gsize.height;</span>
<span class="lineNum">    3565 </span><span class="lineNoCov">          0 :         cv-&gt;height -= gsize.height;</span>
<span class="lineNum">    3566 </span><span class="lineNoCov">          0 :         GGadgetMove(cv-&gt;vsb,sbsize.x,sbsize.y+gsize.height);</span>
<span class="lineNum">    3567 </span><span class="lineNoCov">          0 :         GGadgetResize(cv-&gt;vsb,sbsize.width,sbsize.height-gsize.height);</span>
<span class="lineNum">    3568 </span><span class="lineNoCov">          0 :         GGadgetMoveAddToY( cv-&gt;charselector, gsize.height );</span>
<span class="lineNum">    3569 </span><span class="lineNoCov">          0 :         GGadgetMoveAddToY( cv-&gt;charselectorNext, gsize.height );</span>
<span class="lineNum">    3570 </span><span class="lineNoCov">          0 :         GGadgetMoveAddToY( cv-&gt;charselectorPrev, gsize.height );</span>
<span class="lineNum">    3571 </span>            :     } else {
<span class="lineNum">    3572 </span><span class="lineNoCov">          0 :         cv-&gt;mbh -= gsize.height;</span>
<span class="lineNum">    3573 </span><span class="lineNoCov">          0 :         cv-&gt;height += gsize.height;</span>
<span class="lineNum">    3574 </span><span class="lineNoCov">          0 :         GGadgetMove(cv-&gt;vsb,sbsize.x,sbsize.y-gsize.height);</span>
<span class="lineNum">    3575 </span><span class="lineNoCov">          0 :         GGadgetResize(cv-&gt;vsb,sbsize.width,sbsize.height+gsize.height);</span>
<span class="lineNum">    3576 </span><span class="lineNoCov">          0 :         GGadgetMoveAddToY( cv-&gt;charselector, -1*gsize.height );</span>
<span class="lineNum">    3577 </span><span class="lineNoCov">          0 :         GGadgetMoveAddToY( cv-&gt;charselectorNext, -1*gsize.height );</span>
<span class="lineNum">    3578 </span><span class="lineNoCov">          0 :         GGadgetMoveAddToY( cv-&gt;charselectorPrev, -1*gsize.height );</span>
<span class="lineNum">    3579 </span>            :     }
<span class="lineNum">    3580 </span><span class="lineNoCov">          0 :     GGadgetSetVisible(cv-&gt;tabs,makevisible);</span>
<span class="lineNum">    3581 </span><span class="lineNoCov">          0 :     cv-&gt;back_img_out_of_date = true;</span>
<span class="lineNum">    3582 </span><span class="lineNoCov">          0 :     pos.x = 0; pos.y = cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh;</span>
<span class="lineNum">    3583 </span><span class="lineNoCov">          0 :     pos.width = cv-&gt;width; pos.height = cv-&gt;height;</span>
<span class="lineNum">    3584 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showrulers ) {</span>
<span class="lineNum">    3585 </span><span class="lineNoCov">          0 :         pos.x += cv-&gt;rulerh;</span>
<span class="lineNum">    3586 </span><span class="lineNoCov">          0 :         pos.y += cv-&gt;rulerh;</span>
<span class="lineNum">    3587 </span>            :     }
<span class="lineNum">    3588 </span><span class="lineNoCov">          0 :     GDrawMoveResize(cv-&gt;v,pos.x,pos.y,pos.width,pos.height);</span>
<span class="lineNum">    3589 </span><span class="lineNoCov">          0 :     GDrawSync(NULL);</span>
<span class="lineNum">    3590 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">    3591 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;gw,NULL,false);</span>
<a name="3592"><span class="lineNum">    3592 </span>            : }</a>
<span class="lineNum">    3593 </span>            : 
<span class="lineNum">    3594 </span><span class="lineNoCov">          0 : static void CVCheckPoints(CharView *cv) {</span>
<span class="lineNum">    3595 </span><span class="lineNoCov">          0 :     if ( !SCPointsNumberedProperly(cv-&gt;b.sc,CVLayer((CharViewBase *) cv)) &amp;&amp; cv-&gt;b.sc-&gt;ttf_instrs_len!=0 ) {</span>
<span class="lineNum">    3596 </span>            :         char *buts[3];
<span class="lineNum">    3597 </span>            :         int answer;
<span class="lineNum">    3598 </span><span class="lineNoCov">          0 :         buts[0] = _(&quot;_Yes&quot;);</span>
<span class="lineNum">    3599 </span><span class="lineNoCov">          0 :         buts[1] = _(&quot;_No&quot;);</span>
<span class="lineNum">    3600 </span><span class="lineNoCov">          0 :         buts[2] = NULL;</span>
<span class="lineNum">    3601 </span><span class="lineNoCov">          0 :         answer = ff_ask(_(&quot;Bad Point Numbering&quot;),(const char **) buts,0,1,_(&quot;The points in %s are not numbered properly. This means that any instructions will probably move the wrong points and do the wrong thing.\nWould you like me to remove the instructions?&quot;),cv-&gt;b.sc-&gt;name);</span>
<span class="lineNum">    3602 </span><span class="lineNoCov">          0 :         if ( answer==0 ) {</span>
<span class="lineNum">    3603 </span><span class="lineNoCov">          0 :             free(cv-&gt;b.sc-&gt;ttf_instrs); cv-&gt;b.sc-&gt;ttf_instrs = NULL;</span>
<span class="lineNum">    3604 </span><span class="lineNoCov">          0 :             cv-&gt;b.sc-&gt;ttf_instrs_len = 0;</span>
<span class="lineNum">    3605 </span>            :         }
<span class="lineNum">    3606 </span>            :     }
<a name="3607"><span class="lineNum">    3607 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3608 </span>            : 
<span class="lineNum">    3609 </span><span class="lineNoCov">          0 : static void CVChangeSC_storeTab( CharView *cv, int tabnumber )</span>
<span class="lineNum">    3610 </span>            : {
<span class="lineNum">    3611 </span>            :     TRACE(&quot;CVChangeSC_storeTab() %d\n&quot;, tabnumber );
<span class="lineNum">    3612 </span><span class="lineNoCov">          0 :     if( tabnumber &lt; charview_cvtabssz )</span>
<span class="lineNum">    3613 </span>            :     {
<span class="lineNum">    3614 </span><span class="lineNoCov">          0 :         CharViewTab* t = &amp;cv-&gt;cvtabs[tabnumber];</span>
<span class="lineNum">    3615 </span><span class="lineNoCov">          0 :         strncpy( t-&gt;charselected,</span>
<span class="lineNum">    3616 </span><span class="lineNoCov">          0 :                  GGadgetGetTitle8(cv-&gt;charselector),</span>
<span class="lineNum">    3617 </span>            :                  charviewtab_charselectedsz );
<span class="lineNum">    3618 </span>            :     }
<a name="3619"><span class="lineNum">    3619 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3620 </span>            : 
<span class="lineNum">    3621 </span><span class="lineNoCov">          0 : static void CVChangeSC_fetchTab( CharView *cv, int tabnumber )</span>
<span class="lineNum">    3622 </span>            : {
<span class="lineNum">    3623 </span><span class="lineNoCov">          0 :     if( tabnumber &lt; charview_cvtabssz )</span>
<span class="lineNum">    3624 </span>            :     {
<span class="lineNum">    3625 </span><span class="lineNoCov">          0 :         CharViewTab* t = &amp;cv-&gt;cvtabs[tabnumber];</span>
<span class="lineNum">    3626 </span><span class="lineNoCov">          0 :         GGadgetSetTitle8(cv-&gt;charselector, t-&gt;charselected );</span>
<span class="lineNum">    3627 </span>            :     }
<a name="3628"><span class="lineNum">    3628 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3629 </span>            : 
<span class="lineNum">    3630 </span><span class="lineNoCov">          0 : static void CVSetCharSelectorValueFromSC( CharView *cv, SplineChar *sc )</span>
<span class="lineNum">    3631 </span>            : {
<span class="lineNum">    3632 </span><span class="lineNoCov">          0 :     const char* title = Wordlist_getSCName( sc );</span>
<span class="lineNum">    3633 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(cv-&gt;charselector, title);</span>
<span class="lineNum">    3634 </span><span class="lineNoCov">          0 : }</span>
<a name="3635"><span class="lineNum">    3635 </span>            :             </a>
<span class="lineNum">    3636 </span>            : 
<span class="lineNum">    3637 </span><span class="lineNoCov">          0 : void CVChangeSC( CharView *cv, SplineChar *sc )</span>
<span class="lineNum">    3638 </span>            : {
<span class="lineNum">    3639 </span>            :     char *title;
<span class="lineNum">    3640 </span>            :     char buf[300];
<span class="lineNum">    3641 </span>            :     extern int updateflex;
<span class="lineNum">    3642 </span>            :     int i;
<span class="lineNum">    3643 </span><span class="lineNoCov">          0 :     int old_layer = CVLayer((CharViewBase *) cv), blayer;</span>
<span class="lineNum">    3644 </span><span class="lineNoCov">          0 :     int was_fitted = cv-&gt;dv==NULL &amp;&amp; cv-&gt;b.gridfit!=NULL;</span>
<span class="lineNum">    3645 </span>            : 
<span class="lineNum">    3646 </span><span class="lineNoCov">          0 :     if ( old_layer&gt;=sc-&gt;layer_cnt )</span>
<span class="lineNum">    3647 </span><span class="lineNoCov">          0 :         old_layer = ly_fore;            /* Can happen in type3 fonts where each glyph has a different layer cnt */</span>
<span class="lineNum">    3648 </span>            : 
<span class="lineNum">    3649 </span><span class="lineNoCov">          0 :     memset( cv-&gt;additionalCharsToShow, 0, sizeof(SplineChar*) * additionalCharsToShowLimit );</span>
<span class="lineNum">    3650 </span><span class="lineNoCov">          0 :     cv-&gt;additionalCharsToShowActiveIndex = 0;</span>
<span class="lineNum">    3651 </span><span class="lineNoCov">          0 :     cv-&gt;additionalCharsToShow[0] = sc;</span>
<span class="lineNum">    3652 </span>            :     
<span class="lineNum">    3653 </span><span class="lineNoCov">          0 :     CVDebugFree(cv-&gt;dv);</span>
<span class="lineNum">    3654 </span>            : 
<span class="lineNum">    3655 </span><span class="lineNoCov">          0 :     if ( cv-&gt;expandedge != ee_none ) {</span>
<span class="lineNum">    3656 </span><span class="lineNoCov">          0 :         GDrawSetCursor(cv-&gt;v,ct_mypointer);</span>
<span class="lineNum">    3657 </span><span class="lineNoCov">          0 :         cv-&gt;expandedge = ee_none;</span>
<span class="lineNum">    3658 </span>            :     }
<span class="lineNum">    3659 </span>            : 
<span class="lineNum">    3660 </span><span class="lineNoCov">          0 :     SplinePointListsFree(cv-&gt;b.gridfit); cv-&gt;b.gridfit = NULL;</span>
<span class="lineNum">    3661 </span><span class="lineNoCov">          0 :     FreeType_FreeRaster(cv-&gt;oldraster); cv-&gt;oldraster = NULL;</span>
<span class="lineNum">    3662 </span><span class="lineNoCov">          0 :     FreeType_FreeRaster(cv-&gt;raster); cv-&gt;raster = NULL;</span>
<span class="lineNum">    3663 </span>            : 
<span class="lineNum">    3664 </span><span class="lineNoCov">          0 :     SCLigCaretCheck(sc,false);</span>
<span class="lineNum">    3665 </span>            : 
<span class="lineNum">    3666 </span><span class="lineNoCov">          0 :     CVUnlinkView(cv);</span>
<span class="lineNum">    3667 </span><span class="lineNoCov">          0 :     cv-&gt;p.nextcp = cv-&gt;p.prevcp = cv-&gt;widthsel = cv-&gt;vwidthsel = false;</span>
<span class="lineNum">    3668 </span><span class="lineNoCov">          0 :     if ( (CharView *) (sc-&gt;views)==NULL &amp;&amp; updateflex )</span>
<span class="lineNum">    3669 </span><span class="lineNoCov">          0 :         SplineCharIsFlexible(sc,old_layer!=ly_grid ? old_layer : ly_fore );</span>
<span class="lineNum">    3670 </span><span class="lineNoCov">          0 :     cv-&gt;b.sc = sc;</span>
<span class="lineNum">    3671 </span><span class="lineNoCov">          0 :     cv-&gt;b.next = sc-&gt;views;</span>
<span class="lineNum">    3672 </span><span class="lineNoCov">          0 :     sc-&gt;views = &amp;cv-&gt;b;</span>
<span class="lineNum">    3673 </span><span class="lineNoCov">          0 :     cv-&gt;enc = ( ((FontView *) (cv-&gt;b.fv))-&gt;b.map-&gt;backmap[cv-&gt;b.sc-&gt;orig_pos] );</span>
<span class="lineNum">    3674 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[dm_fore] = &amp;sc-&gt;layers[ly_fore];</span>
<span class="lineNum">    3675 </span><span class="lineNoCov">          0 :     blayer = old_layer;</span>
<span class="lineNum">    3676 </span><span class="lineNoCov">          0 :     if ( old_layer==ly_grid || old_layer==ly_fore ||</span>
<span class="lineNum">    3677 </span><span class="lineNoCov">          0 :             sc-&gt;parent-&gt;multilayer || old_layer&gt;=sc-&gt;layer_cnt )</span>
<span class="lineNum">    3678 </span><span class="lineNoCov">          0 :         blayer = ly_back;</span>
<span class="lineNum">    3679 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[dm_back] = &amp;sc-&gt;layers[blayer];</span>
<span class="lineNum">    3680 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[dm_grid] = &amp;sc-&gt;parent-&gt;grid;</span>
<span class="lineNum">    3681 </span><span class="lineNoCov">          0 :     cv-&gt;p.sp = cv-&gt;lastselpt = NULL;</span>
<span class="lineNum">    3682 </span><span class="lineNoCov">          0 :     cv-&gt;p.spiro = cv-&gt;lastselcp = NULL;</span>
<span class="lineNum">    3683 </span><span class="lineNoCov">          0 :     cv-&gt;apmine = cv-&gt;apmatch = NULL; cv-&gt;apsc = NULL;</span>
<span class="lineNum">    3684 </span><span class="lineNoCov">          0 :     cv-&gt;template1 = cv-&gt;template2 = NULL;</span>
<span class="lineNum">    3685 </span>            : #if HANYANG
<span class="lineNum">    3686 </span>            :     if ( cv-&gt;b.sc-&gt;parent-&gt;rules!=NULL &amp;&amp; cv-&gt;b.sc-&gt;compositionunit )
<span class="lineNum">    3687 </span>            :         Disp_DefaultTemplate(cv);
<span class="lineNum">    3688 </span>            : #endif
<span class="lineNum">    3689 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2 )</span>
<span class="lineNum">    3690 </span><span class="lineNoCov">          0 :         CVCheckPoints(cv);</span>
<span class="lineNum">    3691 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showpointnumbers || cv-&gt;show_ft_results )</span>
<span class="lineNum">    3692 </span><span class="lineNoCov">          0 :         SCNumberPoints(sc,old_layer);</span>
<span class="lineNum">    3693 </span><span class="lineNoCov">          0 :     if ( cv-&gt;show_ft_results )</span>
<span class="lineNum">    3694 </span><span class="lineNoCov">          0 :         CVGridFitChar(cv);</span>
<span class="lineNum">    3695 </span>            : 
<span class="lineNum">    3696 </span><span class="lineNoCov">          0 :     CVNewScale(cv);</span>
<span class="lineNum">    3697 </span>            : 
<span class="lineNum">    3698 </span><span class="lineNoCov">          0 :     CharIcon(cv,(FontView *) (cv-&gt;b.fv));</span>
<span class="lineNum">    3699 </span><span class="lineNoCov">          0 :     title = CVMakeTitles(cv,buf,sizeof(buf));</span>
<span class="lineNum">    3700 </span><span class="lineNoCov">          0 :     GDrawSetWindowTitles8(cv-&gt;gw,buf,title);</span>
<span class="lineNum">    3701 </span><span class="lineNoCov">          0 :     CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    3702 </span><span class="lineNoCov">          0 :     free(title);</span>
<span class="lineNum">    3703 </span><span class="lineNoCov">          0 :     _CVPaletteActivate(cv,true);</span>
<span class="lineNum">    3704 </span>            : 
<span class="lineNum">    3705 </span><span class="lineNoCov">          0 :     if ( cv-&gt;tabs!=NULL ) {</span>
<span class="lineNum">    3706 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;cv-&gt;former_cnt; ++i )</span>
<span class="lineNum">    3707 </span><span class="lineNoCov">          0 :             if ( strcmp(cv-&gt;former_names[i],sc-&gt;name)==0 )</span>
<span class="lineNum">    3708 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    3709 </span><span class="lineNoCov">          0 :         if ( i!=cv-&gt;former_cnt &amp;&amp; cv-&gt;showtabs )</span>
<span class="lineNum">    3710 </span>            :         {
<span class="lineNum">    3711 </span><span class="lineNoCov">          0 :             CVChangeSC_storeTab( cv, cv-&gt;oldtabnum );</span>
<span class="lineNum">    3712 </span><span class="lineNoCov">          0 :             CVChangeSC_fetchTab( cv, i );</span>
<span class="lineNum">    3713 </span><span class="lineNoCov">          0 :             cv-&gt;oldtabnum = i;</span>
<span class="lineNum">    3714 </span><span class="lineNoCov">          0 :             GTabSetSetSel(cv-&gt;tabs,i);</span>
<span class="lineNum">    3715 </span>            :         }
<span class="lineNum">    3716 </span>            :         else
<span class="lineNum">    3717 </span>            :         {
<span class="lineNum">    3718 </span>            :             // Only need to store here, as we are about to make a new tab.
<span class="lineNum">    3719 </span><span class="lineNoCov">          0 :             CVChangeSC_storeTab( cv, cv-&gt;oldtabnum );</span>
<span class="lineNum">    3720 </span><span class="lineNoCov">          0 :             cv-&gt;oldtabnum = 0;</span>
<span class="lineNum">    3721 </span>            :             // have to shuffle the cvtabs along to be in sync with cv-&gt;tabs
<span class="lineNum">    3722 </span>            :             {
<span class="lineNum">    3723 </span><span class="lineNoCov">          0 :                 int i = 0;</span>
<span class="lineNum">    3724 </span><span class="lineNoCov">          0 :                 for( i=charview_cvtabssz-1; i &gt; 0; i-- )</span>
<span class="lineNum">    3725 </span>            :                 {
<span class="lineNum">    3726 </span><span class="lineNoCov">          0 :                     cv-&gt;cvtabs[i] = cv-&gt;cvtabs[i-1];</span>
<span class="lineNum">    3727 </span>            :                 }
<span class="lineNum">    3728 </span>            :             }
<span class="lineNum">    3729 </span><span class="lineNoCov">          0 :             CVSetCharSelectorValueFromSC( cv, sc );</span>
<span class="lineNum">    3730 </span>            :             
<span class="lineNum">    3731 </span>            : 
<span class="lineNum">    3732 </span>            : 
<span class="lineNum">    3733 </span><span class="lineNoCov">          0 :             if ( cv-&gt;former_cnt==FORMER_MAX )</span>
<span class="lineNum">    3734 </span><span class="lineNoCov">          0 :                 free(cv-&gt;former_names[FORMER_MAX-1]);</span>
<span class="lineNum">    3735 </span><span class="lineNoCov">          0 :             for ( i=cv-&gt;former_cnt&lt;FORMER_MAX?cv-&gt;former_cnt-1:FORMER_MAX-2; i&gt;=0; --i )</span>
<span class="lineNum">    3736 </span><span class="lineNoCov">          0 :                 cv-&gt;former_names[i+1] = cv-&gt;former_names[i];</span>
<span class="lineNum">    3737 </span><span class="lineNoCov">          0 :             cv-&gt;former_names[0] = copy(sc-&gt;name);</span>
<span class="lineNum">    3738 </span><span class="lineNoCov">          0 :             if ( cv-&gt;former_cnt&lt;FORMER_MAX )</span>
<span class="lineNum">    3739 </span><span class="lineNoCov">          0 :                 ++cv-&gt;former_cnt;</span>
<span class="lineNum">    3740 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;cv-&gt;former_cnt; ++i )</span>
<span class="lineNum">    3741 </span>            :             {
<span class="lineNum">    3742 </span><span class="lineNoCov">          0 :                 if( i &lt; charview_cvtabssz )</span>
<span class="lineNum">    3743 </span>            :                 {
<span class="lineNum">    3744 </span><span class="lineNoCov">          0 :                     CharViewTab* t = &amp;cv-&gt;cvtabs[i];</span>
<span class="lineNum">    3745 </span><span class="lineNoCov">          0 :                     GTabSetChangeTabName(cv-&gt;tabs, t-&gt;charselected, i);</span>
<span class="lineNum">    3746 </span>            :                 }
<span class="lineNum">    3747 </span>            :             }
<span class="lineNum">    3748 </span>            :             
<span class="lineNum">    3749 </span><span class="lineNoCov">          0 :             GTabSetRemetric(cv-&gt;tabs);</span>
<span class="lineNum">    3750 </span><span class="lineNoCov">          0 :             GTabSetSetSel(cv-&gt;tabs,0);       /* This does a redraw */</span>
<span class="lineNum">    3751 </span><span class="lineNoCov">          0 :             if ( !GGadgetIsVisible(cv-&gt;tabs) &amp;&amp; cv-&gt;showtabs )</span>
<span class="lineNum">    3752 </span><span class="lineNoCov">          0 :                 CVChangeTabsVisibility(cv,true);</span>
<span class="lineNum">    3753 </span>            :         }
<span class="lineNum">    3754 </span>            :     }
<span class="lineNum">    3755 </span><span class="lineNoCov">          0 :     if( !strcmp(GGadgetGetTitle8(cv-&gt;charselector),&quot;&quot;))</span>
<span class="lineNum">    3756 </span><span class="lineNoCov">          0 :         CVSetCharSelectorValueFromSC( cv, sc );</span>
<span class="lineNum">    3757 </span>            : 
<span class="lineNum">    3758 </span><span class="lineNoCov">          0 :     if ( sc-&gt;inspiro &amp;&amp; !hasspiro() &amp;&amp; !sc-&gt;parent-&gt;complained_about_spiros ) {</span>
<span class="lineNum">    3759 </span><span class="lineNoCov">          0 :         sc-&gt;parent-&gt;complained_about_spiros = true;</span>
<span class="lineNum">    3760 </span>            : #ifdef _NO_LIBSPIRO
<span class="lineNum">    3761 </span>            :         ff_post_error(_(&quot;You may not use spiros&quot;),_(&quot;This glyph should display spiro points, but unfortunately this version of fontforge was not linked with the spiro library, so only normal bezier points will be displayed.&quot;));
<span class="lineNum">    3762 </span>            : #else
<span class="lineNum">    3763 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;You may not use spiros&quot;),_(&quot;This glyph should display spiro points, but unfortunately FontForge was unable to load libspiro, spiros are not available for use, and normal bezier points will be displayed instead.&quot;));</span>
<span class="lineNum">    3764 </span>            : #endif
<span class="lineNum">    3765 </span>            :     }
<span class="lineNum">    3766 </span>            : 
<span class="lineNum">    3767 </span><span class="lineNoCov">          0 :     if ( was_fitted )</span>
<span class="lineNum">    3768 </span><span class="lineNoCov">          0 :         CVGridFitChar(cv);</span>
<span class="lineNum">    3769 </span>            : 
<span class="lineNum">    3770 </span>            :     // Force any extra chars to be setup and drawn
<span class="lineNum">    3771 </span>            :     GEvent e;
<span class="lineNum">    3772 </span><span class="lineNoCov">          0 :     e.type=et_controlevent;</span>
<span class="lineNum">    3773 </span><span class="lineNoCov">          0 :     e.u.control.subtype = et_textchanged;</span>
<span class="lineNum">    3774 </span><span class="lineNoCov">          0 :     e.u.control.u.tf_changed.from_pulldown = 0;</span>
<span class="lineNum">    3775 </span><span class="lineNoCov">          0 :     CV_OnCharSelectorTextChanged( cv-&gt;charselector, &amp;e );</span>
<a name="3776"><span class="lineNum">    3776 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3777 </span>            : 
<span class="lineNum">    3778 </span><span class="lineNoCov">          0 : static void CVChangeChar(CharView *cv, int i )</span>
<span class="lineNum">    3779 </span>            : {
<span class="lineNum">    3780 </span>            :     SplineChar *sc;
<span class="lineNum">    3781 </span><span class="lineNoCov">          0 :     SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">    3782 </span><span class="lineNoCov">          0 :     EncMap *map = ((FontView *) (cv-&gt;b.fv))-&gt;b.map;</span>
<span class="lineNum">    3783 </span><span class="lineNoCov">          0 :     int gid = i&lt;0 || i&gt;= map-&gt;enccount ? -2 : map-&gt;map[i];</span>
<span class="lineNum">    3784 </span>            : 
<span class="lineNum">    3785 </span><span class="lineNoCov">          0 :     if ( sf-&gt;cidmaster!=NULL &amp;&amp; !map-&gt;enc-&gt;is_compact ) {</span>
<span class="lineNum">    3786 </span><span class="lineNoCov">          0 :         SplineFont *cidmaster = sf-&gt;cidmaster;</span>
<span class="lineNum">    3787 </span>            :         int k;
<span class="lineNum">    3788 </span><span class="lineNoCov">          0 :         for ( k=0; k&lt;cidmaster-&gt;subfontcnt; ++k ) {</span>
<span class="lineNum">    3789 </span><span class="lineNoCov">          0 :             SplineFont *sf = cidmaster-&gt;subfonts[k];</span>
<span class="lineNum">    3790 </span><span class="lineNoCov">          0 :             if ( i&lt;sf-&gt;glyphcnt &amp;&amp; sf-&gt;glyphs[i]!=NULL )</span>
<span class="lineNum">    3791 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    3792 </span>            :         }
<span class="lineNum">    3793 </span><span class="lineNoCov">          0 :         if ( k!=cidmaster-&gt;subfontcnt ) {</span>
<span class="lineNum">    3794 </span><span class="lineNoCov">          0 :             if ( cidmaster-&gt;subfonts[k] != sf ) {</span>
<span class="lineNum">    3795 </span><span class="lineNoCov">          0 :                 sf = cidmaster-&gt;subfonts[k];</span>
<span class="lineNum">    3796 </span><span class="lineNoCov">          0 :                 gid = ( i&gt;=sf-&gt;glyphcnt ) ? -2 : i;</span>
<span class="lineNum">    3797 </span>            :                 /* can't create a new glyph this way */
<span class="lineNum">    3798 </span>            :             }
<span class="lineNum">    3799 </span>            :         }
<span class="lineNum">    3800 </span>            :     }
<span class="lineNum">    3801 </span><span class="lineNoCov">          0 :     if ( gid == -2 )</span>
<span class="lineNum">    3802 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3803 </span><span class="lineNoCov">          0 :     if ( gid==-1 || (sc = sf-&gt;glyphs[gid])==NULL ) {</span>
<span class="lineNum">    3804 </span><span class="lineNoCov">          0 :         sc = SFMakeChar(sf,map,i);</span>
<span class="lineNum">    3805 </span><span class="lineNoCov">          0 :         sc-&gt;inspiro = cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro();</span>
<span class="lineNum">    3806 </span>            :     }
<span class="lineNum">    3807 </span>            : 
<span class="lineNum">    3808 </span><span class="lineNoCov">          0 :     if ( sc==NULL || (cv-&gt;b.sc == sc &amp;&amp; cv-&gt;enc==i ))</span>
<span class="lineNum">    3809 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    3810 </span><span class="lineNoCov">          0 :     cv-&gt;map_of_enc = map;</span>
<span class="lineNum">    3811 </span><span class="lineNoCov">          0 :     cv-&gt;enc = i;</span>
<span class="lineNum">    3812 </span><span class="lineNoCov">          0 :     CVChangeSC(cv,sc);</span>
<span class="lineNum">    3813 </span>            : }
<span class="lineNum">    3814 </span>            : 
<span class="lineNum">    3815 </span>            : /*
<span class="lineNum">    3816 </span>            :  * Unused
<span class="lineNum">    3817 </span>            : static void CVSwitchToTab(CharView *cv,int tnum ) {
<span class="lineNum">    3818 </span>            :     if( tnum &gt;= cv-&gt;former_cnt )
<span class="lineNum">    3819 </span>            :         return;
<span class="lineNum">    3820 </span>            : 
<span class="lineNum">    3821 </span>            :     SplineFont *sf = cv-&gt;b.fv-&gt;sf;
<span class="lineNum">    3822 </span>            :     char* n = cv-&gt;former_names[tnum];
<span class="lineNum">    3823 </span>            :     int unienc = UniFromName(n,sf-&gt;uni_interp,cv-&gt;b.fv-&gt;map-&gt;enc);
<span class="lineNum">    3824 </span>            :     CVChangeChar(cv,unienc);
<span class="lineNum">    3825 </span>            : }
<span class="lineNum">    3826 </span>            : 
<span class="lineNum">    3827 </span>            : static void CVMenuShowTab(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {
<span class="lineNum">    3828 </span>            :     CharView *cv = (CharView *) GDrawGetUserData(gw);
<span class="lineNum">    3829 </span>            :     CVSwitchToTab(cv,mi-&gt;mid);
<span class="lineNum">    3830 </span>            : }
<a name="3831"><span class="lineNum">    3831 </span>            : */</a>
<span class="lineNum">    3832 </span>            : 
<span class="lineNum">    3833 </span><span class="lineNoCov">          0 : static int CVChangeToFormer( GGadget *g, GEvent *e) {</span>
<span class="lineNum">    3834 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">    3835 </span><span class="lineNoCov">          0 :         CharView *cv = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    3836 </span><span class="lineNoCov">          0 :         int new_aspect = GTabSetGetSel(g);</span>
<span class="lineNum">    3837 </span><span class="lineNoCov">          0 :         SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">    3838 </span>            :         int gid;
<span class="lineNum">    3839 </span>            : 
<span class="lineNum">    3840 </span><span class="lineNoCov">          0 :         for ( gid=sf-&gt;glyphcnt-1; gid&gt;=0; --gid )</span>
<span class="lineNum">    3841 </span><span class="lineNoCov">          0 :             if ( sf-&gt;glyphs[gid]!=NULL &amp;&amp;</span>
<span class="lineNum">    3842 </span><span class="lineNoCov">          0 :                     strcmp(sf-&gt;glyphs[gid]-&gt;name,cv-&gt;former_names[new_aspect])==0 )</span>
<span class="lineNum">    3843 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    3844 </span><span class="lineNoCov">          0 :         if ( gid&lt;0 ) {</span>
<span class="lineNum">    3845 </span>            :             /* They changed the name? See if we can get a unicode value from it */
<span class="lineNum">    3846 </span><span class="lineNoCov">          0 :             int unienc = UniFromName(cv-&gt;former_names[new_aspect],sf-&gt;uni_interp,cv-&gt;b.fv-&gt;map-&gt;enc);</span>
<span class="lineNum">    3847 </span><span class="lineNoCov">          0 :             if ( unienc&gt;=0 ) {</span>
<span class="lineNum">    3848 </span><span class="lineNoCov">          0 :                 gid = SFFindGID(sf,unienc,cv-&gt;former_names[new_aspect]);</span>
<span class="lineNum">    3849 </span><span class="lineNoCov">          0 :                 if ( gid&gt;=0 ) {</span>
<span class="lineNum">    3850 </span><span class="lineNoCov">          0 :                     free(cv-&gt;former_names[new_aspect]);</span>
<span class="lineNum">    3851 </span><span class="lineNoCov">          0 :                     cv-&gt;former_names[new_aspect] = copy(sf-&gt;glyphs[gid]-&gt;name);</span>
<span class="lineNum">    3852 </span>            :                 }
<span class="lineNum">    3853 </span>            :             }
<span class="lineNum">    3854 </span>            :         }
<span class="lineNum">    3855 </span><span class="lineNoCov">          0 :         if ( gid&lt;0 )</span>
<span class="lineNum">    3856 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    3857 </span><span class="lineNoCov">          0 :         CVChangeSC(cv,sf-&gt;glyphs[gid]);</span>
<span class="lineNum">    3858 </span><span class="lineNoCov">          0 :         cv-&gt;enc = ((FontView *) (cv-&gt;b.fv))-&gt;b.map-&gt;backmap[cv-&gt;b.sc-&gt;orig_pos];</span>
<span class="lineNum">    3859 </span>            :     }
<span class="lineNum">    3860 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="3861"><span class="lineNum">    3861 </span>            : }</a>
<span class="lineNum">    3862 </span>            : 
<span class="lineNum">    3863 </span><span class="lineNoCov">          0 : static void CVFakeMove(CharView *cv, GEvent *event) {</span>
<span class="lineNum">    3864 </span>            :     GEvent e;
<span class="lineNum">    3865 </span>            : 
<span class="lineNum">    3866 </span><span class="lineNoCov">          0 :     memset(&amp;e,0,sizeof(e));</span>
<span class="lineNum">    3867 </span><span class="lineNoCov">          0 :     e.type = et_mousemove;</span>
<span class="lineNum">    3868 </span><span class="lineNoCov">          0 :     e.w = cv-&gt;v;</span>
<span class="lineNum">    3869 </span><span class="lineNoCov">          0 :     if ( event-&gt;w!=cv-&gt;v ) {</span>
<span class="lineNum">    3870 </span>            :         GPoint p;
<span class="lineNum">    3871 </span><span class="lineNoCov">          0 :         p.x = event-&gt;u.chr.x; p.y = event-&gt;u.chr.y;</span>
<span class="lineNum">    3872 </span><span class="lineNoCov">          0 :         GDrawTranslateCoordinates(event-&gt;w,cv-&gt;v,&amp;p);</span>
<span class="lineNum">    3873 </span><span class="lineNoCov">          0 :         event-&gt;u.chr.x = p.x; event-&gt;u.chr.y = p.y;</span>
<span class="lineNum">    3874 </span>            :     }
<span class="lineNum">    3875 </span><span class="lineNoCov">          0 :     e.u.mouse.state = TrueCharState(event);</span>
<span class="lineNum">    3876 </span><span class="lineNoCov">          0 :     e.u.mouse.x = event-&gt;u.chr.x;</span>
<span class="lineNum">    3877 </span><span class="lineNoCov">          0 :     e.u.mouse.y = event-&gt;u.chr.y;</span>
<span class="lineNum">    3878 </span><span class="lineNoCov">          0 :     e.u.mouse.device = NULL;</span>
<span class="lineNum">    3879 </span><span class="lineNoCov">          0 :     CVMouseMove(cv,&amp;e);</span>
<a name="3880"><span class="lineNum">    3880 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3881 </span>            : 
<span class="lineNum">    3882 </span><span class="lineNoCov">          0 : static void CVDoFindInFontView(CharView *cv) {</span>
<span class="lineNum">    3883 </span><span class="lineNoCov">          0 :     FVChangeChar((FontView *) (cv-&gt;b.fv),CVCurEnc(cv));</span>
<span class="lineNum">    3884 </span><span class="lineNoCov">          0 :     GDrawSetVisible(((FontView *) (cv-&gt;b.fv))-&gt;gw,true);</span>
<span class="lineNum">    3885 </span><span class="lineNoCov">          0 :     GDrawRaise(((FontView *) (cv-&gt;b.fv))-&gt;gw);</span>
<span class="lineNum">    3886 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    3887 </span>            : 
<span class="lineNum">    3888 </span>            : static uint16 HaveModifiers = 0;
<span class="lineNum">    3889 </span>            : static uint16 PressingTilde = 0;
<span class="lineNum">    3890 </span>            : static uint16 PrevCharEventWasCharUpOnControl = 0;
<a name="3891"><span class="lineNum">    3891 </span>            : </a>
<span class="lineNum">    3892 </span>            : 
<span class="lineNum">    3893 </span><span class="lineNoCov">          0 : static void CVCharUp(CharView *cv, GEvent *event ) {</span>
<span class="lineNum">    3894 </span>            : 
<span class="lineNum">    3895 </span><span class="lineNoCov">          0 :     if ( !event-&gt;u.chr.autorepeat &amp;&amp; !HaveModifiers &amp;&amp; event-&gt;u.chr.keysym==' ' ) {</span>
<span class="lineNum">    3896 </span><span class="lineNoCov">          0 :         update_spacebar_hand_tool(cv);</span>
<span class="lineNum">    3897 </span>            :     }
<span class="lineNum">    3898 </span>            : 
<span class="lineNum">    3899 </span><span class="lineNoCov">          0 :     int oldactiveModifierControl = cv-&gt;activeModifierControl;</span>
<span class="lineNum">    3900 </span><span class="lineNoCov">          0 :     int oldactiveModifierAlt = cv-&gt;activeModifierAlt;</span>
<span class="lineNum">    3901 </span><span class="lineNoCov">          0 :     cv-&gt;activeModifierControl &amp;= ~( event-&gt;u.chr.keysym == GK_Control_L || event-&gt;u.chr.keysym == GK_Control_R</span>
<span class="lineNum">    3902 </span><span class="lineNoCov">          0 :                                     || event-&gt;u.chr.keysym == GK_Meta_L || event-&gt;u.chr.keysym == GK_Meta_R );</span>
<span class="lineNum">    3903 </span><span class="lineNoCov">          0 :     cv-&gt;activeModifierAlt     &amp;= ~( event-&gt;u.chr.keysym == GK_Alt_L || event-&gt;u.chr.keysym == GK_Alt_R</span>
<span class="lineNum">    3904 </span><span class="lineNoCov">          0 :                                     || event-&gt;u.chr.keysym == XK_Mode_switch );</span>
<span class="lineNum">    3905 </span>            :     // helps with keys on the mac
<span class="lineNum">    3906 </span><span class="lineNoCov">          0 :     if( (event-&gt;u.chr.state&amp;ksm_meta) )</span>
<span class="lineNum">    3907 </span><span class="lineNoCov">          0 :         cv-&gt;activeModifierAlt = 0;</span>
<span class="lineNum">    3908 </span><span class="lineNoCov">          0 :     if( oldactiveModifierControl != cv-&gt;activeModifierControl</span>
<span class="lineNum">    3909 </span><span class="lineNoCov">          0 :         || oldactiveModifierAlt != cv-&gt;activeModifierAlt )</span>
<span class="lineNum">    3910 </span>            :     {
<span class="lineNum">    3911 </span><span class="lineNoCov">          0 :         CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    3912 </span>            :     }
<span class="lineNum">    3913 </span>            : 
<span class="lineNum">    3914 </span>            :     
<span class="lineNum">    3915 </span>            : 
<span class="lineNum">    3916 </span>            : //    TRACE(&quot;CVCharUp() ag:%d key:%d\n&quot;, cv_auto_goto, event-&gt;u.chr.keysym );
<span class="lineNum">    3917 </span><span class="lineNoCov">          0 :     if( !cv_auto_goto )</span>
<span class="lineNum">    3918 </span>            :     {
<span class="lineNum">    3919 </span><span class="lineNoCov">          0 :         bool isImmediateKeyTogglePreview = isImmediateKey( cv-&gt;gw, &quot;TogglePreview&quot;, event ) != NULL;</span>
<span class="lineNum">    3920 </span><span class="lineNoCov">          0 :         if( isImmediateKeyTogglePreview ) {</span>
<span class="lineNum">    3921 </span><span class="lineNoCov">          0 :             PressingTilde = 1;</span>
<span class="lineNum">    3922 </span>            :         }
<span class="lineNum">    3923 </span>            : 
<span class="lineNum">    3924 </span><span class="lineNoCov">          0 :         if( PrevCharEventWasCharUpOnControl &amp;&amp; isImmediateKeyTogglePreview )</span>
<span class="lineNum">    3925 </span>            :         {
<span class="lineNum">    3926 </span><span class="lineNoCov">          0 :             HaveModifiers = 0;</span>
<span class="lineNum">    3927 </span><span class="lineNoCov">          0 :             PrevCharEventWasCharUpOnControl = 0;</span>
<span class="lineNum">    3928 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    3929 </span>            :         }
<span class="lineNum">    3930 </span><span class="lineNoCov">          0 :         PrevCharEventWasCharUpOnControl = 0;</span>
<span class="lineNum">    3931 </span>            : 
<span class="lineNum">    3932 </span><span class="lineNoCov">          0 :         if( !event-&gt;u.chr.autorepeat</span>
<span class="lineNum">    3933 </span><span class="lineNoCov">          0 :             &amp;&amp; (event-&gt;u.chr.keysym == GK_Control_L</span>
<span class="lineNum">    3934 </span><span class="lineNoCov">          0 :                 || event-&gt;u.chr.keysym == GK_Control_R ))</span>
<span class="lineNum">    3935 </span>            :         {
<span class="lineNum">    3936 </span><span class="lineNoCov">          0 :             PrevCharEventWasCharUpOnControl = 1;</span>
<span class="lineNum">    3937 </span><span class="lineNoCov">          0 :             if( !PressingTilde ) {</span>
<span class="lineNum">    3938 </span><span class="lineNoCov">          0 :                 HaveModifiers = 0;</span>
<span class="lineNum">    3939 </span>            :             }
<span class="lineNum">    3940 </span>            :         }
<span class="lineNum">    3941 </span>            : 
<span class="lineNum">    3942 </span><span class="lineNoCov">          0 :         if ( !event-&gt;u.chr.autorepeat &amp;&amp; !HaveModifiers &amp;&amp; isImmediateKeyTogglePreview ) {</span>
<span class="lineNum">    3943 </span><span class="lineNoCov">          0 :             PressingTilde = 0;</span>
<span class="lineNum">    3944 </span><span class="lineNoCov">          0 :             CVPreviewModeSet( cv-&gt;gw, false );</span>
<span class="lineNum">    3945 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    3946 </span>            :         }
<span class="lineNum">    3947 </span>            : 
<span class="lineNum">    3948 </span><span class="lineNoCov">          0 :         if ( !event-&gt;u.chr.autorepeat &amp;&amp; isImmediateKeyTogglePreview ) {</span>
<span class="lineNum">    3949 </span><span class="lineNoCov">          0 :             PressingTilde = 0;</span>
<span class="lineNum">    3950 </span>            :         }
<span class="lineNum">    3951 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.autorepeat &amp;&amp; HaveModifiers &amp;&amp; isImmediateKeyTogglePreview ) {</span>
<span class="lineNum">    3952 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    3953 </span>            :         }
<span class="lineNum">    3954 </span>            :     }
<span class="lineNum">    3955 </span>            : 
<span class="lineNum">    3956 </span>            : 
<span class="lineNum">    3957 </span><span class="lineNoCov">          0 :     if( event-&gt;u.chr.keysym == XK_Escape )</span>
<span class="lineNum">    3958 </span>            :     {
<span class="lineNum">    3959 </span>            :         TRACE(&quot;escape char.......!\n&quot;);
<span class="lineNum">    3960 </span><span class="lineNoCov">          0 :         GGadget *active = GWindowGetFocusGadgetOfWindow(cv-&gt;gw);</span>
<span class="lineNum">    3961 </span><span class="lineNoCov">          0 :         if( active == cv-&gt;charselector )</span>
<span class="lineNum">    3962 </span>            :         {
<span class="lineNum">    3963 </span>            :             TRACE(&quot;was on charselector\n&quot;);
<span class="lineNum">    3964 </span><span class="lineNoCov">          0 :             GWidgetIndicateFocusGadget( cv-&gt;hsb );</span>
<span class="lineNum">    3965 </span>            :         }
<span class="lineNum">    3966 </span><span class="lineNoCov">          0 :         else if ( cv-&gt;charselector != NULL )</span>
<span class="lineNum">    3967 </span>            :         {
<span class="lineNum">    3968 </span>            :             TRACE(&quot;was on NOT charselector\n&quot;);
<span class="lineNum">    3969 </span><span class="lineNoCov">          0 :             GWidgetIndicateFocusGadget( cv-&gt;charselector );</span>
<span class="lineNum">    3970 </span>            :         }
<span class="lineNum">    3971 </span>            :     }
<span class="lineNum">    3972 </span>            :     
<span class="lineNum">    3973 </span>            : 
<span class="lineNum">    3974 </span>            : #if _ModKeysAutoRepeat
<span class="lineNum">    3975 </span>            :     /* Under cygwin these keys auto repeat, they don't under normal X */
<span class="lineNum">    3976 </span>            :     if ( event-&gt;u.chr.keysym == GK_Shift_L || event-&gt;u.chr.keysym == GK_Shift_R ||
<span class="lineNum">    3977 </span>            :             event-&gt;u.chr.keysym == GK_Control_L || event-&gt;u.chr.keysym == GK_Control_R ||
<span class="lineNum">    3978 </span>            :             event-&gt;u.chr.keysym == GK_Meta_L || event-&gt;u.chr.keysym == GK_Meta_R ||
<span class="lineNum">    3979 </span>            :             event-&gt;u.chr.keysym == GK_Alt_L || event-&gt;u.chr.keysym == GK_Alt_R ||
<span class="lineNum">    3980 </span>            :             event-&gt;u.chr.keysym == GK_Super_L || event-&gt;u.chr.keysym == GK_Super_R ||
<span class="lineNum">    3981 </span>            :             event-&gt;u.chr.keysym == GK_Hyper_L || event-&gt;u.chr.keysym == GK_Hyper_R ) {
<span class="lineNum">    3982 </span>            :         if ( cv-&gt;autorpt!=NULL ) {
<span class="lineNum">    3983 </span>            :             GDrawCancelTimer(cv-&gt;autorpt);
<span class="lineNum">    3984 </span>            :             CVToolsSetCursor(cv,cv-&gt;oldstate,NULL);
<span class="lineNum">    3985 </span>            :         }
<span class="lineNum">    3986 </span>            :         cv-&gt;keysym = event-&gt;u.chr.keysym;
<span class="lineNum">    3987 </span>            :         cv-&gt;oldkeyx = event-&gt;u.chr.x;
<span class="lineNum">    3988 </span>            :         cv-&gt;oldkeyy = event-&gt;u.chr.y;
<span class="lineNum">    3989 </span>            :         cv-&gt;oldkeyw = event-&gt;w;
<span class="lineNum">    3990 </span>            :         cv-&gt;oldstate = TrueCharState(event);
<span class="lineNum">    3991 </span>            :         cv-&gt;autorpt = GDrawRequestTimer(cv-&gt;v,100,0,NULL);
<span class="lineNum">    3992 </span>            :     } else {
<span class="lineNum">    3993 </span>            :         if ( cv-&gt;autorpt!=NULL ) {
<span class="lineNum">    3994 </span>            :             GDrawCancelTimer(cv-&gt;autorpt); cv-&gt;autorpt=NULL;
<span class="lineNum">    3995 </span>            :             CVToolsSetCursor(cv,cv-&gt;oldstate,NULL);
<span class="lineNum">    3996 </span>            :         }
<span class="lineNum">    3997 </span>            :         CVToolsSetCursor(cv,TrueCharState(event),NULL);
<span class="lineNum">    3998 </span>            :     }
<span class="lineNum">    3999 </span>            : #else
<span class="lineNum">    4000 </span><span class="lineNoCov">          0 :     CVToolsSetCursor(cv,TrueCharState(event),NULL);</span>
<span class="lineNum">    4001 </span><span class="lineNoCov">          0 :     if ( event-&gt;u.chr.keysym == GK_Shift_L || event-&gt;u.chr.keysym == GK_Shift_R ||</span>
<span class="lineNum">    4002 </span><span class="lineNoCov">          0 :              event-&gt;u.chr.keysym == GK_Alt_L || event-&gt;u.chr.keysym == GK_Alt_R ||</span>
<span class="lineNum">    4003 </span><span class="lineNoCov">          0 :              event-&gt;u.chr.keysym == GK_Meta_L || event-&gt;u.chr.keysym == GK_Meta_R )</span>
<span class="lineNum">    4004 </span><span class="lineNoCov">          0 :         CVFakeMove(cv, event);</span>
<span class="lineNum">    4005 </span>            : #endif
<a name="4006"><span class="lineNum">    4006 </span>            : }</a>
<span class="lineNum">    4007 </span>            : 
<span class="lineNum">    4008 </span><span class="lineNoCov">          0 : void CVInfoDrawText(CharView *cv, GWindow pixmap ) {</span>
<span class="lineNum">    4009 </span>            :     GRect r;
<span class="lineNum">    4010 </span><span class="lineNoCov">          0 :     Color bg = GDrawGetDefaultBackground(GDrawGetDisplayOfWindow(pixmap));</span>
<span class="lineNum">    4011 </span><span class="lineNoCov">          0 :     Color fg = GDrawGetDefaultForeground(GDrawGetDisplayOfWindow(pixmap));</span>
<span class="lineNum">    4012 </span><span class="lineNoCov">          0 :     const int buffersz = 150;</span>
<span class="lineNum">    4013 </span><span class="lineNoCov">          0 :     char buffer[buffersz+1];</span>
<span class="lineNum">    4014 </span><span class="lineNoCov">          0 :     int ybase = cv-&gt;mbh+cv-&gt;charselectorh+(cv-&gt;infoh-cv-&gt;sfh)/2+cv-&gt;sas;</span>
<span class="lineNum">    4015 </span>            :     real xdiff, ydiff;
<span class="lineNum">    4016 </span>            :     SplinePoint *sp, dummy;
<span class="lineNum">    4017 </span>            :     spiro_cp *cp;
<span class="lineNum">    4018 </span>            : 
<span class="lineNum">    4019 </span><span class="lineNoCov">          0 :     GDrawSetFont(pixmap,cv-&gt;small);</span>
<span class="lineNum">    4020 </span><span class="lineNoCov">          0 :     r.x = RPT_DATA; r.width = SPT_BASE-RPT_DATA;</span>
<span class="lineNum">    4021 </span><span class="lineNoCov">          0 :     r.y = cv-&gt;mbh+cv-&gt;charselectorh; r.height = cv-&gt;infoh-1;</span>
<span class="lineNum">    4022 </span><span class="lineNoCov">          0 :     GDrawFillRect(pixmap,&amp;r,bg);</span>
<span class="lineNum">    4023 </span><span class="lineNoCov">          0 :     r.x = SPT_DATA; r.width = SOF_BASE-SPT_DATA;</span>
<span class="lineNum">    4024 </span><span class="lineNoCov">          0 :     GDrawFillRect(pixmap,&amp;r,bg);</span>
<span class="lineNum">    4025 </span><span class="lineNoCov">          0 :     r.x = SOF_DATA; r.width = SDS_BASE-SOF_DATA;</span>
<span class="lineNum">    4026 </span><span class="lineNoCov">          0 :     GDrawFillRect(pixmap,&amp;r,bg);</span>
<span class="lineNum">    4027 </span><span class="lineNoCov">          0 :     r.x = SDS_DATA; r.width = SAN_BASE-SDS_DATA;</span>
<span class="lineNum">    4028 </span><span class="lineNoCov">          0 :     GDrawFillRect(pixmap,&amp;r,bg);</span>
<span class="lineNum">    4029 </span><span class="lineNoCov">          0 :     r.x = SAN_DATA; r.width = MAG_BASE-SAN_DATA;</span>
<span class="lineNum">    4030 </span><span class="lineNoCov">          0 :     GDrawFillRect(pixmap,&amp;r,bg);</span>
<span class="lineNum">    4031 </span><span class="lineNoCov">          0 :     r.x = MAG_DATA; r.width = LAYER_DATA-MAG_DATA;</span>
<span class="lineNum">    4032 </span><span class="lineNoCov">          0 :     GDrawFillRect(pixmap,&amp;r,bg);</span>
<span class="lineNum">    4033 </span><span class="lineNoCov">          0 :     r.x = LAYER_DATA; r.width = CODERANGE_DATA-LAYER_DATA;</span>
<span class="lineNum">    4034 </span><span class="lineNoCov">          0 :     GDrawFillRect(pixmap,&amp;r,bg);</span>
<span class="lineNum">    4035 </span><span class="lineNoCov">          0 :     r.x = CODERANGE_DATA; r.width = FLAGS_DATA-CODERANGE_DATA;</span>
<span class="lineNum">    4036 </span><span class="lineNoCov">          0 :     GDrawFillRect(pixmap,&amp;r,bg);</span>
<span class="lineNum">    4037 </span><span class="lineNoCov">          0 :     r.x = FLAGS_DATA; r.width = 200;</span>
<span class="lineNum">    4038 </span><span class="lineNoCov">          0 :     GDrawFillRect(pixmap,&amp;r,bg);</span>
<span class="lineNum">    4039 </span>            : 
<span class="lineNum">    4040 </span><span class="lineNoCov">          0 :     if ( cv-&gt;info_within ) {</span>
<span class="lineNum">    4041 </span><span class="lineNoCov">          0 :         if ( cv-&gt;info.x&gt;=1000 || cv-&gt;info.x&lt;=-1000 || cv-&gt;info.y&gt;=1000 || cv-&gt;info.y&lt;=-1000 )</span>
<span class="lineNum">    4042 </span><span class="lineNoCov">          0 :             sprintf(buffer,&quot;%d%s%d&quot;, (int) cv-&gt;info.x, coord_sep, (int) cv-&gt;info.y );</span>
<span class="lineNum">    4043 </span>            :         else
<span class="lineNum">    4044 </span><span class="lineNoCov">          0 :             sprintf(buffer,&quot;%.4g%s%.4g&quot;, (double) cv-&gt;info.x, coord_sep, (double) cv-&gt;info.y );</span>
<span class="lineNum">    4045 </span><span class="lineNoCov">          0 :         buffer[11] = '\0';</span>
<span class="lineNum">    4046 </span><span class="lineNoCov">          0 :         GDrawDrawText8(pixmap,RPT_DATA,ybase,buffer,-1,fg);</span>
<span class="lineNum">    4047 </span>            :     }
<span class="lineNum">    4048 </span><span class="lineNoCov">          0 :     if ( cv-&gt;scale&gt;=.25 )</span>
<span class="lineNum">    4049 </span><span class="lineNoCov">          0 :         sprintf( buffer, &quot;%d%%&quot;, (int) (100*cv-&gt;scale));</span>
<span class="lineNum">    4050 </span>            :     else
<span class="lineNum">    4051 </span><span class="lineNoCov">          0 :         sprintf( buffer, &quot;%.3g%%&quot;, (double) (100*cv-&gt;scale));</span>
<span class="lineNum">    4052 </span><span class="lineNoCov">          0 :     GDrawDrawText8(pixmap,MAG_DATA,ybase,buffer,-1,fg);</span>
<span class="lineNum">    4053 </span>            : 
<span class="lineNum">    4054 </span><span class="lineNoCov">          0 :     const int layernamesz = 100;</span>
<span class="lineNum">    4055 </span><span class="lineNoCov">          0 :     char layername[layernamesz+1];</span>
<span class="lineNum">    4056 </span><span class="lineNoCov">          0 :     strncpy(layername,_(&quot;Guide&quot;),layernamesz);</span>
<span class="lineNum">    4057 </span><span class="lineNoCov">          0 :     if(cv-&gt;b.drawmode!=dm_grid) {</span>
<span class="lineNum">    4058 </span><span class="lineNoCov">          0 :         int idx = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    4059 </span><span class="lineNoCov">          0 :         if(idx &gt;= 0 &amp;&amp; idx &lt; cv-&gt;b.sc-&gt;parent-&gt;layer_cnt) {</span>
<span class="lineNum">    4060 </span><span class="lineNoCov">          0 :             strncpy(layername,cv-&gt;b.sc-&gt;parent-&gt;layers[idx].name,layernamesz);</span>
<span class="lineNum">    4061 </span>            :         }
<span class="lineNum">    4062 </span>            :     }
<span class="lineNum">    4063 </span><span class="lineNoCov">          0 :     snprintf( buffer, buffersz, _(&quot;Active Layer: %s (%s)&quot;),</span>
<span class="lineNum">    4064 </span><span class="lineNoCov">          0 :               layername,</span>
<span class="lineNum">    4065 </span>            : /* GT: Guide layer, make it short */
<span class="lineNum">    4066 </span><span class="lineNoCov">          0 :               ( cv-&gt;b.drawmode==dm_grid ? _(&quot;Guide&quot;) :</span>
<span class="lineNum">    4067 </span>            : /* GT: Background, make it short */
<span class="lineNum">    4068 </span><span class="lineNoCov">          0 :                 cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;background ? _(&quot;Back&quot;) :</span>
<span class="lineNum">    4069 </span>            : /* GT: Foreground, make it short */
<span class="lineNum">    4070 </span>            :                 _(&quot;Fore&quot;) )
<span class="lineNum">    4071 </span>            :               );
<span class="lineNum">    4072 </span><span class="lineNoCov">          0 :     GDrawDrawText8(pixmap,LAYER_DATA,ybase,buffer,-1,fg);</span>
<span class="lineNum">    4073 </span><span class="lineNoCov">          0 :     GDrawDrawText8(pixmap,LAYER_DATA,ybase,buffer,-1,fg);</span>
<span class="lineNum">    4074 </span>            : 
<span class="lineNum">    4075 </span><span class="lineNoCov">          0 :     if ( cv-&gt;coderange==cr_none )</span>
<span class="lineNum">    4076 </span>            :     {
<span class="lineNum">    4077 </span><span class="lineNoCov">          0 :         snprintf( buffer, buffersz, _(&quot;Modes: &quot;));</span>
<span class="lineNum">    4078 </span><span class="lineNoCov">          0 :         if( CVShouldInterpolateCPsOnMotion(cv) )</span>
<span class="lineNum">    4079 </span><span class="lineNoCov">          0 :             strcat( buffer, &quot;Interpolate&quot; );</span>
<span class="lineNum">    4080 </span><span class="lineNoCov">          0 :         GDrawDrawText8(pixmap,FLAGS_DATA,ybase,buffer,-1,fg);</span>
<span class="lineNum">    4081 </span>            :     }
<span class="lineNum">    4082 </span>            :     
<span class="lineNum">    4083 </span>            :     
<span class="lineNum">    4084 </span><span class="lineNoCov">          0 :     if ( cv-&gt;coderange!=cr_none ) {</span>
<span class="lineNum">    4085 </span><span class="lineNoCov">          0 :         GDrawDrawText8(pixmap,CODERANGE_DATA,ybase,</span>
<span class="lineNum">    4086 </span><span class="lineNoCov">          0 :                 cv-&gt;coderange==cr_fpgm ? _(&quot;'fpgm'&quot;) :</span>
<span class="lineNum">    4087 </span><span class="lineNoCov">          0 :                 cv-&gt;coderange==cr_prep ? _(&quot;'prep'&quot;) : _(&quot;Glyph&quot;),</span>
<span class="lineNum">    4088 </span>            :             -1,fg);
<span class="lineNum">    4089 </span><span class="lineNoCov">          0 :         GDrawDrawText8(pixmap,CODERANGE_DATA+40,ybase,</span>
<span class="lineNum">    4090 </span><span class="lineNoCov">          0 :                 FreeTypeStringVersion(), -1,fg);</span>
<span class="lineNum">    4091 </span>            :     }
<span class="lineNum">    4092 </span><span class="lineNoCov">          0 :     sp = NULL; cp = NULL;</span>
<span class="lineNum">    4093 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro())</span>
<span class="lineNum">    4094 </span><span class="lineNoCov">          0 :         cp = cv-&gt;p.spiro!=NULL ? cv-&gt;p.spiro : cv-&gt;lastselcp;</span>
<span class="lineNum">    4095 </span>            :     else
<span class="lineNum">    4096 </span><span class="lineNoCov">          0 :         sp = cv-&gt;p.sp!=NULL ? cv-&gt;p.sp : cv-&gt;lastselpt;</span>
<span class="lineNum">    4097 </span><span class="lineNoCov">          0 :     if ( sp==NULL &amp;&amp; cp==NULL )</span>
<span class="lineNum">    4098 </span><span class="lineNoCov">          0 :             if ( cv-&gt;active_tool==cvt_rect || cv-&gt;active_tool==cvt_elipse ||</span>
<span class="lineNum">    4099 </span><span class="lineNoCov">          0 :                     cv-&gt;active_tool==cvt_poly || cv-&gt;active_tool==cvt_star ||</span>
<span class="lineNum">    4100 </span><span class="lineNoCov">          0 :                     cv-&gt;active_tool==cvt_scale || cv-&gt;active_tool==cvt_skew ||</span>
<span class="lineNum">    4101 </span><span class="lineNoCov">          0 :                     cv-&gt;active_tool==cvt_rotate || cv-&gt;active_tool==cvt_flip ) {</span>
<span class="lineNum">    4102 </span><span class="lineNoCov">          0 :         dummy.me.x = cv-&gt;p.cx; dummy.me.y = cv-&gt;p.cy;</span>
<span class="lineNum">    4103 </span><span class="lineNoCov">          0 :         sp = &amp;dummy;</span>
<span class="lineNum">    4104 </span>            :     }
<span class="lineNum">    4105 </span><span class="lineNoCov">          0 :     if ( sp || cp ) {</span>
<span class="lineNum">    4106 </span>            :         real selx, sely;
<span class="lineNum">    4107 </span><span class="lineNoCov">          0 :         if ( sp ) {</span>
<span class="lineNum">    4108 </span><span class="lineNoCov">          0 :             if ( cv-&gt;pressed &amp;&amp; sp==cv-&gt;p.sp ) {</span>
<span class="lineNum">    4109 </span><span class="lineNoCov">          0 :                 selx = cv-&gt;p.constrain.x;</span>
<span class="lineNum">    4110 </span><span class="lineNoCov">          0 :                 sely = cv-&gt;p.constrain.y;</span>
<span class="lineNum">    4111 </span>            :             } else {
<span class="lineNum">    4112 </span><span class="lineNoCov">          0 :                 selx = sp-&gt;me.x;</span>
<span class="lineNum">    4113 </span><span class="lineNoCov">          0 :                 sely = sp-&gt;me.y;</span>
<span class="lineNum">    4114 </span>            :             }
<span class="lineNum">    4115 </span>            :         } else {
<span class="lineNum">    4116 </span><span class="lineNoCov">          0 :             selx = cp-&gt;x;</span>
<span class="lineNum">    4117 </span><span class="lineNoCov">          0 :             sely = cp-&gt;y;</span>
<span class="lineNum">    4118 </span>            :         }
<span class="lineNum">    4119 </span><span class="lineNoCov">          0 :         xdiff=cv-&gt;info.x-selx;</span>
<span class="lineNum">    4120 </span><span class="lineNoCov">          0 :         ydiff = cv-&gt;info.y-sely;</span>
<span class="lineNum">    4121 </span>            : 
<span class="lineNum">    4122 </span><span class="lineNoCov">          0 :         if ( selx&gt;=1000 || selx&lt;=-1000 || sely&gt;=1000 || sely&lt;=-1000 )</span>
<span class="lineNum">    4123 </span><span class="lineNoCov">          0 :             sprintf(buffer,&quot;%d%s%d&quot;, (int) selx, coord_sep, (int) sely );</span>
<span class="lineNum">    4124 </span>            :         else
<span class="lineNum">    4125 </span><span class="lineNoCov">          0 :             sprintf(buffer,&quot;%.4g%s%.4g&quot;, (double) selx, coord_sep, (double) sely );</span>
<span class="lineNum">    4126 </span><span class="lineNoCov">          0 :         buffer[11] = '\0';</span>
<span class="lineNum">    4127 </span><span class="lineNoCov">          0 :         GDrawDrawText8(pixmap,SPT_DATA,ybase,buffer,-1,fg);</span>
<span class="lineNum">    4128 </span><span class="lineNoCov">          0 :     } else if ( cv-&gt;widthsel &amp;&amp; cv-&gt;info_within ) {</span>
<span class="lineNum">    4129 </span><span class="lineNoCov">          0 :         xdiff = cv-&gt;info.x-cv-&gt;p.cx;</span>
<span class="lineNum">    4130 </span><span class="lineNoCov">          0 :         ydiff = 0;</span>
<span class="lineNum">    4131 </span><span class="lineNoCov">          0 :     } else if ( cv-&gt;p.rubberbanding &amp;&amp; cv-&gt;info_within ) {</span>
<span class="lineNum">    4132 </span><span class="lineNoCov">          0 :         xdiff=cv-&gt;info.x-cv-&gt;p.cx;</span>
<span class="lineNum">    4133 </span><span class="lineNoCov">          0 :         ydiff = cv-&gt;info.y-cv-&gt;p.cy;</span>
<span class="lineNum">    4134 </span>            :     } else
<span class="lineNum">    4135 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    4136 </span><span class="lineNoCov">          0 :     if ( !cv-&gt;info_within )</span>
<span class="lineNum">    4137 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    4138 </span>            : 
<span class="lineNum">    4139 </span><span class="lineNoCov">          0 :     if ( cv-&gt;active_tool==cvt_scale ) {</span>
<span class="lineNum">    4140 </span><span class="lineNoCov">          0 :         xdiff = 100.0 + (cv-&gt;info.x-cv-&gt;p.cx)/(4*cv-&gt;scale);</span>
<span class="lineNum">    4141 </span><span class="lineNoCov">          0 :         ydiff = 100.0 + (cv-&gt;info.y-cv-&gt;p.cy)/(4*cv-&gt;scale);</span>
<span class="lineNum">    4142 </span><span class="lineNoCov">          0 :         if ( xdiff&gt;=100 || xdiff&lt;=-100 || ydiff&gt;=100 || ydiff&lt;=-100 )</span>
<span class="lineNum">    4143 </span><span class="lineNoCov">          0 :             sprintf(buffer,&quot;%d%%%s%d%%&quot;, (int) xdiff, coord_sep, (int) ydiff );</span>
<span class="lineNum">    4144 </span>            :         else
<span class="lineNum">    4145 </span><span class="lineNoCov">          0 :             sprintf(buffer,&quot;%.3g%%%s%.3g%%&quot;, (double) xdiff, coord_sep, (double) ydiff );</span>
<span class="lineNum">    4146 </span><span class="lineNoCov">          0 :     } else if ( xdiff&gt;=1000 || xdiff&lt;=-1000 || ydiff&gt;=1000 || ydiff&lt;=-1000 )</span>
<span class="lineNum">    4147 </span><span class="lineNoCov">          0 :         sprintf(buffer,&quot;%d%s%d&quot;, (int) xdiff, coord_sep, (int) ydiff );</span>
<span class="lineNum">    4148 </span>            :     else
<span class="lineNum">    4149 </span><span class="lineNoCov">          0 :         sprintf(buffer,&quot;%.4g%s%.4g&quot;, (double) xdiff, coord_sep, (double) ydiff );</span>
<span class="lineNum">    4150 </span><span class="lineNoCov">          0 :     buffer[11] = '\0';</span>
<span class="lineNum">    4151 </span><span class="lineNoCov">          0 :     GDrawDrawText8(pixmap,SOF_DATA,ybase,buffer,-1,fg);</span>
<span class="lineNum">    4152 </span>            : 
<span class="lineNum">    4153 </span><span class="lineNoCov">          0 :     sprintf( buffer, &quot;%.1f&quot;, sqrt(xdiff*xdiff+ydiff*ydiff));</span>
<span class="lineNum">    4154 </span><span class="lineNoCov">          0 :     GDrawDrawText8(pixmap,SDS_DATA,ybase,buffer,-1,fg);</span>
<span class="lineNum">    4155 </span>            : 
<span class="lineNum">    4156 </span>            :         /* Utf-8 for degree sign */
<span class="lineNum">    4157 </span><span class="lineNoCov">          0 :     sprintf( buffer, &quot;%d\302\260&quot;, (int) rint(180*atan2(ydiff,xdiff)/3.1415926535897932));</span>
<span class="lineNum">    4158 </span><span class="lineNoCov">          0 :     GDrawDrawText8(pixmap,SAN_DATA,ybase,buffer,-1,fg);</span>
<a name="4159"><span class="lineNum">    4159 </span>            : }</a>
<span class="lineNum">    4160 </span>            : 
<span class="lineNum">    4161 </span><span class="lineNoCov">          0 : static void CVInfoDrawRulers(CharView *cv, GWindow pixmap ) {</span>
<span class="lineNum">    4162 </span><span class="lineNoCov">          0 :     int rstart = cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh;</span>
<span class="lineNum">    4163 </span><span class="lineNoCov">          0 :     GDrawSetXORMode(pixmap);</span>
<span class="lineNum">    4164 </span><span class="lineNoCov">          0 :     GDrawSetXORBase(pixmap,GDrawGetDefaultBackground(NULL));</span>
<span class="lineNum">    4165 </span><span class="lineNoCov">          0 :     GDrawSetLineWidth(pixmap,0);</span>
<span class="lineNum">    4166 </span><span class="lineNoCov">          0 :     if ( cv-&gt;olde.x!=-1 ) {</span>
<span class="lineNum">    4167 </span><span class="lineNoCov">          0 :         GDrawDrawLine(pixmap,cv-&gt;olde.x+cv-&gt;rulerh,rstart,cv-&gt;olde.x+cv-&gt;rulerh,rstart+cv-&gt;rulerh,0xff0000);</span>
<span class="lineNum">    4168 </span><span class="lineNoCov">          0 :         GDrawDrawLine(pixmap,0,cv-&gt;olde.y+rstart+cv-&gt;rulerh,cv-&gt;rulerh,cv-&gt;olde.y+rstart+cv-&gt;rulerh,0xff0000);</span>
<span class="lineNum">    4169 </span>            :     }
<span class="lineNum">    4170 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap,cv-&gt;e.x+cv-&gt;rulerh,rstart,cv-&gt;e.x+cv-&gt;rulerh,rstart+cv-&gt;rulerh,0xff0000);</span>
<span class="lineNum">    4171 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap,0,cv-&gt;e.y+rstart+cv-&gt;rulerh,cv-&gt;rulerh,cv-&gt;e.y+rstart+cv-&gt;rulerh,0xff0000);</span>
<span class="lineNum">    4172 </span><span class="lineNoCov">          0 :     cv-&gt;olde = cv-&gt;e;</span>
<span class="lineNum">    4173 </span><span class="lineNoCov">          0 :     GDrawSetCopyMode(pixmap);</span>
<a name="4174"><span class="lineNum">    4174 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4175 </span>            : 
<span class="lineNum">    4176 </span><span class="lineNoCov">          0 : void CVInfoDraw(CharView *cv, GWindow pixmap ) {</span>
<span class="lineNum">    4177 </span><span class="lineNoCov">          0 :     CVInfoDrawText(cv,pixmap);</span>
<span class="lineNum">    4178 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showrulers )</span>
<span class="lineNum">    4179 </span><span class="lineNoCov">          0 :         CVInfoDrawRulers(cv,pixmap);</span>
<a name="4180"><span class="lineNum">    4180 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4181 </span>            : 
<span class="lineNum">    4182 </span><span class="lineNoCov">          0 : static void CVCrossing(CharView *cv, GEvent *event ) {</span>
<span class="lineNum">    4183 </span><span class="lineNoCov">          0 :     CVToolsSetCursor(cv,event-&gt;u.mouse.state,event-&gt;u.mouse.device);</span>
<span class="lineNum">    4184 </span><span class="lineNoCov">          0 :     cv-&gt;info_within = event-&gt;u.crossing.entered;</span>
<span class="lineNum">    4185 </span><span class="lineNoCov">          0 :     cv-&gt;info.x = (event-&gt;u.crossing.x-cv-&gt;xoff)/cv-&gt;scale;</span>
<span class="lineNum">    4186 </span><span class="lineNoCov">          0 :     cv-&gt;info.y = (cv-&gt;height-event-&gt;u.crossing.y-cv-&gt;yoff)/cv-&gt;scale;</span>
<span class="lineNum">    4187 </span><span class="lineNoCov">          0 :     CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    4188 </span><span class="lineNoCov">          0 :     CPEndInfo(cv);</span>
<a name="4189"><span class="lineNum">    4189 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4190 </span>            : 
<span class="lineNum">    4191 </span><span class="lineNoCov">          0 : static int CheckSpiroPoint(FindSel *fs, spiro_cp *cp, SplineSet *spl,int index) {</span>
<span class="lineNum">    4192 </span>            : 
<span class="lineNum">    4193 </span><span class="lineNoCov">          0 :     if ( fs-&gt;xl&lt;=cp-&gt;x &amp;&amp; fs-&gt;xh&gt;=cp-&gt;x &amp;&amp;</span>
<span class="lineNum">    4194 </span><span class="lineNoCov">          0 :             fs-&gt;yl&lt;=cp-&gt;y &amp;&amp; fs-&gt;yh &gt;= cp-&gt;y ) {</span>
<span class="lineNum">    4195 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;spiro = cp;</span>
<span class="lineNum">    4196 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;spline = NULL;</span>
<span class="lineNum">    4197 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;anysel = true;</span>
<span class="lineNum">    4198 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;spl = spl;</span>
<span class="lineNum">    4199 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;spiro_index = index;</span>
<span class="lineNum">    4200 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4201 </span>            :     }
<span class="lineNum">    4202 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="4203"><span class="lineNum">    4203 </span>            : }</a>
<span class="lineNum">    4204 </span>            : 
<span class="lineNum">    4205 </span><span class="lineNoCov">          0 : static int CheckPoint(FindSel *fs, SplinePoint *sp, SplineSet *spl) {</span>
<span class="lineNum">    4206 </span>            : 
<span class="lineNum">    4207 </span><span class="lineNoCov">          0 :     if ( fs-&gt;xl&lt;=sp-&gt;me.x &amp;&amp; fs-&gt;xh&gt;=sp-&gt;me.x &amp;&amp;</span>
<span class="lineNum">    4208 </span><span class="lineNoCov">          0 :             fs-&gt;yl&lt;=sp-&gt;me.y &amp;&amp; fs-&gt;yh &gt;= sp-&gt;me.y ) {</span>
<span class="lineNum">    4209 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;sp = sp;</span>
<span class="lineNum">    4210 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;spline = NULL;</span>
<span class="lineNum">    4211 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;anysel = true;</span>
<span class="lineNum">    4212 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;spl = spl;</span>
<span class="lineNum">    4213 </span><span class="lineNoCov">          0 :         if ( !fs-&gt;seek_controls )</span>
<span class="lineNum">    4214 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4215 </span>            :     }
<span class="lineNum">    4216 </span><span class="lineNoCov">          0 :     if ( (sp-&gt;selected &amp;&amp; fs-&gt;select_controls)</span>
<span class="lineNum">    4217 </span><span class="lineNoCov">          0 :          || fs-&gt;all_controls</span>
<span class="lineNum">    4218 </span><span class="lineNoCov">          0 :          || fs-&gt;alwaysshowcontrolpoints )</span>
<span class="lineNum">    4219 </span>            :     {
<span class="lineNum">    4220 </span><span class="lineNoCov">          0 :         int seln=false, selp=false;</span>
<span class="lineNum">    4221 </span><span class="lineNoCov">          0 :         if ( fs-&gt;c_xl&lt;=sp-&gt;nextcp.x &amp;&amp; fs-&gt;c_xh&gt;=sp-&gt;nextcp.x &amp;&amp;</span>
<span class="lineNum">    4222 </span><span class="lineNoCov">          0 :                 fs-&gt;c_yl&lt;=sp-&gt;nextcp.y &amp;&amp; fs-&gt;c_yh &gt;= sp-&gt;nextcp.y )</span>
<span class="lineNum">    4223 </span><span class="lineNoCov">          0 :             seln = true;</span>
<span class="lineNum">    4224 </span><span class="lineNoCov">          0 :         if ( fs-&gt;c_xl&lt;=sp-&gt;prevcp.x &amp;&amp; fs-&gt;c_xh&gt;=sp-&gt;prevcp.x &amp;&amp;</span>
<span class="lineNum">    4225 </span><span class="lineNoCov">          0 :                 fs-&gt;c_yl&lt;=sp-&gt;prevcp.y &amp;&amp; fs-&gt;c_yh &gt;= sp-&gt;prevcp.y )</span>
<span class="lineNum">    4226 </span><span class="lineNoCov">          0 :             selp = true;</span>
<span class="lineNum">    4227 </span><span class="lineNoCov">          0 :         if ( seln &amp;&amp; selp ) {</span>
<span class="lineNum">    4228 </span>            :             /* Select the one with a spline attached. */
<span class="lineNum">    4229 </span><span class="lineNoCov">          0 :             if ( sp-&gt;prev!=NULL &amp;&amp; sp-&gt;next==NULL )</span>
<span class="lineNum">    4230 </span><span class="lineNoCov">          0 :                 seln = false;</span>
<span class="lineNum">    4231 </span>            :         }
<span class="lineNum">    4232 </span><span class="lineNoCov">          0 :         if ( seln ) {</span>
<span class="lineNum">    4233 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;sp = sp;</span>
<span class="lineNum">    4234 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;spline = NULL;</span>
<span class="lineNum">    4235 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;spl = spl;</span>
<span class="lineNum">    4236 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;nextcp = true;</span>
<span class="lineNum">    4237 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;anysel = true;</span>
<span class="lineNum">    4238 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;cp = sp-&gt;nextcp;</span>
<span class="lineNum">    4239 </span><span class="lineNoCov">          0 :             if ( sp-&gt;nonextcp &amp;&amp; (sp-&gt;pointtype==pt_curve || sp-&gt;pointtype==pt_hvcurve)) {</span>
<span class="lineNum">    4240 </span><span class="lineNoCov">          0 :                 fs-&gt;p-&gt;cp.x = sp-&gt;me.x + (sp-&gt;me.x-sp-&gt;prevcp.x);</span>
<span class="lineNum">    4241 </span><span class="lineNoCov">          0 :                 fs-&gt;p-&gt;cp.y = sp-&gt;me.y + (sp-&gt;me.y-sp-&gt;prevcp.y);</span>
<span class="lineNum">    4242 </span>            :             }
<span class="lineNum">    4243 </span><span class="lineNoCov">          0 :             sp-&gt;selected = true;</span>
<span class="lineNum">    4244 </span><span class="lineNoCov">          0 :             sp-&gt;nextcpselected = true;</span>
<span class="lineNum">    4245 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4246 </span><span class="lineNoCov">          0 :         } else if ( selp ) {</span>
<span class="lineNum">    4247 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;sp = sp;</span>
<span class="lineNum">    4248 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;spline = NULL;</span>
<span class="lineNum">    4249 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;spl = spl;</span>
<span class="lineNum">    4250 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;prevcp = true;</span>
<span class="lineNum">    4251 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;anysel = true;</span>
<span class="lineNum">    4252 </span><span class="lineNoCov">          0 :             fs-&gt;p-&gt;cp = sp-&gt;prevcp;</span>
<span class="lineNum">    4253 </span><span class="lineNoCov">          0 :             if ( sp-&gt;noprevcp &amp;&amp; (sp-&gt;pointtype==pt_curve || sp-&gt;pointtype==pt_hvcurve)) {</span>
<span class="lineNum">    4254 </span><span class="lineNoCov">          0 :                 fs-&gt;p-&gt;cp.x = sp-&gt;me.x + (sp-&gt;me.x-sp-&gt;nextcp.x);</span>
<span class="lineNum">    4255 </span><span class="lineNoCov">          0 :                 fs-&gt;p-&gt;cp.y = sp-&gt;me.y + (sp-&gt;me.y-sp-&gt;nextcp.y);</span>
<span class="lineNum">    4256 </span>            :             }
<span class="lineNum">    4257 </span><span class="lineNoCov">          0 :             sp-&gt;selected = true;</span>
<span class="lineNum">    4258 </span><span class="lineNoCov">          0 :             sp-&gt;prevcpselected = true;</span>
<span class="lineNum">    4259 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4260 </span>            :         }
<span class="lineNum">    4261 </span>            :     }
<span class="lineNum">    4262 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="4263"><span class="lineNum">    4263 </span>            : }</a>
<span class="lineNum">    4264 </span>            : 
<span class="lineNum">    4265 </span><span class="lineNoCov">          0 : static int CheckSpline(FindSel *fs, Spline *spline, SplineSet *spl) {</span>
<span class="lineNum">    4266 </span>            : 
<span class="lineNum">    4267 </span>            :     /* Anything else is better than a spline */
<span class="lineNum">    4268 </span><span class="lineNoCov">          0 :     if ( fs-&gt;p-&gt;anysel )</span>
<span class="lineNum">    4269 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    4270 </span>            : 
<span class="lineNum">    4271 </span><span class="lineNoCov">          0 :     if ( NearSpline(fs,spline)) {</span>
<span class="lineNum">    4272 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;spline = spline;</span>
<span class="lineNum">    4273 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;spl = spl;</span>
<span class="lineNum">    4274 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;anysel = true;</span>
<span class="lineNum">    4275 </span><span class="lineNoCov">          0 :         fs-&gt;p-&gt;spiro_index = SplineT2SpiroIndex(spline,fs-&gt;p-&gt;t,spl);</span>
<span class="lineNum">    4276 </span><span class="lineNoCov">          0 : return( false /*true*/ );       /* Check if there's a point where we are first */</span>
<span class="lineNum">    4277 </span>            :         /* if there is use it, if not (because anysel is true) we'll fall back */
<span class="lineNum">    4278 </span>            :         /* here */
<span class="lineNum">    4279 </span>            :     }
<span class="lineNum">    4280 </span>            : 
<span class="lineNum">    4281 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="4282"><span class="lineNum">    4282 </span>            : }</a>
<span class="lineNum">    4283 </span>            : 
<span class="lineNum">    4284 </span><span class="lineNoCov">          0 : static int InImage( FindSel *fs, ImageList *img) {</span>
<span class="lineNum">    4285 </span>            :     int x,y;
<span class="lineNum">    4286 </span>            : 
<span class="lineNum">    4287 </span><span class="lineNoCov">          0 :     x = floor((fs-&gt;p-&gt;cx-img-&gt;xoff)/img-&gt;xscale);</span>
<span class="lineNum">    4288 </span><span class="lineNoCov">          0 :     y = floor((img-&gt;yoff-fs-&gt;p-&gt;cy)/img-&gt;yscale);</span>
<span class="lineNum">    4289 </span><span class="lineNoCov">          0 :     if ( x&lt;0 || y&lt;0 || x&gt;=GImageGetWidth(img-&gt;image) || y&gt;=GImageGetHeight(img-&gt;image))</span>
<span class="lineNum">    4290 </span><span class="lineNoCov">          0 : return ( false );</span>
<span class="lineNum">    4291 </span><span class="lineNoCov">          0 :     if ( GImageGetPixelRGBA(img-&gt;image,x,y)&lt;0x80000000 )  /* Transparent(ish) */</span>
<span class="lineNum">    4292 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    4293 </span>            : 
<span class="lineNum">    4294 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="4295"><span class="lineNum">    4295 </span>            : }</a>
<span class="lineNum">    4296 </span>            : 
<span class="lineNum">    4297 </span><span class="lineNoCov">          0 : static int InSplineSet( FindSel *fs, SplinePointList *set,int inspiro) {</span>
<span class="lineNum">    4298 </span>            :     SplinePointList *spl;
<span class="lineNum">    4299 </span>            :     Spline *spline, *first;
<span class="lineNum">    4300 </span>            :     int i;
<span class="lineNum">    4301 </span>            : 
<span class="lineNum">    4302 </span><span class="lineNoCov">          0 :     for ( spl = set; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">    4303 </span><span class="lineNoCov">          0 :         if ( inspiro ) {</span>
<span class="lineNum">    4304 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;spl-&gt;spiro_cnt-1; ++i )</span>
<span class="lineNum">    4305 </span><span class="lineNoCov">          0 :                 if ( CheckSpiroPoint(fs,&amp;spl-&gt;spiros[i],spl,i))</span>
<span class="lineNum">    4306 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4307 </span><span class="lineNoCov">          0 :             first = NULL;</span>
<span class="lineNum">    4308 </span><span class="lineNoCov">          0 :             for ( spline = spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    4309 </span><span class="lineNoCov">          0 :                 if ( CheckSpline(fs,spline,spl), fs-&gt;p-&gt;anysel )</span>
<span class="lineNum">    4310 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4311 </span><span class="lineNoCov">          0 :                 if ( first==NULL ) first = spline;</span>
<span class="lineNum">    4312 </span>            :             }
<span class="lineNum">    4313 </span>            :         } else {
<span class="lineNum">    4314 </span><span class="lineNoCov">          0 :             if ( CheckPoint(fs,spl-&gt;first,spl) &amp;&amp; ( !fs-&gt;seek_controls || fs-&gt;p-&gt;nextcp || fs-&gt;p-&gt;prevcp )) {</span>
<span class="lineNum">    4315 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4316 </span>            :             }
<span class="lineNum">    4317 </span><span class="lineNoCov">          0 :             first = NULL;</span>
<span class="lineNum">    4318 </span><span class="lineNoCov">          0 :             for ( spline = spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    4319 </span><span class="lineNoCov">          0 :                 if ( (CheckPoint(fs,spline-&gt;to,spl) &amp;&amp; ( !fs-&gt;seek_controls || fs-&gt;p-&gt;nextcp || fs-&gt;p-&gt;prevcp )) ||</span>
<span class="lineNum">    4320 </span><span class="lineNoCov">          0 :                         ( CheckSpline(fs,spline,spl) &amp;&amp; !fs-&gt;seek_controls )) {</span>
<span class="lineNum">    4321 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4322 </span>            :                 }
<span class="lineNum">    4323 </span><span class="lineNoCov">          0 :                 if ( first==NULL ) first = spline;</span>
<span class="lineNum">    4324 </span>            :             }
<span class="lineNum">    4325 </span>            :         }
<span class="lineNum">    4326 </span>            :     }
<span class="lineNum">    4327 </span><span class="lineNoCov">          0 : return( fs-&gt;p-&gt;anysel );</span>
<a name="4328"><span class="lineNum">    4328 </span>            : }</a>
<span class="lineNum">    4329 </span>            : 
<span class="lineNum">    4330 </span><span class="lineNoCov">          0 : static int NearSplineSetPoints( FindSel *fs, SplinePointList *set,int inspiro) {</span>
<span class="lineNum">    4331 </span>            :     SplinePointList *spl;
<span class="lineNum">    4332 </span>            :     Spline *spline, *first;
<span class="lineNum">    4333 </span>            :     int i;
<span class="lineNum">    4334 </span>            : 
<span class="lineNum">    4335 </span><span class="lineNoCov">          0 :     for ( spl = set; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">    4336 </span><span class="lineNoCov">          0 :         if ( inspiro ) {</span>
<span class="lineNum">    4337 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;spl-&gt;spiro_cnt; ++i )</span>
<span class="lineNum">    4338 </span><span class="lineNoCov">          0 :                 if ( CheckSpiroPoint(fs,&amp;spl-&gt;spiros[i],spl,i))</span>
<span class="lineNum">    4339 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4340 </span>            :         } else {
<span class="lineNum">    4341 </span><span class="lineNoCov">          0 :             if ( CheckPoint(fs,spl-&gt;first,spl)) {</span>
<span class="lineNum">    4342 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4343 </span>            :             }
<span class="lineNum">    4344 </span><span class="lineNoCov">          0 :             first = NULL;</span>
<span class="lineNum">    4345 </span><span class="lineNoCov">          0 :             for ( spline = spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    4346 </span><span class="lineNoCov">          0 :                 if ( CheckPoint(fs,spline-&gt;to,spl) ) {</span>
<span class="lineNum">    4347 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    4348 </span>            :                 }
<span class="lineNum">    4349 </span><span class="lineNoCov">          0 :                 if ( first==NULL ) first = spline;</span>
<span class="lineNum">    4350 </span>            :             }
<span class="lineNum">    4351 </span>            :         }
<span class="lineNum">    4352 </span>            :     }
<span class="lineNum">    4353 </span><span class="lineNoCov">          0 : return( fs-&gt;p-&gt;anysel );</span>
<a name="4354"><span class="lineNum">    4354 </span>            : }</a>
<span class="lineNum">    4355 </span>            : 
<span class="lineNum">    4356 </span><span class="lineNoCov">          0 : static int16 MouseToCX( CharView *cv, int16 mx )</span>
<span class="lineNum">    4357 </span>            : {
<span class="lineNum">    4358 </span><span class="lineNoCov">          0 :     return( mx - cv-&gt;xoff ) / cv-&gt;scale;</span>
<span class="lineNum">    4359 </span>            : }
<a name="4360"><span class="lineNum">    4360 </span>            : </a>
<span class="lineNum">    4361 </span>            :     
<span class="lineNum">    4362 </span><span class="lineNoCov">          0 : static void SetFS( FindSel *fs, PressedOn *p, CharView *cv, GEvent *event) {</span>
<span class="lineNum">    4363 </span>            :     extern int snaptoint;
<span class="lineNum">    4364 </span>            : 
<span class="lineNum">    4365 </span><span class="lineNoCov">          0 :     memset(p,'\0',sizeof(PressedOn));</span>
<span class="lineNum">    4366 </span><span class="lineNoCov">          0 :     p-&gt;pressed = true;</span>
<span class="lineNum">    4367 </span>            : 
<span class="lineNum">    4368 </span><span class="lineNoCov">          0 :     memset(fs,'\0',sizeof(*fs));</span>
<span class="lineNum">    4369 </span><span class="lineNoCov">          0 :     fs-&gt;p = p;</span>
<span class="lineNum">    4370 </span><span class="lineNoCov">          0 :     fs-&gt;e = event;</span>
<span class="lineNum">    4371 </span><span class="lineNoCov">          0 :     p-&gt;x = event-&gt;u.mouse.x;</span>
<span class="lineNum">    4372 </span><span class="lineNoCov">          0 :     p-&gt;y = event-&gt;u.mouse.y;</span>
<span class="lineNum">    4373 </span><span class="lineNoCov">          0 :     p-&gt;cx = (event-&gt;u.mouse.x-cv-&gt;xoff)/cv-&gt;scale;</span>
<span class="lineNum">    4374 </span><span class="lineNoCov">          0 :     p-&gt;cy = (cv-&gt;height-event-&gt;u.mouse.y-cv-&gt;yoff)/cv-&gt;scale;</span>
<span class="lineNum">    4375 </span>            : 
<span class="lineNum">    4376 </span><span class="lineNoCov">          0 :     fs-&gt;fudge = (cv-&gt;active_tool==cvt_ruler ? snapdistancemeasuretool : snapdistance)/cv-&gt;scale;</span>
<span class="lineNum">    4377 </span>            : 
<span class="lineNum">    4378 </span>            :     /* If they have really large control points then expand
<span class="lineNum">    4379 </span>            :      * the selection range to allow them to still click on the
<span class="lineNum">    4380 </span>            :      * very edge of the control point to select it.
<span class="lineNum">    4381 </span>            :      */
<span class="lineNum">    4382 </span><span class="lineNoCov">          0 :     if( prefs_cvEditHandleSize &gt; prefs_cvEditHandleSize_default )</span>
<span class="lineNum">    4383 </span>            :     {
<span class="lineNum">    4384 </span><span class="lineNoCov">          0 :         float delta = (prefs_cvEditHandleSize - prefs_cvEditHandleSize_default) / cv-&gt;scale;</span>
<span class="lineNum">    4385 </span><span class="lineNoCov">          0 :         delta *= 1.5;</span>
<span class="lineNum">    4386 </span><span class="lineNoCov">          0 :         fs-&gt;fudge += delta;</span>
<span class="lineNum">    4387 </span>            :     }
<span class="lineNum">    4388 </span>            : 
<span class="lineNum">    4389 </span><span class="lineNoCov">          0 :     fs-&gt;c_xl = fs-&gt;xl = p-&gt;cx - fs-&gt;fudge;</span>
<span class="lineNum">    4390 </span><span class="lineNoCov">          0 :     fs-&gt;c_xh = fs-&gt;xh = p-&gt;cx + fs-&gt;fudge;</span>
<span class="lineNum">    4391 </span><span class="lineNoCov">          0 :     fs-&gt;c_yl = fs-&gt;yl = p-&gt;cy - fs-&gt;fudge;</span>
<span class="lineNum">    4392 </span><span class="lineNoCov">          0 :     fs-&gt;c_yh = fs-&gt;yh = p-&gt;cy + fs-&gt;fudge;</span>
<span class="lineNum">    4393 </span><span class="lineNoCov">          0 :     if ( snaptoint ) {</span>
<span class="lineNum">    4394 </span><span class="lineNoCov">          0 :         p-&gt;cx = rint(p-&gt;cx);</span>
<span class="lineNum">    4395 </span><span class="lineNoCov">          0 :         p-&gt;cy = rint(p-&gt;cy);</span>
<span class="lineNum">    4396 </span><span class="lineNoCov">          0 :         if ( fs-&gt;xl&gt;p-&gt;cx - fs-&gt;fudge )</span>
<span class="lineNum">    4397 </span><span class="lineNoCov">          0 :             fs-&gt;xl = p-&gt;cx - fs-&gt;fudge;</span>
<span class="lineNum">    4398 </span><span class="lineNoCov">          0 :         if ( fs-&gt;xh &lt; p-&gt;cx + fs-&gt;fudge )</span>
<span class="lineNum">    4399 </span><span class="lineNoCov">          0 :             fs-&gt;xh = p-&gt;cx + fs-&gt;fudge;</span>
<span class="lineNum">    4400 </span><span class="lineNoCov">          0 :         if ( fs-&gt;yl&gt;p-&gt;cy - fs-&gt;fudge )</span>
<span class="lineNum">    4401 </span><span class="lineNoCov">          0 :             fs-&gt;yl = p-&gt;cy - fs-&gt;fudge;</span>
<span class="lineNum">    4402 </span><span class="lineNoCov">          0 :         if ( fs-&gt;yh &lt; p-&gt;cy + fs-&gt;fudge )</span>
<span class="lineNum">    4403 </span><span class="lineNoCov">          0 :             fs-&gt;yh = p-&gt;cy + fs-&gt;fudge;</span>
<span class="lineNum">    4404 </span>            :     }
<a name="4405"><span class="lineNum">    4405 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4406 </span>            : 
<span class="lineNum">    4407 </span><span class="lineNoCov">          0 : int CVMouseAtSpline(CharView *cv,GEvent *event) {</span>
<span class="lineNum">    4408 </span>            :     FindSel fs;
<span class="lineNum">    4409 </span><span class="lineNoCov">          0 :     int pressed = cv-&gt;p.pressed;</span>
<span class="lineNum">    4410 </span>            : 
<span class="lineNum">    4411 </span><span class="lineNoCov">          0 :     SetFS(&amp;fs,&amp;cv-&gt;p,cv,event);</span>
<span class="lineNum">    4412 </span><span class="lineNoCov">          0 :     cv-&gt;p.pressed = pressed;</span>
<span class="lineNum">    4413 </span><span class="lineNoCov">          0 : return( InSplineSet(&amp;fs,cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro()));</span>
<a name="4414"><span class="lineNum">    4414 </span>            : }</a>
<span class="lineNum">    4415 </span>            : 
<span class="lineNum">    4416 </span><span class="lineNoCov">          0 : static GEvent *CVConstrainedMouseDown(CharView *cv,GEvent *event, GEvent *fake) {</span>
<span class="lineNum">    4417 </span>            :     SplinePoint *base;
<span class="lineNum">    4418 </span>            :     spiro_cp *basecp;
<span class="lineNum">    4419 </span>            :     int basex, basey, dx, dy;
<span class="lineNum">    4420 </span>            :     double basetruex, basetruey;
<span class="lineNum">    4421 </span>            :     int sign;
<span class="lineNum">    4422 </span>            : 
<span class="lineNum">    4423 </span><span class="lineNoCov">          0 :     if ( !CVAnySelPoint(cv,&amp;base,&amp;basecp))</span>
<span class="lineNum">    4424 </span><span class="lineNoCov">          0 : return( event );</span>
<span class="lineNum">    4425 </span>            : 
<span class="lineNum">    4426 </span><span class="lineNoCov">          0 :     if ( base!=NULL ) {</span>
<span class="lineNum">    4427 </span><span class="lineNoCov">          0 :         basetruex = base-&gt;me.x;</span>
<span class="lineNum">    4428 </span><span class="lineNoCov">          0 :         basetruey = base-&gt;me.y;</span>
<span class="lineNum">    4429 </span>            :     } else {
<span class="lineNum">    4430 </span><span class="lineNoCov">          0 :         basetruex = basecp-&gt;x;</span>
<span class="lineNum">    4431 </span><span class="lineNoCov">          0 :         basetruey = basecp-&gt;y;</span>
<span class="lineNum">    4432 </span>            :     }
<span class="lineNum">    4433 </span><span class="lineNoCov">          0 :     basex =  cv-&gt;xoff + rint(basetruex*cv-&gt;scale);</span>
<span class="lineNum">    4434 </span><span class="lineNoCov">          0 :     basey = -cv-&gt;yoff + cv-&gt;height - rint(basetruey*cv-&gt;scale);</span>
<span class="lineNum">    4435 </span>            : 
<span class="lineNum">    4436 </span><span class="lineNoCov">          0 :     dx= event-&gt;u.mouse.x-basex, dy = event-&gt;u.mouse.y-basey;</span>
<span class="lineNum">    4437 </span><span class="lineNoCov">          0 :     sign = dx*dy&lt;0?-1:1;</span>
<span class="lineNum">    4438 </span>            : 
<span class="lineNum">    4439 </span><span class="lineNoCov">          0 :     fake-&gt;u.mouse = event-&gt;u.mouse;</span>
<span class="lineNum">    4440 </span><span class="lineNoCov">          0 :     if ( dx&lt;0 ) dx = -dx; if ( dy&lt;0 ) dy = -dy;</span>
<span class="lineNum">    4441 </span><span class="lineNoCov">          0 :     if ( dy &gt;= 2*dx ) {</span>
<span class="lineNum">    4442 </span><span class="lineNoCov">          0 :         cv-&gt;p.x = fake-&gt;u.mouse.x = basex;</span>
<span class="lineNum">    4443 </span><span class="lineNoCov">          0 :         cv-&gt;p.cx = basetruex ;</span>
<span class="lineNum">    4444 </span><span class="lineNoCov">          0 :         if ( !(event-&gt;u.mouse.state&amp;ksm_meta) &amp;&amp;</span>
<span class="lineNum">    4445 </span><span class="lineNoCov">          0 :                 ItalicConstrained &amp;&amp; cv-&gt;b.sc-&gt;parent-&gt;italicangle!=0 ) {</span>
<span class="lineNum">    4446 </span><span class="lineNoCov">          0 :             double off = tan(cv-&gt;b.sc-&gt;parent-&gt;italicangle*3.1415926535897932/180)*</span>
<span class="lineNum">    4447 </span><span class="lineNoCov">          0 :                     (cv-&gt;p.cy-basetruey);</span>
<span class="lineNum">    4448 </span><span class="lineNoCov">          0 :             double aoff = off&lt;0 ? -off : off;</span>
<span class="lineNum">    4449 </span><span class="lineNoCov">          0 :             if ( dx&gt;=aoff*cv-&gt;scale/2 &amp;&amp; (event-&gt;u.mouse.x-basex&lt;0)!=(off&lt;0) ) {</span>
<span class="lineNum">    4450 </span><span class="lineNoCov">          0 :                 cv-&gt;p.cx -= off;</span>
<span class="lineNum">    4451 </span><span class="lineNoCov">          0 :                 cv-&gt;p.x = fake-&gt;u.mouse.x = cv-&gt;xoff + rint(cv-&gt;p.cx*cv-&gt;scale);</span>
<span class="lineNum">    4452 </span>            :             }
<span class="lineNum">    4453 </span>            :         }
<span class="lineNum">    4454 </span><span class="lineNoCov">          0 :     } else if ( dx &gt;= 2*dy ) {</span>
<span class="lineNum">    4455 </span><span class="lineNoCov">          0 :         fake-&gt;u.mouse.y = basey;</span>
<span class="lineNum">    4456 </span><span class="lineNoCov">          0 :         cv-&gt;p.cy = basetruey;</span>
<span class="lineNum">    4457 </span><span class="lineNoCov">          0 :     } else if ( dx &gt; dy ) {</span>
<span class="lineNum">    4458 </span><span class="lineNoCov">          0 :         fake-&gt;u.mouse.x = basex + sign * (event-&gt;u.mouse.y-cv-&gt;p.y);</span>
<span class="lineNum">    4459 </span><span class="lineNoCov">          0 :         cv-&gt;p.cx = basetruex - sign * (cv-&gt;p.cy-basetruey);</span>
<span class="lineNum">    4460 </span>            :     } else {
<span class="lineNum">    4461 </span><span class="lineNoCov">          0 :         fake-&gt;u.mouse.y = basey + sign * (event-&gt;u.mouse.x-cv-&gt;p.x);</span>
<span class="lineNum">    4462 </span><span class="lineNoCov">          0 :         cv-&gt;p.cy = basetruey - sign * (cv-&gt;p.cx-basetruex);</span>
<span class="lineNum">    4463 </span>            :     }
<span class="lineNum">    4464 </span>            : 
<span class="lineNum">    4465 </span><span class="lineNoCov">          0 : return( fake );</span>
<a name="4466"><span class="lineNum">    4466 </span>            : }</a>
<span class="lineNum">    4467 </span>            : 
<span class="lineNum">    4468 </span><span class="lineNoCov">          0 : static void CVSetConstrainPoint(CharView *cv, GEvent *event) {</span>
<span class="lineNum">    4469 </span>            :     SplineSet *sel;
<span class="lineNum">    4470 </span>            : 
<span class="lineNum">    4471 </span><span class="lineNoCov">          0 :     if ( (sel = CVAnySelPointList(cv))!=NULL ) {</span>
<span class="lineNum">    4472 </span><span class="lineNoCov">          0 :         if ( sel-&gt;first-&gt;selected ) cv-&gt;p.constrain = sel-&gt;first-&gt;me;</span>
<span class="lineNum">    4473 </span><span class="lineNoCov">          0 :         else cv-&gt;p.constrain = sel-&gt;last-&gt;me;</span>
<span class="lineNum">    4474 </span><span class="lineNoCov">          0 :     } else if ( cv-&gt;p.sp!=NULL ) {</span>
<span class="lineNum">    4475 </span><span class="lineNoCov">          0 :         cv-&gt;p.constrain = cv-&gt;p.sp-&gt;me;</span>
<span class="lineNum">    4476 </span>            :     } else {
<span class="lineNum">    4477 </span><span class="lineNoCov">          0 :         cv-&gt;p.constrain.x = cv-&gt;info.x;</span>
<span class="lineNum">    4478 </span><span class="lineNoCov">          0 :         cv-&gt;p.constrain.y = cv-&gt;info.y;</span>
<span class="lineNum">    4479 </span>            :     }
<a name="4480"><span class="lineNum">    4480 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4481 </span>            : 
<span class="lineNum">    4482 </span><span class="lineNoCov">          0 : static void CVDoSnaps(CharView *cv, FindSel *fs) {</span>
<span class="lineNum">    4483 </span><span class="lineNoCov">          0 :     PressedOn *p = fs-&gt;p;</span>
<span class="lineNum">    4484 </span>            : 
<span class="lineNum">    4485 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.drawmode!=dm_grid &amp;&amp; cv-&gt;b.layerheads[dm_grid]-&gt;splines!=NULL ) {</span>
<span class="lineNum">    4486 </span>            :         PressedOn temp;
<span class="lineNum">    4487 </span><span class="lineNoCov">          0 :         int oldseek = fs-&gt;seek_controls;</span>
<span class="lineNum">    4488 </span><span class="lineNoCov">          0 :         temp = *p;</span>
<span class="lineNum">    4489 </span><span class="lineNoCov">          0 :         fs-&gt;p = &amp;temp;</span>
<span class="lineNum">    4490 </span><span class="lineNoCov">          0 :         fs-&gt;seek_controls = false;</span>
<span class="lineNum">    4491 </span><span class="lineNoCov">          0 :         if ( InSplineSet( fs, cv-&gt;b.layerheads[dm_grid]-&gt;splines,cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro())) {</span>
<span class="lineNum">    4492 </span><span class="lineNoCov">          0 :             if ( temp.spline!=NULL ) {</span>
<span class="lineNum">    4493 </span><span class="lineNoCov">          0 :                 p-&gt;cx = ((temp.spline-&gt;splines[0].a*temp.t+</span>
<span class="lineNum">    4494 </span><span class="lineNoCov">          0 :                             temp.spline-&gt;splines[0].b)*temp.t+</span>
<span class="lineNum">    4495 </span><span class="lineNoCov">          0 :                             temp.spline-&gt;splines[0].c)*temp.t+</span>
<span class="lineNum">    4496 </span><span class="lineNoCov">          0 :                             temp.spline-&gt;splines[0].d;</span>
<span class="lineNum">    4497 </span><span class="lineNoCov">          0 :                 p-&gt;cy = ((temp.spline-&gt;splines[1].a*temp.t+</span>
<span class="lineNum">    4498 </span><span class="lineNoCov">          0 :                             temp.spline-&gt;splines[1].b)*temp.t+</span>
<span class="lineNum">    4499 </span><span class="lineNoCov">          0 :                             temp.spline-&gt;splines[1].c)*temp.t+</span>
<span class="lineNum">    4500 </span><span class="lineNoCov">          0 :                             temp.spline-&gt;splines[1].d;</span>
<span class="lineNum">    4501 </span><span class="lineNoCov">          0 :             } else if ( temp.sp!=NULL ) {</span>
<span class="lineNum">    4502 </span><span class="lineNoCov">          0 :                 p-&gt;cx = temp.sp-&gt;me.x;</span>
<span class="lineNum">    4503 </span><span class="lineNoCov">          0 :                 p-&gt;cy = temp.sp-&gt;me.y;</span>
<span class="lineNum">    4504 </span>            :             }
<span class="lineNum">    4505 </span>            :         }
<span class="lineNum">    4506 </span><span class="lineNoCov">          0 :         fs-&gt;p = p;</span>
<span class="lineNum">    4507 </span><span class="lineNoCov">          0 :         fs-&gt;seek_controls = oldseek;</span>
<span class="lineNum">    4508 </span>            :     }
<span class="lineNum">    4509 </span><span class="lineNoCov">          0 :     if ( p-&gt;cx&gt;-fs-&gt;fudge &amp;&amp; p-&gt;cx&lt;fs-&gt;fudge )</span>
<span class="lineNum">    4510 </span><span class="lineNoCov">          0 :         p-&gt;cx = 0;</span>
<span class="lineNum">    4511 </span><span class="lineNoCov">          0 :     else if ( p-&gt;cx&gt;cv-&gt;b.sc-&gt;width-fs-&gt;fudge &amp;&amp; p-&gt;cx&lt;cv-&gt;b.sc-&gt;width+fs-&gt;fudge &amp;&amp;</span>
<span class="lineNum">    4512 </span><span class="lineNoCov">          0 :             !cv-&gt;widthsel)</span>
<span class="lineNum">    4513 </span><span class="lineNoCov">          0 :         p-&gt;cx = cv-&gt;b.sc-&gt;width;</span>
<span class="lineNum">    4514 </span><span class="lineNoCov">          0 :     else if ( cv-&gt;widthsel &amp;&amp; p!=&amp;cv-&gt;p &amp;&amp;</span>
<span class="lineNum">    4515 </span><span class="lineNoCov">          0 :             p-&gt;cx&gt;cv-&gt;oldwidth-fs-&gt;fudge &amp;&amp; p-&gt;cx&lt;cv-&gt;oldwidth+fs-&gt;fudge )</span>
<span class="lineNum">    4516 </span><span class="lineNoCov">          0 :         p-&gt;cx = cv-&gt;oldwidth;</span>
<span class="lineNum">    4517 </span><span class="lineNoCov">          0 :     if ( p-&gt;cy&gt;-fs-&gt;fudge &amp;&amp; p-&gt;cy&lt;fs-&gt;fudge )</span>
<span class="lineNum">    4518 </span><span class="lineNoCov">          0 :         p-&gt;cy = 0;</span>
<a name="4519"><span class="lineNum">    4519 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4520 </span>            : 
<span class="lineNum">    4521 </span><span class="lineNoCov">          0 : static int _CVTestSelectFromEvent(CharView *cv,FindSel *fs) {</span>
<span class="lineNum">    4522 </span>            :     PressedOn temp;
<span class="lineNum">    4523 </span>            :     ImageList *img;
<span class="lineNum">    4524 </span>            :     int found;
<span class="lineNum">    4525 </span>            : 
<span class="lineNum">    4526 </span><span class="lineNoCov">          0 :     found = InSplineSet(fs,cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro());</span>
<span class="lineNum">    4527 </span>            : 
<span class="lineNum">    4528 </span><span class="lineNoCov">          0 :     if ( !found ) {</span>
<span class="lineNum">    4529 </span>            :         RefChar *rf;
<span class="lineNum">    4530 </span><span class="lineNoCov">          0 :         temp = cv-&gt;p;</span>
<span class="lineNum">    4531 </span><span class="lineNoCov">          0 :         fs-&gt;p = &amp;temp;</span>
<span class="lineNum">    4532 </span><span class="lineNoCov">          0 :         fs-&gt;seek_controls = false;</span>
<span class="lineNum">    4533 </span><span class="lineNoCov">          0 :         for ( rf=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs; rf!=NULL; rf = rf-&gt;next ) {</span>
<span class="lineNum">    4534 </span><span class="lineNoCov">          0 :             if ( InSplineSet(fs,rf-&gt;layers[0].splines,cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro())) {</span>
<span class="lineNum">    4535 </span><span class="lineNoCov">          0 :                 cv-&gt;p.ref = rf;</span>
<span class="lineNum">    4536 </span><span class="lineNoCov">          0 :                 cv-&gt;p.anysel = true;</span>
<span class="lineNum">    4537 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    4538 </span>            :             }
<span class="lineNum">    4539 </span>            :         }
<span class="lineNum">    4540 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.drawmode==dm_fore &amp;&amp; ( cv-&gt;showanchor &amp;&amp; !cv-&gt;p.anysel )) {</span>
<span class="lineNum">    4541 </span><span class="lineNoCov">          0 :             AnchorPoint *ap, *found=NULL;</span>
<span class="lineNum">    4542 </span>            :             /* I do this pecular search because: */
<span class="lineNum">    4543 </span>            :             /*  1) I expect there to be lots of times we get multiple */
<span class="lineNum">    4544 </span>            :             /*     anchors at the same location */
<span class="lineNum">    4545 </span>            :             /*  2) The anchor points are drawn so that the bottommost */
<span class="lineNum">    4546 </span>            :             /*     is displayed */
<span class="lineNum">    4547 </span><span class="lineNoCov">          0 :             for ( ap=cv-&gt;b.sc-&gt;anchor; ap!=NULL; ap=ap-&gt;next )</span>
<span class="lineNum">    4548 </span><span class="lineNoCov">          0 :                 if ( fs-&gt;xl&lt;=ap-&gt;me.x &amp;&amp; fs-&gt;xh&gt;=ap-&gt;me.x &amp;&amp;</span>
<span class="lineNum">    4549 </span><span class="lineNoCov">          0 :                         fs-&gt;yl&lt;=ap-&gt;me.y &amp;&amp; fs-&gt;yh &gt;= ap-&gt;me.y )</span>
<span class="lineNum">    4550 </span><span class="lineNoCov">          0 :                     found = ap;</span>
<span class="lineNum">    4551 </span><span class="lineNoCov">          0 :             if ( found!=NULL ) {</span>
<span class="lineNum">    4552 </span><span class="lineNoCov">          0 :                 cv-&gt;p.ap = found;</span>
<span class="lineNum">    4553 </span><span class="lineNoCov">          0 :                 cv-&gt;p.anysel = true;</span>
<span class="lineNum">    4554 </span>            :             }
<span class="lineNum">    4555 </span>            :         }
<span class="lineNum">    4556 </span><span class="lineNoCov">          0 :         for ( img = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images; img!=NULL; img=img-&gt;next ) {</span>
<span class="lineNum">    4557 </span><span class="lineNoCov">          0 :             if ( InImage(fs,img)) {</span>
<span class="lineNum">    4558 </span><span class="lineNoCov">          0 :                 cv-&gt;p.img = img;</span>
<span class="lineNum">    4559 </span><span class="lineNoCov">          0 :                 cv-&gt;p.anysel = true;</span>
<span class="lineNum">    4560 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    4561 </span>            :             }
<span class="lineNum">    4562 </span>            :         }
<span class="lineNum">    4563 </span>            :     }
<span class="lineNum">    4564 </span><span class="lineNoCov">          0 : return( cv-&gt;p.anysel );</span>
<a name="4565"><span class="lineNum">    4565 </span>            : }</a>
<span class="lineNum">    4566 </span>            : 
<span class="lineNum">    4567 </span><span class="lineNoCov">          0 : int CVTestSelectFromEvent(CharView *cv,GEvent *event) {</span>
<span class="lineNum">    4568 </span>            :     FindSel fs;
<span class="lineNum">    4569 </span>            : 
<span class="lineNum">    4570 </span><span class="lineNoCov">          0 :     SetFS(&amp;fs,&amp;cv-&gt;p,cv,event);</span>
<span class="lineNum">    4571 </span><span class="lineNoCov">          0 : return( _CVTestSelectFromEvent(cv,&amp;fs));</span>
<span class="lineNum">    4572 </span>            : }
<span class="lineNum">    4573 </span>            : 
<span class="lineNum">    4574 </span>            : /**
<span class="lineNum">    4575 </span>            :  * A cache for the selected spline point or spiro control point
<span class="lineNum">    4576 </span>            :  */
<span class="lineNum">    4577 </span>            : typedef struct lastselectedpoint
<span class="lineNum">    4578 </span>            : {
<span class="lineNum">    4579 </span>            :     SplinePoint *lastselpt;
<span class="lineNum">    4580 </span>            :     spiro_cp *lastselcp;
<span class="lineNum">    4581 </span>            : } lastSelectedPoint;
<a name="4582"><span class="lineNum">    4582 </span>            : </a>
<span class="lineNum">    4583 </span>            : 
<span class="lineNum">    4584 </span><span class="lineNoCov">          0 : void CVFreePreTransformSPL( CharView* cv )</span>
<span class="lineNum">    4585 </span>            : {
<span class="lineNum">    4586 </span><span class="lineNoCov">          0 :     if( cv-&gt;p.pretransform_spl )</span>
<span class="lineNum">    4587 </span>            :     {
<span class="lineNum">    4588 </span><span class="lineNoCov">          0 :         g_list_foreach( cv-&gt;p.pretransform_spl, (GFunc)SplinePointListFree, NULL );</span>
<span class="lineNum">    4589 </span><span class="lineNoCov">          0 :         g_list_free( cv-&gt;p.pretransform_spl );</span>
<span class="lineNum">    4590 </span>            :     }
<span class="lineNum">    4591 </span><span class="lineNoCov">          0 :     cv-&gt;p.pretransform_spl = 0;</span>
<a name="4592"><span class="lineNum">    4592 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4593 </span>            : 
<span class="lineNum">    4594 </span><span class="lineNoCov">          0 : static void CVMaybeCreateDraggingComparisonOutline( CharView* cv )</span>
<span class="lineNum">    4595 </span>            : {
<span class="lineNum">    4596 </span><span class="lineNoCov">          0 :     if( !prefs_create_dragging_comparison_outline )</span>
<span class="lineNum">    4597 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    4598 </span><span class="lineNoCov">          0 :     if( !cv )</span>
<span class="lineNum">    4599 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    4600 </span><span class="lineNoCov">          0 :     if( cv-&gt;p.pretransform_spl )</span>
<span class="lineNum">    4601 </span><span class="lineNoCov">          0 :         CVFreePreTransformSPL( cv );</span>
<span class="lineNum">    4602 </span>            : 
<span class="lineNum">    4603 </span><span class="lineNoCov">          0 :     Layer* l = cv-&gt;b.layerheads[cv-&gt;b.drawmode];</span>
<span class="lineNum">    4604 </span><span class="lineNoCov">          0 :     if( !l || !l-&gt;splines )</span>
<span class="lineNum">    4605 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    4606 </span>            : 
<span class="lineNum">    4607 </span><span class="lineNoCov">          0 :     SplinePointList* spl = l-&gt;splines;</span>
<span class="lineNum">    4608 </span><span class="lineNoCov">          0 :     for( ; spl; spl = spl-&gt;next )</span>
<span class="lineNum">    4609 </span>            :     {
<span class="lineNum">    4610 </span><span class="lineNoCov">          0 :         int anySel = 0;</span>
<span class="lineNum">    4611 </span><span class="lineNoCov">          0 :         SPLFirstVisitPoints( spl-&gt;first, isAnyControlPointSelectedVisitor, &amp;anySel );</span>
<span class="lineNum">    4612 </span><span class="lineNoCov">          0 :         if( anySel || (cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro()))</span>
<span class="lineNum">    4613 </span>            :         {
<span class="lineNum">    4614 </span><span class="lineNoCov">          0 :             cv-&gt;p.pretransform_spl = g_list_append( cv-&gt;p.pretransform_spl,</span>
<span class="lineNum">    4615 </span><span class="lineNoCov">          0 :                                                     SplinePointListCopy(spl) );</span>
<span class="lineNum">    4616 </span>            :         }
<span class="lineNum">    4617 </span>            :     }
<span class="lineNum">    4618 </span>            : 
<span class="lineNum">    4619 </span>            : }
<a name="4620"><span class="lineNum">    4620 </span>            : </a>
<span class="lineNum">    4621 </span>            : 
<span class="lineNum">    4622 </span><span class="lineNoCov">          0 : static void CVSwitchActiveSC( CharView *cv, SplineChar* sc, int idx )</span>
<span class="lineNum">    4623 </span>            : {
<span class="lineNum">    4624 </span><span class="lineNoCov">          0 :     int i=0;</span>
<span class="lineNum">    4625 </span><span class="lineNoCov">          0 :     FontViewBase *fv = cv-&gt;b.fv;</span>
<span class="lineNum">    4626 </span>            :     char buf[300];
<span class="lineNum">    4627 </span>            : 
<span class="lineNum">    4628 </span>            :     TRACE(&quot;CVSwitchActiveSC() idx:%d active:%d\n&quot;, idx, cv-&gt;additionalCharsToShowActiveIndex );
<span class="lineNum">    4629 </span><span class="lineNoCov">          0 :     if( !sc )</span>
<span class="lineNum">    4630 </span>            :     {
<span class="lineNum">    4631 </span><span class="lineNoCov">          0 :         sc = cv-&gt;additionalCharsToShow[i];</span>
<span class="lineNum">    4632 </span><span class="lineNoCov">          0 :         if( !sc )</span>
<span class="lineNum">    4633 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    4634 </span>            :     }
<span class="lineNum">    4635 </span>            :     else
<span class="lineNum">    4636 </span>            :     {
<span class="lineNum">    4637 </span>            :         // test for setting something twice
<span class="lineNum">    4638 </span><span class="lineNoCov">          0 :         if( !idx &amp;&amp; cv-&gt;additionalCharsToShowActiveIndex == idx )</span>
<span class="lineNum">    4639 </span>            :         {
<span class="lineNum">    4640 </span><span class="lineNoCov">          0 :             if( cv-&gt;additionalCharsToShow[i] == sc )</span>
<span class="lineNum">    4641 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    4642 </span>            :         }
<span class="lineNum">    4643 </span>            :     }
<span class="lineNum">    4644 </span>            :     
<span class="lineNum">    4645 </span><span class="lineNoCov">          0 :     cv-&gt;changedActiveGlyph = 1;</span>
<span class="lineNum">    4646 </span>            :     TRACE(&quot;CVSwitchActiveSC(b) activeidx:%d newidx:%d\n&quot;, cv-&gt;additionalCharsToShowActiveIndex, idx );
<span class="lineNum">    4647 </span><span class="lineNoCov">          0 :     for( i=0; i &lt; additionalCharsToShowLimit; i++ )</span>
<span class="lineNum">    4648 </span><span class="lineNoCov">          0 :         if( cv-&gt;additionalCharsToShow[i] )</span>
<span class="lineNum">    4649 </span>            :             TRACE(&quot;CVSwitchActiveSC(b) toshow.. i:%d char:%s\n&quot;, i, cv-&gt;additionalCharsToShow[i]
<span class="lineNum">    4650 </span>            :                    ? cv-&gt;additionalCharsToShow[i]-&gt;name : &quot;N/A&quot; );
<span class="lineNum">    4651 </span>            : 
<span class="lineNum">    4652 </span>            : 
<span class="lineNum">    4653 </span>            :     //
<span class="lineNum">    4654 </span>            :     // Work out how far we should scroll the panel to keep
<span class="lineNum">    4655 </span>            :     // the display from jumping around. First look right then
<span class="lineNum">    4656 </span>            :     // check left.
<span class="lineNum">    4657 </span><span class="lineNoCov">          0 :     int scroll_offset = 0;</span>
<span class="lineNum">    4658 </span><span class="lineNoCov">          0 :     if( idx &gt; cv-&gt;additionalCharsToShowActiveIndex )</span>
<span class="lineNum">    4659 </span>            :     {
<span class="lineNum">    4660 </span><span class="lineNoCov">          0 :         SplineChar* xc = 0;</span>
<span class="lineNum">    4661 </span><span class="lineNoCov">          0 :         int i = 0;</span>
<span class="lineNum">    4662 </span><span class="lineNoCov">          0 :         scroll_offset = cv-&gt;b.sc-&gt;width;</span>
<span class="lineNum">    4663 </span><span class="lineNoCov">          0 :         int ridx = cv-&gt;additionalCharsToShowActiveIndex+1;</span>
<span class="lineNum">    4664 </span><span class="lineNoCov">          0 :         for( i=ridx; i &lt; idx; i++ )</span>
<span class="lineNum">    4665 </span>            :         {
<span class="lineNum">    4666 </span><span class="lineNoCov">          0 :             if((xc = cv-&gt;additionalCharsToShow[i]))</span>
<span class="lineNum">    4667 </span><span class="lineNoCov">          0 :                 scroll_offset += xc-&gt;width;</span>
<span class="lineNum">    4668 </span>            :         }
<span class="lineNum">    4669 </span>            :     }
<span class="lineNum">    4670 </span><span class="lineNoCov">          0 :     if( idx &lt; cv-&gt;additionalCharsToShowActiveIndex )</span>
<span class="lineNum">    4671 </span>            :     {
<span class="lineNum">    4672 </span><span class="lineNoCov">          0 :         SplineChar* xc = 0;</span>
<span class="lineNum">    4673 </span><span class="lineNoCov">          0 :         int i = 0;</span>
<span class="lineNum">    4674 </span><span class="lineNoCov">          0 :         scroll_offset = 0;</span>
<span class="lineNum">    4675 </span><span class="lineNoCov">          0 :         int ridx = cv-&gt;additionalCharsToShowActiveIndex-1;</span>
<span class="lineNum">    4676 </span><span class="lineNoCov">          0 :         for( i=ridx; i &gt;= idx; i-- )</span>
<span class="lineNum">    4677 </span>            :         {
<span class="lineNum">    4678 </span><span class="lineNoCov">          0 :             if((xc = cv-&gt;additionalCharsToShow[i]))</span>
<span class="lineNum">    4679 </span><span class="lineNoCov">          0 :                 scroll_offset -= xc-&gt;width;</span>
<span class="lineNum">    4680 </span>            :         }
<span class="lineNum">    4681 </span>            :     }
<span class="lineNum">    4682 </span>            :     
<span class="lineNum">    4683 </span>            :     
<span class="lineNum">    4684 </span>            : 
<span class="lineNum">    4685 </span>            : 
<span class="lineNum">    4686 </span>            :     
<span class="lineNum">    4687 </span><span class="lineNoCov">          0 :     CVUnlinkView( cv );</span>
<span class="lineNum">    4688 </span><span class="lineNoCov">          0 :     cv-&gt;b.sc = sc;</span>
<span class="lineNum">    4689 </span><span class="lineNoCov">          0 :     cv-&gt;b.next = sc-&gt;views;</span>
<span class="lineNum">    4690 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[dm_fore] = &amp;sc-&gt;layers[ly_fore];</span>
<span class="lineNum">    4691 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[dm_back] = &amp;sc-&gt;layers[ly_back];</span>
<span class="lineNum">    4692 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[dm_grid] = &amp;fv-&gt;sf-&gt;grid;</span>
<span class="lineNum">    4693 </span><span class="lineNoCov">          0 :     if ( !sc-&gt;parent-&gt;multilayer &amp;&amp; fv-&gt;active_layer!=ly_fore ) {</span>
<span class="lineNum">    4694 </span><span class="lineNoCov">          0 :         cv-&gt;b.layerheads[dm_back] = &amp;sc-&gt;layers[fv-&gt;active_layer];</span>
<span class="lineNum">    4695 </span><span class="lineNoCov">          0 :         cv-&gt;b.drawmode = dm_back;</span>
<span class="lineNum">    4696 </span>            :     }
<span class="lineNum">    4697 </span><span class="lineNoCov">          0 :     CharIcon(cv,(FontView *) (cv-&gt;b.fv));</span>
<span class="lineNum">    4698 </span><span class="lineNoCov">          0 :     char* title = CVMakeTitles(cv,buf,sizeof(buf));</span>
<span class="lineNum">    4699 </span><span class="lineNoCov">          0 :     GDrawSetWindowTitles8(cv-&gt;gw,buf,title);</span>
<span class="lineNum">    4700 </span><span class="lineNoCov">          0 :     CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    4701 </span><span class="lineNoCov">          0 :     free(title);</span>
<span class="lineNum">    4702 </span><span class="lineNoCov">          0 :     _CVPaletteActivate(cv,true);</span>
<span class="lineNum">    4703 </span>            :     
<span class="lineNum">    4704 </span>            :     TRACE(&quot;CVSwitchActiveSC() idx:%d\n&quot;, idx );
<span class="lineNum">    4705 </span>            : 
<span class="lineNum">    4706 </span><span class="lineNoCov">          0 :     cv-&gt;additionalCharsToShowActiveIndex = idx;</span>
<span class="lineNum">    4707 </span>            : 
<span class="lineNum">    4708 </span>            :     // update the select[i]on in the input text to reflect
<span class="lineNum">    4709 </span>            :     // the users currently selected char.
<span class="lineNum">    4710 </span>            :     {
<span class="lineNum">    4711 </span><span class="lineNoCov">          0 :         SplineFont* sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">    4712 </span><span class="lineNoCov">          0 :         EncMap *map = ((FontView *) (cv-&gt;b.fv))-&gt;b.map;</span>
<span class="lineNum">    4713 </span><span class="lineNoCov">          0 :         unichar_t *srctxt = GGadgetGetTitle( cv-&gt;charselector );</span>
<span class="lineNum">    4714 </span><span class="lineNoCov">          0 :         int endsWithSlash = u_endswith( srctxt, c_to_u(&quot;/&quot;));</span>
<span class="lineNum">    4715 </span>            : 
<span class="lineNum">    4716 </span><span class="lineNoCov">          0 :         unichar_t* p = 0;</span>
<span class="lineNum">    4717 </span><span class="lineNoCov">          0 :         p = Wordlist_selectionClear( sf, map, srctxt ); </span>
<span class="lineNum">    4718 </span><span class="lineNoCov">          0 :         p = Wordlist_selectionAdd(   sf, map, p, idx );</span>
<span class="lineNum">    4719 </span><span class="lineNoCov">          0 :         if( endsWithSlash )</span>
<span class="lineNum">    4720 </span><span class="lineNoCov">          0 :             uc_strcat( p, &quot;/&quot; );</span>
<span class="lineNum">    4721 </span>            : 
<span class="lineNum">    4722 </span>            :         // only update when the selection has changed.
<span class="lineNum">    4723 </span>            :         // updating this string is a non reversable operation if the
<span class="lineNum">    4724 </span>            :         // user is part way through typing some text.
<span class="lineNum">    4725 </span><span class="lineNoCov">          0 :         if( !Wordlist_selectionsEqual( srctxt, p ))</span>
<span class="lineNum">    4726 </span>            :         {
<span class="lineNum">    4727 </span><span class="lineNoCov">          0 :             GGadgetSetTitle( cv-&gt;charselector, p );</span>
<span class="lineNum">    4728 </span>            :         }
<span class="lineNum">    4729 </span>            :     }
<span class="lineNum">    4730 </span>            :     
<span class="lineNum">    4731 </span>            :     
<span class="lineNum">    4732 </span><span class="lineNoCov">          0 :     cv-&gt;b.next = sc-&gt;views;</span>
<span class="lineNum">    4733 </span><span class="lineNoCov">          0 :     sc-&gt;views = &amp;cv-&gt;b;</span>
<span class="lineNum">    4734 </span>            : 
<span class="lineNum">    4735 </span>            :     // Move the scrollbar so that it appears the selection
<span class="lineNum">    4736 </span>            :     // box has moved rather than all the characters.
<span class="lineNum">    4737 </span><span class="lineNoCov">          0 :     if( scroll_offset )</span>
<span class="lineNum">    4738 </span><span class="lineNoCov">          0 :         CVHScrollSetPos( cv, cv-&gt;xoff + scroll_offset * cv-&gt;scale );</span>
<span class="lineNum">    4739 </span>            :     
<span class="lineNum">    4740 </span>            : //    if ( CVClearSel(cv))
<span class="lineNum">    4741 </span>            : //      SCUpdateAll(cv-&gt;b.sc);
<span class="lineNum">    4742 </span>            :     
<a name="4743"><span class="lineNum">    4743 </span>            : }</a>
<span class="lineNum">    4744 </span>            : 
<span class="lineNum">    4745 </span><span class="lineNoCov">          0 : static void CVMouseDown(CharView *cv, GEvent *event ) {</span>
<span class="lineNum">    4746 </span>            :     FindSel fs;
<span class="lineNum">    4747 </span>            :     GEvent fake;
<span class="lineNum">    4748 </span>            :     lastSelectedPoint lastSel;
<span class="lineNum">    4749 </span><span class="lineNoCov">          0 :     memset( &amp;lastSel, 0, sizeof(lastSelectedPoint));</span>
<span class="lineNum">    4750 </span>            : 
<span class="lineNum">    4751 </span><span class="lineNoCov">          0 :     if ( event-&gt;u.mouse.button==2 &amp;&amp; event-&gt;u.mouse.device!=NULL &amp;&amp;</span>
<span class="lineNum">    4752 </span><span class="lineNoCov">          0 :             strcmp(event-&gt;u.mouse.device,&quot;stylus&quot;)==0 )</span>
<span class="lineNum">    4753 </span><span class="lineNoCov">          0 : return;         /* I treat this more like a modifier key change than a button press */</span>
<span class="lineNum">    4754 </span>            : 
<span class="lineNum">    4755 </span><span class="lineNoCov">          0 :     if ( cv-&gt;expandedge != ee_none )</span>
<span class="lineNum">    4756 </span><span class="lineNoCov">          0 :         GDrawSetCursor(cv-&gt;v,ct_mypointer);</span>
<span class="lineNum">    4757 </span><span class="lineNoCov">          0 :     if ( event-&gt;u.mouse.button==3 )</span>
<span class="lineNum">    4758 </span>            :     {
<span class="lineNum">    4759 </span>            :         /* context menu */
<span class="lineNum">    4760 </span><span class="lineNoCov">          0 :         CVToolsPopup(cv,event);</span>
<span class="lineNum">    4761 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    4762 </span>            :     }
<span class="lineNum">    4763 </span>            : 
<span class="lineNum">    4764 </span>            :     TRACE(&quot;tool:%d pointer:%d ctl:%d alt:%d\n&quot;,
<span class="lineNum">    4765 </span>            :            cv-&gt;showing_tool,
<span class="lineNum">    4766 </span>            :            (cv-&gt;showing_tool == cvt_pointer),
<span class="lineNum">    4767 </span>            :            cv-&gt;activeModifierControl, cv-&gt;activeModifierAlt );
<span class="lineNum">    4768 </span>            : 
<span class="lineNum">    4769 </span><span class="lineNoCov">          0 :     int8 override_showing_tool = cvt_none;</span>
<span class="lineNum">    4770 </span><span class="lineNoCov">          0 :     int8 old_showing_tool = cv-&gt;showing_tool;</span>
<span class="lineNum">    4771 </span><span class="lineNoCov">          0 :     if( cv-&gt;showing_tool == cvt_pointer</span>
<span class="lineNum">    4772 </span><span class="lineNoCov">          0 :         &amp;&amp; cv-&gt;activeModifierControl</span>
<span class="lineNum">    4773 </span><span class="lineNoCov">          0 :         &amp;&amp; cv-&gt;activeModifierAlt )</span>
<span class="lineNum">    4774 </span>            :     {
<span class="lineNum">    4775 </span>            :         FindSel fs;
<span class="lineNum">    4776 </span><span class="lineNoCov">          0 :         SetFS(&amp;fs,&amp;cv-&gt;p,cv,event);</span>
<span class="lineNum">    4777 </span><span class="lineNoCov">          0 :         int found = InSplineSet( &amp;fs, cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,</span>
<span class="lineNum">    4778 </span><span class="lineNoCov">          0 :                                  cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro());</span>
<span class="lineNum">    4779 </span>            :         TRACE(&quot;in spline set:%d cv-&gt;p.sp:%p\n&quot;, found, cv-&gt;p.sp );
<span class="lineNum">    4780 </span>            : 
<span class="lineNum">    4781 </span>            :         //
<span class="lineNum">    4782 </span>            :         // Only overwrite to create a point if the user has clicked a spline.
<span class="lineNum">    4783 </span>            :         //
<span class="lineNum">    4784 </span><span class="lineNoCov">          0 :         if( found &amp;&amp; !cv-&gt;p.sp )</span>
<span class="lineNum">    4785 </span><span class="lineNoCov">          0 :             override_showing_tool = cvt_curve;</span>
<span class="lineNum">    4786 </span>            :     }
<span class="lineNum">    4787 </span>            :     
<span class="lineNum">    4788 </span><span class="lineNoCov">          0 :     if( cv-&gt;charselector &amp;&amp; cv-&gt;charselector == GWindowGetFocusGadgetOfWindow(cv-&gt;gw))</span>
<span class="lineNum">    4789 </span><span class="lineNoCov">          0 :         GWindowClearFocusGadgetOfWindow(cv-&gt;gw);</span>
<span class="lineNum">    4790 </span>            : 
<span class="lineNum">    4791 </span><span class="lineNoCov">          0 :     update_spacebar_hand_tool(cv);</span>
<span class="lineNum">    4792 </span>            : 
<span class="lineNum">    4793 </span><span class="lineNoCov">          0 :     CVToolsSetCursor(cv,event-&gt;u.mouse.state|(1&lt;&lt;(7+event-&gt;u.mouse.button)), event-&gt;u.mouse.device );</span>
<span class="lineNum">    4794 </span><span class="lineNoCov">          0 :     if( override_showing_tool != cvt_none )</span>
<span class="lineNum">    4795 </span><span class="lineNoCov">          0 :         cv-&gt;showing_tool = override_showing_tool;</span>
<span class="lineNum">    4796 </span><span class="lineNoCov">          0 :     cv-&gt;active_tool = cv-&gt;showing_tool;</span>
<span class="lineNum">    4797 </span><span class="lineNoCov">          0 :     cv-&gt;needsrasterize = false;</span>
<span class="lineNum">    4798 </span><span class="lineNoCov">          0 :     cv-&gt;recentchange = false;</span>
<span class="lineNum">    4799 </span>            : 
<span class="lineNum">    4800 </span>            :     
<span class="lineNum">    4801 </span><span class="lineNoCov">          0 :     SetFS(&amp;fs,&amp;cv-&gt;p,cv,event);</span>
<span class="lineNum">    4802 </span><span class="lineNoCov">          0 :     if ( event-&gt;u.mouse.state&amp;ksm_shift )</span>
<span class="lineNum">    4803 </span><span class="lineNoCov">          0 :         event = CVConstrainedMouseDown(cv,event,&amp;fake);</span>
<span class="lineNum">    4804 </span>            : 
<span class="lineNum">    4805 </span><span class="lineNoCov">          0 :     if ( cv-&gt;active_tool == cvt_pointer ) {</span>
<span class="lineNum">    4806 </span><span class="lineNoCov">          0 :         fs.select_controls = true;</span>
<span class="lineNum">    4807 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.mouse.state&amp;ksm_meta ) {</span>
<span class="lineNum">    4808 </span><span class="lineNoCov">          0 :             fs.seek_controls = true;</span>
<span class="lineNum">    4809 </span>            :             /* Allow more slop looking for control points if they asked for them */
<span class="lineNum">    4810 </span><span class="lineNoCov">          0 :             fs.c_xl -= fs.fudge; fs.c_xh += fs.fudge;</span>
<span class="lineNum">    4811 </span><span class="lineNoCov">          0 :             fs.c_yl -= fs.fudge; fs.c_yh += fs.fudge;</span>
<span class="lineNum">    4812 </span>            :         }
<span class="lineNum">    4813 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showpointnumbers &amp;&amp; cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2 )</span>
<span class="lineNum">    4814 </span><span class="lineNoCov">          0 :             fs.all_controls = true;</span>
<span class="lineNum">    4815 </span><span class="lineNoCov">          0 :         fs.alwaysshowcontrolpoints = cv-&gt;alwaysshowcontrolpoints;</span>
<span class="lineNum">    4816 </span><span class="lineNoCov">          0 :         lastSel.lastselpt = cv-&gt;lastselpt;</span>
<span class="lineNum">    4817 </span><span class="lineNoCov">          0 :         lastSel.lastselcp = cv-&gt;lastselcp;</span>
<span class="lineNum">    4818 </span><span class="lineNoCov">          0 :         cv-&gt;lastselpt = NULL;</span>
<span class="lineNum">    4819 </span><span class="lineNoCov">          0 :         cv-&gt;lastselcp = NULL;</span>
<span class="lineNum">    4820 </span><span class="lineNoCov">          0 :         _CVTestSelectFromEvent(cv,&amp;fs);</span>
<span class="lineNum">    4821 </span><span class="lineNoCov">          0 :         fs.p = &amp;cv-&gt;p;</span>
<span class="lineNum">    4822 </span>            : 
<span class="lineNum">    4823 </span>            : //      TRACE(&quot;cvmousedown cv-&gt;xoff:%d\n&quot;, cv-&gt;xoff );
<span class="lineNum">    4824 </span>            : //      TRACE(&quot;cvmousedown x:%d y:%d\n&quot;,   event-&gt;u.mouse.x, event-&gt;u.mouse.y );
<span class="lineNum">    4825 </span>            :             
<span class="lineNum">    4826 </span><span class="lineNoCov">          0 :         if( !cv-&gt;p.anysel &amp;&amp; cv-&gt;b.drawmode != dm_grid )</span>
<span class="lineNum">    4827 </span>            :         {
<span class="lineNum">    4828 </span>            :             // If we are in left-right arrow cursor mode to move
<span class="lineNum">    4829 </span>            :             // those bearings then don't even think about changing
<span class="lineNum">    4830 </span>            :             // the char right now.
<span class="lineNum">    4831 </span><span class="lineNoCov">          0 :             if( !CVNearRBearingLine( cv, cv-&gt;p.cx, fs.fudge )</span>
<span class="lineNum">    4832 </span><span class="lineNoCov">          0 :                 &amp;&amp; !CVNearLBearingLine( cv, cv-&gt;p.cx, fs.fudge ))</span>
<span class="lineNum">    4833 </span>            :             {
<span class="lineNum">    4834 </span><span class="lineNoCov">          0 :                 int i=0;</span>
<span class="lineNum">    4835 </span><span class="lineNoCov">          0 :                 FindSel fsadjusted = fs;</span>
<span class="lineNum">    4836 </span><span class="lineNoCov">          0 :                 fsadjusted.c_xl -= 2*fsadjusted.fudge;</span>
<span class="lineNum">    4837 </span><span class="lineNoCov">          0 :                 fsadjusted.c_xh += 2*fsadjusted.fudge;</span>
<span class="lineNum">    4838 </span><span class="lineNoCov">          0 :                 fsadjusted.xl -= 2*fsadjusted.fudge;</span>
<span class="lineNum">    4839 </span><span class="lineNoCov">          0 :                 fsadjusted.xh += 2*fsadjusted.fudge;</span>
<span class="lineNum">    4840 </span><span class="lineNoCov">          0 :                 SplineChar* xc = 0;</span>
<span class="lineNum">    4841 </span><span class="lineNoCov">          0 :                 int xcidx = -1;</span>
<span class="lineNum">    4842 </span><span class="lineNoCov">          0 :                 int borderFudge = 20;</span>
<span class="lineNum">    4843 </span>            :             
<span class="lineNum">    4844 </span>            :                 {
<span class="lineNum">    4845 </span><span class="lineNoCov">          0 :                     int offset = cv-&gt;b.sc-&gt;width;</span>
<span class="lineNum">    4846 </span><span class="lineNoCov">          0 :                     int cumulativeLeftSideBearing = 0;</span>
<span class="lineNum">    4847 </span>            : //              TRACE(&quot;first offset:%d original cx:%f \n&quot;, offset, fsadjusted.p-&gt;cx );
<span class="lineNum">    4848 </span><span class="lineNoCov">          0 :                     int ridx = cv-&gt;additionalCharsToShowActiveIndex+1;</span>
<span class="lineNum">    4849 </span><span class="lineNoCov">          0 :                     for( i=ridx; i &lt; additionalCharsToShowLimit; i++ )</span>
<span class="lineNum">    4850 </span>            :                     {
<span class="lineNum">    4851 </span><span class="lineNoCov">          0 :                         if( i == cv-&gt;additionalCharsToShowActiveIndex )</span>
<span class="lineNum">    4852 </span><span class="lineNoCov">          0 :                             continue;</span>
<span class="lineNum">    4853 </span><span class="lineNoCov">          0 :                         xc = cv-&gt;additionalCharsToShow[i];</span>
<span class="lineNum">    4854 </span><span class="lineNoCov">          0 :                         if( !xc )</span>
<span class="lineNum">    4855 </span><span class="lineNoCov">          0 :                             break;</span>
<span class="lineNum">    4856 </span><span class="lineNoCov">          0 :                         int OffsetForDoingCharNextToActive = 0;</span>
<span class="lineNum">    4857 </span><span class="lineNoCov">          0 :                         if( i == ridx )</span>
<span class="lineNum">    4858 </span>            :                         {
<span class="lineNum">    4859 </span><span class="lineNoCov">          0 :                             OffsetForDoingCharNextToActive = borderFudge;</span>
<span class="lineNum">    4860 </span>            :                         }
<span class="lineNum">    4861 </span>            :                     
<span class="lineNum">    4862 </span>            : 
<span class="lineNum">    4863 </span><span class="lineNoCov">          0 :                         cumulativeLeftSideBearing += offset;</span>
<span class="lineNum">    4864 </span>            :                         /* TRACE(&quot;1 adj. x:%f %f\n&quot;,fsadjusted.xl,fsadjusted.xh); */
<span class="lineNum">    4865 </span>            :                         /* TRACE(&quot;1 adj.cx:%f %f\n&quot;,fsadjusted.c_xl,fsadjusted.c_xh); */
<span class="lineNum">    4866 </span>            :                         /* TRACE(&quot;1 p.  cx:%f %f\n&quot;,fsadjusted.p-&gt;cx,fsadjusted.p-&gt;cy ); */
<span class="lineNum">    4867 </span>            :                         /* fsadjusted.c_xl -= offset; */
<span class="lineNum">    4868 </span>            :                         /* fsadjusted.c_xh -= offset; */
<span class="lineNum">    4869 </span>            :                         /* fsadjusted.xl   -= offset; */
<span class="lineNum">    4870 </span>            :                         /* fsadjusted.xh   -= offset; */
<span class="lineNum">    4871 </span>            :                         /* TRACE(&quot;2 adj. x:%f %f\n&quot;,fsadjusted.xl,fsadjusted.xh); */
<span class="lineNum">    4872 </span>            :                         /* TRACE(&quot;2 adj.cx:%f %f\n&quot;,fsadjusted.c_xl,fsadjusted.c_xh); */
<span class="lineNum">    4873 </span>            :                         /* TRACE(&quot;2 p.  cx:%f %f\n&quot;,fsadjusted.p-&gt;cx,fsadjusted.p-&gt;cy ); */
<span class="lineNum">    4874 </span>            :                         /* int found = InSplineSet( &amp;fsadjusted, */
<span class="lineNum">    4875 </span>            :                         /*                           xc-&gt;layers[cv-&gt;b.drawmode-1].splines, */
<span class="lineNum">    4876 </span>            :                         /*                           xc-&gt;inspiro &amp;&amp; hasspiro()); */
<span class="lineNum">    4877 </span>            :                         TRACE(&quot;A:%d\n&quot;, cumulativeLeftSideBearing );
<span class="lineNum">    4878 </span>            :                         TRACE(&quot;B:%f\n&quot;, fsadjusted.p-&gt;cx );
<span class="lineNum">    4879 </span>            :                         TRACE(&quot;C:%d\n&quot;, cumulativeLeftSideBearing+xc-&gt;width );
<span class="lineNum">    4880 </span><span class="lineNoCov">          0 :                         int found = IS_IN_ORDER3(</span>
<span class="lineNum">    4881 </span>            :                             cumulativeLeftSideBearing + OffsetForDoingCharNextToActive,
<span class="lineNum">    4882 </span>            :                             fsadjusted.p-&gt;cx,
<span class="lineNum">    4883 </span>            :                             cumulativeLeftSideBearing+xc-&gt;width );
<span class="lineNum">    4884 </span>            :                         TRACE(&quot;CVMOUSEDOWN i:%d found:%d\n&quot;, i, found );
<span class="lineNum">    4885 </span><span class="lineNoCov">          0 :                         if( found )</span>
<span class="lineNum">    4886 </span>            :                         {
<span class="lineNum">    4887 </span>            :                             TRACE(&quot;FOUND FOUND FOUND FOUND FOUND FOUND FOUND \n&quot;);
<span class="lineNum">    4888 </span>            :                         
<span class="lineNum">    4889 </span><span class="lineNoCov">          0 :                             xcidx = i;</span>
<span class="lineNum">    4890 </span>            : //                  CVChangeSC(cv,xc);
<span class="lineNum">    4891 </span><span class="lineNoCov">          0 :                             break;</span>
<span class="lineNum">    4892 </span>            :                         }
<span class="lineNum">    4893 </span>            : 
<span class="lineNum">    4894 </span><span class="lineNoCov">          0 :                         offset = xc-&gt;width;</span>
<span class="lineNum">    4895 </span>            :                     }
<span class="lineNum">    4896 </span>            :                 }
<span class="lineNum">    4897 </span>            : 
<span class="lineNum">    4898 </span><span class="lineNoCov">          0 :                 fsadjusted = fs;</span>
<span class="lineNum">    4899 </span><span class="lineNoCov">          0 :                 fsadjusted.c_xl -= 2*fsadjusted.fudge;</span>
<span class="lineNum">    4900 </span><span class="lineNoCov">          0 :                 fsadjusted.c_xh += 2*fsadjusted.fudge;</span>
<span class="lineNum">    4901 </span><span class="lineNoCov">          0 :                 fsadjusted.xl -= 2*fsadjusted.fudge;</span>
<span class="lineNum">    4902 </span><span class="lineNoCov">          0 :                 fsadjusted.xh += 2*fsadjusted.fudge;</span>
<span class="lineNum">    4903 </span>            : 
<span class="lineNum">    4904 </span><span class="lineNoCov">          0 :                 if( !xc &amp;&amp; cv-&gt;additionalCharsToShowActiveIndex &gt; 0 )</span>
<span class="lineNum">    4905 </span>            :                 {
<span class="lineNum">    4906 </span><span class="lineNoCov">          0 :                     xc = cv-&gt;additionalCharsToShow[cv-&gt;additionalCharsToShowActiveIndex-1];</span>
<span class="lineNum">    4907 </span><span class="lineNoCov">          0 :                     int offset = xc-&gt;width;</span>
<span class="lineNum">    4908 </span><span class="lineNoCov">          0 :                     int cumulativeLeftSideBearing = 0;</span>
<span class="lineNum">    4909 </span>            : //              TRACE(&quot;first offset:%d original cx:%f \n&quot;, offset, fsadjusted.p-&gt;cx );
<span class="lineNum">    4910 </span><span class="lineNoCov">          0 :                     int lidx = cv-&gt;additionalCharsToShowActiveIndex-1;</span>
<span class="lineNum">    4911 </span><span class="lineNoCov">          0 :                     for( i=lidx; i&gt;=0; i-- )</span>
<span class="lineNum">    4912 </span>            :                     {
<span class="lineNum">    4913 </span><span class="lineNoCov">          0 :                         if( i == cv-&gt;additionalCharsToShowActiveIndex )</span>
<span class="lineNum">    4914 </span><span class="lineNoCov">          0 :                             continue;</span>
<span class="lineNum">    4915 </span><span class="lineNoCov">          0 :                         xc = cv-&gt;additionalCharsToShow[i];</span>
<span class="lineNum">    4916 </span><span class="lineNoCov">          0 :                         if( !xc )</span>
<span class="lineNum">    4917 </span><span class="lineNoCov">          0 :                             break;</span>
<span class="lineNum">    4918 </span><span class="lineNoCov">          0 :                         cumulativeLeftSideBearing -= xc-&gt;width;</span>
<span class="lineNum">    4919 </span><span class="lineNoCov">          0 :                         int OffsetForDoingCharNextToActive = 0;</span>
<span class="lineNum">    4920 </span><span class="lineNoCov">          0 :                         if( i == lidx )</span>
<span class="lineNum">    4921 </span>            :                         {
<span class="lineNum">    4922 </span><span class="lineNoCov">          0 :                             OffsetForDoingCharNextToActive = borderFudge;</span>
<span class="lineNum">    4923 </span>            :                         }
<span class="lineNum">    4924 </span>            : 
<span class="lineNum">    4925 </span>            :                         /* TRACE(&quot;1 adj. x:%f %f\n&quot;,fsadjusted.xl,fsadjusted.xh); */
<span class="lineNum">    4926 </span>            :                         /* TRACE(&quot;1 adj.cx:%f %f\n&quot;,fsadjusted.c_xl,fsadjusted.c_xh); */
<span class="lineNum">    4927 </span>            :                         /* TRACE(&quot;1 p.  cx:%f %f\n&quot;,fsadjusted.p-&gt;cx,fsadjusted.p-&gt;cy ); */
<span class="lineNum">    4928 </span>            :                         /* fsadjusted.c_xl += offset; */
<span class="lineNum">    4929 </span>            :                         /* fsadjusted.c_xh += offset; */
<span class="lineNum">    4930 </span>            :                         /* fsadjusted.xl   += offset; */
<span class="lineNum">    4931 </span>            :                         /* fsadjusted.xh   += offset; */
<span class="lineNum">    4932 </span>            :                         /* TRACE(&quot;2 adj. x:%f %f\n&quot;,fsadjusted.xl,fsadjusted.xh); */
<span class="lineNum">    4933 </span>            :                         /* TRACE(&quot;2 adj.cx:%f %f\n&quot;,fsadjusted.c_xl,fsadjusted.c_xh); */
<span class="lineNum">    4934 </span>            :                         /* TRACE(&quot;2 p.  cx:%f %f\n&quot;,fsadjusted.p-&gt;cx,fsadjusted.p-&gt;cy ); */
<span class="lineNum">    4935 </span>            :                         /* int found = InSplineSet( &amp;fsadjusted, */
<span class="lineNum">    4936 </span>            :                         /*                           xc-&gt;layers[cv-&gt;b.drawmode-1].splines, */
<span class="lineNum">    4937 </span>            :                         /*                           xc-&gt;inspiro &amp;&amp; hasspiro()); */
<span class="lineNum">    4938 </span>            :                         TRACE(&quot;A:%d\n&quot;, cumulativeLeftSideBearing );
<span class="lineNum">    4939 </span>            :                         TRACE(&quot;B:%f\n&quot;, fsadjusted.p-&gt;cx );
<span class="lineNum">    4940 </span>            :                         TRACE(&quot;C:%d\n&quot;, cumulativeLeftSideBearing+xc-&gt;width );
<span class="lineNum">    4941 </span><span class="lineNoCov">          0 :                         int found = IS_IN_ORDER3(</span>
<span class="lineNum">    4942 </span>            :                             cumulativeLeftSideBearing,
<span class="lineNum">    4943 </span>            :                             fsadjusted.p-&gt;cx,
<span class="lineNum">    4944 </span>            :                             cumulativeLeftSideBearing + xc-&gt;width - OffsetForDoingCharNextToActive );
<span class="lineNum">    4945 </span>            :                     
<span class="lineNum">    4946 </span>            :                         TRACE(&quot;cvmousedown i:%d found:%d\n&quot;, i, found );
<span class="lineNum">    4947 </span><span class="lineNoCov">          0 :                         if( found )</span>
<span class="lineNum">    4948 </span>            :                         {
<span class="lineNum">    4949 </span>            :                             TRACE(&quot;FOUND FOUND FOUND FOUND FOUND FOUND FOUND i:%d\n&quot;, i);
<span class="lineNum">    4950 </span><span class="lineNoCov">          0 :                             xcidx = i;</span>
<span class="lineNum">    4951 </span><span class="lineNoCov">          0 :                             break;</span>
<span class="lineNum">    4952 </span>            :                         }
<span class="lineNum">    4953 </span>            : 
<span class="lineNum">    4954 </span><span class="lineNoCov">          0 :                         offset = xc-&gt;width;</span>
<span class="lineNum">    4955 </span>            :                     }
<span class="lineNum">    4956 </span>            :                 }
<span class="lineNum">    4957 </span>            : 
<span class="lineNum">    4958 </span>            :                 TRACE(&quot;have xc:%p xcidx:%d\n&quot;, xc, xcidx );
<span class="lineNum">    4959 </span>            :                 TRACE(&quot;    idx:%d active:%d\n&quot;, xcidx, cv-&gt;additionalCharsToShowActiveIndex );
<span class="lineNum">    4960 </span><span class="lineNoCov">          0 :                 if( xc &amp;&amp; xcidx &gt;= 0 )</span>
<span class="lineNum">    4961 </span>            :                 {
<span class="lineNum">    4962 </span><span class="lineNoCov">          0 :                     CVSwitchActiveSC( cv, xc, xcidx );</span>
<span class="lineNum">    4963 </span><span class="lineNoCov">          0 :                     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">    4964 </span><span class="lineNoCov">          0 :                     return;</span>
<span class="lineNum">    4965 </span>            :                 }
<span class="lineNum">    4966 </span>            :             }
<span class="lineNum">    4967 </span>            :         }
<span class="lineNum">    4968 </span>            :             
<span class="lineNum">    4969 </span>            :             
<span class="lineNum">    4970 </span>            : 
<span class="lineNum">    4971 </span><span class="lineNoCov">          0 :     } else if ( cv-&gt;active_tool == cvt_curve || cv-&gt;active_tool == cvt_corner ||</span>
<span class="lineNum">    4972 </span><span class="lineNoCov">          0 :             cv-&gt;active_tool == cvt_tangent || cv-&gt;active_tool == cvt_hvcurve ||</span>
<span class="lineNum">    4973 </span><span class="lineNoCov">          0 :             cv-&gt;active_tool == cvt_pen || cv-&gt;active_tool == cvt_ruler )</span>
<span class="lineNum">    4974 </span>            :     {
<span class="lineNum">    4975 </span>            :         /* Snap to points and splines */
<span class="lineNum">    4976 </span><span class="lineNoCov">          0 :         InSplineSet(&amp;fs,cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro());</span>
<span class="lineNum">    4977 </span><span class="lineNoCov">          0 :         if ( fs.p-&gt;sp==NULL &amp;&amp; fs.p-&gt;spline==NULL )</span>
<span class="lineNum">    4978 </span><span class="lineNoCov">          0 :             CVDoSnaps(cv,&amp;fs);</span>
<span class="lineNum">    4979 </span>            :     } else {
<span class="lineNum">    4980 </span>            :         /* Just snap to points */
<span class="lineNum">    4981 </span><span class="lineNoCov">          0 :         NearSplineSetPoints(&amp;fs,cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro());</span>
<span class="lineNum">    4982 </span><span class="lineNoCov">          0 :         if ( fs.p-&gt;sp==NULL &amp;&amp; fs.p-&gt;spline==NULL )</span>
<span class="lineNum">    4983 </span><span class="lineNoCov">          0 :             CVDoSnaps(cv,&amp;fs);</span>
<span class="lineNum">    4984 </span>            :     }
<span class="lineNum">    4985 </span>            : 
<span class="lineNum">    4986 </span><span class="lineNoCov">          0 :     cv-&gt;e.x = event-&gt;u.mouse.x; cv-&gt;e.y = event-&gt;u.mouse.y;</span>
<span class="lineNum">    4987 </span><span class="lineNoCov">          0 :     if ( cv-&gt;p.sp!=NULL ) {</span>
<span class="lineNum">    4988 </span>            :         BasePoint *p;
<span class="lineNum">    4989 </span><span class="lineNoCov">          0 :         if ( cv-&gt;p.nextcp )</span>
<span class="lineNum">    4990 </span><span class="lineNoCov">          0 :             p = &amp;cv-&gt;p.sp-&gt;nextcp;</span>
<span class="lineNum">    4991 </span><span class="lineNoCov">          0 :         else if ( cv-&gt;p.prevcp )</span>
<span class="lineNum">    4992 </span><span class="lineNoCov">          0 :             p = &amp;cv-&gt;p.sp-&gt;prevcp;</span>
<span class="lineNum">    4993 </span>            :         else
<span class="lineNum">    4994 </span><span class="lineNoCov">          0 :             p = &amp;cv-&gt;p.sp-&gt;me;</span>
<span class="lineNum">    4995 </span><span class="lineNoCov">          0 :         cv-&gt;info.x = p-&gt;x;</span>
<span class="lineNum">    4996 </span><span class="lineNoCov">          0 :         cv-&gt;info.y = p-&gt;y;</span>
<span class="lineNum">    4997 </span><span class="lineNoCov">          0 :         cv-&gt;p.cx = p-&gt;x; cv-&gt;p.cy = p-&gt;y;</span>
<span class="lineNum">    4998 </span><span class="lineNoCov">          0 :     } else if ( cv-&gt;p.spiro!=NULL ) {</span>
<span class="lineNum">    4999 </span><span class="lineNoCov">          0 :         cv-&gt;info.x = cv-&gt;p.spiro-&gt;x;</span>
<span class="lineNum">    5000 </span><span class="lineNoCov">          0 :         cv-&gt;info.y = cv-&gt;p.spiro-&gt;y;</span>
<span class="lineNum">    5001 </span><span class="lineNoCov">          0 :         cv-&gt;p.cx = cv-&gt;p.spiro-&gt;x; cv-&gt;p.cy = cv-&gt;p.spiro-&gt;y;</span>
<span class="lineNum">    5002 </span>            :     } else {
<span class="lineNum">    5003 </span><span class="lineNoCov">          0 :         cv-&gt;info.x = cv-&gt;p.cx;</span>
<span class="lineNum">    5004 </span><span class="lineNoCov">          0 :         cv-&gt;info.y = cv-&gt;p.cy;</span>
<span class="lineNum">    5005 </span>            :     }
<span class="lineNum">    5006 </span><span class="lineNoCov">          0 :     cv-&gt;info_within = true;</span>
<span class="lineNum">    5007 </span><span class="lineNoCov">          0 :     CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    5008 </span><span class="lineNoCov">          0 :     CVSetConstrainPoint(cv,event);</span>
<span class="lineNum">    5009 </span>            : 
<span class="lineNum">    5010 </span><span class="lineNoCov">          0 :     int selectionChanged = 0;</span>
<span class="lineNum">    5011 </span><span class="lineNoCov">          0 :     switch ( cv-&gt;active_tool ) {</span>
<span class="lineNum">    5012 </span>            :       case cvt_pointer:
<span class="lineNum">    5013 </span><span class="lineNoCov">          0 :         CVMouseDownPointer(cv, &amp;fs, event);</span>
<span class="lineNum">    5014 </span><span class="lineNoCov">          0 :         CVMaybeCreateDraggingComparisonOutline( cv );</span>
<span class="lineNum">    5015 </span><span class="lineNoCov">          0 :         if( lastSel.lastselpt != fs.p-&gt;sp || lastSel.lastselcp != fs.p-&gt;spiro )   {</span>
<span class="lineNum">    5016 </span>            : #define BASEPOINT_IS_EMPTY(p) ( p.x == (real)0.0 &amp;&amp; p.y == (real)0.0 )
<span class="lineNum">    5017 </span>            :             // If we are in a collab session, we might like to preserve here
<span class="lineNum">    5018 </span>            :             // so that we can send a change of selected points to other members
<span class="lineNum">    5019 </span>            :             // of the group
<span class="lineNum">    5020 </span><span class="lineNoCov">          0 :             if( collabclient_inSession( &amp;cv-&gt;b ) )</span>
<span class="lineNum">    5021 </span>            :             {
<span class="lineNum">    5022 </span><span class="lineNoCov">          0 :                 if( BASEPOINT_IS_EMPTY( fs.p-&gt;cp ) )</span>
<span class="lineNum">    5023 </span>            :                 {
<span class="lineNum">    5024 </span>            :                     //
<span class="lineNum">    5025 </span>            :                     // Do not send clicks on bezier control points.
<span class="lineNum">    5026 </span>            :                     //
<span class="lineNum">    5027 </span>            :                     TRACE(&quot;skipping!\n&quot;);
<span class="lineNum">    5028 </span>            :                 }
<span class="lineNum">    5029 </span>            :                 else
<span class="lineNum">    5030 </span>            :                 {
<span class="lineNum">    5031 </span><span class="lineNoCov">          0 :                     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    5032 </span><span class="lineNoCov">          0 :                     selectionChanged = 1;</span>
<span class="lineNum">    5033 </span>            :                 }
<span class="lineNum">    5034 </span>            :             }
<span class="lineNum">    5035 </span>            :         }
<span class="lineNum">    5036 </span><span class="lineNoCov">          0 :         cv-&gt;lastselpt = fs.p-&gt;sp;</span>
<span class="lineNum">    5037 </span><span class="lineNoCov">          0 :         cv-&gt;lastselcp = fs.p-&gt;spiro;</span>
<span class="lineNum">    5038 </span>            :         if( selectionChanged ) {
<span class="lineNum">    5039 </span>            : //          collabclient_sendRedo( &amp;cv-&gt;b );
<span class="lineNum">    5040 </span>            :         }
<span class="lineNum">    5041 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5042 </span>            :       case cvt_magnify: case cvt_minify:
<span class="lineNum">    5043 </span>            :           //When scroll zooming, the old showing tool is the normal pointer.
<span class="lineNum">    5044 </span><span class="lineNoCov">          0 :           old_showing_tool = cv-&gt;active_tool;    </span>
<span class="lineNum">    5045 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5046 </span>            :       case cvt_hand:
<span class="lineNum">    5047 </span><span class="lineNoCov">          0 :         CVMouseDownHand(cv);</span>
<span class="lineNum">    5048 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5049 </span>            :       case cvt_freehand:
<span class="lineNum">    5050 </span><span class="lineNoCov">          0 :         CVMouseDownFreeHand(cv,event);</span>
<span class="lineNum">    5051 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5052 </span>            :       case cvt_curve: case cvt_corner: case cvt_tangent: case cvt_pen:
<span class="lineNum">    5053 </span>            :       case cvt_hvcurve:
<span class="lineNum">    5054 </span><span class="lineNoCov">          0 :         CVMouseDownPoint(cv,event);</span>
<span class="lineNum">    5055 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5056 </span>            :       case cvt_ruler:
<span class="lineNum">    5057 </span><span class="lineNoCov">          0 :         CVMouseDownRuler(cv,event);</span>
<span class="lineNum">    5058 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5059 </span>            :       case cvt_rotate: case cvt_flip: case cvt_scale: case cvt_skew:
<span class="lineNum">    5060 </span>            :       case cvt_3d_rotate: case cvt_perspective:
<span class="lineNum">    5061 </span><span class="lineNoCov">          0 :         CVMouseDownTransform(cv);</span>
<span class="lineNum">    5062 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5063 </span>            :       case cvt_knife:
<span class="lineNum">    5064 </span><span class="lineNoCov">          0 :         CVMouseDownKnife(cv);</span>
<span class="lineNum">    5065 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5066 </span>            :       case cvt_rect: case cvt_elipse: case cvt_poly: case cvt_star:
<span class="lineNum">    5067 </span><span class="lineNoCov">          0 :         CVMouseDownShape(cv,event);</span>
<span class="lineNum">    5068 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5069 </span>            :     }
<span class="lineNum">    5070 </span><span class="lineNoCov">          0 :     cv-&gt;showing_tool = old_showing_tool;</span>
<a name="5071"><span class="lineNum">    5071 </span>            : }</a>
<span class="lineNum">    5072 </span>            : 
<span class="lineNum">    5073 </span><span class="lineCov">       4402 : static void _SCHintsChanged(SplineChar *sc) {</span>
<span class="lineNum">    5074 </span>            :     struct splinecharlist *dlist;
<span class="lineNum">    5075 </span>            : 
<span class="lineNum">    5076 </span><span class="lineCov">       4402 :     if ( !sc-&gt;changedsincelasthinted ) {</span>
<span class="lineNum">    5077 </span><span class="lineCov">       2082 :         sc-&gt;changedsincelasthinted = true;</span>
<span class="lineNum">    5078 </span><span class="lineCov">       2082 :         FVMarkHintsOutOfDate(sc);</span>
<span class="lineNum">    5079 </span>            :     }
<span class="lineNum">    5080 </span>            : 
<span class="lineNum">    5081 </span><span class="lineCov">       5208 :     for ( dlist=sc-&gt;dependents; dlist!=NULL; dlist=dlist-&gt;next )</span>
<span class="lineNum">    5082 </span><span class="lineCov">        806 :         _SCHintsChanged(dlist-&gt;sc);</span>
<a name="5083"><span class="lineNum">    5083 </span><span class="lineCov">       4402 : }</span></a>
<span class="lineNum">    5084 </span>            : 
<span class="lineNum">    5085 </span><span class="lineCov">       3230 : static void SC_HintsChanged(SplineChar *sc) {</span>
<span class="lineNum">    5086 </span>            :     struct splinecharlist *dlist;
<span class="lineNum">    5087 </span><span class="lineCov">       3230 :     int was = sc-&gt;changedsincelasthinted;</span>
<span class="lineNum">    5088 </span>            : 
<span class="lineNum">    5089 </span><span class="lineCov">       3230 :     if ( sc-&gt;parent-&gt;onlybitmaps || sc-&gt;parent-&gt;multilayer || sc-&gt;parent-&gt;strokedfont )</span>
<span class="lineNum">    5090 </span><span class="lineCov">       3230 : return;</span>
<span class="lineNum">    5091 </span><span class="lineCov">       3230 :     sc-&gt;changedsincelasthinted = false;              /* We just applied a hinting change */</span>
<span class="lineNum">    5092 </span><span class="lineCov">       3230 :     if ( !sc-&gt;changed ) {</span>
<span class="lineNum">    5093 </span><span class="lineCov">       2152 :         sc-&gt;changed = true;</span>
<span class="lineNum">    5094 </span><span class="lineCov">       2152 :         FVToggleCharChanged(sc);</span>
<span class="lineNum">    5095 </span><span class="lineCov">       2152 :         SCRefreshTitles(sc);</span>
<span class="lineNum">    5096 </span><span class="lineCov">       2152 :         if ( !sc-&gt;parent-&gt;changed ) {</span>
<span class="lineNum">    5097 </span><span class="lineCov">          8 :             sc-&gt;parent-&gt;changed = true;</span>
<span class="lineNum">    5098 </span><span class="lineCov">          8 :             FVSetTitles(sc-&gt;parent);</span>
<span class="lineNum">    5099 </span>            :         }
<span class="lineNum">    5100 </span>            :     }
<span class="lineNum">    5101 </span><span class="lineCov">       5932 :     for ( dlist=sc-&gt;dependents; dlist!=NULL; dlist=dlist-&gt;next )</span>
<span class="lineNum">    5102 </span><span class="lineCov">       2702 :         _SCHintsChanged(dlist-&gt;sc);</span>
<span class="lineNum">    5103 </span><span class="lineCov">       3230 :     if ( was ) {</span>
<span class="lineNum">    5104 </span>            :         FontView *fvs;
<span class="lineNum">    5105 </span><span class="lineCov">         50 :         for ( fvs = (FontView *) (sc-&gt;parent-&gt;fv); fvs!=NULL; fvs=(FontView *) (fvs-&gt;b.nextsame) )</span>
<span class="lineNum">    5106 </span><span class="lineCov">         25 :             GDrawRequestExpose(fvs-&gt;v,NULL,false);</span>
<span class="lineNum">    5107 </span>            :     }
<a name="5108"><span class="lineNum">    5108 </span>            : }</a>
<span class="lineNum">    5109 </span>            : 
<span class="lineNum">    5110 </span><span class="lineNoCov">          0 : void CVSetCharChanged(CharView *cv,int changed) {</span>
<span class="lineNum">    5111 </span><span class="lineNoCov">          0 :     SplineFont *sf = cv-&gt;b.fv-&gt;sf;</span>
<span class="lineNum">    5112 </span><span class="lineNoCov">          0 :     SplineChar *sc = cv-&gt;b.sc;</span>
<span class="lineNum">    5113 </span><span class="lineNoCov">          0 :     int oldchanged = sf-&gt;changed;</span>
<span class="lineNum">    5114 </span>            :     /* A changed argument of 2 means the outline didn't change, but something */
<span class="lineNum">    5115 </span>            :     /*  else (width, anchorpoint) did */
<span class="lineNum">    5116 </span><span class="lineNoCov">          0 :     int cvlayer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    5117 </span>            : 
<span class="lineNum">    5118 </span><span class="lineNoCov">          0 :     if ( changed )</span>
<span class="lineNum">    5119 </span><span class="lineNoCov">          0 :         SFSetModTime(sf);</span>
<span class="lineNum">    5120 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.drawmode==dm_grid ) {</span>
<span class="lineNum">    5121 </span><span class="lineNoCov">          0 :         if ( changed ) {</span>
<span class="lineNum">    5122 </span><span class="lineNoCov">          0 :             sf-&gt;changed = true;</span>
<span class="lineNum">    5123 </span><span class="lineNoCov">          0 :             if ( sf-&gt;cidmaster!=NULL )</span>
<span class="lineNum">    5124 </span><span class="lineNoCov">          0 :                 sf-&gt;cidmaster-&gt;changed = true;</span>
<span class="lineNum">    5125 </span>            :         }
<span class="lineNum">    5126 </span>            :     } else {
<span class="lineNum">    5127 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.drawmode==dm_fore &amp;&amp; changed==1 ) {</span>
<span class="lineNum">    5128 </span><span class="lineNoCov">          0 :             sf-&gt;onlybitmaps = false;</span>
<span class="lineNum">    5129 </span>            :         }
<span class="lineNum">    5130 </span><span class="lineNoCov">          0 :         SCTickValidationState(cv-&gt;b.sc,cvlayer);</span>
<span class="lineNum">    5131 </span><span class="lineNoCov">          0 :         if ( (sc-&gt;changed==0) != (changed==0) ) {</span>
<span class="lineNum">    5132 </span><span class="lineNoCov">          0 :             sc-&gt;changed = (changed!=0);</span>
<span class="lineNum">    5133 </span><span class="lineNoCov">          0 :             FVToggleCharChanged(sc);</span>
<span class="lineNum">    5134 </span><span class="lineNoCov">          0 :             SCRefreshTitles(sc);</span>
<span class="lineNum">    5135 </span><span class="lineNoCov">          0 :             if ( changed ) {</span>
<span class="lineNum">    5136 </span><span class="lineNoCov">          0 :                 sf-&gt;changed = true;</span>
<span class="lineNum">    5137 </span><span class="lineNoCov">          0 :                 if ( sf-&gt;cidmaster!=NULL )</span>
<span class="lineNum">    5138 </span><span class="lineNoCov">          0 :                     sf-&gt;cidmaster-&gt;changed = true;</span>
<span class="lineNum">    5139 </span>            :             }
<span class="lineNum">    5140 </span>            :         }
<span class="lineNum">    5141 </span><span class="lineNoCov">          0 :         if ( changed==1 ) {</span>
<span class="lineNum">    5142 </span><span class="lineNoCov">          0 :             instrcheck(sc,cvlayer);</span>
<span class="lineNum">    5143 </span>            :             /*SCDeGridFit(sc);*/
<span class="lineNum">    5144 </span><span class="lineNoCov">          0 :             if ( sc-&gt;parent-&gt;onlybitmaps )</span>
<span class="lineNum">    5145 </span>            :                 /* Do nothing */;
<span class="lineNum">    5146 </span><span class="lineNoCov">          0 :             else if ( sc-&gt;parent-&gt;multilayer || sc-&gt;parent-&gt;strokedfont || sc-&gt;layers[cvlayer].order2 )</span>
<span class="lineNum">    5147 </span><span class="lineNoCov">          0 :                 sc-&gt;changed_since_search = true;</span>
<span class="lineNum">    5148 </span><span class="lineNoCov">          0 :             else if ( cv-&gt;b.drawmode==dm_fore ) {</span>
<span class="lineNum">    5149 </span><span class="lineNoCov">          0 :                 sc-&gt;changed_since_search = true;</span>
<span class="lineNum">    5150 </span><span class="lineNoCov">          0 :                 _SCHintsChanged(cv-&gt;b.sc);</span>
<span class="lineNum">    5151 </span>            :             }
<span class="lineNum">    5152 </span><span class="lineNoCov">          0 :             sc-&gt;changed_since_autosave = true;</span>
<span class="lineNum">    5153 </span><span class="lineNoCov">          0 :             sf-&gt;changed_since_autosave = true;</span>
<span class="lineNum">    5154 </span><span class="lineNoCov">          0 :             sf-&gt;changed_since_xuidchanged = true;</span>
<span class="lineNum">    5155 </span><span class="lineNoCov">          0 :             if ( sf-&gt;cidmaster!=NULL ) {</span>
<span class="lineNum">    5156 </span><span class="lineNoCov">          0 :                 sf-&gt;cidmaster-&gt;changed_since_autosave = true;</span>
<span class="lineNum">    5157 </span><span class="lineNoCov">          0 :                 sf-&gt;cidmaster-&gt;changed_since_xuidchanged = true;</span>
<span class="lineNum">    5158 </span>            :             }
<span class="lineNum">    5159 </span>            :         }
<span class="lineNum">    5160 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.drawmode!=dm_grid ) {</span>
<span class="lineNum">    5161 </span><span class="lineNoCov">          0 :             cv-&gt;needsrasterize = true;</span>
<span class="lineNum">    5162 </span>            :         }
<span class="lineNum">    5163 </span>            :     }
<span class="lineNum">    5164 </span><span class="lineNoCov">          0 :     cv-&gt;recentchange = true;</span>
<span class="lineNum">    5165 </span><span class="lineNoCov">          0 :     if ( !oldchanged )</span>
<span class="lineNum">    5166 </span><span class="lineNoCov">          0 :         FVSetTitles(sf);</span>
<a name="5167"><span class="lineNum">    5167 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    5168 </span>            : 
<span class="lineNum">    5169 </span><span class="lineNoCov">          0 : void SCClearSelPt(SplineChar *sc) {</span>
<span class="lineNum">    5170 </span>            :     CharView *cv;
<span class="lineNum">    5171 </span>            : 
<span class="lineNum">    5172 </span><span class="lineNoCov">          0 :     for ( cv=(CharView *) (sc-&gt;views); cv!=NULL; cv=(CharView *) (cv-&gt;b.next) ) {</span>
<span class="lineNum">    5173 </span><span class="lineNoCov">          0 :         cv-&gt;lastselpt = cv-&gt;p.sp = NULL;</span>
<span class="lineNum">    5174 </span><span class="lineNoCov">          0 :         cv-&gt;p.spiro = cv-&gt;lastselcp = NULL;</span>
<span class="lineNum">    5175 </span>            :     }
<a name="5176"><span class="lineNum">    5176 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    5177 </span>            : 
<span class="lineNum">    5178 </span><span class="lineCov">        895 : static void _SC_CharChangedUpdate(SplineChar *sc,int layer,int changed) {</span>
<span class="lineNum">    5179 </span><span class="lineCov">        895 :     SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">    5180 </span>            :     extern int updateflex;
<span class="lineNum">    5181 </span>            :     /* layer might be ly_none or ly_all */
<span class="lineNum">    5182 </span>            : 
<span class="lineNum">    5183 </span><span class="lineCov">        895 :     if ( layer&gt;=sc-&gt;layer_cnt ) {</span>
<span class="lineNum">    5184 </span><span class="lineNoCov">          0 :         IError( &quot;Bad layer in _SC_CharChangedUpdate&quot;);</span>
<span class="lineNum">    5185 </span><span class="lineNoCov">          0 :         layer = ly_fore;</span>
<span class="lineNum">    5186 </span>            :     }
<span class="lineNum">    5187 </span><span class="lineCov">        895 :     if ( layer&gt;=0 &amp;&amp; !sc-&gt;layers[layer].background )</span>
<span class="lineNum">    5188 </span><span class="lineCov">        895 :         TTFPointMatches(sc,layer,true);</span>
<span class="lineNum">    5189 </span><span class="lineCov">        895 :     if ( changed != -1 ) {</span>
<span class="lineNum">    5190 </span><span class="lineCov">        895 :         sc-&gt;changed_since_autosave = true;</span>
<span class="lineNum">    5191 </span><span class="lineCov">        895 :         SFSetModTime(sf);</span>
<span class="lineNum">    5192 </span><span class="lineCov">        895 :         if ( (sc-&gt;changed==0) != (changed==0) ) {</span>
<span class="lineNum">    5193 </span><span class="lineCov">        704 :             sc-&gt;changed = (changed!=0);</span>
<span class="lineNum">    5194 </span><span class="lineCov">        704 :             if ( changed &amp;&amp; layer&gt;=ly_fore &amp;&amp; (sc-&gt;layers[layer].splines!=NULL || sc-&gt;layers[layer].refs!=NULL))</span>
<span class="lineNum">    5195 </span><span class="lineCov">        693 :                 sc-&gt;parent-&gt;onlybitmaps = false;</span>
<span class="lineNum">    5196 </span><span class="lineCov">        704 :             FVToggleCharChanged(sc);</span>
<span class="lineNum">    5197 </span><span class="lineCov">        704 :             SCRefreshTitles(sc);</span>
<span class="lineNum">    5198 </span>            :         }
<span class="lineNum">    5199 </span><span class="lineCov">        895 :         if ( !sf-&gt;changed ) {</span>
<span class="lineNum">    5200 </span><span class="lineCov">         14 :             sf-&gt;changed = true;</span>
<span class="lineNum">    5201 </span><span class="lineCov">         14 :             if ( sf-&gt;cidmaster )</span>
<span class="lineNum">    5202 </span><span class="lineNoCov">          0 :                 sf-&gt;cidmaster-&gt;changed = true;</span>
<span class="lineNum">    5203 </span><span class="lineCov">         14 :             FVSetTitles(sf);</span>
<span class="lineNum">    5204 </span>            :         }
<span class="lineNum">    5205 </span><span class="lineCov">        895 :         if ( changed &amp;&amp; layer&gt;=0 &amp;&amp; !sc-&gt;layers[layer].background &amp;&amp; sc-&gt;layers[layer].order2 ) {</span>
<span class="lineNum">    5206 </span><span class="lineNoCov">          0 :             instrcheck(sc,layer);</span>
<span class="lineNum">    5207 </span><span class="lineNoCov">          0 :             SCReGridFit(sc,layer);</span>
<span class="lineNum">    5208 </span>            :         }
<span class="lineNum">    5209 </span><span class="lineCov">        895 :         if ( !sc-&gt;parent-&gt;onlybitmaps &amp;&amp; !sc-&gt;parent-&gt;multilayer &amp;&amp;</span>
<span class="lineNum">    5210 </span><span class="lineCov">        894 :                 changed==1 &amp;&amp; !sc-&gt;parent-&gt;strokedfont &amp;&amp;</span>
<span class="lineNum">    5211 </span><span class="lineCov">        894 :                 layer&gt;=0 &amp;&amp;</span>
<span class="lineNum">    5212 </span><span class="lineCov">       1788 :                 !sc-&gt;layers[layer].background &amp;&amp; !sc-&gt;layers[layer].order2 )</span>
<span class="lineNum">    5213 </span><span class="lineCov">        894 :             _SCHintsChanged(sc);</span>
<span class="lineNum">    5214 </span><span class="lineCov">        895 :         sc-&gt;changed_since_search = true;</span>
<span class="lineNum">    5215 </span><span class="lineCov">        895 :         sf-&gt;changed = true;</span>
<span class="lineNum">    5216 </span><span class="lineCov">        895 :         sf-&gt;changed_since_autosave = true;</span>
<span class="lineNum">    5217 </span><span class="lineCov">        895 :         sf-&gt;changed_since_xuidchanged = true;</span>
<span class="lineNum">    5218 </span><span class="lineCov">        895 :         if ( layer&gt;=0 )</span>
<span class="lineNum">    5219 </span><span class="lineCov">        895 :             SCTickValidationState(sc,layer);</span>
<span class="lineNum">    5220 </span>            :     }
<span class="lineNum">    5221 </span><span class="lineCov">        895 :     if ( sf-&gt;cidmaster!=NULL )</span>
<span class="lineNum">    5222 </span><span class="lineNoCov">          0 :         sf-&gt;cidmaster-&gt;changed = sf-&gt;cidmaster-&gt;changed_since_autosave =</span>
<span class="lineNum">    5223 </span><span class="lineNoCov">          0 :                 sf-&gt;cidmaster-&gt;changed_since_xuidchanged = true;</span>
<span class="lineNum">    5224 </span><span class="lineCov">        895 :     SCRegenDependents(sc,ly_all);       /* All chars linked to this one need to get the new splines */</span>
<span class="lineNum">    5225 </span><span class="lineCov">        895 :     if ( updateflex &amp;&amp; (CharView *) (sc-&gt;views)!=NULL &amp;&amp; layer&gt;=ly_fore )</span>
<span class="lineNum">    5226 </span><span class="lineNoCov">          0 :         SplineCharIsFlexible(sc,layer);</span>
<span class="lineNum">    5227 </span><span class="lineCov">        895 :     SCUpdateAll(sc);</span>
<span class="lineNum">    5228 </span><span class="lineCov">        895 :     SCLayersChange(sc);</span>
<span class="lineNum">    5229 </span><span class="lineCov">        895 :     SCRegenFills(sc);</span>
<a name="5230"><span class="lineNum">    5230 </span><span class="lineCov">        895 : }</span></a>
<span class="lineNum">    5231 </span>            : 
<span class="lineNum">    5232 </span><span class="lineCov">        895 : static void SC_CharChangedUpdate(SplineChar *sc,int layer) {</span>
<span class="lineNum">    5233 </span><span class="lineCov">        895 :     _SC_CharChangedUpdate(sc,layer,true);</span>
<a name="5234"><span class="lineNum">    5234 </span><span class="lineCov">        895 : }</span></a>
<span class="lineNum">    5235 </span>            : 
<span class="lineNum">    5236 </span><span class="lineNoCov">          0 : static void _CV_CharChangedUpdate(CharView *cv,int changed) {</span>
<span class="lineNum">    5237 </span>            :     extern int updateflex;
<span class="lineNum">    5238 </span>            :     FontView *fv;
<span class="lineNum">    5239 </span><span class="lineNoCov">          0 :     int cvlayer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    5240 </span>            : 
<span class="lineNum">    5241 </span><span class="lineNoCov">          0 :     CVSetCharChanged(cv,changed);</span>
<span class="lineNum">    5242 </span><span class="lineNoCov">          0 :     CVLayerChange(cv);</span>
<span class="lineNum">    5243 </span><span class="lineNoCov">          0 :     if ( cv-&gt;needsrasterize ) {</span>
<span class="lineNum">    5244 </span><span class="lineNoCov">          0 :         TTFPointMatches(cv-&gt;b.sc,cvlayer,true);              /* Must precede regen dependents, as this can change references */</span>
<span class="lineNum">    5245 </span><span class="lineNoCov">          0 :         SCRegenDependents(cv-&gt;b.sc,cvlayer);         /* All chars linked to this one need to get the new splines */</span>
<span class="lineNum">    5246 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2 )</span>
<span class="lineNum">    5247 </span><span class="lineNoCov">          0 :             SCReGridFit(cv-&gt;b.sc,cvlayer);</span>
<span class="lineNum">    5248 </span><span class="lineNoCov">          0 :         if ( updateflex &amp;&amp; cvlayer!=ly_grid &amp;&amp; !cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;background )</span>
<span class="lineNum">    5249 </span><span class="lineNoCov">          0 :             SplineCharIsFlexible(cv-&gt;b.sc,cvlayer);</span>
<span class="lineNum">    5250 </span><span class="lineNoCov">          0 :         SCUpdateAll(cv-&gt;b.sc);</span>
<span class="lineNum">    5251 </span><span class="lineNoCov">          0 :         SCRegenFills(cv-&gt;b.sc);</span>
<span class="lineNum">    5252 </span><span class="lineNoCov">          0 :         for ( fv = (FontView *) (cv-&gt;b.sc-&gt;parent-&gt;fv); fv!=NULL; fv=(FontView *) (fv-&gt;b.nextsame) )</span>
<span class="lineNum">    5253 </span><span class="lineNoCov">          0 :             FVRegenChar(fv,cv-&gt;b.sc);</span>
<span class="lineNum">    5254 </span><span class="lineNoCov">          0 :         cv-&gt;needsrasterize = false;</span>
<span class="lineNum">    5255 </span><span class="lineNoCov">          0 :     } else if ( cv-&gt;b.drawmode!=dm_grid ) {</span>
<span class="lineNum">    5256 </span>            :         /* If we changed the background then only views of this character */
<span class="lineNum">    5257 </span>            :         /*  need to know about it. No dependents needed, but why write */
<span class="lineNum">    5258 </span>            :         /*  another routine for a rare case... */
<span class="lineNum">    5259 </span><span class="lineNoCov">          0 :         SCUpdateAll(cv-&gt;b.sc);</span>
<span class="lineNum">    5260 </span>            :     } else /* if ( cv-&gt;b.drawmode==dm_grid )*/ {
<span class="lineNum">    5261 </span>            :         /* If we changed the grid then any character needs to know it */
<span class="lineNum">    5262 </span><span class="lineNoCov">          0 :         FVRedrawAllCharViewsSF(cv-&gt;b.sc-&gt;parent);</span>
<span class="lineNum">    5263 </span>            :     }
<span class="lineNum">    5264 </span><span class="lineNoCov">          0 :     cv-&gt;recentchange = false;</span>
<span class="lineNum">    5265 </span><span class="lineNoCov">          0 :     cv-&gt;p.sp = NULL;         /* Might have been deleted */</span>
<a name="5266"><span class="lineNum">    5266 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    5267 </span>            : 
<span class="lineNum">    5268 </span><span class="lineNoCov">          0 : static void CV_CharChangedUpdate(CharView *cv) {</span>
<span class="lineNum">    5269 </span><span class="lineNoCov">          0 :     _CV_CharChangedUpdate(cv,true);</span>
<a name="5270"><span class="lineNum">    5270 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    5271 </span>            : 
<span class="lineNum">    5272 </span><span class="lineNoCov">          0 : static void CVMouseMove(CharView *cv, GEvent *event ) {</span>
<span class="lineNum">    5273 </span>            :     real cx, cy;
<span class="lineNum">    5274 </span>            :     PressedOn p;
<span class="lineNum">    5275 </span>            :     FindSel fs;
<span class="lineNum">    5276 </span>            :     GEvent fake;
<span class="lineNum">    5277 </span><span class="lineNoCov">          0 :     int stop_motion = false;</span>
<span class="lineNum">    5278 </span><span class="lineNoCov">          0 :     int has_spiro = hasspiro();</span>
<span class="lineNum">    5279 </span>            : 
<span class="lineNum">    5280 </span>            :                 /* Debug wacom !!!! */
<span class="lineNum">    5281 </span>            :  /* TRACE( &quot;dev=%s (%d,%d) 0x%x\n&quot;, event-&gt;u.mouse.device!=NULL?event-&gt;u.mouse.device:&quot;&lt;None&gt;&quot;, */
<span class="lineNum">    5282 </span>            :  /*     event-&gt;u.mouse.x, event-&gt;u.mouse.y, event-&gt;u.mouse.state); */
<span class="lineNum">    5283 </span>            : 
<span class="lineNum">    5284 </span><span class="lineNoCov">          0 :     if ( event-&gt;u.mouse.device!=NULL )</span>
<span class="lineNum">    5285 </span><span class="lineNoCov">          0 :         CVToolsSetCursor(cv,event-&gt;u.mouse.state,event-&gt;u.mouse.device);</span>
<span class="lineNum">    5286 </span>            : 
<span class="lineNum">    5287 </span><span class="lineNoCov">          0 :     if ( !cv-&gt;p.pressed ) {</span>
<span class="lineNum">    5288 </span><span class="lineNoCov">          0 :         CVUpdateInfo(cv, event);</span>
<span class="lineNum">    5289 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showing_tool==cvt_pointer ) {</span>
<span class="lineNum">    5290 </span><span class="lineNoCov">          0 :             CVCheckResizeCursors(cv);</span>
<span class="lineNum">    5291 </span><span class="lineNoCov">          0 :             if ( cv-&gt;dv!=NULL )</span>
<span class="lineNum">    5292 </span><span class="lineNoCov">          0 :                 CVDebugPointPopup(cv);</span>
<span class="lineNum">    5293 </span><span class="lineNoCov">          0 :         } else if ( cv-&gt;showing_tool == cvt_ruler )</span>
<span class="lineNum">    5294 </span><span class="lineNoCov">          0 :             CVMouseMoveRuler(cv,event);</span>
<span class="lineNum">    5295 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5296 </span>            :     }
<span class="lineNum">    5297 </span>            : 
<span class="lineNum">    5298 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);    /* TBD, hack to clear ruler */</span>
<span class="lineNum">    5299 </span>            : 
<span class="lineNum">    5300 </span><span class="lineNoCov">          0 :     SetFS(&amp;fs,&amp;p,cv,event);</span>
<span class="lineNum">    5301 </span><span class="lineNoCov">          0 :     if ( cv-&gt;active_tool == cvt_freehand )</span>
<span class="lineNum">    5302 </span>            :         /* freehand does it's own kind of constraining */;
<span class="lineNum">    5303 </span><span class="lineNoCov">          0 :     else if ( (event-&gt;u.mouse.state&amp;ksm_shift) &amp;&amp; !cv-&gt;p.rubberbanding ) {</span>
<span class="lineNum">    5304 </span>            :         /* Constrained */
<span class="lineNum">    5305 </span>            : 
<span class="lineNum">    5306 </span><span class="lineNoCov">          0 :         fake.u.mouse = event-&gt;u.mouse;</span>
<span class="lineNum">    5307 </span><span class="lineNoCov">          0 :         if ( ((event-&gt;u.mouse.state&amp;ksm_meta) ||</span>
<span class="lineNum">    5308 </span><span class="lineNoCov">          0 :                     (!cv-&gt;cntrldown &amp;&amp; (event-&gt;u.mouse.state&amp;ksm_control))) &amp;&amp;</span>
<span class="lineNum">    5309 </span><span class="lineNoCov">          0 :                 (cv-&gt;p.nextcp || cv-&gt;p.prevcp)) {</span>
<span class="lineNum">    5310 </span><span class="lineNoCov">          0 :             real dot = (cv-&gt;p.cp.x-cv-&gt;p.constrain.x)*(p.cx-cv-&gt;p.constrain.x) +</span>
<span class="lineNum">    5311 </span><span class="lineNoCov">          0 :                     (cv-&gt;p.cp.y-cv-&gt;p.constrain.y)*(p.cy-cv-&gt;p.constrain.y);</span>
<span class="lineNum">    5312 </span><span class="lineNoCov">          0 :             real len = (cv-&gt;p.cp.x-cv-&gt;p.constrain.x)*(cv-&gt;p.cp.x-cv-&gt;p.constrain.x)+</span>
<span class="lineNum">    5313 </span><span class="lineNoCov">          0 :                     (cv-&gt;p.cp.y-cv-&gt;p.constrain.y)*(cv-&gt;p.cp.y-cv-&gt;p.constrain.y);</span>
<span class="lineNum">    5314 </span><span class="lineNoCov">          0 :             if ( len!=0 ) {</span>
<span class="lineNum">    5315 </span><span class="lineNoCov">          0 :                 dot /= len;</span>
<span class="lineNum">    5316 </span>            :                 /* constrain control point to same angle with respect to base point*/
<span class="lineNum">    5317 </span><span class="lineNoCov">          0 :                 if ( dot&lt;0 ) dot = 0;</span>
<span class="lineNum">    5318 </span><span class="lineNoCov">          0 :                 p.cx = cv-&gt;p.constrain.x + dot*(cv-&gt;p.cp.x-cv-&gt;p.constrain.x);</span>
<span class="lineNum">    5319 </span><span class="lineNoCov">          0 :                 p.cy = cv-&gt;p.constrain.y + dot*(cv-&gt;p.cp.y-cv-&gt;p.constrain.y);</span>
<span class="lineNum">    5320 </span><span class="lineNoCov">          0 :                 p.x = fake.u.mouse.x = cv-&gt;xoff + rint(p.cx*cv-&gt;scale);</span>
<span class="lineNum">    5321 </span><span class="lineNoCov">          0 :                 p.y = fake.u.mouse.y = -cv-&gt;yoff + cv-&gt;height - rint(p.cy*cv-&gt;scale);</span>
<span class="lineNum">    5322 </span>            :             }
<span class="lineNum">    5323 </span>            :         } else {
<span class="lineNum">    5324 </span>            :             /* Constrain mouse to hor/vert/45 from base point */
<span class="lineNum">    5325 </span><span class="lineNoCov">          0 :             int basex = cv-&gt;active_tool!=cvt_hand ? cv-&gt;xoff + rint(cv-&gt;p.constrain.x*cv-&gt;scale) : cv-&gt;p.x;</span>
<span class="lineNum">    5326 </span><span class="lineNoCov">          0 :             int basey = cv-&gt;active_tool!=cvt_hand ?-cv-&gt;yoff + cv-&gt;height - rint(cv-&gt;p.constrain.y*cv-&gt;scale) : cv-&gt;p.y;</span>
<span class="lineNum">    5327 </span><span class="lineNoCov">          0 :             int dx= event-&gt;u.mouse.x-basex, dy = event-&gt;u.mouse.y-basey;</span>
<span class="lineNum">    5328 </span><span class="lineNoCov">          0 :             int sign = dx*dy&lt;0?-1:1;</span>
<span class="lineNum">    5329 </span><span class="lineNoCov">          0 :             double aspect = 1.0;</span>
<span class="lineNum">    5330 </span>            : 
<span class="lineNum">    5331 </span><span class="lineNoCov">          0 :             if ( dx&lt;0 ) dx = -dx; if ( dy&lt;0 ) dy = -dy;</span>
<span class="lineNum">    5332 </span><span class="lineNoCov">          0 :             if ( cv-&gt;p.img!=NULL &amp;&amp; cv-&gt;p.img-&gt;bb.minx!=cv-&gt;p.img-&gt;bb.maxx )</span>
<span class="lineNum">    5333 </span><span class="lineNoCov">          0 :                 aspect = (cv-&gt;p.img-&gt;bb.maxy - cv-&gt;p.img-&gt;bb.miny) / (cv-&gt;p.img-&gt;bb.maxx - cv-&gt;p.img-&gt;bb.minx);</span>
<span class="lineNum">    5334 </span><span class="lineNoCov">          0 :             else if ( cv-&gt;p.ref!=NULL &amp;&amp; cv-&gt;p.ref-&gt;bb.minx!=cv-&gt;p.ref-&gt;bb.maxx )</span>
<span class="lineNum">    5335 </span><span class="lineNoCov">          0 :                 aspect = (cv-&gt;p.ref-&gt;bb.maxy - cv-&gt;p.ref-&gt;bb.miny) / (cv-&gt;p.ref-&gt;bb.maxx - cv-&gt;p.ref-&gt;bb.minx);</span>
<span class="lineNum">    5336 </span><span class="lineNoCov">          0 :             if ( dy &gt;= 2*dx ) {</span>
<span class="lineNum">    5337 </span><span class="lineNoCov">          0 :                 p.x = fake.u.mouse.x = basex;</span>
<span class="lineNum">    5338 </span><span class="lineNoCov">          0 :                 p.cx = cv-&gt;p.constrain.x;</span>
<span class="lineNum">    5339 </span><span class="lineNoCov">          0 :                 if ( ItalicConstrained &amp;&amp; cv-&gt;b.sc-&gt;parent-&gt;italicangle!=0 ) {</span>
<span class="lineNum">    5340 </span><span class="lineNoCov">          0 :                     double off = tan(cv-&gt;b.sc-&gt;parent-&gt;italicangle*3.1415926535897932/180)*</span>
<span class="lineNum">    5341 </span><span class="lineNoCov">          0 :                             (p.cy-cv-&gt;p.constrain.y);</span>
<span class="lineNum">    5342 </span><span class="lineNoCov">          0 :                     double aoff = off&lt;0 ? -off : off;</span>
<span class="lineNum">    5343 </span><span class="lineNoCov">          0 :                     if ( dx&gt;=aoff*cv-&gt;scale/2 &amp;&amp; (event-&gt;u.mouse.x-basex&lt;0)!=(off&lt;0) ) {</span>
<span class="lineNum">    5344 </span><span class="lineNoCov">          0 :                         p.cx -= off;</span>
<span class="lineNum">    5345 </span><span class="lineNoCov">          0 :                         p.x = fake.u.mouse.x = cv-&gt;xoff + rint(p.cx*cv-&gt;scale);</span>
<span class="lineNum">    5346 </span>            :                     }
<span class="lineNum">    5347 </span>            :                 }
<span class="lineNum">    5348 </span><span class="lineNoCov">          0 :             } else if ( dx &gt;= 2*dy ) {</span>
<span class="lineNum">    5349 </span><span class="lineNoCov">          0 :                 p.y = fake.u.mouse.y = basey;</span>
<span class="lineNum">    5350 </span><span class="lineNoCov">          0 :                 p.cy = cv-&gt;p.constrain.y;</span>
<span class="lineNum">    5351 </span><span class="lineNoCov">          0 :             } else if ( dx &gt; dy ) {</span>
<span class="lineNum">    5352 </span><span class="lineNoCov">          0 :                 p.x = fake.u.mouse.x = basex + sign * (event-&gt;u.mouse.y-basey)/aspect;</span>
<span class="lineNum">    5353 </span><span class="lineNoCov">          0 :                 p.cx = cv-&gt;p.constrain.x - sign * (p.cy-cv-&gt;p.constrain.y)/aspect;</span>
<span class="lineNum">    5354 </span>            :             } else {
<span class="lineNum">    5355 </span><span class="lineNoCov">          0 :                 p.y = fake.u.mouse.y = basey + sign * (event-&gt;u.mouse.x-basex)*aspect;</span>
<span class="lineNum">    5356 </span><span class="lineNoCov">          0 :                 p.cy = cv-&gt;p.constrain.y - sign * (p.cx-cv-&gt;p.constrain.x)*aspect;</span>
<span class="lineNum">    5357 </span>            :             }
<span class="lineNum">    5358 </span>            :         }
<span class="lineNum">    5359 </span><span class="lineNoCov">          0 :         event = &amp;fake;</span>
<span class="lineNum">    5360 </span>            :     }
<span class="lineNum">    5361 </span>            : 
<span class="lineNum">    5362 </span>            :     /* If we've changed the character (recentchange is true) we want to */
<span class="lineNum">    5363 </span>            :     /*  snap to the original location, otherwise we'll keep snapping to the */
<span class="lineNum">    5364 </span>            :     /*  current point as it moves across the screen (jerkily) */
<span class="lineNum">    5365 </span><span class="lineNoCov">          0 :     if ( cv-&gt;active_tool == cvt_hand || cv-&gt;active_tool == cvt_freehand )</span>
<span class="lineNum">    5366 </span>            :         /* Don't snap to points */;
<span class="lineNum">    5367 </span><span class="lineNoCov">          0 :     else if ( !cv-&gt;joinvalid ||</span>
<span class="lineNum">    5368 </span><span class="lineNoCov">          0 :             ((!cv-&gt;b.sc-&gt;inspiro || has_spiro) &amp;&amp; !CheckPoint(&amp;fs,&amp;cv-&gt;joinpos,NULL)) ||</span>
<span class="lineNum">    5369 </span><span class="lineNoCov">          0 :             (  cv-&gt;b.sc-&gt;inspiro &amp;&amp; has_spiro  &amp;&amp; !CheckSpiroPoint(&amp;fs,&amp;cv-&gt;joincp,NULL,0))) {</span>
<span class="lineNum">    5370 </span>            :         SplinePointList *spl;
<span class="lineNum">    5371 </span><span class="lineNoCov">          0 :         spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines;</span>
<span class="lineNum">    5372 </span><span class="lineNoCov">          0 :         if ( cv-&gt;recentchange &amp;&amp; cv-&gt;active_tool==cvt_pointer &amp;&amp;</span>
<span class="lineNum">    5373 </span><span class="lineNoCov">          0 :                 cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes!=NULL &amp;&amp;</span>
<span class="lineNum">    5374 </span><span class="lineNoCov">          0 :                 (cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes-&gt;undotype==ut_state ||</span>
<span class="lineNum">    5375 </span><span class="lineNoCov">          0 :                  cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes-&gt;undotype==ut_tstate ))</span>
<span class="lineNum">    5376 </span><span class="lineNoCov">          0 :             spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes-&gt;u.state.splines;</span>
<span class="lineNum">    5377 </span><span class="lineNoCov">          0 :         if ( cv-&gt;active_tool != cvt_knife &amp;&amp; cv-&gt;active_tool != cvt_ruler ) {</span>
<span class="lineNum">    5378 </span><span class="lineNoCov">          0 :             if ( cv-&gt;active_tool == cvt_pointer &amp;&amp; ( cv-&gt;p.nextcp || cv-&gt;p.prevcp ))</span>
<span class="lineNum">    5379 </span><span class="lineNoCov">          0 :                 fs.select_controls = true;</span>
<span class="lineNum">    5380 </span><span class="lineNoCov">          0 :             NearSplineSetPoints(&amp;fs,spl,cv-&gt;b.sc-&gt;inspiro &amp;&amp; has_spiro);</span>
<span class="lineNum">    5381 </span>            :         } else
<span class="lineNum">    5382 </span><span class="lineNoCov">          0 :             InSplineSet(&amp;fs,spl,cv-&gt;b.sc-&gt;inspiro &amp;&amp; has_spiro);</span>
<span class="lineNum">    5383 </span>            :     }
<span class="lineNum">    5384 </span>            :     /* p.sp and cv-&gt;p.sp may correspond to different undo states, thus being */
<span class="lineNum">    5385 </span>            :     /* different objects even while describing essentially the same point. */
<span class="lineNum">    5386 </span>            :     /* So compare point coordinates rather than the points themselves */
<span class="lineNum">    5387 </span><span class="lineNoCov">          0 :     if ( (cv-&gt;p.nextcp || cv-&gt;p.prevcp) &amp;&amp; p.nextcp &amp;&amp;</span>
<span class="lineNum">    5388 </span><span class="lineNoCov">          0 :             p.sp!=NULL &amp;&amp; cv-&gt;p.sp != NULL &amp;&amp;</span>
<span class="lineNum">    5389 </span><span class="lineNoCov">          0 :             p.sp-&gt;me.x == cv-&gt;p.sp-&gt;me.x &amp;&amp; p.sp-&gt;me.y == cv-&gt;p.sp-&gt;me.y ) {</span>
<span class="lineNum">    5390 </span>            :         /* If either control point selected, then snap to it or its brother */
<span class="lineNum">    5391 </span>            :         /*  when close */
<span class="lineNum">    5392 </span><span class="lineNoCov">          0 :         p.cx = p.sp-&gt;nextcp.x;</span>
<span class="lineNum">    5393 </span><span class="lineNoCov">          0 :         p.cy = p.sp-&gt;nextcp.y;</span>
<span class="lineNum">    5394 </span><span class="lineNoCov">          0 :     } else if (( cv-&gt;p.nextcp || cv-&gt;p.prevcp) &amp;&amp; p.prevcp &amp;&amp;</span>
<span class="lineNum">    5395 </span><span class="lineNoCov">          0 :             p.sp!=NULL &amp;&amp; cv-&gt;p.sp != NULL &amp;&amp;</span>
<span class="lineNum">    5396 </span><span class="lineNoCov">          0 :             p.sp-&gt;me.x == cv-&gt;p.sp-&gt;me.x &amp;&amp; p.sp-&gt;me.y == cv-&gt;p.sp-&gt;me.y ) {</span>
<span class="lineNum">    5397 </span><span class="lineNoCov">          0 :         p.cx = p.sp-&gt;prevcp.x;</span>
<span class="lineNum">    5398 </span><span class="lineNoCov">          0 :         p.cy = p.sp-&gt;prevcp.y;</span>
<span class="lineNum">    5399 </span><span class="lineNoCov">          0 :     } else if ( p.sp!=NULL &amp;&amp; p.sp!=cv-&gt;active_sp ) {                /* Snap to points */</span>
<span class="lineNum">    5400 </span><span class="lineNoCov">          0 :         p.cx = p.sp-&gt;me.x;</span>
<span class="lineNum">    5401 </span><span class="lineNoCov">          0 :         p.cy = p.sp-&gt;me.y;</span>
<span class="lineNum">    5402 </span><span class="lineNoCov">          0 :     } else if ( p.spiro!=NULL &amp;&amp; p.spiro!=cv-&gt;active_cp ) {</span>
<span class="lineNum">    5403 </span><span class="lineNoCov">          0 :         p.cx = p.spiro-&gt;x;</span>
<span class="lineNum">    5404 </span><span class="lineNoCov">          0 :         p.cy = p.spiro-&gt;y;</span>
<span class="lineNum">    5405 </span>            :     } else {
<span class="lineNum">    5406 </span><span class="lineNoCov">          0 :         CVDoSnaps(cv,&amp;fs);</span>
<span class="lineNum">    5407 </span>            :     }
<span class="lineNum">    5408 </span><span class="lineNoCov">          0 :     cx = (p.cx -cv-&gt;p.cx) / cv-&gt;scale;</span>
<span class="lineNum">    5409 </span><span class="lineNoCov">          0 :     cy = (p.cy - cv-&gt;p.cy) / cv-&gt;scale;</span>
<span class="lineNum">    5410 </span><span class="lineNoCov">          0 :     if ( cx&lt;0 ) cx = -cx;</span>
<span class="lineNum">    5411 </span><span class="lineNoCov">          0 :     if ( cy&lt;0 ) cy = -cy;</span>
<span class="lineNum">    5412 </span>            : 
<span class="lineNum">    5413 </span>            :         /* If they haven't moved far from the start point, then snap to it */
<span class="lineNum">    5414 </span><span class="lineNoCov">          0 :     if ( cx+cy &lt; 4 ) {</span>
<span class="lineNum">    5415 </span><span class="lineNoCov">          0 :         p.x = cv-&gt;p.x; p.y = cv-&gt;p.y;</span>
<span class="lineNum">    5416 </span>            :     }
<span class="lineNum">    5417 </span>            : 
<span class="lineNum">    5418 </span><span class="lineNoCov">          0 :     cv-&gt;info.x = p.cx; cv-&gt;info.y = p.cy;</span>
<span class="lineNum">    5419 </span><span class="lineNoCov">          0 :     cv-&gt;info_sp = p.sp;</span>
<span class="lineNum">    5420 </span><span class="lineNoCov">          0 :     cv-&gt;info_spline = p.spline;</span>
<span class="lineNum">    5421 </span><span class="lineNoCov">          0 :     cv-&gt;info_t = p.t;</span>
<span class="lineNum">    5422 </span><span class="lineNoCov">          0 :     cv-&gt;e.x = event-&gt;u.mouse.x; cv-&gt;e.y = event-&gt;u.mouse.y;</span>
<span class="lineNum">    5423 </span><span class="lineNoCov">          0 :     CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    5424 </span>            : 
<span class="lineNum">    5425 </span><span class="lineNoCov">          0 :     switch ( cv-&gt;active_tool ) {</span>
<span class="lineNum">    5426 </span>            :       case cvt_pointer:
<span class="lineNum">    5427 </span><span class="lineNoCov">          0 :         stop_motion = CVMouseMovePointer(cv,event);</span>
<span class="lineNum">    5428 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5429 </span>            :       case cvt_magnify: case cvt_minify:
<span class="lineNum">    5430 </span><span class="lineNoCov">          0 :         if ( !cv-&gt;p.rubberbanding ) {</span>
<span class="lineNum">    5431 </span><span class="lineNoCov">          0 :             cv-&gt;p.ex = cv-&gt;p.cx;</span>
<span class="lineNum">    5432 </span><span class="lineNoCov">          0 :             cv-&gt;p.ey = cv-&gt;p.cy;</span>
<span class="lineNum">    5433 </span>            :         }
<span class="lineNum">    5434 </span><span class="lineNoCov">          0 :         if ( cv-&gt;p.rubberbanding )</span>
<span class="lineNum">    5435 </span><span class="lineNoCov">          0 :             CVDrawRubberRect(cv-&gt;v,cv);</span>
<span class="lineNum">    5436 </span><span class="lineNoCov">          0 :         cv-&gt;p.ex = cv-&gt;info.x;</span>
<span class="lineNum">    5437 </span><span class="lineNoCov">          0 :         cv-&gt;p.ey = cv-&gt;info.y;</span>
<span class="lineNum">    5438 </span><span class="lineNoCov">          0 :         cv-&gt;p.rubberbanding = true;</span>
<span class="lineNum">    5439 </span><span class="lineNoCov">          0 :         CVDrawRubberRect(cv-&gt;v,cv);</span>
<span class="lineNum">    5440 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5441 </span>            :       case cvt_hand:
<span class="lineNum">    5442 </span><span class="lineNoCov">          0 :         CVMouseMoveHand(cv,event);</span>
<span class="lineNum">    5443 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5444 </span>            :       case cvt_freehand:
<span class="lineNum">    5445 </span><span class="lineNoCov">          0 :         CVMouseMoveFreeHand(cv,event);</span>
<span class="lineNum">    5446 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5447 </span>            :       case cvt_curve: case cvt_corner: case cvt_tangent: case cvt_hvcurve:
<span class="lineNum">    5448 </span><span class="lineNoCov">          0 :         CVMouseMovePoint(cv,&amp;p);</span>
<span class="lineNum">    5449 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5450 </span>            :       case cvt_pen:
<span class="lineNum">    5451 </span><span class="lineNoCov">          0 :         CVMouseMovePen(cv,&amp;p,event);</span>
<span class="lineNum">    5452 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5453 </span>            :       case cvt_ruler:
<span class="lineNum">    5454 </span><span class="lineNoCov">          0 :         CVMouseMoveRuler(cv,event);</span>
<span class="lineNum">    5455 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5456 </span>            :       case cvt_rotate: case cvt_flip: case cvt_scale: case cvt_skew:
<span class="lineNum">    5457 </span>            :       case cvt_3d_rotate: case cvt_perspective:
<span class="lineNum">    5458 </span><span class="lineNoCov">          0 :         CVMouseMoveTransform(cv);</span>
<span class="lineNum">    5459 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5460 </span>            :       case cvt_knife:
<span class="lineNum">    5461 </span><span class="lineNoCov">          0 :         CVMouseMoveKnife(cv,&amp;p);</span>
<span class="lineNum">    5462 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5463 </span>            :       case cvt_rect: case cvt_elipse: case cvt_poly: case cvt_star:
<span class="lineNum">    5464 </span><span class="lineNoCov">          0 :         CVMouseMoveShape(cv);</span>
<span class="lineNum">    5465 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5466 </span>            :     }
<span class="lineNum">    5467 </span><span class="lineNoCov">          0 :     if ( stop_motion ) {</span>
<span class="lineNum">    5468 </span><span class="lineNoCov">          0 :         event-&gt;type = et_mouseup;</span>
<span class="lineNum">    5469 </span><span class="lineNoCov">          0 :         CVMouseUp(cv,event);</span>
<span class="lineNum">    5470 </span>            :     }
<a name="5471"><span class="lineNum">    5471 </span>            : }</a>
<span class="lineNum">    5472 </span>            : 
<span class="lineNum">    5473 </span><span class="lineNoCov">          0 : static void CVMagnify(CharView *cv, real midx, real midy, int bigger, int LockPosition) {</span>
<span class="lineNum">    5474 </span>            :     static float scales[] = { 1, 2, 3, 4, 6, 8, 11, 16, 23, 32, 45, 64, 90, 128, 181, 256, 512, 1024, 0 };
<span class="lineNum">    5475 </span>            :     float oldscale;
<span class="lineNum">    5476 </span>            :     int i, j;
<span class="lineNum">    5477 </span>            : 
<span class="lineNum">    5478 </span><span class="lineNoCov">          0 :     oldscale = cv-&gt;scale;</span>
<span class="lineNum">    5479 </span>            : 
<span class="lineNum">    5480 </span><span class="lineNoCov">          0 :     if ( bigger!=0 ) {</span>
<span class="lineNum">    5481 </span><span class="lineNoCov">          0 :         if ( cv-&gt;scale&gt;=1 ) {</span>
<span class="lineNum">    5482 </span><span class="lineNoCov">          0 :             for ( i=0; scales[i]!=0 &amp;&amp; cv-&gt;scale&gt;scales[i]; ++i );</span>
<span class="lineNum">    5483 </span><span class="lineNoCov">          0 :             if ( scales[i]==0 ) i=j= i-1;</span>
<span class="lineNum">    5484 </span><span class="lineNoCov">          0 :             else if ( RealNear(scales[i],cv-&gt;scale) ) j=i;</span>
<span class="lineNum">    5485 </span><span class="lineNoCov">          0 :             else if ( i!=0 &amp;&amp; RealNear(scales[i-1],cv-&gt;scale) ) j= --i; /* Round errors! */</span>
<span class="lineNum">    5486 </span><span class="lineNoCov">          0 :             else j = i-1;</span>
<span class="lineNum">    5487 </span><span class="lineNoCov">          0 :         } else { real sinv = 1/cv-&gt;scale; int t;</span>
<span class="lineNum">    5488 </span><span class="lineNoCov">          0 :             for ( i=0; scales[i]!=0 &amp;&amp; sinv&gt;scales[i]; ++i );</span>
<span class="lineNum">    5489 </span><span class="lineNoCov">          0 :             if ( scales[i]==0 ) i=j= i-1;</span>
<span class="lineNum">    5490 </span><span class="lineNoCov">          0 :             else if ( RealNear(scales[i],sinv) ) j=i;</span>
<span class="lineNum">    5491 </span><span class="lineNoCov">          0 :             else if ( i!=0 &amp;&amp; RealNear(scales[i-1],sinv) ) j= --i; /* Round errors! */</span>
<span class="lineNum">    5492 </span><span class="lineNoCov">          0 :             else j = i-1;</span>
<span class="lineNum">    5493 </span><span class="lineNoCov">          0 :             t = j;</span>
<span class="lineNum">    5494 </span><span class="lineNoCov">          0 :             j = -i; i = -t;</span>
<span class="lineNum">    5495 </span>            :         }
<span class="lineNum">    5496 </span><span class="lineNoCov">          0 :         if ( bigger==1 ) {</span>
<span class="lineNum">    5497 </span><span class="lineNoCov">          0 :             if ( i==j ) ++i;</span>
<span class="lineNum">    5498 </span><span class="lineNoCov">          0 :             if ( i&gt;0 &amp;&amp; scales[i]==0 ) --i;</span>
<span class="lineNum">    5499 </span><span class="lineNoCov">          0 :             if ( i&gt;=0 )</span>
<span class="lineNum">    5500 </span><span class="lineNoCov">          0 :                 cv-&gt;scale = scales[i];</span>
<span class="lineNum">    5501 </span>            :             else
<span class="lineNum">    5502 </span><span class="lineNoCov">          0 :                 cv-&gt;scale = 1/scales[-i];</span>
<span class="lineNum">    5503 </span>            :         } else {
<span class="lineNum">    5504 </span><span class="lineNoCov">          0 :             if ( i==j ) --j;</span>
<span class="lineNum">    5505 </span><span class="lineNoCov">          0 :             if ( j&lt;0 &amp;&amp; scales[-j]==0 ) ++j;</span>
<span class="lineNum">    5506 </span><span class="lineNoCov">          0 :             if ( j&gt;=0 )</span>
<span class="lineNum">    5507 </span><span class="lineNoCov">          0 :                 cv-&gt;scale = scales[j];</span>
<span class="lineNum">    5508 </span>            :             else
<span class="lineNum">    5509 </span><span class="lineNoCov">          0 :                 cv-&gt;scale = 1/scales[-j];</span>
<span class="lineNum">    5510 </span>            :         }
<span class="lineNum">    5511 </span>            :     }
<span class="lineNum">    5512 </span>            : 
<span class="lineNum">    5513 </span><span class="lineNoCov">          0 :     if (LockPosition) {</span>
<span class="lineNum">    5514 </span><span class="lineNoCov">          0 :         float mousex = rint(midx * oldscale + cv-&gt;xoff);</span>
<span class="lineNum">    5515 </span><span class="lineNoCov">          0 :         float mousey = rint(midy * oldscale + cv-&gt;yoff - cv-&gt;height);</span>
<span class="lineNum">    5516 </span><span class="lineNoCov">          0 :         cv-&gt;xoff = mousex - midx*cv-&gt;scale;</span>
<span class="lineNum">    5517 </span><span class="lineNoCov">          0 :         cv-&gt;yoff = mousey - midy*cv-&gt;scale + cv-&gt;height;</span>
<span class="lineNum">    5518 </span>            :     }
<span class="lineNum">    5519 </span>            :     else {
<span class="lineNum">    5520 </span><span class="lineNoCov">          0 :         cv-&gt;xoff = -(rint(midx*cv-&gt;scale) - cv-&gt;width/2);</span>
<span class="lineNum">    5521 </span><span class="lineNoCov">          0 :         cv-&gt;yoff = -(rint(midy*cv-&gt;scale) - cv-&gt;height/2);</span>
<span class="lineNum">    5522 </span>            :     }
<span class="lineNum">    5523 </span>            : 
<span class="lineNum">    5524 </span><span class="lineNoCov">          0 :     CVNewScale(cv);</span>
<a name="5525"><span class="lineNum">    5525 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    5526 </span>            : 
<span class="lineNum">    5527 </span><span class="lineNoCov">          0 : static void CVMouseUp(CharView *cv, GEvent *event ) {</span>
<span class="lineNum">    5528 </span>            : 
<span class="lineNum">    5529 </span><span class="lineNoCov">          0 :     CVMouseMove(cv,event);</span>
<span class="lineNum">    5530 </span><span class="lineNoCov">          0 :     if ( cv-&gt;pressed!=NULL ) {</span>
<span class="lineNum">    5531 </span><span class="lineNoCov">          0 :         GDrawCancelTimer(cv-&gt;pressed);</span>
<span class="lineNum">    5532 </span><span class="lineNoCov">          0 :         cv-&gt;pressed = NULL;</span>
<span class="lineNum">    5533 </span>            :     }
<span class="lineNum">    5534 </span><span class="lineNoCov">          0 :     cv-&gt;p.pressed = false;</span>
<span class="lineNum">    5535 </span><span class="lineNoCov">          0 :     CVFreePreTransformSPL( cv );</span>
<span class="lineNum">    5536 </span><span class="lineNoCov">          0 :     update_spacebar_hand_tool(cv);</span>
<span class="lineNum">    5537 </span>            : 
<span class="lineNum">    5538 </span><span class="lineNoCov">          0 :     if ( cv-&gt;p.rubberbanding ) {</span>
<span class="lineNum">    5539 </span><span class="lineNoCov">          0 :         CVDrawRubberRect(cv-&gt;v,cv);</span>
<span class="lineNum">    5540 </span><span class="lineNoCov">          0 :         cv-&gt;p.rubberbanding = false;</span>
<span class="lineNum">    5541 </span><span class="lineNoCov">          0 :     } else if ( cv-&gt;p.rubberlining ) {</span>
<span class="lineNum">    5542 </span><span class="lineNoCov">          0 :         CVDrawRubberLine(cv-&gt;v,cv);</span>
<span class="lineNum">    5543 </span><span class="lineNoCov">          0 :         cv-&gt;p.rubberlining = false;</span>
<span class="lineNum">    5544 </span>            :     }
<span class="lineNum">    5545 </span>            : 
<span class="lineNum">    5546 </span>            :     // This is needed to allow characters to the left of the
<span class="lineNum">    5547 </span>            :     // active one to be picked with the mouse,
<span class="lineNum">    5548 </span>            :     // but outright it does mess with keyboard input changing BCP
<span class="lineNum">    5549 </span>            :     // so we only do it for mouse up to the left of the left side
<span class="lineNum">    5550 </span>            :     // bearing, because that click can not currently activate any BCP
<span class="lineNum">    5551 </span><span class="lineNoCov">          0 :     if ( cv-&gt;active_tool == cvt_pointer &amp;&amp;</span>
<span class="lineNum">    5552 </span><span class="lineNoCov">          0 :          MouseToCX( cv, event-&gt;u.mouse.x ) &lt; -2 )</span>
<span class="lineNum">    5553 </span>            :     {
<span class="lineNum">    5554 </span>            :         // Since we allow clicking anywhere now, instead of having
<span class="lineNum">    5555 </span>            :         // to check if you clicked on a spline of a prev char,
<span class="lineNum">    5556 </span>            :         // then we don't need this. It also causes an issue with the arrow
<span class="lineNum">    5557 </span>            :         // keys moving a BCP on a spline left of the lbearing line.
<span class="lineNum">    5558 </span>            :         // (comment included just in case this click on spline feature is desired in the future)
<span class="lineNum">    5559 </span>            :         /* FindSel fs; */
<span class="lineNum">    5560 </span>            :         /* SetFS(&amp;fs,&amp;cv-&gt;p,cv,event); */
<span class="lineNum">    5561 </span>            :         /* _CVTestSelectFromEvent(cv,&amp;fs); */
<span class="lineNum">    5562 </span>            :         /* fs.p = &amp;cv-&gt;p; */
<span class="lineNum">    5563 </span>            :     }
<span class="lineNum">    5564 </span>            :     
<span class="lineNum">    5565 </span>            :     
<span class="lineNum">    5566 </span><span class="lineNoCov">          0 :     switch ( cv-&gt;active_tool ) {</span>
<span class="lineNum">    5567 </span>            :       case cvt_pointer:
<span class="lineNum">    5568 </span><span class="lineNoCov">          0 :         CVMouseUpPointer(cv);</span>
<span class="lineNum">    5569 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5570 </span>            :       case cvt_ruler:
<span class="lineNum">    5571 </span><span class="lineNoCov">          0 :         CVMouseUpRuler(cv,event);</span>
<span class="lineNum">    5572 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5573 </span>            :       case cvt_hand:
<span class="lineNum">    5574 </span><span class="lineNoCov">          0 :         CVMouseUpHand(cv);</span>
<span class="lineNum">    5575 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5576 </span>            :       case cvt_freehand:
<span class="lineNum">    5577 </span><span class="lineNoCov">          0 :         CVMouseUpFreeHand(cv,event);</span>
<span class="lineNum">    5578 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5579 </span>            :       case cvt_curve: case cvt_corner: case cvt_tangent: case cvt_hvcurve:
<span class="lineNum">    5580 </span>            :       case cvt_pen:
<span class="lineNum">    5581 </span><span class="lineNoCov">          0 :         CVMouseUpPoint(cv,event);</span>
<span class="lineNum">    5582 </span><span class="lineNoCov">          0 :         CVGridHandlePossibleFitChar( cv );</span>
<span class="lineNum">    5583 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5584 </span>            :       case cvt_magnify: case cvt_minify:
<span class="lineNum">    5585 </span><span class="lineNoCov">          0 :         if ( cv-&gt;p.x&gt;=event-&gt;u.mouse.x-6 &amp;&amp; cv-&gt;p.x&lt;=event-&gt;u.mouse.x+6 &amp;&amp;</span>
<span class="lineNum">    5586 </span><span class="lineNoCov">          0 :                  cv-&gt;p.y&gt;=event-&gt;u.mouse.y-6 &amp;&amp; cv-&gt;p.y&lt;=event-&gt;u.mouse.y+6 ) {</span>
<span class="lineNum">    5587 </span>            :             real cx, cy;
<span class="lineNum">    5588 </span><span class="lineNoCov">          0 :             cx = (event-&gt;u.mouse.x-cv-&gt;xoff)/cv-&gt;scale;</span>
<span class="lineNum">    5589 </span><span class="lineNoCov">          0 :             cy = (cv-&gt;height-event-&gt;u.mouse.y-cv-&gt;yoff)/cv-&gt;scale ;</span>
<span class="lineNum">    5590 </span><span class="lineNoCov">          0 :             CVMagnify(cv,cx,cy,cv-&gt;active_tool==cvt_minify?-1:1,event-&gt;u.mouse.button&gt;3);</span>
<span class="lineNum">    5591 </span>            :         } else {
<span class="lineNum">    5592 </span>            :             DBounds b;
<span class="lineNum">    5593 </span><span class="lineNoCov">          0 :             double oldscale = cv-&gt;scale;</span>
<span class="lineNum">    5594 </span><span class="lineNoCov">          0 :             if ( cv-&gt;p.cx&gt;cv-&gt;info.x ) {</span>
<span class="lineNum">    5595 </span><span class="lineNoCov">          0 :                 b.minx = cv-&gt;info.x;</span>
<span class="lineNum">    5596 </span><span class="lineNoCov">          0 :                 b.maxx = cv-&gt;p.cx;</span>
<span class="lineNum">    5597 </span>            :             } else {
<span class="lineNum">    5598 </span><span class="lineNoCov">          0 :                 b.minx = cv-&gt;p.cx;</span>
<span class="lineNum">    5599 </span><span class="lineNoCov">          0 :                 b.maxx = cv-&gt;info.x;</span>
<span class="lineNum">    5600 </span>            :             }
<span class="lineNum">    5601 </span><span class="lineNoCov">          0 :             if ( cv-&gt;p.cy&gt;cv-&gt;info.y ) {</span>
<span class="lineNum">    5602 </span><span class="lineNoCov">          0 :                 b.miny = cv-&gt;info.y;</span>
<span class="lineNum">    5603 </span><span class="lineNoCov">          0 :                 b.maxy = cv-&gt;p.cy;</span>
<span class="lineNum">    5604 </span>            :             } else {
<span class="lineNum">    5605 </span><span class="lineNoCov">          0 :                 b.miny = cv-&gt;p.cy;</span>
<span class="lineNum">    5606 </span><span class="lineNoCov">          0 :                 b.maxy = cv-&gt;info.y;</span>
<span class="lineNum">    5607 </span>            :             }
<span class="lineNum">    5608 </span><span class="lineNoCov">          0 :             _CVFit(cv,&amp;b,false);</span>
<span class="lineNum">    5609 </span><span class="lineNoCov">          0 :             if ( oldscale==cv-&gt;scale ) {</span>
<span class="lineNum">    5610 </span><span class="lineNoCov">          0 :                 cv-&gt;scale += .5;</span>
<span class="lineNum">    5611 </span><span class="lineNoCov">          0 :                 CVNewScale(cv);</span>
<span class="lineNum">    5612 </span>            :             }
<span class="lineNum">    5613 </span>            :         }
<span class="lineNum">    5614 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5615 </span>            :       case cvt_rotate: case cvt_flip: case cvt_scale: case cvt_skew:
<span class="lineNum">    5616 </span>            :       case cvt_3d_rotate: case cvt_perspective:
<span class="lineNum">    5617 </span><span class="lineNoCov">          0 :         CVMouseUpTransform(cv);</span>
<span class="lineNum">    5618 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5619 </span>            :       case cvt_knife:
<span class="lineNum">    5620 </span><span class="lineNoCov">          0 :         CVMouseUpKnife(cv,event);</span>
<span class="lineNum">    5621 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5622 </span>            :       case cvt_rect: case cvt_elipse: case cvt_poly: case cvt_star:
<span class="lineNum">    5623 </span><span class="lineNoCov">          0 :         CVMouseUpShape(cv);</span>
<span class="lineNum">    5624 </span><span class="lineNoCov">          0 :         CVGridHandlePossibleFitChar( cv );</span>
<span class="lineNum">    5625 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5626 </span>            :     }
<span class="lineNum">    5627 </span><span class="lineNoCov">          0 :     cv-&gt;active_tool = cvt_none;</span>
<span class="lineNum">    5628 </span><span class="lineNoCov">          0 :     CVToolsSetCursor(cv,event-&gt;u.mouse.state&amp;~(1&lt;&lt;(7+event-&gt;u.mouse.button)),event-&gt;u.mouse.device);         /* X still has the buttons set in the state, even though we just released them. I don't want em */</span>
<span class="lineNum">    5629 </span>            :     /* CharChangedUpdate is a rather blunt tool. When moving anchor points with */
<span class="lineNum">    5630 </span>            :     /*  the mouse we need finer control than it provides */
<span class="lineNum">    5631 </span>            :     /* If recentchange is set then change should also be set, don't think we */
<span class="lineNum">    5632 </span>            :     /*  need the full form of this call */
<span class="lineNum">    5633 </span><span class="lineNoCov">          0 :     if ( cv-&gt;needsrasterize || cv-&gt;recentchange )</span>
<span class="lineNum">    5634 </span><span class="lineNoCov">          0 :         _CV_CharChangedUpdate(cv,2);</span>
<span class="lineNum">    5635 </span>            : 
<span class="lineNum">    5636 </span><span class="lineNoCov">          0 :     dlist_foreach( &amp;cv-&gt;pointInfoDialogs, (dlist_foreach_func_type)PIChangePoint );</span>
<span class="lineNum">    5637 </span><span class="lineNoCov">          0 :     collabclient_sendRedo( &amp;cv-&gt;b );</span>
<a name="5638"><span class="lineNum">    5638 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    5639 </span>            : 
<span class="lineNum">    5640 </span><span class="lineNoCov">          0 : static void CVTimer(CharView *cv,GEvent *event) {</span>
<span class="lineNum">    5641 </span>            : 
<span class="lineNum">    5642 </span><span class="lineNoCov">          0 :     if ( event-&gt;u.timer.timer==cv-&gt;pressed ) {</span>
<span class="lineNum">    5643 </span>            :         GEvent e;
<span class="lineNum">    5644 </span><span class="lineNoCov">          0 :         GDrawGetPointerPosition(cv-&gt;v,&amp;e);</span>
<span class="lineNum">    5645 </span><span class="lineNoCov">          0 :         if ( e.u.mouse.x&lt;0 || e.u.mouse.y&lt;0 ||</span>
<span class="lineNum">    5646 </span><span class="lineNoCov">          0 :                 e.u.mouse.x&gt;=cv-&gt;width || e.u.mouse.y &gt;= cv-&gt;height ) {</span>
<span class="lineNum">    5647 </span><span class="lineNoCov">          0 :             real dx = 0, dy = 0;</span>
<span class="lineNum">    5648 </span><span class="lineNoCov">          0 :             if ( e.u.mouse.x&lt;0 )</span>
<span class="lineNum">    5649 </span><span class="lineNoCov">          0 :                 dx = cv-&gt;width/8;</span>
<span class="lineNum">    5650 </span><span class="lineNoCov">          0 :             else if ( e.u.mouse.x&gt;=cv-&gt;width )</span>
<span class="lineNum">    5651 </span><span class="lineNoCov">          0 :                 dx = -cv-&gt;width/8;</span>
<span class="lineNum">    5652 </span><span class="lineNoCov">          0 :             if ( e.u.mouse.y&lt;0 )</span>
<span class="lineNum">    5653 </span><span class="lineNoCov">          0 :                 dy = -cv-&gt;height/8;</span>
<span class="lineNum">    5654 </span><span class="lineNoCov">          0 :             else if ( e.u.mouse.y&gt;=cv-&gt;height )</span>
<span class="lineNum">    5655 </span><span class="lineNoCov">          0 :                 dy = cv-&gt;height/8;</span>
<span class="lineNum">    5656 </span><span class="lineNoCov">          0 :             cv-&gt;xoff += dx; cv-&gt;yoff += dy;</span>
<span class="lineNum">    5657 </span><span class="lineNoCov">          0 :             cv-&gt;back_img_out_of_date = true;</span>
<span class="lineNum">    5658 </span><span class="lineNoCov">          0 :             if ( dy!=0 )</span>
<span class="lineNum">    5659 </span><span class="lineNoCov">          0 :                 GScrollBarSetPos(cv-&gt;vsb,cv-&gt;yoff-cv-&gt;height);</span>
<span class="lineNum">    5660 </span><span class="lineNoCov">          0 :             if ( dx!=0 )</span>
<span class="lineNum">    5661 </span><span class="lineNoCov">          0 :                 GScrollBarSetPos(cv-&gt;hsb,-cv-&gt;xoff);</span>
<span class="lineNum">    5662 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">    5663 </span>            :         }
<span class="lineNum">    5664 </span>            : #if _ModKeysAutoRepeat
<span class="lineNum">    5665 </span>            :         /* Under cygwin the modifier keys auto repeat, they don't under normal X */
<span class="lineNum">    5666 </span>            :     } else if ( cv-&gt;autorpt==event-&gt;u.timer.timer ) {
<span class="lineNum">    5667 </span>            :         cv-&gt;autorpt = NULL;
<span class="lineNum">    5668 </span>            :         CVToolsSetCursor(cv,cv-&gt;oldstate,NULL);
<span class="lineNum">    5669 </span>            :         if ( cv-&gt;keysym == GK_Shift_L || cv-&gt;keysym == GK_Shift_R ||
<span class="lineNum">    5670 </span>            :                  cv-&gt;keysym == GK_Alt_L || cv-&gt;keysym == GK_Alt_R ||
<span class="lineNum">    5671 </span>            :                  cv-&gt;keysym == GK_Meta_L || cv-&gt;keysym == GK_Meta_R ) {
<span class="lineNum">    5672 </span>            :             GEvent e;
<span class="lineNum">    5673 </span>            :             e.w = cv-&gt;oldkeyw;
<span class="lineNum">    5674 </span>            :             e.u.chr.keysym = cv-&gt;keysym;
<span class="lineNum">    5675 </span>            :             e.u.chr.x = cv-&gt;oldkeyx;
<span class="lineNum">    5676 </span>            :             e.u.chr.y = cv-&gt;oldkeyy;
<span class="lineNum">    5677 </span>            :             CVFakeMove(cv,&amp;e);
<span class="lineNum">    5678 </span>            :         }
<span class="lineNum">    5679 </span>            : #endif
<span class="lineNum">    5680 </span>            :     }
<a name="5681"><span class="lineNum">    5681 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    5682 </span>            : 
<span class="lineNum">    5683 </span><span class="lineNoCov">          0 : static void CVDrop(CharView *cv,GEvent *event) {</span>
<span class="lineNum">    5684 </span>            :     /* We should get a list of character names. Add each as a RefChar */
<span class="lineNum">    5685 </span>            :     int32 len;
<span class="lineNum">    5686 </span><span class="lineNoCov">          0 :     int ch, first = true;</span>
<span class="lineNum">    5687 </span>            :     char *start, *pt, *cnames;
<span class="lineNum">    5688 </span>            :     SplineChar *rsc;
<span class="lineNum">    5689 </span>            :     RefChar *new;
<span class="lineNum">    5690 </span><span class="lineNoCov">          0 :     int layer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    5691 </span>            : 
<span class="lineNum">    5692 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.drawmode==dm_grid ) {</span>
<span class="lineNum">    5693 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Not Guides&quot;),_(&quot;References may not be dragged into the guidelines layer&quot;));</span>
<span class="lineNum">    5694 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5695 </span>            :     }
<span class="lineNum">    5696 </span><span class="lineNoCov">          0 :     if ( !GDrawSelectionHasType(cv-&gt;gw,sn_drag_and_drop,&quot;STRING&quot;))</span>
<span class="lineNum">    5697 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5698 </span><span class="lineNoCov">          0 :     cnames = GDrawRequestSelection(cv-&gt;gw,sn_drag_and_drop,&quot;STRING&quot;,&amp;len);</span>
<span class="lineNum">    5699 </span><span class="lineNoCov">          0 :     if ( cnames==NULL )</span>
<span class="lineNum">    5700 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5701 </span>            : 
<span class="lineNum">    5702 </span><span class="lineNoCov">          0 :     start = cnames;</span>
<span class="lineNum">    5703 </span><span class="lineNoCov">          0 :     while ( *start ) {</span>
<span class="lineNum">    5704 </span><span class="lineNoCov">          0 :         while ( *start==' ' ) ++start;</span>
<span class="lineNum">    5705 </span><span class="lineNoCov">          0 :         if ( *start=='\0' )</span>
<span class="lineNum">    5706 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    5707 </span><span class="lineNoCov">          0 :         for ( pt=start; *pt &amp;&amp; *pt!=' '; ++pt );</span>
<span class="lineNum">    5708 </span><span class="lineNoCov">          0 :         ch = *pt; *pt = '\0';</span>
<span class="lineNum">    5709 </span><span class="lineNoCov">          0 :         if ( (rsc=SFGetChar(cv-&gt;b.sc-&gt;parent,-1,start))!=NULL &amp;&amp; rsc!=cv-&gt;b.sc ) {</span>
<span class="lineNum">    5710 </span><span class="lineNoCov">          0 :             if ( first ) {</span>
<span class="lineNum">    5711 </span><span class="lineNoCov">          0 :                 CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    5712 </span><span class="lineNoCov">          0 :                 first =false;</span>
<span class="lineNum">    5713 </span>            :             }
<span class="lineNum">    5714 </span><span class="lineNoCov">          0 :             new = RefCharCreate();</span>
<span class="lineNum">    5715 </span><span class="lineNoCov">          0 :             new-&gt;transform[0] = new-&gt;transform[3] = 1.0;</span>
<span class="lineNum">    5716 </span><span class="lineNoCov">          0 :             new-&gt;layers[0].splines = NULL;</span>
<span class="lineNum">    5717 </span><span class="lineNoCov">          0 :             new-&gt;sc = rsc;</span>
<span class="lineNum">    5718 </span><span class="lineNoCov">          0 :             new-&gt;next = cv-&gt;b.sc-&gt;layers[layer].refs;</span>
<span class="lineNum">    5719 </span><span class="lineNoCov">          0 :             cv-&gt;b.sc-&gt;layers[layer].refs = new;</span>
<span class="lineNum">    5720 </span><span class="lineNoCov">          0 :             SCReinstanciateRefChar(cv-&gt;b.sc,new,layer);</span>
<span class="lineNum">    5721 </span><span class="lineNoCov">          0 :             SCMakeDependent(cv-&gt;b.sc,rsc);</span>
<span class="lineNum">    5722 </span>            :         }
<span class="lineNum">    5723 </span><span class="lineNoCov">          0 :         *pt = ch;</span>
<span class="lineNum">    5724 </span><span class="lineNoCov">          0 :         start = pt;</span>
<span class="lineNum">    5725 </span>            :     }
<span class="lineNum">    5726 </span>            : 
<span class="lineNum">    5727 </span><span class="lineNoCov">          0 :     free(cnames);</span>
<span class="lineNum">    5728 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="5729"><span class="lineNum">    5729 </span>            : }</a>
<span class="lineNum">    5730 </span>            : 
<span class="lineNum">    5731 </span><span class="lineNoCov">          0 : static int v_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    5732 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    5733 </span>            : 
<span class="lineNum">    5734 </span><span class="lineNoCov">          0 :     GGadgetPopupExternalEvent(event);</span>
<span class="lineNum">    5735 </span><span class="lineNoCov">          0 :     if (( event-&gt;type==et_mouseup || event-&gt;type==et_mousedown ) &amp;&amp;</span>
<span class="lineNum">    5736 </span><span class="lineNoCov">          0 :             (event-&gt;u.mouse.button&gt;=4 &amp;&amp; event-&gt;u.mouse.button&lt;=7 ) ) {</span>
<span class="lineNum">    5737 </span><span class="lineNoCov">          0 :         if ( !(event-&gt;u.mouse.state&amp;(ksm_control)) )     /* bind control to magnify/minify */</span>
<span class="lineNum">    5738 </span>            :         {
<span class="lineNum">    5739 </span><span class="lineNoCov">          0 :             int ish = event-&gt;u.mouse.button&gt;5;</span>
<span class="lineNum">    5740 </span><span class="lineNoCov">          0 :             if ( event-&gt;u.mouse.state&amp;ksm_shift ) ish = !ish;</span>
<span class="lineNum">    5741 </span><span class="lineNoCov">          0 :             if ( ish ) /* bind shift to vertical scrolling */</span>
<span class="lineNum">    5742 </span><span class="lineNoCov">          0 : return( GGadgetDispatchEvent(cv-&gt;hsb,event));</span>
<span class="lineNum">    5743 </span>            :             else
<span class="lineNum">    5744 </span><span class="lineNoCov">          0 : return( GGadgetDispatchEvent(cv-&gt;vsb,event));</span>
<span class="lineNum">    5745 </span>            :         }
<span class="lineNum">    5746 </span>            :     }
<span class="lineNum">    5747 </span>            : 
<span class="lineNum">    5748 </span><span class="lineNoCov">          0 :     switch ( event-&gt;type ) {</span>
<span class="lineNum">    5749 </span>            :       case et_expose:
<span class="lineNum">    5750 </span><span class="lineNoCov">          0 :         GDrawSetLineWidth(gw,0);</span>
<span class="lineNum">    5751 </span><span class="lineNoCov">          0 :         CVExpose(cv,gw,event);</span>
<span class="lineNum">    5752 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5753 </span>            :       case et_crossing:
<span class="lineNum">    5754 </span><span class="lineNoCov">          0 :         CVCrossing(cv,event);</span>
<span class="lineNum">    5755 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5756 </span>            :       case et_mousedown:
<span class="lineNum">    5757 </span><span class="lineNoCov">          0 :         CVPaletteActivate(cv);</span>
<span class="lineNum">    5758 </span><span class="lineNoCov">          0 :         if ( cv-&gt;gic!=NULL )</span>
<span class="lineNum">    5759 </span><span class="lineNoCov">          0 :             GDrawSetGIC(gw,cv-&gt;gic,0,20);</span>
<span class="lineNum">    5760 </span><span class="lineNoCov">          0 :         if ( cv-&gt;inactive )</span>
<span class="lineNum">    5761 </span><span class="lineNoCov">          0 :             (cv-&gt;b.container-&gt;funcs-&gt;activateMe)(cv-&gt;b.container,&amp;cv-&gt;b);</span>
<span class="lineNum">    5762 </span><span class="lineNoCov">          0 :         CVMouseDown(cv,event);</span>
<span class="lineNum">    5763 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5764 </span>            :       case et_mousemove:
<span class="lineNum">    5765 </span><span class="lineNoCov">          0 :         if ( cv-&gt;p.pressed || cv-&gt;spacebar_hold)</span>
<span class="lineNum">    5766 </span><span class="lineNoCov">          0 :             GDrawSkipMouseMoveEvents(cv-&gt;v,event);</span>
<span class="lineNum">    5767 </span><span class="lineNoCov">          0 :         CVMouseMove(cv,event);</span>
<span class="lineNum">    5768 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5769 </span>            :       case et_mouseup:
<span class="lineNum">    5770 </span><span class="lineNoCov">          0 :         CVMouseUp(cv,event);</span>
<span class="lineNum">    5771 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5772 </span>            :       case et_char:
<span class="lineNum">    5773 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.container!=NULL )</span>
<span class="lineNum">    5774 </span><span class="lineNoCov">          0 :             (cv-&gt;b.container-&gt;funcs-&gt;charEvent)(cv-&gt;b.container,event);</span>
<span class="lineNum">    5775 </span>            :         else
<span class="lineNum">    5776 </span><span class="lineNoCov">          0 :             CVChar(cv,event);</span>
<span class="lineNum">    5777 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5778 </span>            :       case et_charup:
<span class="lineNum">    5779 </span><span class="lineNoCov">          0 :         CVCharUp(cv,event);</span>
<span class="lineNum">    5780 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5781 </span>            :       case et_timer:
<span class="lineNum">    5782 </span><span class="lineNoCov">          0 :         CVTimer(cv,event);</span>
<span class="lineNum">    5783 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5784 </span>            :       case et_drop:
<span class="lineNum">    5785 </span><span class="lineNoCov">          0 :         CVDrop(cv,event);</span>
<span class="lineNum">    5786 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5787 </span>            :       case et_focus:
<span class="lineNum">    5788 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.focus.gained_focus ) {</span>
<span class="lineNum">    5789 </span><span class="lineNoCov">          0 :             if ( cv-&gt;gic!=NULL )</span>
<span class="lineNum">    5790 </span><span class="lineNoCov">          0 :                 GDrawSetGIC(gw,cv-&gt;gic,0,20);</span>
<span class="lineNum">    5791 </span>            :         }
<span class="lineNum">    5792 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5793 </span>            :     }
<span class="lineNum">    5794 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="5795"><span class="lineNum">    5795 </span>            : }</a>
<span class="lineNum">    5796 </span>            : 
<span class="lineNum">    5797 </span><span class="lineNoCov">          0 : static void CVDrawNum(CharView *UNUSED(cv),GWindow pixmap,int x, int y, char *format,real val, int align) {</span>
<span class="lineNum">    5798 </span>            :     char buffer[40];
<span class="lineNum">    5799 </span>            :     int len;
<span class="lineNum">    5800 </span>            : 
<span class="lineNum">    5801 </span><span class="lineNoCov">          0 :     if ( val==0 ) val=0;                /* avoid -0 */</span>
<span class="lineNum">    5802 </span><span class="lineNoCov">          0 :     sprintf(buffer,format,(double)val); /* formats are given as for doubles */</span>
<span class="lineNum">    5803 </span><span class="lineNoCov">          0 :     if ( align!=0 ) {</span>
<span class="lineNum">    5804 </span><span class="lineNoCov">          0 :         len = GDrawGetText8Width(pixmap,buffer,-1);</span>
<span class="lineNum">    5805 </span><span class="lineNoCov">          0 :         if ( align==1 )</span>
<span class="lineNum">    5806 </span><span class="lineNoCov">          0 :             x-=len/2;</span>
<span class="lineNum">    5807 </span>            :         else
<span class="lineNum">    5808 </span><span class="lineNoCov">          0 :             x-=len;</span>
<span class="lineNum">    5809 </span>            :     }
<span class="lineNum">    5810 </span><span class="lineNoCov">          0 :     GDrawDrawText8(pixmap,x,y,buffer,-1,GDrawGetDefaultForeground(NULL));</span>
<a name="5811"><span class="lineNum">    5811 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    5812 </span>            : 
<span class="lineNum">    5813 </span><span class="lineNoCov">          0 : static void CVDrawVNum(CharView *cv,GWindow pixmap,int x, int y, char *format,real val, int align) {</span>
<span class="lineNum">    5814 </span>            :     char buffer[40], *pt;
<span class="lineNum">    5815 </span>            :     int len;
<span class="lineNum">    5816 </span>            : 
<span class="lineNum">    5817 </span><span class="lineNoCov">          0 :     if ( val==0 ) val=0;                /* avoid -0 */</span>
<span class="lineNum">    5818 </span><span class="lineNoCov">          0 :     sprintf(buffer,format,(double)val); /* formats are given as for doubles */</span>
<span class="lineNum">    5819 </span><span class="lineNoCov">          0 :     if ( align!=0 ) {</span>
<span class="lineNum">    5820 </span><span class="lineNoCov">          0 :         len = strlen(buffer)*cv-&gt;sfh;</span>
<span class="lineNum">    5821 </span><span class="lineNoCov">          0 :         if ( align==1 )</span>
<span class="lineNum">    5822 </span><span class="lineNoCov">          0 :             y-=len/2;</span>
<span class="lineNum">    5823 </span>            :         else
<span class="lineNum">    5824 </span><span class="lineNoCov">          0 :             y-=len;</span>
<span class="lineNum">    5825 </span>            :     }
<span class="lineNum">    5826 </span><span class="lineNoCov">          0 :     for ( pt=buffer; *pt; ++pt ) {</span>
<span class="lineNum">    5827 </span><span class="lineNoCov">          0 :         GDrawDrawText8(pixmap,x,y,pt,1,GDrawGetDefaultForeground(NULL));</span>
<span class="lineNum">    5828 </span><span class="lineNoCov">          0 :         y += cv-&gt;sdh;</span>
<span class="lineNum">    5829 </span>            :     }
<span class="lineNum">    5830 </span><span class="lineNoCov">          0 : }</span>
<a name="5831"><span class="lineNum">    5831 </span>            : </a>
<span class="lineNum">    5832 </span>            : 
<span class="lineNum">    5833 </span><span class="lineNoCov">          0 : static void CVExposeRulers(CharView *cv, GWindow pixmap ) {</span>
<span class="lineNum">    5834 </span>            :     real xmin, xmax, ymin, ymax;
<span class="lineNum">    5835 </span>            :     real onehundred, pos;
<span class="lineNum">    5836 </span>            :     real units, littleunits;
<span class="lineNum">    5837 </span><span class="lineNoCov">          0 :     int ybase = cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh;</span>
<span class="lineNum">    5838 </span>            :     int x,y;
<span class="lineNum">    5839 </span>            :     GRect rect;
<span class="lineNum">    5840 </span><span class="lineNoCov">          0 :     Color def_fg = GDrawGetDefaultForeground(NULL);</span>
<span class="lineNum">    5841 </span>            : 
<span class="lineNum">    5842 </span><span class="lineNoCov">          0 :     xmin = -cv-&gt;xoff/cv-&gt;scale;</span>
<span class="lineNum">    5843 </span><span class="lineNoCov">          0 :     xmax = (cv-&gt;width-cv-&gt;xoff)/cv-&gt;scale;</span>
<span class="lineNum">    5844 </span><span class="lineNoCov">          0 :     ymin = -cv-&gt;yoff/cv-&gt;scale;</span>
<span class="lineNum">    5845 </span><span class="lineNoCov">          0 :     ymax = (cv-&gt;height-cv-&gt;yoff)/cv-&gt;scale;</span>
<span class="lineNum">    5846 </span><span class="lineNoCov">          0 :     onehundred = 100/cv-&gt;scale;</span>
<span class="lineNum">    5847 </span>            : 
<span class="lineNum">    5848 </span><span class="lineNoCov">          0 :     if ( onehundred&lt;5 ) {</span>
<span class="lineNum">    5849 </span><span class="lineNoCov">          0 :         units = 1; littleunits=0;</span>
<span class="lineNum">    5850 </span><span class="lineNoCov">          0 :     } else if ( onehundred&lt;10 ) {</span>
<span class="lineNum">    5851 </span><span class="lineNoCov">          0 :         units = 5; littleunits=1;</span>
<span class="lineNum">    5852 </span><span class="lineNoCov">          0 :     } else if ( onehundred&lt;50 ) {</span>
<span class="lineNum">    5853 </span><span class="lineNoCov">          0 :         units = 10; littleunits=2;</span>
<span class="lineNum">    5854 </span><span class="lineNoCov">          0 :     } else if ( onehundred&lt;100 ) {</span>
<span class="lineNum">    5855 </span><span class="lineNoCov">          0 :         units = 25; littleunits=5;</span>
<span class="lineNum">    5856 </span><span class="lineNoCov">          0 :     } else if ( onehundred&lt;500/2 ) {</span>
<span class="lineNum">    5857 </span><span class="lineNoCov">          0 :         units = 100; littleunits=20;</span>
<span class="lineNum">    5858 </span><span class="lineNoCov">          0 :     } else if ( onehundred&lt;1000/2 ) {</span>
<span class="lineNum">    5859 </span>            :         // The next numbers (1000 and up) take more space to display, so Frank has adjusted the thresholds.
<span class="lineNum">    5860 </span><span class="lineNoCov">          0 :         units = 250; littleunits=50;</span>
<span class="lineNum">    5861 </span><span class="lineNoCov">          0 :     } else if ( onehundred&lt;5000/2 ) {</span>
<span class="lineNum">    5862 </span><span class="lineNoCov">          0 :         units = 1000; littleunits=200;</span>
<span class="lineNum">    5863 </span><span class="lineNoCov">          0 :     } else if ( onehundred&lt;10000/2 ) {</span>
<span class="lineNum">    5864 </span><span class="lineNoCov">          0 :         units = 2500; littleunits=500;</span>
<span class="lineNum">    5865 </span><span class="lineNoCov">          0 :     } else if ( onehundred&lt;50000/2 ) {</span>
<span class="lineNum">    5866 </span><span class="lineNoCov">          0 :         units = 10000; littleunits=2000;</span>
<span class="lineNum">    5867 </span>            :     } else {
<span class="lineNum">    5868 </span><span class="lineNoCov">          0 :         for ( units=1 ; units&lt;onehundred*2; units *= 10 );</span>
<span class="lineNum">    5869 </span><span class="lineNoCov">          0 :         units/=10; littleunits = units/5;</span>
<span class="lineNum">    5870 </span>            :     }
<span class="lineNum">    5871 </span>            : 
<span class="lineNum">    5872 </span><span class="lineNoCov">          0 :     rect.x = 0; rect.width = cv-&gt;width+cv-&gt;rulerh; rect.y = ybase; rect.height = cv-&gt;rulerh;</span>
<span class="lineNum">    5873 </span><span class="lineNoCov">          0 :     GDrawFillRect(pixmap,&amp;rect,GDrawGetDefaultBackground(NULL));</span>
<span class="lineNum">    5874 </span><span class="lineNoCov">          0 :     rect.y = ybase; rect.height = cv-&gt;height+cv-&gt;rulerh; rect.x = 0; rect.width = cv-&gt;rulerh;</span>
<span class="lineNum">    5875 </span><span class="lineNoCov">          0 :     GDrawFillRect(pixmap,&amp;rect,GDrawGetDefaultBackground(NULL));</span>
<span class="lineNum">    5876 </span><span class="lineNoCov">          0 :     GDrawSetLineWidth(pixmap,0);</span>
<span class="lineNum">    5877 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap,cv-&gt;rulerh,cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh+cv-&gt;rulerh-1,8096,cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh+cv-&gt;rulerh-1,def_fg);</span>
<span class="lineNum">    5878 </span><span class="lineNoCov">          0 :     GDrawDrawLine(pixmap,cv-&gt;rulerh-1,cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh+cv-&gt;rulerh,cv-&gt;rulerh-1,8096,def_fg);</span>
<span class="lineNum">    5879 </span>            : 
<span class="lineNum">    5880 </span><span class="lineNoCov">          0 :     GDrawSetFont(pixmap,cv-&gt;small);</span>
<span class="lineNum">    5881 </span><span class="lineNoCov">          0 :     if ( xmax-xmin&lt;1 &amp;&amp; cv-&gt;width&gt;100 ) {</span>
<span class="lineNum">    5882 </span><span class="lineNoCov">          0 :         CVDrawNum(cv,pixmap,cv-&gt;rulerh,ybase+cv-&gt;sas,&quot;%.3f&quot;,xmin,0);</span>
<span class="lineNum">    5883 </span><span class="lineNoCov">          0 :         CVDrawNum(cv,pixmap,cv-&gt;rulerh+cv-&gt;width,ybase+cv-&gt;sas,&quot;%.3f&quot;,xmax,2);</span>
<span class="lineNum">    5884 </span>            :     }
<span class="lineNum">    5885 </span><span class="lineNoCov">          0 :     if ( ymax-ymin&lt;1 &amp;&amp; cv-&gt;height&gt;100 ) {</span>
<span class="lineNum">    5886 </span><span class="lineNoCov">          0 :         CVDrawVNum(cv,pixmap,1,ybase+cv-&gt;rulerh+cv-&gt;height+cv-&gt;sas,&quot;%.3f&quot;,ymin,0);</span>
<span class="lineNum">    5887 </span><span class="lineNoCov">          0 :         CVDrawVNum(cv,pixmap,1,ybase+cv-&gt;rulerh+cv-&gt;sas,&quot;%.3f&quot;,ymax,2);</span>
<span class="lineNum">    5888 </span>            :     }
<span class="lineNum">    5889 </span><span class="lineNoCov">          0 :     if ( fabs(xmin/units) &lt; 1e5 &amp;&amp; fabs(ymin/units)&lt;1e5 &amp;&amp; fabs(xmax/units)&lt;1e5 &amp;&amp; fabs(ymax/units)&lt;1e5 ) {</span>
<span class="lineNum">    5890 </span><span class="lineNoCov">          0 :         if ( littleunits!=0 ) {</span>
<span class="lineNum">    5891 </span><span class="lineNoCov">          0 :             for ( pos=littleunits*ceil(xmin/littleunits); pos&lt;xmax; pos += littleunits ) {</span>
<span class="lineNum">    5892 </span><span class="lineNoCov">          0 :                 x = cv-&gt;xoff + rint(pos*cv-&gt;scale);</span>
<span class="lineNum">    5893 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,x+cv-&gt;rulerh,ybase+cv-&gt;rulerh-4,x+cv-&gt;rulerh,ybase+cv-&gt;rulerh, def_fg);</span>
<span class="lineNum">    5894 </span>            :             }
<span class="lineNum">    5895 </span><span class="lineNoCov">          0 :             for ( pos=littleunits*ceil(ymin/littleunits); pos&lt;ymax; pos += littleunits ) {</span>
<span class="lineNum">    5896 </span><span class="lineNoCov">          0 :                 y = -cv-&gt;yoff + cv-&gt;height - rint(pos*cv-&gt;scale);</span>
<span class="lineNum">    5897 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,cv-&gt;rulerh-4,ybase+cv-&gt;rulerh+y,cv-&gt;rulerh,ybase+cv-&gt;rulerh+y, def_fg);</span>
<span class="lineNum">    5898 </span>            :             }
<span class="lineNum">    5899 </span>            :         }
<span class="lineNum">    5900 </span><span class="lineNoCov">          0 :         for ( pos=units*ceil(xmin/units); pos&lt;xmax; pos += units ) {</span>
<span class="lineNum">    5901 </span><span class="lineNoCov">          0 :             x = cv-&gt;xoff + rint(pos*cv-&gt;scale);</span>
<span class="lineNum">    5902 </span><span class="lineNoCov">          0 :             GDrawDrawLine(pixmap,x+cv-&gt;rulerh,ybase,x+cv-&gt;rulerh,ybase+cv-&gt;rulerh, rulerbigtickcol);</span>
<span class="lineNum">    5903 </span><span class="lineNoCov">          0 :             CVDrawNum(cv,pixmap,x+cv-&gt;rulerh+15,ybase+cv-&gt;sas,&quot;%g&quot;,pos,1);</span>
<span class="lineNum">    5904 </span>            :         }
<span class="lineNum">    5905 </span><span class="lineNoCov">          0 :         for ( pos=units*ceil(ymin/units); pos&lt;ymax; pos += units ) {</span>
<span class="lineNum">    5906 </span><span class="lineNoCov">          0 :             y = -cv-&gt;yoff + cv-&gt;height - rint(pos*cv-&gt;scale);</span>
<span class="lineNum">    5907 </span><span class="lineNoCov">          0 :             GDrawDrawLine(pixmap,0,ybase+cv-&gt;rulerh+y,cv-&gt;rulerh,ybase+cv-&gt;rulerh+y, rulerbigtickcol);</span>
<span class="lineNum">    5908 </span><span class="lineNoCov">          0 :             CVDrawVNum(cv,pixmap,1,y+ybase+cv-&gt;rulerh+cv-&gt;sas+20,&quot;%g&quot;,pos,1);</span>
<span class="lineNum">    5909 </span>            :         }
<span class="lineNum">    5910 </span>            :     }
<a name="5911"><span class="lineNum">    5911 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    5912 </span>            : 
<span class="lineNum">    5913 </span><span class="lineNoCov">          0 : static void InfoExpose(CharView *cv, GWindow pixmap, GEvent *expose) {</span>
<span class="lineNum">    5914 </span>            :     GRect old1, old2;
<span class="lineNum">    5915 </span><span class="lineNoCov">          0 :     Color def_fg = GDrawGetDefaultForeground(NULL);</span>
<span class="lineNum">    5916 </span>            : 
<span class="lineNum">    5917 </span><span class="lineNoCov">          0 :     if ( expose-&gt;u.expose.rect.y + expose-&gt;u.expose.rect.height &lt; cv-&gt;mbh ||</span>
<span class="lineNum">    5918 </span><span class="lineNoCov">          0 :             (!cv-&gt;showrulers &amp;&amp; expose-&gt;u.expose.rect.y &gt;= cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh ))</span>
<span class="lineNum">    5919 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5920 </span>            : 
<span class="lineNum">    5921 </span><span class="lineNoCov">          0 :     GDrawPushClip(pixmap,&amp;expose-&gt;u.expose.rect,&amp;old1);</span>
<span class="lineNum">    5922 </span><span class="lineNoCov">          0 :     GDrawSetLineWidth(pixmap,0);</span>
<span class="lineNum">    5923 </span><span class="lineNoCov">          0 :     if ( expose-&gt;u.expose.rect.y&lt; cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh ) {</span>
<span class="lineNum">    5924 </span><span class="lineNoCov">          0 :         GDrawPushClip(pixmap,&amp;expose-&gt;u.expose.rect,&amp;old2);</span>
<span class="lineNum">    5925 </span>            : 
<span class="lineNum">    5926 </span><span class="lineNoCov">          0 :         GDrawDrawLine(pixmap,0,cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh-1,8096,cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh-1,def_fg);</span>
<span class="lineNum">    5927 </span><span class="lineNoCov">          0 :         GDrawDrawImage(pixmap,&amp;GIcon_rightpointer,NULL,RPT_BASE,cv-&gt;mbh+cv-&gt;charselectorh+2);</span>
<span class="lineNum">    5928 </span><span class="lineNoCov">          0 :         GDrawDrawImage(pixmap,&amp;GIcon_selectedpoint,NULL,SPT_BASE,cv-&gt;mbh+cv-&gt;charselectorh+2);</span>
<span class="lineNum">    5929 </span><span class="lineNoCov">          0 :         GDrawDrawImage(pixmap,&amp;GIcon_sel2ptr,NULL,SOF_BASE,cv-&gt;mbh+cv-&gt;charselectorh+2);</span>
<span class="lineNum">    5930 </span><span class="lineNoCov">          0 :         GDrawDrawImage(pixmap,&amp;GIcon_distance,NULL,SDS_BASE,cv-&gt;mbh+cv-&gt;charselectorh+2);</span>
<span class="lineNum">    5931 </span><span class="lineNoCov">          0 :         GDrawDrawImage(pixmap,&amp;GIcon_angle,NULL,SAN_BASE,cv-&gt;mbh+cv-&gt;charselectorh+2);</span>
<span class="lineNum">    5932 </span><span class="lineNoCov">          0 :         GDrawDrawImage(pixmap,&amp;GIcon_mag,NULL,MAG_BASE,cv-&gt;mbh+cv-&gt;charselectorh+2);</span>
<span class="lineNum">    5933 </span><span class="lineNoCov">          0 :         CVInfoDrawText(cv,pixmap);</span>
<span class="lineNum">    5934 </span><span class="lineNoCov">          0 :         GDrawPopClip(pixmap,&amp;old2);</span>
<span class="lineNum">    5935 </span>            :     }
<span class="lineNum">    5936 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showrulers ) {</span>
<span class="lineNum">    5937 </span><span class="lineNoCov">          0 :         CVExposeRulers(cv,pixmap);</span>
<span class="lineNum">    5938 </span><span class="lineNoCov">          0 :         cv-&gt;olde.x = -1;</span>
<span class="lineNum">    5939 </span><span class="lineNoCov">          0 :         CVInfoDrawRulers(cv,pixmap);</span>
<span class="lineNum">    5940 </span>            :     }
<span class="lineNum">    5941 </span><span class="lineNoCov">          0 :     GDrawPopClip(pixmap,&amp;old1);</span>
<a name="5942"><span class="lineNum">    5942 </span>            : }</a>
<span class="lineNum">    5943 </span>            : 
<span class="lineNum">    5944 </span><span class="lineNoCov">          0 : void CVResize(CharView *cv ) {</span>
<span class="lineNum">    5945 </span><span class="lineNoCov">          0 :     int sbsize = GDrawPointsToPixels(cv-&gt;gw,_GScrollBar_Width);</span>
<span class="lineNum">    5946 </span>            :     GRect size;
<span class="lineNum">    5947 </span><span class="lineNoCov">          0 :     GDrawGetSize(cv-&gt;gw,&amp;size);</span>
<span class="lineNum">    5948 </span>            :     {
<span class="lineNum">    5949 </span><span class="lineNoCov">          0 :         int newwidth = size.width-sbsize,</span>
<span class="lineNum">    5950 </span><span class="lineNoCov">          0 :             newheight = size.height-sbsize - cv-&gt;mbh-cv-&gt;charselectorh-cv-&gt;infoh;</span>
<span class="lineNum">    5951 </span><span class="lineNoCov">          0 :         int sbwidth = newwidth, sbheight = newheight;</span>
<span class="lineNum">    5952 </span>            : 
<span class="lineNum">    5953 </span><span class="lineNoCov">          0 :         if ( cv-&gt;dv!=NULL ) {</span>
<span class="lineNum">    5954 </span><span class="lineNoCov">          0 :             newwidth -= cv-&gt;dv-&gt;dwidth;</span>
<span class="lineNum">    5955 </span><span class="lineNoCov">          0 :             sbwidth -= cv-&gt;dv-&gt;dwidth;</span>
<span class="lineNum">    5956 </span>            :         }
<span class="lineNum">    5957 </span><span class="lineNoCov">          0 :         if ( newwidth&lt;30 || newheight&lt;50 ) {</span>
<span class="lineNum">    5958 </span><span class="lineNoCov">          0 :             if ( newwidth&lt;30 )</span>
<span class="lineNum">    5959 </span><span class="lineNoCov">          0 :                 newwidth = 30+sbsize+(cv-&gt;dv!=NULL ? cv-&gt;dv-&gt;dwidth : 0);</span>
<span class="lineNum">    5960 </span><span class="lineNoCov">          0 :             if ( newheight&lt;50 )</span>
<span class="lineNum">    5961 </span><span class="lineNoCov">          0 :                 newheight = 50+sbsize+cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh;</span>
<span class="lineNum">    5962 </span><span class="lineNoCov">          0 :             GDrawResize(cv-&gt;gw,newwidth,newheight);</span>
<span class="lineNum">    5963 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5964 </span>            :         }
<span class="lineNum">    5965 </span>            : 
<span class="lineNum">    5966 </span><span class="lineNoCov">          0 :         if ( cv-&gt;dv!=NULL ) {</span>
<span class="lineNum">    5967 </span><span class="lineNoCov">          0 :             int dvheight = size.height-(cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh);</span>
<span class="lineNum">    5968 </span><span class="lineNoCov">          0 :             GDrawMove(cv-&gt;dv-&gt;dv,size.width-cv-&gt;dv-&gt;dwidth,cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh);</span>
<span class="lineNum">    5969 </span><span class="lineNoCov">          0 :             GDrawResize(cv-&gt;dv-&gt;dv,cv-&gt;dv-&gt;dwidth,dvheight);</span>
<span class="lineNum">    5970 </span><span class="lineNoCov">          0 :             GDrawResize(cv-&gt;dv-&gt;ii.v,cv-&gt;dv-&gt;dwidth-sbsize,dvheight-cv-&gt;dv-&gt;toph);</span>
<span class="lineNum">    5971 </span><span class="lineNoCov">          0 :             GGadgetResize(cv-&gt;dv-&gt;ii.vsb,sbsize,dvheight-cv-&gt;dv-&gt;toph);</span>
<span class="lineNum">    5972 </span><span class="lineNoCov">          0 :             cv-&gt;dv-&gt;ii.vheight = dvheight-cv-&gt;dv-&gt;toph;</span>
<span class="lineNum">    5973 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(cv-&gt;dv-&gt;dv,NULL,false);</span>
<span class="lineNum">    5974 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(cv-&gt;dv-&gt;ii.v,NULL,false);</span>
<span class="lineNum">    5975 </span><span class="lineNoCov">          0 :             GScrollBarSetBounds(cv-&gt;dv-&gt;ii.vsb,0,cv-&gt;dv-&gt;ii.lheight+1,</span>
<span class="lineNum">    5976 </span><span class="lineNoCov">          0 :                     cv-&gt;dv-&gt;ii.vheight/cv-&gt;dv-&gt;ii.fh);</span>
<span class="lineNum">    5977 </span>            :         }
<span class="lineNum">    5978 </span>            : 
<span class="lineNum">    5979 </span><span class="lineNoCov">          0 :         if (cv-&gt;charselector != NULL &amp;&amp; cv-&gt;charselectorPrev != NULL &amp;&amp; cv-&gt;charselectorNext != NULL) {</span>
<span class="lineNum">    5980 </span>            :           GRect charselector_size;
<span class="lineNum">    5981 </span>            :           GRect charselectorNext_size;
<span class="lineNum">    5982 </span>            :           GRect charselectorPrev_size;
<span class="lineNum">    5983 </span><span class="lineNoCov">          0 :           GGadgetGetSize(cv-&gt;charselector, &amp;charselector_size);</span>
<span class="lineNum">    5984 </span><span class="lineNoCov">          0 :           GGadgetGetSize(cv-&gt;charselectorPrev, &amp;charselectorPrev_size);</span>
<span class="lineNum">    5985 </span><span class="lineNoCov">          0 :           GGadgetGetSize(cv-&gt;charselectorNext, &amp;charselectorNext_size);</span>
<span class="lineNum">    5986 </span><span class="lineNoCov">          0 :           int new_charselector_width = newwidth + sbsize - ( 4 * charselector_size.x ) - charselectorNext_size.width - charselectorPrev_size.width;</span>
<span class="lineNum">    5987 </span><span class="lineNoCov">          0 :           int new_charselectorPrev_x = newwidth + sbsize - ( 2 * charselector_size.x ) - charselectorNext_size.width - charselectorPrev_size.width;</span>
<span class="lineNum">    5988 </span><span class="lineNoCov">          0 :           int new_charselectorNext_x = newwidth + sbsize - ( 1 * charselector_size.x ) - charselectorNext_size.width;</span>
<span class="lineNum">    5989 </span><span class="lineNoCov">          0 :           GGadgetResize(cv-&gt;charselector, new_charselector_width, charselector_size.height);</span>
<span class="lineNum">    5990 </span><span class="lineNoCov">          0 :           GGadgetMove(cv-&gt;charselectorPrev, new_charselectorPrev_x, charselectorPrev_size.y);</span>
<span class="lineNum">    5991 </span><span class="lineNoCov">          0 :           GGadgetMove(cv-&gt;charselectorNext, new_charselectorNext_x, charselectorNext_size.y);</span>
<span class="lineNum">    5992 </span><span class="lineNoCov">          0 :           charselector_size.x = 0; charselector_size.y = cv-&gt;mbh; charselector_size.width = newwidth + sbsize; charselector_size.height = cv-&gt;charselectorh;</span>
<span class="lineNum">    5993 </span><span class="lineNoCov">          0 :           GDrawRequestExpose(cv-&gt;gw, &amp;charselector_size, false);</span>
<span class="lineNum">    5994 </span>            :         }
<span class="lineNum">    5995 </span>            : 
<span class="lineNum">    5996 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showrulers ) {</span>
<span class="lineNum">    5997 </span><span class="lineNoCov">          0 :             newheight -= cv-&gt;rulerh;</span>
<span class="lineNum">    5998 </span><span class="lineNoCov">          0 :             newwidth -= cv-&gt;rulerh;</span>
<span class="lineNum">    5999 </span>            :         }
<span class="lineNum">    6000 </span>            : 
<span class="lineNum">    6001 </span><span class="lineNoCov">          0 :         if ( newwidth == cv-&gt;width &amp;&amp; newheight == cv-&gt;height )</span>
<span class="lineNum">    6002 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    6003 </span><span class="lineNoCov">          0 :         if ( cv-&gt;backimgs!=NULL )</span>
<span class="lineNum">    6004 </span><span class="lineNoCov">          0 :             GDrawDestroyWindow(cv-&gt;backimgs);</span>
<span class="lineNum">    6005 </span><span class="lineNoCov">          0 :         cv-&gt;backimgs = NULL;</span>
<span class="lineNum">    6006 </span>            : 
<span class="lineNum">    6007 </span>            :         /* MenuBar takes care of itself */
<span class="lineNum">    6008 </span><span class="lineNoCov">          0 :         GDrawResize(cv-&gt;v,newwidth,newheight);</span>
<span class="lineNum">    6009 </span><span class="lineNoCov">          0 :         GGadgetMove(cv-&gt;vsb,sbwidth, cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh);</span>
<span class="lineNum">    6010 </span><span class="lineNoCov">          0 :         GGadgetResize(cv-&gt;vsb,sbsize,sbheight);</span>
<span class="lineNum">    6011 </span><span class="lineNoCov">          0 :         GGadgetMove(cv-&gt;hsb,0,size.height-sbsize);</span>
<span class="lineNum">    6012 </span><span class="lineNoCov">          0 :         GGadgetResize(cv-&gt;hsb,sbwidth,sbsize);</span>
<span class="lineNum">    6013 </span><span class="lineNoCov">          0 :         cv-&gt;width = newwidth; cv-&gt;height = newheight;</span>
<span class="lineNum">    6014 </span><span class="lineNoCov">          0 :         /*CVFit(cv);*/ CVNewScale(cv);</span>
<span class="lineNum">    6015 </span><span class="lineNoCov">          0 :         CVPalettesRaise(cv);</span>
<span class="lineNum">    6016 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.container == NULL &amp;&amp; ( cv_width!=size.width || cv_height!=size.height )) {</span>
<span class="lineNum">    6017 </span><span class="lineNoCov">          0 :             cv_width = size.width;</span>
<span class="lineNum">    6018 </span><span class="lineNoCov">          0 :             cv_height = size.height;</span>
<span class="lineNum">    6019 </span><span class="lineNoCov">          0 :             SavePrefs(true);</span>
<span class="lineNum">    6020 </span>            :         }
<span class="lineNum">    6021 </span>            :     }
<a name="6022"><span class="lineNum">    6022 </span>            : }</a>
<span class="lineNum">    6023 </span>            : 
<span class="lineNum">    6024 </span><span class="lineNoCov">          0 : static void CVHScrollSetPos( CharView *cv, int newpos )</span>
<span class="lineNum">    6025 </span>            : {
<span class="lineNum">    6026 </span>            :     TRACE(&quot;CVHScrollSetPos(1) cvxoff:%f newpos:%d\n&quot;, cv-&gt;xoff, newpos );
<span class="lineNum">    6027 </span><span class="lineNoCov">          0 :     if ( newpos&lt;-(32000*cv-&gt;scale-cv-&gt;width) )</span>
<span class="lineNum">    6028 </span><span class="lineNoCov">          0 :         newpos = -(32000*cv-&gt;scale-cv-&gt;width);</span>
<span class="lineNum">    6029 </span><span class="lineNoCov">          0 :     if ( newpos&gt;8000*cv-&gt;scale ) newpos = 8000*cv-&gt;scale;</span>
<span class="lineNum">    6030 </span>            :     TRACE(&quot;CVHScrollSetPos(2) cvxoff:%f newpos:%d\n&quot;, cv-&gt;xoff, newpos );
<span class="lineNum">    6031 </span><span class="lineNoCov">          0 :     if ( newpos!=cv-&gt;xoff ) {</span>
<span class="lineNum">    6032 </span><span class="lineNoCov">          0 :         int diff = newpos-cv-&gt;xoff;</span>
<span class="lineNum">    6033 </span><span class="lineNoCov">          0 :         cv-&gt;xoff = newpos;</span>
<span class="lineNum">    6034 </span><span class="lineNoCov">          0 :         cv-&gt;back_img_out_of_date = true;</span>
<span class="lineNum">    6035 </span><span class="lineNoCov">          0 :         GScrollBarSetPos(cv-&gt;hsb,-newpos);</span>
<span class="lineNum">    6036 </span><span class="lineNoCov">          0 :         GDrawScroll(cv-&gt;v,NULL,diff,0);</span>
<span class="lineNum">    6037 </span><span class="lineNoCov">          0 :         if (( cv-&gt;showhhints &amp;&amp; cv-&gt;b.sc-&gt;hstem!=NULL ) || cv-&gt;showblues || cv-&gt;showvmetrics ) {</span>
<span class="lineNum">    6038 </span>            :             GRect r;
<span class="lineNum">    6039 </span><span class="lineNoCov">          0 :             r.y = 0; r.height = cv-&gt;height;</span>
<span class="lineNum">    6040 </span><span class="lineNoCov">          0 :             r.width = 6*cv-&gt;sfh+10;</span>
<span class="lineNum">    6041 </span><span class="lineNoCov">          0 :             if ( diff&gt;0 )</span>
<span class="lineNum">    6042 </span><span class="lineNoCov">          0 :                 r.x = cv-&gt;width-r.width;</span>
<span class="lineNum">    6043 </span>            :             else
<span class="lineNum">    6044 </span><span class="lineNoCov">          0 :                 r.x = cv-&gt;width+diff-r.width;</span>
<span class="lineNum">    6045 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(cv-&gt;v,&amp;r,false);</span>
<span class="lineNum">    6046 </span>            :         }
<span class="lineNum">    6047 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showrulers ) {</span>
<span class="lineNum">    6048 </span>            :             GRect r;
<span class="lineNum">    6049 </span><span class="lineNoCov">          0 :             r.y = cv-&gt;infoh+cv-&gt;mbh+cv-&gt;charselectorh; r.height = cv-&gt;rulerh; r.x = 0; r.width = cv-&gt;rulerh+cv-&gt;width;</span>
<span class="lineNum">    6050 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(cv-&gt;gw,&amp;r,false);</span>
<span class="lineNum">    6051 </span>            :         }
<span class="lineNum">    6052 </span>            :     }
<a name="6053"><span class="lineNum">    6053 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6054 </span>            : 
<span class="lineNum">    6055 </span><span class="lineNoCov">          0 : static void CVHScroll(CharView *cv, struct sbevent *sb) {</span>
<span class="lineNum">    6056 </span><span class="lineNoCov">          0 :     int newpos = cv-&gt;xoff;</span>
<span class="lineNum">    6057 </span>            : 
<span class="lineNum">    6058 </span><span class="lineNoCov">          0 :     switch( sb-&gt;type ) {</span>
<span class="lineNum">    6059 </span>            :       case et_sb_top:
<span class="lineNum">    6060 </span><span class="lineNoCov">          0 :         newpos = 0;</span>
<span class="lineNum">    6061 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6062 </span>            :       case et_sb_uppage:
<span class="lineNum">    6063 </span><span class="lineNoCov">          0 :         newpos += 9*cv-&gt;width/10;</span>
<span class="lineNum">    6064 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6065 </span>            :       case et_sb_up:
<span class="lineNum">    6066 </span><span class="lineNoCov">          0 :         newpos += cv-&gt;width/15;</span>
<span class="lineNum">    6067 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6068 </span>            :       case et_sb_down:
<span class="lineNum">    6069 </span><span class="lineNoCov">          0 :         newpos -= cv-&gt;width/15;</span>
<span class="lineNum">    6070 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6071 </span>            :       case et_sb_downpage:
<span class="lineNum">    6072 </span><span class="lineNoCov">          0 :         newpos -= 9*cv-&gt;width/10;</span>
<span class="lineNum">    6073 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6074 </span>            :       case et_sb_bottom:
<span class="lineNum">    6075 </span><span class="lineNoCov">          0 :         newpos = 0;</span>
<span class="lineNum">    6076 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6077 </span>            :       case et_sb_thumb:
<span class="lineNum">    6078 </span>            :       case et_sb_thumbrelease:
<span class="lineNum">    6079 </span><span class="lineNoCov">          0 :         newpos = -sb-&gt;pos;</span>
<span class="lineNum">    6080 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6081 </span>            :       case et_sb_halfup:
<span class="lineNum">    6082 </span><span class="lineNoCov">          0 :         newpos += cv-&gt;width/30;</span>
<span class="lineNum">    6083 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6084 </span>            :       case et_sb_halfdown:
<span class="lineNum">    6085 </span><span class="lineNoCov">          0 :         newpos -= cv-&gt;width/30;</span>
<span class="lineNum">    6086 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6087 </span>            :     }
<span class="lineNum">    6088 </span>            : 
<span class="lineNum">    6089 </span><span class="lineNoCov">          0 :     CVHScrollSetPos( cv, newpos );</span>
<a name="6090"><span class="lineNum">    6090 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6091 </span>            : 
<span class="lineNum">    6092 </span><span class="lineNoCov">          0 : static void CVVScroll(CharView *cv, struct sbevent *sb) {</span>
<span class="lineNum">    6093 </span><span class="lineNoCov">          0 :     int newpos = cv-&gt;yoff;</span>
<span class="lineNum">    6094 </span>            : 
<span class="lineNum">    6095 </span><span class="lineNoCov">          0 :     switch( sb-&gt;type ) {</span>
<span class="lineNum">    6096 </span>            :       case et_sb_top:
<span class="lineNum">    6097 </span><span class="lineNoCov">          0 :         newpos = 0;</span>
<span class="lineNum">    6098 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6099 </span>            :       case et_sb_uppage:
<span class="lineNum">    6100 </span><span class="lineNoCov">          0 :         newpos -= 9*cv-&gt;height/10;</span>
<span class="lineNum">    6101 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6102 </span>            :       case et_sb_up:
<span class="lineNum">    6103 </span><span class="lineNoCov">          0 :         newpos -= cv-&gt;height/15;</span>
<span class="lineNum">    6104 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6105 </span>            :       case et_sb_down:
<span class="lineNum">    6106 </span><span class="lineNoCov">          0 :         newpos += cv-&gt;height/15;</span>
<span class="lineNum">    6107 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6108 </span>            :       case et_sb_downpage:
<span class="lineNum">    6109 </span><span class="lineNoCov">          0 :         newpos += 9*cv-&gt;height/10;</span>
<span class="lineNum">    6110 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6111 </span>            :       case et_sb_bottom:
<span class="lineNum">    6112 </span><span class="lineNoCov">          0 :         newpos = 0;</span>
<span class="lineNum">    6113 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6114 </span>            :       case et_sb_thumb:
<span class="lineNum">    6115 </span>            :       case et_sb_thumbrelease:
<span class="lineNum">    6116 </span><span class="lineNoCov">          0 :         newpos = sb-&gt;pos+cv-&gt;height;</span>
<span class="lineNum">    6117 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6118 </span>            :       case et_sb_halfup:
<span class="lineNum">    6119 </span><span class="lineNoCov">          0 :         newpos -= cv-&gt;height/30;</span>
<span class="lineNum">    6120 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6121 </span>            :       case et_sb_halfdown:
<span class="lineNum">    6122 </span><span class="lineNoCov">          0 :         newpos += cv-&gt;height/30;</span>
<span class="lineNum">    6123 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6124 </span>            :     }
<span class="lineNum">    6125 </span><span class="lineNoCov">          0 :     if ( newpos&lt;-(20000*cv-&gt;scale-cv-&gt;height) )</span>
<span class="lineNum">    6126 </span><span class="lineNoCov">          0 :         newpos = -(20000*cv-&gt;scale-cv-&gt;height);</span>
<span class="lineNum">    6127 </span><span class="lineNoCov">          0 :     if ( newpos&gt;8000*cv-&gt;scale ) newpos = 8000*cv-&gt;scale;</span>
<span class="lineNum">    6128 </span><span class="lineNoCov">          0 :     if ( newpos!=cv-&gt;yoff ) {</span>
<span class="lineNum">    6129 </span><span class="lineNoCov">          0 :         int diff = newpos-cv-&gt;yoff;</span>
<span class="lineNum">    6130 </span><span class="lineNoCov">          0 :         cv-&gt;yoff = newpos;</span>
<span class="lineNum">    6131 </span><span class="lineNoCov">          0 :         cv-&gt;back_img_out_of_date = true;</span>
<span class="lineNum">    6132 </span><span class="lineNoCov">          0 :         GScrollBarSetPos(cv-&gt;vsb,newpos-cv-&gt;height);</span>
<span class="lineNum">    6133 </span><span class="lineNoCov">          0 :         GDrawScroll(cv-&gt;v,NULL,0,diff);</span>
<span class="lineNum">    6134 </span><span class="lineNoCov">          0 :         if (( cv-&gt;showvhints &amp;&amp; cv-&gt;b.sc-&gt;vstem!=NULL) || cv-&gt;showhmetrics ) {</span>
<span class="lineNum">    6135 </span>            :             GRect r;
<span class="lineNum">    6136 </span><span class="lineNoCov">          0 :             RefChar *lock = HasUseMyMetrics(cv-&gt;b.sc,CVLayer((CharViewBase *) cv));</span>
<span class="lineNum">    6137 </span><span class="lineNoCov">          0 :             r.x = 0; r.width = cv-&gt;width;</span>
<span class="lineNum">    6138 </span><span class="lineNoCov">          0 :             r.height = 2*cv-&gt;sfh+6;</span>
<span class="lineNum">    6139 </span><span class="lineNoCov">          0 :             if ( lock!=NULL )</span>
<span class="lineNum">    6140 </span><span class="lineNoCov">          0 :                 r.height = cv-&gt;sfh+3+GImageGetHeight(&amp;GIcon_lock);</span>
<span class="lineNum">    6141 </span><span class="lineNoCov">          0 :             if ( diff&gt;0 )</span>
<span class="lineNum">    6142 </span><span class="lineNoCov">          0 :                 r.y = 0;</span>
<span class="lineNum">    6143 </span>            :             else
<span class="lineNum">    6144 </span><span class="lineNoCov">          0 :                 r.y = -diff;</span>
<span class="lineNum">    6145 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(cv-&gt;v,&amp;r,false);</span>
<span class="lineNum">    6146 </span>            :         }
<span class="lineNum">    6147 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showrulers ) {</span>
<span class="lineNum">    6148 </span>            :             GRect r;
<span class="lineNum">    6149 </span><span class="lineNoCov">          0 :             r.x = 0; r.width = cv-&gt;rulerh; r.y = cv-&gt;infoh+cv-&gt;charselectorh+cv-&gt;mbh; r.height = cv-&gt;rulerh+cv-&gt;height;</span>
<span class="lineNum">    6150 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(cv-&gt;gw,&amp;r,false);</span>
<span class="lineNum">    6151 </span>            :         }
<span class="lineNum">    6152 </span>            :     }
<a name="6153"><span class="lineNum">    6153 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6154 </span>            : 
<span class="lineNum">    6155 </span><span class="lineNoCov">          0 : void LogoExpose(GWindow pixmap,GEvent *event, GRect *r,enum drawmode dm) {</span>
<span class="lineNum">    6156 </span><span class="lineNoCov">          0 :     int sbsize = GDrawPointsToPixels(pixmap,_GScrollBar_Width);</span>
<span class="lineNum">    6157 </span>            :     GRect old;
<span class="lineNum">    6158 </span>            : 
<span class="lineNum">    6159 </span><span class="lineNoCov">          0 :     r-&gt;width = r-&gt;height = sbsize;</span>
<span class="lineNum">    6160 </span><span class="lineNoCov">          0 :     if ( event-&gt;u.expose.rect.x+event-&gt;u.expose.rect.width &gt;= r-&gt;x &amp;&amp;</span>
<span class="lineNum">    6161 </span><span class="lineNoCov">          0 :             event-&gt;u.expose.rect.y+event-&gt;u.expose.rect.height &gt;= r-&gt;y ) {</span>
<span class="lineNum">    6162 </span>            :         /* Put something into the little box where the two scroll bars meet */
<span class="lineNum">    6163 </span>            :         int xoff, yoff;
<span class="lineNum">    6164 </span><span class="lineNoCov">          0 :         GImage *which = (dm==dm_fore) ? &amp;GIcon_FontForgeLogo :</span>
<span class="lineNum">    6165 </span><span class="lineNoCov">          0 :                         (dm==dm_back) ? &amp;GIcon_FontForgeBack :</span>
<span class="lineNum">    6166 </span>            :                             &amp;GIcon_FontForgeGuide;
<span class="lineNum">    6167 </span><span class="lineNoCov">          0 :         struct _GImage *base = which-&gt;u.image;</span>
<span class="lineNum">    6168 </span><span class="lineNoCov">          0 :         xoff = (sbsize-base-&gt;width);</span>
<span class="lineNum">    6169 </span><span class="lineNoCov">          0 :         yoff = (sbsize-base-&gt;height);</span>
<span class="lineNum">    6170 </span><span class="lineNoCov">          0 :         GDrawPushClip(pixmap,r,&amp;old);</span>
<span class="lineNum">    6171 </span><span class="lineNoCov">          0 :         GDrawDrawImage(pixmap,which,NULL,</span>
<span class="lineNum">    6172 </span><span class="lineNoCov">          0 :                 r-&gt;x+(xoff-xoff/2),r-&gt;y+(yoff-yoff/2));</span>
<span class="lineNum">    6173 </span><span class="lineNoCov">          0 :         GDrawPopClip(pixmap,&amp;old);</span>
<span class="lineNum">    6174 </span>            :         /*GDrawDrawLine(pixmap,r-&gt;x+sbsize-1,r-&gt;y,r-&gt;x+sbsize-1,r-&gt;y+sbsize,0x000000);*/
<span class="lineNum">    6175 </span>            :     }
<a name="6176"><span class="lineNum">    6176 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6177 </span>            : 
<span class="lineNum">    6178 </span><span class="lineNoCov">          0 : static void CVLogoExpose(CharView *cv,GWindow pixmap,GEvent *event) {</span>
<span class="lineNum">    6179 </span><span class="lineNoCov">          0 :     int rh = cv-&gt;showrulers ? cv-&gt;rulerh : 0;</span>
<span class="lineNum">    6180 </span>            :     GRect r;
<span class="lineNum">    6181 </span>            : 
<span class="lineNum">    6182 </span><span class="lineNoCov">          0 :     r.x = cv-&gt;width+rh;</span>
<span class="lineNum">    6183 </span><span class="lineNoCov">          0 :     r.y = cv-&gt;height+cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh+rh;</span>
<span class="lineNum">    6184 </span><span class="lineNoCov">          0 :     LogoExpose(pixmap,event,&amp;r,cv-&gt;b.drawmode==dm_grid? dm_grid :</span>
<span class="lineNum">    6185 </span><span class="lineNoCov">          0 :             cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;background ? dm_back : dm_fore );</span>
<a name="6186"><span class="lineNum">    6186 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6187 </span>            : 
<span class="lineNum">    6188 </span><span class="lineNoCov">          0 : static void CVDrawGuideLine(CharView *cv,int guide_pos) {</span>
<span class="lineNum">    6189 </span><span class="lineNoCov">          0 :     GWindow pixmap = cv-&gt;v;</span>
<span class="lineNum">    6190 </span>            : 
<span class="lineNum">    6191 </span><span class="lineNoCov">          0 :     if ( guide_pos&lt;0 )</span>
<span class="lineNum">    6192 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    6193 </span><span class="lineNoCov">          0 :     GDrawSetDashedLine(pixmap,2,2,0);</span>
<span class="lineNum">    6194 </span><span class="lineNoCov">          0 :     GDrawSetLineWidth(pixmap,0);</span>
<span class="lineNum">    6195 </span><span class="lineNoCov">          0 :     GDrawSetXORMode(pixmap);</span>
<span class="lineNum">    6196 </span><span class="lineNoCov">          0 :     GDrawSetXORBase(pixmap,GDrawGetDefaultBackground(NULL));</span>
<span class="lineNum">    6197 </span><span class="lineNoCov">          0 :     if ( cv-&gt;ruler_pressedv ) {</span>
<span class="lineNum">    6198 </span><span class="lineNoCov">          0 :         GDrawDrawLine(pixmap,guide_pos,0,guide_pos,cv-&gt;height,0x000000);</span>
<span class="lineNum">    6199 </span>            :     } else {
<span class="lineNum">    6200 </span><span class="lineNoCov">          0 :         GDrawDrawLine(pixmap,0,guide_pos,cv-&gt;width,guide_pos,0x000000);</span>
<span class="lineNum">    6201 </span>            :     }
<span class="lineNum">    6202 </span><span class="lineNoCov">          0 :     GDrawSetCopyMode(pixmap);</span>
<span class="lineNum">    6203 </span><span class="lineNoCov">          0 :     GDrawSetDashedLine(pixmap,0,0,0);</span>
<a name="6204"><span class="lineNum">    6204 </span>            : }</a>
<span class="lineNum">    6205 </span>            : 
<span class="lineNum">    6206 </span><span class="lineNoCov">          0 : static void CVAddGuide(CharView *cv,int is_v,int guide_pos) {</span>
<span class="lineNum">    6207 </span>            :     SplinePoint *sp1, *sp2;
<span class="lineNum">    6208 </span>            :     SplineSet *ss;
<span class="lineNum">    6209 </span><span class="lineNoCov">          0 :     SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">    6210 </span><span class="lineNoCov">          0 :     int emsize = sf-&gt;ascent+sf-&gt;descent;</span>
<span class="lineNum">    6211 </span>            : 
<span class="lineNum">    6212 </span><span class="lineNoCov">          0 :     if ( is_v ) {</span>
<span class="lineNum">    6213 </span>            :         /* Create a vertical guide line */
<span class="lineNum">    6214 </span><span class="lineNoCov">          0 :         double x = (guide_pos-cv-&gt;xoff)/cv-&gt;scale;</span>
<span class="lineNum">    6215 </span><span class="lineNoCov">          0 :         sp1 = SplinePointCreate(x,sf-&gt;ascent+emsize/2);</span>
<span class="lineNum">    6216 </span><span class="lineNoCov">          0 :         sp2 = SplinePointCreate(x,-sf-&gt;descent-emsize/2);</span>
<span class="lineNum">    6217 </span>            :     } else {
<span class="lineNum">    6218 </span><span class="lineNoCov">          0 :         double y = (cv-&gt;height-guide_pos-cv-&gt;yoff)/cv-&gt;scale;</span>
<span class="lineNum">    6219 </span><span class="lineNoCov">          0 :         sp1 = SplinePointCreate(-emsize,y);</span>
<span class="lineNum">    6220 </span><span class="lineNoCov">          0 :         sp2 = SplinePointCreate(2*emsize,y);</span>
<span class="lineNum">    6221 </span>            :     }
<span class="lineNum">    6222 </span><span class="lineNoCov">          0 :     SplineMake(sp1,sp2,sf-&gt;grid.order2);</span>
<span class="lineNum">    6223 </span><span class="lineNoCov">          0 :     ss = chunkalloc(sizeof(SplineSet));</span>
<span class="lineNum">    6224 </span><span class="lineNoCov">          0 :     ss-&gt;first = sp1; ss-&gt;last = sp2;</span>
<span class="lineNum">    6225 </span><span class="lineNoCov">          0 :     ss-&gt;next = sf-&gt;grid.splines;</span>
<span class="lineNum">    6226 </span><span class="lineNoCov">          0 :     sf-&gt;grid.splines = ss;</span>
<span class="lineNum">    6227 </span><span class="lineNoCov">          0 :     ss-&gt;contour_name = gwwv_ask_string(_(&quot;Name this contour&quot;),NULL,</span>
<span class="lineNum">    6228 </span><span class="lineNoCov">          0 :                 _(&quot;Name this guideline or cancel to create it without a name&quot;));</span>
<span class="lineNum">    6229 </span><span class="lineNoCov">          0 :     if ( ss-&gt;contour_name!=NULL &amp;&amp; *ss-&gt;contour_name=='\0' ) {</span>
<span class="lineNum">    6230 </span><span class="lineNoCov">          0 :         free(ss-&gt;contour_name);</span>
<span class="lineNum">    6231 </span><span class="lineNoCov">          0 :         ss-&gt;contour_name = NULL;</span>
<span class="lineNum">    6232 </span>            :     }
<span class="lineNum">    6233 </span>            : 
<span class="lineNum">    6234 </span><span class="lineNoCov">          0 :     FVRedrawAllCharViewsSF(sf);</span>
<span class="lineNum">    6235 </span><span class="lineNoCov">          0 :     if ( !sf-&gt;changed ) {</span>
<span class="lineNum">    6236 </span><span class="lineNoCov">          0 :         sf-&gt;changed = true;</span>
<span class="lineNum">    6237 </span><span class="lineNoCov">          0 :         FVSetTitles(sf);</span>
<span class="lineNum">    6238 </span>            :     }
<span class="lineNum">    6239 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    6240 </span>            : 
<a name="6241"><span class="lineNum">    6241 </span>            : static CharView* ActiveCharView = 0;</a>
<span class="lineNum">    6242 </span>            : 
<span class="lineNum">    6243 </span><span class="lineNoCov">          0 : static int cv_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    6244 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6245 </span>            : 
<span class="lineNum">    6246 </span><span class="lineNoCov">          0 :     if (( event-&gt;type==et_mouseup || event-&gt;type==et_mousedown ) &amp;&amp;</span>
<span class="lineNum">    6247 </span><span class="lineNoCov">          0 :             (event-&gt;u.mouse.button&gt;=4 &amp;&amp; event-&gt;u.mouse.button&lt;=7) ) {</span>
<span class="lineNum">    6248 </span><span class="lineNoCov">          0 :         int ish = event-&gt;u.mouse.button&gt;5;</span>
<span class="lineNum">    6249 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.mouse.state&amp;ksm_shift ) ish = !ish;</span>
<span class="lineNum">    6250 </span><span class="lineNoCov">          0 :         if ( ish ) /* bind shift to vertical scrolling */</span>
<span class="lineNum">    6251 </span><span class="lineNoCov">          0 : return( GGadgetDispatchEvent(cv-&gt;hsb,event));</span>
<span class="lineNum">    6252 </span>            :         else
<span class="lineNum">    6253 </span><span class="lineNoCov">          0 : return( GGadgetDispatchEvent(cv-&gt;vsb,event));</span>
<span class="lineNum">    6254 </span>            :     }
<span class="lineNum">    6255 </span>            : 
<span class="lineNum">    6256 </span><span class="lineNoCov">          0 :     switch ( event-&gt;type ) {</span>
<span class="lineNum">    6257 </span>            :       case et_selclear:
<span class="lineNum">    6258 </span><span class="lineNoCov">          0 :         ClipboardClear();</span>
<span class="lineNum">    6259 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6260 </span>            :       case et_expose:
<span class="lineNum">    6261 </span><span class="lineNoCov">          0 :         GDrawSetLineWidth(gw,0);</span>
<span class="lineNum">    6262 </span><span class="lineNoCov">          0 :         InfoExpose(cv,gw,event);</span>
<span class="lineNum">    6263 </span><span class="lineNoCov">          0 :         CVLogoExpose(cv,gw,event);</span>
<span class="lineNum">    6264 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6265 </span>            :       case et_char:
<span class="lineNum">    6266 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.container!=NULL )</span>
<span class="lineNum">    6267 </span><span class="lineNoCov">          0 :             (cv-&gt;b.container-&gt;funcs-&gt;charEvent)(cv-&gt;b.container,event);</span>
<span class="lineNum">    6268 </span>            :         else
<span class="lineNum">    6269 </span><span class="lineNoCov">          0 :             CVChar(cv,event);</span>
<span class="lineNum">    6270 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6271 </span>            :       case et_charup:
<span class="lineNum">    6272 </span><span class="lineNoCov">          0 :         CVCharUp(cv,event);</span>
<span class="lineNum">    6273 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6274 </span>            :       case et_resize:
<span class="lineNum">    6275 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.resize.sized )</span>
<span class="lineNum">    6276 </span><span class="lineNoCov">          0 :             CVResize(cv);</span>
<span class="lineNum">    6277 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6278 </span>            :       case et_controlevent:
<span class="lineNum">    6279 </span><span class="lineNoCov">          0 :         switch ( event-&gt;u.control.subtype ) {</span>
<span class="lineNum">    6280 </span>            :           case et_scrollbarchange:
<span class="lineNum">    6281 </span><span class="lineNoCov">          0 :             if ( event-&gt;u.control.g == cv-&gt;hsb )</span>
<span class="lineNum">    6282 </span><span class="lineNoCov">          0 :                 CVHScroll(cv,&amp;event-&gt;u.control.u.sb);</span>
<span class="lineNum">    6283 </span>            :             else
<span class="lineNum">    6284 </span><span class="lineNoCov">          0 :                 CVVScroll(cv,&amp;event-&gt;u.control.u.sb);</span>
<span class="lineNum">    6285 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    6286 </span>            :         }
<span class="lineNum">    6287 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6288 </span>            :       case et_map:
<span class="lineNum">    6289 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.map.is_visible )</span>
<span class="lineNum">    6290 </span><span class="lineNoCov">          0 :             CVPaletteActivate(cv);</span>
<span class="lineNum">    6291 </span>            :         else
<span class="lineNum">    6292 </span><span class="lineNoCov">          0 :             CVPalettesHideIfMine(cv);</span>
<span class="lineNum">    6293 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6294 </span>            :       case et_destroy:
<span class="lineNum">    6295 </span><span class="lineNoCov">          0 :         CVUnlinkView(cv);</span>
<span class="lineNum">    6296 </span><span class="lineNoCov">          0 :         CVPalettesHideIfMine(cv);</span>
<span class="lineNum">    6297 </span><span class="lineNoCov">          0 :         if ( cv-&gt;backimgs!=NULL ) {</span>
<span class="lineNum">    6298 </span><span class="lineNoCov">          0 :             GDrawDestroyWindow(cv-&gt;backimgs);</span>
<span class="lineNum">    6299 </span><span class="lineNoCov">          0 :             cv-&gt;backimgs = NULL;</span>
<span class="lineNum">    6300 </span>            :         }
<span class="lineNum">    6301 </span><span class="lineNoCov">          0 :         if ( cv-&gt;icon!=NULL ) {</span>
<span class="lineNum">    6302 </span><span class="lineNoCov">          0 :             GDrawDestroyWindow(cv-&gt;icon);</span>
<span class="lineNum">    6303 </span><span class="lineNoCov">          0 :             cv-&gt;icon = NULL;</span>
<span class="lineNum">    6304 </span>            :         }
<span class="lineNum">    6305 </span><span class="lineNoCov">          0 :         CharViewFree(cv);</span>
<span class="lineNum">    6306 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6307 </span>            :       case et_close:
<span class="lineNum">    6308 </span><span class="lineNoCov">          0 :           dlist_foreach( &amp;cv-&gt;pointInfoDialogs, PI_Destroy );</span>
<span class="lineNum">    6309 </span><span class="lineNoCov">          0 :           GDrawDestroyWindow(gw);</span>
<span class="lineNum">    6310 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6311 </span>            :       case et_mouseup: case et_mousedown:
<span class="lineNum">    6312 </span><span class="lineNoCov">          0 :         GGadgetEndPopup();</span>
<span class="lineNum">    6313 </span><span class="lineNoCov">          0 :         CVPaletteActivate(cv);</span>
<span class="lineNum">    6314 </span><span class="lineNoCov">          0 :         if ( cv-&gt;inactive )</span>
<span class="lineNum">    6315 </span><span class="lineNoCov">          0 :             (cv-&gt;b.container-&gt;funcs-&gt;activateMe)(cv-&gt;b.container,&amp;cv-&gt;b);</span>
<span class="lineNum">    6316 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showrulers ) {</span>
<span class="lineNum">    6317 </span><span class="lineNoCov">          0 :             int is_h = event-&gt;u.mouse.y&gt;cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh &amp;&amp; event-&gt;u.mouse.y&lt;cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh+cv-&gt;rulerh;</span>
<span class="lineNum">    6318 </span><span class="lineNoCov">          0 :             int is_v = event-&gt;u.mouse.x&lt;cv-&gt;rulerh;</span>
<span class="lineNum">    6319 </span><span class="lineNoCov">          0 :             if ( cv-&gt;gwgic!=NULL &amp;&amp; event-&gt;type==et_mousedown)</span>
<span class="lineNum">    6320 </span><span class="lineNoCov">          0 :                 GDrawSetGIC(gw,cv-&gt;gwgic,0,20);</span>
<span class="lineNum">    6321 </span><span class="lineNoCov">          0 :             if ( event-&gt;type == et_mousedown ) {</span>
<span class="lineNum">    6322 </span><span class="lineNoCov">          0 :                 if ( is_h &amp;&amp; is_v )</span>
<span class="lineNum">    6323 </span>            :                     /* Ambiguous, ignore */;
<span class="lineNum">    6324 </span><span class="lineNoCov">          0 :                 else if ( is_h ) {</span>
<span class="lineNum">    6325 </span><span class="lineNoCov">          0 :                     cv-&gt;ruler_pressed = true;</span>
<span class="lineNum">    6326 </span><span class="lineNoCov">          0 :                     cv-&gt;ruler_pressedv = false;</span>
<span class="lineNum">    6327 </span><span class="lineNoCov">          0 :                     GDrawSetCursor(cv-&gt;v,ct_updown);</span>
<span class="lineNum">    6328 </span><span class="lineNoCov">          0 :                     GDrawSetCursor(cv-&gt;gw,ct_updown);</span>
<span class="lineNum">    6329 </span><span class="lineNoCov">          0 :                 } else if ( is_v ) {</span>
<span class="lineNum">    6330 </span><span class="lineNoCov">          0 :                     cv-&gt;ruler_pressed = true;</span>
<span class="lineNum">    6331 </span><span class="lineNoCov">          0 :                     cv-&gt;ruler_pressedv = true;</span>
<span class="lineNum">    6332 </span><span class="lineNoCov">          0 :                     GDrawSetCursor(cv-&gt;v,ct_leftright);</span>
<span class="lineNum">    6333 </span><span class="lineNoCov">          0 :                     GDrawSetCursor(cv-&gt;gw,ct_leftright);</span>
<span class="lineNum">    6334 </span>            :                 }
<span class="lineNum">    6335 </span><span class="lineNoCov">          0 :                 cv-&gt;guide_pos = -1;</span>
<span class="lineNum">    6336 </span><span class="lineNoCov">          0 :             } else if ( event-&gt;type==et_mouseup &amp;&amp; cv-&gt;ruler_pressed ) {</span>
<span class="lineNum">    6337 </span><span class="lineNoCov">          0 :                 CVDrawGuideLine(cv,cv-&gt;guide_pos);</span>
<span class="lineNum">    6338 </span><span class="lineNoCov">          0 :                 cv-&gt;guide_pos = -1;</span>
<span class="lineNum">    6339 </span><span class="lineNoCov">          0 :                 cv-&gt;showing_tool = cvt_none;</span>
<span class="lineNum">    6340 </span><span class="lineNoCov">          0 :                 CVToolsSetCursor(cv,event-&gt;u.mouse.state&amp;~(1&lt;&lt;(7+event-&gt;u.mouse.button)),event-&gt;u.mouse.device);             /* X still has the buttons set in the state, even though we just released them. I don't want em */</span>
<span class="lineNum">    6341 </span><span class="lineNoCov">          0 :                 GDrawSetCursor(cv-&gt;gw,ct_mypointer);</span>
<span class="lineNum">    6342 </span><span class="lineNoCov">          0 :                 cv-&gt;ruler_pressed = false;</span>
<span class="lineNum">    6343 </span><span class="lineNoCov">          0 :                 if ( is_h || is_v )</span>
<span class="lineNum">    6344 </span>            :                     /* Do Nothing */;
<span class="lineNum">    6345 </span><span class="lineNoCov">          0 :                 else if ( cv-&gt;ruler_pressedv )</span>
<span class="lineNum">    6346 </span><span class="lineNoCov">          0 :                     CVAddGuide(cv,true,event-&gt;u.mouse.x-cv-&gt;rulerh);</span>
<span class="lineNum">    6347 </span>            :                 else
<span class="lineNum">    6348 </span><span class="lineNoCov">          0 :                     CVAddGuide(cv,false,event-&gt;u.mouse.y-(cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh+cv-&gt;rulerh));</span>
<span class="lineNum">    6349 </span>            :             }
<span class="lineNum">    6350 </span>            :         }
<span class="lineNum">    6351 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6352 </span>            :       case et_mousemove:
<span class="lineNum">    6353 </span><span class="lineNoCov">          0 :         if ( cv-&gt;ruler_pressed ) {</span>
<span class="lineNum">    6354 </span><span class="lineNoCov">          0 :             CVDrawGuideLine(cv,cv-&gt;guide_pos);</span>
<span class="lineNum">    6355 </span><span class="lineNoCov">          0 :             cv-&gt;e.x = event-&gt;u.mouse.x - cv-&gt;rulerh;</span>
<span class="lineNum">    6356 </span><span class="lineNoCov">          0 :             cv-&gt;e.y = event-&gt;u.mouse.y-(cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh+cv-&gt;rulerh);</span>
<span class="lineNum">    6357 </span><span class="lineNoCov">          0 :             cv-&gt;info.x = (cv-&gt;e.x-cv-&gt;xoff)/cv-&gt;scale;</span>
<span class="lineNum">    6358 </span><span class="lineNoCov">          0 :             cv-&gt;info.y = (cv-&gt;height-cv-&gt;e.y-cv-&gt;yoff)/cv-&gt;scale;</span>
<span class="lineNum">    6359 </span><span class="lineNoCov">          0 :             if ( cv-&gt;ruler_pressedv )</span>
<span class="lineNum">    6360 </span><span class="lineNoCov">          0 :                 cv-&gt;guide_pos = cv-&gt;e.x;</span>
<span class="lineNum">    6361 </span>            :             else
<span class="lineNum">    6362 </span><span class="lineNoCov">          0 :                 cv-&gt;guide_pos = cv-&gt;e.y;</span>
<span class="lineNum">    6363 </span><span class="lineNoCov">          0 :             CVDrawGuideLine(cv,cv-&gt;guide_pos);</span>
<span class="lineNum">    6364 </span><span class="lineNoCov">          0 :             CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    6365 </span>            :         }
<span class="lineNum">    6366 </span><span class="lineNoCov">          0 :     else if ( event-&gt;u.mouse.y &gt; cv-&gt;mbh )</span>
<span class="lineNum">    6367 </span>            :     {
<span class="lineNum">    6368 </span><span class="lineNoCov">          0 :         if( GGadgetContainsEventLocation( cv-&gt;charselectorPrev, event ))</span>
<span class="lineNum">    6369 </span>            :         {
<span class="lineNum">    6370 </span><span class="lineNoCov">          0 :             GGadgetPreparePopup(cv-&gt;gw,c_to_u(&quot;Show the previous word in the current word list\n&quot;</span>
<span class="lineNum">    6371 </span>            :                                               &quot;Select the menu File / Load Word List... to load a wordlist.&quot;));
<span class="lineNum">    6372 </span>            :         }
<span class="lineNum">    6373 </span><span class="lineNoCov">          0 :         else if( GGadgetContainsEventLocation( cv-&gt;charselectorNext, event ))</span>
<span class="lineNum">    6374 </span>            :         {
<span class="lineNum">    6375 </span><span class="lineNoCov">          0 :             GGadgetPreparePopup(cv-&gt;gw,c_to_u(&quot;Show the next word in the current word list\n&quot;</span>
<span class="lineNum">    6376 </span>            :                                               &quot;Select the menu File / Load Word List... to load a wordlist.&quot;));
<span class="lineNum">    6377 </span>            :         }
<span class="lineNum">    6378 </span><span class="lineNoCov">          0 :         else if( GGadgetContainsEventLocation( cv-&gt;charselector, event ))</span>
<span class="lineNum">    6379 </span>            :         {
<span class="lineNum">    6380 </span><span class="lineNoCov">          0 :             GGadgetPreparePopup(cv-&gt;gw,c_to_u(&quot;This is a word list that you can step through to quickly see your glyphs in context\n&quot;</span>
<span class="lineNum">    6381 </span>            :                                               &quot;Select the menu File / Load Word List... to load a wordlist.&quot;));
<span class="lineNum">    6382 </span>            :         }
<span class="lineNum">    6383 </span>            :         else
<span class="lineNum">    6384 </span>            :         {
<span class="lineNum">    6385 </span><span class="lineNoCov">          0 :             int enc = CVCurEnc(cv);</span>
<span class="lineNum">    6386 </span><span class="lineNoCov">          0 :             SCPreparePopup(cv-&gt;gw,cv-&gt;b.sc,cv-&gt;b.fv-&gt;map-&gt;remap,enc,</span>
<span class="lineNum">    6387 </span><span class="lineNoCov">          0 :                            UniFromEnc(enc,cv-&gt;b.fv-&gt;map-&gt;enc));</span>
<span class="lineNum">    6388 </span>            :         }
<span class="lineNum">    6389 </span>            :     }
<span class="lineNum">    6390 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6391 </span>            :       case et_drop:
<span class="lineNum">    6392 </span><span class="lineNoCov">          0 :         CVDrop(cv,event);</span>
<span class="lineNum">    6393 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6394 </span>            :       case et_focus:
<span class="lineNum">    6395 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.focus.gained_focus ) {</span>
<span class="lineNum">    6396 </span><span class="lineNoCov">          0 :             ActiveCharView = cv;</span>
<span class="lineNum">    6397 </span><span class="lineNoCov">          0 :             if ( cv-&gt;gic!=NULL )</span>
<span class="lineNum">    6398 </span><span class="lineNoCov">          0 :                 GDrawSetGIC(gw,cv-&gt;gic,0,20);</span>
<span class="lineNum">    6399 </span>            :         }
<span class="lineNum">    6400 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6401 </span>            :     }
<span class="lineNum">    6402 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="6403"><span class="lineNum">    6403 </span>            : }</a>
<span class="lineNum">    6404 </span>            : 
<span class="lineNum">    6405 </span><span class="lineNoCov">          0 : CharView* CharViewFindActive()</span>
<span class="lineNum">    6406 </span>            : {
<span class="lineNum">    6407 </span><span class="lineNoCov">          0 :     return ActiveCharView;</span>
<span class="lineNum">    6408 </span>            : }
<span class="lineNum">    6409 </span>            : 
<span class="lineNum">    6410 </span>            : 
<span class="lineNum">    6411 </span>            : #define MID_Fit         2001
<span class="lineNum">    6412 </span>            : #define MID_ZoomIn      2002
<span class="lineNum">    6413 </span>            : #define MID_ZoomOut     2003
<span class="lineNum">    6414 </span>            : #define MID_HidePoints  2004
<span class="lineNum">    6415 </span>            : #define MID_HideControlPoints   2005
<span class="lineNum">    6416 </span>            : #define MID_Fill        2006
<span class="lineNum">    6417 </span>            : #define MID_Next        2007
<span class="lineNum">    6418 </span>            : #define MID_Prev        2008
<span class="lineNum">    6419 </span>            : #define MID_HideRulers  2009
<span class="lineNum">    6420 </span>            : #define MID_Preview     2010
<span class="lineNum">    6421 </span>            : #define MID_DraggingComparisonOutline 2011
<span class="lineNum">    6422 </span>            : #define MID_NextDef     2012
<span class="lineNum">    6423 </span>            : #define MID_PrevDef     2013
<span class="lineNum">    6424 </span>            : #define MID_DisplayCompositions 2014
<span class="lineNum">    6425 </span>            : #define MID_MarkExtrema 2015
<span class="lineNum">    6426 </span>            : #define MID_Goto        2016
<span class="lineNum">    6427 </span>            : #define MID_FindInFontView      2017
<span class="lineNum">    6428 </span>            : #define MID_KernPairs   2018
<span class="lineNum">    6429 </span>            : #define MID_AnchorPairs 2019
<span class="lineNum">    6430 </span>            : #define MID_ShowGridFit 2020
<span class="lineNum">    6431 </span>            : #define MID_PtsNone     2021
<span class="lineNum">    6432 </span>            : #define MID_PtsTrue     2022
<span class="lineNum">    6433 </span>            : #define MID_PtsPost     2023
<span class="lineNum">    6434 </span>            : #define MID_PtsSVG      2024
<span class="lineNum">    6435 </span>            : #define MID_Ligatures   2025
<span class="lineNum">    6436 </span>            : #define MID_Former      2026
<span class="lineNum">    6437 </span>            : #define MID_MarkPointsOfInflection      2027
<span class="lineNum">    6438 </span>            : #define MID_ShowCPInfo  2028
<span class="lineNum">    6439 </span>            : #define MID_ShowTabs    2029
<span class="lineNum">    6440 </span>            : #define MID_AnchorGlyph 2030
<span class="lineNum">    6441 </span>            : #define MID_AnchorControl 2031
<span class="lineNum">    6442 </span>            : #define MID_ShowSideBearings    2032
<span class="lineNum">    6443 </span>            : #define MID_Bigger      2033
<span class="lineNum">    6444 </span>            : #define MID_Smaller     2034
<span class="lineNum">    6445 </span>            : #define MID_GridFitAA   2035
<span class="lineNum">    6446 </span>            : #define MID_GridFitOff  2036
<span class="lineNum">    6447 </span>            : #define MID_ShowHHints  2037
<span class="lineNum">    6448 </span>            : #define MID_ShowVHints  2038
<span class="lineNum">    6449 </span>            : #define MID_ShowDHints  2039
<span class="lineNum">    6450 </span>            : #define MID_ShowBlueValues      2040
<span class="lineNum">    6451 </span>            : #define MID_ShowFamilyBlues     2041
<span class="lineNum">    6452 </span>            : #define MID_ShowAnchors         2042
<span class="lineNum">    6453 </span>            : #define MID_ShowHMetrics        2043
<span class="lineNum">    6454 </span>            : #define MID_ShowVMetrics        2044
<span class="lineNum">    6455 </span>            : #define MID_ShowRefNames        2045
<span class="lineNum">    6456 </span>            : #define MID_ShowAlmostHV        2046
<span class="lineNum">    6457 </span>            : #define MID_ShowAlmostHVCurves  2047
<span class="lineNum">    6458 </span>            : #define MID_DefineAlmost        2048
<span class="lineNum">    6459 </span>            : #define MID_SnapOutlines        2049
<span class="lineNum">    6460 </span>            : #define MID_ShowDebugChanges    2050
<span class="lineNum">    6461 </span>            : #define MID_Cut         2101
<span class="lineNum">    6462 </span>            : #define MID_Copy        2102
<span class="lineNum">    6463 </span>            : #define MID_Paste       2103
<span class="lineNum">    6464 </span>            : #define MID_Clear       2104
<span class="lineNum">    6465 </span>            : #define MID_Merge       2105
<span class="lineNum">    6466 </span>            : #define MID_SelAll      2106
<span class="lineNum">    6467 </span>            : #define MID_CopyRef     2107
<span class="lineNum">    6468 </span>            : #define MID_UnlinkRef   2108
<span class="lineNum">    6469 </span>            : #define MID_Undo        2109
<span class="lineNum">    6470 </span>            : #define MID_Redo        2110
<span class="lineNum">    6471 </span>            : #define MID_CopyWidth   2111
<span class="lineNum">    6472 </span>            : #define MID_RemoveUndoes        2112
<span class="lineNum">    6473 </span>            : #define MID_CopyFgToBg  2115
<span class="lineNum">    6474 </span>            : #define MID_NextPt      2116
<span class="lineNum">    6475 </span>            : #define MID_PrevPt      2117
<span class="lineNum">    6476 </span>            : #define MID_FirstPt     2118
<span class="lineNum">    6477 </span>            : #define MID_NextCP      2119
<span class="lineNum">    6478 </span>            : #define MID_PrevCP      2120
<span class="lineNum">    6479 </span>            : #define MID_SelNone     2121
<span class="lineNum">    6480 </span>            : #define MID_SelectWidth 2122
<span class="lineNum">    6481 </span>            : #define MID_SelectVWidth        2123
<span class="lineNum">    6482 </span>            : #define MID_CopyLBearing        2124
<span class="lineNum">    6483 </span>            : #define MID_CopyRBearing        2125
<span class="lineNum">    6484 </span>            : #define MID_CopyVWidth  2126
<span class="lineNum">    6485 </span>            : #define MID_Join        2127
<span class="lineNum">    6486 </span>            : #define MID_CopyGridFit 2128
<span class="lineNum">    6487 </span>            : /*#define MID_Elide     2129*/
<span class="lineNum">    6488 </span>            : #define MID_SelectAllPoints     2130
<span class="lineNum">    6489 </span>            : #define MID_SelectAnchors       2131
<span class="lineNum">    6490 </span>            : #define MID_FirstPtNextCont     2132
<span class="lineNum">    6491 </span>            : #define MID_Contours    2133
<span class="lineNum">    6492 </span>            : #define MID_SelectHM    2134
<span class="lineNum">    6493 </span>            : #define MID_SelInvert   2136
<span class="lineNum">    6494 </span>            : #define MID_CopyBgToFg  2137
<span class="lineNum">    6495 </span>            : #define MID_SelPointAt  2138
<span class="lineNum">    6496 </span>            : #define MID_CopyLookupData      2139
<span class="lineNum">    6497 </span>            : #define MID_SelectOpenContours  2140
<span class="lineNum">    6498 </span>            : #define MID_MergeToLine 2141
<span class="lineNum">    6499 </span>            : #define MID_Clockwise   2201
<span class="lineNum">    6500 </span>            : #define MID_Counter     2202
<span class="lineNum">    6501 </span>            : #define MID_GetInfo     2203
<span class="lineNum">    6502 </span>            : #define MID_Correct     2204
<span class="lineNum">    6503 </span>            : #define MID_AvailBitmaps        2210
<span class="lineNum">    6504 </span>            : #define MID_RegenBitmaps        2211
<span class="lineNum">    6505 </span>            : #define MID_Stroke      2205
<span class="lineNum">    6506 </span>            : #define MID_RmOverlap   2206
<span class="lineNum">    6507 </span>            : #define MID_Simplify    2207
<span class="lineNum">    6508 </span>            : #define MID_BuildAccent 2208
<span class="lineNum">    6509 </span>            : #define MID_Autotrace   2212
<span class="lineNum">    6510 </span>            : #define MID_Round       2213
<span class="lineNum">    6511 </span>            : #define MID_Embolden    2217
<span class="lineNum">    6512 </span>            : #define MID_Condense    2218
<span class="lineNum">    6513 </span>            : #define MID_Average     2219
<span class="lineNum">    6514 </span>            : #define MID_SpacePts    2220
<span class="lineNum">    6515 </span>            : #define MID_SpaceRegion 2221
<span class="lineNum">    6516 </span>            : #define MID_MakeParallel        2222
<span class="lineNum">    6517 </span>            : #define MID_ShowDependentRefs   2223
<span class="lineNum">    6518 </span>            : #define MID_AddExtrema  2224
<span class="lineNum">    6519 </span>            : #define MID_CleanupGlyph        2225
<span class="lineNum">    6520 </span>            : #define MID_TilePath    2226
<span class="lineNum">    6521 </span>            : #define MID_BuildComposite      2227
<span class="lineNum">    6522 </span>            : #define MID_Exclude     2228
<span class="lineNum">    6523 </span>            : #define MID_Intersection        2229
<span class="lineNum">    6524 </span>            : #define MID_FindInter   2230
<span class="lineNum">    6525 </span>            : #define MID_Styles      2231
<span class="lineNum">    6526 </span>            : #define MID_SimplifyMore        2232
<span class="lineNum">    6527 </span>            : #define MID_First       2233
<span class="lineNum">    6528 </span>            : #define MID_Earlier     2234
<span class="lineNum">    6529 </span>            : #define MID_Later       2235
<span class="lineNum">    6530 </span>            : #define MID_Last        2236
<span class="lineNum">    6531 </span>            : #define MID_CharInfo    2240
<span class="lineNum">    6532 </span>            : #define MID_ShowDependentSubs   2241
<span class="lineNum">    6533 </span>            : #define MID_CanonicalStart      2242
<span class="lineNum">    6534 </span>            : #define MID_CanonicalContours   2243
<span class="lineNum">    6535 </span>            : #define MID_RemoveBitmaps       2244
<span class="lineNum">    6536 </span>            : #define MID_RoundToCluster      2245
<span class="lineNum">    6537 </span>            : #define MID_Align               2246
<span class="lineNum">    6538 </span>            : #define MID_FontInfo            2247
<span class="lineNum">    6539 </span>            : #define MID_FindProblems        2248
<span class="lineNum">    6540 </span>            : #define MID_InsertText          2249
<span class="lineNum">    6541 </span>            : #define MID_Italic              2250
<span class="lineNum">    6542 </span>            : #define MID_ChangeXHeight       2251
<span class="lineNum">    6543 </span>            : #define MID_ChangeGlyph         2252
<span class="lineNum">    6544 </span>            : #define MID_CheckSelf           2253
<span class="lineNum">    6545 </span>            : #define MID_GlyphSelfIntersects 2254
<span class="lineNum">    6546 </span>            : #define MID_ReverseDir          2255
<span class="lineNum">    6547 </span>            : #define MID_Corner      2301
<span class="lineNum">    6548 </span>            : #define MID_Tangent     2302
<span class="lineNum">    6549 </span>            : #define MID_Curve       2303
<span class="lineNum">    6550 </span>            : #define MID_MakeFirst   2304
<span class="lineNum">    6551 </span>            : #define MID_MakeLine    2305
<span class="lineNum">    6552 </span>            : #define MID_CenterCP    2306
<span class="lineNum">    6553 </span>            : #define MID_ImplicitPt  2307
<span class="lineNum">    6554 </span>            : #define MID_NoImplicitPt        2308
<span class="lineNum">    6555 </span>            : #define MID_InsertPtOnSplineAt  2309
<span class="lineNum">    6556 </span>            : #define MID_AddAnchor   2310
<span class="lineNum">    6557 </span>            : #define MID_HVCurve     2311
<span class="lineNum">    6558 </span>            : #define MID_SpiroG4     2312
<span class="lineNum">    6559 </span>            : #define MID_SpiroG2     2313
<span class="lineNum">    6560 </span>            : #define MID_SpiroCorner 2314
<span class="lineNum">    6561 </span>            : #define MID_SpiroLeft   2315
<span class="lineNum">    6562 </span>            : #define MID_SpiroRight  2316
<span class="lineNum">    6563 </span>            : #define MID_SpiroMakeFirst 2317
<span class="lineNum">    6564 </span>            : #define MID_NamePoint   2318
<span class="lineNum">    6565 </span>            : #define MID_NameContour 2319
<span class="lineNum">    6566 </span>            : #define MID_AcceptableExtrema 2320
<span class="lineNum">    6567 </span>            : #define MID_MakeArc     2321
<span class="lineNum">    6568 </span>            : #define MID_ClipPath    2322
<span class="lineNum">    6569 </span>            : 
<span class="lineNum">    6570 </span>            : #define MID_AutoHint    2400
<span class="lineNum">    6571 </span>            : #define MID_ClearHStem  2401
<span class="lineNum">    6572 </span>            : #define MID_ClearVStem  2402
<span class="lineNum">    6573 </span>            : #define MID_ClearDStem  2403
<span class="lineNum">    6574 </span>            : #define MID_AddHHint    2404
<span class="lineNum">    6575 </span>            : #define MID_AddVHint    2405
<span class="lineNum">    6576 </span>            : #define MID_AddDHint    2406
<span class="lineNum">    6577 </span>            : #define MID_ReviewHints 2407
<span class="lineNum">    6578 </span>            : #define MID_CreateHHint 2408
<span class="lineNum">    6579 </span>            : #define MID_CreateVHint 2409
<span class="lineNum">    6580 </span>            : #define MID_MinimumDistance     2410
<span class="lineNum">    6581 </span>            : #define MID_AutoInstr   2411
<span class="lineNum">    6582 </span>            : #define MID_ClearInstr  2412
<span class="lineNum">    6583 </span>            : #define MID_EditInstructions 2413
<span class="lineNum">    6584 </span>            : #define MID_Debug       2414
<span class="lineNum">    6585 </span>            : #define MID_HintSubsPt  2415
<span class="lineNum">    6586 </span>            : #define MID_AutoCounter 2416
<span class="lineNum">    6587 </span>            : #define MID_DontAutoHint        2417
<span class="lineNum">    6588 </span>            : #define MID_Deltas      2418
<span class="lineNum">    6589 </span>            : #define MID_Tools       2501
<span class="lineNum">    6590 </span>            : #define MID_Layers      2502
<span class="lineNum">    6591 </span>            : #define MID_DockPalettes        2503
<span class="lineNum">    6592 </span>            : #define MID_Center      2600
<span class="lineNum">    6593 </span>            : #define MID_SetWidth    2601
<span class="lineNum">    6594 </span>            : #define MID_SetLBearing 2602
<span class="lineNum">    6595 </span>            : #define MID_SetRBearing 2603
<span class="lineNum">    6596 </span>            : #define MID_Thirds      2604
<span class="lineNum">    6597 </span>            : #define MID_RemoveKerns 2605
<span class="lineNum">    6598 </span>            : #define MID_SetVWidth   2606
<span class="lineNum">    6599 </span>            : #define MID_RemoveVKerns        2607
<span class="lineNum">    6600 </span>            : #define MID_KPCloseup   2608
<span class="lineNum">    6601 </span>            : #define MID_AnchorsAway 2609
<span class="lineNum">    6602 </span>            : #define MID_SetBearings 2610
<span class="lineNum">    6603 </span>            : #define MID_OpenBitmap  2700
<span class="lineNum">    6604 </span>            : #define MID_Revert      2702
<span class="lineNum">    6605 </span>            : #define MID_Recent      2703
<span class="lineNum">    6606 </span>            : #define MID_RevertGlyph 2707
<span class="lineNum">    6607 </span>            : #define MID_Open        2708
<span class="lineNum">    6608 </span>            : #define MID_New         2709
<span class="lineNum">    6609 </span>            : #define MID_Close       2710
<span class="lineNum">    6610 </span>            : #define MID_Quit        2711
<span class="lineNum">    6611 </span>            : #define MID_CloseTab    2712
<span class="lineNum">    6612 </span>            : #define MID_GenerateTTC 2713
<span class="lineNum">    6613 </span>            : #define MID_VKernClass  2715
<span class="lineNum">    6614 </span>            : #define MID_VKernFromHKern 2716
<span class="lineNum">    6615 </span>            : 
<span class="lineNum">    6616 </span>            : #define MID_ShowGridFitLiveUpdate 2720
<span class="lineNum">    6617 </span>            : 
<span class="lineNum">    6618 </span>            : #define MID_MMReblend   2800
<span class="lineNum">    6619 </span>            : #define MID_MMAll       2821
<span class="lineNum">    6620 </span>            : #define MID_MMNone      2822
<span class="lineNum">    6621 </span>            : 
<span class="lineNum">    6622 </span>            : #define MID_PtsPos      2823
<span class="lineNum">    6623 </span>            : 
<a name="6624"><span class="lineNum">    6624 </span>            : #define MID_Warnings    3000</a>
<span class="lineNum">    6625 </span>            : 
<span class="lineNum">    6626 </span><span class="lineNoCov">          0 : static void CVMenuClose(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6627 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6628 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.container )</span>
<span class="lineNum">    6629 </span><span class="lineNoCov">          0 :         (cv-&gt;b.container-&gt;funcs-&gt;doClose)(cv-&gt;b.container);</span>
<span class="lineNum">    6630 </span>            :     else
<span class="lineNum">    6631 </span><span class="lineNoCov">          0 :         GDrawDestroyWindow(gw);</span>
<a name="6632"><span class="lineNum">    6632 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6633 </span>            : 
<span class="lineNum">    6634 </span><span class="lineNoCov">          0 : static void CVMenuCloseTab(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6635 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6636 </span>            :     int pos, i;
<span class="lineNum">    6637 </span>            : 
<span class="lineNum">    6638 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.container || cv-&gt;tabs==NULL || cv-&gt;former_cnt&lt;=1 )</span>
<span class="lineNum">    6639 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    6640 </span><span class="lineNoCov">          0 :     pos = GTabSetGetSel(cv-&gt;tabs);</span>
<span class="lineNum">    6641 </span><span class="lineNoCov">          0 :     free(cv-&gt;former_names[pos]);</span>
<span class="lineNum">    6642 </span><span class="lineNoCov">          0 :     for ( i=pos+1; i&lt;cv-&gt;former_cnt; ++i )</span>
<span class="lineNum">    6643 </span><span class="lineNoCov">          0 :         cv-&gt;former_names[i-1] = cv-&gt;former_names[i];</span>
<span class="lineNum">    6644 </span><span class="lineNoCov">          0 :     --cv-&gt;former_cnt;</span>
<span class="lineNum">    6645 </span><span class="lineNoCov">          0 :     GTabSetRemoveTabByPos(cv-&gt;tabs,pos);     /* This should send an event that the selection has changed */</span>
<span class="lineNum">    6646 </span><span class="lineNoCov">          0 :     GTabSetRemetric(cv-&gt;tabs);</span>
<a name="6647"><span class="lineNum">    6647 </span>            : }</a>
<span class="lineNum">    6648 </span>            : 
<span class="lineNum">    6649 </span><span class="lineNoCov">          0 : static void CVMenuOpen(GWindow gw, struct gmenuitem *mi, GEvent *g) {</span>
<span class="lineNum">    6650 </span><span class="lineNoCov">          0 :     CharView *d = (CharView*)GDrawGetUserData(gw);</span>
<span class="lineNum">    6651 </span><span class="lineNoCov">          0 :     FontView *fv = NULL;</span>
<span class="lineNum">    6652 </span><span class="lineNoCov">          0 :     if (d) {</span>
<span class="lineNum">    6653 </span><span class="lineNoCov">          0 :         fv = (FontView*)d-&gt;b.fv;</span>
<span class="lineNum">    6654 </span>            :     }
<span class="lineNum">    6655 </span><span class="lineNoCov">          0 :     _FVMenuOpen(fv);</span>
<a name="6656"><span class="lineNum">    6656 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6657 </span>            : 
<span class="lineNum">    6658 </span><span class="lineNoCov">          0 : static void CVMenuOpenBitmap(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6659 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6660 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.fv-&gt;sf-&gt;bitmaps==NULL )</span>
<span class="lineNum">    6661 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    6662 </span><span class="lineNoCov">          0 :     BitmapViewCreatePick(CVCurEnc(cv),(FontView *) (cv-&gt;b.fv));</span>
<a name="6663"><span class="lineNum">    6663 </span>            : }</a>
<span class="lineNum">    6664 </span>            : 
<span class="lineNum">    6665 </span><span class="lineNoCov">          0 : static void CVMenuOpenMetrics(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6666 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6667 </span><span class="lineNoCov">          0 :     MetricsViewCreate((FontView *) (cv-&gt;b.fv),cv-&gt;b.sc,NULL);</span>
<a name="6668"><span class="lineNum">    6668 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6669 </span>            : 
<span class="lineNum">    6670 </span><span class="lineNoCov">          0 : static void CVMenuSave(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6671 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6672 </span><span class="lineNoCov">          0 :     _FVMenuSave((FontView *) (cv-&gt;b.fv));</span>
<a name="6673"><span class="lineNum">    6673 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6674 </span>            : 
<span class="lineNum">    6675 </span><span class="lineNoCov">          0 : static void CVMenuSaveAs(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6676 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6677 </span><span class="lineNoCov">          0 :     _FVMenuSaveAs((FontView *) (cv-&gt;b.fv));</span>
<a name="6678"><span class="lineNum">    6678 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6679 </span>            : 
<span class="lineNum">    6680 </span><span class="lineNoCov">          0 : static void CVMenuGenerate(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6681 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6682 </span><span class="lineNoCov">          0 :     FontViewBase *fv = cv-&gt;b.fv;</span>
<span class="lineNum">    6683 </span><span class="lineNoCov">          0 :     SFGenerateFont(cv-&gt;b.sc-&gt;parent,CVLayer((CharViewBase *) cv),false,fv-&gt;normal==NULL?fv-&gt;map:fv-&gt;normal);</span>
<a name="6684"><span class="lineNum">    6684 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6685 </span>            : 
<span class="lineNum">    6686 </span><span class="lineNoCov">          0 : static void CVMenuGenerateFamily(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6687 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6688 </span><span class="lineNoCov">          0 :     _FVMenuGenerate((FontView *) (cv-&gt;b.fv),gf_macfamily);</span>
<a name="6689"><span class="lineNum">    6689 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6690 </span>            : 
<span class="lineNum">    6691 </span><span class="lineNoCov">          0 : static void CVMenuGenerateTTC(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6692 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6693 </span><span class="lineNoCov">          0 :     _FVMenuGenerate((FontView *) (cv-&gt;b.fv),gf_ttc);</span>
<a name="6694"><span class="lineNum">    6694 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6695 </span>            : 
<span class="lineNum">    6696 </span><span class="lineNoCov">          0 : static void CVMenuExport(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6697 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6698 </span><span class="lineNoCov">          0 :     CVExport(cv);</span>
<a name="6699"><span class="lineNum">    6699 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6700 </span>            : 
<span class="lineNum">    6701 </span><span class="lineNoCov">          0 : static void CVInkscapeAdjust(CharView *cv) {</span>
<span class="lineNum">    6702 </span>            :     /* Inkscape considers different coordinates useful. That is to say, */
<span class="lineNum">    6703 </span>            :     /*  Inkscape views the world as a blank sheet of paper and often */
<span class="lineNum">    6704 </span>            :     /*  put things outside the [0,1000] range (especially in Y) that */
<span class="lineNum">    6705 </span>            :     /*  FF uses. So after doing a Paste, or Import or something similar */
<span class="lineNum">    6706 </span>            :     /*  check and see if the image is completely out of view, and if so */
<span class="lineNum">    6707 </span>            :     /*  then adjust the view field */
<span class="lineNum">    6708 </span>            :     DBounds b;
<span class="lineNum">    6709 </span><span class="lineNoCov">          0 :     int layer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    6710 </span>            : 
<span class="lineNum">    6711 </span><span class="lineNoCov">          0 :     if (layer != ly_grid) SplineCharLayerQuickBounds(cv-&gt;b.sc,layer,&amp;b);</span>
<span class="lineNum">    6712 </span>            :     else {
<span class="lineNum">    6713 </span><span class="lineNoCov">          0 :         b.minx = b.miny = 1e10;</span>
<span class="lineNum">    6714 </span><span class="lineNoCov">          0 :         b.maxx = b.maxy = -1e10;</span>
<span class="lineNum">    6715 </span><span class="lineNoCov">          0 :         SplineSetQuickBounds(cv-&gt;b.sc-&gt;parent-&gt;grid.splines,&amp;b);</span>
<span class="lineNum">    6716 </span>            :     }
<span class="lineNum">    6717 </span>            : 
<span class="lineNum">    6718 </span><span class="lineNoCov">          0 :     b.minx *= cv-&gt;scale; b.maxx *= cv-&gt;scale;</span>
<span class="lineNum">    6719 </span><span class="lineNoCov">          0 :     b.miny *= cv-&gt;scale; b.maxy *= cv-&gt;scale;</span>
<span class="lineNum">    6720 </span>            : 
<span class="lineNum">    6721 </span><span class="lineNoCov">          0 :     if ( b.minx + cv-&gt;xoff &lt; 0 || b.miny + cv-&gt;yoff &lt; 0 ||</span>
<span class="lineNum">    6722 </span><span class="lineNoCov">          0 :             b.maxx + cv-&gt;xoff &gt; cv-&gt;width || b.maxy + cv-&gt;yoff &gt; cv-&gt;height )</span>
<span class="lineNum">    6723 </span><span class="lineNoCov">          0 :         CVFit(cv);</span>
<a name="6724"><span class="lineNum">    6724 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6725 </span>            : 
<span class="lineNum">    6726 </span><span class="lineNoCov">          0 : static void CVMenuImport(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6727 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6728 </span><span class="lineNoCov">          0 :     CVImport(cv);</span>
<span class="lineNum">    6729 </span><span class="lineNoCov">          0 :     CVInkscapeAdjust(cv);</span>
<a name="6730"><span class="lineNum">    6730 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6731 </span>            : 
<span class="lineNum">    6732 </span><span class="lineNoCov">          0 : static void CVMenuRevert(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6733 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6734 </span><span class="lineNoCov">          0 :     FVDelay((FontView *) (cv-&gt;b.fv),(void (*)(FontView *)) FVRevert);</span>
<span class="lineNum">    6735 </span>            :                             /* The revert command can potentially */
<span class="lineNum">    6736 </span>            :                             /* destroy our window (if the char weren't in the */
<span class="lineNum">    6737 </span>            :                             /* old font). If that happens before the menu finishes */
<span class="lineNum">    6738 </span>            :                             /* we get a crash. So delay till after the menu completes */
<a name="6739"><span class="lineNum">    6739 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6740 </span>            : 
<span class="lineNum">    6741 </span><span class="lineNoCov">          0 : static void CVMenuRevertGlyph(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6742 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6743 </span>            :     SplineChar *sc, temp;
<span class="lineNum">    6744 </span>            :     Undoes **undoes;
<span class="lineNum">    6745 </span>            :     int layer, lc;
<span class="lineNum">    6746 </span>            :     CharView *cvs;
<span class="lineNum">    6747 </span><span class="lineNoCov">          0 :     int mylayer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    6748 </span>            : 
<span class="lineNum">    6749 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc-&gt;parent-&gt;filename==NULL || cv-&gt;b.sc-&gt;namechanged || cv-&gt;b.sc-&gt;parent-&gt;mm!=NULL )</span>
<span class="lineNum">    6750 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    6751 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc-&gt;parent-&gt;sfd_version&lt;2 )</span>
<span class="lineNum">    6752 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Old sfd file&quot;),_(&quot;This font comes from an old format sfd file. Not all aspects of it can be reverted successfully.&quot;));</span>
<span class="lineNum">    6753 </span>            : 
<span class="lineNum">    6754 </span><span class="lineNoCov">          0 :     sc = SFDReadOneChar(cv-&gt;b.sc-&gt;parent,cv-&gt;b.sc-&gt;name);</span>
<span class="lineNum">    6755 </span><span class="lineNoCov">          0 :     if ( sc==NULL ) {</span>
<span class="lineNum">    6756 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Can't Find Glyph&quot;),_(&quot;The glyph, %.80s, can't be found in the sfd file&quot;),cv-&gt;b.sc-&gt;name);</span>
<span class="lineNum">    6757 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;namechanged = true;</span>
<span class="lineNum">    6758 </span>            :     } else {
<span class="lineNum">    6759 </span><span class="lineNoCov">          0 :         SCPreserveState(cv-&gt;b.sc,true);</span>
<span class="lineNum">    6760 </span><span class="lineNoCov">          0 :         SCPreserveBackground(cv-&gt;b.sc);</span>
<span class="lineNum">    6761 </span><span class="lineNoCov">          0 :         temp = *cv-&gt;b.sc;</span>
<span class="lineNum">    6762 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;dependents = NULL;</span>
<span class="lineNum">    6763 </span><span class="lineNoCov">          0 :         lc = cv-&gt;b.sc-&gt;layer_cnt;</span>
<span class="lineNum">    6764 </span><span class="lineNoCov">          0 :         undoes = malloc(lc*sizeof(Undoes *));</span>
<span class="lineNum">    6765 </span><span class="lineNoCov">          0 :         for ( layer=0; layer&lt;lc; ++layer ) {</span>
<span class="lineNum">    6766 </span><span class="lineNoCov">          0 :             undoes[layer] = cv-&gt;b.sc-&gt;layers[layer].undoes;</span>
<span class="lineNum">    6767 </span><span class="lineNoCov">          0 :             cv-&gt;b.sc-&gt;layers[layer].undoes = NULL;</span>
<span class="lineNum">    6768 </span>            :         }
<span class="lineNum">    6769 </span><span class="lineNoCov">          0 :         SplineCharFreeContents(cv-&gt;b.sc);</span>
<span class="lineNum">    6770 </span><span class="lineNoCov">          0 :         *cv-&gt;b.sc = *sc;</span>
<span class="lineNum">    6771 </span><span class="lineNoCov">          0 :         chunkfree(sc,sizeof(SplineChar));</span>
<span class="lineNum">    6772 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;parent = temp.parent;</span>
<span class="lineNum">    6773 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;dependents = temp.dependents;</span>
<span class="lineNum">    6774 </span><span class="lineNoCov">          0 :         for ( layer = 0; layer&lt;lc &amp;&amp; layer&lt;cv-&gt;b.sc-&gt;layer_cnt; ++layer )</span>
<span class="lineNum">    6775 </span><span class="lineNoCov">          0 :             cv-&gt;b.sc-&gt;layers[layer].undoes = undoes[layer];</span>
<span class="lineNum">    6776 </span><span class="lineNoCov">          0 :         for ( ; layer&lt;lc; ++layer )</span>
<span class="lineNum">    6777 </span><span class="lineNoCov">          0 :             UndoesFree(undoes[layer]);</span>
<span class="lineNum">    6778 </span><span class="lineNoCov">          0 :         free(undoes);</span>
<span class="lineNum">    6779 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;views = temp.views;</span>
<span class="lineNum">    6780 </span>            :         /* cv-&gt;b.sc-&gt;changed = temp.changed; */
<span class="lineNum">    6781 </span><span class="lineNoCov">          0 :         for ( cvs=(CharView *) (cv-&gt;b.sc-&gt;views); cvs!=NULL; cvs=(CharView *) (cvs-&gt;b.next) ) {</span>
<span class="lineNum">    6782 </span><span class="lineNoCov">          0 :             cvs-&gt;b.layerheads[dm_back] = &amp;cv-&gt;b.sc-&gt;layers[ly_back];</span>
<span class="lineNum">    6783 </span><span class="lineNoCov">          0 :             cvs-&gt;b.layerheads[dm_fore] = &amp;cv-&gt;b.sc-&gt;layers[ly_fore];</span>
<span class="lineNum">    6784 </span><span class="lineNoCov">          0 :             if ( cv-&gt;b.sc-&gt;parent-&gt;multilayer ) {</span>
<span class="lineNum">    6785 </span><span class="lineNoCov">          0 :                 if ( mylayer!=ly_back )</span>
<span class="lineNum">    6786 </span><span class="lineNoCov">          0 :                     cvs-&gt;b.layerheads[dm_fore] = &amp;cv-&gt;b.sc-&gt;layers[mylayer];</span>
<span class="lineNum">    6787 </span>            :             } else {
<span class="lineNum">    6788 </span><span class="lineNoCov">          0 :                 if ( mylayer!=ly_fore )</span>
<span class="lineNum">    6789 </span><span class="lineNoCov">          0 :                     cvs-&gt;b.layerheads[dm_back] = &amp;cv-&gt;b.sc-&gt;layers[mylayer];</span>
<span class="lineNum">    6790 </span>            :             }
<span class="lineNum">    6791 </span>            :         }
<span class="lineNum">    6792 </span><span class="lineNoCov">          0 :         RevertedGlyphReferenceFixup(cv-&gt;b.sc, temp.parent);</span>
<span class="lineNum">    6793 </span><span class="lineNoCov">          0 :         _CV_CharChangedUpdate(cv,false);</span>
<span class="lineNum">    6794 </span>            :     }
<a name="6795"><span class="lineNum">    6795 </span>            : }</a>
<span class="lineNum">    6796 </span>            : 
<span class="lineNum">    6797 </span><span class="lineNoCov">          0 : static void CVAddWordList(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e))</span>
<span class="lineNum">    6798 </span>            : {
<span class="lineNum">    6799 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6800 </span><span class="lineNoCov">          0 :     WordlistLoadToGTextInfo( cv-&gt;charselector, &amp;cv-&gt;charselectoridx );</span>
<a name="6801"><span class="lineNum">    6801 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6802 </span>            : 
<span class="lineNum">    6803 </span><span class="lineNoCov">          0 : static void CVMenuPrint(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6804 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6805 </span>            : 
<span class="lineNum">    6806 </span><span class="lineNoCov">          0 :     PrintFFDlg(NULL,cv-&gt;b.sc,NULL);</span>
<span class="lineNum">    6807 </span><span class="lineNoCov">          0 : }</span>
<a name="6808"><span class="lineNum">    6808 </span>            : </a>
<span class="lineNum">    6809 </span>            : #if !defined(_NO_PYTHON)
<span class="lineNum">    6810 </span><span class="lineNoCov">          0 : static void CVMenuExecute(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6811 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6812 </span><span class="lineNoCov">          0 :     ScriptDlg((FontView *) (cv-&gt;b.fv),cv);</span>
<span class="lineNum">    6813 </span><span class="lineNoCov">          0 : }</span>
<a name="6814"><span class="lineNum">    6814 </span>            : #endif          /* !_NO_PYTHON */</a>
<span class="lineNum">    6815 </span>            : 
<span class="lineNum">    6816 </span><span class="lineNoCov">          0 : static void fllistcheck(GWindow gw, struct gmenuitem *mi,GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6817 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6818 </span>            :     FontView *fvs;
<span class="lineNum">    6819 </span>            : 
<span class="lineNum">    6820 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">    6821 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">    6822 </span>            :           case MID_Open: case MID_New:
<span class="lineNum">    6823 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.container!=NULL &amp;&amp; !(cv-&gt;b.container-&gt;funcs-&gt;canOpen)(cv-&gt;b.container);</span>
<span class="lineNum">    6824 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    6825 </span>            :           case MID_GenerateTTC:
<span class="lineNum">    6826 </span><span class="lineNoCov">          0 :             for ( fvs=fv_list; fvs!=NULL; fvs=(FontView *) (fvs-&gt;b.next) ) {</span>
<span class="lineNum">    6827 </span><span class="lineNoCov">          0 :                 if ( fvs!=(FontView *) cv-&gt;b.fv )</span>
<span class="lineNum">    6828 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    6829 </span>            :             }
<span class="lineNum">    6830 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = fvs==NULL || cv-&gt;b.container!=NULL;</span>
<span class="lineNum">    6831 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    6832 </span>            :           case MID_Revert:
<span class="lineNum">    6833 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.fv-&gt;sf-&gt;origname==NULL || cv-&gt;b.fv-&gt;sf-&gt;new || cv-&gt;b.container;</span>
<span class="lineNum">    6834 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    6835 </span>            :           case MID_RevertGlyph:
<span class="lineNum">    6836 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.fv-&gt;sf-&gt;filename==NULL ||</span>
<span class="lineNum">    6837 </span><span class="lineNoCov">          0 :                     cv-&gt;b.fv-&gt;sf-&gt;sfd_version&lt;2 ||</span>
<span class="lineNum">    6838 </span><span class="lineNoCov">          0 :                     cv-&gt;b.sc-&gt;namechanged ||</span>
<span class="lineNum">    6839 </span><span class="lineNoCov">          0 :                     cv-&gt;b.fv-&gt;sf-&gt;mm!=NULL ||</span>
<span class="lineNum">    6840 </span><span class="lineNoCov">          0 :                     cv-&gt;b.container;</span>
<span class="lineNum">    6841 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    6842 </span>            :           case MID_Recent:
<span class="lineNum">    6843 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !RecentFilesAny() ||</span>
<span class="lineNum">    6844 </span><span class="lineNoCov">          0 :                     (cv-&gt;b.container!=NULL &amp;&amp; !(cv-&gt;b.container-&gt;funcs-&gt;canOpen)(cv-&gt;b.container));</span>
<span class="lineNum">    6845 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    6846 </span>            :           case MID_Close: case MID_Quit:
<span class="lineNum">    6847 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = false;</span>
<span class="lineNum">    6848 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    6849 </span>            :           case MID_CloseTab:
<span class="lineNum">    6850 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;tabs==NULL || cv-&gt;former_cnt&lt;=1;</span>
<span class="lineNum">    6851 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    6852 </span>            :           default:
<span class="lineNum">    6853 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.container!=NULL;</span>
<span class="lineNum">    6854 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    6855 </span>            :         }
<span class="lineNum">    6856 </span>            :     }
<a name="6857"><span class="lineNum">    6857 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6858 </span>            : 
<span class="lineNum">    6859 </span><span class="lineNoCov">          0 : static void CVMenuFontInfo(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6860 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6861 </span><span class="lineNoCov">          0 :     FontInfo(cv-&gt;b.sc-&gt;parent,CVLayer((CharViewBase *) cv),-1,false);</span>
<a name="6862"><span class="lineNum">    6862 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6863 </span>            : 
<span class="lineNum">    6864 </span><span class="lineNoCov">          0 : static void CVMenuFindProblems(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6865 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6866 </span><span class="lineNoCov">          0 :     FindProblems(NULL,cv,NULL);</span>
<a name="6867"><span class="lineNum">    6867 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6868 </span>            : 
<span class="lineNum">    6869 </span><span class="lineNoCov">          0 : static void CVMenuEmbolden(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6870 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6871 </span><span class="lineNoCov">          0 :     EmboldenDlg(NULL,cv);</span>
<a name="6872"><span class="lineNum">    6872 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6873 </span>            : 
<span class="lineNum">    6874 </span><span class="lineNoCov">          0 : static void CVMenuItalic(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6875 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6876 </span><span class="lineNoCov">          0 :     ItalicDlg(NULL,cv);</span>
<a name="6877"><span class="lineNum">    6877 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6878 </span>            : 
<span class="lineNum">    6879 </span><span class="lineNoCov">          0 : static void CVMenuOblique(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6880 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6881 </span><span class="lineNoCov">          0 :     ObliqueDlg(NULL,cv);</span>
<a name="6882"><span class="lineNum">    6882 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6883 </span>            : 
<span class="lineNum">    6884 </span><span class="lineNoCov">          0 : static void CVMenuCondense(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6885 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6886 </span><span class="lineNoCov">          0 :     CondenseExtendDlg(NULL,cv);</span>
<a name="6887"><span class="lineNum">    6887 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6888 </span>            : 
<span class="lineNum">    6889 </span><span class="lineNoCov">          0 : static void CVMenuChangeXHeight(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6890 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6891 </span><span class="lineNoCov">          0 :     ChangeXHeightDlg(NULL,cv);</span>
<a name="6892"><span class="lineNum">    6892 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6893 </span>            : 
<span class="lineNum">    6894 </span><span class="lineNoCov">          0 : static void CVMenuChangeGlyph(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6895 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6896 </span><span class="lineNoCov">          0 :     GlyphChangeDlg(NULL,cv,gc_generic);</span>
<a name="6897"><span class="lineNum">    6897 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6898 </span>            : 
<span class="lineNum">    6899 </span><span class="lineNoCov">          0 : static void CVMenuInline(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6900 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6901 </span><span class="lineNoCov">          0 :     OutlineDlg(NULL,cv,NULL,true);</span>
<a name="6902"><span class="lineNum">    6902 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6903 </span>            : 
<span class="lineNum">    6904 </span><span class="lineNoCov">          0 : static void CVMenuOutline(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6905 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6906 </span><span class="lineNoCov">          0 :     OutlineDlg(NULL,cv,NULL,false);</span>
<a name="6907"><span class="lineNum">    6907 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6908 </span>            : 
<span class="lineNum">    6909 </span><span class="lineNoCov">          0 : static void CVMenuShadow(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6910 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6911 </span><span class="lineNoCov">          0 :     ShadowDlg(NULL,cv,NULL,false);</span>
<a name="6912"><span class="lineNum">    6912 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6913 </span>            : 
<span class="lineNum">    6914 </span><span class="lineNoCov">          0 : static void CVMenuWireframe(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6915 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6916 </span><span class="lineNoCov">          0 :     ShadowDlg(NULL,cv,NULL,true);</span>
<a name="6917"><span class="lineNum">    6917 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6918 </span>            : 
<span class="lineNum">    6919 </span><span class="lineNoCov">          0 : static void _CVMenuScale(CharView *cv, int mid) {</span>
<span class="lineNum">    6920 </span><span class="lineNoCov">          0 :     if ( mid == MID_Fit ) {</span>
<span class="lineNum">    6921 </span><span class="lineNoCov">          0 :         CVFit(cv);</span>
<span class="lineNum">    6922 </span>            :     } else {
<span class="lineNum">    6923 </span>            :         BasePoint c;
<span class="lineNum">    6924 </span><span class="lineNoCov">          0 :         c.x = (cv-&gt;width/2-cv-&gt;xoff)/cv-&gt;scale;</span>
<span class="lineNum">    6925 </span><span class="lineNoCov">          0 :         c.y = (cv-&gt;height/2-cv-&gt;yoff)/cv-&gt;scale;</span>
<span class="lineNum">    6926 </span><span class="lineNoCov">          0 :         if ( CVAnySel(cv,NULL,NULL,NULL,NULL))</span>
<span class="lineNum">    6927 </span><span class="lineNoCov">          0 :             CVFindCenter(cv,&amp;c,false);</span>
<span class="lineNum">    6928 </span><span class="lineNoCov">          0 :         CVMagnify(cv,c.x,c.y, mid==MID_ZoomOut?-1:1,0);</span>
<span class="lineNum">    6929 </span>            :     }
<a name="6930"><span class="lineNum">    6930 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6931 </span>            : 
<span class="lineNum">    6932 </span><span class="lineNoCov">          0 : static void CVMenuScale(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6933 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6934 </span><span class="lineNoCov">          0 :     _CVMenuScale(cv,mi-&gt;mid);</span>
<a name="6935"><span class="lineNum">    6935 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6936 </span>            : 
<span class="lineNum">    6937 </span><span class="lineNoCov">          0 : static void CVMenuShowHide(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6938 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6939 </span><span class="lineNoCov">          0 :     CVShows.showpoints = cv-&gt;showpoints = !cv-&gt;showpoints;</span>
<span class="lineNum">    6940 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="6941"><span class="lineNum">    6941 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6942 </span>            : 
<span class="lineNum">    6943 </span><span class="lineNoCov">          0 : static void CVMenuShowHideControlPoints(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6944 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6945 </span><span class="lineNoCov">          0 :     CVShows.alwaysshowcontrolpoints = cv-&gt;alwaysshowcontrolpoints = !cv-&gt;alwaysshowcontrolpoints;</span>
<span class="lineNum">    6946 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="6947"><span class="lineNum">    6947 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6948 </span>            : 
<span class="lineNum">    6949 </span><span class="lineNoCov">          0 : static void CVMenuNumberPoints(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6950 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6951 </span>            : 
<span class="lineNum">    6952 </span><span class="lineNoCov">          0 :     switch ( mi-&gt;mid ) {</span>
<span class="lineNum">    6953 </span>            :       case MID_PtsNone:
<span class="lineNum">    6954 </span><span class="lineNoCov">          0 :         cv-&gt;showpointnumbers = 0;</span>
<span class="lineNum">    6955 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6956 </span>            :       case MID_PtsTrue:
<span class="lineNum">    6957 </span><span class="lineNoCov">          0 :         cv-&gt;showpointnumbers = 1;</span>
<span class="lineNum">    6958 </span><span class="lineNoCov">          0 :         CVCheckPoints(cv);</span>
<span class="lineNum">    6959 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6960 </span>            :       case MID_PtsPost:
<span class="lineNum">    6961 </span><span class="lineNoCov">          0 :         cv-&gt;showpointnumbers = 1;</span>
<span class="lineNum">    6962 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;numberpointsbackards = true;</span>
<span class="lineNum">    6963 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6964 </span>            :       case MID_PtsSVG:
<span class="lineNum">    6965 </span><span class="lineNoCov">          0 :         cv-&gt;showpointnumbers = 1;</span>
<span class="lineNum">    6966 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;numberpointsbackards = false;</span>
<span class="lineNum">    6967 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6968 </span>            :       case MID_PtsPos:
<span class="lineNum">    6969 </span><span class="lineNoCov">          0 :         cv-&gt;showpointnumbers = 2;</span>
<span class="lineNum">    6970 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    6971 </span>            :     }
<span class="lineNum">    6972 </span><span class="lineNoCov">          0 :     SCNumberPoints(cv-&gt;b.sc,CVLayer((CharViewBase *) cv));</span>
<span class="lineNum">    6973 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<a name="6974"><span class="lineNum">    6974 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6975 </span>            : 
<span class="lineNum">    6976 </span><span class="lineNoCov">          0 : static void CVMenuMarkExtrema(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6977 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6978 </span>            : 
<span class="lineNum">    6979 </span><span class="lineNoCov">          0 :     CVShows.markextrema = cv-&gt;markextrema = !cv-&gt;markextrema;</span>
<span class="lineNum">    6980 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<span class="lineNum">    6981 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="6982"><span class="lineNum">    6982 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6983 </span>            : 
<span class="lineNum">    6984 </span><span class="lineNoCov">          0 : static void CVMenuMarkPointsOfInflection(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6985 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6986 </span>            : 
<span class="lineNum">    6987 </span><span class="lineNoCov">          0 :     CVShows.markpoi = cv-&gt;markpoi = !cv-&gt;markpoi;</span>
<span class="lineNum">    6988 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<span class="lineNum">    6989 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="6990"><span class="lineNum">    6990 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6991 </span>            : 
<span class="lineNum">    6992 </span><span class="lineNoCov">          0 : static void CVMenuShowAlmostHV(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    6993 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    6994 </span>            : 
<span class="lineNum">    6995 </span><span class="lineNoCov">          0 :     CVShows.showalmosthvlines = cv-&gt;showalmosthvlines = !cv-&gt;showalmosthvlines;</span>
<span class="lineNum">    6996 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<span class="lineNum">    6997 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="6998"><span class="lineNum">    6998 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6999 </span>            : 
<span class="lineNum">    7000 </span><span class="lineNoCov">          0 : static void CVMenuShowAlmostHVCurves(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7001 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7002 </span>            : 
<span class="lineNum">    7003 </span><span class="lineNoCov">          0 :     CVShows.showalmosthvcurves = cv-&gt;showalmosthvcurves = !cv-&gt;showalmosthvcurves;</span>
<span class="lineNum">    7004 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<span class="lineNum">    7005 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="7006"><span class="lineNum">    7006 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7007 </span>            : 
<span class="lineNum">    7008 </span><span class="lineNoCov">          0 : static void CVMenuDefineAlmost(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7009 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7010 </span>            :     char buf[20], *end;
<span class="lineNum">    7011 </span>            :     int val;
<span class="lineNum">    7012 </span>            :     char *ret;
<span class="lineNum">    7013 </span>            : 
<span class="lineNum">    7014 </span><span class="lineNoCov">          0 :     sprintf(buf,&quot;%d&quot;,cv-&gt;hvoffset );</span>
<span class="lineNum">    7015 </span>            : 
<span class="lineNum">    7016 </span><span class="lineNoCov">          0 :     ret = gwwv_ask_string(_(&quot;Define \&quot;Almost Horizontal\&quot;&quot;),buf,</span>
<span class="lineNum">    7017 </span><span class="lineNoCov">          0 :             _(&quot;A line is \&quot;almost\&quot; horizontal (or vertical)\nif the coordinates are within this many em-units&quot;));</span>
<span class="lineNum">    7018 </span><span class="lineNoCov">          0 :     if ( ret==NULL )</span>
<span class="lineNum">    7019 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7020 </span><span class="lineNoCov">          0 :     val = strtol(ret,&amp;end,10);</span>
<span class="lineNum">    7021 </span><span class="lineNoCov">          0 :     if ( val&gt;100 || val&lt;=0 || *end!='\0' ) {</span>
<span class="lineNum">    7022 </span><span class="lineNoCov">          0 :         free(ret);</span>
<span class="lineNum">    7023 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Bad number&quot;),_(&quot;Bad number&quot;));</span>
<span class="lineNum">    7024 </span>            :     } else {
<span class="lineNum">    7025 </span><span class="lineNoCov">          0 :         free(ret);</span>
<span class="lineNum">    7026 </span><span class="lineNoCov">          0 :         CVShows.hvoffset = cv-&gt;hvoffset = val;</span>
<span class="lineNum">    7027 </span><span class="lineNoCov">          0 :         SavePrefs(true);</span>
<span class="lineNum">    7028 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">    7029 </span>            :     }
<a name="7030"><span class="lineNum">    7030 </span>            : }</a>
<span class="lineNum">    7031 </span>            : 
<span class="lineNum">    7032 </span><span class="lineNoCov">          0 : static void CVMenuShowCPInfo(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7033 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7034 </span>            : 
<span class="lineNum">    7035 </span><span class="lineNoCov">          0 :     CVShows.showcpinfo = cv-&gt;showcpinfo = !cv-&gt;showcpinfo;</span>
<span class="lineNum">    7036 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<span class="lineNum">    7037 </span>            :     /* Nothing to update, only show this stuff in the user is moving a cp */
<span class="lineNum">    7038 </span>            :     /*  which s/he is currently not, s/he is manipulating the menu */
<a name="7039"><span class="lineNum">    7039 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7040 </span>            : 
<span class="lineNum">    7041 </span><span class="lineNoCov">          0 : static void CVMenuShowTabs(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7042 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7043 </span>            : 
<span class="lineNum">    7044 </span><span class="lineNoCov">          0 :     CVShows.showtabs = cv-&gt;showtabs = !cv-&gt;showtabs;</span>
<span class="lineNum">    7045 </span><span class="lineNoCov">          0 :     CVChangeTabsVisibility(cv,cv-&gt;showtabs);</span>
<span class="lineNum">    7046 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<a name="7047"><span class="lineNum">    7047 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7048 </span>            : 
<span class="lineNum">    7049 </span><span class="lineNoCov">          0 : static void CVMenuShowSideBearings(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7050 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7051 </span>            : 
<span class="lineNum">    7052 </span><span class="lineNoCov">          0 :     CVShows.showsidebearings = cv-&gt;showsidebearings = !cv-&gt;showsidebearings;</span>
<span class="lineNum">    7053 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<span class="lineNum">    7054 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="7055"><span class="lineNum">    7055 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7056 </span>            : 
<span class="lineNum">    7057 </span><span class="lineNoCov">          0 : static void CVMenuShowRefNames(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7058 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7059 </span>            : 
<span class="lineNum">    7060 </span><span class="lineNoCov">          0 :     CVShows.showrefnames = cv-&gt;showrefnames = !cv-&gt;showrefnames;</span>
<span class="lineNum">    7061 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<span class="lineNum">    7062 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="7063"><span class="lineNum">    7063 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7064 </span>            : 
<span class="lineNum">    7065 </span><span class="lineNoCov">          0 : static void CVMenuSnapOutlines(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7066 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7067 </span>            : 
<span class="lineNum">    7068 </span><span class="lineNoCov">          0 :     CVShows.snapoutlines = cv-&gt;snapoutlines = !cv-&gt;snapoutlines;</span>
<span class="lineNum">    7069 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<span class="lineNum">    7070 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="7071"><span class="lineNum">    7071 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7072 </span>            : 
<span class="lineNum">    7073 </span><span class="lineNoCov">          0 : static void CVMenuShowHints(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7074 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7075 </span>            : 
<span class="lineNum">    7076 </span><span class="lineNoCov">          0 :     switch ( mi-&gt;mid ) {</span>
<span class="lineNum">    7077 </span>            :       case MID_ShowHHints:
<span class="lineNum">    7078 </span><span class="lineNoCov">          0 :         CVShows.showhhints = cv-&gt;showhhints = !cv-&gt;showhhints;</span>
<span class="lineNum">    7079 </span><span class="lineNoCov">          0 :         cv-&gt;back_img_out_of_date = true;     /* only this cv */</span>
<span class="lineNum">    7080 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    7081 </span>            :       case MID_ShowVHints:
<span class="lineNum">    7082 </span><span class="lineNoCov">          0 :         CVShows.showvhints = cv-&gt;showvhints = !cv-&gt;showvhints;</span>
<span class="lineNum">    7083 </span><span class="lineNoCov">          0 :         cv-&gt;back_img_out_of_date = true;     /* only this cv */</span>
<span class="lineNum">    7084 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    7085 </span>            :       case MID_ShowDHints:
<span class="lineNum">    7086 </span><span class="lineNoCov">          0 :         CVShows.showdhints = cv-&gt;showdhints = !cv-&gt;showdhints;</span>
<span class="lineNum">    7087 </span><span class="lineNoCov">          0 :         cv-&gt;back_img_out_of_date = true;     /* only this cv */</span>
<span class="lineNum">    7088 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    7089 </span>            :       case MID_ShowBlueValues:
<span class="lineNum">    7090 </span><span class="lineNoCov">          0 :         CVShows.showblues = cv-&gt;showblues = !cv-&gt;showblues;</span>
<span class="lineNum">    7091 </span><span class="lineNoCov">          0 :         cv-&gt;back_img_out_of_date = true;     /* only this cv */</span>
<span class="lineNum">    7092 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    7093 </span>            :       case MID_ShowFamilyBlues:
<span class="lineNum">    7094 </span><span class="lineNoCov">          0 :         CVShows.showfamilyblues = cv-&gt;showfamilyblues = !cv-&gt;showfamilyblues;</span>
<span class="lineNum">    7095 </span><span class="lineNoCov">          0 :         cv-&gt;back_img_out_of_date = true;     /* only this cv */</span>
<span class="lineNum">    7096 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    7097 </span>            :       case MID_ShowAnchors:
<span class="lineNum">    7098 </span><span class="lineNoCov">          0 :         CVShows.showanchor = cv-&gt;showanchor = !cv-&gt;showanchor;</span>
<span class="lineNum">    7099 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    7100 </span>            :       case MID_ShowHMetrics:
<span class="lineNum">    7101 </span><span class="lineNoCov">          0 :         CVShows.showhmetrics = cv-&gt;showhmetrics = !cv-&gt;showhmetrics;</span>
<span class="lineNum">    7102 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    7103 </span>            :       case MID_ShowVMetrics:
<span class="lineNum">    7104 </span><span class="lineNoCov">          0 :         CVShows.showvmetrics = cv-&gt;showvmetrics = !cv-&gt;showvmetrics;</span>
<span class="lineNum">    7105 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    7106 </span>            :       case MID_ShowDebugChanges:
<span class="lineNum">    7107 </span><span class="lineNoCov">          0 :         CVShows.showdebugchanges = cv-&gt;showdebugchanges = !cv-&gt;showdebugchanges;</span>
<span class="lineNum">    7108 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    7109 </span>            :       default:
<span class="lineNum">    7110 </span><span class="lineNoCov">          0 :         IError(&quot;Unexpected call to CVMenuShowHints&quot;);</span>
<span class="lineNum">    7111 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    7112 </span>            :     }
<span class="lineNum">    7113 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<span class="lineNum">    7114 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">    7115 </span>            :     /* !!!! In this interim version we should request an expose on cvlayers */
<span class="lineNum">    7116 </span>            :     /*  but that's private to cvpalettes, and later we won't need to */
<a name="7117"><span class="lineNum">    7117 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7118 </span>            : 
<span class="lineNum">    7119 </span><span class="lineNoCov">          0 : static void _CVMenuShowHideRulers(CharView *cv) {</span>
<span class="lineNum">    7120 </span>            :     GRect pos;
<span class="lineNum">    7121 </span>            : 
<span class="lineNum">    7122 </span><span class="lineNoCov">          0 :     CVShows.showrulers = cv-&gt;showrulers = !cv-&gt;showrulers;</span>
<span class="lineNum">    7123 </span><span class="lineNoCov">          0 :     pos.y = cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh;</span>
<span class="lineNum">    7124 </span><span class="lineNoCov">          0 :     pos.x = 0;</span>
<span class="lineNum">    7125 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showrulers ) {</span>
<span class="lineNum">    7126 </span><span class="lineNoCov">          0 :         cv-&gt;height -= cv-&gt;rulerh;</span>
<span class="lineNum">    7127 </span><span class="lineNoCov">          0 :         cv-&gt;width -= cv-&gt;rulerh;</span>
<span class="lineNum">    7128 </span><span class="lineNoCov">          0 :         pos.y += cv-&gt;rulerh;</span>
<span class="lineNum">    7129 </span><span class="lineNoCov">          0 :         pos.x += cv-&gt;rulerh;</span>
<span class="lineNum">    7130 </span>            :     } else {
<span class="lineNum">    7131 </span><span class="lineNoCov">          0 :         cv-&gt;height += cv-&gt;rulerh;</span>
<span class="lineNum">    7132 </span><span class="lineNoCov">          0 :         cv-&gt;width += cv-&gt;rulerh;</span>
<span class="lineNum">    7133 </span>            :     }
<span class="lineNum">    7134 </span><span class="lineNoCov">          0 :     cv-&gt;back_img_out_of_date = true;</span>
<span class="lineNum">    7135 </span><span class="lineNoCov">          0 :     pos.width = cv-&gt;width; pos.height = cv-&gt;height;</span>
<span class="lineNum">    7136 </span><span class="lineNoCov">          0 :     GDrawMoveResize(cv-&gt;v,pos.x,pos.y,pos.width,pos.height);</span>
<span class="lineNum">    7137 </span><span class="lineNoCov">          0 :     GDrawSync(NULL);</span>
<span class="lineNum">    7138 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">    7139 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<a name="7140"><span class="lineNum">    7140 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7141 </span>            : 
<span class="lineNum">    7142 </span><span class="lineNoCov">          0 : static void CVMenuShowHideRulers(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7143 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7144 </span><span class="lineNoCov">          0 :     _CVMenuShowHideRulers(cv);</span>
<a name="7145"><span class="lineNum">    7145 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7146 </span>            : 
<span class="lineNum">    7147 </span><span class="lineNoCov">          0 : static void CVMenuFill(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7148 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7149 </span>            : 
<span class="lineNum">    7150 </span><span class="lineNoCov">          0 :     CVShows.showfilled = cv-&gt;showfilled = !cv-&gt;showfilled;</span>
<span class="lineNum">    7151 </span><span class="lineNoCov">          0 :     CVRegenFill(cv);</span>
<span class="lineNum">    7152 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="7153"><span class="lineNum">    7153 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7154 </span>            : 
<span class="lineNum">    7155 </span><span class="lineNoCov">          0 : static struct cvshows* cvshowsCopyTo( struct cvshows* dst, CharView* src )</span>
<span class="lineNum">    7156 </span>            : {
<span class="lineNum">    7157 </span><span class="lineNoCov">          0 :     dst-&gt;showfore = src-&gt;showfore;</span>
<span class="lineNum">    7158 </span><span class="lineNoCov">          0 :     dst-&gt;showgrids = src-&gt;showgrids;</span>
<span class="lineNum">    7159 </span><span class="lineNoCov">          0 :     dst-&gt;showhhints = src-&gt;showhhints;</span>
<span class="lineNum">    7160 </span><span class="lineNoCov">          0 :     dst-&gt;showvhints = src-&gt;showvhints;</span>
<span class="lineNum">    7161 </span><span class="lineNoCov">          0 :     dst-&gt;showdhints = src-&gt;showdhints;</span>
<span class="lineNum">    7162 </span><span class="lineNoCov">          0 :     dst-&gt;showpoints = src-&gt;showpoints;</span>
<span class="lineNum">    7163 </span><span class="lineNoCov">          0 :     dst-&gt;alwaysshowcontrolpoints = src-&gt;alwaysshowcontrolpoints;</span>
<span class="lineNum">    7164 </span><span class="lineNoCov">          0 :     dst-&gt;showfilled = src-&gt;showfilled;</span>
<span class="lineNum">    7165 </span><span class="lineNoCov">          0 :     dst-&gt;showrulers = src-&gt;showrulers;</span>
<span class="lineNum">    7166 </span><span class="lineNoCov">          0 :     dst-&gt;showrounds = src-&gt;showrounds;</span>
<span class="lineNum">    7167 </span><span class="lineNoCov">          0 :     dst-&gt;showmdx = src-&gt;showmdx;</span>
<span class="lineNum">    7168 </span><span class="lineNoCov">          0 :     dst-&gt;showmdy = src-&gt;showmdy;</span>
<span class="lineNum">    7169 </span><span class="lineNoCov">          0 :     dst-&gt;showhmetrics = src-&gt;showhmetrics;</span>
<span class="lineNum">    7170 </span><span class="lineNoCov">          0 :     dst-&gt;showvmetrics = src-&gt;showvmetrics;</span>
<span class="lineNum">    7171 </span><span class="lineNoCov">          0 :     dst-&gt;markextrema = src-&gt;markextrema;</span>
<span class="lineNum">    7172 </span><span class="lineNoCov">          0 :     dst-&gt;markpoi = src-&gt;markpoi;</span>
<span class="lineNum">    7173 </span><span class="lineNoCov">          0 :     dst-&gt;showblues = src-&gt;showblues;</span>
<span class="lineNum">    7174 </span><span class="lineNoCov">          0 :     dst-&gt;showfamilyblues = src-&gt;showfamilyblues;</span>
<span class="lineNum">    7175 </span><span class="lineNoCov">          0 :     dst-&gt;showanchor = src-&gt;showanchor;</span>
<span class="lineNum">    7176 </span><span class="lineNoCov">          0 :     dst-&gt;showcpinfo = src-&gt;showcpinfo;</span>
<span class="lineNum">    7177 </span><span class="lineNoCov">          0 :     dst-&gt;showtabs = src-&gt;showtabs;</span>
<span class="lineNum">    7178 </span><span class="lineNoCov">          0 :     dst-&gt;showsidebearings = src-&gt;showsidebearings;</span>
<span class="lineNum">    7179 </span><span class="lineNoCov">          0 :     dst-&gt;showrefnames = src-&gt;showrefnames;</span>
<span class="lineNum">    7180 </span><span class="lineNoCov">          0 :     dst-&gt;snapoutlines = src-&gt;snapoutlines;</span>
<span class="lineNum">    7181 </span><span class="lineNoCov">          0 :     dst-&gt;showalmosthvlines = src-&gt;showalmosthvlines;</span>
<span class="lineNum">    7182 </span><span class="lineNoCov">          0 :     dst-&gt;showalmosthvcurves = src-&gt;showalmosthvcurves;</span>
<span class="lineNum">    7183 </span><span class="lineNoCov">          0 :     dst-&gt;hvoffset = src-&gt;hvoffset;</span>
<span class="lineNum">    7184 </span><span class="lineNoCov">          0 :     dst-&gt;checkselfintersects = src-&gt;checkselfintersects;</span>
<span class="lineNum">    7185 </span><span class="lineNoCov">          0 :     dst-&gt;showdebugchanges = src-&gt;showdebugchanges;</span>
<span class="lineNum">    7186 </span><span class="lineNoCov">          0 :     return dst;</span>
<a name="7187"><span class="lineNum">    7187 </span>            : }</a>
<span class="lineNum">    7188 </span>            : 
<span class="lineNum">    7189 </span><span class="lineNoCov">          0 : static CharView* cvshowsCopyFrom( CharView* dst, struct cvshows* src )</span>
<span class="lineNum">    7190 </span>            : {
<span class="lineNum">    7191 </span><span class="lineNoCov">          0 :     dst-&gt;showfore = src-&gt;showfore;</span>
<span class="lineNum">    7192 </span><span class="lineNoCov">          0 :     dst-&gt;showgrids = src-&gt;showgrids;</span>
<span class="lineNum">    7193 </span><span class="lineNoCov">          0 :     dst-&gt;showhhints = src-&gt;showhhints;</span>
<span class="lineNum">    7194 </span><span class="lineNoCov">          0 :     dst-&gt;showvhints = src-&gt;showvhints;</span>
<span class="lineNum">    7195 </span><span class="lineNoCov">          0 :     dst-&gt;showdhints = src-&gt;showdhints;</span>
<span class="lineNum">    7196 </span><span class="lineNoCov">          0 :     dst-&gt;showpoints = src-&gt;showpoints;</span>
<span class="lineNum">    7197 </span><span class="lineNoCov">          0 :     dst-&gt;alwaysshowcontrolpoints = src-&gt;alwaysshowcontrolpoints;</span>
<span class="lineNum">    7198 </span><span class="lineNoCov">          0 :     dst-&gt;showfilled = src-&gt;showfilled;</span>
<span class="lineNum">    7199 </span><span class="lineNoCov">          0 :     dst-&gt;showrulers = src-&gt;showrulers;</span>
<span class="lineNum">    7200 </span><span class="lineNoCov">          0 :     dst-&gt;showrounds = src-&gt;showrounds;</span>
<span class="lineNum">    7201 </span><span class="lineNoCov">          0 :     dst-&gt;showmdx = src-&gt;showmdx;</span>
<span class="lineNum">    7202 </span><span class="lineNoCov">          0 :     dst-&gt;showmdy = src-&gt;showmdy;</span>
<span class="lineNum">    7203 </span><span class="lineNoCov">          0 :     dst-&gt;showhmetrics = src-&gt;showhmetrics;</span>
<span class="lineNum">    7204 </span><span class="lineNoCov">          0 :     dst-&gt;showvmetrics = src-&gt;showvmetrics;</span>
<span class="lineNum">    7205 </span><span class="lineNoCov">          0 :     dst-&gt;markextrema = src-&gt;markextrema;</span>
<span class="lineNum">    7206 </span><span class="lineNoCov">          0 :     dst-&gt;markpoi = src-&gt;markpoi;</span>
<span class="lineNum">    7207 </span><span class="lineNoCov">          0 :     dst-&gt;showblues = src-&gt;showblues;</span>
<span class="lineNum">    7208 </span><span class="lineNoCov">          0 :     dst-&gt;showfamilyblues = src-&gt;showfamilyblues;</span>
<span class="lineNum">    7209 </span><span class="lineNoCov">          0 :     dst-&gt;showanchor = src-&gt;showanchor;</span>
<span class="lineNum">    7210 </span><span class="lineNoCov">          0 :     dst-&gt;showcpinfo = src-&gt;showcpinfo;</span>
<span class="lineNum">    7211 </span><span class="lineNoCov">          0 :     dst-&gt;showtabs = src-&gt;showtabs;</span>
<span class="lineNum">    7212 </span><span class="lineNoCov">          0 :     dst-&gt;showsidebearings = src-&gt;showsidebearings;</span>
<span class="lineNum">    7213 </span><span class="lineNoCov">          0 :     dst-&gt;showrefnames = src-&gt;showrefnames;</span>
<span class="lineNum">    7214 </span><span class="lineNoCov">          0 :     dst-&gt;snapoutlines = src-&gt;snapoutlines;</span>
<span class="lineNum">    7215 </span><span class="lineNoCov">          0 :     dst-&gt;showalmosthvlines = src-&gt;showalmosthvlines;</span>
<span class="lineNum">    7216 </span><span class="lineNoCov">          0 :     dst-&gt;showalmosthvcurves = src-&gt;showalmosthvcurves;</span>
<span class="lineNum">    7217 </span><span class="lineNoCov">          0 :     dst-&gt;hvoffset = src-&gt;hvoffset;</span>
<span class="lineNum">    7218 </span><span class="lineNoCov">          0 :     dst-&gt;checkselfintersects = src-&gt;checkselfintersects;</span>
<span class="lineNum">    7219 </span><span class="lineNoCov">          0 :     dst-&gt;showdebugchanges = src-&gt;showdebugchanges;</span>
<span class="lineNum">    7220 </span><span class="lineNoCov">          0 :     return dst;</span>
<a name="7221"><span class="lineNum">    7221 </span>            : }</a>
<span class="lineNum">    7222 </span>            : 
<span class="lineNum">    7223 </span><span class="lineNoCov">          0 : static void CVPreviewModeSet(GWindow gw, int checked ) {</span>
<span class="lineNum">    7224 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7225 </span><span class="lineNoCov">          0 :     if( checked == cv-&gt;inPreviewMode )</span>
<span class="lineNum">    7226 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    7227 </span>            : 
<span class="lineNum">    7228 </span><span class="lineNoCov">          0 :     cv-&gt;inPreviewMode = checked;</span>
<span class="lineNum">    7229 </span><span class="lineNoCov">          0 :     if( checked ) {</span>
<span class="lineNum">    7230 </span><span class="lineNoCov">          0 :         cvshowsCopyTo( &amp;CVShowsPrevewToggleSavedState, cv );</span>
<span class="lineNum">    7231 </span><span class="lineNoCov">          0 :         cv-&gt;showfore   = 1;</span>
<span class="lineNum">    7232 </span><span class="lineNoCov">          0 :         cv-&gt;showgrids  = 0;</span>
<span class="lineNum">    7233 </span><span class="lineNoCov">          0 :         cv-&gt;showhhints = 0;</span>
<span class="lineNum">    7234 </span><span class="lineNoCov">          0 :         cv-&gt;showvhints = 0;</span>
<span class="lineNum">    7235 </span><span class="lineNoCov">          0 :         cv-&gt;showdhints = 0;</span>
<span class="lineNum">    7236 </span><span class="lineNoCov">          0 :         cv-&gt;showpoints = 0;</span>
<span class="lineNum">    7237 </span><span class="lineNoCov">          0 :         cv-&gt;alwaysshowcontrolpoints = 0;</span>
<span class="lineNum">    7238 </span><span class="lineNoCov">          0 :         cv-&gt;showfilled = 1;</span>
<span class="lineNum">    7239 </span><span class="lineNoCov">          0 :         cv-&gt;showrounds = 0;</span>
<span class="lineNum">    7240 </span><span class="lineNoCov">          0 :         cv-&gt;showanchor = 0;</span>
<span class="lineNum">    7241 </span><span class="lineNoCov">          0 :         cv-&gt;showrefnames = 0;</span>
<span class="lineNum">    7242 </span><span class="lineNoCov">          0 :         cv-&gt;showhmetrics = 0;</span>
<span class="lineNum">    7243 </span><span class="lineNoCov">          0 :         cv-&gt;showvmetrics = 0;</span>
<span class="lineNum">    7244 </span>            :     } else {
<span class="lineNum">    7245 </span><span class="lineNoCov">          0 :         cvshowsCopyFrom( cv, &amp;CVShowsPrevewToggleSavedState );</span>
<span class="lineNum">    7246 </span>            :     }
<span class="lineNum">    7247 </span><span class="lineNoCov">          0 :     CVRegenFill(cv);</span>
<span class="lineNum">    7248 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="7249"><span class="lineNum">    7249 </span>            : }</a>
<span class="lineNum">    7250 </span>            : 
<span class="lineNum">    7251 </span><span class="lineNoCov">          0 : static void CVMenuPreview(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7252 </span><span class="lineNoCov">          0 :     int checked = mi-&gt;ti.checked;</span>
<span class="lineNum">    7253 </span>            : 
<span class="lineNum">    7254 </span>            : #if 0
<span class="lineNum">    7255 </span>            :     // This has the effect of breaking the button since cv_auto_goto and HaveModifiers tend to be false.
<span class="lineNum">    7256 </span>            :     // The purpose of these checks is unclear.
<span class="lineNum">    7257 </span>            :     if( !cv_auto_goto ) {
<span class="lineNum">    7258 </span>            :         if( !HaveModifiers )
<span class="lineNum">    7259 </span>            :             return;
<span class="lineNum">    7260 </span>            :     }
<span class="lineNum">    7261 </span>            : #endif // 0
<span class="lineNum">    7262 </span>            : 
<span class="lineNum">    7263 </span><span class="lineNoCov">          0 :     CVPreviewModeSet(gw, checked);</span>
<a name="7264"><span class="lineNum">    7264 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7265 </span>            : 
<span class="lineNum">    7266 </span><span class="lineNoCov">          0 : static void CVMenuDraggingComparisonOutline(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e))</span>
<span class="lineNum">    7267 </span>            : {
<span class="lineNum">    7268 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7269 </span>            : 
<span class="lineNum">    7270 </span><span class="lineNoCov">          0 :     int checked = mi-&gt;ti.checked;</span>
<span class="lineNum">    7271 </span><span class="lineNoCov">          0 :     CVFreePreTransformSPL( cv );</span>
<span class="lineNum">    7272 </span><span class="lineNoCov">          0 :     prefs_create_dragging_comparison_outline = checked;</span>
<span class="lineNum">    7273 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<span class="lineNum">    7274 </span><span class="lineNoCov">          0 : }</span>
<a name="7275"><span class="lineNum">    7275 </span>            : </a>
<span class="lineNum">    7276 </span>            : 
<span class="lineNum">    7277 </span><span class="lineNoCov">          0 : static void CVMenuShowGridFit(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7278 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7279 </span>            : 
<span class="lineNum">    7280 </span><span class="lineNoCov">          0 :     if ( !hasFreeType() || cv-&gt;dv!=NULL )</span>
<span class="lineNum">    7281 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    7282 </span><span class="lineNoCov">          0 :     cv-&gt;show_ft_results_live_update = 0;</span>
<span class="lineNum">    7283 </span><span class="lineNoCov">          0 :     CVFtPpemDlg(cv,false);</span>
<a name="7284"><span class="lineNum">    7284 </span>            : }</a>
<span class="lineNum">    7285 </span>            : 
<span class="lineNum">    7286 </span><span class="lineNoCov">          0 : static void CVMenuShowGridFitLiveUpdate(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7287 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7288 </span>            : 
<span class="lineNum">    7289 </span><span class="lineNoCov">          0 :     if ( !hasFreeType() || cv-&gt;dv!=NULL )</span>
<span class="lineNum">    7290 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    7291 </span><span class="lineNoCov">          0 :     cv-&gt;show_ft_results_live_update = 1;</span>
<span class="lineNum">    7292 </span><span class="lineNoCov">          0 :     CVFtPpemDlg(cv,false);</span>
<a name="7293"><span class="lineNum">    7293 </span>            : }</a>
<span class="lineNum">    7294 </span>            : 
<span class="lineNum">    7295 </span><span class="lineNoCov">          0 : static void CVMenuChangePointSize(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7296 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7297 </span>            : 
<span class="lineNum">    7298 </span><span class="lineNoCov">          0 :     if ( !hasFreeType() || cv-&gt;dv!=NULL || !cv-&gt;show_ft_results )</span>
<span class="lineNum">    7299 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7300 </span>            : 
<span class="lineNum">    7301 </span><span class="lineNoCov">          0 :     if ( mi-&gt;mid==MID_GridFitOff ) {</span>
<span class="lineNum">    7302 </span><span class="lineNoCov">          0 :         cv-&gt;show_ft_results = false;</span>
<span class="lineNum">    7303 </span><span class="lineNoCov">          0 :         cv-&gt;show_ft_results_live_update = false;</span>
<span class="lineNum">    7304 </span>            : 
<span class="lineNum">    7305 </span><span class="lineNoCov">          0 :         SplinePointListsFree(cv-&gt;b.gridfit); cv-&gt;b.gridfit = NULL;</span>
<span class="lineNum">    7306 </span><span class="lineNoCov">          0 :         FreeType_FreeRaster(cv-&gt;raster); cv-&gt;raster = NULL;</span>
<span class="lineNum">    7307 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">    7308 </span>            :     } else {
<span class="lineNum">    7309 </span><span class="lineNoCov">          0 :         if ( mi-&gt;mid==MID_Bigger ) {</span>
<span class="lineNum">    7310 </span><span class="lineNoCov">          0 :             ++cv-&gt;ft_pointsizex;</span>
<span class="lineNum">    7311 </span><span class="lineNoCov">          0 :             ++cv-&gt;ft_pointsizey;</span>
<span class="lineNum">    7312 </span><span class="lineNoCov">          0 :         } else if ( mi-&gt;mid==MID_Smaller ) {</span>
<span class="lineNum">    7313 </span><span class="lineNoCov">          0 :             if ( cv-&gt;ft_pointsizex&gt;1 )</span>
<span class="lineNum">    7314 </span><span class="lineNoCov">          0 :                 --cv-&gt;ft_pointsizex;</span>
<span class="lineNum">    7315 </span><span class="lineNoCov">          0 :             if ( cv-&gt;ft_pointsizey&gt;1 )</span>
<span class="lineNum">    7316 </span><span class="lineNoCov">          0 :                 --cv-&gt;ft_pointsizey;</span>
<span class="lineNum">    7317 </span>            :         }
<span class="lineNum">    7318 </span>            : 
<span class="lineNum">    7319 </span><span class="lineNoCov">          0 :         if ( mi-&gt;mid==MID_GridFitAA )</span>
<span class="lineNum">    7320 </span><span class="lineNoCov">          0 :             cv-&gt;ft_depth = cv-&gt;ft_depth==8 ? 1 : 8;</span>
<span class="lineNum">    7321 </span><span class="lineNoCov">          0 :         cv-&gt;ft_ppemx = rint(cv-&gt;ft_pointsizex*cv-&gt;ft_dpi/72.0);</span>
<span class="lineNum">    7322 </span><span class="lineNoCov">          0 :         cv-&gt;ft_ppemy = rint(cv-&gt;ft_pointsizey*cv-&gt;ft_dpi/72.0);</span>
<span class="lineNum">    7323 </span><span class="lineNoCov">          0 :         CVGridFitChar(cv);</span>
<span class="lineNum">    7324 </span>            :     }
<span class="lineNum">    7325 </span><span class="lineNoCov">          0 :     SCRefreshTitles(cv-&gt;b.sc);</span>
<a name="7326"><span class="lineNum">    7326 </span>            : }</a>
<span class="lineNum">    7327 </span>            : 
<span class="lineNum">    7328 </span><span class="lineNoCov">          0 : static void CVMenuEditInstrs(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7329 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7330 </span><span class="lineNoCov">          0 :     SCEditInstructions(cv-&gt;b.sc);</span>
<a name="7331"><span class="lineNum">    7331 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7332 </span>            : 
<span class="lineNum">    7333 </span><span class="lineNoCov">          0 : static void CVMenuDebug(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7334 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7335 </span>            : 
<span class="lineNum">    7336 </span><span class="lineNoCov">          0 :     if ( !hasFreeTypeDebugger())</span>
<span class="lineNum">    7337 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7338 </span><span class="lineNoCov">          0 :     CVFtPpemDlg(cv,true);</span>
<a name="7339"><span class="lineNum">    7339 </span>            : }</a>
<span class="lineNum">    7340 </span>            : 
<span class="lineNum">    7341 </span><span class="lineNoCov">          0 : static void CVMenuDeltas(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7342 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7343 </span>            : 
<span class="lineNum">    7344 </span><span class="lineNoCov">          0 :     if ( !hasFreeTypeDebugger())</span>
<span class="lineNum">    7345 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7346 </span><span class="lineNoCov">          0 :     DeltaSuggestionDlg(NULL,cv);</span>
<a name="7347"><span class="lineNum">    7347 </span>            : }</a>
<span class="lineNum">    7348 </span>            : 
<span class="lineNum">    7349 </span><span class="lineNoCov">          0 : static void CVMenuClearInstrs(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7350 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7351 </span>            : 
<span class="lineNum">    7352 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc-&gt;ttf_instrs_len!=0 ) {</span>
<span class="lineNum">    7353 </span><span class="lineNoCov">          0 :         free(cv-&gt;b.sc-&gt;ttf_instrs);</span>
<span class="lineNum">    7354 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;ttf_instrs = NULL;</span>
<span class="lineNum">    7355 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;ttf_instrs_len = 0;</span>
<span class="lineNum">    7356 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;instructions_out_of_date = false;</span>
<span class="lineNum">    7357 </span><span class="lineNoCov">          0 :         SCCharChangedUpdate(cv-&gt;b.sc,ly_none);</span>
<span class="lineNum">    7358 </span><span class="lineNoCov">          0 :         SCMarkInstrDlgAsChanged(cv-&gt;b.sc);</span>
<span class="lineNum">    7359 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;complained_about_ptnums = false;        /* Should be after CharChanged */</span>
<span class="lineNum">    7360 </span>            :     }
<a name="7361"><span class="lineNum">    7361 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7362 </span>            : 
<span class="lineNum">    7363 </span><span class="lineNoCov">          0 : static void CVMenuKernPairs(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7364 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7365 </span><span class="lineNoCov">          0 :     SFShowKernPairs(cv-&gt;b.sc-&gt;parent,cv-&gt;b.sc,NULL,CVLayer((CharViewBase *) cv));</span>
<a name="7366"><span class="lineNum">    7366 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7367 </span>            : 
<span class="lineNum">    7368 </span><span class="lineNoCov">          0 : static void CVMenuLigatures(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7369 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7370 </span><span class="lineNoCov">          0 :     SFShowLigatures(cv-&gt;b.fv-&gt;sf,cv-&gt;b.sc);</span>
<a name="7371"><span class="lineNum">    7371 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7372 </span>            : 
<span class="lineNum">    7373 </span><span class="lineNoCov">          0 : static void CVMenuAnchorPairs(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7374 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7375 </span><span class="lineNoCov">          0 :     SFShowKernPairs(cv-&gt;b.sc-&gt;parent,cv-&gt;b.sc,(AnchorClass *) (-1),CVLayer((CharViewBase *) cv));</span>
<a name="7376"><span class="lineNum">    7376 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7377 </span>            : 
<span class="lineNum">    7378 </span><span class="lineNoCov">          0 : static void CVMenuAPDetach(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7379 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7380 </span><span class="lineNoCov">          0 :     cv-&gt;apmine = cv-&gt;apmatch = NULL;</span>
<span class="lineNum">    7381 </span><span class="lineNoCov">          0 :     cv-&gt;apsc = NULL;</span>
<span class="lineNum">    7382 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="7383"><span class="lineNum">    7383 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7384 </span>            : 
<span class="lineNum">    7385 </span><span class="lineNoCov">          0 : static void CVMenuAPAttachSC(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7386 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7387 </span>            :     enum anchor_type type;
<span class="lineNum">    7388 </span>            :     AnchorPoint *ap;
<span class="lineNum">    7389 </span>            :     AnchorClass *ac;
<span class="lineNum">    7390 </span>            : 
<span class="lineNum">    7391 </span><span class="lineNoCov">          0 :     ap = mi-&gt;ti.userdata;</span>
<span class="lineNum">    7392 </span><span class="lineNoCov">          0 :     if ( ap==NULL )</span>
<span class="lineNum">    7393 </span><span class="lineNoCov">          0 :         for ( ap = cv-&gt;b.sc-&gt;anchor; ap!=NULL &amp;&amp; !ap-&gt;selected; ap=ap-&gt;next );</span>
<span class="lineNum">    7394 </span><span class="lineNoCov">          0 :     if ( ap==NULL )</span>
<span class="lineNum">    7395 </span><span class="lineNoCov">          0 :         ap = cv-&gt;b.sc-&gt;anchor;</span>
<span class="lineNum">    7396 </span><span class="lineNoCov">          0 :     if ( ap==NULL )</span>
<span class="lineNum">    7397 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7398 </span><span class="lineNoCov">          0 :     type = ap-&gt;type;</span>
<span class="lineNum">    7399 </span><span class="lineNoCov">          0 :     cv-&gt;apmine = ap;</span>
<span class="lineNum">    7400 </span><span class="lineNoCov">          0 :     ac = ap-&gt;anchor;</span>
<span class="lineNum">    7401 </span><span class="lineNoCov">          0 :     cv-&gt;apsc = mi-&gt;ti.userdata;</span>
<span class="lineNum">    7402 </span><span class="lineNoCov">          0 :     for ( ap = cv-&gt;apsc-&gt;anchor; ap!=NULL ; ap=ap-&gt;next ) {</span>
<span class="lineNum">    7403 </span><span class="lineNoCov">          0 :         if ( ap-&gt;anchor==ac &amp;&amp;</span>
<span class="lineNum">    7404 </span><span class="lineNoCov">          0 :                 ((type==at_centry &amp;&amp; ap-&gt;type==at_cexit) ||</span>
<span class="lineNum">    7405 </span><span class="lineNoCov">          0 :                  (type==at_cexit &amp;&amp; ap-&gt;type==at_centry) ||</span>
<span class="lineNum">    7406 </span><span class="lineNoCov">          0 :                  (type==at_mark &amp;&amp; ap-&gt;type!=at_mark) ||</span>
<span class="lineNum">    7407 </span><span class="lineNoCov">          0 :                  ((type==at_basechar || type==at_baselig || type==at_basemark) &amp;&amp; ap-&gt;type==at_mark)) )</span>
<span class="lineNum">    7408 </span>            :     break;
<span class="lineNum">    7409 </span>            :     }
<span class="lineNum">    7410 </span><span class="lineNoCov">          0 :     cv-&gt;apmatch = ap;</span>
<span class="lineNum">    7411 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<a name="7412"><span class="lineNum">    7412 </span>            : }</a>
<span class="lineNum">    7413 </span>            : 
<span class="lineNum">    7414 </span><span class="lineNoCov">          0 : static SplineChar **GlyphsMatchingAP(SplineFont *sf, AnchorPoint *ap) {</span>
<span class="lineNum">    7415 </span>            :     SplineChar *sc;
<span class="lineNum">    7416 </span><span class="lineNoCov">          0 :     AnchorClass *ac = ap-&gt;anchor;</span>
<span class="lineNum">    7417 </span><span class="lineNoCov">          0 :     enum anchor_type type = ap-&gt;type;</span>
<span class="lineNum">    7418 </span>            :     int i, k, gcnt;
<span class="lineNum">    7419 </span>            :     SplineChar **glyphs;
<span class="lineNum">    7420 </span>            : 
<span class="lineNum">    7421 </span><span class="lineNoCov">          0 :     glyphs = NULL;</span>
<span class="lineNum">    7422 </span><span class="lineNoCov">          0 :     for ( k=0; k&lt;2; ++k ) {</span>
<span class="lineNum">    7423 </span><span class="lineNoCov">          0 :         gcnt = 0;</span>
<span class="lineNum">    7424 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;sf-&gt;glyphcnt; ++i ) if ( (sc=sf-&gt;glyphs[i])!=NULL ) {</span>
<span class="lineNum">    7425 </span><span class="lineNoCov">          0 :             for ( ap = sc-&gt;anchor; ap!=NULL; ap=ap-&gt;next ) {</span>
<span class="lineNum">    7426 </span><span class="lineNoCov">          0 :                 if ( ap-&gt;anchor == ac &amp;&amp;</span>
<span class="lineNum">    7427 </span><span class="lineNoCov">          0 :                         ((type==at_centry &amp;&amp; ap-&gt;type==at_cexit) ||</span>
<span class="lineNum">    7428 </span><span class="lineNoCov">          0 :                          (type==at_cexit &amp;&amp; ap-&gt;type==at_centry) ||</span>
<span class="lineNum">    7429 </span><span class="lineNoCov">          0 :                          (type==at_mark &amp;&amp; ap-&gt;type!=at_mark) ||</span>
<span class="lineNum">    7430 </span><span class="lineNoCov">          0 :                          ((type==at_basechar || type==at_baselig || type==at_basemark) &amp;&amp; ap-&gt;type==at_mark)) )</span>
<span class="lineNum">    7431 </span>            :              break;
<span class="lineNum">    7432 </span>            :              }
<span class="lineNum">    7433 </span><span class="lineNoCov">          0 :              if ( ap!=NULL ) {</span>
<span class="lineNum">    7434 </span><span class="lineNoCov">          0 :                  if ( k )</span>
<span class="lineNum">    7435 </span><span class="lineNoCov">          0 :                      glyphs[gcnt] = sc;</span>
<span class="lineNum">    7436 </span><span class="lineNoCov">          0 :                  ++gcnt;</span>
<span class="lineNum">    7437 </span>            :              }
<span class="lineNum">    7438 </span>            :          }
<span class="lineNum">    7439 </span><span class="lineNoCov">          0 :          if ( !k ) {</span>
<span class="lineNum">    7440 </span><span class="lineNoCov">          0 :              if ( gcnt==0 )</span>
<span class="lineNum">    7441 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    7442 </span><span class="lineNoCov">          0 :              glyphs = malloc((gcnt+1)*sizeof(SplineChar *));</span>
<span class="lineNum">    7443 </span>            :          } else
<span class="lineNum">    7444 </span><span class="lineNoCov">          0 :              glyphs[gcnt] = NULL;</span>
<span class="lineNum">    7445 </span>            :      }
<span class="lineNum">    7446 </span><span class="lineNoCov">          0 : return( glyphs );</span>
<a name="7447"><span class="lineNum">    7447 </span>            : }</a>
<span class="lineNum">    7448 </span>            : 
<span class="lineNum">    7449 </span><span class="lineNoCov">          0 : static void _CVMenuChangeChar(CharView *cv, int mid) {</span>
<span class="lineNum">    7450 </span><span class="lineNoCov">          0 :     SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">    7451 </span><span class="lineNoCov">          0 :     int pos = -1;</span>
<span class="lineNum">    7452 </span>            :     int gid;
<span class="lineNum">    7453 </span><span class="lineNoCov">          0 :     EncMap *map = cv-&gt;b.fv-&gt;map;</span>
<span class="lineNum">    7454 </span><span class="lineNoCov">          0 :     Encoding *enc = map-&gt;enc;</span>
<span class="lineNum">    7455 </span>            : 
<span class="lineNum">    7456 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.container!=NULL ) {</span>
<span class="lineNum">    7457 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.container-&gt;funcs-&gt;doNavigate!=NULL &amp;&amp; mid != MID_Former)</span>
<span class="lineNum">    7458 </span><span class="lineNoCov">          0 :             (cv-&gt;b.container-&gt;funcs-&gt;doNavigate)(cv-&gt;b.container,</span>
<span class="lineNum">    7459 </span>            :                     mid==MID_Next ? nt_next :
<span class="lineNum">    7460 </span>            :                     mid==MID_Prev ? nt_prev :
<span class="lineNum">    7461 </span>            :                     mid==MID_NextDef ? nt_next :
<span class="lineNum">    7462 </span>            :                     /* mid==MID_PrevDef ?*/ nt_prev);
<span class="lineNum">    7463 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7464 </span>            :     }
<span class="lineNum">    7465 </span>            : 
<span class="lineNum">    7466 </span><span class="lineNoCov">          0 :     int curenc = CVCurEnc(cv);</span>
<span class="lineNum">    7467 </span>            :     
<span class="lineNum">    7468 </span><span class="lineNoCov">          0 :     if( cv-&gt;charselector )</span>
<span class="lineNum">    7469 </span>            :     {
<span class="lineNum">    7470 </span><span class="lineNoCov">          0 :         char* txt = GGadgetGetTitle8( cv-&gt;charselector );</span>
<span class="lineNum">    7471 </span><span class="lineNoCov">          0 :         if( txt &amp;&amp; strlen(txt) &gt; 1 )</span>
<span class="lineNum">    7472 </span>            :         {
<span class="lineNum">    7473 </span><span class="lineNoCov">          0 :             int offset = 1;</span>
<span class="lineNum">    7474 </span><span class="lineNoCov">          0 :             if ( mid == MID_Prev )</span>
<span class="lineNum">    7475 </span><span class="lineNoCov">          0 :                 offset = -1;</span>
<span class="lineNum">    7476 </span>            : 
<span class="lineNum">    7477 </span><span class="lineNoCov">          0 :             unichar_t *txtu = GGadgetGetTitle( cv-&gt;charselector );</span>
<span class="lineNum">    7478 </span><span class="lineNoCov">          0 :             unichar_t* r = Wordlist_advanceSelectedCharsBy( cv-&gt;b.sc-&gt;parent,</span>
<span class="lineNum">    7479 </span><span class="lineNoCov">          0 :                                                             ((FontView *) (cv-&gt;b.fv))-&gt;b.map,</span>
<span class="lineNum">    7480 </span>            :                                                             txtu, offset );
<span class="lineNum">    7481 </span><span class="lineNoCov">          0 :             free( txtu );</span>
<span class="lineNum">    7482 </span>            : 
<span class="lineNum">    7483 </span><span class="lineNoCov">          0 :             GGadgetSetTitle( cv-&gt;charselector, r );</span>
<span class="lineNum">    7484 </span>            :             // Force any extra chars to be setup and drawn
<span class="lineNum">    7485 </span>            :             GEvent e;
<span class="lineNum">    7486 </span><span class="lineNoCov">          0 :             e.type=et_controlevent;</span>
<span class="lineNum">    7487 </span><span class="lineNoCov">          0 :             e.u.control.subtype = et_textchanged;</span>
<span class="lineNum">    7488 </span><span class="lineNoCov">          0 :             e.u.control.u.tf_changed.from_pulldown = 0;</span>
<span class="lineNum">    7489 </span><span class="lineNoCov">          0 :             CV_OnCharSelectorTextChanged( cv-&gt;charselector, &amp;e );</span>
<span class="lineNum">    7490 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    7491 </span>            :         }
<span class="lineNum">    7492 </span>            :     }
<span class="lineNum">    7493 </span>            :     
<span class="lineNum">    7494 </span><span class="lineNoCov">          0 :     if ( mid == MID_Next ) {</span>
<span class="lineNum">    7495 </span><span class="lineNoCov">          0 :         pos = curenc+1;</span>
<span class="lineNum">    7496 </span><span class="lineNoCov">          0 :     } else if ( mid == MID_Prev ) {</span>
<span class="lineNum">    7497 </span><span class="lineNoCov">          0 :         pos = curenc-1;</span>
<span class="lineNum">    7498 </span><span class="lineNoCov">          0 :     } else if ( mid == MID_NextDef ) {</span>
<span class="lineNum">    7499 </span><span class="lineNoCov">          0 :         for ( pos = CVCurEnc(cv)+1; pos&lt;map-&gt;enccount &amp;&amp;</span>
<span class="lineNum">    7500 </span><span class="lineNoCov">          0 :                 ((gid=map-&gt;map[pos])==-1 || !SCWorthOutputting(sf-&gt;glyphs[gid])); ++pos );</span>
<span class="lineNum">    7501 </span><span class="lineNoCov">          0 :         if ( pos&gt;=map-&gt;enccount ) {</span>
<span class="lineNum">    7502 </span><span class="lineNoCov">          0 :             if ( enc-&gt;is_tradchinese ) {</span>
<span class="lineNum">    7503 </span><span class="lineNoCov">          0 :                 if ( strstrmatch(enc-&gt;enc_name,&quot;hkscs&quot;)!=NULL ) {</span>
<span class="lineNum">    7504 </span><span class="lineNoCov">          0 :                     if ( CVCurEnc(cv)&lt;0x8140 )</span>
<span class="lineNum">    7505 </span><span class="lineNoCov">          0 :                         pos = 0x8140;</span>
<span class="lineNum">    7506 </span>            :                 } else {
<span class="lineNum">    7507 </span><span class="lineNoCov">          0 :                     if ( CVCurEnc(cv)&lt;0xa140 )</span>
<span class="lineNum">    7508 </span><span class="lineNoCov">          0 :                         pos = 0xa140;</span>
<span class="lineNum">    7509 </span>            :                 }
<span class="lineNum">    7510 </span><span class="lineNoCov">          0 :             } else if ( CVCurEnc(cv)&lt;0x8431 &amp;&amp; strstrmatch(enc-&gt;enc_name,&quot;johab&quot;)!=NULL )</span>
<span class="lineNum">    7511 </span><span class="lineNoCov">          0 :                 pos = 0x8431;</span>
<span class="lineNum">    7512 </span><span class="lineNoCov">          0 :             else if ( CVCurEnc(cv)&lt;0xa1a1 &amp;&amp; strstrmatch(enc-&gt;iconv_name?enc-&gt;iconv_name:enc-&gt;enc_name,&quot;EUC&quot;)!=NULL )</span>
<span class="lineNum">    7513 </span><span class="lineNoCov">          0 :                 pos = 0xa1a1;</span>
<span class="lineNum">    7514 </span><span class="lineNoCov">          0 :             else if ( CVCurEnc(cv)&lt;0x8140 &amp;&amp; strstrmatch(enc-&gt;enc_name,&quot;sjis&quot;)!=NULL )</span>
<span class="lineNum">    7515 </span><span class="lineNoCov">          0 :                 pos = 0x8140;</span>
<span class="lineNum">    7516 </span><span class="lineNoCov">          0 :             else if ( CVCurEnc(cv)&lt;0xe040 &amp;&amp; strstrmatch(enc-&gt;enc_name,&quot;sjis&quot;)!=NULL )</span>
<span class="lineNum">    7517 </span><span class="lineNoCov">          0 :                 pos = 0xe040;</span>
<span class="lineNum">    7518 </span><span class="lineNoCov">          0 :             if ( pos&gt;=map-&gt;enccount )</span>
<span class="lineNum">    7519 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7520 </span>            :         }
<span class="lineNum">    7521 </span><span class="lineNoCov">          0 :     } else if ( mid == MID_PrevDef ) {</span>
<span class="lineNum">    7522 </span><span class="lineNoCov">          0 :         for ( pos = CVCurEnc(cv)-1; pos&gt;=0 &amp;&amp;</span>
<span class="lineNum">    7523 </span><span class="lineNoCov">          0 :                 ((gid=map-&gt;map[pos])==-1 || !SCWorthOutputting(sf-&gt;glyphs[gid])); --pos );</span>
<span class="lineNum">    7524 </span><span class="lineNoCov">          0 :         if ( pos&lt;0 )</span>
<span class="lineNum">    7525 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7526 </span><span class="lineNoCov">          0 :     } else if ( mid == MID_Former ) {</span>
<span class="lineNum">    7527 </span><span class="lineNoCov">          0 :         if ( cv-&gt;former_cnt&lt;=1 )</span>
<span class="lineNum">    7528 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7529 </span><span class="lineNoCov">          0 :         for ( gid=sf-&gt;glyphcnt-1; gid&gt;=0; --gid )</span>
<span class="lineNum">    7530 </span><span class="lineNoCov">          0 :             if ( sf-&gt;glyphs[gid]!=NULL &amp;&amp;</span>
<span class="lineNum">    7531 </span><span class="lineNoCov">          0 :                     strcmp(sf-&gt;glyphs[gid]-&gt;name,cv-&gt;former_names[1])==0 )</span>
<span class="lineNum">    7532 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    7533 </span><span class="lineNoCov">          0 :         if ( gid&lt;0 )</span>
<span class="lineNum">    7534 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7535 </span><span class="lineNoCov">          0 :         pos = map-&gt;backmap[gid];</span>
<span class="lineNum">    7536 </span>            :     }
<span class="lineNum">    7537 </span>            :     /* Werner doesn't think it should wrap */
<span class="lineNum">    7538 </span><span class="lineNoCov">          0 :     if ( pos&lt;0 ) /* pos = map-&gt;enccount-1; */</span>
<span class="lineNum">    7539 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7540 </span><span class="lineNoCov">          0 :     else if ( pos&gt;= map-&gt;enccount ) /* pos = 0; */</span>
<span class="lineNum">    7541 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    7542 </span>            : 
<span class="lineNum">    7543 </span><span class="lineNoCov">          0 :     if ( pos&gt;=0 &amp;&amp; pos&lt;map-&gt;enccount )</span>
<span class="lineNum">    7544 </span><span class="lineNoCov">          0 :         CVChangeChar(cv,pos);</span>
<span class="lineNum">    7545 </span>            : }
<a name="7546"><span class="lineNum">    7546 </span>            : </a>
<span class="lineNum">    7547 </span>            : 
<span class="lineNum">    7548 </span><span class="lineNoCov">          0 : static void CVMenuChangeChar(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    7549 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    7550 </span><span class="lineNoCov">          0 :     _CVMenuChangeChar(cv,mi-&gt;mid);</span>
<a name="7551"><span class="lineNum">    7551 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7552 </span>            : 
<span class="lineNum">    7553 </span><span class="lineNoCov">          0 : static int CVMoveToNextInWordList(GGadget *g, GEvent *e)</span>
<span class="lineNum">    7554 </span>            : {
<span class="lineNum">    7555 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    7556 </span><span class="lineNoCov">          0 :         CharView *cv = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    7557 </span><span class="lineNoCov">          0 :         CVMoveInWordListByOffset( cv, 1 );</span>
<span class="lineNum">    7558 </span>            :     }
<a name="7559"><span class="lineNum">    7559 </span><span class="lineNoCov">          0 :     return 1;</span></a>
<span class="lineNum">    7560 </span>            : }
<span class="lineNum">    7561 </span><span class="lineNoCov">          0 : static int CVMoveToPrevInWordList(GGadget *g, GEvent *e)</span>
<span class="lineNum">    7562 </span>            : {
<span class="lineNum">    7563 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    7564 </span><span class="lineNoCov">          0 :         CharView *cv = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    7565 </span><span class="lineNoCov">          0 :         CVMoveInWordListByOffset( cv, -1 );</span>
<span class="lineNum">    7566 </span>            :     }
<span class="lineNum">    7567 </span><span class="lineNoCov">          0 :     return 1;</span>
<span class="lineNum">    7568 </span>            : }
<span class="lineNum">    7569 </span>            : 
<span class="lineNum">    7570 </span>            : /**
<span class="lineNum">    7571 </span>            :  * If the prev/next BCP is selected than add those to the hash table
<a name="7572"><span class="lineNum">    7572 </span>            :  * at &quot;ret&quot;.</a>
<span class="lineNum">    7573 </span>            :  */
<span class="lineNum">    7574 </span><span class="lineNoCov">          0 : static void getSelectedControlPointsVisitor(SplinePoint* splfirst, Spline* s, SplinePoint* sp, void* udata )</span>
<span class="lineNum">    7575 </span>            : {
<span class="lineNum">    7576 </span><span class="lineNoCov">          0 :     GHashTable* ret = (GHashTable*)udata;</span>
<span class="lineNum">    7577 </span><span class="lineNoCov">          0 :     if( sp-&gt;nextcpselected )</span>
<span class="lineNum">    7578 </span><span class="lineNoCov">          0 :         g_hash_table_insert( ret, sp, 0 );</span>
<span class="lineNum">    7579 </span><span class="lineNoCov">          0 :     if( sp-&gt;prevcpselected )</span>
<a name="7580"><span class="lineNum">    7580 </span><span class="lineNoCov">          0 :         g_hash_table_insert( ret, sp, 0 );</span></a>
<span class="lineNum">    7581 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7582 </span><span class="lineNoCov">          0 : static void getAllControlPointsVisitor(SplinePoint* splfirst, Spline* s, SplinePoint* sp, void* udata )</span>
<span class="lineNum">    7583 </span>            : {
<span class="lineNum">    7584 </span><span class="lineNoCov">          0 :     GHashTable* ret = (GHashTable*)udata;</span>
<span class="lineNum">    7585 </span><span class="lineNoCov">          0 :     g_hash_table_insert( ret, sp, 0 );</span>
<a name="7586"><span class="lineNum">    7586 </span><span class="lineNoCov">          0 :     g_hash_table_insert( ret, sp, 0 );</span></a>
<span class="lineNum">    7587 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7588 </span><span class="lineNoCov">          0 : static void isAnyControlPointSelectedVisitor(SplinePoint* splfirst, Spline* s, SplinePoint* sp, void* udata )</span>
<span class="lineNum">    7589 </span>            : {
<span class="lineNum">    7590 </span><span class="lineNoCov">          0 :     int* ret = (int*)udata;</span>
<span class="lineNum">    7591 </span><span class="lineNoCov">          0 :     if( sp-&gt;selected )</span>
<span class="lineNum">    7592 </span><span class="lineNoCov">          0 :         (*ret) = 1;</span>
<span class="lineNum">    7593 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7594 </span>            : 
<span class="lineNum">    7595 </span>            : 
<span class="lineNum">    7596 </span>            : /**
<span class="lineNum">    7597 </span>            :  * Get a hash table with all the selected BCP in it.
<span class="lineNum">    7598 </span>            :  *
<a name="7599"><span class="lineNum">    7599 </span>            :  * The caller must call g_hash_table_destroy() on the return value.</a>
<span class="lineNum">    7600 </span>            :  */
<span class="lineNum">    7601 </span><span class="lineNoCov">          0 : static GHashTable* getSelectedControlPoints( CharView *cv, PressedOn *p )</span>
<span class="lineNum">    7602 </span>            : {
<span class="lineNum">    7603 </span><span class="lineNoCov">          0 :     Layer* l = cv-&gt;b.layerheads[cv-&gt;b.drawmode];</span>
<span class="lineNum">    7604 </span><span class="lineNoCov">          0 :     if( !l || !l-&gt;splines )</span>
<span class="lineNum">    7605 </span><span class="lineNoCov">          0 :         return 0;</span>
<span class="lineNum">    7606 </span>            : 
<span class="lineNum">    7607 </span><span class="lineNoCov">          0 :     GHashTable* ret = g_hash_table_new( g_direct_hash, g_direct_equal );</span>
<span class="lineNum">    7608 </span><span class="lineNoCov">          0 :     SplinePointList* spl = l-&gt;splines;</span>
<span class="lineNum">    7609 </span><span class="lineNoCov">          0 :     for( ; spl; spl = spl-&gt;next )</span>
<span class="lineNum">    7610 </span>            :     {
<span class="lineNum">    7611 </span><span class="lineNoCov">          0 :         SPLFirstVisitPoints( spl-&gt;first, getSelectedControlPointsVisitor, ret );</span>
<span class="lineNum">    7612 </span>            :     }
<span class="lineNum">    7613 </span>            : 
<a name="7614"><span class="lineNum">    7614 </span><span class="lineNoCov">          0 :     return ret;</span></a>
<span class="lineNum">    7615 </span>            : }
<span class="lineNum">    7616 </span><span class="lineNoCov">          0 : static GHashTable* getAllControlPoints( CharView *cv, PressedOn *p )</span>
<span class="lineNum">    7617 </span>            : {
<span class="lineNum">    7618 </span><span class="lineNoCov">          0 :     Layer* l = cv-&gt;b.layerheads[cv-&gt;b.drawmode];</span>
<span class="lineNum">    7619 </span><span class="lineNoCov">          0 :     if( !l || !l-&gt;splines )</span>
<span class="lineNum">    7620 </span><span class="lineNoCov">          0 :         return 0;</span>
<span class="lineNum">    7621 </span>            : 
<span class="lineNum">    7622 </span><span class="lineNoCov">          0 :     GHashTable* ret = g_hash_table_new( g_direct_hash, g_direct_equal );</span>
<span class="lineNum">    7623 </span><span class="lineNoCov">          0 :     SplinePointList* spl = l-&gt;splines;</span>
<span class="lineNum">    7624 </span><span class="lineNoCov">          0 :     for( ; spl; spl = spl-&gt;next )</span>
<span class="lineNum">    7625 </span>            :     {
<span class="lineNum">    7626 </span><span class="lineNoCov">          0 :         SPLFirstVisitPoints( spl-&gt;first, getAllControlPointsVisitor, ret );</span>
<span class="lineNum">    7627 </span>            :     }
<span class="lineNum">    7628 </span><span class="lineNoCov">          0 :     return ret;</span>
<a name="7629"><span class="lineNum">    7629 </span>            : }</a>
<span class="lineNum">    7630 </span>            : 
<span class="lineNum">    7631 </span><span class="lineNoCov">          0 : void FE_touchControlPoint( void* key,</span>
<span class="lineNum">    7632 </span>            :                            void* value,
<span class="lineNum">    7633 </span>            :                            SplinePoint* sp,
<span class="lineNum">    7634 </span>            :                            BasePoint *which,
<span class="lineNum">    7635 </span>            :                            bool isnext,
<span class="lineNum">    7636 </span>            :                            void* udata )
<span class="lineNum">    7637 </span>            : {
<span class="lineNum">    7638 </span>            :     TRACE(&quot;FE_touchControlPoint() which:%p\n&quot;, which );
<span class="lineNum">    7639 </span><span class="lineNoCov">          0 :     SPTouchControl( sp, which, (int)(intptr_t)udata );</span>
<a name="7640"><span class="lineNum">    7640 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7641 </span>            : 
<span class="lineNum">    7642 </span><span class="lineNoCov">          0 : void FE_unselectBCP( void* key,</span>
<span class="lineNum">    7643 </span>            :                      void* value,
<span class="lineNum">    7644 </span>            :                      SplinePoint* sp,
<span class="lineNum">    7645 </span>            :                      BasePoint *which,
<span class="lineNum">    7646 </span>            :                      bool isnext,
<span class="lineNum">    7647 </span>            :                      void* udata )
<span class="lineNum">    7648 </span>            : {
<span class="lineNum">    7649 </span><span class="lineNoCov">          0 :     sp-&gt;nextcpselected = 0;</span>
<span class="lineNum">    7650 </span><span class="lineNoCov">          0 :     sp-&gt;prevcpselected = 0;</span>
<a name="7651"><span class="lineNum">    7651 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7652 </span>            : 
<span class="lineNum">    7653 </span><span class="lineNoCov">          0 : void FE_adjustBCPByDelta( void* key,</span>
<span class="lineNum">    7654 </span>            :                           void* value,
<span class="lineNum">    7655 </span>            :                           SplinePoint* sp,
<span class="lineNum">    7656 </span>            :                           BasePoint *which,
<span class="lineNum">    7657 </span>            :                           bool isnext,
<span class="lineNum">    7658 </span>            :                           void* udata )
<span class="lineNum">    7659 </span>            : {
<span class="lineNum">    7660 </span><span class="lineNoCov">          0 :     FE_adjustBCPByDeltaData* data = (FE_adjustBCPByDeltaData*)udata;</span>
<span class="lineNum">    7661 </span><span class="lineNoCov">          0 :     CharView *cv = data-&gt;cv;</span>
<span class="lineNum">    7662 </span>            : 
<span class="lineNum">    7663 </span>            :     TRACE(&quot;FE_adjustBCPByDelta %p %d\n&quot;, which, isnext );
<span class="lineNum">    7664 </span>            :     BasePoint to;
<span class="lineNum">    7665 </span><span class="lineNoCov">          0 :     to.x = which-&gt;x + data-&gt;dx;</span>
<span class="lineNum">    7666 </span><span class="lineNoCov">          0 :     to.y = which-&gt;y + data-&gt;dy;</span>
<span class="lineNum">    7667 </span><span class="lineNoCov">          0 :     SPAdjustControl(sp,which,&amp;to,cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2);</span>
<span class="lineNum">    7668 </span><span class="lineNoCov">          0 :     CVSetCharChanged(cv,true);</span>
<a name="7669"><span class="lineNum">    7669 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7670 </span>            : 
<span class="lineNum">    7671 </span><span class="lineNoCov">          0 : void FE_adjustBCPByDeltaWhilePreservingBCPAngle( void* key,</span>
<span class="lineNum">    7672 </span>            :                                                  void* value,
<span class="lineNum">    7673 </span>            :                                                  SplinePoint* sp,
<span class="lineNum">    7674 </span>            :                                                  BasePoint *which,
<span class="lineNum">    7675 </span>            :                                                  bool isnext,
<span class="lineNum">    7676 </span>            :                                                  void* udata )
<span class="lineNum">    7677 </span>            : {
<span class="lineNum">    7678 </span><span class="lineNoCov">          0 :     FE_adjustBCPByDeltaData* data = (FE_adjustBCPByDeltaData*)udata;</span>
<span class="lineNum">    7679 </span><span class="lineNoCov">          0 :     CharView *cv = data-&gt;cv;</span>
<span class="lineNum">    7680 </span>            : 
<span class="lineNum">    7681 </span>            : //    TRACE(&quot;FE_adjustBCPByDeltaWhilePreservingBCPAngle which:%p data:%p isnext:%d\n&quot;, which, data, isnext );
<span class="lineNum">    7682 </span>            : //    TRACE(&quot;FE_adjustBCPByDeltaWhilePreservingBCPAngle    delta %f %f\n&quot;, data-&gt;dx, data-&gt;dy );
<span class="lineNum">    7683 </span>            :     BasePoint to;
<span class="lineNum">    7684 </span><span class="lineNoCov">          0 :     to.x = which-&gt;x + data-&gt;dx;</span>
<span class="lineNum">    7685 </span><span class="lineNoCov">          0 :     to.y = which-&gt;y + data-&gt;dy;</span>
<span class="lineNum">    7686 </span>            : 
<span class="lineNum">    7687 </span>            :     // work out near and far BCP for this movement
<span class="lineNum">    7688 </span><span class="lineNoCov">          0 :     BasePoint* near = &amp;sp-&gt;nextcp;</span>
<span class="lineNum">    7689 </span><span class="lineNoCov">          0 :     BasePoint* far  = &amp;sp-&gt;prevcp;</span>
<span class="lineNum">    7690 </span><span class="lineNoCov">          0 :     if( !isnext )</span>
<span class="lineNum">    7691 </span>            :     {
<span class="lineNum">    7692 </span><span class="lineNoCov">          0 :         near = &amp;sp-&gt;prevcp;</span>
<span class="lineNum">    7693 </span><span class="lineNoCov">          0 :         far  = &amp;sp-&gt;nextcp;</span>
<span class="lineNum">    7694 </span>            :     }
<span class="lineNum">    7695 </span>            : 
<span class="lineNum">    7696 </span><span class="lineNoCov">          0 :     real dx = near-&gt;x - far-&gt;x;</span>
<span class="lineNum">    7697 </span><span class="lineNoCov">          0 :     if( !fabs(dx) )</span>
<span class="lineNum">    7698 </span>            :     {
<span class="lineNum">    7699 </span>            :         // flatline protection
<span class="lineNum">    7700 </span><span class="lineNoCov">          0 :         to.x = which-&gt;x + data-&gt;dx;</span>
<span class="lineNum">    7701 </span><span class="lineNoCov">          0 :         to.y = which-&gt;y + data-&gt;dy;</span>
<span class="lineNum">    7702 </span>            :     }
<span class="lineNum">    7703 </span>            :     else
<span class="lineNum">    7704 </span>            :     {
<span class="lineNum">    7705 </span>            :         // we have a workable gradient
<span class="lineNum">    7706 </span><span class="lineNoCov">          0 :         real m = (near-&gt;y - far-&gt;y) / dx;</span>
<span class="lineNum">    7707 </span>            : 
<span class="lineNum">    7708 </span>            :         // should we lean to x or y for the change?
<span class="lineNum">    7709 </span>            :         // all this is based on m = y2-y1/x2-x1
<span class="lineNum">    7710 </span>            :         // we use m from near and far and extrapolate to the new location
<span class="lineNum">    7711 </span>            :         // based on either x or y and calculate the other ordinate from the
<span class="lineNum">    7712 </span>            :         // gradiant function above.
<span class="lineNum">    7713 </span><span class="lineNoCov">          0 :         if( fabs(m) &lt; 1.0 )</span>
<span class="lineNum">    7714 </span>            :         {
<span class="lineNum">    7715 </span><span class="lineNoCov">          0 :             real datadx = data-&gt;dx;</span>
<span class="lineNum">    7716 </span><span class="lineNoCov">          0 :             if( data-&gt;keyboarddx &amp;&amp; !datadx )</span>
<span class="lineNum">    7717 </span>            :             {
<span class="lineNum">    7718 </span><span class="lineNoCov">          0 :                 datadx = data-&gt;dy;</span>
<span class="lineNum">    7719 </span><span class="lineNoCov">          0 :                 if( m &lt; 0 )</span>
<span class="lineNum">    7720 </span><span class="lineNoCov">          0 :                     datadx *= -1;</span>
<span class="lineNum">    7721 </span>            :             }
<span class="lineNum">    7722 </span>            :             
<span class="lineNum">    7723 </span><span class="lineNoCov">          0 :             real dx = near-&gt;x - far-&gt;x;</span>
<span class="lineNum">    7724 </span><span class="lineNoCov">          0 :             real m = (near-&gt;y - far-&gt;y) / dx;</span>
<span class="lineNum">    7725 </span><span class="lineNoCov">          0 :             to.x = which-&gt;x + datadx;</span>
<span class="lineNum">    7726 </span><span class="lineNoCov">          0 :             to.y = m * (to.x - near-&gt;x) + near-&gt;y;</span>
<span class="lineNum">    7727 </span>            :         }
<span class="lineNum">    7728 </span>            :         else
<span class="lineNum">    7729 </span>            :         {
<span class="lineNum">    7730 </span><span class="lineNoCov">          0 :             real datady = data-&gt;dy;</span>
<span class="lineNum">    7731 </span><span class="lineNoCov">          0 :             if( data-&gt;keyboarddx &amp;&amp; !datady )</span>
<span class="lineNum">    7732 </span>            :             {
<span class="lineNum">    7733 </span><span class="lineNoCov">          0 :                 datady = data-&gt;dx;</span>
<span class="lineNum">    7734 </span><span class="lineNoCov">          0 :                 if( m &lt; 0 )</span>
<span class="lineNum">    7735 </span><span class="lineNoCov">          0 :                     datady *= -1;</span>
<span class="lineNum">    7736 </span>            :             }
<span class="lineNum">    7737 </span><span class="lineNoCov">          0 :             real dx = near-&gt;x - far-&gt;x;</span>
<span class="lineNum">    7738 </span><span class="lineNoCov">          0 :             real m = (near-&gt;y - far-&gt;y) / dx;</span>
<span class="lineNum">    7739 </span><span class="lineNoCov">          0 :             to.y = which-&gt;y + datady;</span>
<span class="lineNum">    7740 </span><span class="lineNoCov">          0 :             to.x = (to.y - near-&gt;y + m*near-&gt;x) / m;</span>
<span class="lineNum">    7741 </span>            :         }
<span class="lineNum">    7742 </span>            :     }
<span class="lineNum">    7743 </span>            : 
<span class="lineNum">    7744 </span>            :     // move the point and update
<span class="lineNum">    7745 </span><span class="lineNoCov">          0 :     SPAdjustControl(sp,which,&amp;to,cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2);</span>
<span class="lineNum">    7746 </span><span class="lineNoCov">          0 :     CVSetCharChanged(cv,true);</span>
<span class="lineNum">    7747 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7748 </span>            : 
<span class="lineNum">    7749 </span>            : /**
<span class="lineNum">    7750 </span>            :  * Container for arguments to FE_visitSelectedControlPoints.
<span class="lineNum">    7751 </span>            :  */
<span class="lineNum">    7752 </span>            : typedef struct visitSelectedControlPoints_CallbackDataS
<span class="lineNum">    7753 </span>            : {
<span class="lineNum">    7754 </span>            :     int count;                              // number of times visitor is called.
<span class="lineNum">    7755 </span>            :     int sel;
<span class="lineNum">    7756 </span>            :     visitSelectedControlPointsVisitor func; // Visitor function to delegate to
<span class="lineNum">    7757 </span>            :     gpointer udata;                         // user data to use when calling above func()
<span class="lineNum">    7758 </span>            : 
<span class="lineNum">    7759 </span>            : } visitSelectedControlPoints_CallbackData;
<span class="lineNum">    7760 </span>            : 
<span class="lineNum">    7761 </span>            : /**
<span class="lineNum">    7762 </span>            :  * Visitor function: calls a delegate visitor function for any prev
<span class="lineNum">    7763 </span>            :  * and next BCP which are selected for each spline point. This is a
<span class="lineNum">    7764 </span>            :  * handy visitor when your BCP handling code for the most part doesn't
<span class="lineNum">    7765 </span>            :  * care if it will operate on the next or prev BCP, ie your visitor
<a name="7766"><span class="lineNum">    7766 </span>            :  * simply wants to visit all the selected BCP.</a>
<span class="lineNum">    7767 </span>            :  */
<span class="lineNum">    7768 </span><span class="lineNoCov">          0 : static void FE_visitSelectedControlPoints( gpointer key,</span>
<span class="lineNum">    7769 </span>            :                                            gpointer value,
<span class="lineNum">    7770 </span>            :                                            gpointer udata )
<span class="lineNum">    7771 </span>            : {
<span class="lineNum">    7772 </span><span class="lineNoCov">          0 :     visitSelectedControlPoints_CallbackData* d = (visitSelectedControlPoints_CallbackData*)udata;</span>
<span class="lineNum">    7773 </span><span class="lineNoCov">          0 :     SplinePoint* sp = (SplinePoint*)key;</span>
<span class="lineNum">    7774 </span>            : 
<span class="lineNum">    7775 </span><span class="lineNoCov">          0 :     d-&gt;count++;</span>
<span class="lineNum">    7776 </span><span class="lineNoCov">          0 :     if( sp-&gt;nextcpselected )</span>
<span class="lineNum">    7777 </span>            :     {
<span class="lineNum">    7778 </span><span class="lineNoCov">          0 :         BasePoint *which = &amp;sp-&gt;nextcp;</span>
<span class="lineNum">    7779 </span><span class="lineNoCov">          0 :         d-&gt;func( key, value, sp, which, true, d-&gt;udata );</span>
<span class="lineNum">    7780 </span>            :     }
<span class="lineNum">    7781 </span><span class="lineNoCov">          0 :     if( sp-&gt;prevcpselected )</span>
<span class="lineNum">    7782 </span>            :     {
<span class="lineNum">    7783 </span><span class="lineNoCov">          0 :         BasePoint *which = &amp;sp-&gt;prevcp;</span>
<span class="lineNum">    7784 </span><span class="lineNoCov">          0 :         d-&gt;func( key, value, sp, which, false, d-&gt;udata );</span>
<a name="7785"><span class="lineNum">    7785 </span>            :     }</a>
<span class="lineNum">    7786 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7787 </span><span class="lineNoCov">          0 : static void FE_visitAllControlPoints( gpointer key,</span>
<span class="lineNum">    7788 </span>            :                                       gpointer value,
<span class="lineNum">    7789 </span>            :                                       gpointer udata )
<span class="lineNum">    7790 </span>            : {
<span class="lineNum">    7791 </span><span class="lineNoCov">          0 :     visitSelectedControlPoints_CallbackData* d = (visitSelectedControlPoints_CallbackData*)udata;</span>
<span class="lineNum">    7792 </span><span class="lineNoCov">          0 :     SplinePoint* sp = (SplinePoint*)key;</span>
<span class="lineNum">    7793 </span>            : 
<span class="lineNum">    7794 </span><span class="lineNoCov">          0 :     d-&gt;count++;</span>
<span class="lineNum">    7795 </span>            :     {
<span class="lineNum">    7796 </span><span class="lineNoCov">          0 :         BasePoint *which = &amp;sp-&gt;nextcp;</span>
<span class="lineNum">    7797 </span><span class="lineNoCov">          0 :         d-&gt;func( key, value, sp, which, true, d-&gt;udata );</span>
<span class="lineNum">    7798 </span>            :     }
<span class="lineNum">    7799 </span>            :     {
<span class="lineNum">    7800 </span><span class="lineNoCov">          0 :         BasePoint *which = &amp;sp-&gt;prevcp;</span>
<span class="lineNum">    7801 </span><span class="lineNoCov">          0 :         d-&gt;func( key, value, sp, which, false, d-&gt;udata );</span>
<a name="7802"><span class="lineNum">    7802 </span>            :     }</a>
<span class="lineNum">    7803 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7804 </span><span class="lineNoCov">          0 : static void FE_visitAdjacentToSelectedControlPoints( gpointer key,</span>
<span class="lineNum">    7805 </span>            :                                                      gpointer value,
<span class="lineNum">    7806 </span>            :                                                      gpointer udata )
<span class="lineNum">    7807 </span>            : {
<span class="lineNum">    7808 </span><span class="lineNoCov">          0 :     visitSelectedControlPoints_CallbackData* d = (visitSelectedControlPoints_CallbackData*)udata;</span>
<span class="lineNum">    7809 </span><span class="lineNoCov">          0 :     SplinePoint* sp = (SplinePoint*)key;</span>
<span class="lineNum">    7810 </span>            : 
<span class="lineNum">    7811 </span><span class="lineNoCov">          0 :     if( sp-&gt;selected )</span>
<span class="lineNum">    7812 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    7813 </span>            : 
<span class="lineNum">    7814 </span><span class="lineNoCov">          0 :     d-&gt;count++;</span>
<span class="lineNum">    7815 </span><span class="lineNoCov">          0 :     if( sp-&gt;prev &amp;&amp; sp-&gt;prev-&gt;from &amp;&amp; sp-&gt;prev-&gt;from-&gt;selected )</span>
<span class="lineNum">    7816 </span>            :     {
<span class="lineNum">    7817 </span><span class="lineNoCov">          0 :         d-&gt;func( key, value, sp, &amp;sp-&gt;nextcp, true, d-&gt;udata );</span>
<span class="lineNum">    7818 </span><span class="lineNoCov">          0 :         d-&gt;func( key, value, sp, &amp;sp-&gt;prevcp, true, d-&gt;udata );</span>
<span class="lineNum">    7819 </span>            :     }
<span class="lineNum">    7820 </span><span class="lineNoCov">          0 :     if( sp-&gt;next &amp;&amp; sp-&gt;next-&gt;to &amp;&amp; sp-&gt;next-&gt;to-&gt;selected )</span>
<span class="lineNum">    7821 </span>            :     {
<span class="lineNum">    7822 </span><span class="lineNoCov">          0 :         d-&gt;func( key, value, sp, &amp;sp-&gt;nextcp, true, d-&gt;udata );</span>
<span class="lineNum">    7823 </span><span class="lineNoCov">          0 :         d-&gt;func( key, value, sp, &amp;sp-&gt;prevcp, true, d-&gt;udata );</span>
<span class="lineNum">    7824 </span>            :     }
<a name="7825"><span class="lineNum">    7825 </span>            : }</a>
<span class="lineNum">    7826 </span>            : 
<span class="lineNum">    7827 </span><span class="lineNoCov">          0 : void visitSelectedControlPoints( GHashTable *col, visitSelectedControlPointsVisitor f, gpointer udata )</span>
<span class="lineNum">    7828 </span>            : {
<span class="lineNum">    7829 </span>            :     visitSelectedControlPoints_CallbackData d;
<span class="lineNum">    7830 </span><span class="lineNoCov">          0 :     d.func = f;</span>
<span class="lineNum">    7831 </span><span class="lineNoCov">          0 :     d.udata = udata;</span>
<span class="lineNum">    7832 </span><span class="lineNoCov">          0 :     d.count = 0;</span>
<span class="lineNum">    7833 </span><span class="lineNoCov">          0 :     g_hash_table_foreach( col, FE_visitSelectedControlPoints, &amp;d );</span>
<a name="7834"><span class="lineNum">    7834 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7835 </span>            : 
<span class="lineNum">    7836 </span><span class="lineNoCov">          0 : void visitAllControlPoints( GHashTable *col, visitSelectedControlPointsVisitor f, gpointer udata )</span>
<span class="lineNum">    7837 </span>            : {
<span class="lineNum">    7838 </span>            :     visitSelectedControlPoints_CallbackData d;
<span class="lineNum">    7839 </span><span class="lineNoCov">          0 :     d.func = f;</span>
<span class="lineNum">    7840 </span><span class="lineNoCov">          0 :     d.udata = udata;</span>
<span class="lineNum">    7841 </span><span class="lineNoCov">          0 :     d.count = 0;</span>
<a name="7842"><span class="lineNum">    7842 </span><span class="lineNoCov">          0 :     g_hash_table_foreach( col, FE_visitAllControlPoints, &amp;d );</span></a>
<span class="lineNum">    7843 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7844 </span><span class="lineNoCov">          0 : static void visitAdjacentToSelectedControlPoints( GHashTable *col, visitSelectedControlPointsVisitor f, gpointer udata )</span>
<span class="lineNum">    7845 </span>            : {
<span class="lineNum">    7846 </span>            :     visitSelectedControlPoints_CallbackData d;
<span class="lineNum">    7847 </span><span class="lineNoCov">          0 :     d.func = f;</span>
<span class="lineNum">    7848 </span><span class="lineNoCov">          0 :     d.udata = udata;</span>
<span class="lineNum">    7849 </span><span class="lineNoCov">          0 :     d.count = 0;</span>
<span class="lineNum">    7850 </span><span class="lineNoCov">          0 :     g_hash_table_foreach( col, FE_visitAdjacentToSelectedControlPoints, &amp;d );</span>
<a name="7851"><span class="lineNum">    7851 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7852 </span>            : 
<span class="lineNum">    7853 </span><span class="lineNoCov">          0 : void CVFindAndVisitSelectedControlPoints( CharView *cv, bool preserveState,</span>
<span class="lineNum">    7854 </span>            :                                           visitSelectedControlPointsVisitor f, void* udata )
<span class="lineNum">    7855 </span>            : {
<span class="lineNum">    7856 </span>            : //    TRACE(&quot;CVFindAndVisitSelectedControlPoints(top) cv-&gt;p.sp:%p\n&quot;, cv-&gt;p.sp );
<span class="lineNum">    7857 </span><span class="lineNoCov">          0 :     GHashTable* col = getSelectedControlPoints( cv, &amp;cv-&gt;p );</span>
<span class="lineNum">    7858 </span><span class="lineNoCov">          0 :     if(!col)</span>
<span class="lineNum">    7859 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    7860 </span>            :     
<span class="lineNum">    7861 </span><span class="lineNoCov">          0 :     if( g_hash_table_size( col ) )</span>
<span class="lineNum">    7862 </span>            :     {
<span class="lineNum">    7863 </span><span class="lineNoCov">          0 :         if( preserveState )</span>
<span class="lineNum">    7864 </span><span class="lineNoCov">          0 :             CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    7865 </span><span class="lineNoCov">          0 :         visitSelectedControlPoints( col, f, udata );</span>
<span class="lineNum">    7866 </span>            :     }
<span class="lineNum">    7867 </span><span class="lineNoCov">          0 :     g_hash_table_destroy(col);</span>
<a name="7868"><span class="lineNum">    7868 </span>            : }</a>
<span class="lineNum">    7869 </span>            : 
<span class="lineNum">    7870 </span><span class="lineNoCov">          0 : void CVVisitAllControlPoints( CharView *cv, bool preserveState,</span>
<span class="lineNum">    7871 </span>            :                               visitSelectedControlPointsVisitor f, void* udata )
<span class="lineNum">    7872 </span>            : {
<span class="lineNum">    7873 </span>            :     TRACE(&quot;CVVisitAllControlPoints(top) cv-&gt;p.spl:%p cv-&gt;p.sp:%p\n&quot;, cv-&gt;p.spl, cv-&gt;p.sp );
<span class="lineNum">    7874 </span><span class="lineNoCov">          0 :     if( !cv-&gt;p.spl || !cv-&gt;p.sp )</span>
<span class="lineNum">    7875 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    7876 </span>            : 
<span class="lineNum">    7877 </span><span class="lineNoCov">          0 :     GHashTable* col = getAllControlPoints( cv, &amp;cv-&gt;p );</span>
<span class="lineNum">    7878 </span><span class="lineNoCov">          0 :     if( g_hash_table_size( col ) )</span>
<span class="lineNum">    7879 </span>            :     {
<span class="lineNum">    7880 </span><span class="lineNoCov">          0 :         if( preserveState )</span>
<span class="lineNum">    7881 </span><span class="lineNoCov">          0 :             CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    7882 </span><span class="lineNoCov">          0 :         visitAllControlPoints( col, f, udata );</span>
<span class="lineNum">    7883 </span>            :     }
<span class="lineNum">    7884 </span><span class="lineNoCov">          0 :     g_hash_table_destroy(col);</span>
<a name="7885"><span class="lineNum">    7885 </span>            : }</a>
<span class="lineNum">    7886 </span>            : 
<span class="lineNum">    7887 </span><span class="lineNoCov">          0 : void CVVisitAdjacentToSelectedControlPoints( CharView *cv, bool preserveState,</span>
<span class="lineNum">    7888 </span>            :                                              visitSelectedControlPointsVisitor f, void* udata )
<span class="lineNum">    7889 </span>            : {
<span class="lineNum">    7890 </span>            : //    TRACE(&quot;CVVisitAdjacentToSelectedControlPoints(top) cv-&gt;p.sp:%p\n&quot;, cv-&gt;p.sp );
<span class="lineNum">    7891 </span><span class="lineNoCov">          0 :     if( !cv-&gt;p.spl || !cv-&gt;p.sp )</span>
<span class="lineNum">    7892 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    7893 </span>            : 
<span class="lineNum">    7894 </span><span class="lineNoCov">          0 :     GHashTable* col = getAllControlPoints( cv, &amp;cv-&gt;p );</span>
<span class="lineNum">    7895 </span><span class="lineNoCov">          0 :     if( !col )</span>
<span class="lineNum">    7896 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    7897 </span>            : 
<span class="lineNum">    7898 </span><span class="lineNoCov">          0 :     if( g_hash_table_size( col ) )</span>
<span class="lineNum">    7899 </span>            :     {
<span class="lineNum">    7900 </span><span class="lineNoCov">          0 :         if( preserveState )</span>
<span class="lineNum">    7901 </span><span class="lineNoCov">          0 :             CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    7902 </span><span class="lineNoCov">          0 :         visitAdjacentToSelectedControlPoints( col, f, udata );</span>
<span class="lineNum">    7903 </span>            :     }
<span class="lineNum">    7904 </span><span class="lineNoCov">          0 :     g_hash_table_destroy(col);</span>
<span class="lineNum">    7905 </span>            : }
<span class="lineNum">    7906 </span>            : 
<a name="7907"><span class="lineNum">    7907 </span>            : </a>
<span class="lineNum">    7908 </span>            : 
<span class="lineNum">    7909 </span><span class="lineNoCov">          0 : void CVChar(CharView *cv, GEvent *event ) {</span>
<span class="lineNum">    7910 </span>            :     extern float arrowAmount, arrowAccelFactor;
<span class="lineNum">    7911 </span>            :     extern int navigation_mask;
<span class="lineNum">    7912 </span>            : 
<span class="lineNum">    7913 </span><span class="lineNoCov">          0 :     if( !cv_auto_goto )</span>
<span class="lineNum">    7914 </span>            :     {
<span class="lineNum">    7915 </span><span class="lineNoCov">          0 :         if( event-&gt;u.chr.keysym == GK_Control_L</span>
<span class="lineNum">    7916 </span><span class="lineNoCov">          0 :             || event-&gt;u.chr.keysym == GK_Control_R )</span>
<span class="lineNum">    7917 </span>            :         {
<span class="lineNum">    7918 </span><span class="lineNoCov">          0 :             HaveModifiers = 1;</span>
<span class="lineNum">    7919 </span>            :         }
<span class="lineNum">    7920 </span><span class="lineNoCov">          0 :         bool isImmediateKeyTogglePreview = isImmediateKey( cv-&gt;gw, &quot;TogglePreview&quot;, event ) != NULL;</span>
<span class="lineNum">    7921 </span>            : 
<span class="lineNum">    7922 </span><span class="lineNoCov">          0 :         if( !HaveModifiers &amp;&amp; isImmediateKeyTogglePreview ) {</span>
<span class="lineNum">    7923 </span><span class="lineNoCov">          0 :             PressingTilde = 1;</span>
<span class="lineNum">    7924 </span><span class="lineNoCov">          0 :             CVPreviewModeSet( cv-&gt;gw, true );</span>
<span class="lineNum">    7925 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    7926 </span>            :         }
<span class="lineNum">    7927 </span>            :     }
<span class="lineNum">    7928 </span>            : 
<span class="lineNum">    7929 </span>            :     /* TRACE(&quot;GK_Control_L:%d\n&quot;, ( event-&gt;u.chr.keysym == GK_Control_L )); */
<span class="lineNum">    7930 </span>            :     /* TRACE(&quot;GK_Meta_L:%d\n&quot;, ( event-&gt;u.chr.keysym == GK_Meta_L )); */
<span class="lineNum">    7931 </span>            :     
<span class="lineNum">    7932 </span><span class="lineNoCov">          0 :     int oldactiveModifierControl = cv-&gt;activeModifierControl;</span>
<span class="lineNum">    7933 </span><span class="lineNoCov">          0 :     int oldactiveModifierAlt = cv-&gt;activeModifierAlt;</span>
<span class="lineNum">    7934 </span><span class="lineNoCov">          0 :     cv-&gt;activeModifierControl |= ( event-&gt;u.chr.keysym == GK_Control_L || event-&gt;u.chr.keysym == GK_Control_R</span>
<span class="lineNum">    7935 </span><span class="lineNoCov">          0 :                                    || event-&gt;u.chr.keysym == GK_Meta_L || event-&gt;u.chr.keysym == GK_Meta_R );</span>
<span class="lineNum">    7936 </span><span class="lineNoCov">          0 :     cv-&gt;activeModifierAlt     |= ( event-&gt;u.chr.keysym == GK_Alt_L || event-&gt;u.chr.keysym == GK_Alt_R</span>
<span class="lineNum">    7937 </span><span class="lineNoCov">          0 :                                    || event-&gt;u.chr.keysym == XK_Mode_switch );</span>
<span class="lineNum">    7938 </span>            : 
<span class="lineNum">    7939 </span><span class="lineNoCov">          0 :     if( oldactiveModifierControl != cv-&gt;activeModifierControl</span>
<span class="lineNum">    7940 </span><span class="lineNoCov">          0 :         || oldactiveModifierAlt != cv-&gt;activeModifierAlt )</span>
<span class="lineNum">    7941 </span>            :     {
<span class="lineNum">    7942 </span><span class="lineNoCov">          0 :         CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    7943 </span>            :     }
<span class="lineNum">    7944 </span>            :     
<span class="lineNum">    7945 </span>            :     
<span class="lineNum">    7946 </span>            : #if _ModKeysAutoRepeat
<span class="lineNum">    7947 </span>            :         /* Under cygwin these keys auto repeat, they don't under normal X */
<span class="lineNum">    7948 </span>            :         if ( cv-&gt;autorpt!=NULL ) {
<span class="lineNum">    7949 </span>            :             GDrawCancelTimer(cv-&gt;autorpt); cv-&gt;autorpt = NULL;
<span class="lineNum">    7950 </span>            :             if ( cv-&gt;keysym == event-&gt;u.chr.keysym )      /* It's an autorepeat, ignore it */
<span class="lineNum">    7951 </span>            : return;
<span class="lineNum">    7952 </span>            :             CVToolsSetCursor(cv,cv-&gt;oldstate,NULL);
<span class="lineNum">    7953 </span>            :         }
<span class="lineNum">    7954 </span>            : #endif
<span class="lineNum">    7955 </span>            : 
<span class="lineNum">    7956 </span>            : #if MyMemory
<span class="lineNum">    7957 </span>            :     if ( event-&gt;u.chr.keysym == GK_F2 ) {
<span class="lineNum">    7958 </span>            :         fprintf( stderr, &quot;Malloc debug on\n&quot; );
<span class="lineNum">    7959 </span>            :         __malloc_debug(5);
<span class="lineNum">    7960 </span>            :     } else if ( event-&gt;u.chr.keysym == GK_F3 ) {
<span class="lineNum">    7961 </span>            :         fprintf( stderr, &quot;Malloc debug off\n&quot; );
<span class="lineNum">    7962 </span>            :         __malloc_debug(0);
<span class="lineNum">    7963 </span>            :     }
<span class="lineNum">    7964 </span>            : #endif
<span class="lineNum">    7965 </span>            : 
<span class="lineNum">    7966 </span><span class="lineNoCov">          0 :     if ( !HaveModifiers &amp;&amp; event-&gt;u.chr.keysym==' ' &amp;&amp; cv-&gt;spacebar_hold==0 ) {</span>
<span class="lineNum">    7967 </span><span class="lineNoCov">          0 :         cv-&gt;p.x = event-&gt;u.mouse.x;</span>
<span class="lineNum">    7968 </span><span class="lineNoCov">          0 :         cv-&gt;p.y = event-&gt;u.mouse.y;</span>
<span class="lineNum">    7969 </span><span class="lineNoCov">          0 :         update_spacebar_hand_tool(cv);</span>
<span class="lineNum">    7970 </span>            :     }
<span class="lineNum">    7971 </span>            : 
<span class="lineNum">    7972 </span><span class="lineNoCov">          0 :     CVPaletteActivate(cv);</span>
<span class="lineNum">    7973 </span><span class="lineNoCov">          0 :     CVToolsSetCursor(cv,TrueCharState(event),NULL);</span>
<span class="lineNum">    7974 </span>            : 
<span class="lineNum">    7975 </span>            :     
<span class="lineNum">    7976 </span>            :         /* The window check is to prevent infinite loops since DVChar can */
<span class="lineNum">    7977 </span>            :         /*  call CVChar too */
<span class="lineNum">    7978 </span><span class="lineNoCov">          0 :     if ( cv-&gt;dv!=NULL &amp;&amp; (event-&gt;w==cv-&gt;gw || event-&gt;w==cv-&gt;v) &amp;&amp; DVChar(cv-&gt;dv,event))</span>
<span class="lineNum">    7979 </span>            :     {
<span class="lineNum">    7980 </span>            :         /* All Done */;
<span class="lineNum">    7981 </span>            :     }
<span class="lineNum">    7982 </span><span class="lineNoCov">          0 :     else if ( event-&gt;u.chr.keysym=='s' &amp;&amp;</span>
<span class="lineNum">    7983 </span><span class="lineNoCov">          0 :             (event-&gt;u.chr.state&amp;ksm_control) &amp;&amp;</span>
<span class="lineNum">    7984 </span><span class="lineNoCov">          0 :             (event-&gt;u.chr.state&amp;ksm_meta) )</span>
<span class="lineNum">    7985 </span><span class="lineNoCov">          0 :         MenuSaveAll(NULL,NULL,NULL);</span>
<span class="lineNum">    7986 </span><span class="lineNoCov">          0 :     else if ( event-&gt;u.chr.keysym=='q' &amp;&amp;</span>
<span class="lineNum">    7987 </span><span class="lineNoCov">          0 :             (event-&gt;u.chr.state&amp;ksm_control) &amp;&amp;</span>
<span class="lineNum">    7988 </span><span class="lineNoCov">          0 :             (event-&gt;u.chr.state&amp;ksm_meta) )</span>
<span class="lineNum">    7989 </span><span class="lineNoCov">          0 :         MenuExit(NULL,NULL,NULL);</span>
<span class="lineNum">    7990 </span><span class="lineNoCov">          0 :     else if ( event-&gt;u.chr.keysym == GK_Shift_L || event-&gt;u.chr.keysym == GK_Shift_R ||</span>
<span class="lineNum">    7991 </span><span class="lineNoCov">          0 :              event-&gt;u.chr.keysym == GK_Alt_L || event-&gt;u.chr.keysym == GK_Alt_R ||</span>
<span class="lineNum">    7992 </span><span class="lineNoCov">          0 :              event-&gt;u.chr.keysym == GK_Meta_L || event-&gt;u.chr.keysym == GK_Meta_R ) {</span>
<span class="lineNum">    7993 </span><span class="lineNoCov">          0 :         CVFakeMove(cv, event);</span>
<span class="lineNum">    7994 </span><span class="lineNoCov">          0 :     } else if (( event-&gt;u.chr.keysym == GK_Tab || event-&gt;u.chr.keysym == GK_BackTab) &amp;&amp;</span>
<span class="lineNum">    7995 </span><span class="lineNoCov">          0 :             (event-&gt;u.chr.state&amp;ksm_control) &amp;&amp; cv-&gt;showtabs &amp;&amp; cv-&gt;former_cnt&gt;1 ) {</span>
<span class="lineNum">    7996 </span><span class="lineNoCov">          0 :         GGadgetDispatchEvent(cv-&gt;tabs,event);</span>
<span class="lineNum">    7997 </span><span class="lineNoCov">          0 :     } else if ( (event-&gt;u.chr.state&amp;ksm_meta) &amp;&amp;</span>
<span class="lineNum">    7998 </span><span class="lineNoCov">          0 :             !(event-&gt;u.chr.state&amp;(ksm_control|ksm_shift)) &amp;&amp;</span>
<span class="lineNum">    7999 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.chars[0]!='\0' ) {</span>
<span class="lineNum">    8000 </span><span class="lineNoCov">          0 :         CVPaletteMnemonicCheck(event);</span>
<span class="lineNum">    8001 </span><span class="lineNoCov">          0 :     } else if ( !(event-&gt;u.chr.state&amp;(ksm_control|ksm_meta)) &amp;&amp;</span>
<span class="lineNum">    8002 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_BackSpace ) {</span>
<span class="lineNum">    8003 </span>            :         /* Menu does delete */
<span class="lineNum">    8004 </span><span class="lineNoCov">          0 :         CVClear(cv-&gt;gw,NULL,NULL);</span>
<span class="lineNum">    8005 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;u.chr.keysym == GK_Help ) {</span>
<span class="lineNum">    8006 </span><span class="lineNoCov">          0 :         MenuHelp(NULL,NULL,NULL);       /* Menu does F1 */</span>
<span class="lineNum">    8007 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;u.chr.keysym=='&lt;' &amp;&amp; (event-&gt;u.chr.state&amp;ksm_control) ) {</span>
<span class="lineNum">    8008 </span>            :         /* European keyboards do not need shift to get &lt; */
<span class="lineNum">    8009 </span><span class="lineNoCov">          0 :         CVDoFindInFontView(cv);</span>
<span class="lineNum">    8010 </span><span class="lineNoCov">          0 :     } else if ( (event-&gt;u.chr.keysym=='[' || event-&gt;u.chr.keysym==']') &amp;&amp;</span>
<span class="lineNum">    8011 </span><span class="lineNoCov">          0 :             (event-&gt;u.chr.state&amp;ksm_control) ) {</span>
<span class="lineNum">    8012 </span>            :         /* European keyboards need a funky modifier to get [] */
<span class="lineNum">    8013 </span><span class="lineNoCov">          0 :         _CVMenuChangeChar(cv,event-&gt;u.chr.keysym=='[' ? MID_Prev : MID_Next );</span>
<span class="lineNum">    8014 </span><span class="lineNoCov">          0 :     } else if ( (event-&gt;u.chr.keysym=='{' || event-&gt;u.chr.keysym=='}') &amp;&amp;</span>
<span class="lineNum">    8015 </span><span class="lineNoCov">          0 :             (event-&gt;u.chr.state&amp;ksm_control) ) {</span>
<span class="lineNum">    8016 </span>            :         /* European keyboards need a funky modifier to get {} */
<span class="lineNum">    8017 </span><span class="lineNoCov">          0 :         _CVMenuChangeChar(cv,event-&gt;u.chr.keysym=='{' ? MID_PrevDef : MID_NextDef );</span>
<span class="lineNum">    8018 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;u.chr.keysym=='\\' &amp;&amp; (event-&gt;u.chr.state&amp;ksm_control) ) {</span>
<span class="lineNum">    8019 </span>            :         /* European keyboards need a funky modifier to get \ */
<span class="lineNum">    8020 </span><span class="lineNoCov">          0 :         CVDoTransform(cv,cvt_none);</span>
<span class="lineNum">    8021 </span><span class="lineNoCov">          0 :     } else if ( (event-&gt;u.chr.keysym=='F' || event-&gt;u.chr.keysym=='B') &amp;&amp;</span>
<span class="lineNum">    8022 </span><span class="lineNoCov">          0 :             !(event-&gt;u.chr.state&amp;(ksm_control|ksm_meta)) ) {</span>
<span class="lineNum">    8023 </span><span class="lineNoCov">          0 :         CVLSelectLayer(cv, event-&gt;u.chr.keysym=='F' ? 1 : 0);</span>
<span class="lineNum">    8024 </span><span class="lineNoCov">          0 :     } else if ( (event-&gt;u.chr.state&amp;ksm_control) &amp;&amp; (event-&gt;u.chr.keysym=='-' || event-&gt;u.chr.keysym==0xffad/*XK_KP_Subtract*/) ){</span>
<span class="lineNum">    8025 </span><span class="lineNoCov">          0 :             _CVMenuScale(cv, MID_ZoomOut);</span>
<span class="lineNum">    8026 </span><span class="lineNoCov">          0 :     } else if ( (event-&gt;u.chr.state&amp;ksm_control) &amp;&amp; (event-&gt;u.chr.keysym=='=' || event-&gt;u.chr.keysym==0xffab/*XK_KP_Add*/) ){</span>
<span class="lineNum">    8027 </span><span class="lineNoCov">          0 :             _CVMenuScale(cv, MID_ZoomIn);</span>
<span class="lineNum">    8028 </span>            :     }
<span class="lineNum">    8029 </span><span class="lineNoCov">          0 :     else if ( event-&gt;u.chr.keysym == GK_Left ||</span>
<span class="lineNum">    8030 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_Up ||</span>
<span class="lineNum">    8031 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_Right ||</span>
<span class="lineNum">    8032 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_Down ||</span>
<span class="lineNum">    8033 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_KP_Left ||</span>
<span class="lineNum">    8034 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_KP_Up ||</span>
<span class="lineNum">    8035 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_KP_Right ||</span>
<span class="lineNum">    8036 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_KP_Down )</span>
<span class="lineNum">    8037 </span><span class="lineNoCov">          0 :     {</span>
<span class="lineNum">    8038 </span>            :         TRACE(&quot;key left/right/up/down...\n&quot;);
<span class="lineNum">    8039 </span>            :         
<span class="lineNum">    8040 </span><span class="lineNoCov">          0 :         GGadget *active = GWindowGetFocusGadgetOfWindow(cv-&gt;gw);</span>
<span class="lineNum">    8041 </span><span class="lineNoCov">          0 :         if( active == cv-&gt;charselector )</span>
<span class="lineNum">    8042 </span>            :         {
<span class="lineNum">    8043 </span><span class="lineNoCov">          0 :             if ( event-&gt;u.chr.keysym == GK_Left ||event-&gt;u.chr.keysym == GK_Right )</span>
<span class="lineNum">    8044 </span>            :             {
<span class="lineNum">    8045 </span>            :                 TRACE(&quot;left/right on the charselector!\n&quot;);
<span class="lineNum">    8046 </span>            :             }
<span class="lineNum">    8047 </span><span class="lineNoCov">          0 :             int dir = ( event-&gt;u.chr.keysym == GK_Up || event-&gt;u.chr.keysym==GK_KP_Up ) ? -1 : 1;</span>
<span class="lineNum">    8048 </span><span class="lineNoCov">          0 :             Wordlist_MoveByOffset( cv-&gt;charselector, &amp;cv-&gt;charselectoridx, dir );</span>
<span class="lineNum">    8049 </span>            : 
<span class="lineNum">    8050 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    8051 </span>            :         }
<span class="lineNum">    8052 </span>            :         
<span class="lineNum">    8053 </span>            :         
<span class="lineNum">    8054 </span><span class="lineNoCov">          0 :         real dx=0, dy=0; int anya;</span>
<span class="lineNum">    8055 </span><span class="lineNoCov">          0 :         switch ( event-&gt;u.chr.keysym ) {</span>
<span class="lineNum">    8056 </span>            :           case GK_Left: case GK_KP_Left:
<span class="lineNum">    8057 </span><span class="lineNoCov">          0 :             dx = -1;</span>
<span class="lineNum">    8058 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    8059 </span>            :           case GK_Right: case GK_KP_Right:
<span class="lineNum">    8060 </span><span class="lineNoCov">          0 :             dx = 1;</span>
<span class="lineNum">    8061 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    8062 </span>            :           case GK_Up: case GK_KP_Up:
<span class="lineNum">    8063 </span><span class="lineNoCov">          0 :             dy = 1;</span>
<span class="lineNum">    8064 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    8065 </span>            :           case GK_Down: case GK_KP_Down:
<span class="lineNum">    8066 </span><span class="lineNoCov">          0 :             dy = -1;</span>
<span class="lineNum">    8067 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    8068 </span>            :         }
<span class="lineNum">    8069 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.state &amp; (ksm_control|ksm_capslock) ) {</span>
<span class="lineNum">    8070 </span>            :             struct sbevent sb;
<span class="lineNum">    8071 </span><span class="lineNoCov">          0 :             sb.type = dy&gt;0 || dx&lt;0 ? et_sb_halfup : et_sb_halfdown;</span>
<span class="lineNum">    8072 </span><span class="lineNoCov">          0 :             if ( dx==0 )</span>
<span class="lineNum">    8073 </span><span class="lineNoCov">          0 :                 CVVScroll(cv,&amp;sb);</span>
<span class="lineNum">    8074 </span>            :             else
<span class="lineNum">    8075 </span><span class="lineNoCov">          0 :                 CVHScroll(cv,&amp;sb);</span>
<span class="lineNum">    8076 </span>            :         }
<span class="lineNum">    8077 </span>            :         else
<span class="lineNum">    8078 </span>            :         {
<span class="lineNum">    8079 </span>            : //          TRACE(&quot;cvchar( moving points? ) shift:%d\n&quot;, ( event-&gt;u.chr.state &amp; (ksm_shift) ));
<span class="lineNum">    8080 </span>            :             FE_adjustBCPByDeltaData d;
<span class="lineNum">    8081 </span><span class="lineNoCov">          0 :             memset( &amp;d, 0, sizeof(FE_adjustBCPByDeltaData));</span>
<span class="lineNum">    8082 </span><span class="lineNoCov">          0 :             visitSelectedControlPointsVisitor func = FE_adjustBCPByDelta;</span>
<span class="lineNum">    8083 </span><span class="lineNoCov">          0 :             if ( event-&gt;u.chr.state &amp; ksm_meta )</span>
<span class="lineNum">    8084 </span>            :             {
<span class="lineNum">    8085 </span>            :                 // move the bcp 1 unit in the direction it already has
<span class="lineNum">    8086 </span><span class="lineNoCov">          0 :                 func = FE_adjustBCPByDeltaWhilePreservingBCPAngle;</span>
<span class="lineNum">    8087 </span>            :                 // allow that func to work it's magic on any gradient
<span class="lineNum">    8088 </span><span class="lineNoCov">          0 :                 d.keyboarddx = 1;</span>
<span class="lineNum">    8089 </span>            :             }
<span class="lineNum">    8090 </span>            :             /* if ( event-&gt;u.chr.state &amp; (ksm_shift) ) */
<span class="lineNum">    8091 </span>            :             /*  dx -= dy*tan((cv-&gt;b.sc-&gt;parent-&gt;italicangle)*(3.1415926535897932/180) ); */
<span class="lineNum">    8092 </span><span class="lineNoCov">          0 :             if ( event-&gt;u.chr.state &amp; (ksm_shift) )</span>
<span class="lineNum">    8093 </span>            :             {
<span class="lineNum">    8094 </span><span class="lineNoCov">          0 :                 dx *= arrowAccelFactor; dy *= arrowAccelFactor;</span>
<span class="lineNum">    8095 </span>            :             }
<span class="lineNum">    8096 </span>            : 
<span class="lineNum">    8097 </span><span class="lineNoCov">          0 :             if ((  cv-&gt;p.sp!=NULL || cv-&gt;lastselpt!=NULL ) &amp;&amp;</span>
<span class="lineNum">    8098 </span><span class="lineNoCov">          0 :                     (cv-&gt;p.nextcp || cv-&gt;p.prevcp) )</span>
<span class="lineNum">    8099 </span><span class="lineNoCov">          0 :             {</span>
<span class="lineNum">    8100 </span>            :                 // This code moves 1 or more BCP
<span class="lineNum">    8101 </span>            : 
<span class="lineNum">    8102 </span><span class="lineNoCov">          0 :                 SplinePoint *old = cv-&gt;p.sp;</span>
<span class="lineNum">    8103 </span><span class="lineNoCov">          0 :                 d.cv = cv;</span>
<span class="lineNum">    8104 </span><span class="lineNoCov">          0 :                 d.dx = dx * arrowAmount;</span>
<span class="lineNum">    8105 </span><span class="lineNoCov">          0 :                 d.dy = dy * arrowAmount;</span>
<span class="lineNum">    8106 </span><span class="lineNoCov">          0 :                 CVFindAndVisitSelectedControlPoints( cv, true,</span>
<span class="lineNum">    8107 </span>            :                                                      func, &amp;d );
<span class="lineNum">    8108 </span><span class="lineNoCov">          0 :                 cv-&gt;p.sp = old;</span>
<span class="lineNum">    8109 </span><span class="lineNoCov">          0 :                 SCUpdateAll(cv-&gt;b.sc);</span>
<span class="lineNum">    8110 </span>            : 
<span class="lineNum">    8111 </span>            :             }
<span class="lineNum">    8112 </span><span class="lineNoCov">          0 :             else if ( CVAnySel(cv,NULL,NULL,NULL,&amp;anya) || cv-&gt;widthsel || cv-&gt;vwidthsel )</span>
<span class="lineNum">    8113 </span>            :             {
<span class="lineNum">    8114 </span><span class="lineNoCov">          0 :                 CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    8115 </span><span class="lineNoCov">          0 :                 CVMoveSelection(cv,dx*arrowAmount,dy*arrowAmount, event-&gt;u.chr.state);</span>
<span class="lineNum">    8116 </span><span class="lineNoCov">          0 :                 if ( cv-&gt;widthsel )</span>
<span class="lineNum">    8117 </span><span class="lineNoCov">          0 :                     SCSynchronizeWidth(cv-&gt;b.sc,cv-&gt;b.sc-&gt;width,cv-&gt;b.sc-&gt;width-dx,NULL);</span>
<span class="lineNum">    8118 </span><span class="lineNoCov">          0 :                 _CV_CharChangedUpdate(cv,2);</span>
<span class="lineNum">    8119 </span><span class="lineNoCov">          0 :                 CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    8120 </span>            :             }
<span class="lineNum">    8121 </span><span class="lineNoCov">          0 :             CVGridHandlePossibleFitChar( cv );</span>
<span class="lineNum">    8122 </span>            :         }
<span class="lineNum">    8123 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;u.chr.keysym == GK_Page_Up ||</span>
<span class="lineNum">    8124 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_KP_Page_Up ||</span>
<span class="lineNum">    8125 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_Prior ||</span>
<span class="lineNum">    8126 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_Page_Down ||</span>
<span class="lineNum">    8127 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_KP_Page_Down ||</span>
<span class="lineNum">    8128 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym == GK_Next ) {</span>
<span class="lineNum">    8129 </span>            :         /* Um... how do we scroll horizontally??? */
<span class="lineNum">    8130 </span>            :         struct sbevent sb;
<span class="lineNum">    8131 </span><span class="lineNoCov">          0 :         sb.type = et_sb_uppage;</span>
<span class="lineNum">    8132 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.keysym == GK_Page_Down ||</span>
<span class="lineNum">    8133 </span><span class="lineNoCov">          0 :                 event-&gt;u.chr.keysym == GK_KP_Page_Down ||</span>
<span class="lineNum">    8134 </span><span class="lineNoCov">          0 :                 event-&gt;u.chr.keysym == GK_Next )</span>
<span class="lineNum">    8135 </span><span class="lineNoCov">          0 :             sb.type = et_sb_downpage;</span>
<span class="lineNum">    8136 </span><span class="lineNoCov">          0 :         CVVScroll(cv,&amp;sb);</span>
<span class="lineNum">    8137 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;u.chr.keysym == GK_Home ) {</span>
<span class="lineNum">    8138 </span><span class="lineNoCov">          0 :         CVFit(cv);</span>
<span class="lineNum">    8139 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;u.chr.keysym==' ' &amp;&amp; cv-&gt;spacebar_hold ){</span>
<span class="lineNum">    8140 </span><span class="lineNoCov">          0 :     } else if ( (event-&gt;u.chr.state&amp;((GMenuMask()|navigation_mask)&amp;~(ksm_shift|ksm_capslock)))==navigation_mask &amp;&amp;</span>
<span class="lineNum">    8141 </span><span class="lineNoCov">          0 :             event-&gt;type == et_char &amp;&amp;</span>
<span class="lineNum">    8142 </span><span class="lineNoCov">          0 :             event-&gt;u.chr.keysym!=0 &amp;&amp;</span>
<span class="lineNum">    8143 </span><span class="lineNoCov">          0 :             (event-&gt;u.chr.keysym&lt;GK_Special /*|| event-&gt;u.chr.keysym&gt;=0x10000*/)) {</span>
<span class="lineNum">    8144 </span><span class="lineNoCov">          0 :         SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">    8145 </span>            :         int i;
<span class="lineNum">    8146 </span><span class="lineNoCov">          0 :         EncMap *map = cv-&gt;b.fv-&gt;map;</span>
<span class="lineNum">    8147 </span>            :         extern int cv_auto_goto;
<span class="lineNum">    8148 </span><span class="lineNoCov">          0 :         if ( cv_auto_goto ) {</span>
<span class="lineNum">    8149 </span><span class="lineNoCov">          0 :             i = SFFindSlot(sf,map,event-&gt;u.chr.keysym,NULL);</span>
<span class="lineNum">    8150 </span><span class="lineNoCov">          0 :             if ( i!=-1 )</span>
<span class="lineNum">    8151 </span><span class="lineNoCov">          0 :                 CVChangeChar(cv,i);</span>
<span class="lineNum">    8152 </span>            :         }
<span class="lineNum">    8153 </span>            :     }
<a name="8154"><span class="lineNum">    8154 </span>            : }</a>
<span class="lineNum">    8155 </span>            : 
<span class="lineNum">    8156 </span><span class="lineNoCov">          0 : void CVShowPoint(CharView *cv, BasePoint *me) {</span>
<span class="lineNum">    8157 </span>            :     int x, y;
<span class="lineNum">    8158 </span><span class="lineNoCov">          0 :     int fudge = 30;</span>
<span class="lineNum">    8159 </span>            : 
<span class="lineNum">    8160 </span><span class="lineNoCov">          0 :     if ( cv-&gt;width&lt;60 )</span>
<span class="lineNum">    8161 </span><span class="lineNoCov">          0 :         fudge = cv-&gt;width/3;</span>
<span class="lineNum">    8162 </span><span class="lineNoCov">          0 :     if ( cv-&gt;height&lt;60 &amp;&amp; fudge&gt;cv-&gt;height/3 )</span>
<span class="lineNum">    8163 </span><span class="lineNoCov">          0 :         fudge = cv-&gt;height/3;</span>
<span class="lineNum">    8164 </span>            : 
<span class="lineNum">    8165 </span>            :     /* Make sure the point is visible and has some context around it */
<span class="lineNum">    8166 </span><span class="lineNoCov">          0 :     x =  cv-&gt;xoff + rint(me-&gt;x*cv-&gt;scale);</span>
<span class="lineNum">    8167 </span><span class="lineNoCov">          0 :     y = -cv-&gt;yoff + cv-&gt;height - rint(me-&gt;y*cv-&gt;scale);</span>
<span class="lineNum">    8168 </span><span class="lineNoCov">          0 :     if ( x&lt;fudge || y&lt;fudge || x&gt;cv-&gt;width-fudge || y&gt;cv-&gt;height-fudge )</span>
<span class="lineNum">    8169 </span><span class="lineNoCov">          0 :         CVMagnify(cv,me-&gt;x,me-&gt;y,0,0);</span>
<a name="8170"><span class="lineNum">    8170 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8171 </span>            : 
<span class="lineNum">    8172 </span><span class="lineNoCov">          0 : static void CVSelectContours(CharView *cv) {</span>
<span class="lineNum">    8173 </span>            :     SplineSet *spl;
<span class="lineNum">    8174 </span>            :     SplinePoint *sp;
<span class="lineNum">    8175 </span>            :     int sel;
<span class="lineNum">    8176 </span>            :     int i;
<span class="lineNum">    8177 </span>            : 
<span class="lineNum">    8178 </span><span class="lineNoCov">          0 :     for ( spl=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl=spl-&gt;next ) {</span>
<span class="lineNum">    8179 </span><span class="lineNoCov">          0 :         sel = false;</span>
<span class="lineNum">    8180 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro()) {</span>
<span class="lineNum">    8181 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;spl-&gt;spiro_cnt-1; ++i ) {</span>
<span class="lineNum">    8182 </span><span class="lineNoCov">          0 :                 if ( SPIRO_SELECTED(&amp;spl-&gt;spiros[i]) ) {</span>
<span class="lineNum">    8183 </span><span class="lineNoCov">          0 :                     sel = true;</span>
<span class="lineNum">    8184 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    8185 </span>            :                 }
<span class="lineNum">    8186 </span>            :             }
<span class="lineNum">    8187 </span><span class="lineNoCov">          0 :             if ( sel ) {</span>
<span class="lineNum">    8188 </span><span class="lineNoCov">          0 :                 for ( i=0; i&lt;spl-&gt;spiro_cnt-1; ++i )</span>
<span class="lineNum">    8189 </span><span class="lineNoCov">          0 :                     SPIRO_SELECT(&amp;spl-&gt;spiros[i]);</span>
<span class="lineNum">    8190 </span>            :             }
<span class="lineNum">    8191 </span>            :         } else {
<span class="lineNum">    8192 </span><span class="lineNoCov">          0 :             for ( sp=spl-&gt;first ; ; ) {</span>
<span class="lineNum">    8193 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;selected ) {</span>
<span class="lineNum">    8194 </span><span class="lineNoCov">          0 :                     sel = true;</span>
<span class="lineNum">    8195 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    8196 </span>            :                 }
<span class="lineNum">    8197 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    8198 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    8199 </span><span class="lineNoCov">          0 :                 sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    8200 </span><span class="lineNoCov">          0 :                 if ( sp==spl-&gt;first )</span>
<span class="lineNum">    8201 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    8202 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">    8203 </span><span class="lineNoCov">          0 :             if ( sel ) {</span>
<span class="lineNum">    8204 </span><span class="lineNoCov">          0 :                 for ( sp=spl-&gt;first ; ; ) {</span>
<span class="lineNum">    8205 </span><span class="lineNoCov">          0 :                     sp-&gt;selected = true;</span>
<span class="lineNum">    8206 </span><span class="lineNoCov">          0 :                     if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    8207 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    8208 </span><span class="lineNoCov">          0 :                     sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    8209 </span><span class="lineNoCov">          0 :                     if ( sp==spl-&gt;first )</span>
<span class="lineNum">    8210 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    8211 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    8212 </span>            :             }
<span class="lineNum">    8213 </span>            :         }
<span class="lineNum">    8214 </span>            :     }
<span class="lineNum">    8215 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<a name="8216"><span class="lineNum">    8216 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8217 </span>            : 
<span class="lineNum">    8218 </span><span class="lineNoCov">          0 : static void CVMenuSelectContours(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8219 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8220 </span><span class="lineNoCov">          0 :     CVSelectContours(cv);</span>
<a name="8221"><span class="lineNum">    8221 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8222 </span>            : 
<span class="lineNum">    8223 </span><span class="lineNoCov">          0 : static void CVMenuSelectPointAt(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8224 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8225 </span><span class="lineNoCov">          0 :     CVSelectPointAt(cv);</span>
<a name="8226"><span class="lineNum">    8226 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8227 </span>            : 
<span class="lineNum">    8228 </span><span class="lineNoCov">          0 : static void CVNextPrevSpiroPt(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">    8229 </span>            :     RefChar *r; ImageList *il;
<span class="lineNum">    8230 </span>            :     SplineSet *spl, *ss;
<span class="lineNum">    8231 </span>            :     SplinePoint *junk;
<span class="lineNum">    8232 </span>            :     int x, y;
<span class="lineNum">    8233 </span><span class="lineNoCov">          0 :     spiro_cp *selcp = NULL, *other;</span>
<span class="lineNum">    8234 </span>            :     int index;
<span class="lineNum">    8235 </span>            : 
<span class="lineNum">    8236 </span><span class="lineNoCov">          0 :     if ( mi-&gt;mid == MID_FirstPt ) {</span>
<span class="lineNum">    8237 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL )</span>
<span class="lineNum">    8238 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8239 </span><span class="lineNoCov">          0 :         CVClearSel(cv);</span>
<span class="lineNum">    8240 </span><span class="lineNoCov">          0 :         other = &amp;cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines-&gt;spiros[0];</span>
<span class="lineNum">    8241 </span>            :     } else {
<span class="lineNum">    8242 </span><span class="lineNoCov">          0 :         if ( !CVOneThingSel(cv,&amp;junk,&amp;spl,&amp;r,&amp;il,NULL,&amp;selcp) || spl==NULL )</span>
<span class="lineNum">    8243 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8244 </span><span class="lineNoCov">          0 :         other = selcp;</span>
<span class="lineNum">    8245 </span><span class="lineNoCov">          0 :         if ( spl==NULL )</span>
<span class="lineNum">    8246 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8247 </span><span class="lineNoCov">          0 :         index = selcp - spl-&gt;spiros;</span>
<span class="lineNum">    8248 </span><span class="lineNoCov">          0 :         if ( mi-&gt;mid == MID_NextPt ) {</span>
<span class="lineNum">    8249 </span><span class="lineNoCov">          0 :             if ( index!=spl-&gt;spiro_cnt-2 )</span>
<span class="lineNum">    8250 </span><span class="lineNoCov">          0 :                 other = &amp;spl-&gt;spiros[index+1];</span>
<span class="lineNum">    8251 </span>            :             else {
<span class="lineNum">    8252 </span><span class="lineNoCov">          0 :                 if ( spl-&gt;next == NULL )</span>
<span class="lineNum">    8253 </span><span class="lineNoCov">          0 :                     spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines;</span>
<span class="lineNum">    8254 </span>            :                 else
<span class="lineNum">    8255 </span><span class="lineNoCov">          0 :                     spl = spl-&gt;next;</span>
<span class="lineNum">    8256 </span><span class="lineNoCov">          0 :                 other = &amp;spl-&gt;spiros[0];</span>
<span class="lineNum">    8257 </span>            :             }
<span class="lineNum">    8258 </span><span class="lineNoCov">          0 :         } else if ( mi-&gt;mid == MID_PrevPt ) {</span>
<span class="lineNum">    8259 </span><span class="lineNoCov">          0 :             if ( index!=0 ) {</span>
<span class="lineNum">    8260 </span><span class="lineNoCov">          0 :                 other = &amp;spl-&gt;spiros[index-1];</span>
<span class="lineNum">    8261 </span>            :             } else {
<span class="lineNum">    8262 </span><span class="lineNoCov">          0 :                 if ( spl==cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines ) {</span>
<span class="lineNum">    8263 </span><span class="lineNoCov">          0 :                     for ( ss = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; ss-&gt;next!=NULL; ss=ss-&gt;next );</span>
<span class="lineNum">    8264 </span>            :                 } else {
<span class="lineNum">    8265 </span><span class="lineNoCov">          0 :                     for ( ss = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; ss-&gt;next!=spl; ss=ss-&gt;next );</span>
<span class="lineNum">    8266 </span>            :                 }
<span class="lineNum">    8267 </span><span class="lineNoCov">          0 :                 spl = ss;</span>
<span class="lineNum">    8268 </span><span class="lineNoCov">          0 :                 other = &amp;ss-&gt;spiros[ss-&gt;spiro_cnt-2];</span>
<span class="lineNum">    8269 </span>            :             }
<span class="lineNum">    8270 </span><span class="lineNoCov">          0 :         } else if ( mi-&gt;mid == MID_FirstPtNextCont ) {</span>
<span class="lineNum">    8271 </span><span class="lineNoCov">          0 :             if ( spl-&gt;next!=NULL )</span>
<span class="lineNum">    8272 </span><span class="lineNoCov">          0 :                 other = &amp;spl-&gt;next-&gt;spiros[0];</span>
<span class="lineNum">    8273 </span>            :             else
<span class="lineNum">    8274 </span><span class="lineNoCov">          0 :                 other = NULL;</span>
<span class="lineNum">    8275 </span>            :         }
<span class="lineNum">    8276 </span>            :     }
<span class="lineNum">    8277 </span><span class="lineNoCov">          0 :     if ( selcp!=NULL )</span>
<span class="lineNum">    8278 </span><span class="lineNoCov">          0 :         SPIRO_DESELECT(selcp);</span>
<span class="lineNum">    8279 </span><span class="lineNoCov">          0 :     if ( other!=NULL )</span>
<span class="lineNum">    8280 </span><span class="lineNoCov">          0 :         SPIRO_SELECT(other);</span>
<span class="lineNum">    8281 </span><span class="lineNoCov">          0 :     cv-&gt;p.sp = NULL;</span>
<span class="lineNum">    8282 </span><span class="lineNoCov">          0 :     cv-&gt;lastselpt = NULL;</span>
<span class="lineNum">    8283 </span><span class="lineNoCov">          0 :     cv-&gt;lastselcp = other;</span>
<span class="lineNum">    8284 </span>            : 
<span class="lineNum">    8285 </span>            :     /* Make sure the point is visible and has some context around it */
<span class="lineNum">    8286 </span><span class="lineNoCov">          0 :     if ( other!=NULL ) {</span>
<span class="lineNum">    8287 </span><span class="lineNoCov">          0 :         x =  cv-&gt;xoff + rint(other-&gt;x*cv-&gt;scale);</span>
<span class="lineNum">    8288 </span><span class="lineNoCov">          0 :         y = -cv-&gt;yoff + cv-&gt;height - rint(other-&gt;y*cv-&gt;scale);</span>
<span class="lineNum">    8289 </span><span class="lineNoCov">          0 :         if ( x&lt;40 || y&lt;40 || x&gt;cv-&gt;width-40 || y&gt;cv-&gt;height-40 )</span>
<span class="lineNum">    8290 </span><span class="lineNoCov">          0 :             CVMagnify(cv,other-&gt;x,other-&gt;y,0,0);</span>
<span class="lineNum">    8291 </span>            :     }
<span class="lineNum">    8292 </span>            : 
<span class="lineNum">    8293 </span><span class="lineNoCov">          0 :     CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    8294 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<a name="8295"><span class="lineNum">    8295 </span>            : }</a>
<span class="lineNum">    8296 </span>            : 
<span class="lineNum">    8297 </span><span class="lineNoCov">          0 : static void CVNextPrevPt(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">    8298 </span><span class="lineNoCov">          0 :     SplinePoint *selpt=NULL, *other;</span>
<span class="lineNum">    8299 </span>            :     RefChar *r; ImageList *il;
<span class="lineNum">    8300 </span>            :     SplineSet *spl, *ss;
<span class="lineNum">    8301 </span>            :     int x, y;
<span class="lineNum">    8302 </span>            :     spiro_cp *junk;
<span class="lineNum">    8303 </span>            : 
<span class="lineNum">    8304 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro()) {</span>
<span class="lineNum">    8305 </span><span class="lineNoCov">          0 :         CVNextPrevSpiroPt(cv,mi);</span>
<span class="lineNum">    8306 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8307 </span>            :     }
<span class="lineNum">    8308 </span>            : 
<span class="lineNum">    8309 </span><span class="lineNoCov">          0 :     if ( mi-&gt;mid == MID_FirstPt ) {</span>
<span class="lineNum">    8310 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL )</span>
<span class="lineNum">    8311 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8312 </span><span class="lineNoCov">          0 :         other = (cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines)-&gt;first;</span>
<span class="lineNum">    8313 </span><span class="lineNoCov">          0 :         CVClearSel(cv);</span>
<span class="lineNum">    8314 </span>            :     } else {
<span class="lineNum">    8315 </span><span class="lineNoCov">          0 :         if ( !CVOneThingSel(cv,&amp;selpt,&amp;spl,&amp;r,&amp;il,NULL,&amp;junk) || spl==NULL )</span>
<span class="lineNum">    8316 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8317 </span><span class="lineNoCov">          0 :         other = selpt;</span>
<span class="lineNum">    8318 </span><span class="lineNoCov">          0 :         if ( spl==NULL )</span>
<span class="lineNum">    8319 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8320 </span><span class="lineNoCov">          0 :         else if ( mi-&gt;mid == MID_NextPt ) {</span>
<span class="lineNum">    8321 </span><span class="lineNoCov">          0 :             if ( other-&gt;next!=NULL &amp;&amp; other-&gt;next-&gt;to!=spl-&gt;first )</span>
<span class="lineNum">    8322 </span><span class="lineNoCov">          0 :                 other = other-&gt;next-&gt;to;</span>
<span class="lineNum">    8323 </span>            :             else {
<span class="lineNum">    8324 </span><span class="lineNoCov">          0 :                 if ( spl-&gt;next == NULL )</span>
<span class="lineNum">    8325 </span><span class="lineNoCov">          0 :                     spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines;</span>
<span class="lineNum">    8326 </span>            :                 else
<span class="lineNum">    8327 </span><span class="lineNoCov">          0 :                     spl = spl-&gt;next;</span>
<span class="lineNum">    8328 </span><span class="lineNoCov">          0 :                 other = spl-&gt;first;</span>
<span class="lineNum">    8329 </span>            :             }
<span class="lineNum">    8330 </span><span class="lineNoCov">          0 :         } else if ( mi-&gt;mid == MID_PrevPt ) {</span>
<span class="lineNum">    8331 </span><span class="lineNoCov">          0 :             if ( other!=spl-&gt;first ) {</span>
<span class="lineNum">    8332 </span><span class="lineNoCov">          0 :                 other = other-&gt;prev-&gt;from;</span>
<span class="lineNum">    8333 </span>            :             } else {
<span class="lineNum">    8334 </span><span class="lineNoCov">          0 :                 if ( spl==cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines ) {</span>
<span class="lineNum">    8335 </span><span class="lineNoCov">          0 :                     for ( ss = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; ss-&gt;next!=NULL; ss=ss-&gt;next );</span>
<span class="lineNum">    8336 </span>            :                 } else {
<span class="lineNum">    8337 </span><span class="lineNoCov">          0 :                     for ( ss = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; ss-&gt;next!=spl; ss=ss-&gt;next );</span>
<span class="lineNum">    8338 </span>            :                 }
<span class="lineNum">    8339 </span><span class="lineNoCov">          0 :                 spl = ss;</span>
<span class="lineNum">    8340 </span><span class="lineNoCov">          0 :                 other = ss-&gt;last;</span>
<span class="lineNum">    8341 </span><span class="lineNoCov">          0 :                 if ( spl-&gt;last==spl-&gt;first &amp;&amp; spl-&gt;last-&gt;prev!=NULL )</span>
<span class="lineNum">    8342 </span><span class="lineNoCov">          0 :                     other = other-&gt;prev-&gt;from;</span>
<span class="lineNum">    8343 </span>            :             }
<span class="lineNum">    8344 </span><span class="lineNoCov">          0 :         } else if ( mi-&gt;mid == MID_FirstPtNextCont ) {</span>
<span class="lineNum">    8345 </span><span class="lineNoCov">          0 :             if ( spl-&gt;next!=NULL )</span>
<span class="lineNum">    8346 </span><span class="lineNoCov">          0 :                 other = spl-&gt;next-&gt;first;</span>
<span class="lineNum">    8347 </span>            :             else
<span class="lineNum">    8348 </span><span class="lineNoCov">          0 :                 other = NULL;</span>
<span class="lineNum">    8349 </span>            :         }
<span class="lineNum">    8350 </span>            :     }
<span class="lineNum">    8351 </span><span class="lineNoCov">          0 :     if ( selpt!=NULL )</span>
<span class="lineNum">    8352 </span><span class="lineNoCov">          0 :         selpt-&gt;selected = false;</span>
<span class="lineNum">    8353 </span><span class="lineNoCov">          0 :     if ( other!=NULL )</span>
<span class="lineNum">    8354 </span><span class="lineNoCov">          0 :         other-&gt;selected = true;</span>
<span class="lineNum">    8355 </span><span class="lineNoCov">          0 :     cv-&gt;p.sp = NULL;</span>
<span class="lineNum">    8356 </span><span class="lineNoCov">          0 :     cv-&gt;lastselpt = other;</span>
<span class="lineNum">    8357 </span><span class="lineNoCov">          0 :     cv-&gt;p.spiro = cv-&gt;lastselcp = NULL;</span>
<span class="lineNum">    8358 </span>            : 
<span class="lineNum">    8359 </span>            :     /* Make sure the point is visible and has some context around it */
<span class="lineNum">    8360 </span><span class="lineNoCov">          0 :     if ( other!=NULL ) {</span>
<span class="lineNum">    8361 </span><span class="lineNoCov">          0 :         x =  cv-&gt;xoff + rint(other-&gt;me.x*cv-&gt;scale);</span>
<span class="lineNum">    8362 </span><span class="lineNoCov">          0 :         y = -cv-&gt;yoff + cv-&gt;height - rint(other-&gt;me.y*cv-&gt;scale);</span>
<span class="lineNum">    8363 </span><span class="lineNoCov">          0 :         if ( x&lt;40 || y&lt;40 || x&gt;cv-&gt;width-40 || y&gt;cv-&gt;height-40 )</span>
<span class="lineNum">    8364 </span><span class="lineNoCov">          0 :             CVMagnify(cv,other-&gt;me.x,other-&gt;me.y,0,0);</span>
<span class="lineNum">    8365 </span>            :     }
<span class="lineNum">    8366 </span>            : 
<span class="lineNum">    8367 </span><span class="lineNoCov">          0 :     CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    8368 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<a name="8369"><span class="lineNum">    8369 </span>            : }</a>
<span class="lineNum">    8370 </span>            : 
<span class="lineNum">    8371 </span><span class="lineNoCov">          0 : static void CVMenuNextPrevPt(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8372 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8373 </span><span class="lineNoCov">          0 :     CVNextPrevPt(cv, mi);</span>
<a name="8374"><span class="lineNum">    8374 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8375 </span>            : 
<span class="lineNum">    8376 </span><span class="lineNoCov">          0 : static void CVNextPrevCPt(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">    8377 </span><span class="lineNoCov">          0 :     SplinePoint *selpt=NULL;</span>
<span class="lineNum">    8378 </span>            :     RefChar *r; ImageList *il;
<span class="lineNum">    8379 </span>            :     SplineSet *spl;
<span class="lineNum">    8380 </span>            :     spiro_cp *junk;
<span class="lineNum">    8381 </span>            : 
<span class="lineNum">    8382 </span><span class="lineNoCov">          0 :     if ( !CVOneThingSel(cv,&amp;selpt,&amp;spl,&amp;r,&amp;il,NULL,&amp;junk))</span>
<span class="lineNum">    8383 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8384 </span><span class="lineNoCov">          0 :     if ( selpt==NULL )</span>
<span class="lineNum">    8385 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8386 </span><span class="lineNoCov">          0 :     cv-&gt;p.nextcp = mi-&gt;mid==MID_NextCP;</span>
<span class="lineNum">    8387 </span><span class="lineNoCov">          0 :     cv-&gt;p.prevcp = mi-&gt;mid==MID_PrevCP;</span>
<span class="lineNum">    8388 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<a name="8389"><span class="lineNum">    8389 </span>            : }</a>
<span class="lineNum">    8390 </span>            : 
<span class="lineNum">    8391 </span><span class="lineNoCov">          0 : static void CVMenuNextPrevCPt(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8392 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8393 </span><span class="lineNoCov">          0 :     CVNextPrevCPt(cv, mi);</span>
<a name="8394"><span class="lineNum">    8394 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8395 </span>            : 
<span class="lineNum">    8396 </span><span class="lineNoCov">          0 : static void CVMenuGotoChar(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8397 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8398 </span>            :     int pos;
<span class="lineNum">    8399 </span>            : 
<span class="lineNum">    8400 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.container ) {</span>
<span class="lineNum">    8401 </span><span class="lineNoCov">          0 :         (cv-&gt;b.container-&gt;funcs-&gt;doNavigate)(cv-&gt;b.container,nt_goto);</span>
<span class="lineNum">    8402 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8403 </span>            :     }
<span class="lineNum">    8404 </span>            : 
<span class="lineNum">    8405 </span><span class="lineNoCov">          0 :     pos = GotoChar(cv-&gt;b.fv-&gt;sf,cv-&gt;b.fv-&gt;map,NULL);</span>
<span class="lineNum">    8406 </span><span class="lineNoCov">          0 :     if ( pos!=-1 )</span>
<span class="lineNum">    8407 </span><span class="lineNoCov">          0 :         CVChangeChar(cv,pos);</span>
<a name="8408"><span class="lineNum">    8408 </span>            : }</a>
<span class="lineNum">    8409 </span>            : 
<span class="lineNum">    8410 </span><span class="lineNoCov">          0 : static void CVMenuFindInFontView(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8411 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8412 </span><span class="lineNoCov">          0 :     CVDoFindInFontView(cv);</span>
<a name="8413"><span class="lineNum">    8413 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8414 </span>            : 
<span class="lineNum">    8415 </span><span class="lineNoCov">          0 : static void CVMenuPalettesDock(GWindow UNUSED(gw), struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8416 </span><span class="lineNoCov">          0 :     PalettesChangeDocking();</span>
<a name="8417"><span class="lineNum">    8417 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8418 </span>            : 
<span class="lineNum">    8419 </span><span class="lineNoCov">          0 : static void CVMenuPaletteShow(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8420 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8421 </span><span class="lineNoCov">          0 :     CVPaletteSetVisible(cv, mi-&gt;mid==MID_Tools, !CVPaletteIsVisible(cv, mi-&gt;mid==MID_Tools));</span>
<a name="8422"><span class="lineNum">    8422 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8423 </span>            : 
<span class="lineNum">    8424 </span><span class="lineNoCov">          0 : static void cv_pllistcheck(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">    8425 </span>            :     extern int palettes_docked;
<span class="lineNum">    8426 </span>            : 
<span class="lineNum">    8427 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">    8428 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">    8429 </span>            :           case MID_Tools:
<span class="lineNum">    8430 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = CVPaletteIsVisible(cv,1);</span>
<span class="lineNum">    8431 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    8432 </span>            :           case MID_Layers:
<span class="lineNum">    8433 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = CVPaletteIsVisible(cv,0);</span>
<span class="lineNum">    8434 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    8435 </span>            :           case MID_DockPalettes:
<span class="lineNum">    8436 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = palettes_docked;</span>
<span class="lineNum">    8437 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    8438 </span>            :         }
<span class="lineNum">    8439 </span>            :     }
<a name="8440"><span class="lineNum">    8440 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8441 </span>            : 
<span class="lineNum">    8442 </span><span class="lineNoCov">          0 : static void pllistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8443 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8444 </span><span class="lineNoCov">          0 :     cv_pllistcheck(cv, mi);</span>
<span class="lineNum">    8445 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    8446 </span>            : 
<span class="lineNum">    8447 </span>            : /*
<span class="lineNum">    8448 </span>            :  * Unused
<span class="lineNum">    8449 </span>            : static void tablistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {
<span class="lineNum">    8450 </span>            :     GDrawGetUserData(gw);
<span class="lineNum">    8451 </span>            : }
<a name="8452"><span class="lineNum">    8452 </span>            : */</a>
<span class="lineNum">    8453 </span>            : 
<span class="lineNum">    8454 </span><span class="lineNoCov">          0 : static void CVUndo(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8455 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8456 </span>            : 
<span class="lineNum">    8457 </span><span class="lineNoCov">          0 :     Undoes *undo = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes;</span>
<span class="lineNum">    8458 </span>            : 
<span class="lineNum">    8459 </span>            : //    TRACE(&quot;CVUndo() undo:%p u-&gt;next:%p\n&quot;, undo, ( undo ? undo-&gt;next : 0 ) );
<span class="lineNum">    8460 </span><span class="lineNoCov">          0 :     if( undo )</span>
<span class="lineNum">    8461 </span>            :     {
<span class="lineNum">    8462 </span><span class="lineNoCov">          0 :         if ( collabclient_inSession( &amp;cv-&gt;b ) )  {</span>
<span class="lineNum">    8463 </span><span class="lineNoCov">          0 :             collabclient_performLocalUndo( &amp;cv-&gt;b );</span>
<span class="lineNum">    8464 </span><span class="lineNoCov">          0 :             cv-&gt;lastselpt = NULL;</span>
<span class="lineNum">    8465 </span><span class="lineNoCov">          0 :             _CVCharChangedUpdate(&amp;cv-&gt;b,1);</span>
<span class="lineNum">    8466 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    8467 </span>            :         }
<span class="lineNum">    8468 </span>            :     }
<span class="lineNum">    8469 </span>            : 
<span class="lineNum">    8470 </span><span class="lineNoCov">          0 :     CVDoUndo(&amp;cv-&gt;b);</span>
<span class="lineNum">    8471 </span><span class="lineNoCov">          0 :     cv-&gt;lastselpt = NULL;</span>
<a name="8472"><span class="lineNum">    8472 </span>            : }</a>
<span class="lineNum">    8473 </span>            : 
<span class="lineNum">    8474 </span><span class="lineNoCov">          0 : static void CVRedo(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8475 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8476 </span>            : 
<span class="lineNum">    8477 </span><span class="lineNoCov">          0 :     Undoes *undo = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;redoes;</span>
<span class="lineNum">    8478 </span><span class="lineNoCov">          0 :     if ( undo ) {</span>
<span class="lineNum">    8479 </span><span class="lineNoCov">          0 :         if ( collabclient_inSession(&amp;cv-&gt;b) )    {</span>
<span class="lineNum">    8480 </span>            :             TRACE(&quot;in-session (redo)!\n&quot;);
<span class="lineNum">    8481 </span><span class="lineNoCov">          0 :             collabclient_performLocalRedo( &amp;cv-&gt;b );</span>
<span class="lineNum">    8482 </span><span class="lineNoCov">          0 :             cv-&gt;lastselpt = NULL;</span>
<span class="lineNum">    8483 </span><span class="lineNoCov">          0 :             _CVCharChangedUpdate(&amp;cv-&gt;b,1);</span>
<span class="lineNum">    8484 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    8485 </span>            :         }
<span class="lineNum">    8486 </span>            :     }
<span class="lineNum">    8487 </span>            : 
<span class="lineNum">    8488 </span><span class="lineNoCov">          0 :     CVDoRedo(&amp;cv-&gt;b);</span>
<span class="lineNum">    8489 </span><span class="lineNoCov">          0 :     cv-&gt;lastselpt = NULL;</span>
<a name="8490"><span class="lineNum">    8490 </span>            : }</a>
<span class="lineNum">    8491 </span>            : 
<span class="lineNum">    8492 </span><span class="lineNoCov">          0 : static void _CVCopy(CharView *cv) {</span>
<span class="lineNum">    8493 </span><span class="lineNoCov">          0 :     int desel = false, anya;</span>
<span class="lineNum">    8494 </span>            : 
<span class="lineNum">    8495 </span>            :     /* If nothing is selected, copy everything. Do that by temporarily selecting everything */
<span class="lineNum">    8496 </span><span class="lineNoCov">          0 :     if ( !CVAnySel(cv,NULL,NULL,NULL,&amp;anya))</span>
<span class="lineNum">    8497 </span><span class="lineNoCov">          0 :         if ( !(desel = CVSetSel(cv,-1)))</span>
<span class="lineNum">    8498 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8499 </span><span class="lineNoCov">          0 :     CopySelected(&amp;cv-&gt;b,cv-&gt;showanchor);</span>
<span class="lineNum">    8500 </span><span class="lineNoCov">          0 :     if ( desel )</span>
<span class="lineNum">    8501 </span><span class="lineNoCov">          0 :         CVClearSel(cv);</span>
<a name="8502"><span class="lineNum">    8502 </span>            : }</a>
<span class="lineNum">    8503 </span>            : 
<span class="lineNum">    8504 </span><span class="lineNoCov">          0 : static void CVCopy(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8505 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8506 </span><span class="lineNoCov">          0 :     _CVCopy(cv);</span>
<a name="8507"><span class="lineNum">    8507 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8508 </span>            : 
<span class="lineNum">    8509 </span><span class="lineNoCov">          0 : static void CVCopyLookupData(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8510 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8511 </span><span class="lineNoCov">          0 :     SCCopyLookupData(cv-&gt;b.sc);</span>
<a name="8512"><span class="lineNum">    8512 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8513 </span>            : 
<span class="lineNum">    8514 </span><span class="lineNoCov">          0 : static void CVCopyRef(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8515 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8516 </span><span class="lineNoCov">          0 :     CopyReference(cv-&gt;b.sc);</span>
<a name="8517"><span class="lineNum">    8517 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8518 </span>            : 
<span class="lineNum">    8519 </span><span class="lineNoCov">          0 : static void CVMenuCopyGridFit(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8520 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8521 </span><span class="lineNoCov">          0 :     CVCopyGridFit(&amp;cv-&gt;b);</span>
<a name="8522"><span class="lineNum">    8522 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8523 </span>            : 
<span class="lineNum">    8524 </span><span class="lineNoCov">          0 : static void CVCopyWidth(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8525 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8526 </span><span class="lineNoCov">          0 :     if ( mi-&gt;mid==MID_CopyVWidth &amp;&amp; !cv-&gt;b.sc-&gt;parent-&gt;hasvmetrics )</span>
<span class="lineNum">    8527 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8528 </span><span class="lineNoCov">          0 :     CopyWidth(&amp;cv-&gt;b,mi-&gt;mid==MID_CopyWidth?ut_width:</span>
<span class="lineNum">    8529 </span><span class="lineNoCov">          0 :                      mi-&gt;mid==MID_CopyVWidth?ut_vwidth:</span>
<span class="lineNum">    8530 </span><span class="lineNoCov">          0 :                      mi-&gt;mid==MID_CopyLBearing?ut_lbearing:</span>
<span class="lineNum">    8531 </span>            :                                              ut_rbearing);
<a name="8532"><span class="lineNum">    8532 </span>            : }</a>
<span class="lineNum">    8533 </span>            : 
<span class="lineNum">    8534 </span><span class="lineNoCov">          0 : static void CVDoClear(CharView *cv) {</span>
<span class="lineNum">    8535 </span>            :     ImageList *prev, *imgs, *next;
<span class="lineNum">    8536 </span>            :     RefChar *refs, *rnext;
<span class="lineNum">    8537 </span><span class="lineNoCov">          0 :     int layer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    8538 </span>            :     int anyimages;
<span class="lineNum">    8539 </span>            : 
<span class="lineNum">    8540 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    8541 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.drawmode==dm_fore )</span>
<span class="lineNum">    8542 </span><span class="lineNoCov">          0 :         SCRemoveSelectedMinimumDistances(cv-&gt;b.sc,2);</span>
<span class="lineNum">    8543 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines = SplinePointListRemoveSelected(cv-&gt;b.sc,</span>
<span class="lineNum">    8544 </span><span class="lineNoCov">          0 :             cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines);</span>
<span class="lineNum">    8545 </span><span class="lineNoCov">          0 :     for ( refs=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs; refs!=NULL; refs = rnext ) {</span>
<span class="lineNum">    8546 </span><span class="lineNoCov">          0 :         rnext = refs-&gt;next;</span>
<span class="lineNum">    8547 </span><span class="lineNoCov">          0 :         if ( refs-&gt;selected )</span>
<span class="lineNum">    8548 </span><span class="lineNoCov">          0 :             SCRemoveDependent(cv-&gt;b.sc,refs,layer);</span>
<span class="lineNum">    8549 </span>            :     }
<span class="lineNum">    8550 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.drawmode==dm_fore ) {</span>
<span class="lineNum">    8551 </span><span class="lineNoCov">          0 :         AnchorPoint *ap, *aprev=NULL, *anext;</span>
<span class="lineNum">    8552 </span><span class="lineNoCov">          0 :         if ( cv-&gt;showanchor ) for ( ap=cv-&gt;b.sc-&gt;anchor; ap!=NULL; ap=anext ) {</span>
<span class="lineNum">    8553 </span><span class="lineNoCov">          0 :             anext = ap-&gt;next;</span>
<span class="lineNum">    8554 </span><span class="lineNoCov">          0 :             if ( ap-&gt;selected ) {</span>
<span class="lineNum">    8555 </span><span class="lineNoCov">          0 :                 if ( aprev!=NULL )</span>
<span class="lineNum">    8556 </span><span class="lineNoCov">          0 :                     aprev-&gt;next = anext;</span>
<span class="lineNum">    8557 </span>            :                 else
<span class="lineNum">    8558 </span><span class="lineNoCov">          0 :                     cv-&gt;b.sc-&gt;anchor = anext;</span>
<span class="lineNum">    8559 </span><span class="lineNoCov">          0 :                 ap-&gt;next = NULL;</span>
<span class="lineNum">    8560 </span><span class="lineNoCov">          0 :                 AnchorPointsFree(ap);</span>
<span class="lineNum">    8561 </span>            :             } else
<span class="lineNum">    8562 </span><span class="lineNoCov">          0 :                 aprev = ap;</span>
<span class="lineNum">    8563 </span>            :         }
<span class="lineNum">    8564 </span>            :     }
<span class="lineNum">    8565 </span><span class="lineNoCov">          0 :     anyimages = false;</span>
<span class="lineNum">    8566 </span><span class="lineNoCov">          0 :     for ( prev = NULL, imgs=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images; imgs!=NULL; imgs = next ) {</span>
<span class="lineNum">    8567 </span><span class="lineNoCov">          0 :         next = imgs-&gt;next;</span>
<span class="lineNum">    8568 </span><span class="lineNoCov">          0 :         if ( !imgs-&gt;selected )</span>
<span class="lineNum">    8569 </span><span class="lineNoCov">          0 :             prev = imgs;</span>
<span class="lineNum">    8570 </span>            :         else {
<span class="lineNum">    8571 </span><span class="lineNoCov">          0 :             if ( prev==NULL )</span>
<span class="lineNum">    8572 </span><span class="lineNoCov">          0 :                 cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images = next;</span>
<span class="lineNum">    8573 </span>            :             else
<span class="lineNum">    8574 </span><span class="lineNoCov">          0 :                 prev-&gt;next = next;</span>
<span class="lineNum">    8575 </span><span class="lineNoCov">          0 :             chunkfree(imgs,sizeof(ImageList));</span>
<span class="lineNum">    8576 </span>            :             /* garbage collection of images????!!!! */
<span class="lineNum">    8577 </span><span class="lineNoCov">          0 :             anyimages = true;</span>
<span class="lineNum">    8578 </span>            :         }
<span class="lineNum">    8579 </span>            :     }
<span class="lineNum">    8580 </span><span class="lineNoCov">          0 :     if ( anyimages )</span>
<span class="lineNum">    8581 </span><span class="lineNoCov">          0 :         SCOutOfDateBackground(cv-&gt;b.sc);</span>
<span class="lineNum">    8582 </span><span class="lineNoCov">          0 :     if ( cv-&gt;lastselpt!=NULL || cv-&gt;p.sp!=NULL || cv-&gt;p.spiro!=NULL || cv-&gt;lastselcp!=NULL ) {</span>
<span class="lineNum">    8583 </span><span class="lineNoCov">          0 :         cv-&gt;lastselpt = NULL; cv-&gt;p.sp = NULL;</span>
<span class="lineNum">    8584 </span><span class="lineNoCov">          0 :         cv-&gt;p.spiro = cv-&gt;lastselcp = NULL;</span>
<span class="lineNum">    8585 </span><span class="lineNoCov">          0 :         CVInfoDraw(cv,cv-&gt;gw);</span>
<span class="lineNum">    8586 </span>            :     }
<a name="8587"><span class="lineNum">    8587 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8588 </span>            : 
<span class="lineNum">    8589 </span><span class="lineNoCov">          0 : static void CVClear(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8590 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8591 </span>            :     int anyanchor;
<span class="lineNum">    8592 </span>            : 
<span class="lineNum">    8593 </span><span class="lineNoCov">          0 :     if ( !CVAnySel(cv,NULL,NULL,NULL,&amp;anyanchor))</span>
<span class="lineNum">    8594 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8595 </span><span class="lineNoCov">          0 :     CVDoClear(cv);</span>
<span class="lineNum">    8596 </span><span class="lineNoCov">          0 :     CVGridHandlePossibleFitChar( cv );</span>
<span class="lineNum">    8597 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="8598"><span class="lineNum">    8598 </span>            : }</a>
<span class="lineNum">    8599 </span>            : 
<span class="lineNum">    8600 </span><span class="lineNoCov">          0 : static void CVClearBackground(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8601 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8602 </span><span class="lineNoCov">          0 :     SCClearBackground(cv-&gt;b.sc);</span>
<a name="8603"><span class="lineNum">    8603 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8604 </span>            : 
<span class="lineNum">    8605 </span><span class="lineNoCov">          0 : static void _CVPaste(CharView *cv) {</span>
<span class="lineNum">    8606 </span><span class="lineNoCov">          0 :     enum undotype ut = CopyUndoType();</span>
<span class="lineNum">    8607 </span><span class="lineNoCov">          0 :     int was_empty = cv-&gt;b.drawmode==dm_fore &amp;&amp; cv-&gt;b.sc-&gt;hstem==NULL &amp;&amp; cv-&gt;b.sc-&gt;vstem==NULL &amp;&amp; cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL &amp;&amp; cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs==NULL;</span>
<span class="lineNum">    8608 </span><span class="lineNoCov">          0 :     if ( ut!=ut_lbearing )      /* The lbearing code does this itself */</span>
<span class="lineNum">    8609 </span><span class="lineNoCov">          0 :         CVPreserveStateHints(&amp;cv-&gt;b);</span>
<span class="lineNum">    8610 </span><span class="lineNoCov">          0 :     if ( ut!=ut_width &amp;&amp; ut!=ut_vwidth &amp;&amp; ut!=ut_lbearing &amp;&amp; ut!=ut_rbearing &amp;&amp; ut!=ut_possub )</span>
<span class="lineNum">    8611 </span><span class="lineNoCov">          0 :         CVClearSel(cv);</span>
<span class="lineNum">    8612 </span><span class="lineNoCov">          0 :     PasteToCV(&amp;cv-&gt;b);</span>
<span class="lineNum">    8613 </span><span class="lineNoCov">          0 :     cv-&gt;lastselpt = NULL;</span>
<span class="lineNum">    8614 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<span class="lineNum">    8615 </span><span class="lineNoCov">          0 :     if ( was_empty &amp;&amp; (cv-&gt;b.sc-&gt;hstem != NULL || cv-&gt;b.sc-&gt;vstem!=NULL ))</span>
<span class="lineNum">    8616 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;changedsincelasthinted = false;</span>
<a name="8617"><span class="lineNum">    8617 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8618 </span>            : 
<span class="lineNum">    8619 </span><span class="lineNoCov">          0 : static void CVPaste(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8620 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8621 </span><span class="lineNoCov">          0 :     _CVPaste(cv);</span>
<span class="lineNum">    8622 </span><span class="lineNoCov">          0 :     CVInkscapeAdjust(cv);</span>
<a name="8623"><span class="lineNum">    8623 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8624 </span>            : 
<span class="lineNum">    8625 </span><span class="lineNoCov">          0 : static void _CVMerge(CharView *cv, int elide) {</span>
<span class="lineNum">    8626 </span><span class="lineNoCov">          0 :     int anyp = 0;</span>
<span class="lineNum">    8627 </span>            : 
<span class="lineNum">    8628 </span><span class="lineNoCov">          0 :     if ( !CVAnySel(cv,&amp;anyp,NULL,NULL,NULL) || !anyp)</span>
<span class="lineNum">    8629 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8630 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    8631 </span><span class="lineNoCov">          0 :     SplineCharMerge(cv-&gt;b.sc,&amp;cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,!elide);</span>
<span class="lineNum">    8632 </span><span class="lineNoCov">          0 :     SCClearSelPt(cv-&gt;b.sc);</span>
<span class="lineNum">    8633 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="8634"><span class="lineNum">    8634 </span>            : }</a>
<span class="lineNum">    8635 </span>            : 
<span class="lineNum">    8636 </span><span class="lineNoCov">          0 : void CVMerge(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8637 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8638 </span><span class="lineNoCov">          0 :     _CVMerge(cv,false);</span>
<a name="8639"><span class="lineNum">    8639 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8640 </span>            : 
<span class="lineNum">    8641 </span><span class="lineNoCov">          0 : static void _CVMergeToLine(CharView *cv, int elide) {</span>
<span class="lineNum">    8642 </span><span class="lineNoCov">          0 :     int anyp = 0;</span>
<span class="lineNum">    8643 </span>            : 
<span class="lineNum">    8644 </span><span class="lineNoCov">          0 :     if ( !CVAnySel(cv,&amp;anyp,NULL,NULL,NULL) || !anyp)</span>
<span class="lineNum">    8645 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    8646 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    8647 </span><span class="lineNoCov">          0 :     SplineCharMerge(cv-&gt;b.sc,&amp;cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,!elide);</span>
<span class="lineNum">    8648 </span>            : 
<span class="lineNum">    8649 </span>            :     // Select the other side of the new curve
<span class="lineNum">    8650 </span><span class="lineNoCov">          0 :     GList_Glib* gl = CVGetSelectedPoints( cv );</span>
<span class="lineNum">    8651 </span><span class="lineNoCov">          0 :     if( g_list_first(gl) )</span>
<span class="lineNum">    8652 </span><span class="lineNoCov">          0 :         SPSelectPrevPoint( (SplinePoint*)g_list_first(gl)-&gt;data, 1 );</span>
<span class="lineNum">    8653 </span><span class="lineNoCov">          0 :     g_list_free( gl );</span>
<span class="lineNum">    8654 </span>            : 
<span class="lineNum">    8655 </span>            :     // And make the curve between the two active points a line
<span class="lineNum">    8656 </span><span class="lineNoCov">          0 :     _CVMenuMakeLine( (CharViewBase*) cv, 0, 0 );</span>
<span class="lineNum">    8657 </span><span class="lineNoCov">          0 :     SCClearSelPt(cv-&gt;b.sc);</span>
<span class="lineNum">    8658 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="8659"><span class="lineNum">    8659 </span>            : }</a>
<span class="lineNum">    8660 </span>            : 
<span class="lineNum">    8661 </span><span class="lineNoCov">          0 : void CVMergeToLine(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8662 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8663 </span><span class="lineNoCov">          0 :     _CVMergeToLine(cv,false);</span>
<span class="lineNum">    8664 </span>            : 
<a name="8665"><span class="lineNum">    8665 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8666 </span>            : 
<span class="lineNum">    8667 </span><span class="lineNoCov">          0 : static void _CVJoin(CharView *cv) {</span>
<span class="lineNum">    8668 </span><span class="lineNoCov">          0 :     int anyp = 0, changed;</span>
<span class="lineNum">    8669 </span>            :     extern float joinsnap;
<span class="lineNum">    8670 </span>            : 
<span class="lineNum">    8671 </span><span class="lineNoCov">          0 :     CVAnySel(cv,&amp;anyp,NULL,NULL,NULL);</span>
<span class="lineNum">    8672 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    8673 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines = SplineSetJoin(cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,!anyp,joinsnap/cv-&gt;scale,&amp;changed);</span>
<span class="lineNum">    8674 </span><span class="lineNoCov">          0 :     if ( changed )</span>
<span class="lineNum">    8675 </span><span class="lineNoCov">          0 :         CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="8676"><span class="lineNum">    8676 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8677 </span>            : 
<span class="lineNum">    8678 </span><span class="lineNoCov">          0 : static void CVJoin(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8679 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8680 </span><span class="lineNoCov">          0 :     _CVJoin(cv);</span>
<a name="8681"><span class="lineNum">    8681 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8682 </span>            : 
<span class="lineNum">    8683 </span><span class="lineNoCov">          0 : static void _CVCut(CharView *cv) {</span>
<span class="lineNum">    8684 </span>            :     int anya;
<span class="lineNum">    8685 </span>            : 
<span class="lineNum">    8686 </span><span class="lineNoCov">          0 :     if ( !CVAnySel(cv,NULL,NULL,NULL,&amp;anya))</span>
<span class="lineNum">    8687 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8688 </span><span class="lineNoCov">          0 :     _CVCopy(cv);</span>
<span class="lineNum">    8689 </span><span class="lineNoCov">          0 :     CVDoClear(cv);</span>
<span class="lineNum">    8690 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="8691"><span class="lineNum">    8691 </span>            : }</a>
<span class="lineNum">    8692 </span>            : 
<span class="lineNum">    8693 </span><span class="lineNoCov">          0 : static void CVCut(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8694 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8695 </span><span class="lineNoCov">          0 :     _CVCut(cv);</span>
<a name="8696"><span class="lineNum">    8696 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8697 </span>            : 
<span class="lineNum">    8698 </span><span class="lineNoCov">          0 : static void CVCopyFgBg(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8699 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8700 </span>            : 
<span class="lineNum">    8701 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc-&gt;layers[ly_fore].splines==NULL )</span>
<span class="lineNum">    8702 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8703 </span><span class="lineNoCov">          0 :     SCCopyLayerToLayer(cv-&gt;b.sc,ly_fore,ly_back,false);</span>
<a name="8704"><span class="lineNum">    8704 </span>            : }</a>
<span class="lineNum">    8705 </span>            : 
<span class="lineNum">    8706 </span><span class="lineNoCov">          0 : static void CVMenuCopyL2L(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8707 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8708 </span><span class="lineNoCov">          0 :     CVCopyLayerToLayer(cv);</span>
<a name="8709"><span class="lineNum">    8709 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8710 </span>            : 
<span class="lineNum">    8711 </span><span class="lineNoCov">          0 : static void CVMenuCompareL2L(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8712 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8713 </span><span class="lineNoCov">          0 :     CVCompareLayerToLayer(cv);</span>
<a name="8714"><span class="lineNum">    8714 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8715 </span>            : 
<span class="lineNum">    8716 </span><span class="lineNoCov">          0 : static void CVSelectAll(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8717 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8718 </span><span class="lineNoCov">          0 :     int mask = -1;</span>
<span class="lineNum">    8719 </span>            : 
<span class="lineNum">    8720 </span><span class="lineNoCov">          0 :     if ( mi-&gt;mid==MID_SelectAllPoints )</span>
<span class="lineNum">    8721 </span><span class="lineNoCov">          0 :         mask = 1;</span>
<span class="lineNum">    8722 </span><span class="lineNoCov">          0 :     else if ( mi-&gt;mid==MID_SelectAnchors )</span>
<span class="lineNum">    8723 </span><span class="lineNoCov">          0 :         mask = 2;</span>
<span class="lineNum">    8724 </span><span class="lineNoCov">          0 :     else if ( mi-&gt;mid==MID_SelAll ) {</span>
<span class="lineNum">    8725 </span><span class="lineNoCov">          0 :         mask = 1;</span>
<span class="lineNum">    8726 </span><span class="lineNoCov">          0 :         if (cv-&gt;b.drawmode==dm_fore) mask+=2;</span>
<span class="lineNum">    8727 </span>            :         /* TODO! Should we also check if this is the right foreground layer? */
<span class="lineNum">    8728 </span>            :     }
<span class="lineNum">    8729 </span>            : 
<span class="lineNum">    8730 </span><span class="lineNoCov">          0 :     if ( CVSetSel(cv,mask))</span>
<span class="lineNum">    8731 </span><span class="lineNoCov">          0 :         SCUpdateAll(cv-&gt;b.sc);</span>
<a name="8732"><span class="lineNum">    8732 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8733 </span>            : 
<span class="lineNum">    8734 </span><span class="lineNoCov">          0 : static void CVSelectOpenContours(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8735 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8736 </span>            :     SplineSet *ss;
<span class="lineNum">    8737 </span>            :     int i;
<span class="lineNum">    8738 </span>            :     SplinePoint *sp;
<span class="lineNum">    8739 </span><span class="lineNoCov">          0 :     int changed = CVClearSel(cv);</span>
<span class="lineNum">    8740 </span>            : 
<span class="lineNum">    8741 </span><span class="lineNoCov">          0 :     for ( ss=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; ss!=NULL; ss=ss-&gt;next ) {</span>
<span class="lineNum">    8742 </span><span class="lineNoCov">          0 :         if ( ss-&gt;first-&gt;prev==NULL ) {</span>
<span class="lineNum">    8743 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    8744 </span><span class="lineNoCov">          0 :             if ( cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro()) {</span>
<span class="lineNum">    8745 </span><span class="lineNoCov">          0 :                 for ( i=0; i&lt;ss-&gt;spiro_cnt; ++i )</span>
<span class="lineNum">    8746 </span><span class="lineNoCov">          0 :                     SPIRO_SELECT(&amp;ss-&gt;spiros[i]);</span>
<span class="lineNum">    8747 </span>            :             } else {
<span class="lineNum">    8748 </span><span class="lineNoCov">          0 :                 for ( sp=ss-&gt;first ;; ) {</span>
<span class="lineNum">    8749 </span><span class="lineNoCov">          0 :                     sp-&gt;selected = true;</span>
<span class="lineNum">    8750 </span><span class="lineNoCov">          0 :                     if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    8751 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    8752 </span><span class="lineNoCov">          0 :                     sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    8753 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    8754 </span>            :             }
<span class="lineNum">    8755 </span>            :         }
<span class="lineNum">    8756 </span>            :     }
<span class="lineNum">    8757 </span><span class="lineNoCov">          0 :     if ( changed )</span>
<span class="lineNum">    8758 </span><span class="lineNoCov">          0 :         SCUpdateAll(cv-&gt;b.sc);</span>
<a name="8759"><span class="lineNum">    8759 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8760 </span>            : 
<span class="lineNum">    8761 </span><span class="lineNoCov">          0 : static void CVSelectNone(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8762 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8763 </span><span class="lineNoCov">          0 :     if ( CVClearSel(cv))</span>
<span class="lineNum">    8764 </span><span class="lineNoCov">          0 :         SCUpdateAll(cv-&gt;b.sc);</span>
<a name="8765"><span class="lineNum">    8765 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8766 </span>            : 
<span class="lineNum">    8767 </span><span class="lineNoCov">          0 : static void CVSelectInvert(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8768 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8769 </span><span class="lineNoCov">          0 :     CVInvertSel(cv);</span>
<span class="lineNum">    8770 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<a name="8771"><span class="lineNum">    8771 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8772 </span>            : 
<span class="lineNum">    8773 </span><span class="lineNoCov">          0 : static void CVSelectWidth(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8774 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8775 </span><span class="lineNoCov">          0 :     if ( HasUseMyMetrics(cv-&gt;b.sc,CVLayer((CharViewBase *) cv))!=NULL )</span>
<span class="lineNum">    8776 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8777 </span><span class="lineNoCov">          0 :     cv-&gt;widthsel = !cv-&gt;widthsel;</span>
<span class="lineNum">    8778 </span><span class="lineNoCov">          0 :     cv-&gt;oldwidth = cv-&gt;b.sc-&gt;width;</span>
<span class="lineNum">    8779 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<a name="8780"><span class="lineNum">    8780 </span>            : }</a>
<span class="lineNum">    8781 </span>            : 
<span class="lineNum">    8782 </span><span class="lineNoCov">          0 : static void CVSelectVWidth(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8783 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8784 </span><span class="lineNoCov">          0 :     if ( !cv-&gt;showvmetrics || !cv-&gt;b.sc-&gt;parent-&gt;hasvmetrics )</span>
<span class="lineNum">    8785 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8786 </span><span class="lineNoCov">          0 :     if ( HasUseMyMetrics(cv-&gt;b.sc,CVLayer((CharViewBase *) cv))!=NULL )</span>
<span class="lineNum">    8787 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8788 </span><span class="lineNoCov">          0 :     cv-&gt;vwidthsel = !cv-&gt;widthsel;</span>
<span class="lineNum">    8789 </span><span class="lineNoCov">          0 :     cv-&gt;oldvwidth = cv-&gt;b.sc-&gt;vwidth;</span>
<span class="lineNum">    8790 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<a name="8791"><span class="lineNum">    8791 </span>            : }</a>
<span class="lineNum">    8792 </span>            : 
<span class="lineNum">    8793 </span><span class="lineNoCov">          0 : static void CVSelectHM(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8794 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8795 </span>            :     SplinePoint *sp; SplineSet *spl; RefChar *r; ImageList *im;
<span class="lineNum">    8796 </span>            :     spiro_cp *junk;
<span class="lineNum">    8797 </span><span class="lineNoCov">          0 :     int exactlyone = CVOneThingSel(cv,&amp;sp,&amp;spl,&amp;r,&amp;im,NULL,&amp;junk);</span>
<span class="lineNum">    8798 </span>            : 
<span class="lineNum">    8799 </span><span class="lineNoCov">          0 :     if ( !exactlyone || sp==NULL || sp-&gt;hintmask == NULL || spl==NULL )</span>
<span class="lineNum">    8800 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    8801 </span><span class="lineNoCov">          0 :     while ( sp!=NULL ) {</span>
<span class="lineNum">    8802 </span><span class="lineNoCov">          0 :         if ( sp-&gt;prev==NULL )</span>
<span class="lineNum">    8803 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    8804 </span><span class="lineNoCov">          0 :         sp = sp-&gt;prev-&gt;from;</span>
<span class="lineNum">    8805 </span><span class="lineNoCov">          0 :         if ( sp == spl-&gt;first )</span>
<span class="lineNum">    8806 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    8807 </span><span class="lineNoCov">          0 :         if ( sp-&gt;hintmask!=NULL )</span>
<span class="lineNum">    8808 </span><span class="lineNoCov">          0 :  goto done;</span>
<span class="lineNum">    8809 </span><span class="lineNoCov">          0 :         sp-&gt;selected = true;</span>
<span class="lineNum">    8810 </span>            :     }
<span class="lineNum">    8811 </span><span class="lineNoCov">          0 :     for ( spl = spl-&gt;next; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">    8812 </span><span class="lineNoCov">          0 :         for ( sp=spl-&gt;first; sp!=NULL;  ) {</span>
<span class="lineNum">    8813 </span><span class="lineNoCov">          0 :             if ( sp-&gt;hintmask!=NULL )</span>
<span class="lineNum">    8814 </span><span class="lineNoCov">          0 :  goto done;</span>
<span class="lineNum">    8815 </span><span class="lineNoCov">          0 :             sp-&gt;selected = true;</span>
<span class="lineNum">    8816 </span><span class="lineNoCov">          0 :             if ( sp-&gt;prev==NULL )</span>
<span class="lineNum">    8817 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    8818 </span><span class="lineNoCov">          0 :             sp = sp-&gt;prev-&gt;from;</span>
<span class="lineNum">    8819 </span><span class="lineNoCov">          0 :             if ( sp == spl-&gt;first )</span>
<span class="lineNum">    8820 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    8821 </span>            :         }
<span class="lineNum">    8822 </span>            :     }
<span class="lineNum">    8823 </span>            :  done:
<span class="lineNum">    8824 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<a name="8825"><span class="lineNum">    8825 </span>            : }</a>
<span class="lineNum">    8826 </span>            : 
<span class="lineNum">    8827 </span><span class="lineNoCov">          0 : static void _CVUnlinkRef(CharView *cv) {</span>
<span class="lineNum">    8828 </span><span class="lineNoCov">          0 :     int anyrefs=0;</span>
<span class="lineNum">    8829 </span>            :     RefChar *rf, *next;
<span class="lineNum">    8830 </span>            : 
<span class="lineNum">    8831 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs!=NULL ) {</span>
<span class="lineNum">    8832 </span><span class="lineNoCov">          0 :         CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    8833 </span><span class="lineNoCov">          0 :         for ( rf=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs; rf!=NULL &amp;&amp; !anyrefs; rf=rf-&gt;next )</span>
<span class="lineNum">    8834 </span><span class="lineNoCov">          0 :             if ( rf-&gt;selected ) anyrefs = true;</span>
<span class="lineNum">    8835 </span><span class="lineNoCov">          0 :         for ( rf=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs; rf!=NULL ; rf=next ) {</span>
<span class="lineNum">    8836 </span><span class="lineNoCov">          0 :             next = rf-&gt;next;</span>
<span class="lineNum">    8837 </span><span class="lineNoCov">          0 :             if ( rf-&gt;selected || !anyrefs) {</span>
<span class="lineNum">    8838 </span><span class="lineNoCov">          0 :                 SCRefToSplines(cv-&gt;b.sc,rf,CVLayer((CharViewBase *) cv));</span>
<span class="lineNum">    8839 </span>            :             }
<span class="lineNum">    8840 </span>            :         }
<span class="lineNum">    8841 </span><span class="lineNoCov">          0 :         CVSetCharChanged(cv,true);</span>
<span class="lineNum">    8842 </span><span class="lineNoCov">          0 :         SCUpdateAll(cv-&gt;b.sc);</span>
<span class="lineNum">    8843 </span>            :         /* Don't need to update dependancies, their splines won't have changed*/
<span class="lineNum">    8844 </span>            :     }
<a name="8845"><span class="lineNum">    8845 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8846 </span>            : 
<span class="lineNum">    8847 </span><span class="lineNoCov">          0 : static void CVUnlinkRef(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    8848 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    8849 </span><span class="lineNoCov">          0 :     _CVUnlinkRef(cv);</span>
<span class="lineNum">    8850 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    8851 </span>            : 
<span class="lineNum">    8852 </span>            : typedef struct getValueDialogData
<span class="lineNum">    8853 </span>            : {
<span class="lineNum">    8854 </span>            :     int done;
<span class="lineNum">    8855 </span>            :     int cancelled;
<span class="lineNum">    8856 </span>            :     CharView *cv;
<span class="lineNum">    8857 </span>            :     GWindow gw;
<span class="lineNum">    8858 </span>            :     char* ret;
<span class="lineNum">    8859 </span>            :     GTextInfo label;
<a name="8860"><span class="lineNum">    8860 </span>            : } GetValueDialogData;</a>
<span class="lineNum">    8861 </span>            : 
<span class="lineNum">    8862 </span><span class="lineNoCov">          0 : static int getValueDialogData_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    8863 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">    8864 </span><span class="lineNoCov">          0 :         GetValueDialogData *hd = GDrawGetUserData(gw);</span>
<span class="lineNum">    8865 </span><span class="lineNoCov">          0 :         hd-&gt;done = true;</span>
<span class="lineNum">    8866 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_char ) {</span>
<span class="lineNum">    8867 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    8868 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_map ) {</span>
<span class="lineNum">    8869 </span>            :         /* Above palettes */
<span class="lineNum">    8870 </span><span class="lineNoCov">          0 :         GDrawRaise(gw);</span>
<span class="lineNum">    8871 </span>            :     }
<span class="lineNum">    8872 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="8873"><span class="lineNum">    8873 </span>            : }</a>
<span class="lineNum">    8874 </span>            : 
<span class="lineNum">    8875 </span><span class="lineNoCov">          0 : static int getValueFromUser_OK(GGadget *g, GEvent *e)</span>
<span class="lineNum">    8876 </span>            : {
<span class="lineNum">    8877 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    8878 </span><span class="lineNoCov">          0 :         GetValueDialogData *hd = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    8879 </span><span class="lineNoCov">          0 :         strcpy( hd-&gt;ret, u_to_c(hd-&gt;label.text));</span>
<span class="lineNum">    8880 </span><span class="lineNoCov">          0 :         strcpy( hd-&gt;ret, GGadgetGetTitle8(GWidgetGetControl(hd-&gt;gw,CID_getValueFromUser)));</span>
<span class="lineNum">    8881 </span><span class="lineNoCov">          0 :         hd-&gt;done = true;</span>
<span class="lineNum">    8882 </span>            :     }
<span class="lineNum">    8883 </span><span class="lineNoCov">          0 :     return( true );</span>
<a name="8884"><span class="lineNum">    8884 </span>            : }</a>
<span class="lineNum">    8885 </span>            : 
<span class="lineNum">    8886 </span><span class="lineNoCov">          0 : static int getValueFromUser_Cancel(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    8887 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    8888 </span><span class="lineNoCov">          0 :         GetValueDialogData *hd = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    8889 </span><span class="lineNoCov">          0 :         hd-&gt;cancelled = true;</span>
<span class="lineNum">    8890 </span><span class="lineNoCov">          0 :         hd-&gt;done = true;</span>
<span class="lineNum">    8891 </span>            :     }
<span class="lineNum">    8892 </span><span class="lineNoCov">          0 :     return( true );</span>
<a name="8893"><span class="lineNum">    8893 </span>            : }</a>
<span class="lineNum">    8894 </span>            : 
<span class="lineNum">    8895 </span><span class="lineNoCov">          0 : static char* getValueFromUser( CharView *cv, const char* windowTitle, const char* msg, const char* defaultValue )</span>
<span class="lineNum">    8896 </span>            : {
<span class="lineNum">    8897 </span><span class="lineNoCov">          0 :     const int retsz = 4096;</span>
<span class="lineNum">    8898 </span>            :     static char ret[4097];
<span class="lineNum">    8899 </span>            :     static GetValueDialogData DATA;
<span class="lineNum">    8900 </span>            :     GRect pos;
<span class="lineNum">    8901 </span>            :     GWindow gw;
<span class="lineNum">    8902 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    8903 </span>            :     GGadgetCreateData gcd[9], *harray1[4], *harray2[9], *barray[7], *varray[5][2], boxes[5];
<span class="lineNum">    8904 </span>            :     GTextInfo label[9];
<span class="lineNum">    8905 </span>            : 
<span class="lineNum">    8906 </span><span class="lineNoCov">          0 :     DATA.cancelled = false;</span>
<span class="lineNum">    8907 </span><span class="lineNoCov">          0 :     DATA.done = false;</span>
<span class="lineNum">    8908 </span><span class="lineNoCov">          0 :     DATA.cv = cv;</span>
<span class="lineNum">    8909 </span><span class="lineNoCov">          0 :     DATA.ret = ret;</span>
<span class="lineNum">    8910 </span><span class="lineNoCov">          0 :     ret[0] = '\0';</span>
<span class="lineNum">    8911 </span>            : 
<span class="lineNum">    8912 </span><span class="lineNoCov">          0 :     if ( DATA.gw==NULL ) {</span>
<span class="lineNum">    8913 </span><span class="lineNoCov">          0 :         memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    8914 </span><span class="lineNoCov">          0 :         wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_isdlg|wam_restrict;</span>
<span class="lineNum">    8915 </span><span class="lineNoCov">          0 :         wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">    8916 </span><span class="lineNoCov">          0 :         wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">    8917 </span><span class="lineNoCov">          0 :         wattrs.undercursor = 1;</span>
<span class="lineNum">    8918 </span><span class="lineNoCov">          0 :         wattrs.cursor = ct_pointer;</span>
<span class="lineNum">    8919 </span><span class="lineNoCov">          0 :         wattrs.utf8_window_title = windowTitle;</span>
<span class="lineNum">    8920 </span><span class="lineNoCov">          0 :         wattrs.is_dlg = true;</span>
<span class="lineNum">    8921 </span><span class="lineNoCov">          0 :         pos.x = pos.y = 0;</span>
<span class="lineNum">    8922 </span><span class="lineNoCov">          0 :         pos.width = GGadgetScale(GDrawPointsToPixels(NULL,170));</span>
<span class="lineNum">    8923 </span><span class="lineNoCov">          0 :         pos.height = GDrawPointsToPixels(NULL,90);</span>
<span class="lineNum">    8924 </span><span class="lineNoCov">          0 :         DATA.gw = gw = GDrawCreateTopWindow(NULL,&amp;pos,getValueDialogData_e_h,&amp;DATA,&amp;wattrs);</span>
<span class="lineNum">    8925 </span>            : 
<span class="lineNum">    8926 </span><span class="lineNoCov">          0 :         memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">    8927 </span><span class="lineNoCov">          0 :         memset(&amp;gcd,  0,sizeof(gcd));</span>
<span class="lineNum">    8928 </span><span class="lineNoCov">          0 :         memset(&amp;boxes,0,sizeof(boxes));</span>
<span class="lineNum">    8929 </span>            : 
<span class="lineNum">    8930 </span><span class="lineNoCov">          0 :         label[0].text = (unichar_t *) msg;</span>
<span class="lineNum">    8931 </span><span class="lineNoCov">          0 :         label[0].text_is_1byte = true;</span>
<span class="lineNum">    8932 </span><span class="lineNoCov">          0 :         label[0].text_in_resource = true;</span>
<span class="lineNum">    8933 </span><span class="lineNoCov">          0 :         gcd[0].gd.label = &amp;label[0];</span>
<span class="lineNum">    8934 </span><span class="lineNoCov">          0 :         gcd[0].gd.pos.x = 5;</span>
<span class="lineNum">    8935 </span><span class="lineNoCov">          0 :         gcd[0].gd.pos.y = 5;</span>
<span class="lineNum">    8936 </span><span class="lineNoCov">          0 :         gcd[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    8937 </span><span class="lineNoCov">          0 :         gcd[0].creator = GLabelCreate;</span>
<span class="lineNum">    8938 </span><span class="lineNoCov">          0 :         harray1[0] = GCD_Glue;</span>
<span class="lineNum">    8939 </span><span class="lineNoCov">          0 :         harray1[1] = &amp;gcd[0];</span>
<span class="lineNum">    8940 </span><span class="lineNoCov">          0 :         harray1[2] = 0;</span>
<span class="lineNum">    8941 </span>            : 
<span class="lineNum">    8942 </span><span class="lineNoCov">          0 :         label[1].text = (unichar_t *) defaultValue;</span>
<span class="lineNum">    8943 </span><span class="lineNoCov">          0 :         label[1].text_is_1byte = true;</span>
<span class="lineNum">    8944 </span><span class="lineNoCov">          0 :         DATA.label = label[1];</span>
<span class="lineNum">    8945 </span><span class="lineNoCov">          0 :         gcd[1].gd.label = &amp;label[1];</span>
<span class="lineNum">    8946 </span><span class="lineNoCov">          0 :         gcd[1].gd.pos.x = 5;</span>
<span class="lineNum">    8947 </span><span class="lineNoCov">          0 :         gcd[1].gd.pos.y = 17+5;</span>
<span class="lineNum">    8948 </span><span class="lineNoCov">          0 :         gcd[1].gd.pos.width = 40;</span>
<span class="lineNum">    8949 </span><span class="lineNoCov">          0 :         gcd[1].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    8950 </span><span class="lineNoCov">          0 :         gcd[1].gd.cid = CID_getValueFromUser;</span>
<span class="lineNum">    8951 </span><span class="lineNoCov">          0 :         gcd[1].creator = GTextFieldCreate;</span>
<span class="lineNum">    8952 </span><span class="lineNoCov">          0 :         harray2[0] = &amp;gcd[1];</span>
<span class="lineNum">    8953 </span><span class="lineNoCov">          0 :         harray2[1] = 0;</span>
<span class="lineNum">    8954 </span>            : 
<span class="lineNum">    8955 </span><span class="lineNoCov">          0 :         int idx = 2;</span>
<span class="lineNum">    8956 </span><span class="lineNoCov">          0 :         gcd[idx].gd.pos.x = 20-3;</span>
<span class="lineNum">    8957 </span><span class="lineNoCov">          0 :         gcd[idx].gd.pos.y = 17+37;</span>
<span class="lineNum">    8958 </span><span class="lineNoCov">          0 :         gcd[idx].gd.pos.width = -1;</span>
<span class="lineNum">    8959 </span><span class="lineNoCov">          0 :         gcd[idx].gd.pos.height = 0;</span>
<span class="lineNum">    8960 </span><span class="lineNoCov">          0 :         gcd[idx].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">    8961 </span><span class="lineNoCov">          0 :         label[idx].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">    8962 </span><span class="lineNoCov">          0 :         label[idx].text_is_1byte = true;</span>
<span class="lineNum">    8963 </span><span class="lineNoCov">          0 :         label[idx].text_in_resource = true;</span>
<span class="lineNum">    8964 </span><span class="lineNoCov">          0 :         gcd[idx].gd.mnemonic = 'O';</span>
<span class="lineNum">    8965 </span><span class="lineNoCov">          0 :         gcd[idx].gd.label = &amp;label[idx];</span>
<span class="lineNum">    8966 </span><span class="lineNoCov">          0 :         gcd[idx].gd.handle_controlevent = getValueFromUser_OK;</span>
<span class="lineNum">    8967 </span><span class="lineNoCov">          0 :         gcd[idx].creator = GButtonCreate;</span>
<span class="lineNum">    8968 </span><span class="lineNoCov">          0 :         barray[0] = GCD_Glue;</span>
<span class="lineNum">    8969 </span><span class="lineNoCov">          0 :         barray[1] = &amp;gcd[idx];</span>
<span class="lineNum">    8970 </span><span class="lineNoCov">          0 :         barray[2] = GCD_Glue;</span>
<span class="lineNum">    8971 </span>            : 
<span class="lineNum">    8972 </span><span class="lineNoCov">          0 :         ++idx;</span>
<span class="lineNum">    8973 </span><span class="lineNoCov">          0 :         gcd[idx].gd.pos.x = -20;</span>
<span class="lineNum">    8974 </span><span class="lineNoCov">          0 :         gcd[idx].gd.pos.y = 17+37+3;</span>
<span class="lineNum">    8975 </span><span class="lineNoCov">          0 :         gcd[idx].gd.pos.width = -1;</span>
<span class="lineNum">    8976 </span><span class="lineNoCov">          0 :         gcd[idx].gd.pos.height = 0;</span>
<span class="lineNum">    8977 </span><span class="lineNoCov">          0 :         gcd[idx].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">    8978 </span><span class="lineNoCov">          0 :         label[idx].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    8979 </span><span class="lineNoCov">          0 :         label[idx].text_is_1byte = true;</span>
<span class="lineNum">    8980 </span><span class="lineNoCov">          0 :         label[idx].text_in_resource = true;</span>
<span class="lineNum">    8981 </span><span class="lineNoCov">          0 :         gcd[idx].gd.label = &amp;label[idx];</span>
<span class="lineNum">    8982 </span><span class="lineNoCov">          0 :         gcd[idx].gd.mnemonic = 'C';</span>
<span class="lineNum">    8983 </span><span class="lineNoCov">          0 :         gcd[idx].gd.handle_controlevent = getValueFromUser_Cancel;</span>
<span class="lineNum">    8984 </span><span class="lineNoCov">          0 :         gcd[idx].creator = GButtonCreate;</span>
<span class="lineNum">    8985 </span><span class="lineNoCov">          0 :         barray[3] = GCD_Glue;</span>
<span class="lineNum">    8986 </span><span class="lineNoCov">          0 :         barray[4] = &amp;gcd[idx];</span>
<span class="lineNum">    8987 </span><span class="lineNoCov">          0 :         barray[5] = GCD_Glue;</span>
<span class="lineNum">    8988 </span><span class="lineNoCov">          0 :         barray[6] = NULL;</span>
<span class="lineNum">    8989 </span>            : 
<span class="lineNum">    8990 </span><span class="lineNoCov">          0 :         gcd[7].gd.pos.x = 5;</span>
<span class="lineNum">    8991 </span><span class="lineNoCov">          0 :         gcd[7].gd.pos.y = 17+31;</span>
<span class="lineNum">    8992 </span><span class="lineNoCov">          0 :         gcd[7].gd.pos.width = 170-10;</span>
<span class="lineNum">    8993 </span><span class="lineNoCov">          0 :         gcd[7].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    8994 </span><span class="lineNoCov">          0 :         gcd[7].creator = GLineCreate;</span>
<span class="lineNum">    8995 </span>            : 
<span class="lineNum">    8996 </span><span class="lineNoCov">          0 :         boxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    8997 </span><span class="lineNoCov">          0 :         boxes[2].gd.u.boxelements = harray1;</span>
<span class="lineNum">    8998 </span><span class="lineNoCov">          0 :         boxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">    8999 </span>            : 
<span class="lineNum">    9000 </span><span class="lineNoCov">          0 :         boxes[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    9001 </span><span class="lineNoCov">          0 :         boxes[3].gd.u.boxelements = harray2;</span>
<span class="lineNum">    9002 </span><span class="lineNoCov">          0 :         boxes[3].creator = GHBoxCreate;</span>
<span class="lineNum">    9003 </span>            : 
<span class="lineNum">    9004 </span><span class="lineNoCov">          0 :         boxes[4].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    9005 </span><span class="lineNoCov">          0 :         boxes[4].gd.u.boxelements = barray;</span>
<span class="lineNum">    9006 </span><span class="lineNoCov">          0 :         boxes[4].creator = GHBoxCreate;</span>
<span class="lineNum">    9007 </span>            : 
<span class="lineNum">    9008 </span><span class="lineNoCov">          0 :         varray[0][0] = &amp;boxes[2]; varray[0][1] = NULL;</span>
<span class="lineNum">    9009 </span><span class="lineNoCov">          0 :         varray[1][0] = &amp;boxes[3]; varray[1][1] = NULL;</span>
<span class="lineNum">    9010 </span><span class="lineNoCov">          0 :         varray[2][0] = &amp;gcd[7];   varray[2][1] = NULL;</span>
<span class="lineNum">    9011 </span><span class="lineNoCov">          0 :         varray[3][0] = &amp;boxes[4]; varray[3][1] = NULL;</span>
<span class="lineNum">    9012 </span><span class="lineNoCov">          0 :         varray[4][0] = NULL;</span>
<span class="lineNum">    9013 </span>            : 
<span class="lineNum">    9014 </span><span class="lineNoCov">          0 :         boxes[0].gd.pos.x = boxes[0].gd.pos.y = 2;</span>
<span class="lineNum">    9015 </span><span class="lineNoCov">          0 :         boxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    9016 </span><span class="lineNoCov">          0 :         boxes[0].gd.u.boxelements = varray[0];</span>
<span class="lineNum">    9017 </span><span class="lineNoCov">          0 :         boxes[0].creator = GHVGroupCreate;</span>
<span class="lineNum">    9018 </span>            : 
<span class="lineNum">    9019 </span><span class="lineNoCov">          0 :         GGadgetsCreate(gw,boxes);</span>
<span class="lineNum">    9020 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(boxes[2].ret,gb_expandglue);</span>
<span class="lineNum">    9021 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(boxes[3].ret,gb_expandglue);</span>
<span class="lineNum">    9022 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(boxes[4].ret,gb_expandgluesame);</span>
<span class="lineNum">    9023 </span><span class="lineNoCov">          0 :         GHVBoxFitWindow(boxes[0].ret);</span>
<span class="lineNum">    9024 </span>            :     } else {
<span class="lineNum">    9025 </span><span class="lineNoCov">          0 :         gw = DATA.gw;</span>
<span class="lineNum">    9026 </span><span class="lineNoCov">          0 :         snprintf( ret, retsz, &quot;%s&quot;, defaultValue );</span>
<span class="lineNum">    9027 </span><span class="lineNoCov">          0 :         GGadgetSetTitle8(GWidgetGetControl(gw,CID_getValueFromUser),ret);</span>
<span class="lineNum">    9028 </span><span class="lineNoCov">          0 :         GDrawSetTransientFor(gw,(GWindow) -1);</span>
<span class="lineNum">    9029 </span>            :     }
<span class="lineNum">    9030 </span>            : 
<span class="lineNum">    9031 </span><span class="lineNoCov">          0 :     GWidgetIndicateFocusGadget(GWidgetGetControl(gw,CID_getValueFromUser));</span>
<span class="lineNum">    9032 </span><span class="lineNoCov">          0 :     GTextFieldSelect(GWidgetGetControl(gw,CID_getValueFromUser),0,-1);</span>
<span class="lineNum">    9033 </span>            : 
<span class="lineNum">    9034 </span><span class="lineNoCov">          0 :     GWidgetHidePalettes();</span>
<span class="lineNum">    9035 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<span class="lineNum">    9036 </span><span class="lineNoCov">          0 :     while ( !DATA.done )</span>
<span class="lineNum">    9037 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">    9038 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,false);</span>
<span class="lineNum">    9039 </span>            : 
<span class="lineNum">    9040 </span><span class="lineNoCov">          0 :     if( DATA.cancelled )</span>
<span class="lineNum">    9041 </span><span class="lineNoCov">          0 :         return 0;</span>
<span class="lineNum">    9042 </span><span class="lineNoCov">          0 :     return ret;</span>
<span class="lineNum">    9043 </span>            : }
<span class="lineNum">    9044 </span>            : 
<a name="9045"><span class="lineNum">    9045 </span>            : </a>
<span class="lineNum">    9046 </span>            : 
<span class="lineNum">    9047 </span><span class="lineNoCov">          0 : static void CVRemoveUndoes(GWindow gw,struct gmenuitem *mi,GEvent *e)</span>
<span class="lineNum">    9048 </span>            : {
<span class="lineNum">    9049 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9050 </span>            :     static int lastValue = 10;
<span class="lineNum">    9051 </span><span class="lineNoCov">          0 :     int v = toint(getValueFromUser( cv,</span>
<span class="lineNum">    9052 </span><span class="lineNoCov">          0 :                                     _(&quot;Trimming Undo Information&quot;),</span>
<span class="lineNum">    9053 </span><span class="lineNoCov">          0 :                                     _(&quot;How many most-recent Undos should be kept?&quot;),</span>
<span class="lineNum">    9054 </span><span class="lineNoCov">          0 :                                     tostr(lastValue)));</span>
<span class="lineNum">    9055 </span><span class="lineNoCov">          0 :     lastValue = v;</span>
<span class="lineNum">    9056 </span><span class="lineNoCov">          0 :     UndoesFreeButRetainFirstN(&amp;cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes,v);</span>
<span class="lineNum">    9057 </span><span class="lineNoCov">          0 :     UndoesFreeButRetainFirstN(&amp;cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;redoes,v);</span>
<span class="lineNum">    9058 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    9059 </span>            : 
<span class="lineNum">    9060 </span>            : 
<span class="lineNum">    9061 </span>            : /* We can only paste if there's something in the copy buffer */
<span class="lineNum">    9062 </span>            : /* we can only copy if there's something selected to copy */
<a name="9063"><span class="lineNum">    9063 </span>            : /* figure out what things are possible from the edit menu before the user */</a>
<span class="lineNum">    9064 </span>            : /*  pulls it down */
<span class="lineNum">    9065 </span><span class="lineNoCov">          0 : static void cv_edlistcheck(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">    9066 </span>            :     int anypoints, anyrefs, anyimages, anyanchor;
<span class="lineNum">    9067 </span>            : 
<span class="lineNum">    9068 </span><span class="lineNoCov">          0 :     CVAnySel(cv,&amp;anypoints,&amp;anyrefs,&amp;anyimages,&amp;anyanchor);</span>
<span class="lineNum">    9069 </span>            : 
<span class="lineNum">    9070 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">    9071 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">    9072 </span>            :           case MID_Join:
<span class="lineNum">    9073 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL;</span>
<span class="lineNum">    9074 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9075 </span>            :           case MID_Merge:
<span class="lineNum">    9076 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !anypoints;</span>
<span class="lineNum">    9077 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9078 </span>            :           case MID_MergeToLine:
<span class="lineNum">    9079 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !anypoints;</span>
<span class="lineNum">    9080 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9081 </span>            :           case MID_Clear: case MID_Cut: /*case MID_Copy:*/
<span class="lineNum">    9082 </span>            :             /* If nothing is selected, copy copies everything */
<span class="lineNum">    9083 </span>            :             /* In spiro mode copy will copy all contours with at least (spiro) one point selected */
<span class="lineNum">    9084 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !anypoints &amp;&amp; !anyrefs &amp;&amp; !anyimages &amp;&amp; !anyanchor;</span>
<span class="lineNum">    9085 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9086 </span>            :           case MID_CopyLBearing: case MID_CopyRBearing:
<span class="lineNum">    9087 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.drawmode!=dm_fore ||</span>
<span class="lineNum">    9088 </span><span class="lineNoCov">          0 :                     (cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL &amp;&amp; cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs==NULL);</span>
<span class="lineNum">    9089 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9090 </span>            :           case MID_CopyFgToBg:
<span class="lineNum">    9091 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.sc-&gt;layers[ly_fore].splines==NULL;</span>
<span class="lineNum">    9092 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9093 </span>            :           case MID_CopyGridFit:
<span class="lineNum">    9094 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.gridfit==NULL;</span>
<span class="lineNum">    9095 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9096 </span>            :           case MID_Paste:
<span class="lineNum">    9097 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !CopyContainsSomething() &amp;&amp;</span>
<span class="lineNum">    9098 </span>            : #ifndef _NO_LIBPNG
<span class="lineNum">    9099 </span><span class="lineNoCov">          0 :                     !GDrawSelectionHasType(cv-&gt;gw,sn_clipboard,&quot;image/png&quot;) &amp;&amp;</span>
<span class="lineNum">    9100 </span>            : #endif
<span class="lineNum">    9101 </span><span class="lineNoCov">          0 :                     !GDrawSelectionHasType(cv-&gt;gw,sn_clipboard,&quot;image/svg+xml&quot;) &amp;&amp;</span>
<span class="lineNum">    9102 </span><span class="lineNoCov">          0 :                     !GDrawSelectionHasType(cv-&gt;gw,sn_clipboard,&quot;image/svg-xml&quot;) &amp;&amp;</span>
<span class="lineNum">    9103 </span><span class="lineNoCov">          0 :                     !GDrawSelectionHasType(cv-&gt;gw,sn_clipboard,&quot;image/svg&quot;) &amp;&amp;</span>
<span class="lineNum">    9104 </span><span class="lineNoCov">          0 :                     !GDrawSelectionHasType(cv-&gt;gw,sn_clipboard,&quot;image/bmp&quot;) &amp;&amp;</span>
<span class="lineNum">    9105 </span><span class="lineNoCov">          0 :                     !GDrawSelectionHasType(cv-&gt;gw,sn_clipboard,&quot;image/eps&quot;) &amp;&amp;</span>
<span class="lineNum">    9106 </span><span class="lineNoCov">          0 :                     !GDrawSelectionHasType(cv-&gt;gw,sn_clipboard,&quot;image/ps&quot;);</span>
<span class="lineNum">    9107 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9108 </span>            :           case MID_Undo:
<span class="lineNum">    9109 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes==NULL;</span>
<span class="lineNum">    9110 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9111 </span>            :           case MID_Redo:
<span class="lineNum">    9112 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;redoes==NULL;</span>
<span class="lineNum">    9113 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9114 </span>            :           case MID_RemoveUndoes:
<span class="lineNum">    9115 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes==NULL &amp;&amp; cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;redoes==NULL;</span>
<span class="lineNum">    9116 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9117 </span>            :           case MID_CopyRef:
<span class="lineNum">    9118 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.drawmode!=dm_fore || cv-&gt;b.container!=NULL;</span>
<span class="lineNum">    9119 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9120 </span>            :           case MID_CopyLookupData:
<span class="lineNum">    9121 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = (cv-&gt;b.sc-&gt;possub==NULL &amp;&amp; cv-&gt;b.sc-&gt;kerns==NULL &amp;&amp; cv-&gt;b.sc-&gt;vkerns==NULL) ||</span>
<span class="lineNum">    9122 </span><span class="lineNoCov">          0 :                     cv-&gt;b.container!=NULL;</span>
<span class="lineNum">    9123 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9124 </span>            :           case MID_UnlinkRef:
<span class="lineNum">    9125 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs==NULL;</span>
<span class="lineNum">    9126 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9127 </span>            :         }
<span class="lineNum">    9128 </span>            :     }
<a name="9129"><span class="lineNum">    9129 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9130 </span>            : 
<span class="lineNum">    9131 </span><span class="lineNoCov">          0 : static void edlistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9132 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9133 </span><span class="lineNoCov">          0 :     cv_edlistcheck(cv, mi);</span>
<a name="9134"><span class="lineNum">    9134 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9135 </span>            : 
<span class="lineNum">    9136 </span><span class="lineNoCov">          0 : static void CVMenuAcceptableExtrema(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9137 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9138 </span>            :     SplineSet *ss;
<span class="lineNum">    9139 </span>            :     Spline *s, *first;
<span class="lineNum">    9140 </span>            : 
<span class="lineNum">    9141 </span><span class="lineNoCov">          0 :     for ( ss = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; ss!=NULL ; ss = ss-&gt;next ) {</span>
<span class="lineNum">    9142 </span><span class="lineNoCov">          0 :         first = NULL;</span>
<span class="lineNum">    9143 </span><span class="lineNoCov">          0 :         for ( s=ss-&gt;first-&gt;next; s!=NULL &amp;&amp; s!=first; s = s-&gt;to-&gt;next ) {</span>
<span class="lineNum">    9144 </span><span class="lineNoCov">          0 :             if ( first == NULL )</span>
<span class="lineNum">    9145 </span><span class="lineNoCov">          0 :                 first = s;</span>
<span class="lineNum">    9146 </span><span class="lineNoCov">          0 :             if ( s-&gt;from-&gt;selected &amp;&amp; s-&gt;to-&gt;selected )</span>
<span class="lineNum">    9147 </span><span class="lineNoCov">          0 :                 s-&gt;acceptableextrema = !s-&gt;acceptableextrema;</span>
<span class="lineNum">    9148 </span>            :         }
<span class="lineNum">    9149 </span>            :     }
<a name="9150"><span class="lineNum">    9150 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9151 </span>            : 
<span class="lineNum">    9152 </span><span class="lineNoCov">          0 : static void _CVMenuPointType(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">    9153 </span><span class="lineNoCov">          0 :     int pointtype = mi-&gt;mid==MID_Corner?pt_corner:mi-&gt;mid==MID_Tangent?pt_tangent:</span>
<span class="lineNum">    9154 </span><span class="lineNoCov">          0 :             mi-&gt;mid==MID_Curve?pt_curve:pt_hvcurve;</span>
<span class="lineNum">    9155 </span>            :     SplinePointList *spl;
<span class="lineNum">    9156 </span>            :     Spline *spline, *first;
<span class="lineNum">    9157 </span>            : 
<span class="lineNum">    9158 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);     /* We should only get here if there's a selection */</span>
<span class="lineNum">    9159 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL ; spl = spl-&gt;next ) {</span>
<span class="lineNum">    9160 </span><span class="lineNoCov">          0 :         first = NULL;</span>
<span class="lineNum">    9161 </span><span class="lineNoCov">          0 :         if ( spl-&gt;first-&gt;selected ) {</span>
<span class="lineNum">    9162 </span><span class="lineNoCov">          0 :             if ( spl-&gt;first-&gt;pointtype!=pointtype )</span>
<span class="lineNum">    9163 </span><span class="lineNoCov">          0 :                 SPChangePointType(spl-&gt;first,pointtype);</span>
<span class="lineNum">    9164 </span>            :         }
<span class="lineNum">    9165 </span><span class="lineNoCov">          0 :         for ( spline=spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first ; spline = spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    9166 </span><span class="lineNoCov">          0 :             if ( spline-&gt;to-&gt;selected ) {</span>
<span class="lineNum">    9167 </span><span class="lineNoCov">          0 :             if ( spline-&gt;to-&gt;pointtype!=pointtype )</span>
<span class="lineNum">    9168 </span><span class="lineNoCov">          0 :                 SPChangePointType(spline-&gt;to,pointtype);</span>
<span class="lineNum">    9169 </span>            :             }
<span class="lineNum">    9170 </span><span class="lineNoCov">          0 :             if ( first == NULL ) first = spline;</span>
<span class="lineNum">    9171 </span>            :         }
<span class="lineNum">    9172 </span>            :     }
<span class="lineNum">    9173 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="9174"><span class="lineNum">    9174 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9175 </span>            : 
<span class="lineNum">    9176 </span><span class="lineNoCov">          0 : static void _CVMenuSpiroPointType(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">    9177 </span><span class="lineNoCov">          0 :     int pointtype = mi-&gt;mid==MID_SpiroCorner?SPIRO_CORNER:</span>
<span class="lineNum">    9178 </span><span class="lineNoCov">          0 :                     mi-&gt;mid==MID_SpiroG4?SPIRO_G4:</span>
<span class="lineNum">    9179 </span><span class="lineNoCov">          0 :                     mi-&gt;mid==MID_SpiroG2?SPIRO_G2:</span>
<span class="lineNum">    9180 </span><span class="lineNoCov">          0 :                     mi-&gt;mid==MID_SpiroLeft?SPIRO_LEFT:SPIRO_RIGHT;</span>
<span class="lineNum">    9181 </span>            :     SplinePointList *spl;
<span class="lineNum">    9182 </span>            :     int i, changes;
<span class="lineNum">    9183 </span>            : 
<span class="lineNum">    9184 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);     /* We should only get here if there's a selection */</span>
<span class="lineNum">    9185 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL ; spl = spl-&gt;next ) {</span>
<span class="lineNum">    9186 </span><span class="lineNoCov">          0 :         changes = false;</span>
<span class="lineNum">    9187 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;spl-&gt;spiro_cnt-1; ++i ) {</span>
<span class="lineNum">    9188 </span><span class="lineNoCov">          0 :             if ( SPIRO_SELECTED(&amp;spl-&gt;spiros[i]) ) {</span>
<span class="lineNum">    9189 </span><span class="lineNoCov">          0 :                 if ( (spl-&gt;spiros[i].ty&amp;0x7f)!=SPIRO_OPEN_CONTOUR ) {</span>
<span class="lineNum">    9190 </span><span class="lineNoCov">          0 :                     spl-&gt;spiros[i].ty = pointtype|0x80;</span>
<span class="lineNum">    9191 </span><span class="lineNoCov">          0 :                     changes = true;</span>
<span class="lineNum">    9192 </span>            :                 }
<span class="lineNum">    9193 </span>            :             }
<span class="lineNum">    9194 </span>            :         }
<span class="lineNum">    9195 </span><span class="lineNoCov">          0 :         if ( changes )</span>
<span class="lineNum">    9196 </span><span class="lineNoCov">          0 :             SSRegenerateFromSpiros(spl);</span>
<span class="lineNum">    9197 </span>            :     }
<span class="lineNum">    9198 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<span class="lineNum">    9199 </span><span class="lineNoCov">          0 : }</span>
<a name="9200"><span class="lineNum">    9200 </span>            : </a>
<span class="lineNum">    9201 </span>            : 
<span class="lineNum">    9202 </span><span class="lineNoCov">          0 : void CVMenuPointType(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9203 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9204 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro())</span>
<span class="lineNum">    9205 </span><span class="lineNoCov">          0 :         _CVMenuSpiroPointType(cv, mi);</span>
<span class="lineNum">    9206 </span>            :     else
<span class="lineNum">    9207 </span><span class="lineNoCov">          0 :         _CVMenuPointType(cv, mi);</span>
<a name="9208"><span class="lineNum">    9208 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9209 </span>            : 
<span class="lineNum">    9210 </span><span class="lineNoCov">          0 : static void _CVMenuImplicit(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">    9211 </span>            :     SplinePointList *spl;
<span class="lineNum">    9212 </span>            :     Spline *spline, *first;
<span class="lineNum">    9213 </span><span class="lineNoCov">          0 :     int dontinterpolate = mi-&gt;mid==MID_NoImplicitPt;</span>
<span class="lineNum">    9214 </span>            : 
<span class="lineNum">    9215 </span><span class="lineNoCov">          0 :     if ( !cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2 )</span>
<span class="lineNum">    9216 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    9217 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);     /* We should only get here if there's a selection */</span>
<span class="lineNum">    9218 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL ; spl = spl-&gt;next ) {</span>
<span class="lineNum">    9219 </span><span class="lineNoCov">          0 :         first = NULL;</span>
<span class="lineNum">    9220 </span><span class="lineNoCov">          0 :         if ( spl-&gt;first-&gt;selected ) {</span>
<span class="lineNum">    9221 </span><span class="lineNoCov">          0 :             spl-&gt;first-&gt;dontinterpolate = dontinterpolate;</span>
<span class="lineNum">    9222 </span>            :         }
<span class="lineNum">    9223 </span><span class="lineNoCov">          0 :         for ( spline=spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first ; spline = spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    9224 </span><span class="lineNoCov">          0 :             if ( spline-&gt;to-&gt;selected ) {</span>
<span class="lineNum">    9225 </span><span class="lineNoCov">          0 :                 spline-&gt;to-&gt;dontinterpolate = dontinterpolate;</span>
<span class="lineNum">    9226 </span>            :             }
<span class="lineNum">    9227 </span><span class="lineNoCov">          0 :             if ( first == NULL ) first = spline;</span>
<span class="lineNum">    9228 </span>            :         }
<span class="lineNum">    9229 </span>            :     }
<span class="lineNum">    9230 </span><span class="lineNoCov">          0 :     SCNumberPoints(cv-&gt;b.sc,CVLayer((CharViewBase *) cv));</span>
<span class="lineNum">    9231 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="9232"><span class="lineNum">    9232 </span>            : }</a>
<span class="lineNum">    9233 </span>            : 
<span class="lineNum">    9234 </span><span class="lineNoCov">          0 : static void CVMenuImplicit(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9235 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9236 </span><span class="lineNoCov">          0 :     _CVMenuImplicit(cv, mi);</span>
<span class="lineNum">    9237 </span><span class="lineNoCov">          0 : }</span>
<a name="9238"><span class="lineNum">    9238 </span>            : </a>
<span class="lineNum">    9239 </span>            : static GMenuItem2 spiroptlist[], ptlist[];
<span class="lineNum">    9240 </span><span class="lineNoCov">          0 : static void cv_ptlistcheck(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">    9241 </span><span class="lineNoCov">          0 :     int type = -2, cnt=0, ccp_cnt=0, spline_selected=0;</span>
<span class="lineNum">    9242 </span><span class="lineNoCov">          0 :     int spirotype = -2, opencnt=0, spirocnt=0;</span>
<span class="lineNum">    9243 </span><span class="lineNoCov">          0 :     SplinePointList *spl, *sel=NULL, *onlysel=NULL;</span>
<span class="lineNum">    9244 </span>            :     Spline *spline, *first;
<span class="lineNum">    9245 </span><span class="lineNoCov">          0 :     SplinePoint *selpt=NULL;</span>
<span class="lineNum">    9246 </span><span class="lineNoCov">          0 :     int notimplicit = -1;</span>
<span class="lineNum">    9247 </span><span class="lineNoCov">          0 :     int acceptable = -1;</span>
<span class="lineNum">    9248 </span>            :     uint16 junk;
<span class="lineNum">    9249 </span>            :     int i;
<span class="lineNum">    9250 </span>            : 
<span class="lineNum">    9251 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showing_spiro_pt_menu != (cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro())) {</span>
<span class="lineNum">    9252 </span><span class="lineNoCov">          0 :         GMenuItemArrayFree(mi-&gt;sub);</span>
<span class="lineNum">    9253 </span><span class="lineNoCov">          0 :         mi-&gt;sub = GMenuItem2ArrayCopy(cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro()?spiroptlist:ptlist,&amp;junk);</span>
<span class="lineNum">    9254 </span><span class="lineNoCov">          0 :         cv-&gt;showing_spiro_pt_menu = cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro();</span>
<span class="lineNum">    9255 </span>            :     }
<span class="lineNum">    9256 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">    9257 </span><span class="lineNoCov">          0 :         first = NULL;</span>
<span class="lineNum">    9258 </span><span class="lineNoCov">          0 :         if ( spl-&gt;first-&gt;selected ) {</span>
<span class="lineNum">    9259 </span><span class="lineNoCov">          0 :             sel = spl;</span>
<span class="lineNum">    9260 </span><span class="lineNoCov">          0 :             if ( onlysel==NULL || onlysel==spl ) onlysel = spl; else onlysel = (SplineSet *) (-1);</span>
<span class="lineNum">    9261 </span><span class="lineNoCov">          0 :             selpt = spl-&gt;first; ++cnt;</span>
<span class="lineNum">    9262 </span><span class="lineNoCov">          0 :             if ( type==-2 ) type = spl-&gt;first-&gt;pointtype;</span>
<span class="lineNum">    9263 </span><span class="lineNoCov">          0 :             else if ( type!=spl-&gt;first-&gt;pointtype ) type = -1;</span>
<span class="lineNum">    9264 </span><span class="lineNoCov">          0 :             if ( !spl-&gt;first-&gt;nonextcp &amp;&amp; !spl-&gt;first-&gt;noprevcp &amp;&amp; spl-&gt;first-&gt;prev!=NULL )</span>
<span class="lineNum">    9265 </span><span class="lineNoCov">          0 :                 ++ccp_cnt;</span>
<span class="lineNum">    9266 </span><span class="lineNoCov">          0 :             if ( notimplicit==-1 ) notimplicit = spl-&gt;first-&gt;dontinterpolate;</span>
<span class="lineNum">    9267 </span><span class="lineNoCov">          0 :             else if ( notimplicit!=spl-&gt;first-&gt;dontinterpolate ) notimplicit = -2;</span>
<span class="lineNum">    9268 </span>            :         }
<span class="lineNum">    9269 </span><span class="lineNoCov">          0 :         for ( spline=spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first; spline = spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    9270 </span><span class="lineNoCov">          0 :             if ( spline-&gt;to-&gt;selected ) {</span>
<span class="lineNum">    9271 </span><span class="lineNoCov">          0 :                 if ( type==-2 ) type = spline-&gt;to-&gt;pointtype;</span>
<span class="lineNum">    9272 </span><span class="lineNoCov">          0 :                 else if ( type!=spline-&gt;to-&gt;pointtype ) type = -1;</span>
<span class="lineNum">    9273 </span><span class="lineNoCov">          0 :                 selpt = spline-&gt;to;</span>
<span class="lineNum">    9274 </span><span class="lineNoCov">          0 :                 if ( onlysel==NULL || onlysel==spl ) onlysel = spl; else onlysel = (SplineSet *) (-1);</span>
<span class="lineNum">    9275 </span><span class="lineNoCov">          0 :                 sel = spl; ++cnt;</span>
<span class="lineNum">    9276 </span><span class="lineNoCov">          0 :                 if ( !spline-&gt;to-&gt;nonextcp &amp;&amp; !spline-&gt;to-&gt;noprevcp &amp;&amp; spline-&gt;to-&gt;next!=NULL )</span>
<span class="lineNum">    9277 </span><span class="lineNoCov">          0 :                     ++ccp_cnt;</span>
<span class="lineNum">    9278 </span><span class="lineNoCov">          0 :                 if ( notimplicit==-1 ) notimplicit = spline-&gt;to-&gt;dontinterpolate;</span>
<span class="lineNum">    9279 </span><span class="lineNoCov">          0 :                 else if ( notimplicit!=spline-&gt;to-&gt;dontinterpolate ) notimplicit = -2;</span>
<span class="lineNum">    9280 </span><span class="lineNoCov">          0 :                 if ( spline-&gt;from-&gt;selected )</span>
<span class="lineNum">    9281 </span><span class="lineNoCov">          0 :                     ++spline_selected;</span>
<span class="lineNum">    9282 </span>            :             }
<span class="lineNum">    9283 </span><span class="lineNoCov">          0 :             if ( spline-&gt;to-&gt;selected &amp;&amp; spline-&gt;from-&gt;selected ) {</span>
<span class="lineNum">    9284 </span><span class="lineNoCov">          0 :                 if ( acceptable==-1 )</span>
<span class="lineNum">    9285 </span><span class="lineNoCov">          0 :                     acceptable = spline-&gt;acceptableextrema;</span>
<span class="lineNum">    9286 </span><span class="lineNoCov">          0 :                 else if ( acceptable!=spline-&gt;acceptableextrema )</span>
<span class="lineNum">    9287 </span><span class="lineNoCov">          0 :                     acceptable = -2;</span>
<span class="lineNum">    9288 </span>            :             }
<span class="lineNum">    9289 </span><span class="lineNoCov">          0 :             if ( first == NULL ) first = spline;</span>
<span class="lineNum">    9290 </span>            :         }
<span class="lineNum">    9291 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;spl-&gt;spiro_cnt-1; ++i ) {</span>
<span class="lineNum">    9292 </span><span class="lineNoCov">          0 :             if ( SPIRO_SELECTED(&amp;spl-&gt;spiros[i])) {</span>
<span class="lineNum">    9293 </span><span class="lineNoCov">          0 :                 int ty = spl-&gt;spiros[i].ty&amp;0x7f;</span>
<span class="lineNum">    9294 </span><span class="lineNoCov">          0 :                 ++spirocnt;</span>
<span class="lineNum">    9295 </span><span class="lineNoCov">          0 :                 if ( ty==SPIRO_OPEN_CONTOUR )</span>
<span class="lineNum">    9296 </span><span class="lineNoCov">          0 :                     ++opencnt;</span>
<span class="lineNum">    9297 </span><span class="lineNoCov">          0 :                 else if ( spirotype==-2 )</span>
<span class="lineNum">    9298 </span><span class="lineNoCov">          0 :                     spirotype = ty;</span>
<span class="lineNum">    9299 </span><span class="lineNoCov">          0 :                 else if ( spirotype!=ty )</span>
<span class="lineNum">    9300 </span><span class="lineNoCov">          0 :                     spirotype = -1;</span>
<span class="lineNum">    9301 </span><span class="lineNoCov">          0 :                 if ( onlysel==NULL || onlysel==spl ) onlysel = spl; else onlysel = (SplineSet *) (-1);</span>
<span class="lineNum">    9302 </span>            :             }
<span class="lineNum">    9303 </span>            :         }
<span class="lineNum">    9304 </span>            :     }
<span class="lineNum">    9305 </span>            : 
<span class="lineNum">    9306 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">    9307 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">    9308 </span>            :           case MID_Corner:
<span class="lineNum">    9309 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = type==-2;</span>
<span class="lineNum">    9310 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = type==pt_corner;</span>
<span class="lineNum">    9311 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9312 </span>            :           case MID_Tangent:
<span class="lineNum">    9313 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = type==-2;</span>
<span class="lineNum">    9314 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = type==pt_tangent;</span>
<span class="lineNum">    9315 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9316 </span>            :           case MID_Curve:
<span class="lineNum">    9317 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = type==-2;</span>
<span class="lineNum">    9318 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = type==pt_curve;</span>
<span class="lineNum">    9319 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9320 </span>            :           case MID_HVCurve:
<span class="lineNum">    9321 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = type==-2;</span>
<span class="lineNum">    9322 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = type==pt_hvcurve;</span>
<span class="lineNum">    9323 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9324 </span>            :           case MID_SpiroG4:
<span class="lineNum">    9325 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = spirotype==-2;</span>
<span class="lineNum">    9326 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = spirotype==SPIRO_G4;</span>
<span class="lineNum">    9327 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9328 </span>            :           case MID_SpiroG2:
<span class="lineNum">    9329 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = spirotype==-2;</span>
<span class="lineNum">    9330 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = spirotype==SPIRO_G2;</span>
<span class="lineNum">    9331 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9332 </span>            :           case MID_SpiroCorner:
<span class="lineNum">    9333 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = spirotype==-2;</span>
<span class="lineNum">    9334 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = spirotype==SPIRO_CORNER;</span>
<span class="lineNum">    9335 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9336 </span>            :           case MID_SpiroLeft:
<span class="lineNum">    9337 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = spirotype==-2;</span>
<span class="lineNum">    9338 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = spirotype==SPIRO_LEFT;</span>
<span class="lineNum">    9339 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9340 </span>            :           case MID_SpiroRight:
<span class="lineNum">    9341 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = spirotype==-2;</span>
<span class="lineNum">    9342 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = spirotype==SPIRO_RIGHT;</span>
<span class="lineNum">    9343 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9344 </span>            :           case MID_MakeFirst:
<span class="lineNum">    9345 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cnt!=1 || sel-&gt;first-&gt;prev==NULL || sel-&gt;first==selpt;</span>
<span class="lineNum">    9346 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9347 </span>            :           case MID_SpiroMakeFirst:
<span class="lineNum">    9348 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = opencnt!=0 || spirocnt!=1;</span>
<span class="lineNum">    9349 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9350 </span>            :           case MID_MakeLine: case MID_MakeArc:
<span class="lineNum">    9351 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cnt&lt;2;</span>
<span class="lineNum">    9352 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9353 </span>            :           case MID_AcceptableExtrema:
<span class="lineNum">    9354 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = acceptable&lt;0;</span>
<span class="lineNum">    9355 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = acceptable==1;</span>
<span class="lineNum">    9356 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9357 </span>            :           case MID_NamePoint:
<span class="lineNum">    9358 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = onlysel==NULL || onlysel == (SplineSet *) -1;</span>
<span class="lineNum">    9359 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9360 </span>            :           case MID_NameContour:
<span class="lineNum">    9361 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = onlysel==NULL || onlysel == (SplineSet *) -1;</span>
<span class="lineNum">    9362 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9363 </span>            :           case MID_ClipPath:
<span class="lineNum">    9364 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;b.sc-&gt;parent-&gt;multilayer;</span>
<span class="lineNum">    9365 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9366 </span>            :           case MID_InsertPtOnSplineAt:
<span class="lineNum">    9367 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = spline_selected!=1;</span>
<span class="lineNum">    9368 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9369 </span>            :           case MID_CenterCP:
<span class="lineNum">    9370 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = ccp_cnt==0;</span>
<span class="lineNum">    9371 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9372 </span>            :           case MID_ImplicitPt:
<span class="lineNum">    9373 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2;</span>
<span class="lineNum">    9374 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = notimplicit==0;</span>
<span class="lineNum">    9375 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9376 </span>            :           case MID_NoImplicitPt:
<span class="lineNum">    9377 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2;</span>
<span class="lineNum">    9378 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = notimplicit==1;</span>
<span class="lineNum">    9379 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9380 </span>            :           case MID_AddAnchor:
<span class="lineNum">    9381 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.container!=NULL;</span>
<span class="lineNum">    9382 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9383 </span>            :         }
<span class="lineNum">    9384 </span>            :     }
<a name="9385"><span class="lineNum">    9385 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9386 </span>            : 
<span class="lineNum">    9387 </span><span class="lineNoCov">          0 : static void ptlistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9388 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9389 </span><span class="lineNoCov">          0 :     cv_ptlistcheck(cv, mi);</span>
<a name="9390"><span class="lineNum">    9390 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9391 </span>            : 
<span class="lineNum">    9392 </span><span class="lineNoCov">          0 : static void _CVMenuDir(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">    9393 </span>            :     int splinepoints, dir;
<span class="lineNum">    9394 </span>            :     SplinePointList *spl;
<span class="lineNum">    9395 </span>            :     Spline *spline, *first;
<span class="lineNum">    9396 </span><span class="lineNoCov">          0 :     int needsrefresh = false;</span>
<span class="lineNum">    9397 </span>            : 
<span class="lineNum">    9398 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">    9399 </span><span class="lineNoCov">          0 :         first = NULL;</span>
<span class="lineNum">    9400 </span><span class="lineNoCov">          0 :         splinepoints = 0;</span>
<span class="lineNum">    9401 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.sc-&gt;inspiro  &amp;&amp; hasspiro()) {</span>
<span class="lineNum">    9402 </span>            :             int i;
<span class="lineNum">    9403 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;spl-&gt;spiro_cnt-1; ++i )</span>
<span class="lineNum">    9404 </span><span class="lineNoCov">          0 :                 if ( SPIRO_SELECTED(&amp;spl-&gt;spiros[i])) {</span>
<span class="lineNum">    9405 </span><span class="lineNoCov">          0 :                     splinepoints = true;</span>
<span class="lineNum">    9406 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    9407 </span>            :                 }
<span class="lineNum">    9408 </span>            :         } else {
<span class="lineNum">    9409 </span><span class="lineNoCov">          0 :             if ( spl-&gt;first-&gt;selected ) splinepoints = true;</span>
<span class="lineNum">    9410 </span><span class="lineNoCov">          0 :             for ( spline=spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first &amp;&amp; !splinepoints; spline = spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    9411 </span><span class="lineNoCov">          0 :                 if ( spline-&gt;to-&gt;selected ) splinepoints = true;</span>
<span class="lineNum">    9412 </span><span class="lineNoCov">          0 :                 if ( first == NULL ) first = spline;</span>
<span class="lineNum">    9413 </span>            :             }
<span class="lineNum">    9414 </span>            :         }
<span class="lineNum">    9415 </span><span class="lineNoCov">          0 :         if ( splinepoints &amp;&amp; spl-&gt;first-&gt;prev!=NULL ) {</span>
<span class="lineNum">    9416 </span><span class="lineNoCov">          0 :             dir = SplinePointListIsClockwise(spl);</span>
<span class="lineNum">    9417 </span><span class="lineNoCov">          0 :             if ( (mi-&gt;mid==MID_Clockwise &amp;&amp; dir==0) || (mi-&gt;mid==MID_Counter &amp;&amp; dir==1)) {</span>
<span class="lineNum">    9418 </span><span class="lineNoCov">          0 :                 if ( !needsrefresh )</span>
<span class="lineNum">    9419 </span><span class="lineNoCov">          0 :                     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    9420 </span><span class="lineNoCov">          0 :                 SplineSetReverse(spl);</span>
<span class="lineNum">    9421 </span><span class="lineNoCov">          0 :                 needsrefresh = true;</span>
<span class="lineNum">    9422 </span>            :             }
<span class="lineNum">    9423 </span>            :         }
<span class="lineNum">    9424 </span>            :     }
<span class="lineNum">    9425 </span><span class="lineNoCov">          0 :     if ( needsrefresh )</span>
<span class="lineNum">    9426 </span><span class="lineNoCov">          0 :         CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="9427"><span class="lineNum">    9427 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9428 </span>            : 
<span class="lineNum">    9429 </span><span class="lineNoCov">          0 : static void CVMenuDir(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9430 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9431 </span><span class="lineNoCov">          0 :     _CVMenuDir(cv, mi);</span>
<a name="9432"><span class="lineNum">    9432 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9433 </span>            : 
<span class="lineNum">    9434 </span><span class="lineNoCov">          0 : static void CVMenuCheckSelf(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9435 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9436 </span><span class="lineNoCov">          0 :     CVShows.checkselfintersects = cv-&gt;checkselfintersects = !cv-&gt;checkselfintersects;</span>
<a name="9437"><span class="lineNum">    9437 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9438 </span>            : 
<span class="lineNum">    9439 </span><span class="lineNoCov">          0 : static void CVMenuGlyphSelfIntersects(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9440 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9441 </span><span class="lineNoCov">          0 :     Spline *s=NULL, *s2=NULL;</span>
<span class="lineNum">    9442 </span>            :     SplineSet *ss;
<span class="lineNum">    9443 </span>            :     DBounds b;
<span class="lineNum">    9444 </span>            :     double off;
<span class="lineNum">    9445 </span>            : 
<span class="lineNum">    9446 </span><span class="lineNoCov">          0 :     ss = LayerAllSplines(cv-&gt;b.layerheads[cv-&gt;b.drawmode]);</span>
<span class="lineNum">    9447 </span><span class="lineNoCov">          0 :     SplineSetIntersect(ss,&amp;s,&amp;s2);</span>
<span class="lineNum">    9448 </span><span class="lineNoCov">          0 :     LayerUnAllSplines(cv-&gt;b.layerheads[cv-&gt;b.drawmode]);</span>
<span class="lineNum">    9449 </span>            : 
<span class="lineNum">    9450 </span><span class="lineNoCov">          0 :     if ( s!=NULL || s2!=NULL ) {</span>
<span class="lineNum">    9451 </span><span class="lineNoCov">          0 :         memset(&amp;b,0,sizeof(b));</span>
<span class="lineNum">    9452 </span><span class="lineNoCov">          0 :         CVClearSel(cv);</span>
<span class="lineNum">    9453 </span><span class="lineNoCov">          0 :         if ( s!=NULL ) {</span>
<span class="lineNum">    9454 </span><span class="lineNoCov">          0 :             b.minx = b.maxx = s-&gt;from-&gt;me.x;</span>
<span class="lineNum">    9455 </span><span class="lineNoCov">          0 :             b.miny = b.maxy = s-&gt;from-&gt;me.y;</span>
<span class="lineNum">    9456 </span><span class="lineNoCov">          0 :         } else if ( s2!=NULL ) {</span>
<span class="lineNum">    9457 </span><span class="lineNoCov">          0 :             b.minx = b.maxx = s2-&gt;from-&gt;me.x;</span>
<span class="lineNum">    9458 </span><span class="lineNoCov">          0 :             b.miny = b.maxy = s2-&gt;from-&gt;me.y;</span>
<span class="lineNum">    9459 </span>            :         }
<span class="lineNum">    9460 </span><span class="lineNoCov">          0 :         if ( s!=NULL ) {</span>
<span class="lineNum">    9461 </span><span class="lineNoCov">          0 :             s-&gt;from-&gt;selected = s-&gt;to-&gt;selected = true;</span>
<span class="lineNum">    9462 </span><span class="lineNoCov">          0 :             if ( s-&gt;to-&gt;me.x&gt;b.maxx ) b.maxx = s-&gt;to-&gt;me.x;</span>
<span class="lineNum">    9463 </span><span class="lineNoCov">          0 :             if ( s-&gt;to-&gt;me.x&lt;b.minx ) b.minx = s-&gt;to-&gt;me.x;</span>
<span class="lineNum">    9464 </span><span class="lineNoCov">          0 :             if ( s-&gt;to-&gt;me.y&gt;b.maxy ) b.maxy = s-&gt;to-&gt;me.y;</span>
<span class="lineNum">    9465 </span><span class="lineNoCov">          0 :             if ( s-&gt;to-&gt;me.y&lt;b.miny ) b.miny = s-&gt;to-&gt;me.y;</span>
<span class="lineNum">    9466 </span>            :         }
<span class="lineNum">    9467 </span><span class="lineNoCov">          0 :         if ( s2!=NULL ) {</span>
<span class="lineNum">    9468 </span><span class="lineNoCov">          0 :             s2-&gt;from-&gt;selected = s2-&gt;to-&gt;selected = true;</span>
<span class="lineNum">    9469 </span><span class="lineNoCov">          0 :             if ( s2-&gt;from-&gt;me.x&gt;b.maxx ) b.maxx = s2-&gt;from-&gt;me.x;</span>
<span class="lineNum">    9470 </span><span class="lineNoCov">          0 :             if ( s2-&gt;from-&gt;me.x&lt;b.minx ) b.minx = s2-&gt;from-&gt;me.x;</span>
<span class="lineNum">    9471 </span><span class="lineNoCov">          0 :             if ( s2-&gt;from-&gt;me.y&gt;b.maxy ) b.maxy = s2-&gt;from-&gt;me.y;</span>
<span class="lineNum">    9472 </span><span class="lineNoCov">          0 :             if ( s2-&gt;from-&gt;me.y&lt;b.miny ) b.miny = s2-&gt;from-&gt;me.y;</span>
<span class="lineNum">    9473 </span><span class="lineNoCov">          0 :             if ( s2-&gt;to-&gt;me.x&gt;b.maxx ) b.maxx = s2-&gt;to-&gt;me.x;</span>
<span class="lineNum">    9474 </span><span class="lineNoCov">          0 :             if ( s2-&gt;to-&gt;me.x&lt;b.minx ) b.minx = s2-&gt;to-&gt;me.x;</span>
<span class="lineNum">    9475 </span><span class="lineNoCov">          0 :             if ( s2-&gt;to-&gt;me.y&gt;b.maxy ) b.maxy = s2-&gt;to-&gt;me.y;</span>
<span class="lineNum">    9476 </span><span class="lineNoCov">          0 :             if ( s2-&gt;to-&gt;me.y&lt;b.miny ) b.miny = s2-&gt;to-&gt;me.y;</span>
<span class="lineNum">    9477 </span>            :         }
<span class="lineNum">    9478 </span><span class="lineNoCov">          0 :         off = (b.maxx-b.minx)/10;</span>
<span class="lineNum">    9479 </span><span class="lineNoCov">          0 :         if ( off==0 ) off = 1;</span>
<span class="lineNum">    9480 </span><span class="lineNoCov">          0 :         b.minx -= off; b.maxx += off;</span>
<span class="lineNum">    9481 </span><span class="lineNoCov">          0 :         off = (b.maxy-b.miny)/10;</span>
<span class="lineNum">    9482 </span><span class="lineNoCov">          0 :         if ( off==0 ) off = 1;</span>
<span class="lineNum">    9483 </span><span class="lineNoCov">          0 :         b.miny -= off; b.maxy += off;</span>
<span class="lineNum">    9484 </span><span class="lineNoCov">          0 :         _CVFit(cv,&amp;b,false);</span>
<span class="lineNum">    9485 </span>            :     } else
<span class="lineNum">    9486 </span><span class="lineNoCov">          0 :         ff_post_notice(_(&quot;No Intersections&quot;),_(&quot;No Intersections&quot;));</span>
<a name="9487"><span class="lineNum">    9487 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9488 </span>            : 
<span class="lineNum">    9489 </span><span class="lineNoCov">          0 : static int getorigin(void *d,BasePoint *base,int index) {</span>
<span class="lineNum">    9490 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) d;</span>
<span class="lineNum">    9491 </span>            : 
<span class="lineNum">    9492 </span><span class="lineNoCov">          0 :     base-&gt;x = base-&gt;y = 0;</span>
<span class="lineNum">    9493 </span><span class="lineNoCov">          0 :     switch ( index ) {</span>
<span class="lineNum">    9494 </span>            :       case 0:           /* Character origin */
<span class="lineNum">    9495 </span>            :         /* all done */
<span class="lineNum">    9496 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    9497 </span>            :       case 1:           /* Center of selection */
<span class="lineNum">    9498 </span><span class="lineNoCov">          0 :         CVFindCenter(cv,base,!CVAnySel(cv,NULL,NULL,NULL,NULL));</span>
<span class="lineNum">    9499 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    9500 </span>            :       case 2:           /* last press */
<span class="lineNum">    9501 </span><span class="lineNoCov">          0 :         base-&gt;x = cv-&gt;p.cx;</span>
<span class="lineNum">    9502 </span><span class="lineNoCov">          0 :         base-&gt;y = cv-&gt;p.cy;</span>
<span class="lineNum">    9503 </span>            :         /* I don't have any way of telling if a press has happened. if one */
<span class="lineNum">    9504 </span>            :         /*  hasn't they'll just get a 0,0 origin. oh well */
<span class="lineNum">    9505 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    9506 </span>            :       default:
<span class="lineNum">    9507 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    9508 </span>            :     }
<span class="lineNum">    9509 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="9510"><span class="lineNum">    9510 </span>            : }</a>
<span class="lineNum">    9511 </span>            : 
<span class="lineNum">    9512 </span><span class="lineNoCov">          0 : static void TransRef(RefChar *ref,real transform[6], enum fvtrans_flags flags) {</span>
<span class="lineNum">    9513 </span>            :     int j;
<span class="lineNum">    9514 </span>            :     real t[6];
<span class="lineNum">    9515 </span>            : 
<span class="lineNum">    9516 </span><span class="lineNoCov">          0 :     for ( j=0; j&lt;ref-&gt;layer_cnt; ++j )</span>
<span class="lineNum">    9517 </span><span class="lineNoCov">          0 :         SplinePointListTransform(ref-&gt;layers[j].splines,transform,tpt_AllPoints);</span>
<span class="lineNum">    9518 </span><span class="lineNoCov">          0 :     t[0] = ref-&gt;transform[0]*transform[0] +</span>
<span class="lineNum">    9519 </span><span class="lineNoCov">          0 :                 ref-&gt;transform[1]*transform[2];</span>
<span class="lineNum">    9520 </span><span class="lineNoCov">          0 :     t[1] = ref-&gt;transform[0]*transform[1] +</span>
<span class="lineNum">    9521 </span><span class="lineNoCov">          0 :                 ref-&gt;transform[1]*transform[3];</span>
<span class="lineNum">    9522 </span><span class="lineNoCov">          0 :     t[2] = ref-&gt;transform[2]*transform[0] +</span>
<span class="lineNum">    9523 </span><span class="lineNoCov">          0 :                 ref-&gt;transform[3]*transform[2];</span>
<span class="lineNum">    9524 </span><span class="lineNoCov">          0 :     t[3] = ref-&gt;transform[2]*transform[1] +</span>
<span class="lineNum">    9525 </span><span class="lineNoCov">          0 :                 ref-&gt;transform[3]*transform[3];</span>
<span class="lineNum">    9526 </span><span class="lineNoCov">          0 :     t[4] = ref-&gt;transform[4]*transform[0] +</span>
<span class="lineNum">    9527 </span><span class="lineNoCov">          0 :                 ref-&gt;transform[5]*transform[2] +</span>
<span class="lineNum">    9528 </span><span class="lineNoCov">          0 :                 transform[4];</span>
<span class="lineNum">    9529 </span><span class="lineNoCov">          0 :     t[5] = ref-&gt;transform[4]*transform[1] +</span>
<span class="lineNum">    9530 </span><span class="lineNoCov">          0 :                 ref-&gt;transform[5]*transform[3] +</span>
<span class="lineNum">    9531 </span><span class="lineNoCov">          0 :                 transform[5];</span>
<span class="lineNum">    9532 </span><span class="lineNoCov">          0 :     if ( flags&amp;fvt_round_to_int ) {</span>
<span class="lineNum">    9533 </span><span class="lineNoCov">          0 :         t[4] = rint( t[4] );</span>
<span class="lineNum">    9534 </span><span class="lineNoCov">          0 :         t[5] = rint( t[5] );</span>
<span class="lineNum">    9535 </span>            :     }
<span class="lineNum">    9536 </span><span class="lineNoCov">          0 :     memcpy(ref-&gt;transform,t,sizeof(t));</span>
<span class="lineNum">    9537 </span><span class="lineNoCov">          0 :     RefCharFindBounds(ref);</span>
<a name="9538"><span class="lineNum">    9538 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9539 </span>            : 
<span class="lineNum">    9540 </span><span class="lineNoCov">          0 : void CVTransFuncLayer(CharView *cv,Layer *ly,real transform[6], enum fvtrans_flags flags)</span>
<span class="lineNum">    9541 </span>            : {
<span class="lineNum">    9542 </span><span class="lineNoCov">          0 :     int anysel = cv-&gt;p.transany;</span>
<span class="lineNum">    9543 </span>            :     RefChar *refs;
<span class="lineNum">    9544 </span>            :     ImageList *img;
<span class="lineNum">    9545 </span>            :     AnchorPoint *ap;
<span class="lineNum">    9546 </span>            :     KernPair *kp;
<span class="lineNum">    9547 </span>            :     PST *pst;
<span class="lineNum">    9548 </span>            :     int l, cvlayer;
<span class="lineNum">    9549 </span><span class="lineNoCov">          0 :     enum transformPointMask tpmask = 0;</span>
<span class="lineNum">    9550 </span>            : 
<span class="lineNum">    9551 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro() )</span>
<span class="lineNum">    9552 </span><span class="lineNoCov">          0 :         SplinePointListSpiroTransform(ly-&gt;splines,transform,!anysel);</span>
<span class="lineNum">    9553 </span>            :     else
<span class="lineNum">    9554 </span>            :     {
<span class="lineNum">    9555 </span><span class="lineNoCov">          0 :         if( cv-&gt;active_tool==cvt_scale )</span>
<span class="lineNum">    9556 </span><span class="lineNoCov">          0 :             tpmask |= tpmask_operateOnSelectedBCP;</span>
<span class="lineNum">    9557 </span>            : 
<span class="lineNum">    9558 </span><span class="lineNoCov">          0 :         SplinePointListTransformExtended(</span>
<span class="lineNum">    9559 </span>            :             ly-&gt;splines, transform,
<span class="lineNum">    9560 </span><span class="lineNoCov">          0 :             !anysel?tpt_AllPoints: interpCPsOnMotion?tpt_OnlySelectedInterpCPs:tpt_OnlySelected,</span>
<span class="lineNum">    9561 </span>            :             tpmask );
<span class="lineNum">    9562 </span>            :     }
<span class="lineNum">    9563 </span>            : 
<span class="lineNum">    9564 </span><span class="lineNoCov">          0 :     if ( flags&amp;fvt_round_to_int )</span>
<span class="lineNum">    9565 </span><span class="lineNoCov">          0 :         SplineSetsRound2Int(ly-&gt;splines,1.0,cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro(),!anysel);</span>
<span class="lineNum">    9566 </span><span class="lineNoCov">          0 :     if ( ly-&gt;images!=NULL ) {</span>
<span class="lineNum">    9567 </span><span class="lineNoCov">          0 :         ImageListTransform(ly-&gt;images,transform,!anysel);</span>
<span class="lineNum">    9568 </span><span class="lineNoCov">          0 :         SCOutOfDateBackground(cv-&gt;b.sc);</span>
<span class="lineNum">    9569 </span>            :     }
<span class="lineNum">    9570 </span><span class="lineNoCov">          0 :     for ( refs = ly-&gt;refs; refs!=NULL; refs=refs-&gt;next )</span>
<span class="lineNum">    9571 </span><span class="lineNoCov">          0 :         if ( refs-&gt;selected || !anysel )</span>
<span class="lineNum">    9572 </span><span class="lineNoCov">          0 :             TransRef(refs,transform,flags);</span>
<span class="lineNum">    9573 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showanchor ) {</span>
<span class="lineNum">    9574 </span><span class="lineNoCov">          0 :         for ( ap=cv-&gt;b.sc-&gt;anchor; ap!=NULL; ap=ap-&gt;next ) if ( ap-&gt;selected || !anysel )</span>
<span class="lineNum">    9575 </span><span class="lineNoCov">          0 :             ApTransform(ap,transform);</span>
<span class="lineNum">    9576 </span>            :     }
<span class="lineNum">    9577 </span><span class="lineNoCov">          0 :     if ( !anysel ) {</span>
<span class="lineNum">    9578 </span><span class="lineNoCov">          0 :         if ( flags &amp; fvt_scalepstpos ) {</span>
<span class="lineNum">    9579 </span><span class="lineNoCov">          0 :             for ( kp=cv-&gt;b.sc-&gt;kerns; kp!=NULL; kp=kp-&gt;next )</span>
<span class="lineNum">    9580 </span><span class="lineNoCov">          0 :                 kp-&gt;off = rint(kp-&gt;off*transform[0]);</span>
<span class="lineNum">    9581 </span><span class="lineNoCov">          0 :             for ( kp=cv-&gt;b.sc-&gt;vkerns; kp!=NULL; kp=kp-&gt;next )</span>
<span class="lineNum">    9582 </span><span class="lineNoCov">          0 :                 kp-&gt;off = rint(kp-&gt;off*transform[3]);</span>
<span class="lineNum">    9583 </span><span class="lineNoCov">          0 :             for ( pst = cv-&gt;b.sc-&gt;possub; pst!=NULL; pst=pst-&gt;next ) {</span>
<span class="lineNum">    9584 </span><span class="lineNoCov">          0 :                 if ( pst-&gt;type == pst_position )</span>
<span class="lineNum">    9585 </span><span class="lineNoCov">          0 :                     VrTrans(&amp;pst-&gt;u.pos,transform);</span>
<span class="lineNum">    9586 </span><span class="lineNoCov">          0 :                 else if ( pst-&gt;type==pst_pair ) {</span>
<span class="lineNum">    9587 </span><span class="lineNoCov">          0 :                     VrTrans(&amp;pst-&gt;u.pair.vr[0],transform);</span>
<span class="lineNum">    9588 </span><span class="lineNoCov">          0 :                     VrTrans(&amp;pst-&gt;u.pair.vr[1],transform);</span>
<span class="lineNum">    9589 </span>            :                 }
<span class="lineNum">    9590 </span>            :             }
<span class="lineNum">    9591 </span>            :         }
<span class="lineNum">    9592 </span><span class="lineNoCov">          0 :         if ( transform[1]==0 &amp;&amp; transform[2]==0 ) {</span>
<span class="lineNum">    9593 </span><span class="lineNoCov">          0 :             TransHints(cv-&gt;b.sc-&gt;hstem,transform[3],transform[5],transform[0],transform[4],flags&amp;fvt_round_to_int);</span>
<span class="lineNum">    9594 </span><span class="lineNoCov">          0 :             TransHints(cv-&gt;b.sc-&gt;vstem,transform[0],transform[4],transform[3],transform[5],flags&amp;fvt_round_to_int);</span>
<span class="lineNum">    9595 </span><span class="lineNoCov">          0 :             TransDStemHints(cv-&gt;b.sc-&gt;dstem,transform[0],transform[4],transform[3],transform[5],flags&amp;fvt_round_to_int);</span>
<span class="lineNum">    9596 </span>            :         }
<span class="lineNum">    9597 </span><span class="lineNoCov">          0 :         if ( transform[0]==1 &amp;&amp; transform[3]==1 &amp;&amp; transform[1]==0 &amp;&amp;</span>
<span class="lineNum">    9598 </span><span class="lineNoCov">          0 :                 transform[2]==0 &amp;&amp; transform[5]==0 &amp;&amp;</span>
<span class="lineNum">    9599 </span><span class="lineNoCov">          0 :                 transform[4]!=0 &amp;&amp; CVAllSelected(cv) &amp;&amp;</span>
<span class="lineNum">    9600 </span><span class="lineNoCov">          0 :                 cv-&gt;b.sc-&gt;unicodeenc!=-1 &amp;&amp; isalpha(cv-&gt;b.sc-&gt;unicodeenc)) {</span>
<span class="lineNum">    9601 </span><span class="lineNoCov">          0 :             SCUndoSetLBearingChange(cv-&gt;b.sc,(int) rint(transform[4]));</span>
<span class="lineNum">    9602 </span><span class="lineNoCov">          0 :             SCSynchronizeLBearing(cv-&gt;b.sc,transform[4],CVLayer((CharViewBase *) cv));</span>
<span class="lineNum">    9603 </span>            :         }
<span class="lineNum">    9604 </span>            :     }
<span class="lineNum">    9605 </span><span class="lineNoCov">          0 :     if ( !(flags&amp;fvt_dontmovewidth) &amp;&amp; (cv-&gt;widthsel || !anysel))</span>
<span class="lineNum">    9606 </span><span class="lineNoCov">          0 :         if ( transform[0]&gt;0 &amp;&amp; transform[3]&gt;0 &amp;&amp; transform[1]==0 &amp;&amp;</span>
<span class="lineNum">    9607 </span><span class="lineNoCov">          0 :                 transform[2]==0 &amp;&amp; transform[4]!=0 )</span>
<span class="lineNum">    9608 </span><span class="lineNoCov">          0 :             SCSynchronizeWidth(cv-&gt;b.sc,cv-&gt;b.sc-&gt;width*transform[0]+transform[4],cv-&gt;b.sc-&gt;width,NULL);</span>
<span class="lineNum">    9609 </span><span class="lineNoCov">          0 :     if ( !(flags&amp;fvt_dontmovewidth) &amp;&amp; (cv-&gt;vwidthsel || !anysel))</span>
<span class="lineNum">    9610 </span><span class="lineNoCov">          0 :         if ( transform[0]==1 &amp;&amp; transform[3]==1 &amp;&amp; transform[1]==0 &amp;&amp;</span>
<span class="lineNum">    9611 </span><span class="lineNoCov">          0 :                 transform[2]==0 &amp;&amp; transform[5]!=0 )</span>
<span class="lineNum">    9612 </span><span class="lineNoCov">          0 :             cv-&gt;b.sc-&gt;vwidth+=transform[5];</span>
<span class="lineNum">    9613 </span><span class="lineNoCov">          0 :     if ( (flags&amp;fvt_alllayers) &amp;&amp; !anysel ) {</span>
<span class="lineNum">    9614 </span>            :         /* SCPreserveBackground(cv-&gt;b.sc); */ /* done by caller */
<span class="lineNum">    9615 </span><span class="lineNoCov">          0 :         cvlayer = CVLayer( (CharViewBase *) cv );</span>
<span class="lineNum">    9616 </span><span class="lineNoCov">          0 :         for ( l=0; l&lt;cv-&gt;b.sc-&gt;layer_cnt; ++l ) if ( l!=cvlayer ) {</span>
<span class="lineNum">    9617 </span><span class="lineNoCov">          0 :             for ( img = cv-&gt;b.sc-&gt;layers[l].images; img!=NULL; img=img-&gt;next )</span>
<span class="lineNum">    9618 </span><span class="lineNoCov">          0 :                 BackgroundImageTransform(cv-&gt;b.sc, img, transform);</span>
<span class="lineNum">    9619 </span><span class="lineNoCov">          0 :             SplinePointListTransform(cv-&gt;b.sc-&gt;layers[l].splines,</span>
<span class="lineNum">    9620 </span>            :                     transform,tpt_AllPoints);
<span class="lineNum">    9621 </span><span class="lineNoCov">          0 :             for ( refs=cv-&gt;b.sc-&gt;layers[l].refs; refs!=NULL; refs=refs-&gt;next )</span>
<span class="lineNum">    9622 </span><span class="lineNoCov">          0 :                 TransRef(refs,transform,flags);</span>
<span class="lineNum">    9623 </span>            :         }
<span class="lineNum">    9624 </span>            :     }
<a name="9625"><span class="lineNum">    9625 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9626 </span>            : 
<span class="lineNum">    9627 </span><span class="lineNoCov">          0 : void CVTransFunc(CharView *cv,real transform[6], enum fvtrans_flags flags)</span>
<span class="lineNum">    9628 </span>            : {
<span class="lineNum">    9629 </span><span class="lineNoCov">          0 :     Layer *ly = cv-&gt;b.layerheads[cv-&gt;b.drawmode];</span>
<span class="lineNum">    9630 </span><span class="lineNoCov">          0 :     CVTransFuncLayer( cv, ly, transform, flags );</span>
<a name="9631"><span class="lineNum">    9631 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9632 </span>            : 
<span class="lineNum">    9633 </span><span class="lineNoCov">          0 : void CVTransFuncAllLayers(CharView *cv,real transform[6], enum fvtrans_flags flags)</span>
<span class="lineNum">    9634 </span>            : {
<span class="lineNum">    9635 </span>            :     int idx;
<span class="lineNum">    9636 </span><span class="lineNoCov">          0 :     for( idx = 0; idx &lt; cv-&gt;b.sc-&gt;layer_cnt; ++idx )</span>
<span class="lineNum">    9637 </span>            :     {
<span class="lineNum">    9638 </span><span class="lineNoCov">          0 :         Layer *ly = &amp;cv-&gt;b.sc-&gt;layers[ idx ];</span>
<span class="lineNum">    9639 </span><span class="lineNoCov">          0 :         CVTransFuncLayer( cv, ly, transform, flags );</span>
<span class="lineNum">    9640 </span>            :     }
<a name="9641"><span class="lineNum">    9641 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9642 </span>            : 
<span class="lineNum">    9643 </span><span class="lineNoCov">          0 : static void transfunc(void *d,real transform[6],int otype,BVTFunc *bvts,</span>
<span class="lineNum">    9644 </span>            :         enum fvtrans_flags flags) {
<span class="lineNum">    9645 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) d;</span>
<span class="lineNum">    9646 </span><span class="lineNoCov">          0 :     int anya, l, cvlayer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    9647 </span>            : 
<span class="lineNum">    9648 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes!=NULL &amp;&amp;</span>
<span class="lineNum">    9649 </span><span class="lineNoCov">          0 :             cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;undoes-&gt;undotype==ut_tstate )</span>
<span class="lineNum">    9650 </span>            :     {
<span class="lineNum">    9651 </span><span class="lineNoCov">          0 :         CVDoUndo(&amp;cv-&gt;b);</span>
<span class="lineNum">    9652 </span>            :     }
<span class="lineNum">    9653 </span>            : 
<span class="lineNum">    9654 </span><span class="lineNoCov">          0 :     if ( flags&amp;fvt_revert )</span>
<span class="lineNum">    9655 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    9656 </span>            : 
<span class="lineNum">    9657 </span><span class="lineNoCov">          0 :     cv-&gt;p.transany = CVAnySel(cv,NULL,NULL,NULL,&amp;anya);</span>
<span class="lineNum">    9658 </span><span class="lineNoCov">          0 :     if ( flags&amp;fvt_justapply )</span>
<span class="lineNum">    9659 </span><span class="lineNoCov">          0 :         CVPreserveTState(cv);</span>
<span class="lineNum">    9660 </span>            :     else {
<span class="lineNum">    9661 </span><span class="lineNoCov">          0 :         CVPreserveStateHints(&amp;cv-&gt;b);</span>
<span class="lineNum">    9662 </span><span class="lineNoCov">          0 :         if ( flags&amp;fvt_alllayers )</span>
<span class="lineNum">    9663 </span><span class="lineNoCov">          0 :             for ( l=0; l&lt;cv-&gt;b.sc-&gt;layer_cnt; ++l ) if ( l!=cvlayer )</span>
<span class="lineNum">    9664 </span><span class="lineNoCov">          0 :                 SCPreserveLayer(cv-&gt;b.sc,l,false);</span>
<span class="lineNum">    9665 </span>            :     }
<span class="lineNum">    9666 </span>            : 
<span class="lineNum">    9667 </span><span class="lineNoCov">          0 :     CVPreserveMaybeState( cv, flags&amp;fvt_justapply );</span>
<span class="lineNum">    9668 </span><span class="lineNoCov">          0 :     CVTransFunc(cv,transform,flags);</span>
<span class="lineNum">    9669 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<span class="lineNum">    9670 </span><span class="lineNoCov">          0 :     collabclient_sendRedo( &amp;cv-&gt;b );</span>
<a name="9671"><span class="lineNum">    9671 </span>            : }</a>
<span class="lineNum">    9672 </span>            : 
<span class="lineNum">    9673 </span><span class="lineNoCov">          0 : void CVDoTransform(CharView *cv, enum cvtools cvt ) {</span>
<span class="lineNum">    9674 </span><span class="lineNoCov">          0 :     int anysel = CVAnySel(cv,NULL,NULL,NULL,NULL);</span>
<span class="lineNum">    9675 </span><span class="lineNoCov">          0 :     TransformDlgCreate(cv,transfunc,getorigin,!anysel?(tdf_enableback|tdf_addapply):tdf_addapply,</span>
<span class="lineNum">    9676 </span>            :             cvt);
<a name="9677"><span class="lineNum">    9677 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9678 </span>            : 
<span class="lineNum">    9679 </span><span class="lineNoCov">          0 : static void CVMenuTransform(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9680 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9681 </span><span class="lineNoCov">          0 :     CVDoTransform(cv,cvt_none);</span>
<a name="9682"><span class="lineNum">    9682 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9683 </span>            : 
<span class="lineNum">    9684 </span><span class="lineNoCov">          0 : static void CVMenuPOV(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9685 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9686 </span>            :     struct pov_data pov_data;
<span class="lineNum">    9687 </span><span class="lineNoCov">          0 :     if ( PointOfViewDlg(&amp;pov_data,cv-&gt;b.sc-&gt;parent,true)==-1 )</span>
<span class="lineNum">    9688 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    9689 </span><span class="lineNoCov">          0 :     CVPointOfView(cv,&amp;pov_data);</span>
<a name="9690"><span class="lineNum">    9690 </span>            : }</a>
<span class="lineNum">    9691 </span>            : 
<span class="lineNum">    9692 </span><span class="lineNoCov">          0 : static void CVMenuNLTransform(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9693 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9694 </span><span class="lineNoCov">          0 :     cv-&gt;lastselpt = NULL; cv-&gt;lastselcp = NULL;</span>
<span class="lineNum">    9695 </span><span class="lineNoCov">          0 :     NonLinearDlg(NULL,cv);</span>
<a name="9696"><span class="lineNum">    9696 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9697 </span>            : 
<span class="lineNum">    9698 </span><span class="lineNoCov">          0 : void CVMenuConstrain(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9699 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9700 </span><span class="lineNoCov">          0 :     CVConstrainSelection( cv,</span>
<span class="lineNum">    9701 </span><span class="lineNoCov">          0 :                           mi-&gt;mid==MID_Average  ? constrainSelection_AveragePoints :</span>
<span class="lineNum">    9702 </span><span class="lineNoCov">          0 :                           mi-&gt;mid==MID_SpacePts ? constrainSelection_SpacePoints   :</span>
<span class="lineNum">    9703 </span>            :                           constrainSelection_SpaceSelectedRegions );
<a name="9704"><span class="lineNum">    9704 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9705 </span>            : 
<span class="lineNum">    9706 </span><span class="lineNoCov">          0 : static void CVMenuMakeParallel(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9707 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9708 </span><span class="lineNoCov">          0 :     CVMakeParallel(cv);</span>
<a name="9709"><span class="lineNum">    9709 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9710 </span>            : 
<span class="lineNum">    9711 </span><span class="lineNoCov">          0 : static void _CVMenuRound2Int(CharView *cv, double factor) {</span>
<span class="lineNum">    9712 </span><span class="lineNoCov">          0 :     int anysel = CVAnySel(cv,NULL,NULL,NULL,NULL);</span>
<span class="lineNum">    9713 </span>            :     RefChar *r;
<span class="lineNum">    9714 </span>            :     AnchorPoint *ap;
<span class="lineNum">    9715 </span>            : 
<span class="lineNum">    9716 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    9717 </span><span class="lineNoCov">          0 :     SplineSetsRound2Int(cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,factor,</span>
<span class="lineNum">    9718 </span><span class="lineNoCov">          0 :             cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro(), anysel);</span>
<span class="lineNum">    9719 </span><span class="lineNoCov">          0 :     for ( r=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs; r!=NULL; r=r-&gt;next ) {</span>
<span class="lineNum">    9720 </span><span class="lineNoCov">          0 :         if ( r-&gt;selected || !anysel ) {</span>
<span class="lineNum">    9721 </span><span class="lineNoCov">          0 :             r-&gt;transform[4] = rint(r-&gt;transform[4]*factor)/factor;</span>
<span class="lineNum">    9722 </span><span class="lineNoCov">          0 :             r-&gt;transform[5] = rint(r-&gt;transform[5]*factor)/factor;</span>
<span class="lineNum">    9723 </span>            :         }
<span class="lineNum">    9724 </span>            :     }
<span class="lineNum">    9725 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.drawmode==dm_fore ) {</span>
<span class="lineNum">    9726 </span><span class="lineNoCov">          0 :         for ( ap=cv-&gt;b.sc-&gt;anchor; ap!=NULL; ap=ap-&gt;next ) {</span>
<span class="lineNum">    9727 </span><span class="lineNoCov">          0 :             if ( ap-&gt;selected || !anysel ) {</span>
<span class="lineNum">    9728 </span><span class="lineNoCov">          0 :                 ap-&gt;me.x = rint(ap-&gt;me.x*factor)/factor;</span>
<span class="lineNum">    9729 </span><span class="lineNoCov">          0 :                 ap-&gt;me.y = rint(ap-&gt;me.y*factor)/factor;</span>
<span class="lineNum">    9730 </span>            :             }
<span class="lineNum">    9731 </span>            :         }
<span class="lineNum">    9732 </span>            :     }
<span class="lineNum">    9733 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="9734"><span class="lineNum">    9734 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9735 </span>            : 
<span class="lineNum">    9736 </span><span class="lineNoCov">          0 : static void CVMenuRound2Int(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9737 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9738 </span><span class="lineNoCov">          0 :     _CVMenuRound2Int(cv,1.0);</span>
<a name="9739"><span class="lineNum">    9739 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9740 </span>            : 
<span class="lineNum">    9741 </span><span class="lineNoCov">          0 : static void CVMenuRound2Hundredths(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9742 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9743 </span><span class="lineNoCov">          0 :     _CVMenuRound2Int(cv,100.0);</span>
<a name="9744"><span class="lineNum">    9744 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9745 </span>            : 
<span class="lineNum">    9746 </span><span class="lineNoCov">          0 : static void CVMenuCluster(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9747 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9748 </span><span class="lineNoCov">          0 :     int layer = cv-&gt;b.drawmode == dm_grid ? ly_grid :</span>
<span class="lineNum">    9749 </span><span class="lineNoCov">          0 :                 cv-&gt;b.drawmode == dm_back ? ly_back</span>
<span class="lineNum">    9750 </span><span class="lineNoCov">          0 :                                         : cv-&gt;b.layerheads[dm_fore] - cv-&gt;b.sc-&gt;layers;</span>
<span class="lineNum">    9751 </span><span class="lineNoCov">          0 :     SCRoundToCluster(cv-&gt;b.sc,layer,true,.1,.5);</span>
<a name="9752"><span class="lineNum">    9752 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9753 </span>            : 
<span class="lineNum">    9754 </span><span class="lineNoCov">          0 : static void CVMenuStroke(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9755 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9756 </span><span class="lineNoCov">          0 :     CVStroke(cv);</span>
<span class="lineNum">    9757 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    9758 </span>            : 
<span class="lineNum">    9759 </span>            : #ifdef FONTFORGE_CONFIG_TILEPATH
<span class="lineNum">    9760 </span>            : static void CVMenuTilePath(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {
<span class="lineNum">    9761 </span>            :     CharView *cv = (CharView *) GDrawGetUserData(gw);
<span class="lineNum">    9762 </span>            :     CVTile(cv);
<span class="lineNum">    9763 </span>            : }
<span class="lineNum">    9764 </span>            : 
<span class="lineNum">    9765 </span>            : static void CVMenuPatternTile(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {
<span class="lineNum">    9766 </span>            :     CharView *cv = (CharView *) GDrawGetUserData(gw);
<span class="lineNum">    9767 </span>            :     CVPatternTile(cv);
<span class="lineNum">    9768 </span>            : }
<a name="9769"><span class="lineNum">    9769 </span>            : #endif</a>
<span class="lineNum">    9770 </span>            : 
<span class="lineNum">    9771 </span><span class="lineNoCov">          0 : static void _CVMenuOverlap(CharView *cv,enum overlap_type ot) {</span>
<span class="lineNum">    9772 </span>            :     /* We know it's more likely that we'll find a problem in the overlap code */
<span class="lineNum">    9773 </span>            :     /*  than anywhere else, so let's save the current state against a crash */
<span class="lineNum">    9774 </span><span class="lineNoCov">          0 :     int layer = cv-&gt;b.drawmode == dm_grid ? ly_grid :</span>
<span class="lineNum">    9775 </span><span class="lineNoCov">          0 :                 cv-&gt;b.drawmode == dm_back ? ly_back</span>
<span class="lineNum">    9776 </span><span class="lineNoCov">          0 :                                         : cv-&gt;b.layerheads[dm_fore] - cv-&gt;b.sc-&gt;layers;</span>
<span class="lineNum">    9777 </span>            : 
<span class="lineNum">    9778 </span><span class="lineNoCov">          0 :     DoAutoSaves();</span>
<span class="lineNum">    9779 </span>            : #if 0
<span class="lineNum">    9780 </span>            :     // We await testing on the necessity of this operation.
<span class="lineNum">    9781 </span>            :     if ( !SCRoundToCluster(cv-&gt;b.sc,layer,false,.03,.12))
<span class="lineNum">    9782 </span>            :         CVPreserveState(&amp;cv-&gt;b); /* SCRound2Cluster does this when it makes a change, not otherwise */
<span class="lineNum">    9783 </span>            : #else
<span class="lineNum">    9784 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    9785 </span>            : #endif // 0
<span class="lineNum">    9786 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.drawmode==dm_fore ) {</span>
<span class="lineNum">    9787 </span><span class="lineNoCov">          0 :         MinimumDistancesFree(cv-&gt;b.sc-&gt;md);</span>
<span class="lineNum">    9788 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;md = NULL;</span>
<span class="lineNum">    9789 </span>            :     }
<span class="lineNum">    9790 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines = SplineSetRemoveOverlap(cv-&gt;b.sc,cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,ot);</span>
<span class="lineNum">    9791 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="9792"><span class="lineNum">    9792 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9793 </span>            : 
<span class="lineNum">    9794 </span><span class="lineNoCov">          0 : static void CVMenuOverlap(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9795 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9796 </span>            :     int anysel;
<span class="lineNum">    9797 </span>            : 
<span class="lineNum">    9798 </span><span class="lineNoCov">          0 :     (void) CVAnySel(cv,&amp;anysel,NULL,NULL,NULL);</span>
<span class="lineNum">    9799 </span><span class="lineNoCov">          0 :     _CVMenuOverlap(cv,mi-&gt;mid==MID_RmOverlap ? (anysel ? over_rmselected: over_remove) :</span>
<span class="lineNum">    9800 </span><span class="lineNoCov">          0 :                       mi-&gt;mid==MID_Intersection ? (anysel ? over_intersel : over_intersect ) :</span>
<span class="lineNum">    9801 </span><span class="lineNoCov">          0 :                       mi-&gt;mid==MID_Exclude ? over_exclude :</span>
<span class="lineNum">    9802 </span><span class="lineNoCov">          0 :                           (anysel ? over_fisel : over_findinter));</span>
<a name="9803"><span class="lineNum">    9803 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9804 </span>            : 
<span class="lineNum">    9805 </span><span class="lineNoCov">          0 : static void CVMenuOrder(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9806 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9807 </span>            :     SplinePointList *spl;
<span class="lineNum">    9808 </span>            :     RefChar *r;
<span class="lineNum">    9809 </span>            :     ImageList *im;
<span class="lineNum">    9810 </span><span class="lineNoCov">          0 :     int exactlyone = CVOneContourSel(cv,&amp;spl,&amp;r,&amp;im);</span>
<span class="lineNum">    9811 </span>            : 
<span class="lineNum">    9812 </span><span class="lineNoCov">          0 :     if ( !exactlyone )</span>
<span class="lineNum">    9813 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    9814 </span>            : 
<span class="lineNum">    9815 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    9816 </span><span class="lineNoCov">          0 :     if ( spl!=NULL ) {</span>
<span class="lineNum">    9817 </span>            :         SplinePointList *p, *pp, *t;
<span class="lineNum">    9818 </span><span class="lineNoCov">          0 :         p = pp = NULL;</span>
<span class="lineNum">    9819 </span><span class="lineNoCov">          0 :         for ( t=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; t!=NULL &amp;&amp; t!=spl; t=t-&gt;next ) {</span>
<span class="lineNum">    9820 </span><span class="lineNoCov">          0 :             pp = p; p = t;</span>
<span class="lineNum">    9821 </span>            :         }
<span class="lineNum">    9822 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">    9823 </span>            :           case MID_First:
<span class="lineNum">    9824 </span><span class="lineNoCov">          0 :             if ( p!=NULL ) {</span>
<span class="lineNum">    9825 </span><span class="lineNoCov">          0 :                 p-&gt;next = spl-&gt;next;</span>
<span class="lineNum">    9826 </span><span class="lineNoCov">          0 :                 spl-&gt;next = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines;</span>
<span class="lineNum">    9827 </span><span class="lineNoCov">          0 :                 cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines = spl;</span>
<span class="lineNum">    9828 </span>            :             }
<span class="lineNum">    9829 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9830 </span>            :           case MID_Earlier:
<span class="lineNum">    9831 </span><span class="lineNoCov">          0 :             if ( p!=NULL ) {</span>
<span class="lineNum">    9832 </span><span class="lineNoCov">          0 :                 p-&gt;next = spl-&gt;next;</span>
<span class="lineNum">    9833 </span><span class="lineNoCov">          0 :                 spl-&gt;next = p;</span>
<span class="lineNum">    9834 </span><span class="lineNoCov">          0 :                 if ( pp==NULL ) {</span>
<span class="lineNum">    9835 </span><span class="lineNoCov">          0 :                     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines = spl;</span>
<span class="lineNum">    9836 </span>            :                 } else {
<span class="lineNum">    9837 </span><span class="lineNoCov">          0 :                     pp-&gt;next = spl;</span>
<span class="lineNum">    9838 </span>            :                 }
<span class="lineNum">    9839 </span>            :             }
<span class="lineNum">    9840 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9841 </span>            :           case MID_Last:
<span class="lineNum">    9842 </span><span class="lineNoCov">          0 :             if ( spl-&gt;next!=NULL ) {</span>
<span class="lineNum">    9843 </span><span class="lineNoCov">          0 :                 for ( t=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; t-&gt;next!=NULL; t=t-&gt;next );</span>
<span class="lineNum">    9844 </span><span class="lineNoCov">          0 :                 t-&gt;next = spl;</span>
<span class="lineNum">    9845 </span><span class="lineNoCov">          0 :                 if ( p==NULL )</span>
<span class="lineNum">    9846 </span><span class="lineNoCov">          0 :                     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines = spl-&gt;next;</span>
<span class="lineNum">    9847 </span>            :                 else
<span class="lineNum">    9848 </span><span class="lineNoCov">          0 :                     p-&gt;next = spl-&gt;next;</span>
<span class="lineNum">    9849 </span><span class="lineNoCov">          0 :                 spl-&gt;next = NULL;</span>
<span class="lineNum">    9850 </span>            :             }
<span class="lineNum">    9851 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9852 </span>            :           case MID_Later:
<span class="lineNum">    9853 </span><span class="lineNoCov">          0 :             if ( spl-&gt;next!=NULL ) {</span>
<span class="lineNum">    9854 </span><span class="lineNoCov">          0 :                 t = spl-&gt;next;</span>
<span class="lineNum">    9855 </span><span class="lineNoCov">          0 :                 spl-&gt;next = t-&gt;next;</span>
<span class="lineNum">    9856 </span><span class="lineNoCov">          0 :                 t-&gt;next = spl;</span>
<span class="lineNum">    9857 </span><span class="lineNoCov">          0 :                 if ( p==NULL )</span>
<span class="lineNum">    9858 </span><span class="lineNoCov">          0 :                     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines = t;</span>
<span class="lineNum">    9859 </span>            :                 else
<span class="lineNum">    9860 </span><span class="lineNoCov">          0 :                     p-&gt;next = t;</span>
<span class="lineNum">    9861 </span>            :             }
<span class="lineNum">    9862 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9863 </span>            :         }
<span class="lineNum">    9864 </span><span class="lineNoCov">          0 :     } else if ( r!=NULL ) {</span>
<span class="lineNum">    9865 </span>            :         RefChar *p, *pp, *t;
<span class="lineNum">    9866 </span><span class="lineNoCov">          0 :         p = pp = NULL;</span>
<span class="lineNum">    9867 </span><span class="lineNoCov">          0 :         for ( t=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs; t!=NULL &amp;&amp; t!=r; t=t-&gt;next ) {</span>
<span class="lineNum">    9868 </span><span class="lineNoCov">          0 :             pp = p; p = t;</span>
<span class="lineNum">    9869 </span>            :         }
<span class="lineNum">    9870 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">    9871 </span>            :           case MID_First:
<span class="lineNum">    9872 </span><span class="lineNoCov">          0 :             if ( p!=NULL ) {</span>
<span class="lineNum">    9873 </span><span class="lineNoCov">          0 :                 p-&gt;next = r-&gt;next;</span>
<span class="lineNum">    9874 </span><span class="lineNoCov">          0 :                 r-&gt;next = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs;</span>
<span class="lineNum">    9875 </span><span class="lineNoCov">          0 :                 cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs = r;</span>
<span class="lineNum">    9876 </span>            :             }
<span class="lineNum">    9877 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9878 </span>            :           case MID_Earlier:
<span class="lineNum">    9879 </span><span class="lineNoCov">          0 :             if ( p!=NULL ) {</span>
<span class="lineNum">    9880 </span><span class="lineNoCov">          0 :                 p-&gt;next = r-&gt;next;</span>
<span class="lineNum">    9881 </span><span class="lineNoCov">          0 :                 r-&gt;next = p;</span>
<span class="lineNum">    9882 </span><span class="lineNoCov">          0 :                 if ( pp==NULL ) {</span>
<span class="lineNum">    9883 </span><span class="lineNoCov">          0 :                     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs = r;</span>
<span class="lineNum">    9884 </span>            :                 } else {
<span class="lineNum">    9885 </span><span class="lineNoCov">          0 :                     pp-&gt;next = r;</span>
<span class="lineNum">    9886 </span>            :                 }
<span class="lineNum">    9887 </span>            :             }
<span class="lineNum">    9888 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9889 </span>            :           case MID_Last:
<span class="lineNum">    9890 </span><span class="lineNoCov">          0 :             if ( r-&gt;next!=NULL ) {</span>
<span class="lineNum">    9891 </span><span class="lineNoCov">          0 :                 for ( t=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs; t-&gt;next!=NULL; t=t-&gt;next );</span>
<span class="lineNum">    9892 </span><span class="lineNoCov">          0 :                 t-&gt;next = r;</span>
<span class="lineNum">    9893 </span><span class="lineNoCov">          0 :                 if ( p==NULL )</span>
<span class="lineNum">    9894 </span><span class="lineNoCov">          0 :                     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs = r-&gt;next;</span>
<span class="lineNum">    9895 </span>            :                 else
<span class="lineNum">    9896 </span><span class="lineNoCov">          0 :                     p-&gt;next = r-&gt;next;</span>
<span class="lineNum">    9897 </span><span class="lineNoCov">          0 :                 r-&gt;next = NULL;</span>
<span class="lineNum">    9898 </span>            :             }
<span class="lineNum">    9899 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9900 </span>            :           case MID_Later:
<span class="lineNum">    9901 </span><span class="lineNoCov">          0 :             if ( r-&gt;next!=NULL ) {</span>
<span class="lineNum">    9902 </span><span class="lineNoCov">          0 :                 t = r-&gt;next;</span>
<span class="lineNum">    9903 </span><span class="lineNoCov">          0 :                 r-&gt;next = t-&gt;next;</span>
<span class="lineNum">    9904 </span><span class="lineNoCov">          0 :                 t-&gt;next = r;</span>
<span class="lineNum">    9905 </span><span class="lineNoCov">          0 :                 if ( p==NULL )</span>
<span class="lineNum">    9906 </span><span class="lineNoCov">          0 :                     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs = t;</span>
<span class="lineNum">    9907 </span>            :                 else
<span class="lineNum">    9908 </span><span class="lineNoCov">          0 :                     p-&gt;next = t;</span>
<span class="lineNum">    9909 </span>            :             }
<span class="lineNum">    9910 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9911 </span>            :         }
<span class="lineNum">    9912 </span><span class="lineNoCov">          0 :     } else if ( im!=NULL ) {</span>
<span class="lineNum">    9913 </span>            :         ImageList *p, *pp, *t;
<span class="lineNum">    9914 </span><span class="lineNoCov">          0 :         p = pp = NULL;</span>
<span class="lineNum">    9915 </span><span class="lineNoCov">          0 :         for ( t=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images; t!=NULL &amp;&amp; t!=im; t=t-&gt;next ) {</span>
<span class="lineNum">    9916 </span><span class="lineNoCov">          0 :             pp = p; p = t;</span>
<span class="lineNum">    9917 </span>            :         }
<span class="lineNum">    9918 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">    9919 </span>            :           case MID_First:
<span class="lineNum">    9920 </span><span class="lineNoCov">          0 :             if ( p!=NULL ) {</span>
<span class="lineNum">    9921 </span><span class="lineNoCov">          0 :                 p-&gt;next = im-&gt;next;</span>
<span class="lineNum">    9922 </span><span class="lineNoCov">          0 :                 im-&gt;next = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images;</span>
<span class="lineNum">    9923 </span><span class="lineNoCov">          0 :                 cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images = im;</span>
<span class="lineNum">    9924 </span>            :             }
<span class="lineNum">    9925 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9926 </span>            :           case MID_Earlier:
<span class="lineNum">    9927 </span><span class="lineNoCov">          0 :             if ( p!=NULL ) {</span>
<span class="lineNum">    9928 </span><span class="lineNoCov">          0 :                 p-&gt;next = im-&gt;next;</span>
<span class="lineNum">    9929 </span><span class="lineNoCov">          0 :                 im-&gt;next = p;</span>
<span class="lineNum">    9930 </span><span class="lineNoCov">          0 :                 if ( pp==NULL ) {</span>
<span class="lineNum">    9931 </span><span class="lineNoCov">          0 :                     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images = im;</span>
<span class="lineNum">    9932 </span>            :                 } else {
<span class="lineNum">    9933 </span><span class="lineNoCov">          0 :                     pp-&gt;next = im;</span>
<span class="lineNum">    9934 </span>            :                 }
<span class="lineNum">    9935 </span>            :             }
<span class="lineNum">    9936 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9937 </span>            :           case MID_Last:
<span class="lineNum">    9938 </span><span class="lineNoCov">          0 :             if ( im-&gt;next!=NULL ) {</span>
<span class="lineNum">    9939 </span><span class="lineNoCov">          0 :                 for ( t=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images; t-&gt;next!=NULL; t=t-&gt;next );</span>
<span class="lineNum">    9940 </span><span class="lineNoCov">          0 :                 t-&gt;next = im;</span>
<span class="lineNum">    9941 </span><span class="lineNoCov">          0 :                 if ( p==NULL )</span>
<span class="lineNum">    9942 </span><span class="lineNoCov">          0 :                     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images = im-&gt;next;</span>
<span class="lineNum">    9943 </span>            :                 else
<span class="lineNum">    9944 </span><span class="lineNoCov">          0 :                     p-&gt;next = im-&gt;next;</span>
<span class="lineNum">    9945 </span><span class="lineNoCov">          0 :                 im-&gt;next = NULL;</span>
<span class="lineNum">    9946 </span>            :             }
<span class="lineNum">    9947 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9948 </span>            :           case MID_Later:
<span class="lineNum">    9949 </span><span class="lineNoCov">          0 :             if ( im-&gt;next!=NULL ) {</span>
<span class="lineNum">    9950 </span><span class="lineNoCov">          0 :                 t = im-&gt;next;</span>
<span class="lineNum">    9951 </span><span class="lineNoCov">          0 :                 im-&gt;next = t-&gt;next;</span>
<span class="lineNum">    9952 </span><span class="lineNoCov">          0 :                 t-&gt;next = im;</span>
<span class="lineNum">    9953 </span><span class="lineNoCov">          0 :                 if ( p==NULL )</span>
<span class="lineNum">    9954 </span><span class="lineNoCov">          0 :                     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images = t;</span>
<span class="lineNum">    9955 </span>            :                 else
<span class="lineNum">    9956 </span><span class="lineNoCov">          0 :                     p-&gt;next = t;</span>
<span class="lineNum">    9957 </span>            :             }
<span class="lineNum">    9958 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    9959 </span>            :         }
<span class="lineNum">    9960 </span>            :     }
<span class="lineNum">    9961 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="9962"><span class="lineNum">    9962 </span>            : }</a>
<span class="lineNum">    9963 </span>            : 
<span class="lineNum">    9964 </span><span class="lineNoCov">          0 : static void _CVMenuAddExtrema(CharView *cv) {</span>
<span class="lineNum">    9965 </span>            :     int anysel;
<span class="lineNum">    9966 </span><span class="lineNoCov">          0 :     SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">    9967 </span>            : 
<span class="lineNum">    9968 </span><span class="lineNoCov">          0 :     (void) CVAnySel(cv,&amp;anysel,NULL,NULL,NULL);</span>
<span class="lineNum">    9969 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">    9970 </span><span class="lineNoCov">          0 :     SplineCharAddExtrema(cv-&gt;b.sc,cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,</span>
<span class="lineNum">    9971 </span><span class="lineNoCov">          0 :             anysel?ae_between_selected:ae_only_good,sf-&gt;ascent+sf-&gt;descent);</span>
<span class="lineNum">    9972 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="9973"><span class="lineNum">    9973 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9974 </span>            : 
<span class="lineNum">    9975 </span><span class="lineNoCov">          0 : static void CVMenuAddExtrema(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">    9976 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">    9977 </span><span class="lineNoCov">          0 :     _CVMenuAddExtrema(cv);</span>
<a name="9978"><span class="lineNum">    9978 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    9979 </span>            : 
<span class="lineNum">    9980 </span><span class="lineNoCov">          0 : static void CVSimplify(CharView *cv,int type) {</span>
<span class="lineNum">    9981 </span>            :     static struct simplifyinfo smpls[] = {
<span class="lineNum">    9982 </span>            :             { sf_normal, 0, 0, 0, 0, 0, 0 },
<span class="lineNum">    9983 </span>            :             { sf_normal,.75,.05,0,-1, 0, 0 },
<span class="lineNum">    9984 </span>            :             { sf_normal,.75,.05,0,-1, 0, 0 }};
<span class="lineNum">    9985 </span><span class="lineNoCov">          0 :     struct simplifyinfo *smpl = &amp;smpls[type+1];</span>
<span class="lineNum">    9986 </span>            : 
<span class="lineNum">    9987 </span><span class="lineNoCov">          0 :     if ( smpl-&gt;linelenmax==-1 || (type==0 &amp;&amp; !smpl-&gt;set_as_default)) {</span>
<span class="lineNum">    9988 </span><span class="lineNoCov">          0 :         smpl-&gt;err = (cv-&gt;b.sc-&gt;parent-&gt;ascent+cv-&gt;b.sc-&gt;parent-&gt;descent)/1000.;</span>
<span class="lineNum">    9989 </span><span class="lineNoCov">          0 :         smpl-&gt;linelenmax = (cv-&gt;b.sc-&gt;parent-&gt;ascent+cv-&gt;b.sc-&gt;parent-&gt;descent)/100.;</span>
<span class="lineNum">    9990 </span>            :     }
<span class="lineNum">    9991 </span>            : 
<span class="lineNum">    9992 </span><span class="lineNoCov">          0 :     if ( type==1 ) {</span>
<span class="lineNum">    9993 </span><span class="lineNoCov">          0 :         if ( !SimplifyDlg(cv-&gt;b.sc-&gt;parent,smpl))</span>
<span class="lineNum">    9994 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    9995 </span><span class="lineNoCov">          0 :         if ( smpl-&gt;set_as_default )</span>
<span class="lineNum">    9996 </span><span class="lineNoCov">          0 :             smpls[1] = *smpl;</span>
<span class="lineNum">    9997 </span>            :     }
<span class="lineNum">    9998 </span>            : 
<span class="lineNum">    9999 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">   10000 </span><span class="lineNoCov">          0 :     smpl-&gt;check_selected_contours = true;</span>
<span class="lineNum">   10001 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines = SplineCharSimplify(cv-&gt;b.sc,cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,</span>
<span class="lineNum">   10002 </span>            :             smpl);
<span class="lineNum">   10003 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="10004"><span class="lineNum">   10004 </span>            : }</a>
<span class="lineNum">   10005 </span>            : 
<span class="lineNum">   10006 </span><span class="lineNoCov">          0 : static void CVMenuSimplify(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10007 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10008 </span><span class="lineNoCov">          0 :     CVSimplify(cv,0);</span>
<a name="10009"><span class="lineNum">   10009 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10010 </span>            : 
<span class="lineNum">   10011 </span><span class="lineNoCov">          0 : static void CVMenuSimplifyMore(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10012 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10013 </span><span class="lineNoCov">          0 :     CVSimplify(cv,1);</span>
<a name="10014"><span class="lineNum">   10014 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10015 </span>            : 
<span class="lineNum">   10016 </span><span class="lineNoCov">          0 : static void CVMenuCleanupGlyph(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10017 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10018 </span><span class="lineNoCov">          0 :     CVSimplify(cv,-1);</span>
<a name="10019"><span class="lineNum">   10019 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10020 </span>            : 
<span class="lineNum">   10021 </span><span class="lineNoCov">          0 : static int SPLSelected(SplineSet *ss) {</span>
<span class="lineNum">   10022 </span>            :     SplinePoint *sp;
<span class="lineNum">   10023 </span>            : 
<span class="lineNum">   10024 </span><span class="lineNoCov">          0 :     for ( sp=ss-&gt;first ;; ) {</span>
<span class="lineNum">   10025 </span><span class="lineNoCov">          0 :         if ( sp-&gt;selected )</span>
<span class="lineNum">   10026 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">   10027 </span><span class="lineNoCov">          0 :         if ( sp-&gt;next==NULL )</span>
<span class="lineNum">   10028 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">   10029 </span><span class="lineNoCov">          0 :         sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">   10030 </span><span class="lineNoCov">          0 :         if ( sp==ss-&gt;first )</span>
<span class="lineNum">   10031 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">   10032 </span><span class="lineNoCov">          0 :     }</span>
<a name="10033"><span class="lineNum">   10033 </span>            : }</a>
<span class="lineNum">   10034 </span>            : 
<span class="lineNum">   10035 </span><span class="lineNoCov">          0 : static void CVCanonicalStart(CharView *cv) {</span>
<span class="lineNum">   10036 </span>            :     SplineSet *ss;
<span class="lineNum">   10037 </span><span class="lineNoCov">          0 :     int changed = 0;</span>
<span class="lineNum">   10038 </span>            : 
<span class="lineNum">   10039 </span><span class="lineNoCov">          0 :     for ( ss = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; ss!=NULL; ss=ss-&gt;next )</span>
<span class="lineNum">   10040 </span><span class="lineNoCov">          0 :         if ( ss-&gt;first==ss-&gt;last &amp;&amp; SPLSelected(ss)) {</span>
<span class="lineNum">   10041 </span><span class="lineNoCov">          0 :             SPLStartToLeftmost(cv-&gt;b.sc,ss,&amp;changed);</span>
<span class="lineNum">   10042 </span>            :             /* The above clears the spiros if needed */
<span class="lineNum">   10043 </span>            :         }
<a name="10044"><span class="lineNum">   10044 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10045 </span>            : 
<span class="lineNum">   10046 </span><span class="lineNoCov">          0 : static void CVMenuCanonicalStart(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10047 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10048 </span><span class="lineNoCov">          0 :     CVCanonicalStart(cv);</span>
<a name="10049"><span class="lineNum">   10049 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10050 </span>            : 
<span class="lineNum">   10051 </span><span class="lineNoCov">          0 : static void CVCanonicalContour(CharView *cv) {</span>
<span class="lineNum">   10052 </span><span class="lineNoCov">          0 :     CanonicalContours(cv-&gt;b.sc,CVLayer((CharViewBase *) cv));</span>
<a name="10053"><span class="lineNum">   10053 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10054 </span>            : 
<span class="lineNum">   10055 </span><span class="lineNoCov">          0 : static void CVMenuCanonicalContours(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10056 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10057 </span><span class="lineNoCov">          0 :     CVCanonicalContour(cv);</span>
<a name="10058"><span class="lineNum">   10058 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10059 </span>            : 
<span class="lineNum">   10060 </span><span class="lineNoCov">          0 : static void _CVMenuMakeFirst(CharView *cv) {</span>
<span class="lineNum">   10061 </span><span class="lineNoCov">          0 :     SplinePoint *selpt = NULL;</span>
<span class="lineNum">   10062 </span><span class="lineNoCov">          0 :     int anypoints = 0, splinepoints;</span>
<span class="lineNum">   10063 </span>            :     SplinePointList *spl, *sel;
<span class="lineNum">   10064 </span>            :     Spline *spline, *first;
<span class="lineNum">   10065 </span>            : 
<span class="lineNum">   10066 </span><span class="lineNoCov">          0 :     sel = NULL;</span>
<span class="lineNum">   10067 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">   10068 </span><span class="lineNoCov">          0 :         first = NULL;</span>
<span class="lineNum">   10069 </span><span class="lineNoCov">          0 :         splinepoints = 0;</span>
<span class="lineNum">   10070 </span><span class="lineNoCov">          0 :         if ( spl-&gt;first-&gt;selected ) { splinepoints = 1; sel = spl; selpt=spl-&gt;first; }</span>
<span class="lineNum">   10071 </span><span class="lineNoCov">          0 :         for ( spline=spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first &amp;&amp; !splinepoints; spline = spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">   10072 </span><span class="lineNoCov">          0 :             if ( spline-&gt;to-&gt;selected ) { ++splinepoints; sel = spl; selpt=spline-&gt;to; }</span>
<span class="lineNum">   10073 </span><span class="lineNoCov">          0 :             if ( first == NULL ) first = spline;</span>
<span class="lineNum">   10074 </span>            :         }
<span class="lineNum">   10075 </span><span class="lineNoCov">          0 :         anypoints += splinepoints;</span>
<span class="lineNum">   10076 </span>            :     }
<span class="lineNum">   10077 </span>            : 
<span class="lineNum">   10078 </span><span class="lineNoCov">          0 :     if ( anypoints!=1 || sel-&gt;first-&gt;prev==NULL || sel-&gt;first==selpt )</span>
<span class="lineNum">   10079 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   10080 </span>            : 
<span class="lineNum">   10081 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">   10082 </span><span class="lineNoCov">          0 :     sel-&gt;first = sel-&gt;last = selpt;</span>
<span class="lineNum">   10083 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="10084"><span class="lineNum">   10084 </span>            : }</a>
<span class="lineNum">   10085 </span>            : 
<span class="lineNum">   10086 </span><span class="lineNoCov">          0 : static void CVMenuMakeFirst(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10087 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10088 </span><span class="lineNoCov">          0 :     _CVMenuMakeFirst(cv);</span>
<a name="10089"><span class="lineNum">   10089 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10090 </span>            : 
<span class="lineNum">   10091 </span><span class="lineNoCov">          0 : static void _CVMenuSpiroMakeFirst(CharView *cv) {</span>
<span class="lineNum">   10092 </span><span class="lineNoCov">          0 :     int anypoints = 0, which;</span>
<span class="lineNum">   10093 </span>            :     SplinePointList *spl, *sel;
<span class="lineNum">   10094 </span>            :     int i;
<span class="lineNum">   10095 </span>            :     spiro_cp *newspiros;
<span class="lineNum">   10096 </span>            : 
<span class="lineNum">   10097 </span><span class="lineNoCov">          0 :     sel = NULL;</span>
<span class="lineNum">   10098 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">   10099 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;spl-&gt;spiro_cnt-1; ++i ) {</span>
<span class="lineNum">   10100 </span><span class="lineNoCov">          0 :             if ( SPIRO_SELECTED(&amp;spl-&gt;spiros[i])) {</span>
<span class="lineNum">   10101 </span><span class="lineNoCov">          0 :                 if ( SPIRO_SPL_OPEN(spl))</span>
<span class="lineNum">   10102 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   10103 </span><span class="lineNoCov">          0 :                 ++anypoints;</span>
<span class="lineNum">   10104 </span><span class="lineNoCov">          0 :                 sel = spl;</span>
<span class="lineNum">   10105 </span><span class="lineNoCov">          0 :                 which = i;</span>
<span class="lineNum">   10106 </span>            :             }
<span class="lineNum">   10107 </span>            :         }
<span class="lineNum">   10108 </span>            :     }
<span class="lineNum">   10109 </span>            : 
<span class="lineNum">   10110 </span><span class="lineNoCov">          0 :     if ( anypoints!=1 || sel==NULL )</span>
<span class="lineNum">   10111 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   10112 </span>            : 
<span class="lineNum">   10113 </span><span class="lineNoCov">          0 :     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">   10114 </span><span class="lineNoCov">          0 :     newspiros = malloc((sel-&gt;spiro_max+1)*sizeof(spiro_cp));</span>
<span class="lineNum">   10115 </span><span class="lineNoCov">          0 :     memcpy(newspiros,sel-&gt;spiros+which,(sel-&gt;spiro_cnt-1-which)*sizeof(spiro_cp));</span>
<span class="lineNum">   10116 </span><span class="lineNoCov">          0 :     memcpy(newspiros+(sel-&gt;spiro_cnt-1-which),sel-&gt;spiros,which*sizeof(spiro_cp));</span>
<span class="lineNum">   10117 </span><span class="lineNoCov">          0 :     memcpy(newspiros+sel-&gt;spiro_cnt-1,sel-&gt;spiros+sel-&gt;spiro_cnt-1,sizeof(spiro_cp));</span>
<span class="lineNum">   10118 </span><span class="lineNoCov">          0 :     free(sel-&gt;spiros);</span>
<span class="lineNum">   10119 </span><span class="lineNoCov">          0 :     sel-&gt;spiros = newspiros;</span>
<span class="lineNum">   10120 </span><span class="lineNoCov">          0 :     SSRegenerateFromSpiros(sel);</span>
<span class="lineNum">   10121 </span><span class="lineNoCov">          0 :     CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="10122"><span class="lineNum">   10122 </span>            : }</a>
<span class="lineNum">   10123 </span>            : 
<span class="lineNum">   10124 </span><span class="lineNoCov">          0 : static void CVMenuSpiroMakeFirst(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10125 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10126 </span><span class="lineNoCov">          0 :     _CVMenuSpiroMakeFirst(cv);</span>
<a name="10127"><span class="lineNum">   10127 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10128 </span>            : 
<span class="lineNum">   10129 </span><span class="lineNoCov">          0 : static void CVMenuMakeLine(GWindow gw, struct gmenuitem *mi, GEvent *e) {</span>
<span class="lineNum">   10130 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10131 </span><span class="lineNoCov">          0 :     _CVMenuMakeLine((CharViewBase *) cv,mi-&gt;mid==MID_MakeArc, e!=NULL &amp;&amp; (e-&gt;u.mouse.state&amp;ksm_meta));</span>
<a name="10132"><span class="lineNum">   10132 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10133 </span>            : 
<span class="lineNum">   10134 </span><span class="lineNoCov">          0 : void _CVMenuNamePoint(CharView *cv, SplinePoint *sp) {</span>
<span class="lineNum">   10135 </span>            :     char *ret, *name, *oldname;
<span class="lineNum">   10136 </span>            : 
<span class="lineNum">   10137 </span><span class="lineNoCov">          0 :     oldname = (sp-&gt;name &amp;&amp; *sp-&gt;name) ? sp-&gt;name : NULL;</span>
<span class="lineNum">   10138 </span><span class="lineNoCov">          0 :     ret = gwwv_ask_string(_(&quot;Name this point&quot;), oldname,</span>
<span class="lineNum">   10139 </span><span class="lineNoCov">          0 :                   _(&quot;Please name this point&quot;));</span>
<span class="lineNum">   10140 </span><span class="lineNoCov">          0 :     if ( ret!=NULL ) {</span>
<span class="lineNum">   10141 </span><span class="lineNoCov">          0 :         name = *ret ? ret : NULL;</span>
<span class="lineNum">   10142 </span><span class="lineNoCov">          0 :         if (name != oldname || (name &amp;&amp; oldname &amp;&amp; strcmp(name,oldname))) {</span>
<span class="lineNum">   10143 </span><span class="lineNoCov">          0 :             sp-&gt;name = name;</span>
<span class="lineNum">   10144 </span><span class="lineNoCov">          0 :             CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<span class="lineNum">   10145 </span>            :         }
<span class="lineNum">   10146 </span><span class="lineNoCov">          0 :         if (name != ret) { free(ret); ret = NULL; }</span>
<span class="lineNum">   10147 </span><span class="lineNoCov">          0 :         if (name != oldname) { free(oldname); oldname = NULL; }</span>
<span class="lineNum">   10148 </span>            :     }
<a name="10149"><span class="lineNum">   10149 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10150 </span>            : 
<span class="lineNum">   10151 </span><span class="lineNoCov">          0 : static void CVMenuNamePoint(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10152 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10153 </span>            :     SplinePointList *spl;
<span class="lineNum">   10154 </span>            :     SplinePoint *sp;
<span class="lineNum">   10155 </span>            :     RefChar *r;
<span class="lineNum">   10156 </span>            :     ImageList *il;
<span class="lineNum">   10157 </span>            :     spiro_cp *junk;
<span class="lineNum">   10158 </span>            : 
<span class="lineNum">   10159 </span><span class="lineNoCov">          0 :     if ( CVOneThingSel( cv, &amp;sp, &amp;spl, &amp;r, &amp;il, NULL, &amp;junk ) &amp;&amp; sp) {</span>
<span class="lineNum">   10160 </span><span class="lineNoCov">          0 :         _CVMenuNamePoint(cv, sp);</span>
<span class="lineNum">   10161 </span>            :     }
<a name="10162"><span class="lineNum">   10162 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10163 </span>            : 
<span class="lineNum">   10164 </span><span class="lineNoCov">          0 : void _CVMenuNameContour(CharView *cv) {</span>
<span class="lineNum">   10165 </span><span class="lineNoCov">          0 :     SplinePointList *spl, *onlysel = NULL;</span>
<span class="lineNum">   10166 </span>            :     SplinePoint *sp;
<span class="lineNum">   10167 </span>            :     char *ret;
<span class="lineNum">   10168 </span>            :     int i;
<span class="lineNum">   10169 </span>            : 
<span class="lineNum">   10170 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">   10171 </span><span class="lineNoCov">          0 :         if ( !cv-&gt;b.sc-&gt;inspiro || !hasspiro()) {</span>
<span class="lineNum">   10172 </span><span class="lineNoCov">          0 :             for ( sp=spl-&gt;first; ; ) {</span>
<span class="lineNum">   10173 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;selected ) {</span>
<span class="lineNum">   10174 </span><span class="lineNoCov">          0 :                     if ( onlysel==NULL )</span>
<span class="lineNum">   10175 </span><span class="lineNoCov">          0 :                         onlysel = spl;</span>
<span class="lineNum">   10176 </span><span class="lineNoCov">          0 :                     else if ( onlysel!=spl )</span>
<span class="lineNum">   10177 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   10178 </span>            :                 }
<span class="lineNum">   10179 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )</span>
<span class="lineNum">   10180 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">   10181 </span><span class="lineNoCov">          0 :                 sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">   10182 </span><span class="lineNoCov">          0 :                 if ( sp==spl-&gt;first )</span>
<span class="lineNum">   10183 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">   10184 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">   10185 </span>            :         } else {
<span class="lineNum">   10186 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;spl-&gt;spiro_cnt; ++i ) {</span>
<span class="lineNum">   10187 </span><span class="lineNoCov">          0 :                 if ( SPIRO_SELECTED(&amp;spl-&gt;spiros[i])) {</span>
<span class="lineNum">   10188 </span><span class="lineNoCov">          0 :                     if ( onlysel==NULL )</span>
<span class="lineNum">   10189 </span><span class="lineNoCov">          0 :                         onlysel = spl;</span>
<span class="lineNum">   10190 </span><span class="lineNoCov">          0 :                     else if ( onlysel!=spl )</span>
<span class="lineNum">   10191 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   10192 </span>            :                 }
<span class="lineNum">   10193 </span>            :             }
<span class="lineNum">   10194 </span>            :         }
<span class="lineNum">   10195 </span>            :     }
<span class="lineNum">   10196 </span>            : 
<span class="lineNum">   10197 </span><span class="lineNoCov">          0 :     if ( onlysel!=NULL ) {</span>
<span class="lineNum">   10198 </span><span class="lineNoCov">          0 :         ret = gwwv_ask_string(_(&quot;Name this contour&quot;),onlysel-&gt;contour_name,</span>
<span class="lineNum">   10199 </span><span class="lineNoCov">          0 :                 _(&quot;Please name this contour&quot;));</span>
<span class="lineNum">   10200 </span><span class="lineNoCov">          0 :         if ( ret!=NULL ) {</span>
<span class="lineNum">   10201 </span><span class="lineNoCov">          0 :             free(onlysel-&gt;contour_name);</span>
<span class="lineNum">   10202 </span><span class="lineNoCov">          0 :             if ( *ret!='\0' )</span>
<span class="lineNum">   10203 </span><span class="lineNoCov">          0 :                 onlysel-&gt;contour_name = ret;</span>
<span class="lineNum">   10204 </span>            :             else {
<span class="lineNum">   10205 </span><span class="lineNoCov">          0 :                 onlysel-&gt;contour_name = NULL;</span>
<span class="lineNum">   10206 </span><span class="lineNoCov">          0 :                 free(ret);</span>
<span class="lineNum">   10207 </span>            :             }
<span class="lineNum">   10208 </span><span class="lineNoCov">          0 :             CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<span class="lineNum">   10209 </span>            :         }
<span class="lineNum">   10210 </span>            :     }
<a name="10211"><span class="lineNum">   10211 </span>            : }</a>
<span class="lineNum">   10212 </span>            : 
<span class="lineNum">   10213 </span><span class="lineNoCov">          0 : static void CVMenuNameContour(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10214 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10215 </span><span class="lineNoCov">          0 :     _CVMenuNameContour(cv);</span>
<span class="lineNum">   10216 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   10217 </span>            : 
<span class="lineNum">   10218 </span>            : struct insertonsplineat {
<span class="lineNum">   10219 </span>            :     int done;
<span class="lineNum">   10220 </span>            :     GWindow gw;
<span class="lineNum">   10221 </span>            :     Spline *s;
<span class="lineNum">   10222 </span>            :     CharView *cv;
<span class="lineNum">   10223 </span>            : };
<span class="lineNum">   10224 </span>            : 
<span class="lineNum">   10225 </span>            : #define CID_X   1001
<span class="lineNum">   10226 </span>            : #define CID_Y   1002
<span class="lineNum">   10227 </span>            : #define CID_XR  1003
<a name="10228"><span class="lineNum">   10228 </span>            : #define CID_YR  1004</a>
<span class="lineNum">   10229 </span>            : 
<span class="lineNum">   10230 </span><span class="lineNoCov">          0 : static int IOSA_OK(GGadget *g, GEvent *e) {</span>
<span class="lineNum">   10231 </span>            : 
<span class="lineNum">   10232 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">   10233 </span><span class="lineNoCov">          0 :         int err = false;</span>
<span class="lineNum">   10234 </span><span class="lineNoCov">          0 :         struct insertonsplineat *iosa = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">   10235 </span>            :         double val;
<span class="lineNum">   10236 </span>            :         extended ts[3];
<span class="lineNum">   10237 </span>            :         int which;
<span class="lineNum">   10238 </span>            :         SplinePoint *sp;
<span class="lineNum">   10239 </span>            : 
<span class="lineNum">   10240 </span><span class="lineNoCov">          0 :         if ( GGadgetIsChecked(GWidgetGetControl(iosa-&gt;gw,CID_XR)) ) {</span>
<span class="lineNum">   10241 </span><span class="lineNoCov">          0 :             val = GetReal8(iosa-&gt;gw,CID_X,&quot;X&quot;,&amp;err);</span>
<span class="lineNum">   10242 </span><span class="lineNoCov">          0 :             which = 0;</span>
<span class="lineNum">   10243 </span>            :         } else {
<span class="lineNum">   10244 </span><span class="lineNoCov">          0 :             val = GetReal8(iosa-&gt;gw,CID_Y,&quot;Y&quot;,&amp;err);</span>
<span class="lineNum">   10245 </span><span class="lineNoCov">          0 :             which = 1;</span>
<span class="lineNum">   10246 </span>            :         }
<span class="lineNum">   10247 </span><span class="lineNoCov">          0 :         if ( err )</span>
<span class="lineNum">   10248 </span><span class="lineNoCov">          0 : return(true);</span>
<span class="lineNum">   10249 </span><span class="lineNoCov">          0 :         if ( CubicSolve(&amp;iosa-&gt;s-&gt;splines[which],val,ts)==0 ) {</span>
<span class="lineNum">   10250 </span><span class="lineNoCov">          0 :             ff_post_error(_(&quot;Out of Range&quot;),_(&quot;The spline does not reach %g&quot;), (double) val );</span>
<span class="lineNum">   10251 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">   10252 </span>            :         }
<span class="lineNum">   10253 </span><span class="lineNoCov">          0 :         iosa-&gt;done = true;</span>
<span class="lineNum">   10254 </span><span class="lineNoCov">          0 :         CVPreserveState(&amp;iosa-&gt;cv-&gt;b);</span>
<span class="lineNum">   10255 </span>            :         for (;;) {
<span class="lineNum">   10256 </span><span class="lineNoCov">          0 :             sp = SplineBisect(iosa-&gt;s,ts[0]);</span>
<span class="lineNum">   10257 </span><span class="lineNoCov">          0 :             SplinePointCategorize(sp);</span>
<span class="lineNum">   10258 </span><span class="lineNoCov">          0 :             if ( which==0 ) {</span>
<span class="lineNum">   10259 </span><span class="lineNoCov">          0 :                 double off = val-sp-&gt;me.x;</span>
<span class="lineNum">   10260 </span><span class="lineNoCov">          0 :                 sp-&gt;me.x = val; sp-&gt;nextcp.x += off; sp-&gt;prevcp.x += off;</span>
<span class="lineNum">   10261 </span>            :             } else {
<span class="lineNum">   10262 </span><span class="lineNoCov">          0 :                 double off = val-sp-&gt;me.y;</span>
<span class="lineNum">   10263 </span><span class="lineNoCov">          0 :                 sp-&gt;me.y = val; sp-&gt;nextcp.y += off; sp-&gt;prevcp.y += off;</span>
<span class="lineNum">   10264 </span>            :             }
<span class="lineNum">   10265 </span><span class="lineNoCov">          0 :             SplineRefigure(sp-&gt;prev); SplineRefigure(sp-&gt;next);</span>
<span class="lineNum">   10266 </span><span class="lineNoCov">          0 :             if ( ts[1]==-1 ) {</span>
<span class="lineNum">   10267 </span><span class="lineNoCov">          0 :                 CVCharChangedUpdate(&amp;iosa-&gt;cv-&gt;b);</span>
<span class="lineNum">   10268 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">   10269 </span>            :             }
<span class="lineNum">   10270 </span><span class="lineNoCov">          0 :             iosa-&gt;s = sp-&gt;next;</span>
<span class="lineNum">   10271 </span><span class="lineNoCov">          0 :             if ( CubicSolve(&amp;iosa-&gt;s-&gt;splines[which],val,ts)==0 ) {</span>
<span class="lineNum">   10272 </span>            :                 /* Odd. We found one earlier */
<span class="lineNum">   10273 </span><span class="lineNoCov">          0 :                 CVCharChangedUpdate(&amp;iosa-&gt;cv-&gt;b);</span>
<span class="lineNum">   10274 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">   10275 </span>            :             }
<span class="lineNum">   10276 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">   10277 </span>            :     }
<span class="lineNum">   10278 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="10279"><span class="lineNum">   10279 </span>            : }</a>
<span class="lineNum">   10280 </span>            : 
<span class="lineNum">   10281 </span><span class="lineNoCov">          0 : static int IOSA_Cancel(GGadget *g, GEvent *e) {</span>
<span class="lineNum">   10282 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">   10283 </span><span class="lineNoCov">          0 :         struct insertonsplineat *iosa = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">   10284 </span><span class="lineNoCov">          0 :         iosa-&gt;done = true;</span>
<span class="lineNum">   10285 </span>            :     }
<span class="lineNum">   10286 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="10287"><span class="lineNum">   10287 </span>            : }</a>
<span class="lineNum">   10288 </span>            : 
<span class="lineNum">   10289 </span><span class="lineNoCov">          0 : static int IOSA_FocusChange(GGadget *g, GEvent *e) {</span>
<span class="lineNum">   10290 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textfocuschanged ) {</span>
<span class="lineNum">   10291 </span><span class="lineNoCov">          0 :         struct insertonsplineat *iosa = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">   10292 </span><span class="lineNoCov">          0 :         int cid = (intpt) GGadgetGetUserData(g);</span>
<span class="lineNum">   10293 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(iosa-&gt;gw,cid),true);</span>
<span class="lineNum">   10294 </span>            :     }
<span class="lineNum">   10295 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="10296"><span class="lineNum">   10296 </span>            : }</a>
<span class="lineNum">   10297 </span>            : 
<span class="lineNum">   10298 </span><span class="lineNoCov">          0 : static int IOSA_RadioChange(GGadget *g, GEvent *e) {</span>
<span class="lineNum">   10299 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">   10300 </span><span class="lineNoCov">          0 :         struct insertonsplineat *iosa = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">   10301 </span><span class="lineNoCov">          0 :         int cid = (intpt) GGadgetGetUserData(g);</span>
<span class="lineNum">   10302 </span><span class="lineNoCov">          0 :         GWidgetIndicateFocusGadget(GWidgetGetControl(iosa-&gt;gw,cid));</span>
<span class="lineNum">   10303 </span><span class="lineNoCov">          0 :         GTextFieldSelect(GWidgetGetControl(iosa-&gt;gw,cid),0,-1);</span>
<span class="lineNum">   10304 </span>            :     }
<span class="lineNum">   10305 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="10306"><span class="lineNum">   10306 </span>            : }</a>
<span class="lineNum">   10307 </span>            : 
<span class="lineNum">   10308 </span><span class="lineNoCov">          0 : static int iosa_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">   10309 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">   10310 </span><span class="lineNoCov">          0 :         struct insertonsplineat *iosa = GDrawGetUserData(gw);</span>
<span class="lineNum">   10311 </span><span class="lineNoCov">          0 :         iosa-&gt;done = true;</span>
<span class="lineNum">   10312 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_char ) {</span>
<span class="lineNum">   10313 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">   10314 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_map ) {</span>
<span class="lineNum">   10315 </span>            :         /* Above palettes */
<span class="lineNum">   10316 </span><span class="lineNoCov">          0 :         GDrawRaise(gw);</span>
<span class="lineNum">   10317 </span>            :     }
<span class="lineNum">   10318 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="10319"><span class="lineNum">   10319 </span>            : }</a>
<span class="lineNum">   10320 </span>            : 
<span class="lineNum">   10321 </span><span class="lineNoCov">          0 : void _CVMenuInsertPt(CharView *cv) {</span>
<span class="lineNum">   10322 </span>            :     SplineSet *spl;
<span class="lineNum">   10323 </span><span class="lineNoCov">          0 :     Spline *s, *found=NULL, *first;</span>
<span class="lineNum">   10324 </span>            :     struct insertonsplineat iosa;
<span class="lineNum">   10325 </span>            :     GRect pos;
<span class="lineNum">   10326 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">   10327 </span>            :     GGadgetCreateData gcd[11], boxes[2], topbox[2], *hvs[13], *varray[8], *buttons[6];
<span class="lineNum">   10328 </span>            :     GTextInfo label[11];
<span class="lineNum">   10329 </span>            : 
<span class="lineNum">   10330 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">   10331 </span><span class="lineNoCov">          0 :         first = NULL;</span>
<span class="lineNum">   10332 </span><span class="lineNoCov">          0 :         for ( s=spl-&gt;first-&gt;next; s!=NULL &amp;&amp; s!=first ; s = s-&gt;to-&gt;next ) {</span>
<span class="lineNum">   10333 </span><span class="lineNoCov">          0 :             if ( first==NULL ) first=s;</span>
<span class="lineNum">   10334 </span><span class="lineNoCov">          0 :             if ( s-&gt;from-&gt;selected &amp;&amp; s-&gt;to-&gt;selected ) {</span>
<span class="lineNum">   10335 </span><span class="lineNoCov">          0 :                 if ( found!=NULL )</span>
<span class="lineNum">   10336 </span><span class="lineNoCov">          0 : return;         /* Can only work with one spline */</span>
<span class="lineNum">   10337 </span><span class="lineNoCov">          0 :                 found = s;</span>
<span class="lineNum">   10338 </span>            :             }
<span class="lineNum">   10339 </span>            :         }
<span class="lineNum">   10340 </span>            :     }
<span class="lineNum">   10341 </span><span class="lineNoCov">          0 :     if ( found==NULL )</span>
<span class="lineNum">   10342 </span><span class="lineNoCov">          0 : return;         /* Need a spline */</span>
<span class="lineNum">   10343 </span>            : 
<span class="lineNum">   10344 </span><span class="lineNoCov">          0 :     memset(&amp;iosa,0,sizeof(iosa));</span>
<span class="lineNum">   10345 </span><span class="lineNoCov">          0 :     iosa.s = found;</span>
<span class="lineNum">   10346 </span><span class="lineNoCov">          0 :     iosa.cv = cv;</span>
<span class="lineNum">   10347 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">   10348 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_isdlg|wam_restrict;</span>
<span class="lineNum">   10349 </span><span class="lineNoCov">          0 :     wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">   10350 </span><span class="lineNoCov">          0 :     wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">   10351 </span><span class="lineNoCov">          0 :     wattrs.undercursor = 1;</span>
<span class="lineNum">   10352 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_pointer;</span>
<span class="lineNum">   10353 </span><span class="lineNoCov">          0 :     wattrs.utf8_window_title = _(&quot;Insert a point on the given spline at either...&quot;);</span>
<span class="lineNum">   10354 </span><span class="lineNoCov">          0 :     wattrs.is_dlg = true;</span>
<span class="lineNum">   10355 </span><span class="lineNoCov">          0 :     pos.x = pos.y = 0;</span>
<span class="lineNum">   10356 </span><span class="lineNoCov">          0 :     pos.width = GGadgetScale(GDrawPointsToPixels(NULL,210));</span>
<span class="lineNum">   10357 </span><span class="lineNoCov">          0 :     pos.height = GDrawPointsToPixels(NULL,120);</span>
<span class="lineNum">   10358 </span><span class="lineNoCov">          0 :     iosa.gw = GDrawCreateTopWindow(NULL,&amp;pos,iosa_e_h,&amp;iosa,&amp;wattrs);</span>
<span class="lineNum">   10359 </span>            : 
<span class="lineNum">   10360 </span><span class="lineNoCov">          0 :     memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">   10361 </span><span class="lineNoCov">          0 :     memset(&amp;gcd,0,sizeof(gcd));</span>
<span class="lineNum">   10362 </span>            : 
<span class="lineNum">   10363 </span><span class="lineNoCov">          0 :     label[0].text = (unichar_t *) _(&quot;_X:&quot;);</span>
<span class="lineNum">   10364 </span><span class="lineNoCov">          0 :     label[0].text_is_1byte = true;</span>
<span class="lineNum">   10365 </span><span class="lineNoCov">          0 :     label[0].text_in_resource = true;</span>
<span class="lineNum">   10366 </span><span class="lineNoCov">          0 :     gcd[0].gd.label = &amp;label[0];</span>
<span class="lineNum">   10367 </span><span class="lineNoCov">          0 :     gcd[0].gd.pos.x = 5; gcd[0].gd.pos.y = 5;</span>
<span class="lineNum">   10368 </span><span class="lineNoCov">          0 :     gcd[0].gd.flags = gg_enabled|gg_visible|gg_cb_on;</span>
<span class="lineNum">   10369 </span><span class="lineNoCov">          0 :     gcd[0].gd.cid = CID_XR;</span>
<span class="lineNum">   10370 </span><span class="lineNoCov">          0 :     gcd[0].gd.handle_controlevent = IOSA_RadioChange;</span>
<span class="lineNum">   10371 </span><span class="lineNoCov">          0 :     gcd[0].data = (void *) CID_X;</span>
<span class="lineNum">   10372 </span><span class="lineNoCov">          0 :     gcd[0].creator = GRadioCreate;</span>
<span class="lineNum">   10373 </span>            : 
<span class="lineNum">   10374 </span><span class="lineNoCov">          0 :     label[1].text = (unichar_t *) _(&quot;_Y:&quot;);</span>
<span class="lineNum">   10375 </span><span class="lineNoCov">          0 :     label[1].text_is_1byte = true;</span>
<span class="lineNum">   10376 </span><span class="lineNoCov">          0 :     label[1].text_in_resource = true;</span>
<span class="lineNum">   10377 </span><span class="lineNoCov">          0 :     gcd[1].gd.label = &amp;label[1];</span>
<span class="lineNum">   10378 </span><span class="lineNoCov">          0 :     gcd[1].gd.pos.x = 5; gcd[1].gd.pos.y = 32;</span>
<span class="lineNum">   10379 </span><span class="lineNoCov">          0 :     gcd[1].gd.flags = gg_enabled|gg_visible|gg_rad_continueold ;</span>
<span class="lineNum">   10380 </span><span class="lineNoCov">          0 :     gcd[1].gd.cid = CID_YR;</span>
<span class="lineNum">   10381 </span><span class="lineNoCov">          0 :     gcd[1].gd.handle_controlevent = IOSA_RadioChange;</span>
<span class="lineNum">   10382 </span><span class="lineNoCov">          0 :     gcd[1].data = (void *) CID_Y;</span>
<span class="lineNum">   10383 </span><span class="lineNoCov">          0 :     gcd[1].creator = GRadioCreate;</span>
<span class="lineNum">   10384 </span>            : 
<span class="lineNum">   10385 </span><span class="lineNoCov">          0 :     gcd[2].gd.pos.x = 131; gcd[2].gd.pos.y = 5;  gcd[2].gd.pos.width = 60;</span>
<span class="lineNum">   10386 </span><span class="lineNoCov">          0 :     gcd[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">   10387 </span><span class="lineNoCov">          0 :     gcd[2].gd.cid = CID_X;</span>
<span class="lineNum">   10388 </span><span class="lineNoCov">          0 :     gcd[2].gd.handle_controlevent = IOSA_FocusChange;</span>
<span class="lineNum">   10389 </span><span class="lineNoCov">          0 :     gcd[2].data = (void *) CID_XR;</span>
<span class="lineNum">   10390 </span><span class="lineNoCov">          0 :     gcd[2].creator = GTextFieldCreate;</span>
<span class="lineNum">   10391 </span>            : 
<span class="lineNum">   10392 </span><span class="lineNoCov">          0 :     gcd[3].gd.pos.x = 131; gcd[3].gd.pos.y = 32;  gcd[3].gd.pos.width = 60;</span>
<span class="lineNum">   10393 </span><span class="lineNoCov">          0 :     gcd[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">   10394 </span><span class="lineNoCov">          0 :     gcd[3].gd.cid = CID_Y;</span>
<span class="lineNum">   10395 </span><span class="lineNoCov">          0 :     gcd[3].gd.handle_controlevent = IOSA_FocusChange;</span>
<span class="lineNum">   10396 </span><span class="lineNoCov">          0 :     gcd[3].data = (void *) CID_YR;</span>
<span class="lineNum">   10397 </span><span class="lineNoCov">          0 :     gcd[3].creator = GTextFieldCreate;</span>
<span class="lineNum">   10398 </span>            : 
<span class="lineNum">   10399 </span><span class="lineNoCov">          0 :     gcd[4].gd.pos.x = 20-3; gcd[4].gd.pos.y = 120-32-3;</span>
<span class="lineNum">   10400 </span><span class="lineNoCov">          0 :     gcd[4].gd.pos.width = -1; gcd[4].gd.pos.height = 0;</span>
<span class="lineNum">   10401 </span><span class="lineNoCov">          0 :     gcd[4].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">   10402 </span><span class="lineNoCov">          0 :     label[4].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">   10403 </span><span class="lineNoCov">          0 :     label[4].text_is_1byte = true;</span>
<span class="lineNum">   10404 </span><span class="lineNoCov">          0 :     label[4].text_in_resource = true;</span>
<span class="lineNum">   10405 </span><span class="lineNoCov">          0 :     gcd[4].gd.mnemonic = 'O';</span>
<span class="lineNum">   10406 </span><span class="lineNoCov">          0 :     gcd[4].gd.label = &amp;label[4];</span>
<span class="lineNum">   10407 </span><span class="lineNoCov">          0 :     gcd[4].gd.handle_controlevent = IOSA_OK;</span>
<span class="lineNum">   10408 </span><span class="lineNoCov">          0 :     gcd[4].creator = GButtonCreate;</span>
<span class="lineNum">   10409 </span>            : 
<span class="lineNum">   10410 </span><span class="lineNoCov">          0 :     gcd[5].gd.pos.x = -20; gcd[5].gd.pos.y = 120-32;</span>
<span class="lineNum">   10411 </span><span class="lineNoCov">          0 :     gcd[5].gd.pos.width = -1; gcd[5].gd.pos.height = 0;</span>
<span class="lineNum">   10412 </span><span class="lineNoCov">          0 :     gcd[5].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">   10413 </span><span class="lineNoCov">          0 :     label[5].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">   10414 </span><span class="lineNoCov">          0 :     label[5].text_is_1byte = true;</span>
<span class="lineNum">   10415 </span><span class="lineNoCov">          0 :     label[5].text_in_resource = true;</span>
<span class="lineNum">   10416 </span><span class="lineNoCov">          0 :     gcd[5].gd.label = &amp;label[5];</span>
<span class="lineNum">   10417 </span><span class="lineNoCov">          0 :     gcd[5].gd.mnemonic = 'C';</span>
<span class="lineNum">   10418 </span><span class="lineNoCov">          0 :     gcd[5].gd.handle_controlevent = IOSA_Cancel;</span>
<span class="lineNum">   10419 </span><span class="lineNoCov">          0 :     gcd[5].creator = GButtonCreate;</span>
<span class="lineNum">   10420 </span>            : 
<span class="lineNum">   10421 </span><span class="lineNoCov">          0 :     hvs[0] = &amp;gcd[0]; hvs[1] = &amp;gcd[2]; hvs[2] = NULL;</span>
<span class="lineNum">   10422 </span><span class="lineNoCov">          0 :     hvs[3] = &amp;gcd[1]; hvs[4] = &amp;gcd[3]; hvs[5] = NULL;</span>
<span class="lineNum">   10423 </span><span class="lineNoCov">          0 :     hvs[6] = NULL;</span>
<span class="lineNum">   10424 </span>            : 
<span class="lineNum">   10425 </span><span class="lineNoCov">          0 :     buttons[0] = buttons[2] = buttons[4] = GCD_Glue; buttons[5] = NULL;</span>
<span class="lineNum">   10426 </span><span class="lineNoCov">          0 :     buttons[1] = &amp;gcd[4]; buttons[3] = &amp;gcd[5];</span>
<span class="lineNum">   10427 </span>            : 
<span class="lineNum">   10428 </span><span class="lineNoCov">          0 :     varray[0] = &amp;boxes[1]; varray[1] = NULL;</span>
<span class="lineNum">   10429 </span><span class="lineNoCov">          0 :     varray[2] = GCD_Glue; varray[3] = NULL;</span>
<span class="lineNum">   10430 </span><span class="lineNoCov">          0 :     varray[4] = &amp;boxes[0]; varray[5] = NULL;</span>
<span class="lineNum">   10431 </span><span class="lineNoCov">          0 :     varray[6] = NULL;</span>
<span class="lineNum">   10432 </span>            : 
<span class="lineNum">   10433 </span><span class="lineNoCov">          0 :     memset(boxes,0,sizeof(boxes));</span>
<span class="lineNum">   10434 </span><span class="lineNoCov">          0 :     boxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">   10435 </span><span class="lineNoCov">          0 :     boxes[0].gd.u.boxelements = buttons;</span>
<span class="lineNum">   10436 </span><span class="lineNoCov">          0 :     boxes[0].creator = GHBoxCreate;</span>
<span class="lineNum">   10437 </span>            : 
<span class="lineNum">   10438 </span><span class="lineNoCov">          0 :     boxes[1].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">   10439 </span><span class="lineNoCov">          0 :     boxes[1].gd.u.boxelements = hvs;</span>
<span class="lineNum">   10440 </span><span class="lineNoCov">          0 :     boxes[1].creator = GHVBoxCreate;</span>
<span class="lineNum">   10441 </span>            : 
<span class="lineNum">   10442 </span><span class="lineNoCov">          0 :     memset(topbox,0,sizeof(topbox));</span>
<span class="lineNum">   10443 </span><span class="lineNoCov">          0 :     topbox[0].gd.pos.x = topbox[0].gd.pos.y = 2;</span>
<span class="lineNum">   10444 </span><span class="lineNoCov">          0 :     topbox[0].gd.pos.width = pos.width-4; topbox[0].gd.pos.height = pos.height-4;</span>
<span class="lineNum">   10445 </span><span class="lineNoCov">          0 :     topbox[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">   10446 </span><span class="lineNoCov">          0 :     topbox[0].gd.u.boxelements = varray;</span>
<span class="lineNum">   10447 </span><span class="lineNoCov">          0 :     topbox[0].creator = GHVGroupCreate;</span>
<span class="lineNum">   10448 </span>            : 
<span class="lineNum">   10449 </span>            : 
<span class="lineNum">   10450 </span><span class="lineNoCov">          0 :     GGadgetsCreate(iosa.gw,topbox);</span>
<span class="lineNum">   10451 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(topbox[0].ret,1);</span>
<span class="lineNum">   10452 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(boxes[0].ret,gb_expandgluesame);</span>
<span class="lineNum">   10453 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(boxes[1].ret,1);</span>
<span class="lineNum">   10454 </span><span class="lineNoCov">          0 :     GWidgetIndicateFocusGadget(GWidgetGetControl(iosa.gw,CID_X));</span>
<span class="lineNum">   10455 </span><span class="lineNoCov">          0 :     GTextFieldSelect(GWidgetGetControl(iosa.gw,CID_X),0,-1);</span>
<span class="lineNum">   10456 </span><span class="lineNoCov">          0 :     GHVBoxFitWindow(topbox[0].ret);</span>
<span class="lineNum">   10457 </span>            : 
<span class="lineNum">   10458 </span><span class="lineNoCov">          0 :     GDrawSetVisible(iosa.gw,true);</span>
<span class="lineNum">   10459 </span><span class="lineNoCov">          0 :     while ( !iosa.done )</span>
<span class="lineNum">   10460 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">   10461 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(iosa.gw);</span>
<a name="10462"><span class="lineNum">   10462 </span>            : }</a>
<span class="lineNum">   10463 </span>            : 
<span class="lineNum">   10464 </span><span class="lineNoCov">          0 : static void CVMenuInsertPt(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10465 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10466 </span><span class="lineNoCov">          0 :     _CVMenuInsertPt(cv);</span>
<a name="10467"><span class="lineNum">   10467 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10468 </span>            : 
<span class="lineNum">   10469 </span><span class="lineNoCov">          0 : static void _CVCenterCP(CharView *cv) {</span>
<span class="lineNum">   10470 </span>            :     SplinePointList *spl;
<span class="lineNum">   10471 </span>            :     SplinePoint *sp;
<span class="lineNum">   10472 </span><span class="lineNoCov">          0 :     int changed = false;</span>
<span class="lineNum">   10473 </span><span class="lineNoCov">          0 :     enum movething { mt_pt, mt_ncp, mt_pcp } movething = mt_pt;</span>
<span class="lineNum">   10474 </span>            : 
<span class="lineNum">   10475 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">   10476 </span><span class="lineNoCov">          0 :         for ( sp=spl-&gt;first; ; ) {</span>
<span class="lineNum">   10477 </span><span class="lineNoCov">          0 :             if ( sp-&gt;selected &amp;&amp; sp-&gt;prev!=NULL &amp;&amp; sp-&gt;next!=NULL &amp;&amp;</span>
<span class="lineNum">   10478 </span><span class="lineNoCov">          0 :                     !sp-&gt;noprevcp &amp;&amp; !sp-&gt;nonextcp ) {</span>
<span class="lineNum">   10479 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;me.x != (sp-&gt;nextcp.x+sp-&gt;prevcp.x)/2 ||</span>
<span class="lineNum">   10480 </span><span class="lineNoCov">          0 :                         sp-&gt;me.y != (sp-&gt;nextcp.y+sp-&gt;prevcp.y)/2 ) {</span>
<span class="lineNum">   10481 </span><span class="lineNoCov">          0 :                     if ( !changed ) {</span>
<span class="lineNum">   10482 </span><span class="lineNoCov">          0 :                         CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">   10483 </span><span class="lineNoCov">          0 :                         changed = true;</span>
<span class="lineNum">   10484 </span>            :                     }
<span class="lineNum">   10485 </span><span class="lineNoCov">          0 :                     switch ( movething ) {</span>
<span class="lineNum">   10486 </span>            :                       case mt_pt:
<span class="lineNum">   10487 </span><span class="lineNoCov">          0 :                         sp-&gt;me.x = (sp-&gt;nextcp.x+sp-&gt;prevcp.x)/2;</span>
<span class="lineNum">   10488 </span><span class="lineNoCov">          0 :                         sp-&gt;me.y = (sp-&gt;nextcp.y+sp-&gt;prevcp.y)/2;</span>
<span class="lineNum">   10489 </span><span class="lineNoCov">          0 :                         SplineRefigure(sp-&gt;prev);</span>
<span class="lineNum">   10490 </span><span class="lineNoCov">          0 :                         SplineRefigure(sp-&gt;next);</span>
<span class="lineNum">   10491 </span><span class="lineNoCov">          0 :                       break;</span>
<span class="lineNum">   10492 </span>            :                       case mt_ncp:
<span class="lineNum">   10493 </span><span class="lineNoCov">          0 :                         sp-&gt;nextcp.x = sp-&gt;me.x - (sp-&gt;prevcp.x-sp-&gt;me.x);</span>
<span class="lineNum">   10494 </span><span class="lineNoCov">          0 :                         sp-&gt;nextcp.y = sp-&gt;me.y - (sp-&gt;prevcp.y-sp-&gt;me.y);</span>
<span class="lineNum">   10495 </span><span class="lineNoCov">          0 :                         if ( sp-&gt;next-&gt;order2 ) {</span>
<span class="lineNum">   10496 </span><span class="lineNoCov">          0 :                             sp-&gt;next-&gt;to-&gt;prevcp = sp-&gt;nextcp;</span>
<span class="lineNum">   10497 </span><span class="lineNoCov">          0 :                             sp-&gt;next-&gt;to-&gt;noprevcp = false;</span>
<span class="lineNum">   10498 </span>            :                         }
<span class="lineNum">   10499 </span><span class="lineNoCov">          0 :                         SplineRefigure(sp-&gt;prev);</span>
<span class="lineNum">   10500 </span><span class="lineNoCov">          0 :                         SplineRefigureFixup(sp-&gt;next);</span>
<span class="lineNum">   10501 </span><span class="lineNoCov">          0 :                       break;</span>
<span class="lineNum">   10502 </span>            :                       case mt_pcp:
<span class="lineNum">   10503 </span><span class="lineNoCov">          0 :                         sp-&gt;prevcp.x = sp-&gt;me.x - (sp-&gt;nextcp.x-sp-&gt;me.x);</span>
<span class="lineNum">   10504 </span><span class="lineNoCov">          0 :                         sp-&gt;prevcp.y = sp-&gt;me.y - (sp-&gt;nextcp.y-sp-&gt;me.y);</span>
<span class="lineNum">   10505 </span><span class="lineNoCov">          0 :                         if ( sp-&gt;prev-&gt;order2 ) {</span>
<span class="lineNum">   10506 </span><span class="lineNoCov">          0 :                             sp-&gt;prev-&gt;from-&gt;nextcp = sp-&gt;prevcp;</span>
<span class="lineNum">   10507 </span><span class="lineNoCov">          0 :                             sp-&gt;prev-&gt;from-&gt;nonextcp = false;</span>
<span class="lineNum">   10508 </span>            :                         }
<span class="lineNum">   10509 </span><span class="lineNoCov">          0 :                         SplineRefigureFixup(sp-&gt;prev);</span>
<span class="lineNum">   10510 </span><span class="lineNoCov">          0 :                         SplineRefigure(sp-&gt;next);</span>
<span class="lineNum">   10511 </span><span class="lineNoCov">          0 :                       break;</span>
<span class="lineNum">   10512 </span>            :                     }
<span class="lineNum">   10513 </span>            :                 }
<span class="lineNum">   10514 </span>            :             }
<span class="lineNum">   10515 </span><span class="lineNoCov">          0 :             if ( sp-&gt;next==NULL )</span>
<span class="lineNum">   10516 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">   10517 </span><span class="lineNoCov">          0 :             sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">   10518 </span><span class="lineNoCov">          0 :             if ( sp==spl-&gt;first )</span>
<span class="lineNum">   10519 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">   10520 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">   10521 </span>            :     }
<span class="lineNum">   10522 </span>            : 
<span class="lineNum">   10523 </span><span class="lineNoCov">          0 :     if ( changed )</span>
<span class="lineNum">   10524 </span><span class="lineNoCov">          0 :         CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="10525"><span class="lineNum">   10525 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10526 </span>            : 
<span class="lineNum">   10527 </span><span class="lineNoCov">          0 : static void CVMenuCenterCP(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10528 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10529 </span><span class="lineNoCov">          0 :     _CVCenterCP(cv);</span>
<a name="10530"><span class="lineNum">   10530 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10531 </span>            : 
<span class="lineNum">   10532 </span><span class="lineNoCov">          0 : void CVMakeClipPath(CharView *cv) {</span>
<span class="lineNum">   10533 </span>            :     SplineSet *ss;
<span class="lineNum">   10534 </span>            :     SplinePoint *sp;
<span class="lineNum">   10535 </span>            :     int sel;
<span class="lineNum">   10536 </span><span class="lineNoCov">          0 :     int changed=false;</span>
<span class="lineNum">   10537 </span>            : 
<span class="lineNum">   10538 </span><span class="lineNoCov">          0 :     for ( ss=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; ss!=NULL; ss=ss-&gt;next ) {</span>
<span class="lineNum">   10539 </span><span class="lineNoCov">          0 :         sel = false;</span>
<span class="lineNum">   10540 </span><span class="lineNoCov">          0 :         for ( sp=ss-&gt;first; ; ) {</span>
<span class="lineNum">   10541 </span><span class="lineNoCov">          0 :             if ( sp-&gt;selected ) {</span>
<span class="lineNum">   10542 </span><span class="lineNoCov">          0 :                 sel = true;</span>
<span class="lineNum">   10543 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">   10544 </span>            :             }
<span class="lineNum">   10545 </span><span class="lineNoCov">          0 :             if ( sp-&gt;next==NULL )</span>
<span class="lineNum">   10546 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">   10547 </span><span class="lineNoCov">          0 :             sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">   10548 </span><span class="lineNoCov">          0 :             if ( sp==ss-&gt;first )</span>
<span class="lineNum">   10549 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">   10550 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">   10551 </span><span class="lineNoCov">          0 :         if ( sel!=ss-&gt;is_clip_path ) {</span>
<span class="lineNum">   10552 </span><span class="lineNoCov">          0 :             if ( !changed )</span>
<span class="lineNum">   10553 </span><span class="lineNoCov">          0 :                 CVPreserveState((CharViewBase *) cv);</span>
<span class="lineNum">   10554 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">   10555 </span><span class="lineNoCov">          0 :             ss-&gt;is_clip_path = sel;</span>
<span class="lineNum">   10556 </span>            :         }
<span class="lineNum">   10557 </span>            :     }
<span class="lineNum">   10558 </span><span class="lineNoCov">          0 :     if ( changed )</span>
<span class="lineNum">   10559 </span><span class="lineNoCov">          0 :         CVCharChangedUpdate((CharViewBase *) cv);</span>
<a name="10560"><span class="lineNum">   10560 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10561 </span>            : 
<span class="lineNum">   10562 </span><span class="lineNoCov">          0 : static void CVMenuClipPath(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10563 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10564 </span><span class="lineNoCov">          0 :     CVMakeClipPath(cv);</span>
<a name="10565"><span class="lineNum">   10565 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10566 </span>            : 
<span class="lineNum">   10567 </span><span class="lineNoCov">          0 : void CVAddAnchor(CharView *cv) {</span>
<span class="lineNum">   10568 </span>            :     int waslig;
<span class="lineNum">   10569 </span>            : 
<span class="lineNum">   10570 </span><span class="lineNoCov">          0 :     if ( AnchorClassUnused(cv-&gt;b.sc,&amp;waslig)==NULL ) {</span>
<span class="lineNum">   10571 </span><span class="lineNoCov">          0 :         SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">   10572 </span>            :         AnchorClass *ac;
<span class="lineNum">   10573 </span>            :         GTextInfo **ti;
<span class="lineNum">   10574 </span>            :         int j;
<span class="lineNum">   10575 </span><span class="lineNoCov">          0 :         char *name = gwwv_ask_string(_(&quot;Anchor Class Name&quot;),&quot;&quot;,_(&quot;Please enter the name of a Anchor point class to create&quot;));</span>
<span class="lineNum">   10576 </span><span class="lineNoCov">          0 :         if ( name==NULL )</span>
<span class="lineNum">   10577 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   10578 </span><span class="lineNoCov">          0 :         ac = SFFindOrAddAnchorClass(sf,name,NULL);</span>
<span class="lineNum">   10579 </span><span class="lineNoCov">          0 :         free(name);</span>
<span class="lineNum">   10580 </span><span class="lineNoCov">          0 :         if ( AnchorClassUnused(cv-&gt;b.sc,&amp;waslig)==NULL )</span>
<span class="lineNum">   10581 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   10582 </span>            :     }
<span class="lineNum">   10583 </span><span class="lineNoCov">          0 :     ApGetInfo(cv,NULL);</span>
<a name="10584"><span class="lineNum">   10584 </span>            : }</a>
<span class="lineNum">   10585 </span>            : 
<span class="lineNum">   10586 </span><span class="lineNoCov">          0 : static void CVMenuAddAnchor(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10587 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10588 </span><span class="lineNoCov">          0 :     CVAddAnchor(cv);</span>
<a name="10589"><span class="lineNum">   10589 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10590 </span>            : 
<span class="lineNum">   10591 </span><span class="lineNoCov">          0 : static void CVMenuAutotrace(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *e) {</span>
<span class="lineNum">   10592 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10593 </span>            :     GCursor ct;
<span class="lineNum">   10594 </span>            : 
<span class="lineNum">   10595 </span><span class="lineNoCov">          0 :     ct = GDrawGetCursor(cv-&gt;v);</span>
<span class="lineNum">   10596 </span><span class="lineNoCov">          0 :     GDrawSetCursor(cv-&gt;v,ct_watch);</span>
<span class="lineNum">   10597 </span><span class="lineNoCov">          0 :     ff_progress_allow_events();</span>
<span class="lineNum">   10598 </span><span class="lineNoCov">          0 :     SCAutoTrace(cv-&gt;b.sc,CVLayer((CharViewBase *) cv),e!=NULL &amp;&amp; (e-&gt;u.mouse.state&amp;ksm_shift));</span>
<span class="lineNum">   10599 </span><span class="lineNoCov">          0 :     GDrawSetCursor(cv-&gt;v,ct);</span>
<a name="10600"><span class="lineNum">   10600 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10601 </span>            : 
<span class="lineNum">   10602 </span><span class="lineNoCov">          0 : static void CVMenuBuildAccent(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10603 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10604 </span>            :     extern int onlycopydisplayed;
<span class="lineNum">   10605 </span><span class="lineNoCov">          0 :     int layer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">   10606 </span>            : 
<span class="lineNum">   10607 </span><span class="lineNoCov">          0 :     if ( SFIsRotatable(cv-&gt;b.fv-&gt;sf,cv-&gt;b.sc))</span>
<span class="lineNum">   10608 </span>            :         /* It's ok */;
<span class="lineNum">   10609 </span><span class="lineNoCov">          0 :     else if ( !SFIsSomethingBuildable(cv-&gt;b.fv-&gt;sf,cv-&gt;b.sc,layer,true) )</span>
<span class="lineNum">   10610 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   10611 </span><span class="lineNoCov">          0 :     SCBuildComposit(cv-&gt;b.fv-&gt;sf,cv-&gt;b.sc,layer,NULL,onlycopydisplayed);</span>
<a name="10612"><span class="lineNum">   10612 </span>            : }</a>
<span class="lineNum">   10613 </span>            : 
<span class="lineNum">   10614 </span><span class="lineNoCov">          0 : static void CVMenuBuildComposite(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10615 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10616 </span>            :     extern int onlycopydisplayed;
<span class="lineNum">   10617 </span><span class="lineNoCov">          0 :     int layer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">   10618 </span>            : 
<span class="lineNum">   10619 </span><span class="lineNoCov">          0 :     if ( SFIsRotatable(cv-&gt;b.fv-&gt;sf,cv-&gt;b.sc))</span>
<span class="lineNum">   10620 </span>            :         /* It's ok */;
<span class="lineNum">   10621 </span><span class="lineNoCov">          0 :     else if ( !SFIsCompositBuildable(cv-&gt;b.fv-&gt;sf,cv-&gt;b.sc-&gt;unicodeenc,cv-&gt;b.sc,layer) )</span>
<span class="lineNum">   10622 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   10623 </span><span class="lineNoCov">          0 :     SCBuildComposit(cv-&gt;b.fv-&gt;sf,cv-&gt;b.sc,layer,NULL,onlycopydisplayed);</span>
<a name="10624"><span class="lineNum">   10624 </span>            : }</a>
<span class="lineNum">   10625 </span>            : 
<span class="lineNum">   10626 </span><span class="lineNoCov">          0 : static void CVMenuReverseDir(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10627 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10628 </span><span class="lineNoCov">          0 :     int changed=false;</span>
<span class="lineNum">   10629 </span>            :     SplineSet *ss;
<span class="lineNum">   10630 </span>            : 
<span class="lineNum">   10631 </span><span class="lineNoCov">          0 :     for ( ss = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; ss!=NULL; ss=ss-&gt;next )</span>
<span class="lineNum">   10632 </span><span class="lineNoCov">          0 :         if ( PointListIsSelected(ss)) {</span>
<span class="lineNum">   10633 </span><span class="lineNoCov">          0 :             if ( !changed ) {</span>
<span class="lineNum">   10634 </span><span class="lineNoCov">          0 :                 CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">   10635 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">   10636 </span>            :             }
<span class="lineNum">   10637 </span><span class="lineNoCov">          0 :             SplineSetReverse(ss);</span>
<span class="lineNum">   10638 </span>            :         }
<span class="lineNum">   10639 </span>            : 
<span class="lineNum">   10640 </span><span class="lineNoCov">          0 :     if ( changed )</span>
<span class="lineNum">   10641 </span><span class="lineNoCov">          0 :         CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="10642"><span class="lineNum">   10642 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10643 </span>            : 
<span class="lineNum">   10644 </span><span class="lineNoCov">          0 : static void CVMenuCorrectDir(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10645 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10646 </span><span class="lineNoCov">          0 :     int changed=false, refchanged=false;</span>
<span class="lineNum">   10647 </span>            :     RefChar *ref;
<span class="lineNum">   10648 </span><span class="lineNoCov">          0 :     int asked=-1;</span>
<span class="lineNum">   10649 </span><span class="lineNoCov">          0 :     int layer = CVLayer( (CharViewBase *) cv);</span>
<span class="lineNum">   10650 </span>            : 
<span class="lineNum">   10651 </span><span class="lineNoCov">          0 :     for ( ref=cv-&gt;b.sc-&gt;layers[layer].refs; ref!=NULL; ref=ref-&gt;next ) {</span>
<span class="lineNum">   10652 </span><span class="lineNoCov">          0 :         if ( ref-&gt;transform[0]*ref-&gt;transform[3]&lt;0 ||</span>
<span class="lineNum">   10653 </span><span class="lineNoCov">          0 :                 (ref-&gt;transform[0]==0 &amp;&amp; ref-&gt;transform[1]*ref-&gt;transform[2]&gt;0)) {</span>
<span class="lineNum">   10654 </span><span class="lineNoCov">          0 :             if ( asked==-1 ) {</span>
<span class="lineNum">   10655 </span>            :                 char *buts[4];
<span class="lineNum">   10656 </span><span class="lineNoCov">          0 :                 buts[0] = _(&quot;_Unlink&quot;);</span>
<span class="lineNum">   10657 </span><span class="lineNoCov">          0 :                 buts[1] = _(&quot;_No&quot;);</span>
<span class="lineNum">   10658 </span><span class="lineNoCov">          0 :                 buts[2] = _(&quot;_Cancel&quot;);</span>
<span class="lineNum">   10659 </span><span class="lineNoCov">          0 :                 buts[3] = NULL;</span>
<span class="lineNum">   10660 </span><span class="lineNoCov">          0 :                 asked = gwwv_ask(_(&quot;Flipped Reference&quot;),(const char **) buts,0,2,_(&quot;%.50s contains a flipped reference. This cannot be corrected as is. Would you like me to unlink it and then correct it?&quot;), cv-&gt;b.sc-&gt;name );</span>
<span class="lineNum">   10661 </span><span class="lineNoCov">          0 :                 if ( asked==2 )</span>
<span class="lineNum">   10662 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   10663 </span><span class="lineNoCov">          0 :                 else if ( asked==1 )</span>
<span class="lineNum">   10664 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">   10665 </span>            :             }
<span class="lineNum">   10666 </span><span class="lineNoCov">          0 :             if ( asked==0 ) {</span>
<span class="lineNum">   10667 </span><span class="lineNoCov">          0 :                 if ( !refchanged ) {</span>
<span class="lineNum">   10668 </span><span class="lineNoCov">          0 :                     refchanged = true;</span>
<span class="lineNum">   10669 </span><span class="lineNoCov">          0 :                     CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">   10670 </span>            :                 }
<span class="lineNum">   10671 </span><span class="lineNoCov">          0 :                 SCRefToSplines(cv-&gt;b.sc,ref,layer);</span>
<span class="lineNum">   10672 </span>            :             }
<span class="lineNum">   10673 </span>            :         }
<span class="lineNum">   10674 </span>            :     }
<span class="lineNum">   10675 </span>            : 
<span class="lineNum">   10676 </span><span class="lineNoCov">          0 :     if ( !refchanged )</span>
<span class="lineNum">   10677 </span><span class="lineNoCov">          0 :         CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">   10678 </span>            : 
<span class="lineNum">   10679 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines = SplineSetsCorrect(cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines,&amp;changed);</span>
<span class="lineNum">   10680 </span><span class="lineNoCov">          0 :     if ( changed || refchanged )</span>
<span class="lineNum">   10681 </span><span class="lineNoCov">          0 :         CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<a name="10682"><span class="lineNum">   10682 </span>            : }</a>
<span class="lineNum">   10683 </span>            : 
<span class="lineNum">   10684 </span><span class="lineNoCov">          0 : static void CVMenuInsertText(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10685 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10686 </span><span class="lineNoCov">          0 :     InsertTextDlg(cv);</span>
<a name="10687"><span class="lineNum">   10687 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10688 </span>            : 
<span class="lineNum">   10689 </span><span class="lineNoCov">          0 : static void CVMenuGetInfo(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10690 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10691 </span><span class="lineNoCov">          0 :     CVGetInfo(cv);</span>
<a name="10692"><span class="lineNum">   10692 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10693 </span>            : 
<span class="lineNum">   10694 </span><span class="lineNoCov">          0 : static void CVMenuCharInfo(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10695 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10696 </span><span class="lineNoCov">          0 :     SCCharInfo(cv-&gt;b.sc,CVLayer((CharViewBase *) cv),cv-&gt;b.fv-&gt;map,CVCurEnc(cv));</span>
<a name="10697"><span class="lineNum">   10697 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10698 </span>            : 
<span class="lineNum">   10699 </span><span class="lineNoCov">          0 : static void CVMenuShowDependentRefs(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10700 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10701 </span><span class="lineNoCov">          0 :     SCRefBy(cv-&gt;b.sc);</span>
<a name="10702"><span class="lineNum">   10702 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10703 </span>            : 
<span class="lineNum">   10704 </span><span class="lineNoCov">          0 : static void CVMenuShowDependentSubs(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10705 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10706 </span><span class="lineNoCov">          0 :     SCSubBy(cv-&gt;b.sc);</span>
<a name="10707"><span class="lineNum">   10707 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10708 </span>            : 
<span class="lineNum">   10709 </span><span class="lineNoCov">          0 : static void CVMenuBitmaps(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10710 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10711 </span><span class="lineNoCov">          0 :     BitmapDlg((FontView *) (cv-&gt;b.fv),cv-&gt;b.sc,mi-&gt;mid==MID_RemoveBitmaps?-1: (mi-&gt;mid==MID_AvailBitmaps) );</span>
<a name="10712"><span class="lineNum">   10712 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10713 </span>            : 
<span class="lineNum">   10714 </span><span class="lineNoCov">          0 : static void cv_allistcheck(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">   10715 </span><span class="lineNoCov">          0 :     int selpoints = 0;</span>
<span class="lineNum">   10716 </span>            :     SplinePointList *spl;
<span class="lineNum">   10717 </span><span class="lineNoCov">          0 :     SplinePoint *sp=NULL;</span>
<span class="lineNum">   10718 </span>            : 
<span class="lineNum">   10719 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">   10720 </span><span class="lineNoCov">          0 :         sp=spl-&gt;first;</span>
<span class="lineNum">   10721 </span>            :         while ( 1 ) {
<span class="lineNum">   10722 </span><span class="lineNoCov">          0 :             if ( sp-&gt;selected )</span>
<span class="lineNum">   10723 </span><span class="lineNoCov">          0 :                 ++selpoints;</span>
<span class="lineNum">   10724 </span><span class="lineNoCov">          0 :             if ( sp-&gt;next==NULL )</span>
<span class="lineNum">   10725 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">   10726 </span><span class="lineNoCov">          0 :             sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">   10727 </span><span class="lineNoCov">          0 :             if ( sp==spl-&gt;first )</span>
<span class="lineNum">   10728 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">   10729 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">   10730 </span>            :     }
<span class="lineNum">   10731 </span>            : 
<span class="lineNum">   10732 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   10733 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   10734 </span>            :           case MID_Average:
<span class="lineNum">   10735 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = selpoints&lt;2;</span>
<span class="lineNum">   10736 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10737 </span>            :           case MID_SpacePts:
<span class="lineNum">   10738 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = ((selpoints&lt;3) &amp;&amp; (selpoints!=1));</span>
<span class="lineNum">   10739 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10740 </span>            :           case MID_SpaceRegion:
<span class="lineNum">   10741 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = selpoints&lt;3;</span>
<span class="lineNum">   10742 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10743 </span>            :           case MID_MakeParallel:
<span class="lineNum">   10744 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = selpoints!=4;</span>
<span class="lineNum">   10745 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10746 </span>            :         }
<span class="lineNum">   10747 </span>            :     }
<a name="10748"><span class="lineNum">   10748 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10749 </span>            : 
<span class="lineNum">   10750 </span><span class="lineNoCov">          0 : static void allistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10751 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10752 </span><span class="lineNoCov">          0 :     cv_allistcheck(cv, mi);</span>
<a name="10753"><span class="lineNum">   10753 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10754 </span>            : 
<span class="lineNum">   10755 </span><span class="lineNoCov">          0 : static void cv_balistcheck(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">   10756 </span><span class="lineNoCov">          0 :     int layer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">   10757 </span>            : 
<span class="lineNum">   10758 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   10759 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   10760 </span>            :           case MID_BuildAccent:
<span class="lineNum">   10761 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !SFIsSomethingBuildable(cv-&gt;b.fv-&gt;sf,cv-&gt;b.sc,layer,true);</span>
<span class="lineNum">   10762 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10763 </span>            :           case MID_BuildComposite:
<span class="lineNum">   10764 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !SFIsSomethingBuildable(cv-&gt;b.fv-&gt;sf,cv-&gt;b.sc,layer,false);</span>
<span class="lineNum">   10765 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10766 </span>            :         }
<span class="lineNum">   10767 </span>            :     }
<a name="10768"><span class="lineNum">   10768 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10769 </span>            : 
<span class="lineNum">   10770 </span><span class="lineNoCov">          0 : static void balistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10771 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10772 </span><span class="lineNoCov">          0 :     cv_balistcheck(cv, mi);</span>
<a name="10773"><span class="lineNum">   10773 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10774 </span>            : 
<span class="lineNum">   10775 </span><span class="lineNoCov">          0 : static void delistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10776 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10777 </span>            : 
<span class="lineNum">   10778 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   10779 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   10780 </span>            :           case MID_ShowDependentRefs:
<span class="lineNum">   10781 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.sc-&gt;dependents==NULL;</span>
<span class="lineNum">   10782 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10783 </span>            :           case MID_ShowDependentSubs:
<span class="lineNum">   10784 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !SCUsedBySubs(cv-&gt;b.sc);</span>
<span class="lineNum">   10785 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10786 </span>            :         }
<span class="lineNum">   10787 </span>            :     }
<a name="10788"><span class="lineNum">   10788 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10789 </span>            : 
<span class="lineNum">   10790 </span><span class="lineNoCov">          0 : static void rndlistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10791 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10792 </span>            : 
<span class="lineNum">   10793 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   10794 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   10795 </span>            :           case MID_RoundToCluster:
<span class="lineNum">   10796 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro();</span>
<span class="lineNum">   10797 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10798 </span>            :         }
<span class="lineNum">   10799 </span>            :     }
<a name="10800"><span class="lineNum">   10800 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10801 </span>            : 
<span class="lineNum">   10802 </span><span class="lineNoCov">          0 : static void cv_ellistcheck(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">   10803 </span><span class="lineNoCov">          0 :     int anypoints = 0, splinepoints, dir = -2;</span>
<span class="lineNum">   10804 </span><span class="lineNoCov">          0 :     int self_intersects=-2;</span>
<span class="lineNum">   10805 </span>            :     SplinePointList *spl;
<span class="lineNum">   10806 </span>            :     Spline *spline, *first;
<span class="lineNum">   10807 </span>            :     AnchorPoint *ap;
<span class="lineNum">   10808 </span>            :     spiro_cp *cp;
<span class="lineNum">   10809 </span>            :     int i;
<span class="lineNum">   10810 </span>            : 
<span class="lineNum">   10811 </span>            : #ifdef FONTFORGE_CONFIG_TILEPATH
<span class="lineNum">   10812 </span>            :     int badsel = false;
<span class="lineNum">   10813 </span>            :     RefChar *ref;
<span class="lineNum">   10814 </span>            :     ImageList *il;
<span class="lineNum">   10815 </span>            : 
<span class="lineNum">   10816 </span>            :     for ( ref=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs; ref!=NULL; ref=ref-&gt;next )
<span class="lineNum">   10817 </span>            :         if ( ref-&gt;selected )
<span class="lineNum">   10818 </span>            :             badsel = true;
<span class="lineNum">   10819 </span>            : 
<span class="lineNum">   10820 </span>            :     for ( il=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images; il!=NULL; il=il-&gt;next )
<span class="lineNum">   10821 </span>            :         if ( il-&gt;selected )
<span class="lineNum">   10822 </span>            :             badsel = true;
<span class="lineNum">   10823 </span>            : #endif
<span class="lineNum">   10824 </span>            : 
<span class="lineNum">   10825 </span><span class="lineNoCov">          0 :     if ( cv-&gt;checkselfintersects ) {</span>
<span class="lineNum">   10826 </span>            :         Spline *s, *s2;
<span class="lineNum">   10827 </span>            :         SplineSet *ss;
<span class="lineNum">   10828 </span><span class="lineNoCov">          0 :         ss = LayerAllSplines(cv-&gt;b.layerheads[cv-&gt;b.drawmode]);</span>
<span class="lineNum">   10829 </span><span class="lineNoCov">          0 :         self_intersects = SplineSetIntersect(ss,&amp;s,&amp;s2);</span>
<span class="lineNum">   10830 </span><span class="lineNoCov">          0 :         LayerUnAllSplines(cv-&gt;b.layerheads[cv-&gt;b.drawmode]);</span>
<span class="lineNum">   10831 </span>            :     }
<span class="lineNum">   10832 </span>            : 
<span class="lineNum">   10833 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">   10834 </span><span class="lineNoCov">          0 :         first = NULL;</span>
<span class="lineNum">   10835 </span><span class="lineNoCov">          0 :         splinepoints = 0;</span>
<span class="lineNum">   10836 </span><span class="lineNoCov">          0 :         if ( cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro()) {</span>
<span class="lineNum">   10837 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;spl-&gt;spiro_cnt-1; ++i ) {</span>
<span class="lineNum">   10838 </span><span class="lineNoCov">          0 :                 if ( SPIRO_SELECTED(&amp;spl-&gt;spiros[i])) {</span>
<span class="lineNum">   10839 </span><span class="lineNoCov">          0 :                     splinepoints = 1;</span>
<span class="lineNum">   10840 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">   10841 </span>            :                 }
<span class="lineNum">   10842 </span>            :             }
<span class="lineNum">   10843 </span>            :         } else {
<span class="lineNum">   10844 </span><span class="lineNoCov">          0 :             if ( spl-&gt;first-&gt;selected ) { splinepoints = 1; }</span>
<span class="lineNum">   10845 </span><span class="lineNoCov">          0 :             for ( spline=spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first &amp;&amp; !splinepoints; spline = spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">   10846 </span><span class="lineNoCov">          0 :                 if ( spline-&gt;to-&gt;selected ) { ++splinepoints; }</span>
<span class="lineNum">   10847 </span><span class="lineNoCov">          0 :                 if ( first == NULL ) first = spline;</span>
<span class="lineNum">   10848 </span>            :             }
<span class="lineNum">   10849 </span>            :         }
<span class="lineNum">   10850 </span><span class="lineNoCov">          0 :         if ( splinepoints ) {</span>
<span class="lineNum">   10851 </span><span class="lineNoCov">          0 :             anypoints += splinepoints;</span>
<span class="lineNum">   10852 </span><span class="lineNoCov">          0 :             if ( dir==-1 )</span>
<span class="lineNum">   10853 </span>            :                 /* Do nothing */;
<span class="lineNum">   10854 </span><span class="lineNoCov">          0 :             else if ( spl-&gt;first!=spl-&gt;last || spl-&gt;first-&gt;next==NULL ) {</span>
<span class="lineNum">   10855 </span><span class="lineNoCov">          0 :                 if ( dir==-2 || dir==2 )</span>
<span class="lineNum">   10856 </span><span class="lineNoCov">          0 :                     dir = 2;    /* Not a closed path, no direction */</span>
<span class="lineNum">   10857 </span>            :                 else
<span class="lineNum">   10858 </span><span class="lineNoCov">          0 :                     dir = -1;</span>
<span class="lineNum">   10859 </span><span class="lineNoCov">          0 :             } else if ( dir==-2 )</span>
<span class="lineNum">   10860 </span><span class="lineNoCov">          0 :                 dir = SplinePointListIsClockwise(spl);</span>
<span class="lineNum">   10861 </span><span class="lineNoCov">          0 :                 if ( dir==-1 )</span>
<span class="lineNum">   10862 </span><span class="lineNoCov">          0 :                     self_intersects = 1;        /* Sometimes the clockwise test finds intersections the main routine can't */</span>
<span class="lineNum">   10863 </span>            :             else {
<span class="lineNum">   10864 </span><span class="lineNoCov">          0 :                 int subdir = SplinePointListIsClockwise(spl);</span>
<span class="lineNum">   10865 </span><span class="lineNoCov">          0 :                 if ( subdir==-1 )</span>
<span class="lineNum">   10866 </span><span class="lineNoCov">          0 :                     self_intersects = 1;</span>
<span class="lineNum">   10867 </span><span class="lineNoCov">          0 :                 if ( subdir!=dir )</span>
<span class="lineNum">   10868 </span><span class="lineNoCov">          0 :                     dir = -1;</span>
<span class="lineNum">   10869 </span>            :             }
<span class="lineNum">   10870 </span>            :         }
<span class="lineNum">   10871 </span>            :     }
<span class="lineNum">   10872 </span>            : 
<span class="lineNum">   10873 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   10874 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   10875 </span>            :           case MID_FontInfo: case MID_CharInfo: case MID_ShowDependentRefs:
<span class="lineNum">   10876 </span>            :           case MID_FindProblems:
<span class="lineNum">   10877 </span>            :           case MID_AvailBitmaps:
<span class="lineNum">   10878 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.container!=NULL;</span>
<span class="lineNum">   10879 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10880 </span>            :           case MID_GetInfo:
<span class="lineNum">   10881 </span>            :             {
<span class="lineNum">   10882 </span>            :                 SplinePoint *sp; SplineSet *spl; RefChar *ref; ImageList *img;
<span class="lineNum">   10883 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.disabled = !CVOneThingSel(cv,&amp;sp,&amp;spl,&amp;ref,&amp;img,&amp;ap,&amp;cp);</span>
<span class="lineNum">   10884 </span>            :             }
<span class="lineNum">   10885 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10886 </span>            :           case MID_CheckSelf:
<span class="lineNum">   10887 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;checkselfintersects;</span>
<span class="lineNum">   10888 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10889 </span>            :           case MID_GlyphSelfIntersects:
<span class="lineNum">   10890 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;checkselfintersects;</span>
<span class="lineNum">   10891 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = self_intersects==1;</span>
<span class="lineNum">   10892 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10893 </span>            :           case MID_Clockwise:
<span class="lineNum">   10894 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !anypoints || dir==2 || dir&lt;0;</span>
<span class="lineNum">   10895 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = dir==1;</span>
<span class="lineNum">   10896 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10897 </span>            :           case MID_Counter:
<span class="lineNum">   10898 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !anypoints || dir==2 || dir&lt;0;</span>
<span class="lineNum">   10899 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = dir==0;</span>
<span class="lineNum">   10900 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10901 </span>            :           case MID_Correct:
<span class="lineNum">   10902 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = (cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL &amp;&amp; cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs==NULL) ||</span>
<span class="lineNum">   10903 </span><span class="lineNoCov">          0 :                     dir==2 || self_intersects==1;</span>
<span class="lineNum">   10904 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10905 </span>            :           case MID_ReverseDir:
<span class="lineNum">   10906 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !anypoints;</span>
<span class="lineNum">   10907 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10908 </span>            :           case MID_Stroke:
<span class="lineNum">   10909 </span>            :           case MID_RmOverlap:
<span class="lineNum">   10910 </span>            :           case MID_Styles:
<span class="lineNum">   10911 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL ||</span>
<span class="lineNum">   10912 </span><span class="lineNoCov">          0 :                                 cv-&gt;b.container!=NULL;</span>
<span class="lineNum">   10913 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10914 </span>            : #ifdef FONTFORGE_CONFIG_TILEPATH
<span class="lineNum">   10915 </span>            :           case MID_TilePath:
<span class="lineNum">   10916 </span>            :             mi-&gt;ti.disabled = badsel;
<span class="lineNum">   10917 </span>            :           break;
<span class="lineNum">   10918 </span>            : #endif
<span class="lineNum">   10919 </span>            :           case MID_RegenBitmaps: case MID_RemoveBitmaps:
<span class="lineNum">   10920 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.fv-&gt;sf-&gt;bitmaps==NULL;</span>
<span class="lineNum">   10921 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10922 </span>            :           case MID_AddExtrema:
<span class="lineNum">   10923 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL || (cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro());</span>
<span class="lineNum">   10924 </span>            :           /* Like Simplify, always available, but may not do anything if */
<span class="lineNum">   10925 </span>            :           /*  all extrema have points. I'm not going to check for that, too hard */
<span class="lineNum">   10926 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10927 </span>            :           case MID_Simplify:
<span class="lineNum">   10928 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL || (cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro());</span>
<span class="lineNum">   10929 </span>            :           /* Simplify is always available (it may not do anything though) */
<span class="lineNum">   10930 </span>            :           /*  well, ok. Disable it if there is absolutely nothing to work on */
<span class="lineNum">   10931 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10932 </span>            :           case MID_BuildAccent:
<span class="lineNum">   10933 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !SFIsSomethingBuildable(cv-&gt;b.fv-&gt;sf,cv-&gt;b.sc,</span>
<span class="lineNum">   10934 </span>            :                     CVLayer((CharViewBase *) cv),false);
<span class="lineNum">   10935 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10936 </span>            :           case MID_Autotrace:
<span class="lineNum">   10937 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = FindAutoTraceName()==NULL || cv-&gt;b.sc-&gt;layers[ly_back].images==NULL;</span>
<span class="lineNum">   10938 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10939 </span>            :           case MID_Align:
<span class="lineNum">   10940 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro();</span>
<span class="lineNum">   10941 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   10942 </span>            :         }
<span class="lineNum">   10943 </span>            :     }
<a name="10944"><span class="lineNum">   10944 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10945 </span>            : 
<span class="lineNum">   10946 </span><span class="lineNoCov">          0 : static void ellistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10947 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10948 </span><span class="lineNoCov">          0 :     cv_ellistcheck(cv, mi);</span>
<a name="10949"><span class="lineNum">   10949 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10950 </span>            : 
<span class="lineNum">   10951 </span><span class="lineNoCov">          0 : static void CVMenuAutoHint(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10952 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10953 </span>            :     /*int removeOverlap = e==NULL || !(e-&gt;u.mouse.state&amp;ksm_shift);*/
<span class="lineNum">   10954 </span><span class="lineNoCov">          0 :     int was = cv-&gt;b.sc-&gt;changedsincelasthinted;</span>
<span class="lineNum">   10955 </span>            : 
<span class="lineNum">   10956 </span>            :     /* Hint undoes are done in _SplineCharAutoHint */
<span class="lineNum">   10957 </span><span class="lineNoCov">          0 :     cv-&gt;b.sc-&gt;manualhints = false;</span>
<span class="lineNum">   10958 </span><span class="lineNoCov">          0 :     SplineCharAutoHint(cv-&gt;b.sc,CVLayer((CharViewBase *) cv),NULL);</span>
<span class="lineNum">   10959 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<span class="lineNum">   10960 </span><span class="lineNoCov">          0 :     if ( was ) {</span>
<span class="lineNum">   10961 </span>            :         FontView *fvs;
<span class="lineNum">   10962 </span><span class="lineNoCov">          0 :         for ( fvs=(FontView *) (cv-&gt;b.fv); fvs!=NULL; fvs=(FontView *) (fvs-&gt;b.nextsame) )</span>
<span class="lineNum">   10963 </span><span class="lineNoCov">          0 :             GDrawRequestExpose(fvs-&gt;v,NULL,false);   /* Clear any changedsincelasthinted marks */</span>
<span class="lineNum">   10964 </span>            :     }
<a name="10965"><span class="lineNum">   10965 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10966 </span>            : 
<span class="lineNum">   10967 </span><span class="lineNoCov">          0 : static void CVMenuAutoHintSubs(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10968 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10969 </span><span class="lineNoCov">          0 :     SCFigureHintMasks(cv-&gt;b.sc,CVLayer((CharViewBase *) cv));</span>
<span class="lineNum">   10970 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<a name="10971"><span class="lineNum">   10971 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10972 </span>            : 
<span class="lineNum">   10973 </span><span class="lineNoCov">          0 : static void CVMenuAutoCounter(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10974 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10975 </span><span class="lineNoCov">          0 :     SCFigureCounterMasks(cv-&gt;b.sc);</span>
<a name="10976"><span class="lineNum">   10976 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10977 </span>            : 
<span class="lineNum">   10978 </span><span class="lineNoCov">          0 : static void CVMenuDontAutoHint(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10979 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10980 </span><span class="lineNoCov">          0 :     cv-&gt;b.sc-&gt;manualhints = !cv-&gt;b.sc-&gt;manualhints;</span>
<a name="10981"><span class="lineNum">   10981 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10982 </span>            : 
<span class="lineNum">   10983 </span><span class="lineNoCov">          0 : static void CVMenuNowakAutoInstr(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   10984 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   10985 </span><span class="lineNoCov">          0 :     SplineChar *sc = cv-&gt;b.sc;</span>
<span class="lineNum">   10986 </span>            :     GlobalInstrCt gic;
<span class="lineNum">   10987 </span>            : 
<span class="lineNum">   10988 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines!=NULL &amp;&amp; sc-&gt;hstem==NULL &amp;&amp; sc-&gt;vstem==NULL</span>
<span class="lineNum">   10989 </span><span class="lineNoCov">          0 :             &amp;&amp; sc-&gt;dstem==NULL &amp;&amp; !no_windowing_ui )</span>
<span class="lineNum">   10990 </span><span class="lineNoCov">          0 :         ff_post_notice(_(&quot;Things could be better...&quot;), _(&quot;Glyph, %s, has no hints. FontForge will not produce many instructions.&quot;),</span>
<span class="lineNum">   10991 </span>            :                 sc-&gt;name );
<span class="lineNum">   10992 </span>            : 
<span class="lineNum">   10993 </span><span class="lineNoCov">          0 :     InitGlobalInstrCt(&amp;gic, sc-&gt;parent, CVLayer((CharViewBase *) cv), NULL);</span>
<span class="lineNum">   10994 </span><span class="lineNoCov">          0 :     NowakowskiSCAutoInstr(&amp;gic, sc);</span>
<span class="lineNum">   10995 </span><span class="lineNoCov">          0 :     FreeGlobalInstrCt(&amp;gic);</span>
<span class="lineNum">   10996 </span><span class="lineNoCov">          0 :     SCUpdateAll(sc);</span>
<a name="10997"><span class="lineNum">   10997 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   10998 </span>            : 
<span class="lineNum">   10999 </span><span class="lineNoCov">          0 : static void CVMenuClearHints(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11000 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11001 </span>            : 
<span class="lineNum">   11002 </span><span class="lineNoCov">          0 :     SCPreserveHints(cv-&gt;b.sc,CVLayer((CharViewBase *) cv));</span>
<span class="lineNum">   11003 </span><span class="lineNoCov">          0 :     SCHintsChanged(cv-&gt;b.sc);</span>
<span class="lineNum">   11004 </span><span class="lineNoCov">          0 :     if ( mi-&gt;mid==MID_ClearHStem ) {</span>
<span class="lineNum">   11005 </span><span class="lineNoCov">          0 :         StemInfosFree(cv-&gt;b.sc-&gt;hstem);</span>
<span class="lineNum">   11006 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;hstem = NULL;</span>
<span class="lineNum">   11007 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;hconflicts = false;</span>
<span class="lineNum">   11008 </span><span class="lineNoCov">          0 :     } else if ( mi-&gt;mid==MID_ClearVStem ) {</span>
<span class="lineNum">   11009 </span><span class="lineNoCov">          0 :         StemInfosFree(cv-&gt;b.sc-&gt;vstem);</span>
<span class="lineNum">   11010 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;vstem = NULL;</span>
<span class="lineNum">   11011 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;vconflicts = false;</span>
<span class="lineNum">   11012 </span><span class="lineNoCov">          0 :     } else if ( mi-&gt;mid==MID_ClearDStem ) {</span>
<span class="lineNum">   11013 </span><span class="lineNoCov">          0 :         DStemInfosFree(cv-&gt;b.sc-&gt;dstem);</span>
<span class="lineNum">   11014 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;dstem = NULL;</span>
<span class="lineNum">   11015 </span>            :     }
<span class="lineNum">   11016 </span><span class="lineNoCov">          0 :     cv-&gt;b.sc-&gt;manualhints = true;</span>
<span class="lineNum">   11017 </span>            : 
<span class="lineNum">   11018 </span><span class="lineNoCov">          0 :     if ( mi-&gt;mid != MID_ClearDStem ) {</span>
<span class="lineNum">   11019 </span><span class="lineNoCov">          0 :         SCClearHintMasks(cv-&gt;b.sc,CVLayer((CharViewBase *) cv),true);</span>
<span class="lineNum">   11020 </span>            :     }
<span class="lineNum">   11021 </span><span class="lineNoCov">          0 :     SCOutOfDateBackground(cv-&gt;b.sc);</span>
<span class="lineNum">   11022 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<span class="lineNum">   11023 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   11024 </span>            : 
<span class="lineNum">   11025 </span>            : /* This is an improved version of the older CVTwoForePointsSelected function. */
<span class="lineNum">   11026 </span>            : /* Unlike the former, it doesn't just check if there are exactly two points   */
<span class="lineNum">   11027 </span>            : /* selected, but rather returns the number of selected points (whatever this  */
<span class="lineNum">   11028 </span>            : /* number can be) and puts references to those points into an array. It is up */
<span class="lineNum">   11029 </span>            : /* to the calling code to see if the returned result is satisfiable (there    */
<a name="11030"><span class="lineNum">   11030 </span>            : /* should be exactly two points selected for specifying a vertical or         */</a>
<span class="lineNum">   11031 </span>            : /* horizontal stem and four points for a diagonal stem). */
<span class="lineNum">   11032 </span><span class="lineNoCov">          0 : static int CVNumForePointsSelected(CharView *cv, BasePoint **bp) {</span>
<span class="lineNum">   11033 </span>            :     SplineSet *spl;
<span class="lineNum">   11034 </span>            :     SplinePoint *test, *first;
<span class="lineNum">   11035 </span>            :     BasePoint *bps[5];
<span class="lineNum">   11036 </span>            :     int i, cnt;
<span class="lineNum">   11037 </span>            : 
<span class="lineNum">   11038 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.drawmode!=dm_fore )</span>
<span class="lineNum">   11039 </span><span class="lineNoCov">          0 : return( 0 ) ;</span>
<span class="lineNum">   11040 </span><span class="lineNoCov">          0 :     cnt = 0;</span>
<span class="lineNum">   11041 </span><span class="lineNoCov">          0 :     for ( spl = cv-&gt;b.sc-&gt;layers[ly_fore].splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">   11042 </span><span class="lineNoCov">          0 :         first = NULL;</span>
<span class="lineNum">   11043 </span><span class="lineNoCov">          0 :         for ( test = spl-&gt;first; test!=first; test = test-&gt;next-&gt;to ) {</span>
<span class="lineNum">   11044 </span><span class="lineNoCov">          0 :             if ( test-&gt;selected ) {</span>
<span class="lineNum">   11045 </span><span class="lineNoCov">          0 :                 bps[cnt++] = &amp;(test-&gt;me);</span>
<span class="lineNum">   11046 </span><span class="lineNoCov">          0 :                 if ( cnt&gt;4 )</span>
<span class="lineNum">   11047 </span><span class="lineNoCov">          0 : return( 0 );</span>
<span class="lineNum">   11048 </span>            :             }
<span class="lineNum">   11049 </span><span class="lineNoCov">          0 :             if ( first == NULL ) first = test;</span>
<span class="lineNum">   11050 </span><span class="lineNoCov">          0 :             if ( test-&gt;next==NULL )</span>
<span class="lineNum">   11051 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">   11052 </span>            :         }
<span class="lineNum">   11053 </span>            :     }
<span class="lineNum">   11054 </span><span class="lineNoCov">          0 :     for (i=0; i&lt;cnt; i++) {</span>
<span class="lineNum">   11055 </span><span class="lineNoCov">          0 :         bp[i] = bps[i];</span>
<span class="lineNum">   11056 </span>            :     }
<span class="lineNum">   11057 </span><span class="lineNoCov">          0 : return( cnt );</span>
<a name="11058"><span class="lineNum">   11058 </span>            : }</a>
<span class="lineNum">   11059 </span>            : 
<span class="lineNum">   11060 </span><span class="lineNoCov">          0 : static void CVMenuAddHint(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11061 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11062 </span>            :     BasePoint *bp[4], unit;
<span class="lineNum">   11063 </span><span class="lineNoCov">          0 :     StemInfo *h=NULL;</span>
<span class="lineNum">   11064 </span>            :     DStemInfo *d;
<span class="lineNum">   11065 </span>            :     int num;
<span class="lineNum">   11066 </span><span class="lineNoCov">          0 :     int layer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">   11067 </span>            : 
<span class="lineNum">   11068 </span><span class="lineNoCov">          0 :     num = CVNumForePointsSelected( cv,bp );</span>
<span class="lineNum">   11069 </span>            : 
<span class="lineNum">   11070 </span>            :     /* We need exactly 2 points to specify a horizontal or vertical stem */
<span class="lineNum">   11071 </span>            :     /* and exactly 4 points to specify a diagonal stem */
<span class="lineNum">   11072 </span><span class="lineNoCov">          0 :     if ( !(num == 2 &amp;&amp; mi-&gt;mid != MID_AddDHint) &amp;&amp;</span>
<span class="lineNum">   11073 </span><span class="lineNoCov">          0 :          !(num == 4 &amp;&amp; mi-&gt;mid == MID_AddDHint))</span>
<span class="lineNum">   11074 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   11075 </span>            : 
<span class="lineNum">   11076 </span><span class="lineNoCov">          0 :     SCPreserveHints(cv-&gt;b.sc,CVLayer((CharViewBase *) cv));</span>
<span class="lineNum">   11077 </span><span class="lineNoCov">          0 :     SCHintsChanged(cv-&gt;b.sc);</span>
<span class="lineNum">   11078 </span><span class="lineNoCov">          0 :     if ( mi-&gt;mid==MID_AddHHint ) {</span>
<span class="lineNum">   11079 </span><span class="lineNoCov">          0 :         if ( bp[0]-&gt;y==bp[1]-&gt;y )</span>
<span class="lineNum">   11080 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   11081 </span><span class="lineNoCov">          0 :         h = chunkalloc(sizeof(StemInfo));</span>
<span class="lineNum">   11082 </span><span class="lineNoCov">          0 :         if ( bp[1]-&gt;y&gt;bp[0]-&gt;y ) {</span>
<span class="lineNum">   11083 </span><span class="lineNoCov">          0 :             h-&gt;start = bp[0]-&gt;y;</span>
<span class="lineNum">   11084 </span><span class="lineNoCov">          0 :             h-&gt;width = bp[1]-&gt;y-bp[0]-&gt;y;</span>
<span class="lineNum">   11085 </span>            :         } else {
<span class="lineNum">   11086 </span><span class="lineNoCov">          0 :             h-&gt;start = bp[1]-&gt;y;</span>
<span class="lineNum">   11087 </span><span class="lineNoCov">          0 :             h-&gt;width = bp[0]-&gt;y-bp[1]-&gt;y;</span>
<span class="lineNum">   11088 </span>            :         }
<span class="lineNum">   11089 </span><span class="lineNoCov">          0 :         SCGuessHHintInstancesAndAdd(cv-&gt;b.sc,layer,h,bp[0]-&gt;x,bp[1]-&gt;x);</span>
<span class="lineNum">   11090 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;hconflicts = StemListAnyConflicts(cv-&gt;b.sc-&gt;hstem);</span>
<span class="lineNum">   11091 </span><span class="lineNoCov">          0 :     } else if ( mi-&gt;mid==MID_AddVHint ) {</span>
<span class="lineNum">   11092 </span><span class="lineNoCov">          0 :         if ( bp[0]-&gt;x==bp[1]-&gt;x )</span>
<span class="lineNum">   11093 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   11094 </span><span class="lineNoCov">          0 :         h = chunkalloc(sizeof(StemInfo));</span>
<span class="lineNum">   11095 </span><span class="lineNoCov">          0 :         if ( bp[1]-&gt;x&gt;bp[0]-&gt;x ) {</span>
<span class="lineNum">   11096 </span><span class="lineNoCov">          0 :             h-&gt;start = bp[0]-&gt;x;</span>
<span class="lineNum">   11097 </span><span class="lineNoCov">          0 :             h-&gt;width = bp[1]-&gt;x-bp[0]-&gt;x;</span>
<span class="lineNum">   11098 </span>            :         } else {
<span class="lineNum">   11099 </span><span class="lineNoCov">          0 :             h-&gt;start = bp[1]-&gt;x;</span>
<span class="lineNum">   11100 </span><span class="lineNoCov">          0 :             h-&gt;width = bp[0]-&gt;x-bp[1]-&gt;x;</span>
<span class="lineNum">   11101 </span>            :         }
<span class="lineNum">   11102 </span><span class="lineNoCov">          0 :         SCGuessVHintInstancesAndAdd(cv-&gt;b.sc,layer,h,bp[0]-&gt;y,bp[1]-&gt;y);</span>
<span class="lineNum">   11103 </span><span class="lineNoCov">          0 :         cv-&gt;b.sc-&gt;vconflicts = StemListAnyConflicts(cv-&gt;b.sc-&gt;vstem);</span>
<span class="lineNum">   11104 </span>            :     } else {
<span class="lineNum">   11105 </span><span class="lineNoCov">          0 :         if ( !PointsDiagonalable( cv-&gt;b.sc-&gt;parent,bp,&amp;unit ))</span>
<span class="lineNum">   11106 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   11107 </span>            :         /* No additional tests, as the points should have already been */
<span class="lineNum">   11108 </span>            :         /* reordered by PointsDiagonalable */
<span class="lineNum">   11109 </span><span class="lineNoCov">          0 :         d = chunkalloc(sizeof(DStemInfo));</span>
<span class="lineNum">   11110 </span><span class="lineNoCov">          0 :         d-&gt;where = NULL;</span>
<span class="lineNum">   11111 </span><span class="lineNoCov">          0 :         d-&gt;left = *bp[0];</span>
<span class="lineNum">   11112 </span><span class="lineNoCov">          0 :         d-&gt;right = *bp[1];</span>
<span class="lineNum">   11113 </span><span class="lineNoCov">          0 :         d-&gt;unit = unit;</span>
<span class="lineNum">   11114 </span><span class="lineNoCov">          0 :         SCGuessDHintInstances( cv-&gt;b.sc,layer,d );</span>
<span class="lineNum">   11115 </span><span class="lineNoCov">          0 :         if ( d-&gt;where == NULL )</span>
<span class="lineNum">   11116 </span><span class="lineNoCov">          0 :             DStemInfoFree( d );</span>
<span class="lineNum">   11117 </span>            :         else
<span class="lineNum">   11118 </span><span class="lineNoCov">          0 :             MergeDStemInfo( cv-&gt;b.sc-&gt;parent,&amp;cv-&gt;b.sc-&gt;dstem,d );</span>
<span class="lineNum">   11119 </span>            :     }
<span class="lineNum">   11120 </span><span class="lineNoCov">          0 :     cv-&gt;b.sc-&gt;manualhints = true;</span>
<span class="lineNum">   11121 </span>            : 
<span class="lineNum">   11122 </span>            :     /* Hint Masks are not relevant for diagonal stems, so modifying */
<span class="lineNum">   11123 </span>            :     /* diagonal stems should not affect them */
<span class="lineNum">   11124 </span><span class="lineNoCov">          0 :     if ( (mi-&gt;mid==MID_AddVHint) || (mi-&gt;mid==MID_AddHHint) ) {</span>
<span class="lineNum">   11125 </span><span class="lineNoCov">          0 :         if ( h!=NULL &amp;&amp; cv-&gt;b.sc-&gt;parent-&gt;mm==NULL )</span>
<span class="lineNum">   11126 </span><span class="lineNoCov">          0 :             SCModifyHintMasksAdd(cv-&gt;b.sc,layer,h);</span>
<span class="lineNum">   11127 </span>            :         else
<span class="lineNum">   11128 </span><span class="lineNoCov">          0 :             SCClearHintMasks(cv-&gt;b.sc,layer,true);</span>
<span class="lineNum">   11129 </span>            :     }
<span class="lineNum">   11130 </span><span class="lineNoCov">          0 :     SCOutOfDateBackground(cv-&gt;b.sc);</span>
<span class="lineNum">   11131 </span><span class="lineNoCov">          0 :     SCUpdateAll(cv-&gt;b.sc);</span>
<a name="11132"><span class="lineNum">   11132 </span>            : }</a>
<span class="lineNum">   11133 </span>            : 
<span class="lineNum">   11134 </span><span class="lineNoCov">          0 : static void CVMenuCreateHint(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11135 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11136 </span><span class="lineNoCov">          0 :     CVCreateHint(cv,mi-&gt;mid==MID_CreateHHint,true);</span>
<a name="11137"><span class="lineNum">   11137 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11138 </span>            : 
<span class="lineNum">   11139 </span><span class="lineNoCov">          0 : static void CVMenuReviewHints(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11140 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11141 </span>            : 
<span class="lineNum">   11142 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc-&gt;hstem==NULL &amp;&amp; cv-&gt;b.sc-&gt;vstem==NULL )</span>
<span class="lineNum">   11143 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   11144 </span><span class="lineNoCov">          0 :     CVReviewHints(cv);</span>
<a name="11145"><span class="lineNum">   11145 </span>            : }</a>
<span class="lineNum">   11146 </span>            : 
<span class="lineNum">   11147 </span><span class="lineNoCov">          0 : static void htlistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11148 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11149 </span><span class="lineNoCov">          0 :     int cvlayer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">   11150 </span>            :     BasePoint *bp[4], unit;
<span class="lineNum">   11151 </span><span class="lineNoCov">          0 :     int multilayer = cv-&gt;b.sc-&gt;parent-&gt;multilayer;</span>
<span class="lineNum">   11152 </span><span class="lineNoCov">          0 :     int i=0, num = 0;</span>
<span class="lineNum">   11153 </span>            : 
<span class="lineNum">   11154 </span><span class="lineNoCov">          0 :     for (i=0; i&lt;4; i++) {bp[i]=NULL;}</span>
<span class="lineNum">   11155 </span>            : 
<span class="lineNum">   11156 </span><span class="lineNoCov">          0 :     num = CVNumForePointsSelected(cv,bp);</span>
<span class="lineNum">   11157 </span>            : 
<span class="lineNum">   11158 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   11159 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   11160 </span>            :           case MID_AutoHint:
<span class="lineNum">   11161 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cvlayer == ly_grid || multilayer;</span>
<span class="lineNum">   11162 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11163 </span>            :           case MID_HintSubsPt:
<span class="lineNum">   11164 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = multilayer ||</span>
<span class="lineNum">   11165 </span><span class="lineNoCov">          0 :                               cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2 ||</span>
<span class="lineNum">   11166 </span>            :                               cvlayer == ly_grid;
<span class="lineNum">   11167 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11168 </span>            :           case MID_AutoCounter:
<span class="lineNum">   11169 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = multilayer;</span>
<span class="lineNum">   11170 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11171 </span>            :           case MID_DontAutoHint:
<span class="lineNum">   11172 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2 || multilayer;</span>
<span class="lineNum">   11173 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;b.sc-&gt;manualhints;</span>
<span class="lineNum">   11174 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11175 </span>            :           case MID_AutoInstr:
<span class="lineNum">   11176 </span>            :           case MID_EditInstructions:
<span class="lineNum">   11177 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = multilayer ||</span>
<span class="lineNum">   11178 </span><span class="lineNoCov">          0 :                 !cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2 ||</span>
<span class="lineNum">   11179 </span>            :                 cvlayer == ly_grid;
<span class="lineNum">   11180 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11181 </span>            :           case MID_Debug:
<span class="lineNum">   11182 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = multilayer ||</span>
<span class="lineNum">   11183 </span><span class="lineNoCov">          0 :                 !cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2 ||</span>
<span class="lineNum">   11184 </span><span class="lineNoCov">          0 :                 !hasFreeTypeDebugger();</span>
<span class="lineNum">   11185 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11186 </span>            :           case MID_Deltas:
<span class="lineNum">   11187 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = multilayer ||</span>
<span class="lineNum">   11188 </span><span class="lineNoCov">          0 :                 !cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2 ||</span>
<span class="lineNum">   11189 </span><span class="lineNoCov">          0 :                 !hasFreeTypeDebugger();</span>
<span class="lineNum">   11190 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11191 </span>            :           case  MID_ClearHStem:
<span class="lineNum">   11192 </span>            :           case  MID_ClearVStem:
<span class="lineNum">   11193 </span>            :           case  MID_ClearDStem:
<span class="lineNum">   11194 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cvlayer == ly_grid;</span>
<span class="lineNum">   11195 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11196 </span>            :           case MID_ClearInstr:
<span class="lineNum">   11197 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.sc-&gt;ttf_instrs_len==0;</span>
<span class="lineNum">   11198 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11199 </span>            :           case MID_AddHHint:
<span class="lineNum">   11200 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = num != 2 || bp[1]-&gt;y==bp[0]-&gt;y || multilayer;</span>
<span class="lineNum">   11201 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11202 </span>            :           case MID_AddVHint:
<span class="lineNum">   11203 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = num != 2 || bp[1]-&gt;x==bp[0]-&gt;x || multilayer;</span>
<span class="lineNum">   11204 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11205 </span>            :           case MID_AddDHint:
<span class="lineNum">   11206 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = num != 4 || !PointsDiagonalable( cv-&gt;b.sc-&gt;parent,bp,&amp;unit ) || multilayer;</span>
<span class="lineNum">   11207 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11208 </span>            :           case  MID_CreateHHint:
<span class="lineNum">   11209 </span>            :           case  MID_CreateVHint:
<span class="lineNum">   11210 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cvlayer == ly_grid;</span>
<span class="lineNum">   11211 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11212 </span>            :           case MID_ReviewHints:
<span class="lineNum">   11213 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = (cv-&gt;b.sc-&gt;hstem==NULL &amp;&amp; cv-&gt;b.sc-&gt;vstem==NULL ) || multilayer;</span>
<span class="lineNum">   11214 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11215 </span>            :         }
<span class="lineNum">   11216 </span>            :     }
<a name="11217"><span class="lineNum">   11217 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11218 </span>            : 
<span class="lineNum">   11219 </span><span class="lineNoCov">          0 : static void mtlistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11220 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11221 </span><span class="lineNoCov">          0 :     RefChar *r = HasUseMyMetrics(cv-&gt;b.sc,CVLayer((CharViewBase *) cv));</span>
<span class="lineNum">   11222 </span>            : 
<span class="lineNum">   11223 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   11224 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   11225 </span>            :           case MID_RemoveKerns:
<span class="lineNum">   11226 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.sc-&gt;kerns==NULL;</span>
<span class="lineNum">   11227 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11228 </span>            :           case MID_RemoveVKerns:
<span class="lineNum">   11229 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.sc-&gt;vkerns==NULL;</span>
<span class="lineNum">   11230 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11231 </span>            :           case MID_SetVWidth:
<span class="lineNum">   11232 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;b.sc-&gt;parent-&gt;hasvmetrics || r!=NULL;</span>
<span class="lineNum">   11233 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11234 </span>            :           case MID_AnchorsAway:
<span class="lineNum">   11235 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.sc-&gt;anchor==NULL;</span>
<span class="lineNum">   11236 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11237 </span>            :           case MID_SetWidth: case MID_SetLBearing: case MID_SetRBearing: case MID_SetBearings:
<span class="lineNum">   11238 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = r!=NULL;</span>
<span class="lineNum">   11239 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11240 </span>            :         }
<span class="lineNum">   11241 </span>            :     }
<a name="11242"><span class="lineNum">   11242 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11243 </span>            : 
<span class="lineNum">   11244 </span><span class="lineNoCov">          0 : static void cv_sllistcheck(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">   11245 </span>            :     SplinePoint *sp; SplineSet *spl; RefChar *r; ImageList *im;
<span class="lineNum">   11246 </span>            :     spiro_cp *scp;
<span class="lineNum">   11247 </span>            :     SplineSet *test;
<span class="lineNum">   11248 </span><span class="lineNoCov">          0 :     int exactlyone = CVOneThingSel(cv,&amp;sp,&amp;spl,&amp;r,&amp;im,NULL,&amp;scp);</span>
<span class="lineNum">   11249 </span>            : 
<span class="lineNum">   11250 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   11251 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   11252 </span>            :           case MID_NextCP: case MID_PrevCP:
<span class="lineNum">   11253 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !exactlyone || sp==NULL || (cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro());</span>
<span class="lineNum">   11254 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11255 </span>            :           case MID_NextPt: case MID_PrevPt:
<span class="lineNum">   11256 </span>            :           case MID_FirstPtNextCont:
<span class="lineNum">   11257 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !exactlyone || (sp==NULL &amp;&amp; scp==NULL);</span>
<span class="lineNum">   11258 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11259 </span>            :           case MID_FirstPt: case MID_SelPointAt:
<span class="lineNum">   11260 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL;</span>
<span class="lineNum">   11261 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11262 </span>            :           case MID_Contours:
<span class="lineNum">   11263 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !CVAnySelPoints(cv);</span>
<span class="lineNum">   11264 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11265 </span>            :           case MID_SelectOpenContours:
<span class="lineNum">   11266 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = true;</span>
<span class="lineNum">   11267 </span><span class="lineNoCov">          0 :             for ( test=cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines; test!=NULL; test=test-&gt;next ) {</span>
<span class="lineNum">   11268 </span><span class="lineNoCov">          0 :                 if ( test-&gt;first-&gt;prev==NULL ) {</span>
<span class="lineNum">   11269 </span><span class="lineNoCov">          0 :                     mi-&gt;ti.disabled = false;</span>
<span class="lineNum">   11270 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">   11271 </span>            :                 }
<span class="lineNum">   11272 </span>            :             }
<span class="lineNum">   11273 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11274 </span>            :           case MID_SelectWidth:
<span class="lineNum">   11275 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;showhmetrics;</span>
<span class="lineNum">   11276 </span><span class="lineNoCov">          0 :             if ( HasUseMyMetrics(cv-&gt;b.sc,CVLayer((CharViewBase *) cv))!=NULL )</span>
<span class="lineNum">   11277 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.disabled = true;</span>
<span class="lineNum">   11278 </span><span class="lineNoCov">          0 :             if ( !mi-&gt;ti.disabled ) {</span>
<span class="lineNum">   11279 </span><span class="lineNoCov">          0 :                 free(mi-&gt;ti.text);</span>
<span class="lineNum">   11280 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.text = utf82u_copy(cv-&gt;widthsel?_(&quot;Deselect Width&quot;):_(&quot;Width&quot;));</span>
<span class="lineNum">   11281 </span>            :             }
<span class="lineNum">   11282 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11283 </span>            :           case MID_SelectVWidth:
<span class="lineNum">   11284 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;showvmetrics || !cv-&gt;b.sc-&gt;parent-&gt;hasvmetrics;</span>
<span class="lineNum">   11285 </span><span class="lineNoCov">          0 :             if ( HasUseMyMetrics(cv-&gt;b.sc,CVLayer((CharViewBase *) cv))!=NULL )</span>
<span class="lineNum">   11286 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.disabled = true;</span>
<span class="lineNum">   11287 </span><span class="lineNoCov">          0 :             if ( !mi-&gt;ti.disabled ) {</span>
<span class="lineNum">   11288 </span><span class="lineNoCov">          0 :                 free(mi-&gt;ti.text);</span>
<span class="lineNum">   11289 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.text = utf82u_copy(cv-&gt;vwidthsel?_(&quot;Deselect VWidth&quot;):_(&quot;VWidth&quot;));</span>
<span class="lineNum">   11290 </span>            :             }
<span class="lineNum">   11291 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11292 </span>            :           case MID_SelectHM:
<span class="lineNum">   11293 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !exactlyone || sp==NULL || sp-&gt;hintmask==NULL;</span>
<span class="lineNum">   11294 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11295 </span>            :         }
<span class="lineNum">   11296 </span>            :     }
<a name="11297"><span class="lineNum">   11297 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11298 </span>            : 
<span class="lineNum">   11299 </span><span class="lineNoCov">          0 : static void sllistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11300 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11301 </span><span class="lineNoCov">          0 :     cv_sllistcheck(cv, mi);</span>
<a name="11302"><span class="lineNum">   11302 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11303 </span>            : 
<span class="lineNum">   11304 </span><span class="lineNoCov">          0 : static void cv_cblistcheck(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">   11305 </span>            :     int i;
<span class="lineNum">   11306 </span>            :     KernPair *kp;
<span class="lineNum">   11307 </span><span class="lineNoCov">          0 :     SplineChar *sc = cv-&gt;b.sc;</span>
<span class="lineNum">   11308 </span><span class="lineNoCov">          0 :     SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">   11309 </span>            :     PST *pst;
<span class="lineNum">   11310 </span>            :     char *name;
<span class="lineNum">   11311 </span>            : 
<span class="lineNum">   11312 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   11313 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   11314 </span>            :           case MID_AnchorPairs:
<span class="lineNum">   11315 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = sc-&gt;anchor==NULL;</span>
<span class="lineNum">   11316 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11317 </span>            :           case MID_AnchorControl:
<span class="lineNum">   11318 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = sc-&gt;anchor==NULL;</span>
<span class="lineNum">   11319 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11320 </span>            :           case MID_AnchorGlyph:
<span class="lineNum">   11321 </span><span class="lineNoCov">          0 :             if ( cv-&gt;apmine!=NULL )</span>
<span class="lineNum">   11322 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.disabled = false;</span>
<span class="lineNum">   11323 </span>            :             else
<span class="lineNum">   11324 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.disabled = sc-&gt;anchor==NULL;</span>
<span class="lineNum">   11325 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11326 </span>            :           case MID_KernPairs:
<span class="lineNum">   11327 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = sc-&gt;kerns==NULL;</span>
<span class="lineNum">   11328 </span><span class="lineNoCov">          0 :             if ( sc-&gt;kerns==NULL ) {</span>
<span class="lineNum">   11329 </span><span class="lineNoCov">          0 :                 for ( i=0; i&lt;sf-&gt;glyphcnt; ++i ) if ( sf-&gt;glyphs[i]!=NULL ) {</span>
<span class="lineNum">   11330 </span><span class="lineNoCov">          0 :                     for ( kp = sf-&gt;glyphs[i]-&gt;kerns; kp!=NULL; kp=kp-&gt;next ) {</span>
<span class="lineNum">   11331 </span><span class="lineNoCov">          0 :                         if ( kp-&gt;sc == sc ) {</span>
<span class="lineNum">   11332 </span><span class="lineNoCov">          0 :                             mi-&gt;ti.disabled = false;</span>
<span class="lineNum">   11333 </span><span class="lineNoCov">          0 :                 goto out;</span>
<span class="lineNum">   11334 </span>            :                         }
<span class="lineNum">   11335 </span>            :                     }
<span class="lineNum">   11336 </span>            :                 }
<span class="lineNum">   11337 </span>            :               out:;
<span class="lineNum">   11338 </span>            :             }
<span class="lineNum">   11339 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11340 </span>            :           case MID_Ligatures:
<span class="lineNum">   11341 </span><span class="lineNoCov">          0 :             name = sc-&gt;name;</span>
<span class="lineNum">   11342 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;sf-&gt;glyphcnt; ++i ) if ( sf-&gt;glyphs[i]!=NULL ) {</span>
<span class="lineNum">   11343 </span><span class="lineNoCov">          0 :                 for ( pst=sf-&gt;glyphs[i]-&gt;possub; pst!=NULL; pst=pst-&gt;next ) {</span>
<span class="lineNum">   11344 </span><span class="lineNoCov">          0 :                     if ( pst-&gt;type==pst_ligature &amp;&amp;</span>
<span class="lineNum">   11345 </span><span class="lineNoCov">          0 :                             PSTContains(pst-&gt;u.lig.components,name)) {</span>
<span class="lineNum">   11346 </span><span class="lineNoCov">          0 :                         mi-&gt;ti.disabled = false;</span>
<span class="lineNum">   11347 </span><span class="lineNoCov">          0 :           goto break_out_2;</span>
<span class="lineNum">   11348 </span>            :                     }
<span class="lineNum">   11349 </span>            :                 }
<span class="lineNum">   11350 </span>            :             }
<span class="lineNum">   11351 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = true;</span>
<span class="lineNum">   11352 </span>            :           break_out_2:;
<span class="lineNum">   11353 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11354 </span>            :         }
<span class="lineNum">   11355 </span>            :     }
<a name="11356"><span class="lineNum">   11356 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11357 </span>            : 
<span class="lineNum">   11358 </span><span class="lineNoCov">          0 : static void cv_nplistcheck(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">   11359 </span><span class="lineNoCov">          0 :     SplineChar *sc = cv-&gt;b.sc;</span>
<span class="lineNum">   11360 </span><span class="lineNoCov">          0 :     int order2 = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;order2;</span>
<span class="lineNum">   11361 </span><span class="lineNoCov">          0 :     int is_grid_layer = cv-&gt;b.drawmode == dm_grid;</span>
<span class="lineNum">   11362 </span>            : 
<span class="lineNum">   11363 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   11364 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   11365 </span>            :           case MID_PtsNone:
<span class="lineNum">   11366 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !order2 || is_grid_layer;</span>
<span class="lineNum">   11367 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = (cv-&gt;showpointnumbers == 0);</span>
<span class="lineNum">   11368 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11369 </span>            :           case MID_PtsTrue:
<span class="lineNum">   11370 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !order2 || is_grid_layer;</span>
<span class="lineNum">   11371 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showpointnumbers &amp;&amp; order2;</span>
<span class="lineNum">   11372 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11373 </span>            :           case MID_PtsPost:
<span class="lineNum">   11374 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = order2 || is_grid_layer;</span>
<span class="lineNum">   11375 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showpointnumbers &amp;&amp; !order2 &amp;&amp; sc-&gt;numberpointsbackards;</span>
<span class="lineNum">   11376 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11377 </span>            :           case MID_PtsSVG:
<span class="lineNum">   11378 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = order2 || is_grid_layer;</span>
<span class="lineNum">   11379 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showpointnumbers &amp;&amp; !order2 &amp;&amp; !sc-&gt;numberpointsbackards;</span>
<span class="lineNum">   11380 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11381 </span>            :           case MID_PtsPos:
<span class="lineNum">   11382 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = is_grid_layer;</span>
<span class="lineNum">   11383 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = (cv-&gt;showpointnumbers == 2);</span>
<span class="lineNum">   11384 </span>            :         }
<span class="lineNum">   11385 </span>            :     }
<a name="11386"><span class="lineNum">   11386 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11387 </span>            : 
<span class="lineNum">   11388 </span><span class="lineNoCov">          0 : static void gflistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11389 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11390 </span>            : 
<span class="lineNum">   11391 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   11392 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   11393 </span>            :           case MID_ShowGridFit:
<span class="lineNum">   11394 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !hasFreeType() || cv-&gt;dv!=NULL;</span>
<span class="lineNum">   11395 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;show_ft_results;</span>
<span class="lineNum">   11396 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11397 </span>            :           case MID_ShowGridFitLiveUpdate:
<span class="lineNum">   11398 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !hasFreeType() || cv-&gt;dv!=NULL;</span>
<span class="lineNum">   11399 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;show_ft_results_live_update;</span>
<span class="lineNum">   11400 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11401 </span>            :           case MID_Bigger:
<span class="lineNum">   11402 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;show_ft_results;</span>
<span class="lineNum">   11403 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11404 </span>            :           case MID_Smaller:
<span class="lineNum">   11405 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;show_ft_results || cv-&gt;ft_pointsizex&lt;2 || cv-&gt;ft_pointsizey&lt;2;</span>
<span class="lineNum">   11406 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11407 </span>            :           case MID_GridFitAA:
<span class="lineNum">   11408 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;show_ft_results;</span>
<span class="lineNum">   11409 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;ft_depth==8;</span>
<span class="lineNum">   11410 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11411 </span>            :           case MID_GridFitOff:
<span class="lineNum">   11412 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;show_ft_results;</span>
<span class="lineNum">   11413 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11414 </span>            :         }
<span class="lineNum">   11415 </span>            :     }
<a name="11416"><span class="lineNum">   11416 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11417 </span>            : 
<span class="lineNum">   11418 </span><span class="lineNoCov">          0 : static void swlistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11419 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11420 </span><span class="lineNoCov">          0 :     SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">   11421 </span>            : 
<span class="lineNum">   11422 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   11423 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   11424 </span>            :           case MID_MarkExtrema:
<span class="lineNum">   11425 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;markextrema;</span>
<span class="lineNum">   11426 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro();</span>
<span class="lineNum">   11427 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11428 </span>            :           case MID_MarkPointsOfInflection:
<span class="lineNum">   11429 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;markpoi;</span>
<span class="lineNum">   11430 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro();</span>
<span class="lineNum">   11431 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11432 </span>            :           case MID_ShowAlmostHV:
<span class="lineNum">   11433 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showalmosthvlines;</span>
<span class="lineNum">   11434 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11435 </span>            :           case MID_ShowAlmostHVCurves:
<span class="lineNum">   11436 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showalmosthvcurves;</span>
<span class="lineNum">   11437 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11438 </span>            :           case MID_DefineAlmost:
<span class="lineNum">   11439 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !cv-&gt;showalmosthvlines &amp;&amp; !cv-&gt;showalmosthvcurves;</span>
<span class="lineNum">   11440 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11441 </span>            :           case MID_ShowCPInfo:
<span class="lineNum">   11442 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showcpinfo;</span>
<span class="lineNum">   11443 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11444 </span>            :           case MID_DraggingComparisonOutline:
<span class="lineNum">   11445 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = prefs_create_dragging_comparison_outline;</span>
<span class="lineNum">   11446 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">   11447 </span>            :           case MID_ShowSideBearings:
<span class="lineNum">   11448 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showsidebearings;</span>
<span class="lineNum">   11449 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11450 </span>            :           case MID_ShowRefNames:
<span class="lineNum">   11451 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showrefnames;</span>
<span class="lineNum">   11452 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11453 </span>            :           case MID_ShowTabs:
<span class="lineNum">   11454 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showtabs;</span>
<span class="lineNum">   11455 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;former_cnt&lt;=1;</span>
<span class="lineNum">   11456 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11457 </span>            :           case MID_HidePoints:
<span class="lineNum">   11458 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showpoints;</span>
<span class="lineNum">   11459 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11460 </span>            :         case MID_HideControlPoints:
<span class="lineNum">   11461 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;alwaysshowcontrolpoints;</span>
<span class="lineNum">   11462 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">   11463 </span>            :           case MID_HideRulers:
<span class="lineNum">   11464 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showrulers;</span>
<span class="lineNum">   11465 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11466 </span>            :           case MID_Fill:
<span class="lineNum">   11467 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showfilled;</span>
<span class="lineNum">   11468 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11469 </span>            :           case MID_ShowHHints:
<span class="lineNum">   11470 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showhhints;</span>
<span class="lineNum">   11471 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = sf-&gt;multilayer;</span>
<span class="lineNum">   11472 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11473 </span>            :           case MID_ShowVHints:
<span class="lineNum">   11474 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showvhints;</span>
<span class="lineNum">   11475 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = sf-&gt;multilayer;</span>
<span class="lineNum">   11476 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11477 </span>            :           case MID_ShowDHints:
<span class="lineNum">   11478 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showdhints;</span>
<span class="lineNum">   11479 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = sf-&gt;multilayer;</span>
<span class="lineNum">   11480 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11481 </span>            :           case MID_ShowBlueValues:
<span class="lineNum">   11482 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showblues;</span>
<span class="lineNum">   11483 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = sf-&gt;multilayer;</span>
<span class="lineNum">   11484 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11485 </span>            :           case MID_ShowFamilyBlues:
<span class="lineNum">   11486 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showfamilyblues;</span>
<span class="lineNum">   11487 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = sf-&gt;multilayer;</span>
<span class="lineNum">   11488 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11489 </span>            :           case MID_ShowAnchors:
<span class="lineNum">   11490 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showanchor;</span>
<span class="lineNum">   11491 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = sf-&gt;multilayer;</span>
<span class="lineNum">   11492 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11493 </span>            :           case MID_ShowHMetrics:
<span class="lineNum">   11494 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showhmetrics;</span>
<span class="lineNum">   11495 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11496 </span>            :           case MID_ShowVMetrics:
<span class="lineNum">   11497 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showvmetrics;</span>
<span class="lineNum">   11498 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !sf-&gt;hasvmetrics;</span>
<span class="lineNum">   11499 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11500 </span>            :           case MID_ShowDebugChanges:
<span class="lineNum">   11501 </span><span class="lineNoCov">          0 :             mi-&gt;ti.checked = cv-&gt;showdebugchanges;</span>
<span class="lineNum">   11502 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11503 </span>            :           case MID_SnapOutlines:
<span class="lineNum">   11504 </span>            : #ifndef _NO_LIBCAIRO
<span class="lineNum">   11505 </span><span class="lineNoCov">          0 :             if ( GDrawHasCairo(cv-&gt;v)&amp;gc_alpha ) {</span>
<span class="lineNum">   11506 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.checked = cv-&gt;snapoutlines;</span>
<span class="lineNum">   11507 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.disabled = false;</span>
<span class="lineNum">   11508 </span>            :             } else
<span class="lineNum">   11509 </span>            : #endif
<span class="lineNum">   11510 </span>            :             {
<span class="lineNum">   11511 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.checked = true;</span>
<span class="lineNum">   11512 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.disabled = true;</span>
<span class="lineNum">   11513 </span>            :             }
<span class="lineNum">   11514 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11515 </span>            :         }
<span class="lineNum">   11516 </span>            :     }
<a name="11517"><span class="lineNum">   11517 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11518 </span>            : 
<span class="lineNum">   11519 </span><span class="lineNoCov">          0 : static void cv_vwlistcheck(CharView *cv, struct gmenuitem *mi) {</span>
<span class="lineNum">   11520 </span>            :     int pos, gid;
<span class="lineNum">   11521 </span><span class="lineNoCov">          0 :     SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">   11522 </span><span class="lineNoCov">          0 :     EncMap *map = cv-&gt;b.fv-&gt;map;</span>
<span class="lineNum">   11523 </span>            : 
<span class="lineNum">   11524 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   11525 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   11526 </span>            :           case MID_NextDef:
<span class="lineNum">   11527 </span><span class="lineNoCov">          0 :             if ( cv-&gt;b.container==NULL ) {</span>
<span class="lineNum">   11528 </span><span class="lineNoCov">          0 :                 for ( pos = CVCurEnc(cv)+1; pos&lt;map-&gt;enccount &amp;&amp; ((gid=map-&gt;map[pos])==-1 || !SCWorthOutputting(sf-&gt;glyphs[gid])); ++pos );</span>
<span class="lineNum">   11529 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.disabled = pos==map-&gt;enccount;</span>
<span class="lineNum">   11530 </span>            :             } else
<span class="lineNum">   11531 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.disabled = !(cv-&gt;b.container-&gt;funcs-&gt;canNavigate)(cv-&gt;b.container,nt_nextdef);</span>
<span class="lineNum">   11532 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11533 </span>            :           case MID_PrevDef:
<span class="lineNum">   11534 </span><span class="lineNoCov">          0 :             if ( cv-&gt;b.container==NULL ) {</span>
<span class="lineNum">   11535 </span><span class="lineNoCov">          0 :                 for ( pos = CVCurEnc(cv)-1; pos&gt;=0 &amp;&amp; ((gid=map-&gt;map[pos])==-1 || !SCWorthOutputting(sf-&gt;glyphs[gid])); --pos );</span>
<span class="lineNum">   11536 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.disabled = pos&lt;0 || cv-&gt;b.container!=NULL;</span>
<span class="lineNum">   11537 </span>            :             } else
<span class="lineNum">   11538 </span><span class="lineNoCov">          0 :                 mi-&gt;ti.disabled = !(cv-&gt;b.container-&gt;funcs-&gt;canNavigate)(cv-&gt;b.container,nt_nextdef);</span>
<span class="lineNum">   11539 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11540 </span>            :           case MID_Next:
<span class="lineNum">   11541 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.container==NULL ? CVCurEnc(cv)==map-&gt;enccount-1 : !(cv-&gt;b.container-&gt;funcs-&gt;canNavigate)(cv-&gt;b.container,nt_nextdef);</span>
<span class="lineNum">   11542 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11543 </span>            :           case MID_Prev:
<span class="lineNum">   11544 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.container==NULL ? CVCurEnc(cv)==0 : !(cv-&gt;b.container-&gt;funcs-&gt;canNavigate)(cv-&gt;b.container,nt_nextdef);</span>
<span class="lineNum">   11545 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11546 </span>            :           case MID_Former:
<span class="lineNum">   11547 </span><span class="lineNoCov">          0 :             if ( cv-&gt;former_cnt&lt;=1 )</span>
<span class="lineNum">   11548 </span><span class="lineNoCov">          0 :                 pos = -1;</span>
<span class="lineNum">   11549 </span><span class="lineNoCov">          0 :             else for ( pos = sf-&gt;glyphcnt-1; pos&gt;=0 ; --pos )</span>
<span class="lineNum">   11550 </span><span class="lineNoCov">          0 :                 if ( sf-&gt;glyphs[pos]!=NULL &amp;&amp; strcmp(sf-&gt;glyphs[pos]-&gt;name,cv-&gt;former_names[1])==0 )</span>
<span class="lineNum">   11551 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">   11552 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = pos==-1 || cv-&gt;b.container!=NULL;</span>
<span class="lineNum">   11553 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11554 </span>            :           case MID_Goto:
<span class="lineNum">   11555 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.container!=NULL &amp;&amp; !(cv-&gt;b.container-&gt;funcs-&gt;canNavigate)(cv-&gt;b.container,nt_goto);</span>
<span class="lineNum">   11556 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11557 </span>            :           case MID_FindInFontView:
<span class="lineNum">   11558 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.container!=NULL;</span>
<span class="lineNum">   11559 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11560 </span>            : #if HANYANG
<span class="lineNum">   11561 </span>            :           case MID_DisplayCompositions:
<span class="lineNum">   11562 </span>            :             mi-&gt;ti.disabled = !cv-&gt;b.sc-&gt;compositionunit || cv-&gt;b.sc-&gt;parent-&gt;rules==NULL;
<span class="lineNum">   11563 </span>            :           break;
<span class="lineNum">   11564 </span>            : #endif
<span class="lineNum">   11565 </span>            :         }
<span class="lineNum">   11566 </span>            :     }
<a name="11567"><span class="lineNum">   11567 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11568 </span>            : 
<span class="lineNum">   11569 </span><span class="lineNoCov">          0 : static void cblistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11570 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11571 </span><span class="lineNoCov">          0 :     cv_cblistcheck(cv, mi);</span>
<a name="11572"><span class="lineNum">   11572 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11573 </span>            : 
<span class="lineNum">   11574 </span><span class="lineNoCov">          0 : static void nplistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11575 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11576 </span><span class="lineNoCov">          0 :     cv_nplistcheck(cv, mi);</span>
<a name="11577"><span class="lineNum">   11577 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11578 </span>            : 
<span class="lineNum">   11579 </span><span class="lineNoCov">          0 : static void vwlistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11580 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11581 </span><span class="lineNoCov">          0 :     cv_vwlistcheck(cv, mi);</span>
<a name="11582"><span class="lineNum">   11582 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11583 </span>            : 
<span class="lineNum">   11584 </span><span class="lineNoCov">          0 : static void CVMenuCenter(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11585 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11586 </span>            :     DBounds bb;
<span class="lineNum">   11587 </span>            :     real transform[6];
<span class="lineNum">   11588 </span><span class="lineNoCov">          0 :     int drawmode = cv-&gt;b.drawmode;</span>
<span class="lineNum">   11589 </span>            : 
<span class="lineNum">   11590 </span><span class="lineNoCov">          0 :     cv-&gt;b.drawmode = dm_fore;</span>
<span class="lineNum">   11591 </span>            : 
<span class="lineNum">   11592 </span><span class="lineNoCov">          0 :     memset(transform,0,sizeof(transform));</span>
<span class="lineNum">   11593 </span><span class="lineNoCov">          0 :     transform[0] = transform[3] = 1.0;</span>
<span class="lineNum">   11594 </span><span class="lineNoCov">          0 :     transform[1] = transform[2] = transform[5] = 0.0;</span>
<span class="lineNum">   11595 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc-&gt;parent-&gt;italicangle==0 )</span>
<span class="lineNum">   11596 </span><span class="lineNoCov">          0 :         SplineCharFindBounds(cv-&gt;b.sc,&amp;bb);</span>
<span class="lineNum">   11597 </span>            :     else {
<span class="lineNum">   11598 </span>            :         SplineSet *base, *temp;
<span class="lineNum">   11599 </span><span class="lineNoCov">          0 :         base = LayerAllSplines(cv-&gt;b.layerheads[cv-&gt;b.drawmode]);</span>
<span class="lineNum">   11600 </span><span class="lineNoCov">          0 :         transform[2] = tan( cv-&gt;b.sc-&gt;parent-&gt;italicangle * 3.1415926535897932/180.0 );</span>
<span class="lineNum">   11601 </span><span class="lineNoCov">          0 :         temp = SplinePointListTransform(SplinePointListCopy(base),transform,tpt_AllPoints);</span>
<span class="lineNum">   11602 </span><span class="lineNoCov">          0 :         transform[2] = 0;</span>
<span class="lineNum">   11603 </span><span class="lineNoCov">          0 :         LayerUnAllSplines(cv-&gt;b.layerheads[cv-&gt;b.drawmode]);</span>
<span class="lineNum">   11604 </span><span class="lineNoCov">          0 :         SplineSetFindBounds(temp,&amp;bb);</span>
<span class="lineNum">   11605 </span><span class="lineNoCov">          0 :         SplinePointListsFree(temp);</span>
<span class="lineNum">   11606 </span>            :     }
<span class="lineNum">   11607 </span>            : 
<span class="lineNum">   11608 </span><span class="lineNoCov">          0 :     if ( mi-&gt;mid==MID_Center )</span>
<span class="lineNum">   11609 </span><span class="lineNoCov">          0 :         transform[4] = (cv-&gt;b.sc-&gt;width-(bb.maxx-bb.minx))/2 - bb.minx;</span>
<span class="lineNum">   11610 </span>            :     else
<span class="lineNum">   11611 </span><span class="lineNoCov">          0 :         transform[4] = (cv-&gt;b.sc-&gt;width-(bb.maxx-bb.minx))/3 - bb.minx;</span>
<span class="lineNum">   11612 </span><span class="lineNoCov">          0 :     if ( transform[4]!=0 ) {</span>
<span class="lineNum">   11613 </span><span class="lineNoCov">          0 :         cv-&gt;p.transany = false;</span>
<span class="lineNum">   11614 </span><span class="lineNoCov">          0 :         CVPreserveState(&amp;cv-&gt;b);</span>
<span class="lineNum">   11615 </span><span class="lineNoCov">          0 :         CVTransFuncAllLayers(cv, transform, fvt_dontmovewidth );</span>
<span class="lineNum">   11616 </span><span class="lineNoCov">          0 :         CVCharChangedUpdate(&amp;cv-&gt;b);</span>
<span class="lineNum">   11617 </span>            :     }
<span class="lineNum">   11618 </span><span class="lineNoCov">          0 :     cv-&gt;b.drawmode = drawmode;</span>
<a name="11619"><span class="lineNum">   11619 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11620 </span>            : 
<span class="lineNum">   11621 </span><span class="lineNoCov">          0 : static void CVMenuSetWidth(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11622 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11623 </span>            : 
<span class="lineNum">   11624 </span><span class="lineNoCov">          0 :     if ( mi-&gt;mid == MID_SetVWidth &amp;&amp; !cv-&gt;b.sc-&gt;parent-&gt;hasvmetrics )</span>
<span class="lineNum">   11625 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   11626 </span><span class="lineNoCov">          0 :     CVSetWidth(cv,mi-&gt;mid==MID_SetWidth?wt_width:</span>
<span class="lineNum">   11627 </span><span class="lineNoCov">          0 :                   mi-&gt;mid==MID_SetLBearing?wt_lbearing:</span>
<span class="lineNum">   11628 </span><span class="lineNoCov">          0 :                   mi-&gt;mid==MID_SetRBearing?wt_rbearing:</span>
<span class="lineNum">   11629 </span><span class="lineNoCov">          0 :                   mi-&gt;mid==MID_SetBearings?wt_bearings:</span>
<span class="lineNum">   11630 </span>            :                   wt_vwidth);
<a name="11631"><span class="lineNum">   11631 </span>            : }</a>
<span class="lineNum">   11632 </span>            : 
<span class="lineNum">   11633 </span><span class="lineNoCov">          0 : static void CVMenuRemoveKern(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11634 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11635 </span><span class="lineNoCov">          0 :     SCRemoveKern(cv-&gt;b.sc);</span>
<a name="11636"><span class="lineNum">   11636 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11637 </span>            : 
<span class="lineNum">   11638 </span><span class="lineNoCov">          0 : static void CVMenuRemoveVKern(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11639 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11640 </span><span class="lineNoCov">          0 :     SCRemoveVKern(cv-&gt;b.sc);</span>
<a name="11641"><span class="lineNum">   11641 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11642 </span>            : 
<span class="lineNum">   11643 </span><span class="lineNoCov">          0 : static void CVMenuKPCloseup(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11644 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11645 </span><span class="lineNoCov">          0 :     KernPairD(cv-&gt;b.sc-&gt;parent,cv-&gt;b.sc,NULL,CVLayer((CharViewBase *) cv),false);</span>
<a name="11646"><span class="lineNum">   11646 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   11647 </span>            : 
<span class="lineNum">   11648 </span><span class="lineNoCov">          0 : static void CVMenuAnchorsAway(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11649 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11650 </span>            :     AnchorPoint *ap;
<span class="lineNum">   11651 </span>            : 
<span class="lineNum">   11652 </span><span class="lineNoCov">          0 :     ap = mi-&gt;ti.userdata;</span>
<span class="lineNum">   11653 </span><span class="lineNoCov">          0 :     if ( ap==NULL )</span>
<span class="lineNum">   11654 </span><span class="lineNoCov">          0 :         for ( ap = cv-&gt;b.sc-&gt;anchor; ap!=NULL &amp;&amp; !ap-&gt;selected; ap = ap-&gt;next );</span>
<span class="lineNum">   11655 </span><span class="lineNoCov">          0 :     if ( ap==NULL ) ap= cv-&gt;b.sc-&gt;anchor;</span>
<span class="lineNum">   11656 </span><span class="lineNoCov">          0 :     if ( ap==NULL )</span>
<span class="lineNum">   11657 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   11658 </span>            : 
<span class="lineNum">   11659 </span><span class="lineNoCov">          0 :     GDrawSetCursor(cv-&gt;v,ct_watch);</span>
<span class="lineNum">   11660 </span><span class="lineNoCov">          0 :     GDrawSync(NULL);</span>
<span class="lineNum">   11661 </span><span class="lineNoCov">          0 :     GDrawProcessPendingEvents(NULL);</span>
<span class="lineNum">   11662 </span><span class="lineNoCov">          0 :     AnchorControl(cv-&gt;b.sc,ap,CVLayer((CharViewBase *) cv));</span>
<span class="lineNum">   11663 </span><span class="lineNoCov">          0 :     GDrawSetCursor(cv-&gt;v,ct_pointer);</span>
<span class="lineNum">   11664 </span>            : }
<span class="lineNum">   11665 </span>            : 
<span class="lineNum">   11666 </span>            : static GMenuItem2 wnmenu[] = {
<span class="lineNum">   11667 </span>            :     { { (unichar_t *) N_(&quot;New O_utline Window&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 1, 0, 'u' }, H_(&quot;New Outline Window|No Shortcut&quot;), NULL, NULL, /* No function, never avail */NULL, 0 },
<span class="lineNum">   11668 </span>            :     { { (unichar_t *) N_(&quot;New _Bitmap Window&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'B' }, H_(&quot;New Bitmap Window|No Shortcut&quot;), NULL, NULL, CVMenuOpenBitmap, MID_OpenBitmap },
<span class="lineNum">   11669 </span>            :     { { (unichar_t *) N_(&quot;New _Metrics Window&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;New Metrics Window|No Shortcut&quot;), NULL, NULL, CVMenuOpenMetrics, 0 },
<span class="lineNum">   11670 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11671 </span>            :     { { (unichar_t *) N_(&quot;Warnings&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Warnings|No Shortcut&quot;), NULL, NULL, _MenuWarnings, MID_Warnings },
<span class="lineNum">   11672 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11673 </span>            :     GMENUITEM2_EMPTY
<a name="11674"><span class="lineNum">   11674 </span>            : };</a>
<span class="lineNum">   11675 </span>            : 
<span class="lineNum">   11676 </span><span class="lineNoCov">          0 : static void CVWindowMenuBuild(GWindow gw, struct gmenuitem *mi, GEvent *e) {</span>
<span class="lineNum">   11677 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11678 </span>            :     struct gmenuitem *wmi;
<span class="lineNum">   11679 </span>            : 
<span class="lineNum">   11680 </span><span class="lineNoCov">          0 :     WindowMenuBuild(gw,mi,e);</span>
<span class="lineNum">   11681 </span><span class="lineNoCov">          0 :     for ( wmi = mi-&gt;sub; wmi-&gt;ti.text!=NULL || wmi-&gt;ti.line ; ++wmi ) {</span>
<span class="lineNum">   11682 </span><span class="lineNoCov">          0 :         switch ( wmi-&gt;mid ) {</span>
<span class="lineNum">   11683 </span>            :           case MID_OpenBitmap:
<span class="lineNum">   11684 </span><span class="lineNoCov">          0 :             wmi-&gt;ti.disabled = cv-&gt;b.sc-&gt;parent-&gt;bitmaps==NULL;</span>
<span class="lineNum">   11685 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11686 </span>            :           case MID_Warnings:
<span class="lineNum">   11687 </span><span class="lineNoCov">          0 :             wmi-&gt;ti.disabled = ErrorWindowExists();</span>
<span class="lineNum">   11688 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11689 </span>            :         }
<span class="lineNum">   11690 </span>            :     }
<span class="lineNum">   11691 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.container!=NULL ) {</span>
<span class="lineNum">   11692 </span><span class="lineNoCov">          0 :         int canopen = (cv-&gt;b.container-&gt;funcs-&gt;canOpen)(cv-&gt;b.container);</span>
<span class="lineNum">   11693 </span><span class="lineNoCov">          0 :         if ( !canopen ) {</span>
<span class="lineNum">   11694 </span><span class="lineNoCov">          0 :             for ( wmi = mi-&gt;sub; wmi-&gt;ti.text!=NULL || wmi-&gt;ti.line ; ++wmi ) {</span>
<span class="lineNum">   11695 </span><span class="lineNoCov">          0 :                 wmi-&gt;ti.disabled = true;</span>
<span class="lineNum">   11696 </span>            :             }
<span class="lineNum">   11697 </span>            :         }
<span class="lineNum">   11698 </span>            :     }
<span class="lineNum">   11699 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   11700 </span>            : 
<span class="lineNum">   11701 </span>            : static GMenuItem2 dummyitem[] = {
<span class="lineNum">   11702 </span>            :     { { (unichar_t *) N_(&quot;Font|_New&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'N' }, NULL, NULL, NULL, NULL, 0 },
<span class="lineNum">   11703 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11704 </span>            : };
<span class="lineNum">   11705 </span>            : static GMenuItem2 fllist[] = {
<span class="lineNum">   11706 </span>            :     { { (unichar_t *) N_(&quot;Font|_New&quot;), (GImage *) &quot;filenew.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'N' }, H_(&quot;New|No Shortcut&quot;), NULL, NULL, MenuNew, MID_New },
<span class="lineNum">   11707 </span>            :     { { (unichar_t *) N_(&quot;_Open&quot;), (GImage *) &quot;fileopen.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'O' }, H_(&quot;Open|No Shortcut&quot;), NULL, NULL, CVMenuOpen, MID_Open },
<span class="lineNum">   11708 </span>            :     { { (unichar_t *) N_(&quot;Recen_t&quot;), (GImage *) &quot;filerecent.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 't' }, NULL, dummyitem, MenuRecentBuild, NULL, MID_Recent },
<span class="lineNum">   11709 </span>            :     { { (unichar_t *) N_(&quot;_Close&quot;), (GImage *) &quot;fileclose.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'C' }, H_(&quot;Close|No Shortcut&quot;), NULL, NULL, CVMenuClose, MID_Close },
<span class="lineNum">   11710 </span>            :     { { (unichar_t *) N_(&quot;C_lose Tab&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'C' }, H_(&quot;Close Tab|No Shortcut&quot;), NULL, NULL, CVMenuCloseTab, MID_CloseTab },
<span class="lineNum">   11711 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11712 </span>            :     { { (unichar_t *) N_(&quot;_Save&quot;), (GImage *) &quot;filesave.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'S' }, H_(&quot;Save|No Shortcut&quot;), NULL, NULL, CVMenuSave, 0 },
<span class="lineNum">   11713 </span>            :     { { (unichar_t *) N_(&quot;S_ave as...&quot;), (GImage *) &quot;filesaveas.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'a' }, H_(&quot;Save as...|No Shortcut&quot;), NULL, NULL, CVMenuSaveAs, 0 },
<span class="lineNum">   11714 </span>            :     { { (unichar_t *) N_(&quot;_Generate Fonts...&quot;), (GImage *) &quot;filegenerate.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'G' }, H_(&quot;Generate Fonts...|No Shortcut&quot;), NULL, NULL, CVMenuGenerate, 0 },
<span class="lineNum">   11715 </span>            :     { { (unichar_t *) N_(&quot;Generate Mac _Family...&quot;), (GImage *) &quot;filegeneratefamily.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'F' }, H_(&quot;Generate Mac Family...|No Shortcut&quot;), NULL, NULL, CVMenuGenerateFamily, 0 },
<span class="lineNum">   11716 </span>            :     { { (unichar_t *) N_(&quot;Generate TTC...&quot;), (GImage *) &quot;filegeneratefamily.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'F' }, H_(&quot;Generate TTC...|No Shortcut&quot;), NULL, NULL, CVMenuGenerateTTC, MID_GenerateTTC },
<span class="lineNum">   11717 </span>            :     { { (unichar_t *) N_(&quot;E_xport...&quot;), (GImage *) &quot;fileexport.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 't' }, H_(&quot;Export...|No Shortcut&quot;), NULL, NULL, CVMenuExport, 0 },
<span class="lineNum">   11718 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11719 </span>            :     { { (unichar_t *) N_(&quot;_Import...&quot;), (GImage *) &quot;fileimport.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'I' }, H_(&quot;Import...|No Shortcut&quot;), NULL, NULL, CVMenuImport, 0 },
<span class="lineNum">   11720 </span>            :     { { (unichar_t *) N_(&quot;_Revert File&quot;), (GImage *) &quot;filerevert.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Revert File|No Shortcut&quot;), NULL, NULL, CVMenuRevert, MID_Revert },
<span class="lineNum">   11721 </span>            :     { { (unichar_t *) N_(&quot;Revert Gl_yph&quot;), (GImage *) &quot;filerevertglyph.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Revert Glyph|No Shortcut&quot;), NULL, NULL, CVMenuRevertGlyph, MID_RevertGlyph },
<span class="lineNum">   11722 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11723 </span>            :     { { (unichar_t *) N_(&quot;Load Word List...&quot;), (GImage *) 0, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Load Word List...|No Shortcut&quot;), NULL, NULL, CVAddWordList, 0 },
<span class="lineNum">   11724 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11725 </span>            :     { { (unichar_t *) N_(&quot;_Print...&quot;), (GImage *) &quot;fileprint.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Print...|No Shortcut&quot;), NULL, NULL, CVMenuPrint, 0 },
<span class="lineNum">   11726 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11727 </span>            : #if !defined(_NO_PYTHON)
<span class="lineNum">   11728 </span>            :     { { (unichar_t *) N_(&quot;E_xecute Script...&quot;), (GImage *) &quot;python.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'x' }, H_(&quot;Execute Script...|No Shortcut&quot;), NULL, NULL, CVMenuExecute, 0 },
<span class="lineNum">   11729 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11730 </span>            : #endif
<span class="lineNum">   11731 </span>            :     { { (unichar_t *) N_(&quot;Pr_eferences...&quot;), (GImage *) &quot;fileprefs.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'e' }, H_(&quot;Preferences...|No Shortcut&quot;), NULL, NULL, MenuPrefs, 0 },
<span class="lineNum">   11732 </span>            :     { { (unichar_t *) N_(&quot;_X Resource Editor...&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'e' }, H_(&quot;X Resource Editor...|No Shortcut&quot;), NULL, NULL, MenuXRes, 0 },
<span class="lineNum">   11733 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11734 </span>            :     { { (unichar_t *) N_(&quot;_Quit&quot;), (GImage *) &quot;filequit.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'Q' }, H_(&quot;Quit|No Shortcut&quot;), NULL, NULL, MenuExit, MID_Quit },
<span class="lineNum">   11735 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11736 </span>            : };
<span class="lineNum">   11737 </span>            : 
<span class="lineNum">   11738 </span>            : static GMenuItem2 sllist[] = {
<span class="lineNum">   11739 </span>            :     { { (unichar_t *) N_(&quot;Select _All&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'A' }, H_(&quot;Select All|No Shortcut&quot;), NULL, NULL, CVSelectAll, MID_SelAll },
<span class="lineNum">   11740 </span>            :     { { (unichar_t *) N_(&quot;_Invert Selection&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'I' }, H_(&quot;Invert Selection|No Shortcut&quot;), NULL, NULL, CVSelectInvert, MID_SelInvert },
<span class="lineNum">   11741 </span>            :     { { (unichar_t *) N_(&quot;_Deselect All&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Deselect All|Escape&quot;), NULL, NULL, CVSelectNone, MID_SelNone },
<span class="lineNum">   11742 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11743 </span>            :     { { (unichar_t *) N_(&quot;_First Point&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'F' }, H_(&quot;First Point|No Shortcut&quot;), NULL, NULL, CVMenuNextPrevPt, MID_FirstPt },
<span class="lineNum">   11744 </span>            :     { { (unichar_t *) N_(&quot;First P_oint, Next Contour&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'F' }, H_(&quot;First Point, Next Contour|No Shortcut&quot;), NULL, NULL, CVMenuNextPrevPt, MID_FirstPtNextCont },
<span class="lineNum">   11745 </span>            :     { { (unichar_t *) N_(&quot;_Next Point&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'N' }, H_(&quot;Next Point|No Shortcut&quot;), NULL, NULL, CVMenuNextPrevPt, MID_NextPt },
<span class="lineNum">   11746 </span>            :     { { (unichar_t *) N_(&quot;_Prev Point&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Prev Point|No Shortcut&quot;), NULL, NULL, CVMenuNextPrevPt, MID_PrevPt },
<span class="lineNum">   11747 </span>            :     { { (unichar_t *) N_(&quot;Ne_xt Control Point&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'x' }, H_(&quot;Next Control Point|No Shortcut&quot;), NULL, NULL, CVMenuNextPrevCPt, MID_NextCP },
<span class="lineNum">   11748 </span>            :     { { (unichar_t *) N_(&quot;P_rev Control Point&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'r' }, H_(&quot;Prev Control Point|No Shortcut&quot;), NULL, NULL, CVMenuNextPrevCPt, MID_PrevCP },
<span class="lineNum">   11749 </span>            :     { { (unichar_t *) N_(&quot;Points on Selected _Contours&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'r' }, H_(&quot;Points on Selected Contours|No Shortcut&quot;), NULL, NULL, CVMenuSelectContours, MID_Contours },
<span class="lineNum">   11750 </span>            :     { { (unichar_t *) N_(&quot;Point A_t&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'r' }, H_(&quot;Point At|No Shortcut&quot;), NULL, NULL, CVMenuSelectPointAt, MID_SelPointAt },
<span class="lineNum">   11751 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11752 </span>            :     { { (unichar_t *) N_(&quot;Select All _Points &amp; Refs&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Select All Points &amp; Refs|No Shortcut&quot;), NULL, NULL, CVSelectAll, MID_SelectAllPoints },
<span class="lineNum">   11753 </span>            :     { { (unichar_t *) N_(&quot;Select Open Contours&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Select Open Contours|No Shortcut&quot;), NULL, NULL, CVSelectOpenContours, MID_SelectOpenContours },
<span class="lineNum">   11754 </span>            :     { { (unichar_t *) N_(&quot;Select Anc_hors&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'c' }, H_(&quot;Select Anchors|No Shortcut&quot;), NULL, NULL, CVSelectAll, MID_SelectAnchors },
<span class="lineNum">   11755 </span>            :     { { (unichar_t *) N_(&quot;_Width&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;Width|No Shortcut&quot;), NULL, NULL, CVSelectWidth, MID_SelectWidth },
<span class="lineNum">   11756 </span>            :     { { (unichar_t *) N_(&quot;_VWidth&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;VWidth|No Shortcut&quot;), NULL, NULL, CVSelectVWidth, MID_SelectVWidth },
<span class="lineNum">   11757 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11758 </span>            :     { { (unichar_t *) N_(&quot;Select Points Affected by HM&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'V' }, H_(&quot;Select Points Affected by HM|No Shortcut&quot;), NULL, NULL, CVSelectHM, MID_SelectHM },
<span class="lineNum">   11759 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11760 </span>            : };
<span class="lineNum">   11761 </span>            : 
<span class="lineNum">   11762 </span>            : static GMenuItem2 edlist[] = {
<span class="lineNum">   11763 </span>            :     { { (unichar_t *) N_(&quot;_Undo&quot;), (GImage *) &quot;editundo.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'U' }, H_(&quot;Undo|No Shortcut&quot;), NULL, NULL, CVUndo, MID_Undo },
<span class="lineNum">   11764 </span>            :     { { (unichar_t *) N_(&quot;_Redo&quot;), (GImage *) &quot;editredo.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Redo|No Shortcut&quot;), NULL, NULL, CVRedo, MID_Redo },
<span class="lineNum">   11765 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11766 </span>            :     { { (unichar_t *) N_(&quot;Cu_t&quot;), (GImage *) &quot;editcut.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 't' }, H_(&quot;Cut|No Shortcut&quot;), NULL, NULL, CVCut, MID_Cut },
<span class="lineNum">   11767 </span>            :     { { (unichar_t *) N_(&quot;_Copy&quot;), (GImage *) &quot;editcopy.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'C' }, H_(&quot;Copy|No Shortcut&quot;), NULL, NULL, CVCopy, MID_Copy },
<span class="lineNum">   11768 </span>            :     { { (unichar_t *) N_(&quot;C_opy Reference&quot;), (GImage *) &quot;editcopyref.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Copy Reference|No Shortcut&quot;), NULL, NULL, CVCopyRef, MID_CopyRef },
<span class="lineNum">   11769 </span>            :     { { (unichar_t *) N_(&quot;Copy Loo_kup Data&quot;), (GImage *) &quot;editcopylookupdata.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Copy Lookup Data|No Shortcut&quot;), NULL, NULL, CVCopyLookupData, MID_CopyLookupData },
<span class="lineNum">   11770 </span>            :     { { (unichar_t *) N_(&quot;Copy _Width&quot;), (GImage *) &quot;editcopywidth.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'W' }, H_(&quot;Copy Width|No Shortcut&quot;), NULL, NULL, CVCopyWidth, MID_CopyWidth },
<span class="lineNum">   11771 </span>            :     { { (unichar_t *) N_(&quot;Co_py LBearing&quot;), (GImage *) &quot;editcopylbearing.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'p' }, H_(&quot;Copy LBearing|No Shortcut&quot;), NULL, NULL, CVCopyWidth, MID_CopyLBearing },
<span class="lineNum">   11772 </span>            :     { { (unichar_t *) N_(&quot;Copy RBearin_g&quot;), (GImage *) &quot;editcopyrbearing.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'g' }, H_(&quot;Copy RBearing|No Shortcut&quot;), NULL, NULL, CVCopyWidth, MID_CopyRBearing },
<span class="lineNum">   11773 </span>            :     { { (unichar_t *) N_(&quot;_Paste&quot;), (GImage *) &quot;editpaste.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Paste|No Shortcut&quot;), NULL, NULL, CVPaste, MID_Paste },
<span class="lineNum">   11774 </span>            :     { { (unichar_t *) N_(&quot;C_hop&quot;), (GImage *) &quot;editclear.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'h' }, H_(&quot;Chop|Delete&quot;), NULL, NULL, CVClear, MID_Clear },
<span class="lineNum">   11775 </span>            :     { { (unichar_t *) N_(&quot;Clear _Background&quot;), (GImage *) &quot;editclearback.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'B' }, H_(&quot;Clear Background|No Shortcut&quot;), NULL, NULL, CVClearBackground, 0 },
<span class="lineNum">   11776 </span>            :     { { (unichar_t *) N_(&quot;points|_Merge&quot;), (GImage *) &quot;editmerge.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Merge|No Shortcut&quot;), NULL, NULL, CVMerge, MID_Merge },
<span class="lineNum">   11777 </span>            :     { { (unichar_t *) N_(&quot;points|Merge to Line&quot;), (GImage *) &quot;editmergetoline.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Merge to Line|No Shortcut&quot;), NULL, NULL, CVMergeToLine, MID_MergeToLine },
<span class="lineNum">   11778 </span>            :     /*{ { (unichar_t *) N_(&quot;_Elide&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Elide|No Shortcut&quot;), NULL, NULL, CVElide, MID_Elide },*/
<span class="lineNum">   11779 </span>            :     { { (unichar_t *) N_(&quot;_Join&quot;), (GImage *) &quot;editjoin.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'J' }, H_(&quot;Join|No Shortcut&quot;), NULL, NULL, CVJoin, MID_Join },
<span class="lineNum">   11780 </span>            :     { { (unichar_t *) N_(&quot;Copy _Fg To Bg&quot;), (GImage *) &quot;editcopyfg2bg.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'F' }, H_(&quot;Copy Fg To Bg|No Shortcut&quot;), NULL, NULL, CVCopyFgBg, MID_CopyFgToBg },
<span class="lineNum">   11781 </span>            :     { { (unichar_t *) N_(&quot;Cop_y Layer To Layer...&quot;), (GImage *) &quot;editcopylayer2layer.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'F' }, H_(&quot;Copy Layer To Layer...|No Shortcut&quot;), NULL, NULL, CVMenuCopyL2L, MID_CopyBgToFg },
<span class="lineNum">   11782 </span>            :     { { (unichar_t *) N_(&quot;Copy Gri_d Fit&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;Copy Grid Fit|No Shortcut&quot;), NULL, NULL, CVMenuCopyGridFit, MID_CopyGridFit },
<span class="lineNum">   11783 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11784 </span>            :     { { (unichar_t *) N_(&quot;_Select&quot;), (GImage *) &quot;editselect.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'S' }, H_(&quot;Select|No Shortcut&quot;), sllist, sllistcheck, NULL, 0 },
<span class="lineNum">   11785 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11786 </span>            :     { { (unichar_t *) N_(&quot;U_nlink Reference&quot;), (GImage *) &quot;editunlink.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'U' }, H_(&quot;Unlink Reference|No Shortcut&quot;), NULL, NULL, CVUnlinkRef, MID_UnlinkRef },
<span class="lineNum">   11787 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11788 </span>            :     { { (unichar_t *) N_(&quot;Remo_ve Undoes...&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'e' }, H_(&quot;Remove Undoes|No Shortcut&quot;), NULL, NULL, CVRemoveUndoes, MID_RemoveUndoes },
<span class="lineNum">   11789 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11790 </span>            : };
<span class="lineNum">   11791 </span>            : 
<span class="lineNum">   11792 </span>            : static GMenuItem2 ptlist[] = {
<span class="lineNum">   11793 </span>            :     { { (unichar_t *) N_(&quot;_Curve&quot;), (GImage *) &quot;pointscurve.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'C' }, H_(&quot;Curve|No Shortcut&quot;), NULL, NULL, CVMenuPointType, MID_Curve },
<span class="lineNum">   11794 </span>            :     { { (unichar_t *) N_(&quot;_HVCurve&quot;), (GImage *) &quot;pointshvcurve.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;HVCurve|No Shortcut&quot;), NULL, NULL, CVMenuPointType, MID_HVCurve },
<span class="lineNum">   11795 </span>            :     { { (unichar_t *) N_(&quot;C_orner&quot;), (GImage *) &quot;pointscorner.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Corner|No Shortcut&quot;), NULL, NULL, CVMenuPointType, MID_Corner },
<span class="lineNum">   11796 </span>            :     { { (unichar_t *) N_(&quot;_Tangent&quot;), (GImage *) &quot;pointstangent.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Tangent|No Shortcut&quot;), NULL, NULL, CVMenuPointType, MID_Tangent },
<span class="lineNum">   11797 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11798 </span>            : /* GT: Make this (selected) point the first point in the glyph */
<span class="lineNum">   11799 </span>            :     { { (unichar_t *) N_(&quot;_Make First&quot;),  (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Make First|No Shortcut&quot;), NULL, NULL, CVMenuMakeFirst, MID_MakeFirst },
<span class="lineNum">   11800 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11801 </span>            :     { { (unichar_t *) N_(&quot;Can Be _Interpolated&quot;),  (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Can Be Interpolated|No Shortcut&quot;), NULL, NULL, CVMenuImplicit, MID_ImplicitPt },
<span class="lineNum">   11802 </span>            :     { { (unichar_t *) N_(&quot;Can't _Be Interpolated&quot;),  (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Can't Be Interpolated|No Shortcut&quot;), NULL, NULL, CVMenuImplicit, MID_NoImplicitPt },
<span class="lineNum">   11803 </span>            :     { { (unichar_t *) N_(&quot;Center Bet_ween Control Points&quot;),  (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Center Between Control Points|No Shortcut&quot;), NULL, NULL, CVMenuCenterCP, MID_CenterCP },
<span class="lineNum">   11804 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11805 </span>            :     { { (unichar_t *) N_(&quot;_Add Anchor&quot;), (GImage *) &quot;pointsaddanchor.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'A' }, H_(&quot;Add Anchor|No Shortcut&quot;), NULL, NULL, CVMenuAddAnchor, MID_AddAnchor },
<span class="lineNum">   11806 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11807 </span>            :     { { (unichar_t *) N_(&quot;Acceptable _Extrema&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'C' }, H_(&quot;Acceptable Extrema|No Shortcut&quot;), NULL, NULL, CVMenuAcceptableExtrema, MID_AcceptableExtrema },
<span class="lineNum">   11808 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11809 </span>            :     { { (unichar_t *) N_(&quot;Make _Line&quot;), (GImage *) &quot;pointsmakeline.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Make Line|No Shortcut&quot;), NULL, NULL, CVMenuMakeLine, MID_MakeLine },
<span class="lineNum">   11810 </span>            :     { { (unichar_t *) N_(&quot;Ma_ke Arc&quot;), (GImage *) &quot;pointsmakearc.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Make Arc|No Shortcut&quot;), NULL, NULL, CVMenuMakeLine, MID_MakeArc },
<span class="lineNum">   11811 </span>            :     { { (unichar_t *) N_(&quot;Inse_rt Point On Spline At...&quot;),  (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Insert Point On Spline At...|No Shortcut&quot;), NULL, NULL, CVMenuInsertPt, MID_InsertPtOnSplineAt },
<span class="lineNum">   11812 </span>            :     { { (unichar_t *) N_(&quot;_Name Point&quot;),  (GImage *) &quot;pointsnamepoint.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Name Point|No Shortcut&quot;), NULL, NULL, CVMenuNamePoint, MID_NamePoint },
<span class="lineNum">   11813 </span>            :     { { (unichar_t *) N_(&quot;_Name Contour&quot;),  (GImage *) &quot;pointsnamecontour.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Name Contour|No Shortcut&quot;), NULL, NULL, CVMenuNameContour, MID_NameContour },
<span class="lineNum">   11814 </span>            :     { { (unichar_t *) N_(&quot;Make Clip _Path&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Make Clip Path|No Shortcut&quot;), NULL, NULL, CVMenuClipPath, MID_ClipPath },
<span class="lineNum">   11815 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11816 </span>            :     { { (unichar_t *) N_(&quot;Tool_s&quot;),  (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Tools|No Shortcut&quot;), cvtoollist, cvtoollist_check, NULL, MID_Tools },
<span class="lineNum">   11817 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11818 </span>            : };
<span class="lineNum">   11819 </span>            : 
<span class="lineNum">   11820 </span>            : static GMenuItem2 spiroptlist[] = {
<span class="lineNum">   11821 </span>            :     { { (unichar_t *) N_(&quot;G4 _Curve&quot;), (GImage *) &quot;pointscurve.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'C' }, H_(&quot;G4 Curve|No Shortcut&quot;), NULL, NULL, CVMenuPointType, MID_SpiroG4 },
<span class="lineNum">   11822 </span>            :     { { (unichar_t *) N_(&quot;_G2 Curve&quot;), (GImage *) &quot;pointsG2curve.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;G2 Curve|No Shortcut&quot;), NULL, NULL, CVMenuPointType, MID_SpiroG2 },
<span class="lineNum">   11823 </span>            :     { { (unichar_t *) N_(&quot;C_orner&quot;), (GImage *) &quot;pointscorner.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Corner|No Shortcut&quot;), NULL, NULL, CVMenuPointType, MID_SpiroCorner },
<span class="lineNum">   11824 </span>            :     { { (unichar_t *) N_(&quot;_Left Constraint&quot;), (GImage *) &quot;pointsspiroprev.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Prev Constraint|No Shortcut&quot;), NULL, NULL, CVMenuPointType, MID_SpiroLeft },
<span class="lineNum">   11825 </span>            :     { { (unichar_t *) N_(&quot;_Right Constraint&quot;), (GImage *) &quot;pointsspironext.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Next Constraint|No Shortcut&quot;), NULL, NULL, CVMenuPointType, MID_SpiroRight },
<span class="lineNum">   11826 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11827 </span>            : /* GT: Make this (selected) point the first point in the glyph */
<span class="lineNum">   11828 </span>            :     { { (unichar_t *) N_(&quot;_Make First&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Make First|No Shortcut&quot;), NULL, NULL, CVMenuSpiroMakeFirst, MID_SpiroMakeFirst },
<span class="lineNum">   11829 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11830 </span>            :     { { (unichar_t *) N_(&quot;_Add Anchor&quot;), (GImage *) &quot;pointsaddanchor.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'A' }, H_(&quot;Add Anchor|No Shortcut&quot;), NULL, NULL, CVMenuAddAnchor, MID_AddAnchor },
<span class="lineNum">   11831 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11832 </span>            :     { { (unichar_t *) N_(&quot;_Name Point&quot;), (GImage *) &quot;pointsnamepoint.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Name Point|No Shortcut&quot;), NULL, NULL, CVMenuNamePoint, MID_NamePoint },
<span class="lineNum">   11833 </span>            :     { { (unichar_t *) N_(&quot;_Name Contour&quot;), (GImage *) &quot;pointsnamecontour.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Name Contour|No Shortcut&quot;), NULL, NULL, CVMenuNameContour, MID_NameContour },
<span class="lineNum">   11834 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11835 </span>            :     { { (unichar_t *) N_(&quot;Tool_s&quot;),  (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, NULL, cvspirotoollist, cvtoollist_check, NULL, MID_Tools },
<span class="lineNum">   11836 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11837 </span>            : };
<span class="lineNum">   11838 </span>            : 
<span class="lineNum">   11839 </span>            : static GMenuItem2 allist[] = {
<span class="lineNum">   11840 </span>            : /* GT: Align these points to their average position */
<span class="lineNum">   11841 </span>            :     { { (unichar_t *) N_(&quot;_Align Points&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'A' }, H_(&quot;Align Points|No Shortcut&quot;), NULL, NULL, CVMenuConstrain, MID_Average },
<span class="lineNum">   11842 </span>            :     { { (unichar_t *) N_(&quot;_Space Points&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'S' }, H_(&quot;Space Points|No Shortcut&quot;), NULL, NULL, CVMenuConstrain, MID_SpacePts },
<span class="lineNum">   11843 </span>            :     { { (unichar_t *) N_(&quot;Space _Regions...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Space Regions...|No Shortcut&quot;), NULL, NULL, CVMenuConstrain, MID_SpaceRegion },
<span class="lineNum">   11844 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11845 </span>            :     { { (unichar_t *) N_(&quot;Make _Parallel...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Make Parallel...|No Shortcut&quot;), NULL, NULL, CVMenuMakeParallel, MID_MakeParallel },
<span class="lineNum">   11846 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11847 </span>            : };
<span class="lineNum">   11848 </span>            : 
<span class="lineNum">   11849 </span>            : static GMenuItem2 smlist[] = {
<span class="lineNum">   11850 </span>            :     { { (unichar_t *) N_(&quot;_Simplify&quot;), (GImage *) &quot;elementsimplify.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'S' }, H_(&quot;Simplify|No Shortcut&quot;), NULL, NULL, CVMenuSimplify, MID_Simplify },
<span class="lineNum">   11851 </span>            :     { { (unichar_t *) N_(&quot;Simplify More...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Simplify More...|No Shortcut&quot;), NULL, NULL, CVMenuSimplifyMore, MID_SimplifyMore },
<span class="lineNum">   11852 </span>            :     { { (unichar_t *) N_(&quot;Clea_nup Glyph&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'n' }, H_(&quot;Cleanup Glyph|No Shortcut&quot;), NULL, NULL, CVMenuCleanupGlyph, MID_CleanupGlyph },
<span class="lineNum">   11853 </span>            :     { { (unichar_t *) N_(&quot;Canonical Start _Point&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'n' }, H_(&quot;Canonical Start Point|No Shortcut&quot;), NULL, NULL, CVMenuCanonicalStart, MID_CanonicalStart },
<span class="lineNum">   11854 </span>            :     { { (unichar_t *) N_(&quot;Canonical _Contours&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'n' }, H_(&quot;Canonical Contours|No Shortcut&quot;), NULL, NULL, CVMenuCanonicalContours, MID_CanonicalContours },
<span class="lineNum">   11855 </span>            :     GMENUITEM2_EMPTY
<a name="11856"><span class="lineNum">   11856 </span>            : };</a>
<span class="lineNum">   11857 </span>            : 
<span class="lineNum">   11858 </span><span class="lineNoCov">          0 : static void smlistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11859 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11860 </span>            : 
<span class="lineNum">   11861 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   11862 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   11863 </span>            :           case MID_Simplify:
<span class="lineNum">   11864 </span>            :           case MID_CleanupGlyph:
<span class="lineNum">   11865 </span>            :           case MID_SimplifyMore:
<span class="lineNum">   11866 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL;</span>
<span class="lineNum">   11867 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11868 </span>            :           case MID_CanonicalStart:
<span class="lineNum">   11869 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL ||</span>
<span class="lineNum">   11870 </span><span class="lineNoCov">          0 :                     (cv-&gt;b.sc-&gt;inspiro &amp;&amp; hasspiro());</span>
<span class="lineNum">   11871 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11872 </span>            :           case MID_CanonicalContours:
<span class="lineNum">   11873 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==NULL ||</span>
<span class="lineNum">   11874 </span><span class="lineNoCov">          0 :                 cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines-&gt;next==NULL ||</span>
<span class="lineNum">   11875 </span><span class="lineNoCov">          0 :                 cv-&gt;b.drawmode!=dm_fore;</span>
<span class="lineNum">   11876 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11877 </span>            :         }
<span class="lineNum">   11878 </span>            :     }
<span class="lineNum">   11879 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   11880 </span>            : 
<span class="lineNum">   11881 </span>            : static GMenuItem2 orlist[] = {
<span class="lineNum">   11882 </span>            :     { { (unichar_t *) N_(&quot;_First&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'S' }, H_(&quot;First|No Shortcut&quot;), NULL, NULL, CVMenuOrder, MID_First },
<span class="lineNum">   11883 </span>            :     { { (unichar_t *) N_(&quot;_Earlier&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Earlier|No Shortcut&quot;), NULL, NULL, CVMenuOrder, MID_Earlier },
<span class="lineNum">   11884 </span>            :     { { (unichar_t *) N_(&quot;L_ater&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'n' }, H_(&quot;Later|No Shortcut&quot;), NULL, NULL, CVMenuOrder, MID_Later },
<span class="lineNum">   11885 </span>            :     { { (unichar_t *) N_(&quot;_Last&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'n' }, H_(&quot;Last|No Shortcut&quot;), NULL, NULL, CVMenuOrder, MID_Last },
<span class="lineNum">   11886 </span>            :     GMENUITEM2_EMPTY
<a name="11887"><span class="lineNum">   11887 </span>            : };</a>
<span class="lineNum">   11888 </span>            : 
<span class="lineNum">   11889 </span><span class="lineNoCov">          0 : static void orlistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   11890 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   11891 </span>            :     SplinePointList *spl;
<span class="lineNum">   11892 </span>            :     RefChar *r;
<span class="lineNum">   11893 </span>            :     ImageList *im;
<span class="lineNum">   11894 </span><span class="lineNoCov">          0 :     int exactlyone = CVOneContourSel(cv,&amp;spl,&amp;r,&amp;im);</span>
<span class="lineNum">   11895 </span>            :     int isfirst, islast;
<span class="lineNum">   11896 </span>            : 
<span class="lineNum">   11897 </span><span class="lineNoCov">          0 :     isfirst = islast = false;</span>
<span class="lineNum">   11898 </span><span class="lineNoCov">          0 :     if ( spl!=NULL ) {</span>
<span class="lineNum">   11899 </span><span class="lineNoCov">          0 :         isfirst = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;splines==spl;</span>
<span class="lineNum">   11900 </span><span class="lineNoCov">          0 :         islast = spl-&gt;next==NULL;</span>
<span class="lineNum">   11901 </span><span class="lineNoCov">          0 :     } else if ( r!=NULL ) {</span>
<span class="lineNum">   11902 </span><span class="lineNoCov">          0 :         isfirst = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;refs==r;</span>
<span class="lineNum">   11903 </span><span class="lineNoCov">          0 :         islast = r-&gt;next==NULL;</span>
<span class="lineNum">   11904 </span><span class="lineNoCov">          0 :     } else if ( im!=NULL ) {</span>
<span class="lineNum">   11905 </span><span class="lineNoCov">          0 :         isfirst = cv-&gt;b.layerheads[cv-&gt;b.drawmode]-&gt;images==im;</span>
<span class="lineNum">   11906 </span><span class="lineNoCov">          0 :         islast = im-&gt;next==NULL;</span>
<span class="lineNum">   11907 </span>            :     }
<span class="lineNum">   11908 </span>            : 
<span class="lineNum">   11909 </span><span class="lineNoCov">          0 :     for ( mi = mi-&gt;sub; mi-&gt;ti.text!=NULL || mi-&gt;ti.line ; ++mi ) {</span>
<span class="lineNum">   11910 </span><span class="lineNoCov">          0 :         switch ( mi-&gt;mid ) {</span>
<span class="lineNum">   11911 </span>            :           case MID_First:
<span class="lineNum">   11912 </span>            :           case MID_Earlier:
<span class="lineNum">   11913 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !exactlyone || isfirst;</span>
<span class="lineNum">   11914 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11915 </span>            :           case MID_Last:
<span class="lineNum">   11916 </span>            :           case MID_Later:
<span class="lineNum">   11917 </span><span class="lineNoCov">          0 :             mi-&gt;ti.disabled = !exactlyone || islast;</span>
<span class="lineNum">   11918 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   11919 </span>            :         }
<span class="lineNum">   11920 </span>            :     }
<span class="lineNum">   11921 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   11922 </span>            : 
<span class="lineNum">   11923 </span>            : static GMenuItem2 rmlist[] = {
<span class="lineNum">   11924 </span>            :     { { (unichar_t *) N_(&quot;_Remove Overlap&quot;), (GImage *) &quot;overlaprm.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Remove Overlap|No Shortcut&quot;), NULL, NULL, CVMenuOverlap, MID_RmOverlap },
<span class="lineNum">   11925 </span>            :     { { (unichar_t *) N_(&quot;_Intersect&quot;), (GImage *) &quot;overlapintersection.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 'I' }, H_(&quot;Intersect|No Shortcut&quot;), NULL, NULL, CVMenuOverlap, MID_Intersection },
<span class="lineNum">   11926 </span>            :     { { (unichar_t *) N_(&quot;_Exclude&quot;), (GImage *) &quot;overlapexclude.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 'E' }, H_(&quot;Exclude|No Shortcut&quot;), NULL, NULL, CVMenuOverlap, MID_Exclude },
<span class="lineNum">   11927 </span>            :     { { (unichar_t *) N_(&quot;_Find Intersections&quot;), (GImage *) &quot;overlapfindinter.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 'F' }, H_(&quot;Find Intersections|No Shortcut&quot;), NULL, NULL, CVMenuOverlap, MID_FindInter },
<span class="lineNum">   11928 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11929 </span>            : };
<span class="lineNum">   11930 </span>            : 
<span class="lineNum">   11931 </span>            : static GMenuItem2 eflist[] = {
<span class="lineNum">   11932 </span>            :     { { (unichar_t *) N_(&quot;Change _Weight...&quot;), (GImage *) &quot;styleschangeweight.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Change Weight...|No Shortcut&quot;), NULL, NULL, CVMenuEmbolden, MID_Embolden },
<span class="lineNum">   11933 </span>            :     { { (unichar_t *) N_(&quot;_Italic...&quot;), (GImage *) &quot;stylesitalic.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;Italic...|No Shortcut&quot;), NULL, NULL, CVMenuItalic, MID_Italic },
<span class="lineNum">   11934 </span>            :     { { (unichar_t *) N_(&quot;Obli_que...&quot;), (GImage *) &quot;stylesoblique.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Oblique...|No Shortcut&quot;), NULL, NULL, CVMenuOblique, 0 },
<span class="lineNum">   11935 </span>            :     { { (unichar_t *) N_(&quot;_Condense/Extend...&quot;), (GImage *) &quot;stylesextendcondense.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Condense...|No Shortcut&quot;), NULL, NULL, CVMenuCondense, MID_Condense },
<span class="lineNum">   11936 </span>            :     { { (unichar_t *) N_(&quot;Change _X-Height...&quot;), (GImage *) &quot;styleschangexheight.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;Change XHeight...|No Shortcut&quot;), NULL, NULL, CVMenuChangeXHeight, MID_ChangeXHeight },
<span class="lineNum">   11937 </span>            :     { { (unichar_t *) N_(&quot;Change _Glyph...&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;Change Glyph...|No Shortcut&quot;), NULL, NULL, CVMenuChangeGlyph, MID_ChangeGlyph },
<span class="lineNum">   11938 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11939 </span>            :     { { (unichar_t *) N_(&quot;In_line...&quot;), (GImage *) &quot;stylesinline.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 'O' }, H_(&quot;Inline|No Shortcut&quot;), NULL, NULL, CVMenuInline, 0 },
<span class="lineNum">   11940 </span>            :     { { (unichar_t *) N_(&quot;_Outline...&quot;), (GImage *) &quot;stylesoutline.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 'I' }, H_(&quot;Outline|No Shortcut&quot;), NULL, NULL, CVMenuOutline, 0 },
<span class="lineNum">   11941 </span>            :     { { (unichar_t *) N_(&quot;S_hadow...&quot;), (GImage *) &quot;stylesshadow.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 'S' }, H_(&quot;Shadow|No Shortcut&quot;), NULL, NULL, CVMenuShadow, 0 },
<span class="lineNum">   11942 </span>            :     { { (unichar_t *) N_(&quot;_Wireframe...&quot;), (GImage *) &quot;styleswireframe.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 'W' }, H_(&quot;Wireframe|No Shortcut&quot;), NULL, NULL, CVMenuWireframe, 0 },
<span class="lineNum">   11943 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11944 </span>            : };
<span class="lineNum">   11945 </span>            : 
<span class="lineNum">   11946 </span>            : static GMenuItem2 balist[] = {
<span class="lineNum">   11947 </span>            :     { { (unichar_t *) N_(&quot;_Build Accented Glyph&quot;), (GImage *) &quot;elementbuildaccent.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'u' }, H_(&quot;Build Accented Glyph|No Shortcut&quot;), NULL, NULL, CVMenuBuildAccent, MID_BuildAccent },
<span class="lineNum">   11948 </span>            :     { { (unichar_t *) N_(&quot;Build _Composite Glyph&quot;), (GImage *) &quot;elementbuildcomposite.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'B' }, H_(&quot;Build Composite Glyph|No Shortcut&quot;), NULL, NULL, CVMenuBuildComposite, MID_BuildComposite },
<span class="lineNum">   11949 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11950 </span>            : };
<span class="lineNum">   11951 </span>            : 
<span class="lineNum">   11952 </span>            : static GMenuItem2 delist[] = {
<span class="lineNum">   11953 </span>            :     { { (unichar_t *) N_(&quot;_References...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'u' }, H_(&quot;References...|No Shortcut&quot;), NULL, NULL, CVMenuShowDependentRefs, MID_ShowDependentRefs },
<span class="lineNum">   11954 </span>            :     { { (unichar_t *) N_(&quot;_Substitutions...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'B' }, H_(&quot;Substitutions...|No Shortcut&quot;), NULL, NULL, CVMenuShowDependentSubs, MID_ShowDependentSubs },
<span class="lineNum">   11955 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11956 </span>            : };
<span class="lineNum">   11957 </span>            : 
<span class="lineNum">   11958 </span>            : static GMenuItem2 trlist[] = {
<span class="lineNum">   11959 </span>            :     { { (unichar_t *) N_(&quot;_Transform...&quot;), (GImage *) &quot;elementtransform.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Transform...|No Shortcut&quot;), NULL, NULL, CVMenuTransform, 0 },
<span class="lineNum">   11960 </span>            :     { { (unichar_t *) N_(&quot;_Point of View Projection...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Point of View Projection...|No Shortcut&quot;), NULL, NULL, CVMenuPOV, 0 },
<span class="lineNum">   11961 </span>            :     { { (unichar_t *) N_(&quot;_Non Linear Transform...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Non Linear Transform...|No Shortcut&quot;), NULL, NULL, CVMenuNLTransform, 0 },
<span class="lineNum">   11962 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11963 </span>            : };
<span class="lineNum">   11964 </span>            : 
<span class="lineNum">   11965 </span>            : static GMenuItem2 rndlist[] = {
<span class="lineNum">   11966 </span>            :     { { (unichar_t *) N_(&quot;To _Int&quot;), (GImage *) &quot;elementround.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'I' }, H_(&quot;To Int|No Shortcut&quot;), NULL, NULL, CVMenuRound2Int, MID_Round },
<span class="lineNum">   11967 </span>            :     { { (unichar_t *) N_(&quot;To _Hundredths&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'I' }, H_(&quot;To Hundredths|No Shortcut&quot;), NULL, NULL, CVMenuRound2Hundredths, 0 },
<span class="lineNum">   11968 </span>            :     { { (unichar_t *) N_(&quot;_Cluster&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'I' }, H_(&quot;Cluster|No Shortcut&quot;), NULL, NULL, CVMenuCluster, MID_RoundToCluster },
<span class="lineNum">   11969 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   11970 </span>            : };
<span class="lineNum">   11971 </span>            : 
<span class="lineNum">   11972 </span>            : static GMenuItem2 ellist[] = {
<span class="lineNum">   11973 </span>            :     { { (unichar_t *) N_(&quot;_Font Info...&quot;), (GImage *) &quot;elementfontinfo.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'F' }, H_(&quot;Font Info...|No Shortcut&quot;), NULL, NULL, CVMenuFontInfo, MID_FontInfo },
<span class="lineNum">   11974 </span>            :     { { (unichar_t *) N_(&quot;_Glyph Info...&quot;), (GImage *) &quot;elementglyphinfo.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'I' }, H_(&quot;Glyph Info...|No Shortcut&quot;), NULL, NULL, CVMenuCharInfo, MID_CharInfo },
<span class="lineNum">   11975 </span>            :     { { (unichar_t *) N_(&quot;Get _Info...&quot;), (GImage *) &quot;elementgetinfo.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'I' }, H_(&quot;Get Info...|No Shortcut&quot;), NULL, NULL, CVMenuGetInfo, MID_GetInfo },
<span class="lineNum">   11976 </span>            :     { { (unichar_t *) N_(&quot;S_how Dependent&quot;), (GImage *) &quot;elementshowdep.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'D' }, H_(&quot;Show Dependent|No Shortcut&quot;), delist, delistcheck, NULL, MID_ShowDependentRefs },
<span class="lineNum">   11977 </span>            :     { { (unichar_t *) N_(&quot;Find Proble_ms...&quot;), (GImage *) &quot;elementfindprobs.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Find Problems...|No Shortcut&quot;), NULL, NULL, CVMenuFindProblems, MID_FindProblems },
<span class="lineNum">   11978 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11979 </span>            :     { { (unichar_t *) N_(&quot;Bitm_ap strikes Available...&quot;), (GImage *) &quot;elementbitmapsavail.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'A' }, H_(&quot;Bitmap strikes Available...|No Shortcut&quot;), NULL, NULL, CVMenuBitmaps, MID_AvailBitmaps },
<span class="lineNum">   11980 </span>            :     { { (unichar_t *) N_(&quot;Regenerate _Bitmap Glyphs...&quot;), (GImage *) &quot;elementregenbitmaps.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'B' }, H_(&quot;Regenerate Bitmap Glyphs...|No Shortcut&quot;), NULL, NULL, CVMenuBitmaps, MID_RegenBitmaps },
<span class="lineNum">   11981 </span>            :     { { (unichar_t *) N_(&quot;Remove Bitmap Glyphs...&quot;), (GImage *) &quot;elementremovebitmaps.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;Remove Bitmap Glyphs...|No Shortcut&quot;), NULL, NULL, CVMenuBitmaps, MID_RemoveBitmaps },
<span class="lineNum">   11982 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11983 </span>            :     { { (unichar_t *) N_(&quot;St_yles&quot;), (GImage *) &quot;elementstyles.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;Styles|No Shortcut&quot;), eflist, NULL, NULL, MID_Styles },
<span class="lineNum">   11984 </span>            :     { { (unichar_t *) N_(&quot;_Transformations&quot;), (GImage *) &quot;elementtransform.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Transformations|No Shortcut&quot;), trlist, NULL, NULL, 0 },
<span class="lineNum">   11985 </span>            :     { { (unichar_t *) N_(&quot;_Expand Stroke...&quot;), (GImage *) &quot;elementexpandstroke.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'E' }, H_(&quot;Expand Stroke...|No Shortcut&quot;), NULL, NULL, CVMenuStroke, MID_Stroke },
<span class="lineNum">   11986 </span>            : #ifdef FONTFORGE_CONFIG_TILEPATH
<span class="lineNum">   11987 </span>            :     { { (unichar_t *) N_(&quot;Tile _Path...&quot;), (GImage *) &quot;elementtilepath.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Tile Path...|No Shortcut&quot;), NULL, NULL, CVMenuTilePath, MID_TilePath },
<span class="lineNum">   11988 </span>            :     { { (unichar_t *) N_(&quot;Tile Pattern...&quot;), (GImage *) &quot;elementtilepattern.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;Tile Pattern...|No Shortcut&quot;), NULL, NULL, CVMenuPatternTile, 0 },
<span class="lineNum">   11989 </span>            : #endif
<span class="lineNum">   11990 </span>            :     { { (unichar_t *) N_(&quot;O_verlap&quot;), (GImage *) &quot;overlaprm.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'v' }, H_(&quot;Overlap|No Shortcut&quot;), rmlist, NULL, NULL, MID_RmOverlap },
<span class="lineNum">   11991 </span>            :     { { (unichar_t *) N_(&quot;_Simplify&quot;), (GImage *) &quot;elementsimplify.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'S' }, H_(&quot;Simplify|No Shortcut&quot;), smlist, smlistcheck, NULL, MID_Simplify },
<span class="lineNum">   11992 </span>            :     { { (unichar_t *) N_(&quot;Add E_xtrema&quot;), (GImage *) &quot;elementaddextrema.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'x' }, H_(&quot;Add Extrema|No Shortcut&quot;), NULL, NULL, CVMenuAddExtrema, MID_AddExtrema },
<span class="lineNum">   11993 </span>            :     { { (unichar_t *) N_(&quot;Autot_race&quot;), (GImage *) &quot;elementautotrace.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'r' }, H_(&quot;Autotrace|No Shortcut&quot;), NULL, NULL, CVMenuAutotrace, MID_Autotrace },
<span class="lineNum">   11994 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11995 </span>            :     { { (unichar_t *) N_(&quot;A_lign&quot;), (GImage *) &quot;elementalign.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Align|No Shortcut&quot;), allist, allistcheck, NULL, MID_Align },
<span class="lineNum">   11996 </span>            :     { { (unichar_t *) N_(&quot;Roun_d&quot;), (GImage *) &quot;elementround.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'I' }, H_(&quot;Round|No Shortcut&quot;), rndlist, rndlistcheck, NULL, MID_Round },
<span class="lineNum">   11997 </span>            :     { { (unichar_t *) N_(&quot;_Order&quot;), (GImage *) &quot;elementorder.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;Order|No Shortcut&quot;), orlist, orlistcheck, NULL, 0 },
<span class="lineNum">   11998 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   11999 </span>            :     { { (unichar_t *) N_(&quot;Check Self-Intersection&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Clockwise|No Shortcut&quot;), NULL, NULL, CVMenuCheckSelf, MID_CheckSelf },
<span class="lineNum">   12000 </span>            :     { { (unichar_t *) N_(&quot;Glyph Self-Intersects&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Clockwise|No Shortcut&quot;), NULL, NULL, CVMenuGlyphSelfIntersects, MID_GlyphSelfIntersects },
<span class="lineNum">   12001 </span>            :     { { (unichar_t *) N_(&quot;Cloc_kwise&quot;), (GImage *) &quot;elementclockwise.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Clockwise|No Shortcut&quot;), NULL, NULL, CVMenuDir, MID_Clockwise },
<span class="lineNum">   12002 </span>            :     { { (unichar_t *) N_(&quot;Cou_nter Clockwise&quot;), (GImage *) &quot;elementanticlock.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'n' }, H_(&quot;Counter Clockwise|No Shortcut&quot;), NULL, NULL, CVMenuDir, MID_Counter },
<span class="lineNum">   12003 </span>            :     { { (unichar_t *) N_(&quot;_Correct Direction&quot;), (GImage *) &quot;elementcorrectdir.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'D' }, H_(&quot;Correct Direction|No Shortcut&quot;), NULL, NULL, CVMenuCorrectDir, MID_Correct },
<span class="lineNum">   12004 </span>            :     { { (unichar_t *) N_(&quot;Reverse Direction&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'D' }, H_(&quot;Reverse Direction|No Shortcut&quot;), NULL, NULL, CVMenuReverseDir, MID_ReverseDir },
<span class="lineNum">   12005 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12006 </span>            :     { { (unichar_t *) N_(&quot;Insert Text Outlines...&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'D' }, H_(&quot;Insert Text Outlines|No Shortcut&quot;), NULL, NULL, CVMenuInsertText, MID_InsertText },
<span class="lineNum">   12007 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12008 </span>            :     { { (unichar_t *) N_(&quot;B_uild&quot;), (GImage *) &quot;elementbuildaccent.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'u' }, H_(&quot;Build|No Shortcut&quot;), balist, balistcheck, NULL, MID_BuildAccent },
<span class="lineNum">   12009 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12010 </span>            :     { { (unichar_t *) N_(&quot;Compare Layers...&quot;), (GImage *) &quot;elementcomparelayers.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'u' }, H_(&quot;Compare Layers...|No Shortcut&quot;), NULL, NULL, CVMenuCompareL2L, 0 },
<span class="lineNum">   12011 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   12012 </span>            : };
<span class="lineNum">   12013 </span>            : 
<span class="lineNum">   12014 </span>            : static GMenuItem2 htlist[] = {
<span class="lineNum">   12015 </span>            :     { { (unichar_t *) N_(&quot;Auto_Hint&quot;), (GImage *) &quot;hintsautohint.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'H' }, H_(&quot;AutoHint|No Shortcut&quot;), NULL, NULL, CVMenuAutoHint, MID_AutoHint },
<span class="lineNum">   12016 </span>            :     { { (unichar_t *) N_(&quot;Hint _Substitution Pts&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'H' }, H_(&quot;Hint Substitution Pts|No Shortcut&quot;), NULL, NULL, CVMenuAutoHintSubs, MID_HintSubsPt },
<span class="lineNum">   12017 </span>            :     { { (unichar_t *) N_(&quot;Auto _Counter Hint&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'H' }, H_(&quot;Auto Counter Hint|No Shortcut&quot;), NULL, NULL, CVMenuAutoCounter, MID_AutoCounter },
<span class="lineNum">   12018 </span>            :     { { (unichar_t *) N_(&quot;_Don't AutoHint&quot;), (GImage *) &quot;hintsdontautohint.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'H' }, H_(&quot;Don't AutoHint|No Shortcut&quot;), NULL, NULL, CVMenuDontAutoHint, MID_DontAutoHint },
<span class="lineNum">   12019 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12020 </span>            :     { { (unichar_t *) N_(&quot;Auto_Instr&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;AutoInstr|No Shortcut&quot;), NULL, NULL, CVMenuNowakAutoInstr, MID_AutoInstr },
<span class="lineNum">   12021 </span>            :     { { (unichar_t *) N_(&quot;_Edit Instructions...&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Edit Instructions...|No Shortcut&quot;), NULL, NULL, CVMenuEditInstrs, MID_EditInstructions },
<span class="lineNum">   12022 </span>            :     { { (unichar_t *) N_(&quot;_Debug...&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Debug...|No Shortcut&quot;), NULL, NULL, CVMenuDebug, MID_Debug },
<span class="lineNum">   12023 </span>            :     { { (unichar_t *) N_(&quot;S_uggest Deltas...&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Suggest Deltas|No Shortcut&quot;), NULL, NULL, CVMenuDeltas, MID_Deltas },
<span class="lineNum">   12024 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12025 </span>            :     { { (unichar_t *) N_(&quot;_Clear HStem&quot;), (GImage *) &quot;hintsclearhstems.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'C' }, H_(&quot;Clear HStem|No Shortcut&quot;), NULL, NULL, CVMenuClearHints, MID_ClearHStem },
<span class="lineNum">   12026 </span>            :     { { (unichar_t *) N_(&quot;Clear _VStem&quot;), (GImage *) &quot;hintsclearvstems.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'V' }, H_(&quot;Clear VStem|No Shortcut&quot;), NULL, NULL, CVMenuClearHints, MID_ClearVStem },
<span class="lineNum">   12027 </span>            :     { { (unichar_t *) N_(&quot;Clear DStem&quot;), (GImage *) &quot;hintscleardstems.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'V' }, H_(&quot;Clear DStem|No Shortcut&quot;), NULL, NULL, CVMenuClearHints, MID_ClearDStem },
<span class="lineNum">   12028 </span>            :     { { (unichar_t *) N_(&quot;Clear Instructions&quot;),  (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;Clear Instructions|No Shortcut&quot;), NULL, NULL, CVMenuClearInstrs, MID_ClearInstr },
<span class="lineNum">   12029 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12030 </span>            :     { { (unichar_t *) N_(&quot;_Add HHint&quot;), (GImage *) &quot;hintsaddhstem.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'A' }, H_(&quot;Add HHint|No Shortcut&quot;), NULL, NULL, CVMenuAddHint, MID_AddHHint },
<span class="lineNum">   12031 </span>            :     { { (unichar_t *) N_(&quot;Add VHi_nt&quot;), (GImage *) &quot;hintsaddvstem.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 's' }, H_(&quot;Add VHint|No Shortcut&quot;), NULL, NULL, CVMenuAddHint, MID_AddVHint },
<span class="lineNum">   12032 </span>            :     { { (unichar_t *) N_(&quot;Add DHint&quot;), (GImage *) &quot;hintsadddstem.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 't' }, H_(&quot;Add DHint|No Shortcut&quot;), NULL, NULL, CVMenuAddHint, MID_AddDHint },
<span class="lineNum">   12033 </span>            :     { { (unichar_t *) N_(&quot;Crea_te HHint...&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'r' }, H_(&quot;Create HHint...|No Shortcut&quot;), NULL, NULL, CVMenuCreateHint, MID_CreateHHint },
<span class="lineNum">   12034 </span>            :     { { (unichar_t *) N_(&quot;Cr_eate VHint...&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'e' }, H_(&quot;Create VHint...|No Shortcut&quot;), NULL, NULL, CVMenuCreateHint, MID_CreateVHint },
<span class="lineNum">   12035 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12036 </span>            :     { { (unichar_t *) N_(&quot;_Review Hints...&quot;), (GImage *) &quot;hintsreviewhints.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Review Hints...|No Shortcut&quot;), NULL, NULL, CVMenuReviewHints, MID_ReviewHints },
<span class="lineNum">   12037 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   12038 </span>            : };
<span class="lineNum">   12039 </span>            : 
<span class="lineNum">   12040 </span>            : static GMenuItem2 ap2list[] = {
<span class="lineNum">   12041 </span>            :     GMENUITEM2_EMPTY
<a name="12042"><span class="lineNum">   12042 </span>            : };</a>
<span class="lineNum">   12043 </span>            : 
<span class="lineNum">   12044 </span><span class="lineNoCov">          0 : static void ap2listbuild(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   12045 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   12046 </span>            :     char buf[300];
<span class="lineNum">   12047 </span>            :     GMenuItem *sub;
<span class="lineNum">   12048 </span>            :     int k, cnt;
<span class="lineNum">   12049 </span>            :     AnchorPoint *ap;
<span class="lineNum">   12050 </span>            : 
<span class="lineNum">   12051 </span><span class="lineNoCov">          0 :     if ( mi-&gt;sub!=NULL ) {</span>
<span class="lineNum">   12052 </span><span class="lineNoCov">          0 :         GMenuItemArrayFree(mi-&gt;sub);</span>
<span class="lineNum">   12053 </span><span class="lineNoCov">          0 :         mi-&gt;sub = NULL;</span>
<span class="lineNum">   12054 </span>            :     }
<span class="lineNum">   12055 </span>            : 
<span class="lineNum">   12056 </span><span class="lineNoCov">          0 :     for ( k=0; k&lt;2; ++k ) {</span>
<span class="lineNum">   12057 </span><span class="lineNoCov">          0 :         cnt = 0;</span>
<span class="lineNum">   12058 </span><span class="lineNoCov">          0 :         for ( ap=cv-&gt;b.sc-&gt;anchor; ap!=NULL; ap=ap-&gt;next ) {</span>
<span class="lineNum">   12059 </span><span class="lineNoCov">          0 :             if ( k ) {</span>
<span class="lineNum">   12060 </span><span class="lineNoCov">          0 :                 if ( ap-&gt;type==at_baselig )</span>
<span class="lineNum">   12061 </span>            : /* GT: In the next few lines the &quot;%s&quot; is the name of an anchor class, and the */
<span class="lineNum">   12062 </span>            : /* GT: rest of the string identifies the type of the anchor */
<span class="lineNum">   12063 </span><span class="lineNoCov">          0 :                     snprintf(buf,sizeof(buf), _(&quot;%s at ligature pos %d&quot;), ap-&gt;anchor-&gt;name, ap-&gt;lig_index );</span>
<span class="lineNum">   12064 </span>            :                 else
<span class="lineNum">   12065 </span><span class="lineNoCov">          0 :                     snprintf(buf,sizeof(buf),</span>
<span class="lineNum">   12066 </span><span class="lineNoCov">          0 :                         ap-&gt;type==at_cexit ? _(&quot;%s exit&quot;):</span>
<span class="lineNum">   12067 </span><span class="lineNoCov">          0 :                         ap-&gt;type==at_centry ? _(&quot;%s entry&quot;):</span>
<span class="lineNum">   12068 </span><span class="lineNoCov">          0 :                         ap-&gt;type==at_mark ? _(&quot;%s mark&quot;):</span>
<span class="lineNum">   12069 </span><span class="lineNoCov">          0 :                             _(&quot;%s base&quot;),ap-&gt;anchor-&gt;name );</span>
<span class="lineNum">   12070 </span><span class="lineNoCov">          0 :                 sub[cnt].ti.text = utf82u_copy(buf);</span>
<span class="lineNum">   12071 </span><span class="lineNoCov">          0 :                 sub[cnt].ti.userdata = ap;</span>
<span class="lineNum">   12072 </span><span class="lineNoCov">          0 :                 sub[cnt].ti.bg = sub[cnt].ti.fg = COLOR_DEFAULT;</span>
<span class="lineNum">   12073 </span><span class="lineNoCov">          0 :                 sub[cnt].invoke = CVMenuAnchorsAway;</span>
<span class="lineNum">   12074 </span>            :             }
<span class="lineNum">   12075 </span><span class="lineNoCov">          0 :             ++cnt;</span>
<span class="lineNum">   12076 </span>            :         }
<span class="lineNum">   12077 </span><span class="lineNoCov">          0 :         if ( !k )</span>
<span class="lineNum">   12078 </span><span class="lineNoCov">          0 :             sub = calloc(cnt+1,sizeof(GMenuItem));</span>
<span class="lineNum">   12079 </span>            :     }
<span class="lineNum">   12080 </span><span class="lineNoCov">          0 :     mi-&gt;sub = sub;</span>
<a name="12081"><span class="lineNum">   12081 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   12082 </span>            : 
<span class="lineNum">   12083 </span><span class="lineNoCov">          0 : static void CVMenuKernByClasses(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">   12084 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   12085 </span><span class="lineNoCov">          0 :     MetricsView *mv = 0;</span>
<span class="lineNum">   12086 </span><span class="lineNoCov">          0 :     SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">   12087 </span><span class="lineNoCov">          0 :     int cvlayer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">   12088 </span><span class="lineNoCov">          0 :     ShowKernClasses(sf, mv, cvlayer, false);</span>
<a name="12089"><span class="lineNum">   12089 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   12090 </span>            : 
<span class="lineNum">   12091 </span><span class="lineNoCov">          0 : static void CVMenuVKernByClasses(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">   12092 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   12093 </span><span class="lineNoCov">          0 :     MetricsView *mv = 0;</span>
<span class="lineNum">   12094 </span><span class="lineNoCov">          0 :     SplineFont *sf = cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">   12095 </span><span class="lineNoCov">          0 :     int cvlayer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">   12096 </span><span class="lineNoCov">          0 :     ShowKernClasses(sf, mv, cvlayer, true);</span>
<a name="12097"><span class="lineNum">   12097 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   12098 </span>            : 
<span class="lineNum">   12099 </span><span class="lineNoCov">          0 : static void CVMenuVKernFromHKern(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">   12100 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   12101 </span><span class="lineNoCov">          0 :     FVVKernFromHKern((FontViewBase *) cv-&gt;b.fv);</span>
<span class="lineNum">   12102 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   12103 </span>            : 
<span class="lineNum">   12104 </span>            : static GMenuItem2 mtlist[] = {
<span class="lineNum">   12105 </span>            :     { { (unichar_t *) N_(&quot;New _Metrics Window&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;New Metrics Window|No Shortcut&quot;), NULL, NULL, CVMenuOpenMetrics, 0 },
<span class="lineNum">   12106 </span>            :     GMENUITEM2_LINE,
<span class="lineNum">   12107 </span>            :     { { (unichar_t *) N_(&quot;_Center in Width&quot;), (GImage *) &quot;metricscenter.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'C' }, H_(&quot;Center in Width|No Shortcut&quot;), NULL, NULL, CVMenuCenter, MID_Center },
<span class="lineNum">   12108 </span>            :     { { (unichar_t *) N_(&quot;_Thirds in Width&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Thirds in Width|No Shortcut&quot;), NULL, NULL, CVMenuCenter, MID_Thirds },
<span class="lineNum">   12109 </span>            :     { { (unichar_t *) N_(&quot;Set _Width...&quot;), (GImage *) &quot;metricssetwidth.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'W' }, H_(&quot;Set Width...|No Shortcut&quot;), NULL, NULL, CVMenuSetWidth, MID_SetWidth },
<span class="lineNum">   12110 </span>            :     { { (unichar_t *) N_(&quot;Set _LBearing...&quot;), (GImage *) &quot;metricssetlbearing.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'L' }, H_(&quot;Set LBearing...|No Shortcut&quot;), NULL, NULL, CVMenuSetWidth, MID_SetLBearing },
<span class="lineNum">   12111 </span>            :     { { (unichar_t *) N_(&quot;Set _RBearing...&quot;), (GImage *) &quot;metricssetrbearing.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Set RBearing...|No Shortcut&quot;), NULL, NULL, CVMenuSetWidth, MID_SetRBearing },
<span class="lineNum">   12112 </span>            :     { { (unichar_t *) N_(&quot;Set Both Bearings...&quot;), (GImage *) &quot;menuempty.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Set Both Bearings...|No Shortcut&quot;), NULL, NULL, CVMenuSetWidth, MID_SetBearings },
<span class="lineNum">   12113 </span>            :     GMENUITEM2_LINE,
<span class="lineNum">   12114 </span>            :     { { (unichar_t *) N_(&quot;Set _Vertical Advance...&quot;), (GImage *) &quot;metricssetvwidth.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'V' }, H_(&quot;Set Vertical Advance...|No Shortcut&quot;), NULL, NULL, CVMenuSetWidth, MID_SetVWidth },
<span class="lineNum">   12115 </span>            :     GMENUITEM2_LINE,
<span class="lineNum">   12116 </span>            :     { { (unichar_t *) N_(&quot;Ker_n By Classes...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Kern By Classes...|No Shortcut&quot;), NULL, NULL, CVMenuKernByClasses, 0 },
<span class="lineNum">   12117 </span>            :     { { (unichar_t *) N_(&quot;VKern By Classes...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;VKern By Classes...|No Shortcut&quot;), NULL, NULL, CVMenuVKernByClasses, MID_VKernClass },
<span class="lineNum">   12118 </span>            :     { { (unichar_t *) N_(&quot;VKern From HKern&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;VKern From HKern|No Shortcut&quot;), NULL, NULL, CVMenuVKernFromHKern, MID_VKernFromHKern },
<span class="lineNum">   12119 </span>            :     { { (unichar_t *) N_(&quot;Remove Kern _Pairs&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Remove Kern Pairs|No Shortcut&quot;), NULL, NULL, CVMenuRemoveKern, MID_RemoveKerns },
<span class="lineNum">   12120 </span>            :     { { (unichar_t *) N_(&quot;Remove VKern Pairs&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Remove VKern Pairs|No Shortcut&quot;), NULL, NULL, CVMenuRemoveVKern, MID_RemoveVKerns },
<span class="lineNum">   12121 </span>            :     { { (unichar_t *) N_(&quot;Kern Pair Closeup...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Kern Pair Closeup...|No Shortcut&quot;), NULL, NULL, CVMenuKPCloseup, MID_KPCloseup },
<span class="lineNum">   12122 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   12123 </span>            : };
<span class="lineNum">   12124 </span>            : 
<span class="lineNum">   12125 </span>            : static GMenuItem2 pllist[] = {
<span class="lineNum">   12126 </span>            :     { { (unichar_t *) N_(&quot;_Tools&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'T' }, H_(&quot;Tools|No Shortcut&quot;), NULL, NULL, CVMenuPaletteShow, MID_Tools },
<span class="lineNum">   12127 </span>            :     { { (unichar_t *) N_(&quot;_Layers&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'L' }, H_(&quot;Layers|No Shortcut&quot;), NULL, NULL, CVMenuPaletteShow, MID_Layers },
<span class="lineNum">   12128 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12129 </span>            :     { { (unichar_t *) N_(&quot;_Docked Palettes&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'D' }, H_(&quot;Docked Palettes|No Shortcut&quot;), NULL, NULL, CVMenuPalettesDock, MID_DockPalettes },
<span class="lineNum">   12130 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   12131 </span>            : };
<span class="lineNum">   12132 </span>            : 
<span class="lineNum">   12133 </span>            : static GMenuItem2 aplist[] = {
<span class="lineNum">   12134 </span>            :     { { (unichar_t *) N_(&quot;_Detach&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'K' }, H_(&quot;Detach|No Shortcut&quot;), NULL, NULL, CVMenuAPDetach, 0 },
<span class="lineNum">   12135 </span>            :     GMENUITEM2_EMPTY
<a name="12136"><span class="lineNum">   12136 </span>            : };</a>
<span class="lineNum">   12137 </span>            : 
<span class="lineNum">   12138 </span><span class="lineNoCov">          0 : static void aplistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   12139 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   12140 </span><span class="lineNoCov">          0 :     SplineChar *sc = cv-&gt;b.sc, **glyphs;</span>
<span class="lineNum">   12141 </span><span class="lineNoCov">          0 :     SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">   12142 </span>            :     AnchorPoint *ap, *found;
<span class="lineNum">   12143 </span>            :     GMenuItem2 *mit;
<span class="lineNum">   12144 </span>            :     int cnt;
<span class="lineNum">   12145 </span>            : 
<span class="lineNum">   12146 </span><span class="lineNoCov">          0 :     found = NULL;</span>
<span class="lineNum">   12147 </span><span class="lineNoCov">          0 :     for ( ap=sc-&gt;anchor; ap!=NULL; ap=ap-&gt;next ) {</span>
<span class="lineNum">   12148 </span><span class="lineNoCov">          0 :         if ( ap-&gt;selected ) {</span>
<span class="lineNum">   12149 </span><span class="lineNoCov">          0 :             if ( found==NULL )</span>
<span class="lineNum">   12150 </span><span class="lineNoCov">          0 :                 found = ap;</span>
<span class="lineNum">   12151 </span>            :             else {
<span class="lineNum">   12152 </span>            :                 /* Can't deal with two selected anchors */
<span class="lineNum">   12153 </span><span class="lineNoCov">          0 :                 found = NULL;</span>
<span class="lineNum">   12154 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">   12155 </span>            :             }
<span class="lineNum">   12156 </span>            :         }
<span class="lineNum">   12157 </span>            :     }
<span class="lineNum">   12158 </span>            : 
<span class="lineNum">   12159 </span><span class="lineNoCov">          0 :     GMenuItemArrayFree(mi-&gt;sub);</span>
<span class="lineNum">   12160 </span><span class="lineNoCov">          0 :     if ( found==NULL )</span>
<span class="lineNum">   12161 </span><span class="lineNoCov">          0 :         glyphs = NULL;</span>
<span class="lineNum">   12162 </span>            :     else
<span class="lineNum">   12163 </span><span class="lineNoCov">          0 :         glyphs = GlyphsMatchingAP(sf,found);</span>
<span class="lineNum">   12164 </span><span class="lineNoCov">          0 :     if ( glyphs==NULL ) {</span>
<span class="lineNum">   12165 </span><span class="lineNoCov">          0 :         mi-&gt;sub = GMenuItem2ArrayCopy(aplist,NULL);</span>
<span class="lineNum">   12166 </span><span class="lineNoCov">          0 :         mi-&gt;sub-&gt;ti.disabled = (cv-&gt;apmine==NULL);</span>
<span class="lineNum">   12167 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   12168 </span>            :     }
<span class="lineNum">   12169 </span>            : 
<span class="lineNum">   12170 </span><span class="lineNoCov">          0 :     for ( cnt = 0; glyphs[cnt]!=NULL; ++cnt );</span>
<span class="lineNum">   12171 </span><span class="lineNoCov">          0 :     mit = calloc(cnt+2,sizeof(GMenuItem2));</span>
<span class="lineNum">   12172 </span><span class="lineNoCov">          0 :     mit[0] = aplist[0];</span>
<span class="lineNum">   12173 </span><span class="lineNoCov">          0 :     mit[0].ti.text = (unichar_t *) copy( (char *) mit[0].ti.text );</span>
<span class="lineNum">   12174 </span><span class="lineNoCov">          0 :     mit[0].ti.disabled = (cv-&gt;apmine==NULL);</span>
<span class="lineNum">   12175 </span><span class="lineNoCov">          0 :     for ( cnt = 0; glyphs[cnt]!=NULL; ++cnt ) {</span>
<span class="lineNum">   12176 </span><span class="lineNoCov">          0 :         mit[cnt+1].ti.text = (unichar_t *) copy(glyphs[cnt]-&gt;name);</span>
<span class="lineNum">   12177 </span><span class="lineNoCov">          0 :         mit[cnt+1].ti.text_is_1byte = true;</span>
<span class="lineNum">   12178 </span><span class="lineNoCov">          0 :         mit[cnt+1].ti.fg = mit[cnt+1].ti.bg = COLOR_DEFAULT;</span>
<span class="lineNum">   12179 </span><span class="lineNoCov">          0 :         mit[cnt+1].ti.userdata = glyphs[cnt];</span>
<span class="lineNum">   12180 </span><span class="lineNoCov">          0 :         mit[cnt+1].invoke = CVMenuAPAttachSC;</span>
<span class="lineNum">   12181 </span><span class="lineNoCov">          0 :         if ( glyphs[cnt]==cv-&gt;apsc )</span>
<span class="lineNum">   12182 </span><span class="lineNoCov">          0 :             mit[cnt+1].ti.checked = mit[cnt+1].ti.checkable = true;</span>
<span class="lineNum">   12183 </span>            :     }
<span class="lineNum">   12184 </span><span class="lineNoCov">          0 :     free(glyphs);</span>
<span class="lineNum">   12185 </span><span class="lineNoCov">          0 :     mi-&gt;sub = GMenuItem2ArrayCopy(mit,NULL);</span>
<span class="lineNum">   12186 </span><span class="lineNoCov">          0 :     GMenuItem2ArrayFree(mit);</span>
<a name="12187"><span class="lineNum">   12187 </span>            : }</a>
<span class="lineNum">   12188 </span>            : 
<span class="lineNum">   12189 </span><span class="lineNoCov">          0 : static void CVMoveInWordListByOffset( CharView* cv, int offset )</span>
<span class="lineNum">   12190 </span>            : {
<span class="lineNum">   12191 </span><span class="lineNoCov">          0 :     Wordlist_MoveByOffset( cv-&gt;charselector, &amp;cv-&gt;charselectoridx, offset );</span>
<a name="12192"><span class="lineNum">   12192 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   12193 </span>            : 
<span class="lineNum">   12194 </span><span class="lineNoCov">          0 : static void CVMenuNextLineInWordList(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   12195 </span><span class="lineNoCov">          0 :     CharView* cv = (CharView*) GDrawGetUserData(gw);</span>
<a name="12196"><span class="lineNum">   12196 </span><span class="lineNoCov">          0 :     CVMoveInWordListByOffset( cv, 1 );</span></a>
<span class="lineNum">   12197 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   12198 </span><span class="lineNoCov">          0 : static void CVMenuPrevLineInWordList(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   12199 </span><span class="lineNoCov">          0 :     CharView* cv = (CharView*) GDrawGetUserData(gw);</span>
<span class="lineNum">   12200 </span><span class="lineNoCov">          0 :     CVMoveInWordListByOffset( cv, -1 );</span>
<span class="lineNum">   12201 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   12202 </span>            : 
<span class="lineNum">   12203 </span>            : static GMenuItem2 cblist[] = {
<span class="lineNum">   12204 </span>            :     { { (unichar_t *) N_(&quot;_Kern Pairs&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'K' }, H_(&quot;Kern Pairs|No Shortcut&quot;), NULL, NULL, CVMenuKernPairs, MID_KernPairs },
<span class="lineNum">   12205 </span>            :     { { (unichar_t *) N_(&quot;_Anchored Pairs&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'A' }, H_(&quot;Anchored Pairs|No Shortcut&quot;), NULL, NULL, CVMenuAnchorPairs, MID_AnchorPairs },
<span class="lineNum">   12206 </span>            :     { { (unichar_t *) N_(&quot;_Anchor Control...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'V' }, H_(&quot;Anchor Control...|No Shortcut&quot;), ap2list, ap2listbuild, NULL, MID_AnchorControl },
<span class="lineNum">   12207 </span>            :     { { (unichar_t *) N_(&quot;Anchor _Glyph at Point&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'A' }, H_(&quot;Anchor Glyph at Point|No Shortcut&quot;), aplist, aplistcheck, NULL, MID_AnchorGlyph },
<span class="lineNum">   12208 </span>            :     { { (unichar_t *) N_(&quot;_Ligatures&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'L' }, H_(&quot;Ligatures|No Shortcut&quot;), NULL, NULL, CVMenuLigatures, MID_Ligatures },
<span class="lineNum">   12209 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   12210 </span>            : };
<span class="lineNum">   12211 </span>            : 
<span class="lineNum">   12212 </span>            : static GMenuItem2 nplist[] = {
<span class="lineNum">   12213 </span>            :     { { (unichar_t *) N_(&quot;PointNumbers|_None&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'K' }, H_(&quot;None|No Shortcut&quot;), NULL, NULL, CVMenuNumberPoints, MID_PtsNone },
<span class="lineNum">   12214 </span>            :     { { (unichar_t *) N_(&quot;_TrueType&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'A' }, H_(&quot;TrueType|No Shortcut&quot;), NULL, NULL, CVMenuNumberPoints, MID_PtsTrue },
<span class="lineNum">   12215 </span>            :     { { (unichar_t *) NU_(&quot;_PostScript&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'L' }, H_(&quot;PostScript|No Shortcut&quot;), NULL, NULL, CVMenuNumberPoints, MID_PtsPost },
<span class="lineNum">   12216 </span>            :     { { (unichar_t *) N_(&quot;_SVG&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'L' }, H_(&quot;SVG|No Shortcut&quot;), NULL, NULL, CVMenuNumberPoints, MID_PtsSVG },
<span class="lineNum">   12217 </span>            :     { { (unichar_t *) N_(&quot;P_ositions&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'L' }, H_(&quot;Positions|No Shortcut&quot;), NULL, NULL, CVMenuNumberPoints, MID_PtsPos },
<span class="lineNum">   12218 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   12219 </span>            : };
<span class="lineNum">   12220 </span>            : 
<span class="lineNum">   12221 </span>            : static GMenuItem2 gflist[] = {
<span class="lineNum">   12222 </span>            :     { { (unichar_t *) N_(&quot;Show _Grid Fit...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Show Grid Fit...|No Shortcut&quot;), NULL, NULL, CVMenuShowGridFit, MID_ShowGridFit },
<span class="lineNum">   12223 </span>            :     { { (unichar_t *) N_(&quot;Show _Grid Fit (Live Update)...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Show Grid Fit (Live Update)...|No Shortcut&quot;), NULL, NULL, CVMenuShowGridFitLiveUpdate, MID_ShowGridFitLiveUpdate },
<span class="lineNum">   12224 </span>            :     { { (unichar_t *) N_(&quot;_Bigger Point Size&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'B' }, H_(&quot;Bigger Point Size|No Shortcut&quot;), NULL, NULL, CVMenuChangePointSize, MID_Bigger },
<span class="lineNum">   12225 </span>            :     { { (unichar_t *) N_(&quot;_Smaller Point Size&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'S' }, H_(&quot;Smaller Point Size|No Shortcut&quot;), NULL, NULL, CVMenuChangePointSize, MID_Smaller },
<span class="lineNum">   12226 </span>            :     { { (unichar_t *) N_(&quot;_Anti Alias&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'L' }, H_(&quot;Grid Fit Anti Alias|No Shortcut&quot;), NULL, NULL, CVMenuChangePointSize, MID_GridFitAA },
<span class="lineNum">   12227 </span>            :     { { (unichar_t *) N_(&quot;_Off&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'S' }, H_(&quot;Grid Fit Off|No Shortcut&quot;), NULL, NULL, CVMenuChangePointSize, MID_GridFitOff },
<span class="lineNum">   12228 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   12229 </span>            : };
<span class="lineNum">   12230 </span>            : 
<span class="lineNum">   12231 </span>            : static GMenuItem2 swlist[] = {
<span class="lineNum">   12232 </span>            :     { { (unichar_t *) N_(&quot;_Points&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Points|No Shortcut&quot;), NULL, NULL, CVMenuShowHide, MID_HidePoints },
<span class="lineNum">   12233 </span>            :     { { (unichar_t *) N_(&quot;Control Points (Always_)&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, ')' }, H_(&quot;Control Points (Always)|No Shortcut&quot;), NULL, NULL, CVMenuShowHideControlPoints, MID_HideControlPoints },
<span class="lineNum">   12234 </span>            :     { { (unichar_t *) N_(&quot;_Control Point Info&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Control Point Info|No Shortcut&quot;), NULL, NULL, CVMenuShowCPInfo, MID_ShowCPInfo },
<span class="lineNum">   12235 </span>            :     { { (unichar_t *) N_(&quot;_Extrema&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Extrema|No Shortcut&quot;), NULL, NULL, CVMenuMarkExtrema, MID_MarkExtrema },
<span class="lineNum">   12236 </span>            :     { { (unichar_t *) N_(&quot;Points of _Inflection&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Points of Inflection|No Shortcut&quot;), NULL, NULL, CVMenuMarkPointsOfInflection, MID_MarkPointsOfInflection },
<span class="lineNum">   12237 </span>            :     { { (unichar_t *) N_(&quot;Almost Horizontal/Vertical Lines&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Almost Horizontal/Vertical Lines|No Shortcut&quot;), NULL, NULL, CVMenuShowAlmostHV, MID_ShowAlmostHV },
<span class="lineNum">   12238 </span>            :     { { (unichar_t *) N_(&quot;Almost Horizontal/Vertical Curves&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Almost Horizontal/Vertical Curves|No Shortcut&quot;), NULL, NULL, CVMenuShowAlmostHVCurves, MID_ShowAlmostHVCurves },
<span class="lineNum">   12239 </span>            :     { { (unichar_t *) N_(&quot;(Define \&quot;Almost\&quot;)&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;(Define \&quot;Almost\&quot;)|No Shortcut&quot;), NULL, NULL, CVMenuDefineAlmost, MID_DefineAlmost },
<span class="lineNum">   12240 </span>            :     { { (unichar_t *) N_(&quot;_Side Bearings&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Side Bearings|No Shortcut&quot;), NULL, NULL, CVMenuShowSideBearings, MID_ShowSideBearings },
<span class="lineNum">   12241 </span>            :     { { (unichar_t *) N_(&quot;Reference Names&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Reference Names|No Shortcut&quot;), NULL, NULL, CVMenuShowRefNames, MID_ShowRefNames },
<span class="lineNum">   12242 </span>            :     { { (unichar_t *) N_(&quot;_Fill&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Fill|No Shortcut&quot;), NULL, NULL, CVMenuFill, MID_Fill },
<span class="lineNum">   12243 </span>            :     { { (unichar_t *) N_(&quot;Previe_w&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Preview|No Shortcut&quot;), NULL, NULL, CVMenuPreview, MID_Preview },
<span class="lineNum">   12244 </span>            :     { { (unichar_t *) N_(&quot;Dragging Comparison Outline&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Dragging Comparison Outline|No Shortcut&quot;), NULL, NULL, CVMenuDraggingComparisonOutline, MID_DraggingComparisonOutline },
<span class="lineNum">   12245 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12246 </span>            :     { { (unichar_t *) N_(&quot;Pale_ttes&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Palettes|No Shortcut&quot;), pllist, pllistcheck, NULL, 0 },
<span class="lineNum">   12247 </span>            :     { { (unichar_t *) N_(&quot;_Glyph Tabs&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Glyph Tabs|No Shortcut&quot;), NULL, NULL, CVMenuShowTabs, MID_ShowTabs },
<span class="lineNum">   12248 </span>            :     { { (unichar_t *) N_(&quot;_Rulers&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Rulers|No Shortcut&quot;), NULL, NULL, CVMenuShowHideRulers, MID_HideRulers },
<span class="lineNum">   12249 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12250 </span>            :     { { (unichar_t *) N_(&quot;_Horizontal Hints&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Horizontal Hints|No Shortcut&quot;), NULL, NULL, CVMenuShowHints, MID_ShowHHints },
<span class="lineNum">   12251 </span>            :     { { (unichar_t *) N_(&quot;_Vertical Hints&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Vertical Hints|No Shortcut&quot;), NULL, NULL, CVMenuShowHints, MID_ShowVHints },
<span class="lineNum">   12252 </span>            :     { { (unichar_t *) N_(&quot;_Diagonal Hints&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Diagonal Hints|No Shortcut&quot;), NULL, NULL, CVMenuShowHints, MID_ShowDHints },
<span class="lineNum">   12253 </span>            : /* GT: You might not want to translate this, it's a keyword in PostScript font files */
<span class="lineNum">   12254 </span>            :     { { (unichar_t *) N_(&quot;_BlueValues&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;BlueValues|No Shortcut&quot;), NULL, NULL, CVMenuShowHints, MID_ShowBlueValues },
<span class="lineNum">   12255 </span>            : /* GT: You might not want to translate this, it's a keyword in PostScript font files */
<span class="lineNum">   12256 </span>            :     { { (unichar_t *) N_(&quot;FamilyBl_ues&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Family Blues|No Shortcut&quot;), NULL, NULL, CVMenuShowHints, MID_ShowFamilyBlues },
<span class="lineNum">   12257 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12258 </span>            :     { { (unichar_t *) N_(&quot;_Anchors&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Anchors|No Shortcut&quot;), NULL, NULL, CVMenuShowHints, MID_ShowAnchors },
<span class="lineNum">   12259 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12260 </span>            :     { { (unichar_t *) N_(&quot;Debug Raster Cha_nges&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Debug Raster Changes|No Shortcut&quot;), NULL, NULL, CVMenuShowHints, MID_ShowDebugChanges },
<span class="lineNum">   12261 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12262 </span>            :     { { (unichar_t *) N_(&quot;Hori_zontal Metric Lines&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Hori_zontal Metric Lines|No Shortcut&quot;), NULL, NULL, CVMenuShowHints, MID_ShowHMetrics },
<span class="lineNum">   12263 </span>            :     { { (unichar_t *) N_(&quot;Vertical _Metric Lines&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Vertical Metric Lines|No Shortcut&quot;), NULL, NULL, CVMenuShowHints, MID_ShowVMetrics },
<span class="lineNum">   12264 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12265 </span>            :     { { (unichar_t *) N_(&quot;Snap Outlines to Pi_xel Grid&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 1, 0, 0, 0, 1, 1, 0, 'R' }, H_(&quot;Snap Outlines to Pixel Grid|No Shortcut&quot;), NULL, NULL, CVMenuSnapOutlines, MID_SnapOutlines },
<span class="lineNum">   12266 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   12267 </span>            : };
<span class="lineNum">   12268 </span>            : 
<span class="lineNum">   12269 </span>            : static GMenuItem2 vwlist[] = {
<span class="lineNum">   12270 </span>            :     { { (unichar_t *) N_(&quot;_Fit&quot;), (GImage *) &quot;viewfit.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'F' }, H_(&quot;Fit|No Shortcut&quot;), NULL, NULL, CVMenuScale, MID_Fit },
<span class="lineNum">   12271 </span>            :     { { (unichar_t *) N_(&quot;Z_oom out&quot;), (GImage *) &quot;viewzoomout.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Zoom out|No Shortcut&quot;), NULL, NULL, CVMenuScale, MID_ZoomOut },
<span class="lineNum">   12272 </span>            :     { { (unichar_t *) N_(&quot;Zoom _in&quot;), (GImage *) &quot;viewzoomin.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'i' }, H_(&quot;Zoom in|No Shortcut&quot;), NULL, NULL, CVMenuScale, MID_ZoomIn },
<span class="lineNum">   12273 </span>            : #if HANYANG
<span class="lineNum">   12274 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12275 </span>            :     { { (unichar_t *) N_(&quot;_Display Compositions...&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'i' }, H_(&quot;Display Compositions...|No Shortcut&quot;), NULL, NULL, CVDisplayCompositions, MID_DisplayCompositions },
<span class="lineNum">   12276 </span>            : #endif
<span class="lineNum">   12277 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12278 </span>            :     { { (unichar_t *) N_(&quot;_Next Glyph&quot;), (GImage *) &quot;viewnext.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'N' }, H_(&quot;Next Glyph|No Shortcut&quot;), NULL, NULL, CVMenuChangeChar, MID_Next },
<span class="lineNum">   12279 </span>            :     { { (unichar_t *) N_(&quot;_Prev Glyph&quot;), (GImage *) &quot;viewprev.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Prev Glyph|No Shortcut&quot;), NULL, NULL, CVMenuChangeChar, MID_Prev },
<span class="lineNum">   12280 </span>            :     { { (unichar_t *) N_(&quot;Next _Defined Glyph&quot;), (GImage *) &quot;viewnextdef.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'D' }, H_(&quot;Next Defined Glyph|No Shortcut&quot;), NULL, NULL, CVMenuChangeChar, MID_NextDef },
<span class="lineNum">   12281 </span>            :     { { (unichar_t *) N_(&quot;Prev Defined Gl_yph&quot;), (GImage *) &quot;viewprevdef.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'a' }, H_(&quot;Prev Defined Glyph|No Shortcut&quot;), NULL, NULL, CVMenuChangeChar, MID_PrevDef },
<span class="lineNum">   12282 </span>            :     { { (unichar_t *) N_(&quot;Form_er Glyph&quot;), (GImage *) &quot;viewformer.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'a' }, H_(&quot;Former Glyph|No Shortcut&quot;), NULL, NULL, CVMenuChangeChar, MID_Former },
<span class="lineNum">   12283 </span>            :     { { (unichar_t *) N_(&quot;_Goto&quot;), (GImage *) &quot;viewgoto.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'G' }, H_(&quot;Goto|No Shortcut&quot;), NULL, NULL, CVMenuGotoChar, MID_Goto },
<span class="lineNum">   12284 </span>            :     { { (unichar_t *) N_(&quot;Find In Font _View&quot;), (GImage *) &quot;viewfindinfont.png&quot;, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'V' }, H_(&quot;Find In Font View|No Shortcut&quot;), NULL, NULL, CVMenuFindInFontView, MID_FindInFontView },
<span class="lineNum">   12285 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12286 </span>            :     { { (unichar_t *) N_(&quot;N_umber Points&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'o' }, H_(&quot;Number Points|No Shortcut&quot;), nplist, nplistcheck, NULL, 0 },
<span class="lineNum">   12287 </span>            :     { { (unichar_t *) N_(&quot;Grid Fi_t&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Grid Fit|No Shortcut&quot;), gflist, gflistcheck, NULL, MID_ShowGridFit },
<span class="lineNum">   12288 </span>            :     { { (unichar_t *) N_(&quot;Sho_w&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Show|No Shortcut&quot;), swlist, swlistcheck, NULL, 0 },
<span class="lineNum">   12289 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12290 </span>            :     { { (unichar_t *) N_(&quot;Com_binations&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'b' }, H_(&quot;Combinations|No Shortcut&quot;), cblist, cblistcheck, NULL, 0 },
<span class="lineNum">   12291 </span>            :     GMENUITEM2_LINE,
<span class="lineNum">   12292 </span>            :     { { (unichar_t *) N_(&quot;Next _Line in Word List&quot;),     NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'L' }, H_(&quot;Next Line in Word List|No Shortcut&quot;), NULL, NULL, CVMenuNextLineInWordList, MID_NextLineInWordList },
<span class="lineNum">   12293 </span>            :     { { (unichar_t *) N_(&quot;Previous Line in _Word List&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'W' }, H_(&quot;Previous Line in Word List|No Shortcut&quot;), NULL, NULL, CVMenuPrevLineInWordList, MID_PrevLineInWordList },
<span class="lineNum">   12294 </span>            :     GMENUITEM2_EMPTY
<a name="12295"><span class="lineNum">   12295 </span>            : };</a>
<span class="lineNum">   12296 </span>            : 
<span class="lineNum">   12297 </span><span class="lineNoCov">          0 : static void CVMenuShowMMMask(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   12298 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   12299 </span><span class="lineNoCov">          0 :     uint32 changemask = (uint32) (intpt) mi-&gt;ti.userdata;</span>
<span class="lineNum">   12300 </span>            :     /* Change which mms get displayed in the &quot;background&quot; */
<span class="lineNum">   12301 </span>            : 
<span class="lineNum">   12302 </span><span class="lineNoCov">          0 :     if ( mi-&gt;mid==MID_MMAll ) {</span>
<span class="lineNum">   12303 </span><span class="lineNoCov">          0 :         if ( (cv-&gt;mmvisible&amp;changemask)==changemask ) cv-&gt;mmvisible = 0;</span>
<span class="lineNum">   12304 </span><span class="lineNoCov">          0 :         else cv-&gt;mmvisible = changemask;</span>
<span class="lineNum">   12305 </span><span class="lineNoCov">          0 :     } else if ( mi-&gt;mid == MID_MMNone ) {</span>
<span class="lineNum">   12306 </span><span class="lineNoCov">          0 :         if ( cv-&gt;mmvisible==0 ) cv-&gt;mmvisible = (1&lt;&lt;(cv-&gt;b.sc-&gt;parent-&gt;mm-&gt;instance_count+1))-1;</span>
<span class="lineNum">   12307 </span><span class="lineNoCov">          0 :         else cv-&gt;mmvisible = 0;</span>
<span class="lineNum">   12308 </span>            :     } else
<span class="lineNum">   12309 </span><span class="lineNoCov">          0 :         cv-&gt;mmvisible ^= changemask;</span>
<span class="lineNum">   12310 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">   12311 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   12312 </span>            : 
<span class="lineNum">   12313 </span>            : static GMenuItem2 mvlist[] = {
<span class="lineNum">   12314 </span>            :     { { (unichar_t *) N_(&quot;SubFonts|_All&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, (void *) 0xffffffff, NULL, 0, 0, 1, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;All|No Shortcut&quot;), NULL, NULL, CVMenuShowMMMask, MID_MMAll },
<span class="lineNum">   12315 </span>            :     { { (unichar_t *) N_(&quot;SubFonts|_None&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, (void *) 0, NULL, 0, 0, 1, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;None|No Shortcut&quot;), NULL, NULL, CVMenuShowMMMask, MID_MMNone },
<span class="lineNum">   12316 </span>            :     GMENUITEM2_EMPTY
<a name="12317"><span class="lineNum">   12317 </span>            : };</a>
<span class="lineNum">   12318 </span>            : 
<span class="lineNum">   12319 </span><span class="lineNoCov">          0 : static void mvlistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   12320 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   12321 </span>            :     int i, base, j;
<span class="lineNum">   12322 </span><span class="lineNoCov">          0 :     MMSet *mm = cv-&gt;b.sc-&gt;parent-&gt;mm;</span>
<span class="lineNum">   12323 </span>            :     uint32 submask;
<span class="lineNum">   12324 </span>            :     SplineFont *sub;
<span class="lineNum">   12325 </span>            :     GMenuItem2 *mml;
<span class="lineNum">   12326 </span>            : 
<span class="lineNum">   12327 </span><span class="lineNoCov">          0 :     base = 3;</span>
<span class="lineNum">   12328 </span><span class="lineNoCov">          0 :     if ( mm==NULL )</span>
<span class="lineNum">   12329 </span><span class="lineNoCov">          0 :         mml = mvlist;</span>
<span class="lineNum">   12330 </span>            :     else {
<span class="lineNum">   12331 </span><span class="lineNoCov">          0 :         mml = calloc(base+mm-&gt;instance_count+2,sizeof(GMenuItem2));</span>
<span class="lineNum">   12332 </span><span class="lineNoCov">          0 :         memcpy(mml,mvlist,sizeof(mvlist));</span>
<span class="lineNum">   12333 </span><span class="lineNoCov">          0 :         mml[base-1].ti.fg = mml[base-1].ti.bg = COLOR_DEFAULT;</span>
<span class="lineNum">   12334 </span><span class="lineNoCov">          0 :         mml[base-1].ti.line = true;</span>
<span class="lineNum">   12335 </span><span class="lineNoCov">          0 :         submask = 0;</span>
<span class="lineNum">   12336 </span><span class="lineNoCov">          0 :         for ( j = 0, i=base; j&lt;mm-&gt;instance_count+1; ++i, ++j ) {</span>
<span class="lineNum">   12337 </span><span class="lineNoCov">          0 :             if ( j==0 )</span>
<span class="lineNum">   12338 </span><span class="lineNoCov">          0 :                 sub = mm-&gt;normal;</span>
<span class="lineNum">   12339 </span>            :             else
<span class="lineNum">   12340 </span><span class="lineNoCov">          0 :                 sub = mm-&gt;instances[j-1];</span>
<span class="lineNum">   12341 </span><span class="lineNoCov">          0 :             mml[i].ti.text = uc_copy(sub-&gt;fontname);</span>
<span class="lineNum">   12342 </span><span class="lineNoCov">          0 :             mml[i].ti.checkable = true;</span>
<span class="lineNum">   12343 </span><span class="lineNoCov">          0 :             mml[i].ti.checked = (cv-&gt;mmvisible &amp; (1&lt;&lt;j))?1:0;</span>
<span class="lineNum">   12344 </span><span class="lineNoCov">          0 :             mml[i].ti.userdata = (void *) (intpt) (1&lt;&lt;j);</span>
<span class="lineNum">   12345 </span><span class="lineNoCov">          0 :             mml[i].invoke = CVMenuShowMMMask;</span>
<span class="lineNum">   12346 </span><span class="lineNoCov">          0 :             mml[i].ti.fg = mml[i].ti.bg = COLOR_DEFAULT;</span>
<span class="lineNum">   12347 </span><span class="lineNoCov">          0 :             if ( sub==cv-&gt;b.sc-&gt;parent )</span>
<span class="lineNum">   12348 </span><span class="lineNoCov">          0 :                 submask = (1&lt;&lt;j);</span>
<span class="lineNum">   12349 </span>            :         }
<span class="lineNum">   12350 </span>            :         /* All */
<span class="lineNum">   12351 </span><span class="lineNoCov">          0 :         mml[0].ti.userdata = (void *) (intpt) ((1&lt;&lt;j)-1);</span>
<span class="lineNum">   12352 </span><span class="lineNoCov">          0 :         mml[0].ti.checked = (cv-&gt;mmvisible == (uint32) (intpt) mml[0].ti.userdata);</span>
<span class="lineNum">   12353 </span>            :             /* None */
<span class="lineNum">   12354 </span><span class="lineNoCov">          0 :         mml[1].ti.checked = (cv-&gt;mmvisible == 0 || cv-&gt;mmvisible == submask);</span>
<span class="lineNum">   12355 </span>            :     }
<span class="lineNum">   12356 </span><span class="lineNoCov">          0 :     GMenuItemArrayFree(mi-&gt;sub);</span>
<span class="lineNum">   12357 </span><span class="lineNoCov">          0 :     mi-&gt;sub = GMenuItem2ArrayCopy(mml,NULL);</span>
<span class="lineNum">   12358 </span><span class="lineNoCov">          0 :     if ( mml!=mvlist ) {</span>
<span class="lineNum">   12359 </span><span class="lineNoCov">          0 :         for ( i=base; mml[i].ti.text!=NULL; ++i )</span>
<span class="lineNum">   12360 </span><span class="lineNoCov">          0 :             free( mml[i].ti.text);</span>
<span class="lineNum">   12361 </span><span class="lineNoCov">          0 :         free(mml);</span>
<span class="lineNum">   12362 </span>            :     }
<a name="12363"><span class="lineNum">   12363 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   12364 </span>            : 
<span class="lineNum">   12365 </span><span class="lineNoCov">          0 : static void CVMenuReblend(GWindow gw, struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   12366 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   12367 </span>            :     char *err;
<span class="lineNum">   12368 </span><span class="lineNoCov">          0 :     MMSet *mm = cv-&gt;b.sc-&gt;parent-&gt;mm;</span>
<span class="lineNum">   12369 </span>            : 
<span class="lineNum">   12370 </span><span class="lineNoCov">          0 :     if ( mm==NULL || mm-&gt;apple || cv-&gt;b.sc-&gt;parent!=mm-&gt;normal )</span>
<span class="lineNum">   12371 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   12372 </span><span class="lineNoCov">          0 :     err = MMBlendChar(mm,cv-&gt;b.sc-&gt;orig_pos);</span>
<span class="lineNum">   12373 </span><span class="lineNoCov">          0 :     if ( mm-&gt;normal-&gt;glyphs[cv-&gt;b.sc-&gt;orig_pos]!=NULL )</span>
<span class="lineNum">   12374 </span><span class="lineNoCov">          0 :         _SCCharChangedUpdate(mm-&gt;normal-&gt;glyphs[cv-&gt;b.sc-&gt;orig_pos],CVLayer((CharViewBase *)cv-&gt;b.sc),-1);</span>
<span class="lineNum">   12375 </span><span class="lineNoCov">          0 :     if ( err!=0 )</span>
<span class="lineNum">   12376 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Bad Multiple Master Font&quot;),err);</span>
<span class="lineNum">   12377 </span>            : }
<span class="lineNum">   12378 </span>            : 
<span class="lineNum">   12379 </span>            : static GMenuItem2 mmlist[] = {
<span class="lineNum">   12380 </span>            : /* GT: Here (and following) MM means &quot;MultiMaster&quot; */
<span class="lineNum">   12381 </span>            :     { { (unichar_t *) N_(&quot;MM _Reblend&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;MM Reblend|No Shortcut&quot;), NULL, NULL, CVMenuReblend, MID_MMReblend },
<span class="lineNum">   12382 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 1, 0, 0, 0, '\0' }, NULL, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">   12383 </span>            :     { { (unichar_t *) N_(&quot;_View&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, '\0' }, NULL, mvlist, mvlistcheck, NULL, 0 },
<span class="lineNum">   12384 </span>            :     GMENUITEM2_EMPTY
<a name="12385"><span class="lineNum">   12385 </span>            : };</a>
<span class="lineNum">   12386 </span>            : 
<span class="lineNum">   12387 </span><span class="lineNoCov">          0 : static void CVMenuShowSubChar(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   12388 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   12389 </span><span class="lineNoCov">          0 :     SplineFont *new = mi-&gt;ti.userdata;</span>
<span class="lineNum">   12390 </span>            :     /* Change to the same char in a different instance font of the mm */
<span class="lineNum">   12391 </span>            : 
<span class="lineNum">   12392 </span><span class="lineNoCov">          0 :     CVChangeSC(cv,SFMakeChar(new,cv-&gt;b.fv-&gt;map,CVCurEnc(cv)));</span>
<span class="lineNum">   12393 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[dm_grid] = &amp;new-&gt;grid;</span>
<a name="12394"><span class="lineNum">   12394 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   12395 </span>            : 
<span class="lineNum">   12396 </span><span class="lineNoCov">          0 : static void mmlistcheck(GWindow gw, struct gmenuitem *mi, GEvent *UNUSED(e)) {</span>
<span class="lineNum">   12397 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   12398 </span>            :     int i, base, j;
<span class="lineNum">   12399 </span><span class="lineNoCov">          0 :     MMSet *mm = cv-&gt;b.sc-&gt;parent-&gt;mm;</span>
<span class="lineNum">   12400 </span>            :     SplineFont *sub;
<span class="lineNum">   12401 </span>            :     GMenuItem2 *mml;
<span class="lineNum">   12402 </span>            : 
<span class="lineNum">   12403 </span><span class="lineNoCov">          0 :     base = sizeof(mmlist)/sizeof(mmlist[0]);</span>
<span class="lineNum">   12404 </span><span class="lineNoCov">          0 :     if ( mm==NULL )</span>
<span class="lineNum">   12405 </span><span class="lineNoCov">          0 :         mml = mmlist;</span>
<span class="lineNum">   12406 </span>            :     else {
<span class="lineNum">   12407 </span><span class="lineNoCov">          0 :         mml = calloc(base+mm-&gt;instance_count+2,sizeof(GMenuItem2));</span>
<span class="lineNum">   12408 </span><span class="lineNoCov">          0 :         memcpy(mml,mmlist,sizeof(mmlist));</span>
<span class="lineNum">   12409 </span><span class="lineNoCov">          0 :         mml[base-1].ti.fg = mml[base-1].ti.bg = COLOR_DEFAULT;</span>
<span class="lineNum">   12410 </span><span class="lineNoCov">          0 :         mml[base-1].ti.line = true;</span>
<span class="lineNum">   12411 </span><span class="lineNoCov">          0 :         for ( j = 0, i=base; j&lt;mm-&gt;instance_count+1; ++i, ++j ) {</span>
<span class="lineNum">   12412 </span><span class="lineNoCov">          0 :             if ( j==0 )</span>
<span class="lineNum">   12413 </span><span class="lineNoCov">          0 :                 sub = mm-&gt;normal;</span>
<span class="lineNum">   12414 </span>            :             else
<span class="lineNum">   12415 </span><span class="lineNoCov">          0 :                 sub = mm-&gt;instances[j-1];</span>
<span class="lineNum">   12416 </span><span class="lineNoCov">          0 :             mml[i].ti.text = uc_copy(sub-&gt;fontname);</span>
<span class="lineNum">   12417 </span><span class="lineNoCov">          0 :             mml[i].ti.checkable = true;</span>
<span class="lineNum">   12418 </span><span class="lineNoCov">          0 :             mml[i].ti.checked = sub==cv-&gt;b.sc-&gt;parent;</span>
<span class="lineNum">   12419 </span><span class="lineNoCov">          0 :             mml[i].ti.userdata = sub;</span>
<span class="lineNum">   12420 </span><span class="lineNoCov">          0 :             mml[i].invoke = CVMenuShowSubChar;</span>
<span class="lineNum">   12421 </span><span class="lineNoCov">          0 :             mml[i].ti.fg = mml[i].ti.bg = COLOR_DEFAULT;</span>
<span class="lineNum">   12422 </span>            :         }
<span class="lineNum">   12423 </span>            :     }
<span class="lineNum">   12424 </span><span class="lineNoCov">          0 :     mml[0].ti.disabled = (mm==NULL || cv-&gt;b.sc-&gt;parent!=mm-&gt;normal || mm-&gt;apple);</span>
<span class="lineNum">   12425 </span><span class="lineNoCov">          0 :     GMenuItemArrayFree(mi-&gt;sub);</span>
<span class="lineNum">   12426 </span><span class="lineNoCov">          0 :     mi-&gt;sub = GMenuItem2ArrayCopy(mml,NULL);</span>
<span class="lineNum">   12427 </span><span class="lineNoCov">          0 :     if ( mml!=mmlist ) {</span>
<span class="lineNum">   12428 </span><span class="lineNoCov">          0 :         for ( i=base; mml[i].ti.text!=NULL; ++i )</span>
<span class="lineNum">   12429 </span><span class="lineNoCov">          0 :             free( mml[i].ti.text);</span>
<span class="lineNum">   12430 </span><span class="lineNoCov">          0 :         free(mml);</span>
<span class="lineNum">   12431 </span>            :     }
<a name="12432"><span class="lineNum">   12432 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   12433 </span>            : 
<span class="lineNum">   12434 </span><span class="lineNoCov">          0 : static void CVMenuContextualHelp(GWindow UNUSED(gw), struct gmenuitem *UNUSED(mi), GEvent *UNUSED(e)) {</span>
<span class="lineNum">   12435 </span><span class="lineNoCov">          0 :     help(&quot;charview.html&quot;);</span>
<span class="lineNum">   12436 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   12437 </span>            : 
<span class="lineNum">   12438 </span>            : static GMenuItem2 mblist[] = {
<span class="lineNum">   12439 </span>            :     { { (unichar_t *) N_(&quot;_File&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'F' }, H_(&quot;File|No Shortcut&quot;), fllist, fllistcheck, NULL, 0 },
<span class="lineNum">   12440 </span>            :     { { (unichar_t *) N_(&quot;_Edit&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'E' }, H_(&quot;Edit|No Shortcut&quot;), edlist, edlistcheck, NULL, 0 },
<span class="lineNum">   12441 </span>            :     { { (unichar_t *) N_(&quot;_Point&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Point|No Shortcut&quot;), ptlist, ptlistcheck, NULL, 0 },
<span class="lineNum">   12442 </span>            :     { { (unichar_t *) N_(&quot;E_lement&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Element|No Shortcut&quot;), ellist, ellistcheck, NULL, 0 },
<span class="lineNum">   12443 </span>            : #ifndef _NO_PYTHON
<span class="lineNum">   12444 </span>            :     { { (unichar_t *) N_(&quot;_Tools&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Tools|No Shortcut&quot;), NULL, cvpy_tllistcheck, NULL, 0 },
<span class="lineNum">   12445 </span>            : #endif
<span class="lineNum">   12446 </span>            : #ifdef NATIVE_CALLBACKS
<span class="lineNum">   12447 </span>            :     { { (unichar_t *) N_(&quot;Tools_2&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Tools 2|No Shortcut&quot;), NULL, cv_tl2listcheck, NULL, 0},
<span class="lineNum">   12448 </span>            : #endif
<span class="lineNum">   12449 </span>            :     { { (unichar_t *) N_(&quot;H_ints&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'H' }, H_(&quot;Hints|No Shortcut&quot;), htlist, htlistcheck, NULL, 0 },
<span class="lineNum">   12450 </span>            :     { { (unichar_t *) N_(&quot;_View&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'V' }, H_(&quot;View|No Shortcut&quot;), vwlist, vwlistcheck, NULL, 0 },
<span class="lineNum">   12451 </span>            :     { { (unichar_t *) N_(&quot;_Metrics&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Metrics|No Shortcut&quot;), mtlist, mtlistcheck, NULL, 0 },
<span class="lineNum">   12452 </span>            : /* GT: Here (and following) MM means &quot;MultiMaster&quot; */
<span class="lineNum">   12453 </span>            :     { { (unichar_t *) N_(&quot;MM&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, '\0' }, H_(&quot;MM|No Shortcut&quot;), mmlist, mmlistcheck, NULL, 0 },
<span class="lineNum">   12454 </span>            :     { { (unichar_t *) N_(&quot;_Window&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'W' }, H_(&quot;Window|No Shortcut&quot;), wnmenu, CVWindowMenuBuild, NULL, 0 },
<span class="lineNum">   12455 </span>            :     { { (unichar_t *) N_(&quot;_Help&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'H' }, H_(&quot;Help|No Shortcut&quot;), helplist, NULL, NULL, 0 },
<span class="lineNum">   12456 </span>            :     GMENUITEM2_EMPTY
<span class="lineNum">   12457 </span>            : };
<span class="lineNum">   12458 </span>            : 
<span class="lineNum">   12459 </span>            : static GMenuItem2 mblist_nomm[] = {
<span class="lineNum">   12460 </span>            :     { { (unichar_t *) N_(&quot;_File&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'F' }, H_(&quot;File|No Shortcut&quot;), fllist, fllistcheck, NULL, 0 },
<span class="lineNum">   12461 </span>            :     { { (unichar_t *) N_(&quot;_Edit&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'E' }, H_(&quot;Edit|No Shortcut&quot;), edlist, edlistcheck, NULL, 0 },
<span class="lineNum">   12462 </span>            :     { { (unichar_t *) N_(&quot;_Point&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'P' }, H_(&quot;Point|No Shortcut&quot;), ptlist, ptlistcheck, NULL, 0 },
<span class="lineNum">   12463 </span>            :     { { (unichar_t *) N_(&quot;E_lement&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Element|No Shortcut&quot;), ellist, ellistcheck, NULL, 0 },
<span class="lineNum">   12464 </span>            : #ifndef _NO_PYTHON
<span class="lineNum">   12465 </span>            :     { { (unichar_t *) N_(&quot;_Tools&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Tools|No Shortcut&quot;), NULL, cvpy_tllistcheck, NULL, 0 },
<span class="lineNum">   12466 </span>            : #endif
<span class="lineNum">   12467 </span>            : #ifdef NATIVE_CALLBACKS
<span class="lineNum">   12468 </span>            :     { { (unichar_t *) N_(&quot;Tools_2&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 1, 0, 'l' }, H_(&quot;Tools 2|No Shortcut&quot;), NULL, cv_tl2listcheck, NULL, 0},
<span class="lineNum">   12469 </span>            : #endif
<span class="lineNum">   12470 </span>            :     { { (unichar_t *) N_(&quot;H_ints&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'H' }, H_(&quot;Hints|No Shortcut&quot;), htlist, htlistcheck, NULL, 0 },
<span class="lineNum">   12471 </span>            :     { { (unichar_t *) N_(&quot;_View&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'V' }, H_(&quot;View|No Shortcut&quot;), vwlist, vwlistcheck, NULL, 0 },
<span class="lineNum">   12472 </span>            :     { { (unichar_t *) N_(&quot;_Metrics&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'M' }, H_(&quot;Metrics|No Shortcut&quot;), mtlist, mtlistcheck, NULL, 0 },
<span class="lineNum">   12473 </span>            :     { { (unichar_t *) N_(&quot;_Window&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'W' }, H_(&quot;Window|No Shortcut&quot;), wnmenu, CVWindowMenuBuild, NULL, 0 },
<span class="lineNum">   12474 </span>            :     { { (unichar_t *) N_(&quot;_Help&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 1, 0, 0, 0, 0, 1, 1, 0, 'H' }, H_(&quot;Help|No Shortcut&quot;), helplist, NULL, NULL, 0 },
<span class="lineNum">   12475 </span>            :     GMENUITEM2_EMPTY
<a name="12476"><span class="lineNum">   12476 </span>            : };</a>
<span class="lineNum">   12477 </span>            : 
<span class="lineNum">   12478 </span><span class="lineNoCov">          0 : static void _CharViewCreate(CharView *cv, SplineChar *sc, FontView *fv,int enc,int show) {</span>
<span class="lineNum">   12479 </span>            :     GRect pos;
<span class="lineNum">   12480 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">   12481 </span>            :     GGadgetData gd;
<span class="lineNum">   12482 </span>            :     int sbsize;
<span class="lineNum">   12483 </span>            :     FontRequest rq;
<span class="lineNum">   12484 </span>            :     int as, ds, ld;
<span class="lineNum">   12485 </span>            :     extern int updateflex;
<span class="lineNum">   12486 </span>            :     static char *infofamily=NULL;
<span class="lineNum">   12487 </span>            :     GTextBounds textbounds;
<span class="lineNum">   12488 </span>            :     /* extern int cv_auto_goto; */
<span class="lineNum">   12489 </span>            :     extern enum cvtools cv_b1_tool, cv_cb1_tool, cv_b2_tool, cv_cb2_tool;
<span class="lineNum">   12490 </span>            : 
<span class="lineNum">   12491 </span><span class="lineNoCov">          0 :     if ( !cvcolsinited )</span>
<span class="lineNum">   12492 </span><span class="lineNoCov">          0 :         CVColInit();</span>
<span class="lineNum">   12493 </span>            : 
<span class="lineNum">   12494 </span>            :     static int firstCharView = 1;
<span class="lineNum">   12495 </span><span class="lineNoCov">          0 :     if( firstCharView )</span>
<span class="lineNum">   12496 </span>            :     {
<span class="lineNum">   12497 </span><span class="lineNoCov">          0 :         firstCharView = 0;</span>
<span class="lineNum">   12498 </span><span class="lineNoCov">          0 :         CVShows.alwaysshowcontrolpoints = prefs_cv_show_control_points_always_initially;</span>
<span class="lineNum">   12499 </span>            :     }
<span class="lineNum">   12500 </span>            : 
<span class="lineNum">   12501 </span><span class="lineNoCov">          0 :     cv-&gt;b.sc = sc;</span>
<span class="lineNum">   12502 </span><span class="lineNoCov">          0 :     cv-&gt;scale = .5;</span>
<span class="lineNum">   12503 </span><span class="lineNoCov">          0 :     cv-&gt;xoff = cv-&gt;yoff = 20;</span>
<span class="lineNum">   12504 </span><span class="lineNoCov">          0 :     cv-&gt;b.next = sc-&gt;views;</span>
<span class="lineNum">   12505 </span><span class="lineNoCov">          0 :     sc-&gt;views = &amp;cv-&gt;b;</span>
<span class="lineNum">   12506 </span><span class="lineNoCov">          0 :     cv-&gt;b.fv = &amp;fv-&gt;b;</span>
<span class="lineNum">   12507 </span><span class="lineNoCov">          0 :     cv-&gt;map_of_enc = fv-&gt;b.map;</span>
<span class="lineNum">   12508 </span><span class="lineNoCov">          0 :     cv-&gt;enc = enc;</span>
<span class="lineNum">   12509 </span><span class="lineNoCov">          0 :     cv-&gt;p.pretransform_spl = 0;</span>
<span class="lineNum">   12510 </span><span class="lineNoCov">          0 :     cv-&gt;b.drawmode = dm_fore;</span>
<span class="lineNum">   12511 </span>            : 
<span class="lineNum">   12512 </span><span class="lineNoCov">          0 :     memset(cv-&gt;showback,-1,sizeof(cv-&gt;showback));</span>
<span class="lineNum">   12513 </span><span class="lineNoCov">          0 :     if ( !CVShows.showback )</span>
<span class="lineNum">   12514 </span><span class="lineNoCov">          0 :         cv-&gt;showback[0] &amp;= ~1;</span>
<span class="lineNum">   12515 </span><span class="lineNoCov">          0 :     cv-&gt;showfore = CVShows.showfore;</span>
<span class="lineNum">   12516 </span><span class="lineNoCov">          0 :     cv-&gt;showgrids = CVShows.showgrids;</span>
<span class="lineNum">   12517 </span><span class="lineNoCov">          0 :     cv-&gt;showhhints = CVShows.showhhints;</span>
<span class="lineNum">   12518 </span><span class="lineNoCov">          0 :     cv-&gt;showvhints = CVShows.showvhints;</span>
<span class="lineNum">   12519 </span><span class="lineNoCov">          0 :     cv-&gt;showdhints = CVShows.showdhints;</span>
<span class="lineNum">   12520 </span><span class="lineNoCov">          0 :     cv-&gt;showpoints = CVShows.showpoints;</span>
<span class="lineNum">   12521 </span><span class="lineNoCov">          0 :     cv-&gt;alwaysshowcontrolpoints = CVShows.alwaysshowcontrolpoints;</span>
<span class="lineNum">   12522 </span><span class="lineNoCov">          0 :     cv-&gt;showrulers = CVShows.showrulers;</span>
<span class="lineNum">   12523 </span><span class="lineNoCov">          0 :     cv-&gt;showfilled = CVShows.showfilled;</span>
<span class="lineNum">   12524 </span><span class="lineNoCov">          0 :     cv-&gt;showrounds = CVShows.showrounds;</span>
<span class="lineNum">   12525 </span><span class="lineNoCov">          0 :     cv-&gt;showmdx = CVShows.showmdx;</span>
<span class="lineNum">   12526 </span><span class="lineNoCov">          0 :     cv-&gt;showmdy = CVShows.showmdy;</span>
<span class="lineNum">   12527 </span><span class="lineNoCov">          0 :     cv-&gt;showhmetrics = CVShows.showhmetrics;</span>
<span class="lineNum">   12528 </span><span class="lineNoCov">          0 :     cv-&gt;showvmetrics = CVShows.showvmetrics;</span>
<span class="lineNum">   12529 </span><span class="lineNoCov">          0 :     cv-&gt;markextrema = CVShows.markextrema;</span>
<span class="lineNum">   12530 </span><span class="lineNoCov">          0 :     cv-&gt;showsidebearings = CVShows.showsidebearings;</span>
<span class="lineNum">   12531 </span><span class="lineNoCov">          0 :     cv-&gt;showrefnames = CVShows.showrefnames;</span>
<span class="lineNum">   12532 </span><span class="lineNoCov">          0 :     cv-&gt;snapoutlines = CVShows.snapoutlines;</span>
<span class="lineNum">   12533 </span><span class="lineNoCov">          0 :     cv-&gt;markpoi = CVShows.markpoi;</span>
<span class="lineNum">   12534 </span><span class="lineNoCov">          0 :     cv-&gt;showalmosthvlines = CVShows.showalmosthvlines;</span>
<span class="lineNum">   12535 </span><span class="lineNoCov">          0 :     cv-&gt;showalmosthvcurves = CVShows.showalmosthvcurves;</span>
<span class="lineNum">   12536 </span><span class="lineNoCov">          0 :     cv-&gt;hvoffset = CVShows.hvoffset;</span>
<span class="lineNum">   12537 </span><span class="lineNoCov">          0 :     cv-&gt;showblues = CVShows.showblues;</span>
<span class="lineNum">   12538 </span><span class="lineNoCov">          0 :     cv-&gt;showfamilyblues = CVShows.showfamilyblues;</span>
<span class="lineNum">   12539 </span><span class="lineNoCov">          0 :     cv-&gt;showanchor = CVShows.showanchor;</span>
<span class="lineNum">   12540 </span><span class="lineNoCov">          0 :     cv-&gt;showcpinfo = CVShows.showcpinfo;</span>
<span class="lineNum">   12541 </span><span class="lineNoCov">          0 :     cv-&gt;showtabs = CVShows.showtabs;</span>
<span class="lineNum">   12542 </span><span class="lineNoCov">          0 :     cv-&gt;inPreviewMode = 0;</span>
<span class="lineNum">   12543 </span><span class="lineNoCov">          0 :     cv-&gt;checkselfintersects = CVShows.checkselfintersects;</span>
<span class="lineNum">   12544 </span>            : 
<span class="lineNum">   12545 </span><span class="lineNoCov">          0 :     cv-&gt;showdebugchanges = CVShows.showdebugchanges;</span>
<span class="lineNum">   12546 </span>            : 
<span class="lineNum">   12547 </span><span class="lineNoCov">          0 :     cv-&gt;infoh = 13;</span>
<span class="lineNum">   12548 </span>            : #if defined(__MINGW32__)||defined(__CYGWIN__)
<span class="lineNum">   12549 </span>            :     cv-&gt;infoh = 26;
<span class="lineNum">   12550 </span>            : #endif
<span class="lineNum">   12551 </span><span class="lineNoCov">          0 :     cv-&gt;rulerh = 16;</span>
<span class="lineNum">   12552 </span>            : 
<span class="lineNum">   12553 </span><span class="lineNoCov">          0 :     GDrawGetSize(cv-&gt;gw,&amp;pos);</span>
<span class="lineNum">   12554 </span><span class="lineNoCov">          0 :     memset(&amp;gd,0,sizeof(gd));</span>
<span class="lineNum">   12555 </span><span class="lineNoCov">          0 :     gd.pos.y = cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh;</span>
<span class="lineNum">   12556 </span><span class="lineNoCov">          0 :     gd.pos.width = sbsize = GDrawPointsToPixels(cv-&gt;gw,_GScrollBar_Width);</span>
<span class="lineNum">   12557 </span><span class="lineNoCov">          0 :     gd.pos.height = pos.height-cv-&gt;mbh-cv-&gt;charselectorh-cv-&gt;infoh - sbsize;</span>
<span class="lineNum">   12558 </span><span class="lineNoCov">          0 :     gd.pos.x = pos.width-sbsize;</span>
<span class="lineNum">   12559 </span><span class="lineNoCov">          0 :     gd.flags = gg_visible|gg_enabled|gg_pos_in_pixels|gg_sb_vert;</span>
<span class="lineNum">   12560 </span><span class="lineNoCov">          0 :     cv-&gt;vsb = GScrollBarCreate(cv-&gt;gw,&amp;gd,cv);</span>
<span class="lineNum">   12561 </span>            : 
<span class="lineNum">   12562 </span><span class="lineNoCov">          0 :     gd.pos.y = pos.height-sbsize; gd.pos.height = sbsize;</span>
<span class="lineNum">   12563 </span><span class="lineNoCov">          0 :     gd.pos.width = pos.width - sbsize;</span>
<span class="lineNum">   12564 </span><span class="lineNoCov">          0 :     gd.pos.x = 0;</span>
<span class="lineNum">   12565 </span><span class="lineNoCov">          0 :     gd.flags = gg_visible|gg_enabled|gg_pos_in_pixels|gg_text_xim;</span>
<span class="lineNum">   12566 </span><span class="lineNoCov">          0 :     cv-&gt;hsb = GScrollBarCreate(cv-&gt;gw,&amp;gd,cv);</span>
<span class="lineNum">   12567 </span>            : 
<span class="lineNum">   12568 </span><span class="lineNoCov">          0 :     GDrawGetSize(cv-&gt;gw,&amp;pos);</span>
<span class="lineNum">   12569 </span><span class="lineNoCov">          0 :     pos.y = cv-&gt;mbh+cv-&gt;charselectorh+cv-&gt;infoh; pos.height -= cv-&gt;mbh + cv-&gt;charselectorh + sbsize + cv-&gt;infoh;</span>
<span class="lineNum">   12570 </span><span class="lineNoCov">          0 :     pos.x = 0; pos.width -= sbsize;</span>
<span class="lineNum">   12571 </span><span class="lineNoCov">          0 :     if ( cv-&gt;showrulers ) {</span>
<span class="lineNum">   12572 </span><span class="lineNoCov">          0 :         pos.y += cv-&gt;rulerh; pos.height -= cv-&gt;rulerh;</span>
<span class="lineNum">   12573 </span><span class="lineNoCov">          0 :         pos.x += cv-&gt;rulerh; pos.width -= cv-&gt;rulerh;</span>
<span class="lineNum">   12574 </span>            :     }
<span class="lineNum">   12575 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">   12576 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_backcol;</span>
<span class="lineNum">   12577 </span><span class="lineNoCov">          0 :     wattrs.background_color = view_bgcol;</span>
<span class="lineNum">   12578 </span><span class="lineNoCov">          0 :     wattrs.event_masks = -1;</span>
<span class="lineNum">   12579 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_mypointer;</span>
<span class="lineNum">   12580 </span><span class="lineNoCov">          0 :     cv-&gt;v = GWidgetCreateSubWindow(cv-&gt;gw,&amp;pos,v_e_h,cv,&amp;wattrs);</span>
<span class="lineNum">   12581 </span><span class="lineNoCov">          0 :     GDrawSetWindowTypeName(cv-&gt;v, &quot;CharView&quot;);</span>
<span class="lineNum">   12582 </span>            : 
<span class="lineNum">   12583 </span><span class="lineNoCov">          0 :     if ( GDrawRequestDeviceEvents(cv-&gt;v,input_em_cnt,input_em)&gt;0 ) {</span>
<span class="lineNum">   12584 </span>            :         /* Success! They've got a wacom tablet */
<span class="lineNum">   12585 </span>            :     }
<span class="lineNum">   12586 </span>            : 
<span class="lineNum">   12587 </span><span class="lineNoCov">          0 :     if ( infofamily==NULL ) {</span>
<span class="lineNum">   12588 </span><span class="lineNoCov">          0 :         infofamily = copy(GResourceFindString(&quot;CharView.InfoFamily&quot;));</span>
<span class="lineNum">   12589 </span>            :         /* FontConfig doesn't have access to all the X11 bitmap fonts */
<span class="lineNum">   12590 </span>            :         /*  so the font I used to use isn't found, and a huge monster is */
<span class="lineNum">   12591 </span>            :         /*  inserted instead */
<span class="lineNum">   12592 </span><span class="lineNoCov">          0 :         if ( infofamily==NULL )</span>
<span class="lineNum">   12593 </span><span class="lineNoCov">          0 :             infofamily = SANS_UI_FAMILIES;</span>
<span class="lineNum">   12594 </span>            :     }
<span class="lineNum">   12595 </span>            : 
<span class="lineNum">   12596 </span><span class="lineNoCov">          0 :     memset(&amp;rq,0,sizeof(rq));</span>
<span class="lineNum">   12597 </span><span class="lineNoCov">          0 :     rq.utf8_family_name = infofamily;</span>
<span class="lineNum">   12598 </span><span class="lineNoCov">          0 :     rq.point_size = GResourceFindInt(&quot;CharView.Rulers.FontSize&quot;, -10);</span>
<span class="lineNum">   12599 </span><span class="lineNoCov">          0 :     rq.weight = 400;</span>
<span class="lineNum">   12600 </span><span class="lineNoCov">          0 :     cv-&gt;small = GDrawInstanciateFont(cv-&gt;gw,&amp;rq);</span>
<span class="lineNum">   12601 </span><span class="lineNoCov">          0 :     GDrawWindowFontMetrics(cv-&gt;gw,cv-&gt;small,&amp;as,&amp;ds,&amp;ld);</span>
<span class="lineNum">   12602 </span><span class="lineNoCov">          0 :     cv-&gt;sfh = as+ds; cv-&gt;sas = as;</span>
<span class="lineNum">   12603 </span><span class="lineNoCov">          0 :     GDrawSetFont(cv-&gt;gw,cv-&gt;small);</span>
<span class="lineNum">   12604 </span><span class="lineNoCov">          0 :     GDrawGetText8Bounds(cv-&gt;gw,&quot;0123456789&quot;,10,&amp;textbounds);</span>
<span class="lineNum">   12605 </span><span class="lineNoCov">          0 :     cv-&gt;sdh = textbounds.as+textbounds.ds+1;</span>
<span class="lineNum">   12606 </span><span class="lineNoCov">          0 :     rq.point_size = 10;</span>
<span class="lineNum">   12607 </span><span class="lineNoCov">          0 :     cv-&gt;normal = GDrawInstanciateFont(cv-&gt;gw,&amp;rq);</span>
<span class="lineNum">   12608 </span><span class="lineNoCov">          0 :     GDrawWindowFontMetrics(cv-&gt;gw,cv-&gt;normal,&amp;as,&amp;ds,&amp;ld);</span>
<span class="lineNum">   12609 </span><span class="lineNoCov">          0 :     cv-&gt;nfh = as+ds; cv-&gt;nas = as;</span>
<span class="lineNum">   12610 </span>            : 
<span class="lineNum">   12611 </span><span class="lineNoCov">          0 :     cv-&gt;height = pos.height; cv-&gt;width = pos.width;</span>
<span class="lineNum">   12612 </span><span class="lineNoCov">          0 :     cv-&gt;gi.u.image = calloc(1,sizeof(struct _GImage));</span>
<span class="lineNum">   12613 </span><span class="lineNoCov">          0 :     cv-&gt;gi.u.image-&gt;image_type = it_mono;</span>
<span class="lineNum">   12614 </span><span class="lineNoCov">          0 :     cv-&gt;gi.u.image-&gt;clut = calloc(1,sizeof(GClut));</span>
<span class="lineNum">   12615 </span><span class="lineNoCov">          0 :     cv-&gt;gi.u.image-&gt;clut-&gt;trans_index = cv-&gt;gi.u.image-&gt;trans = 0;</span>
<span class="lineNum">   12616 </span><span class="lineNoCov">          0 :     cv-&gt;gi.u.image-&gt;clut-&gt;clut_len = 2;</span>
<span class="lineNum">   12617 </span><span class="lineNoCov">          0 :     cv-&gt;gi.u.image-&gt;clut-&gt;clut[0] = view_bgcol;</span>
<span class="lineNum">   12618 </span><span class="lineNoCov">          0 :     cv-&gt;gi.u.image-&gt;clut-&gt;clut[1] = fillcol;</span>
<span class="lineNum">   12619 </span><span class="lineNoCov">          0 :     cv-&gt;b1_tool = cv_b1_tool; cv-&gt;cb1_tool = cv_cb1_tool;</span>
<span class="lineNum">   12620 </span><span class="lineNoCov">          0 :     cv-&gt;b1_tool_old = cv-&gt;b1_tool;</span>
<span class="lineNum">   12621 </span><span class="lineNoCov">          0 :     cv-&gt;b2_tool = cv_b2_tool; cv-&gt;cb2_tool = cv_cb2_tool;</span>
<span class="lineNum">   12622 </span><span class="lineNoCov">          0 :     cv-&gt;s1_tool = cvt_freehand; cv-&gt;s2_tool = cvt_pen;</span>
<span class="lineNum">   12623 </span><span class="lineNoCov">          0 :     cv-&gt;er_tool = cvt_knife;</span>
<span class="lineNum">   12624 </span><span class="lineNoCov">          0 :     cv-&gt;showing_tool = cvt_pointer;</span>
<span class="lineNum">   12625 </span><span class="lineNoCov">          0 :     cv-&gt;pressed_tool = cv-&gt;pressed_display = cv-&gt;active_tool = cvt_none;</span>
<span class="lineNum">   12626 </span><span class="lineNoCov">          0 :     cv-&gt;spacebar_hold = 0;</span>
<span class="lineNum">   12627 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[dm_fore] = &amp;sc-&gt;layers[ly_fore];</span>
<span class="lineNum">   12628 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[dm_back] = &amp;sc-&gt;layers[ly_back];</span>
<span class="lineNum">   12629 </span><span class="lineNoCov">          0 :     cv-&gt;b.layerheads[dm_grid] = &amp;fv-&gt;b.sf-&gt;grid;</span>
<span class="lineNum">   12630 </span><span class="lineNoCov">          0 :     if ( !sc-&gt;parent-&gt;multilayer &amp;&amp; fv-&gt;b.active_layer!=ly_fore ) {</span>
<span class="lineNum">   12631 </span><span class="lineNoCov">          0 :         cv-&gt;b.layerheads[dm_back] = &amp;sc-&gt;layers[fv-&gt;b.active_layer];</span>
<span class="lineNum">   12632 </span><span class="lineNoCov">          0 :         cv-&gt;b.drawmode = dm_back;</span>
<span class="lineNum">   12633 </span>            :     }
<span class="lineNum">   12634 </span>            : 
<span class="lineNum">   12635 </span>            : #if HANYANG
<span class="lineNum">   12636 </span>            :     if ( sc-&gt;parent-&gt;rules!=NULL &amp;&amp; sc-&gt;compositionunit )
<span class="lineNum">   12637 </span>            :         Disp_DefaultTemplate(cv);
<span class="lineNum">   12638 </span>            : #endif
<span class="lineNum">   12639 </span>            : 
<span class="lineNum">   12640 </span><span class="lineNoCov">          0 :     cv-&gt;olde.x = -1;</span>
<span class="lineNum">   12641 </span>            : 
<span class="lineNum">   12642 </span><span class="lineNoCov">          0 :     cv-&gt;ft_dpi = 72; cv-&gt;ft_pointsizex = cv-&gt;ft_pointsizey = 12.0;</span>
<span class="lineNum">   12643 </span><span class="lineNoCov">          0 :     cv-&gt;ft_ppemx = cv-&gt;ft_ppemy = 12;</span>
<span class="lineNum">   12644 </span>            : 
<span class="lineNum">   12645 </span>            :     /*GWidgetHidePalettes();*/
<span class="lineNum">   12646 </span>            :     /*cv-&gt;tools = CVMakeTools(cv);*/
<span class="lineNum">   12647 </span>            :     /*cv-&gt;layers = CVMakeLayers(cv);*/
<span class="lineNum">   12648 </span>            : 
<span class="lineNum">   12649 </span><span class="lineNoCov">          0 :     CVFit(cv);</span>
<span class="lineNum">   12650 </span><span class="lineNoCov">          0 :     GDrawSetVisible(cv-&gt;v,true);</span>
<span class="lineNum">   12651 </span><span class="lineNoCov">          0 :     GWindowClearFocusGadgetOfWindow(cv-&gt;v);</span>
<span class="lineNum">   12652 </span>            : 
<span class="lineNum">   12653 </span>            :     /*if ( cv_auto_goto )*/             /* Chinese input method steals hot key key-strokes */
<span class="lineNum">   12654 </span>            :         /* But if we don't do this, then people can't type menu short-cuts */
<span class="lineNum">   12655 </span><span class="lineNoCov">          0 :         cv-&gt;gic   = GDrawCreateInputContext(cv-&gt;v,gic_root|gic_orlesser);</span>
<span class="lineNum">   12656 </span><span class="lineNoCov">          0 :         GDrawSetGIC(cv-&gt;v,cv-&gt;gic,0,20);</span>
<span class="lineNum">   12657 </span><span class="lineNoCov">          0 :         cv-&gt;gwgic = GDrawCreateInputContext(cv-&gt;gw,gic_root|gic_orlesser);</span>
<span class="lineNum">   12658 </span><span class="lineNoCov">          0 :         GDrawSetGIC(cv-&gt;gw,cv-&gt;gwgic,0,20);</span>
<span class="lineNum">   12659 </span><span class="lineNoCov">          0 :         if( show )</span>
<span class="lineNum">   12660 </span>            :         {
<span class="lineNum">   12661 </span><span class="lineNoCov">          0 :             GDrawSetVisible(cv-&gt;gw,true);</span>
<span class="lineNum">   12662 </span>            :         }
<span class="lineNum">   12663 </span>            : 
<span class="lineNum">   12664 </span><span class="lineNoCov">          0 :     if ( (CharView *) (sc-&gt;views)==NULL &amp;&amp; updateflex )</span>
<span class="lineNum">   12665 </span><span class="lineNoCov">          0 :         SplineCharIsFlexible(sc,CVLayer((CharViewBase *) cv));</span>
<span class="lineNum">   12666 </span><span class="lineNoCov">          0 :     if ( sc-&gt;inspiro &amp;&amp; !hasspiro() &amp;&amp; !sc-&gt;parent-&gt;complained_about_spiros ) {</span>
<span class="lineNum">   12667 </span><span class="lineNoCov">          0 :         sc-&gt;parent-&gt;complained_about_spiros = true;</span>
<span class="lineNum">   12668 </span>            : #ifdef _NO_LIBSPIRO
<span class="lineNum">   12669 </span>            :         ff_post_error(_(&quot;You may not use spiros&quot;),_(&quot;This glyph should display spiro points, but unfortunately this version of fontforge was not linked with the spiro library, so only normal bezier points will be displayed.&quot;));
<span class="lineNum">   12670 </span>            : #else
<span class="lineNum">   12671 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;You may not use spiros&quot;),_(&quot;This glyph should display spiro points, but unfortunately FontForge was unable to load libspiro, spiros are not available for use, and normal bezier points will be displayed instead.&quot;));</span>
<span class="lineNum">   12672 </span>            : #endif
<span class="lineNum">   12673 </span>            :     }
<span class="lineNum">   12674 </span>            : 
<a name="12675"><span class="lineNum">   12675 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   12676 </span>            : 
<span class="lineNum">   12677 </span><span class="lineNoCov">          0 : void DefaultY(GRect *pos) {</span>
<span class="lineNum">   12678 </span>            :     static int nexty=0;
<span class="lineNum">   12679 </span>            :     GRect size;
<span class="lineNum">   12680 </span>            : 
<span class="lineNum">   12681 </span><span class="lineNoCov">          0 :     GDrawGetSize(GDrawGetRoot(NULL),&amp;size);</span>
<span class="lineNum">   12682 </span><span class="lineNoCov">          0 :     if ( nexty!=0 ) {</span>
<span class="lineNum">   12683 </span>            :         FontView *fv;
<span class="lineNum">   12684 </span><span class="lineNoCov">          0 :         int any=0, i;</span>
<span class="lineNum">   12685 </span>            :         BDFFont *bdf;
<span class="lineNum">   12686 </span>            :         /* are there any open cv/bv windows? */
<span class="lineNum">   12687 </span><span class="lineNoCov">          0 :         for ( fv = fv_list; fv!=NULL &amp;&amp; !any; fv = (FontView *) (fv-&gt;b.next) ) {</span>
<span class="lineNum">   12688 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;fv-&gt;b.sf-&gt;glyphcnt; ++i ) if ( fv-&gt;b.sf-&gt;glyphs[i]!=NULL ) {</span>
<span class="lineNum">   12689 </span><span class="lineNoCov">          0 :                 if ( fv-&gt;b.sf-&gt;glyphs[i]-&gt;views!=NULL ) {</span>
<span class="lineNum">   12690 </span><span class="lineNoCov">          0 :                     any = true;</span>
<span class="lineNum">   12691 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">   12692 </span>            :                 }
<span class="lineNum">   12693 </span>            :             }
<span class="lineNum">   12694 </span><span class="lineNoCov">          0 :             for ( bdf = fv-&gt;b.sf-&gt;bitmaps; bdf!=NULL &amp;&amp; !any; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">   12695 </span><span class="lineNoCov">          0 :                 for ( i=0; i&lt;bdf-&gt;glyphcnt; ++i ) if ( bdf-&gt;glyphs[i]!=NULL ) {</span>
<span class="lineNum">   12696 </span><span class="lineNoCov">          0 :                     if ( bdf-&gt;glyphs[i]-&gt;views!=NULL ) {</span>
<span class="lineNum">   12697 </span><span class="lineNoCov">          0 :                         any = true;</span>
<span class="lineNum">   12698 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">   12699 </span>            :                     }
<span class="lineNum">   12700 </span>            :                 }
<span class="lineNum">   12701 </span>            :             }
<span class="lineNum">   12702 </span>            :         }
<span class="lineNum">   12703 </span><span class="lineNoCov">          0 :         if ( !any ) nexty = 0;</span>
<span class="lineNum">   12704 </span>            :     }
<span class="lineNum">   12705 </span><span class="lineNoCov">          0 :     pos-&gt;y = nexty;</span>
<span class="lineNum">   12706 </span><span class="lineNoCov">          0 :     nexty += 200;</span>
<span class="lineNum">   12707 </span><span class="lineNoCov">          0 :     if ( nexty+pos-&gt;height &gt; size.height )</span>
<span class="lineNum">   12708 </span><span class="lineNoCov">          0 :         nexty = 0;</span>
<span class="lineNum">   12709 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   12710 </span>            : 
<a name="12711"><span class="lineNum">   12711 </span>            : static void CharViewInit(void);</a>
<span class="lineNum">   12712 </span>            : 
<span class="lineNum">   12713 </span><span class="lineNoCov">          0 : static int CV_OnCharSelectorTextChanged( GGadget *g, GEvent *e )</span>
<span class="lineNum">   12714 </span>            : {
<span class="lineNum">   12715 </span><span class="lineNoCov">          0 :     CharView* cv = GGadgetGetUserData(g);</span>
<span class="lineNum">   12716 </span><span class="lineNoCov">          0 :     SplineChar *sc = cv-&gt;b.sc;</span>
<span class="lineNum">   12717 </span><span class="lineNoCov">          0 :     SplineFont* sf = sc-&gt;parent;</span>
<span class="lineNum">   12718 </span>            : 
<span class="lineNum">   12719 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textchanged )</span>
<span class="lineNum">   12720 </span>            :     {
<span class="lineNum">   12721 </span><span class="lineNoCov">          0 :         int pos = e-&gt;u.control.u.tf_changed.from_pulldown;</span>
<span class="lineNum">   12722 </span>            : 
<span class="lineNum">   12723 </span><span class="lineNoCov">          0 :         if ( pos!=-1 )</span>
<span class="lineNum">   12724 </span>            :         {
<span class="lineNum">   12725 </span>            :             int32 len;
<span class="lineNum">   12726 </span><span class="lineNoCov">          0 :             GTextInfo **ti = GGadgetGetList(g,&amp;len);</span>
<span class="lineNum">   12727 </span><span class="lineNoCov">          0 :             GTextInfo *cur = ti[pos];</span>
<span class="lineNum">   12728 </span><span class="lineNoCov">          0 :             int type = (intpt) cur-&gt;userdata;</span>
<span class="lineNum">   12729 </span><span class="lineNoCov">          0 :             if ( type &lt; 0 )</span>
<span class="lineNum">   12730 </span>            :             {
<span class="lineNum">   12731 </span>            :                 TRACE(&quot;load wordlist...! pos:%d\n&quot;,pos);
<span class="lineNum">   12732 </span>            : 
<span class="lineNum">   12733 </span><span class="lineNoCov">          0 :                 WordlistLoadToGTextInfo( cv-&gt;charselector, &amp;cv-&gt;charselectoridx );</span>
<span class="lineNum">   12734 </span><span class="lineNoCov">          0 :                 return 0;</span>
<span class="lineNum">   12735 </span>            :             }
<span class="lineNum">   12736 </span>            :         }
<span class="lineNum">   12737 </span>            :         
<span class="lineNum">   12738 </span>            :         
<span class="lineNum">   12739 </span><span class="lineNoCov">          0 :         cv-&gt;charselectoridx = pos;</span>
<span class="lineNum">   12740 </span><span class="lineNoCov">          0 :         char* txt = GGadgetGetTitle8( cv-&gt;charselector );</span>
<span class="lineNum">   12741 </span>            :         TRACE(&quot;char selector changed to:%s\n&quot;, txt );
<span class="lineNum">   12742 </span>            :         {
<span class="lineNum">   12743 </span><span class="lineNoCov">          0 :             int tabnum = GTabSetGetSel(cv-&gt;tabs);</span>
<span class="lineNum">   12744 </span>            :             TRACE(&quot;tab num:%d\n&quot;, tabnum );
<span class="lineNum">   12745 </span>            : 
<span class="lineNum">   12746 </span><span class="lineNoCov">          0 :             CharViewTab* t = &amp;cv-&gt;cvtabs[tabnum];</span>
<span class="lineNum">   12747 </span><span class="lineNoCov">          0 :             strncpy( t-&gt;tablabeltxt, txt, charviewtab_charselectedsz );</span>
<span class="lineNum">   12748 </span><span class="lineNoCov">          0 :             GTabSetChangeTabName(cv-&gt;tabs,t-&gt;tablabeltxt,tabnum);</span>
<span class="lineNum">   12749 </span><span class="lineNoCov">          0 :             GTabSetRemetric(cv-&gt;tabs);</span>
<span class="lineNum">   12750 </span><span class="lineNoCov">          0 :             GTabSetSetSel(cv-&gt;tabs,tabnum);  /* This does a redraw */</span>
<span class="lineNum">   12751 </span>            :         }
<span class="lineNum">   12752 </span>            :         
<span class="lineNum">   12753 </span><span class="lineNoCov">          0 :         memset( cv-&gt;additionalCharsToShow, 0, sizeof(SplineChar*) * additionalCharsToShowLimit );</span>
<span class="lineNum">   12754 </span><span class="lineNoCov">          0 :         cv-&gt;additionalCharsToShowActiveIndex = 0;</span>
<span class="lineNum">   12755 </span><span class="lineNoCov">          0 :         cv-&gt;additionalCharsToShow[0] = cv-&gt;b.sc;</span>
<span class="lineNum">   12756 </span>            : 
<span class="lineNum">   12757 </span><span class="lineNoCov">          0 :         int hadSelection = 0;</span>
<span class="lineNum">   12758 </span><span class="lineNoCov">          0 :         if( txt[0] == '\0' )</span>
<span class="lineNum">   12759 </span>            :         {
<span class="lineNum">   12760 </span><span class="lineNoCov">          0 :             CVSetCharSelectorValueFromSC( cv, cv-&gt;b.sc );</span>
<span class="lineNum">   12761 </span>            :         }
<span class="lineNum">   12762 </span><span class="lineNoCov">          0 :         else if( strlen(txt) &gt; 1 )</span>
<span class="lineNum">   12763 </span>            :         {
<span class="lineNum">   12764 </span><span class="lineNoCov">          0 :             int i=0;</span>
<span class="lineNum">   12765 </span><span class="lineNoCov">          0 :             unichar_t *ret = GGadgetGetTitle( cv-&gt;charselector );</span>
<span class="lineNum">   12766 </span><span class="lineNoCov">          0 :             WordListLine wll = WordlistEscapedInputStringToParsedData( sf, ret );</span>
<span class="lineNum">   12767 </span><span class="lineNoCov">          0 :             WordListLine pt = wll;</span>
<span class="lineNum">   12768 </span><span class="lineNoCov">          0 :             WordListLine ept = WordListLine_end(wll);</span>
<span class="lineNum">   12769 </span><span class="lineNoCov">          0 :             WordListLine tpt = 0;</span>
<span class="lineNum">   12770 </span><span class="lineNoCov">          0 :             for ( tpt=pt; tpt&lt;ept; ++tpt )</span>
<span class="lineNum">   12771 </span>            :             {
<span class="lineNum">   12772 </span><span class="lineNoCov">          0 :                 if( tpt == pt )</span>
<span class="lineNum">   12773 </span>            :                 {
<span class="lineNum">   12774 </span>            :                     // your own char at the leading of the text
<span class="lineNum">   12775 </span><span class="lineNoCov">          0 :                     cv-&gt;additionalCharsToShow[i] = tpt-&gt;sc;</span>
<span class="lineNum">   12776 </span><span class="lineNoCov">          0 :                     i++;</span>
<span class="lineNum">   12777 </span><span class="lineNoCov">          0 :                     continue;</span>
<span class="lineNum">   12778 </span>            :                 }
<span class="lineNum">   12779 </span>            :                 
<span class="lineNum">   12780 </span><span class="lineNoCov">          0 :                 cv-&gt;additionalCharsToShow[i] = tpt-&gt;sc;</span>
<span class="lineNum">   12781 </span>            : 
<span class="lineNum">   12782 </span><span class="lineNoCov">          0 :                 i++;</span>
<span class="lineNum">   12783 </span><span class="lineNoCov">          0 :                 if( i &gt;= additionalCharsToShowLimit )</span>
<span class="lineNum">   12784 </span><span class="lineNoCov">          0 :                     break;</span>
<span class="lineNum">   12785 </span>            :             }
<span class="lineNum">   12786 </span><span class="lineNoCov">          0 :             free(ret);</span>
<span class="lineNum">   12787 </span>            : 
<span class="lineNum">   12788 </span><span class="lineNoCov">          0 :             if( wll-&gt;sc )</span>
<span class="lineNum">   12789 </span>            :             {
<span class="lineNum">   12790 </span><span class="lineNoCov">          0 :                 if( wll-&gt;isSelected )</span>
<span class="lineNum">   12791 </span>            :                 {
<span class="lineNum">   12792 </span>            :                     // first char selected, nothing to do!
<span class="lineNum">   12793 </span>            :                 }
<span class="lineNum">   12794 </span>            :                 else
<span class="lineNum">   12795 </span>            :                 {
<span class="lineNum">   12796 </span><span class="lineNoCov">          0 :                     while( wll-&gt;sc &amp;&amp; !(wll-&gt;isSelected))</span>
<span class="lineNum">   12797 </span><span class="lineNoCov">          0 :                         wll++;</span>
<span class="lineNum">   12798 </span><span class="lineNoCov">          0 :                     if( wll-&gt;sc &amp;&amp; wll-&gt;isSelected )</span>
<span class="lineNum">   12799 </span>            :                     {
<span class="lineNum">   12800 </span><span class="lineNoCov">          0 :                         SplineChar* xc = wll-&gt;sc;</span>
<span class="lineNum">   12801 </span><span class="lineNoCov">          0 :                         if( xc )</span>
<span class="lineNum">   12802 </span>            :                         {
<span class="lineNum">   12803 </span>            :                             TRACE(&quot;selected v:%d xc:%s\n&quot;, wll-&gt;currentGlyphIndex, xc-&gt;name );
<span class="lineNum">   12804 </span><span class="lineNoCov">          0 :                             int xoff = cv-&gt;xoff;</span>
<span class="lineNum">   12805 </span><span class="lineNoCov">          0 :                             CVSwitchActiveSC( cv, xc, wll-&gt;currentGlyphIndex );</span>
<span class="lineNum">   12806 </span><span class="lineNoCov">          0 :                             CVHScrollSetPos( cv, xoff );</span>
<span class="lineNum">   12807 </span><span class="lineNoCov">          0 :                             hadSelection = 1;</span>
<span class="lineNum">   12808 </span>            :                         }
<span class="lineNum">   12809 </span>            :                         
<span class="lineNum">   12810 </span>            :                     }
<span class="lineNum">   12811 </span>            :                 }
<span class="lineNum">   12812 </span>            :             }
<span class="lineNum">   12813 </span>            :         }
<span class="lineNum">   12814 </span><span class="lineNoCov">          0 :         free(txt);</span>
<span class="lineNum">   12815 </span>            : 
<span class="lineNum">   12816 </span><span class="lineNoCov">          0 :         int i=0;</span>
<span class="lineNum">   12817 </span><span class="lineNoCov">          0 :         for( i=0; cv-&gt;additionalCharsToShow[i]; i++ )</span>
<span class="lineNum">   12818 </span>            :         {
<span class="lineNum">   12819 </span>            :             TRACE(&quot;i:%d %p .. &quot;, i, cv-&gt;additionalCharsToShow[i] );
<span class="lineNum">   12820 </span>            :             TRACE(&quot; %s\n&quot;, cv-&gt;additionalCharsToShow[i]-&gt;name );
<span class="lineNum">   12821 </span>            :         }
<span class="lineNum">   12822 </span>            : 
<span class="lineNum">   12823 </span><span class="lineNoCov">          0 :         if( !hadSelection )</span>
<span class="lineNum">   12824 </span><span class="lineNoCov">          0 :             CVSwitchActiveSC( cv, 0, 0 );</span>
<span class="lineNum">   12825 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(cv-&gt;v,NULL,false);</span>
<span class="lineNum">   12826 </span>            :     }
<span class="lineNum">   12827 </span><span class="lineNoCov">          0 :     return( true );</span>
<span class="lineNum">   12828 </span>            : }
<span class="lineNum">   12829 </span>            : 
<span class="lineNum">   12830 </span>            : GTextInfo cv_charselector_init[] = {
<span class="lineNum">   12831 </span>            :     { (unichar_t *) &quot;&quot;, NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 1, 0, 1, 0, 0, '\0'},
<span class="lineNum">   12832 </span>            :     { NULL, NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 1, 0, 0, 0, '\0'},
<span class="lineNum">   12833 </span>            :     { (unichar_t *) N_(&quot;Load Word List...&quot;), NULL, 0, 0, (void *) -1, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0'},
<span class="lineNum">   12834 </span>            : //    { (unichar_t *) N_(&quot;Load Glyph Name List...&quot;), NULL, 0, 0, (void *) -2, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0'},
<span class="lineNum">   12835 </span>            :     GTEXTINFO_EMPTY
<span class="lineNum">   12836 </span>            : };
<a name="12837"><span class="lineNum">   12837 </span>            : </a>
<span class="lineNum">   12838 </span>            : 
<span class="lineNum">   12839 </span><span class="lineNoCov">          0 : CharView *CharViewCreateExtended(SplineChar *sc, FontView *fv,int enc, int show )</span>
<span class="lineNum">   12840 </span>            : {
<span class="lineNum">   12841 </span><span class="lineNoCov">          0 :     CharView *cv = calloc(1,sizeof(CharView));</span>
<span class="lineNum">   12842 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">   12843 </span>            :     GRect pos, zoom;
<span class="lineNum">   12844 </span>            :     GWindow gw;
<span class="lineNum">   12845 </span>            :     GGadgetData gd;
<span class="lineNum">   12846 </span>            :     GTabInfo aspects[2];
<span class="lineNum">   12847 </span>            :     GRect gsize;
<span class="lineNum">   12848 </span>            :     char buf[300];
<span class="lineNum">   12849 </span>            :     GTextInfo label[9];
<span class="lineNum">   12850 </span>            : 
<span class="lineNum">   12851 </span><span class="lineNoCov">          0 :     CharViewInit();</span>
<span class="lineNum">   12852 </span>            : 
<span class="lineNum">   12853 </span><span class="lineNoCov">          0 :     cv-&gt;b.sc = sc;</span>
<span class="lineNum">   12854 </span><span class="lineNoCov">          0 :     cv-&gt;b.fv = &amp;fv-&gt;b;</span>
<span class="lineNum">   12855 </span><span class="lineNoCov">          0 :     cv-&gt;enc = enc;</span>
<span class="lineNum">   12856 </span><span class="lineNoCov">          0 :     cv-&gt;map_of_enc = fv-&gt;b.map;           /* I know this is done again in _CharViewCreate, but it needs to be done before creating the title */</span>
<span class="lineNum">   12857 </span>            : 
<span class="lineNum">   12858 </span><span class="lineNoCov">          0 :     cv-&gt;infoh = 13;</span>
<span class="lineNum">   12859 </span>            : #if defined(__MINGW32__)||defined(__CYGWIN__)
<span class="lineNum">   12860 </span>            :     cv-&gt;infoh = 26;
<span class="lineNum">   12861 </span>            : #endif
<span class="lineNum">   12862 </span><span class="lineNoCov">          0 :     cv-&gt;rulerh = 16;</span>
<span class="lineNum">   12863 </span>            : 
<span class="lineNum">   12864 </span>            : 
<span class="lineNum">   12865 </span><span class="lineNoCov">          0 :     SCLigCaretCheck(sc,false);</span>
<span class="lineNum">   12866 </span>            : 
<span class="lineNum">   12867 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">   12868 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_utf8_ititle;</span>
<span class="lineNum">   12869 </span><span class="lineNoCov">          0 :     wattrs.event_masks = -1;</span>
<span class="lineNum">   12870 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_mypointer;</span>
<span class="lineNum">   12871 </span><span class="lineNoCov">          0 :     wattrs.utf8_icon_title = (const char*)CVMakeTitles(cv,buf,sizeof(buf));</span>
<span class="lineNum">   12872 </span><span class="lineNoCov">          0 :     wattrs.utf8_window_title = buf;</span>
<span class="lineNum">   12873 </span><span class="lineNoCov">          0 :     wattrs.icon = CharIcon(cv, fv);</span>
<span class="lineNum">   12874 </span><span class="lineNoCov">          0 :     if ( wattrs.icon )</span>
<span class="lineNum">   12875 </span><span class="lineNoCov">          0 :         wattrs.mask |= wam_icon;</span>
<span class="lineNum">   12876 </span><span class="lineNoCov">          0 :     pos.x = GGadgetScale(104)+6;</span>
<span class="lineNum">   12877 </span><span class="lineNoCov">          0 :     pos.width = (cv_width &gt; 0) ? cv_width : default_cv_width;</span>
<span class="lineNum">   12878 </span><span class="lineNoCov">          0 :     pos.height = (cv_height &gt; 0) ? cv_height : default_cv_height;</span>
<span class="lineNum">   12879 </span><span class="lineNoCov">          0 :     DefaultY(&amp;pos);</span>
<span class="lineNum">   12880 </span>            : 
<span class="lineNum">   12881 </span><span class="lineNoCov">          0 :     cv-&gt;gw = gw = GDrawCreateTopWindow(NULL,&amp;pos,cv_e_h,cv,&amp;wattrs);</span>
<span class="lineNum">   12882 </span><span class="lineNoCov">          0 :     free( (unichar_t *) wattrs.icon_title );</span>
<span class="lineNum">   12883 </span><span class="lineNoCov">          0 :     free((char*)wattrs.utf8_icon_title);</span>
<span class="lineNum">   12884 </span><span class="lineNoCov">          0 :     GDrawSetWindowTypeName(cv-&gt;gw, &quot;CharView&quot;);</span>
<span class="lineNum">   12885 </span>            : 
<span class="lineNum">   12886 </span>            :     // FIXME: cant do this until gw is shown?
<span class="lineNum">   12887 </span>            :     GTextBounds textbounds;
<span class="lineNum">   12888 </span><span class="lineNoCov">          0 :     GDrawGetText8Bounds(cv-&gt;gw,&quot;0123456789hl&quot;,10,&amp;textbounds);</span>
<span class="lineNum">   12889 </span>            :     TRACE(&quot;XXXXXX as:%d  ds:%d\n&quot;,  textbounds.as, textbounds.ds );
<span class="lineNum">   12890 </span><span class="lineNoCov">          0 :     cv-&gt;charselectorh = textbounds.as+textbounds.ds+1;</span>
<span class="lineNum">   12891 </span>            :     TRACE(&quot;XXXXXX h:%d\n&quot;, GDrawGetText8Height( cv-&gt;gw, &quot;0123456AZgplh&quot;, 10));
<span class="lineNum">   12892 </span><span class="lineNoCov">          0 :     cv-&gt;charselectorh = 35;</span>
<span class="lineNum">   12893 </span>            : 
<span class="lineNum">   12894 </span>            : 
<span class="lineNum">   12895 </span><span class="lineNoCov">          0 :     GDrawGetSize(GDrawGetRoot(screen_display),&amp;zoom);</span>
<span class="lineNum">   12896 </span><span class="lineNoCov">          0 :     zoom.x = CVPalettesWidth(); zoom.width -= zoom.x-10;</span>
<span class="lineNum">   12897 </span><span class="lineNoCov">          0 :     zoom.height -= 30;                  /* Room for title bar &amp; such */</span>
<span class="lineNum">   12898 </span><span class="lineNoCov">          0 :     GDrawSetZoom(gw,&amp;zoom,-1);</span>
<span class="lineNum">   12899 </span>            : 
<span class="lineNum">   12900 </span><span class="lineNoCov">          0 :     memset(&amp;gd,0,sizeof(gd));</span>
<span class="lineNum">   12901 </span><span class="lineNoCov">          0 :     gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">   12902 </span><span class="lineNoCov">          0 :     helplist[0].invoke = CVMenuContextualHelp;</span>
<span class="lineNum">   12903 </span>            : #ifndef _NO_PYTHON
<span class="lineNum">   12904 </span><span class="lineNoCov">          0 :     if ( cvpy_menu!=NULL )</span>
<span class="lineNum">   12905 </span><span class="lineNoCov">          0 :         mblist[4].ti.disabled = mblist_nomm[4].ti.disabled = false;</span>
<span class="lineNum">   12906 </span><span class="lineNoCov">          0 :     mblist[4].sub = mblist_nomm[4].sub = cvpy_menu;</span>
<span class="lineNum">   12907 </span>            : #define CALLBACKS_INDEX 5 /* FIXME: There has to be a better way than this. */
<span class="lineNum">   12908 </span>            : #else
<span class="lineNum">   12909 </span>            : #define CALLBACKS_INDEX 4 /* FIXME: There has to be a better way than this. */
<span class="lineNum">   12910 </span>            : #endif          /* _NO_PYTHON */
<span class="lineNum">   12911 </span>            : #ifdef NATIVE_CALLBACKS
<span class="lineNum">   12912 </span>            :     if ( cv_menu!=NULL )
<span class="lineNum">   12913 </span>            :         mblist[CALLBACKS_INDEX].ti.disabled = mblist_nomm[CALLBACKS_INDEX].ti.disabled = false;
<span class="lineNum">   12914 </span>            :     mblist[CALLBACKS_INDEX].sub = mblist_nomm[CALLBACKS_INDEX].sub = cv_menu;
<span class="lineNum">   12915 </span>            : #endif          /* NATIVE_CALLBACKS */
<span class="lineNum">   12916 </span><span class="lineNoCov">          0 :     gd.u.menu2 = sc-&gt;parent-&gt;mm==NULL ? mblist_nomm : mblist;</span>
<span class="lineNum">   12917 </span><span class="lineNoCov">          0 :     cv-&gt;mb = GMenu2BarCreate( gw, &amp;gd, NULL);</span>
<span class="lineNum">   12918 </span><span class="lineNoCov">          0 :     GGadgetGetSize(cv-&gt;mb,&amp;gsize);</span>
<span class="lineNum">   12919 </span><span class="lineNoCov">          0 :     cv-&gt;mbh = gsize.height;</span>
<span class="lineNum">   12920 </span>            : 
<span class="lineNum">   12921 </span>            : //    TRACE(&quot;pos.x:%d pos.y:%d pos.w:%d pos.h:%d\n&quot;, pos.x, pos.y, pos.width, pos.height );
<span class="lineNum">   12922 </span><span class="lineNoCov">          0 :     GDrawGetSize(cv-&gt;gw,&amp;pos);</span>
<span class="lineNum">   12923 </span><span class="lineNoCov">          0 :     memset(&amp;gd,0,sizeof(gd));</span>
<span class="lineNum">   12924 </span>            : //    gd.pos.x = pos.x;
<span class="lineNum">   12925 </span><span class="lineNoCov">          0 :     gd.pos.x = 3;</span>
<span class="lineNum">   12926 </span><span class="lineNoCov">          0 :     gd.pos.y = cv-&gt;mbh+2;</span>
<span class="lineNum">   12927 </span><span class="lineNoCov">          0 :     gd.pos.height = cv-&gt;charselectorh-4;</span>
<span class="lineNum">   12928 </span><span class="lineNoCov">          0 :     gd.pos.width  = cv_width / 2;</span>
<span class="lineNum">   12929 </span><span class="lineNoCov">          0 :     gd.flags = gg_visible|gg_enabled|gg_pos_in_pixels|gg_text_xim;</span>
<span class="lineNum">   12930 </span><span class="lineNoCov">          0 :     gd.handle_controlevent = CV_OnCharSelectorTextChanged;</span>
<span class="lineNum">   12931 </span><span class="lineNoCov">          0 :     gd.u.list = cv_charselector_init;</span>
<span class="lineNum">   12932 </span><span class="lineNoCov">          0 :     cv-&gt;charselector = GListFieldCreate(cv-&gt;gw,&amp;gd,cv);</span>
<span class="lineNum">   12933 </span><span class="lineNoCov">          0 :     CVSetCharSelectorValueFromSC( cv, sc );</span>
<span class="lineNum">   12934 </span><span class="lineNoCov">          0 :     GGadgetSetSkipUnQualifiedHotkeyProcessing( cv-&gt;charselector, 1 );</span>
<span class="lineNum">   12935 </span>            : 
<span class="lineNum">   12936 </span>            :     // Up and Down buttons for moving through the word list.
<span class="lineNum">   12937 </span>            :     {
<span class="lineNum">   12938 </span><span class="lineNoCov">          0 :         GGadgetData xgd = gd;</span>
<span class="lineNum">   12939 </span><span class="lineNoCov">          0 :         gd.pos.width += 2 * xgd.pos.height + 4;</span>
<span class="lineNum">   12940 </span><span class="lineNoCov">          0 :         memset(label, '\0', sizeof(GTextInfo));</span>
<span class="lineNum">   12941 </span><span class="lineNoCov">          0 :         xgd.pos.x += xgd.pos.width + 2;</span>
<span class="lineNum">   12942 </span><span class="lineNoCov">          0 :         xgd.pos.width = xgd.pos.height;</span>
<span class="lineNum">   12943 </span><span class="lineNoCov">          0 :         xgd.flags = gg_visible|gg_enabled|gg_pos_in_pixels;</span>
<span class="lineNum">   12944 </span><span class="lineNoCov">          0 :         xgd.handle_controlevent = CVMoveToPrevInWordList;</span>
<span class="lineNum">   12945 </span><span class="lineNoCov">          0 :         xgd.label = &amp;label[0];</span>
<span class="lineNum">   12946 </span><span class="lineNoCov">          0 :         label[0].text = (unichar_t *) &quot;&quot;;</span>
<span class="lineNum">   12947 </span><span class="lineNoCov">          0 :         label[0].text_is_1byte = true;</span>
<span class="lineNum">   12948 </span><span class="lineNoCov">          0 :         cv-&gt;charselectorPrev = GButtonCreate(cv-&gt;gw,&amp;xgd,cv);</span>
<span class="lineNum">   12949 </span><span class="lineNoCov">          0 :         memset(label, '\0', sizeof(GTextInfo));</span>
<span class="lineNum">   12950 </span><span class="lineNoCov">          0 :         xgd.pos.x += xgd.pos.width + 2;</span>
<span class="lineNum">   12951 </span><span class="lineNoCov">          0 :         xgd.pos.width = xgd.pos.height;</span>
<span class="lineNum">   12952 </span><span class="lineNoCov">          0 :         xgd.flags = gg_visible|gg_enabled|gg_pos_in_pixels;</span>
<span class="lineNum">   12953 </span><span class="lineNoCov">          0 :         xgd.handle_controlevent = CVMoveToNextInWordList;</span>
<span class="lineNum">   12954 </span><span class="lineNoCov">          0 :         xgd.label = &amp;label[0];</span>
<span class="lineNum">   12955 </span><span class="lineNoCov">          0 :         label[0].text = (unichar_t *) &quot;&quot;;</span>
<span class="lineNum">   12956 </span><span class="lineNoCov">          0 :         label[0].text_is_1byte = true;</span>
<span class="lineNum">   12957 </span><span class="lineNoCov">          0 :         cv-&gt;charselectorNext = GButtonCreate(cv-&gt;gw,&amp;xgd,cv);</span>
<span class="lineNum">   12958 </span>            :     }
<span class="lineNum">   12959 </span>            :     
<span class="lineNum">   12960 </span>            : 
<span class="lineNum">   12961 </span><span class="lineNoCov">          0 :     memset(aspects,0,sizeof(aspects));</span>
<span class="lineNum">   12962 </span><span class="lineNoCov">          0 :     aspects[0].text = (unichar_t *) sc-&gt;name;</span>
<span class="lineNum">   12963 </span><span class="lineNoCov">          0 :     aspects[0].text_is_1byte = true;</span>
<span class="lineNum">   12964 </span>            :         /* NOT visible until we add a second glyph to the stack */
<span class="lineNum">   12965 </span><span class="lineNoCov">          0 :     gd.flags = gg_enabled|gg_tabset_nowindow|gg_tabset_scroll|gg_pos_in_pixels;</span>
<span class="lineNum">   12966 </span><span class="lineNoCov">          0 :     gd.u.menu = NULL;</span>
<span class="lineNum">   12967 </span><span class="lineNoCov">          0 :     gd.u.tabs = aspects;</span>
<span class="lineNum">   12968 </span><span class="lineNoCov">          0 :     gd.pos.x = 0;</span>
<span class="lineNum">   12969 </span><span class="lineNoCov">          0 :     gd.pos.y = cv-&gt;mbh;</span>
<span class="lineNum">   12970 </span><span class="lineNoCov">          0 :     gd.handle_controlevent = CVChangeToFormer;</span>
<span class="lineNum">   12971 </span><span class="lineNoCov">          0 :     cv-&gt;tabs = GTabSetCreate( gw, &amp;gd, NULL );</span>
<span class="lineNum">   12972 </span><span class="lineNoCov">          0 :     cv-&gt;former_cnt = 1;</span>
<span class="lineNum">   12973 </span><span class="lineNoCov">          0 :     cv-&gt;former_names[0] = copy(sc-&gt;name);</span>
<span class="lineNum">   12974 </span><span class="lineNoCov">          0 :     GGadgetTakesKeyboard(cv-&gt;tabs,false);</span>
<span class="lineNum">   12975 </span>            : 
<span class="lineNum">   12976 </span><span class="lineNoCov">          0 :     _CharViewCreate( cv, sc, fv, enc, show );</span>
<span class="lineNum">   12977 </span>            :     // Frank wants to avoid needing to implement scaling twice.
<span class="lineNum">   12978 </span><span class="lineNoCov">          0 :     CVResize(cv);</span>
<span class="lineNum">   12979 </span>            : 
<span class="lineNum">   12980 </span><span class="lineNoCov">          0 :     return( cv );</span>
<a name="12981"><span class="lineNum">   12981 </span>            : }</a>
<span class="lineNum">   12982 </span>            : 
<span class="lineNum">   12983 </span><span class="lineNoCov">          0 : CharView *CharViewCreate(SplineChar *sc, FontView *fv,int enc)</span>
<span class="lineNum">   12984 </span>            : {
<span class="lineNum">   12985 </span><span class="lineNoCov">          0 :     return CharViewCreateExtended( sc, fv, enc, 1 );</span>
<a name="12986"><span class="lineNum">   12986 </span>            : }</a>
<span class="lineNum">   12987 </span>            : 
<span class="lineNum">   12988 </span><span class="lineNoCov">          0 : void CharViewFree(CharView *cv) {</span>
<span class="lineNum">   12989 </span>            :     int i;
<span class="lineNum">   12990 </span>            : 
<span class="lineNum">   12991 </span><span class="lineNoCov">          0 :     if ( cv-&gt;qg != NULL )</span>
<span class="lineNum">   12992 </span><span class="lineNoCov">          0 :         QGRmCharView(cv-&gt;qg,cv);</span>
<span class="lineNum">   12993 </span><span class="lineNoCov">          0 :     BDFCharFree(cv-&gt;filled);</span>
<span class="lineNum">   12994 </span><span class="lineNoCov">          0 :     if ( cv-&gt;ruler_w ) {</span>
<span class="lineNum">   12995 </span><span class="lineNoCov">          0 :         GDrawDestroyWindow(cv-&gt;ruler_w);</span>
<span class="lineNum">   12996 </span><span class="lineNoCov">          0 :         cv-&gt;ruler_w = NULL;</span>
<span class="lineNum">   12997 </span>            :     }
<span class="lineNum">   12998 </span><span class="lineNoCov">          0 :     if ( cv-&gt;ruler_linger_w ) {</span>
<span class="lineNum">   12999 </span><span class="lineNoCov">          0 :         GDrawDestroyWindow(cv-&gt;ruler_linger_w);</span>
<span class="lineNum">   13000 </span><span class="lineNoCov">          0 :         cv-&gt;ruler_linger_w = NULL;</span>
<span class="lineNum">   13001 </span>            :     }
<span class="lineNum">   13002 </span><span class="lineNoCov">          0 :     free(cv-&gt;gi.u.image-&gt;clut);</span>
<span class="lineNum">   13003 </span><span class="lineNoCov">          0 :     free(cv-&gt;gi.u.image);</span>
<span class="lineNum">   13004 </span>            : #if HANYANG
<span class="lineNum">   13005 </span>            :     if ( cv-&gt;jamodisplay!=NULL )
<span class="lineNum">   13006 </span>            :         Disp_DoFinish(cv-&gt;jamodisplay,true);
<span class="lineNum">   13007 </span>            : #endif
<span class="lineNum">   13008 </span>            : 
<span class="lineNum">   13009 </span><span class="lineNoCov">          0 :     CVDebugFree(cv-&gt;dv);</span>
<span class="lineNum">   13010 </span>            : 
<span class="lineNum">   13011 </span><span class="lineNoCov">          0 :     SplinePointListsFree(cv-&gt;b.gridfit);</span>
<span class="lineNum">   13012 </span><span class="lineNoCov">          0 :     FreeType_FreeRaster(cv-&gt;oldraster);</span>
<span class="lineNum">   13013 </span><span class="lineNoCov">          0 :     FreeType_FreeRaster(cv-&gt;raster);</span>
<span class="lineNum">   13014 </span>            : 
<span class="lineNum">   13015 </span><span class="lineNoCov">          0 :     CVDebugFree(cv-&gt;dv);</span>
<span class="lineNum">   13016 </span>            : 
<span class="lineNum">   13017 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;cv-&gt;former_cnt; ++i )</span>
<span class="lineNum">   13018 </span><span class="lineNoCov">          0 :         free(cv-&gt;former_names[i]);</span>
<span class="lineNum">   13019 </span>            : 
<span class="lineNum">   13020 </span><span class="lineNoCov">          0 :     free(cv-&gt;ruler_intersections);</span>
<span class="lineNum">   13021 </span><span class="lineNoCov">          0 :     free(cv);</span>
<a name="13022"><span class="lineNum">   13022 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   13023 </span>            : 
<span class="lineNum">   13024 </span><span class="lineNoCov">          0 : int CVValid(SplineFont *sf, SplineChar *sc, CharView *cv) {</span>
<span class="lineNum">   13025 </span>            :     /* A charview may have been closed. A splinechar may have been removed */
<span class="lineNum">   13026 </span>            :     /*  from a font */
<span class="lineNum">   13027 </span>            :     CharView *test;
<span class="lineNum">   13028 </span>            : 
<span class="lineNum">   13029 </span><span class="lineNoCov">          0 :     if ( cv-&gt;b.sc!=sc || sc-&gt;parent!=sf )</span>
<span class="lineNum">   13030 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">   13031 </span><span class="lineNoCov">          0 :     if ( sc-&gt;orig_pos&lt;0 || sc-&gt;orig_pos&gt;sf-&gt;glyphcnt )</span>
<span class="lineNum">   13032 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">   13033 </span><span class="lineNoCov">          0 :     if ( sf-&gt;glyphs[sc-&gt;orig_pos]!=sc )</span>
<span class="lineNum">   13034 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">   13035 </span><span class="lineNoCov">          0 :     for ( test=(CharView *) (sc-&gt;views); test!=NULL; test=(CharView *) (test-&gt;b.next) )</span>
<span class="lineNum">   13036 </span><span class="lineNoCov">          0 :         if ( test==cv )</span>
<span class="lineNum">   13037 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">   13038 </span>            : 
<span class="lineNum">   13039 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">   13040 </span>            : }
<span class="lineNum">   13041 </span>            : 
<a name="13042"><span class="lineNum">   13042 </span>            : static int charview_ready = false;</a>
<span class="lineNum">   13043 </span>            : 
<span class="lineNum">   13044 </span><span class="lineNoCov">          0 : static void CharViewFinish() {</span>
<span class="lineNum">   13045 </span>            :   // The memory leak is limited and reachable.
<span class="lineNum">   13046 </span><span class="lineNoCov">          0 :   if ( !charview_ready ) return;</span>
<span class="lineNum">   13047 </span><span class="lineNoCov">          0 :     charview_ready = false;</span>
<span class="lineNum">   13048 </span><span class="lineNoCov">          0 :     mb2FreeGetText(mblist);</span>
<span class="lineNum">   13049 </span><span class="lineNoCov">          0 :     mb2FreeGetText(spiroptlist);</span>
<span class="lineNum">   13050 </span>            :     int i;
<span class="lineNum">   13051 </span><span class="lineNoCov">          0 :     for ( i=0; mblist_nomm[i].ti.text!=NULL; ++i ) {</span>
<span class="lineNum">   13052 </span><span class="lineNoCov">          0 :       free(mblist_nomm[i].ti.text_untranslated); mblist_nomm[i].ti.text_untranslated = NULL;</span>
<span class="lineNum">   13053 </span>            :     }
<a name="13054"><span class="lineNum">   13054 </span>            : }</a>
<span class="lineNum">   13055 </span>            : 
<span class="lineNum">   13056 </span><span class="lineNoCov">          0 : void CharViewFinishNonStatic() {</span>
<span class="lineNum">   13057 </span><span class="lineNoCov">          0 :   CharViewFinish();</span>
<a name="13058"><span class="lineNum">   13058 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   13059 </span>            : 
<span class="lineNum">   13060 </span><span class="lineNoCov">          0 : static void CharViewInit(void) {</span>
<span class="lineNum">   13061 </span>            :     int i;
<span class="lineNum">   13062 </span>            :     // static int done = false; // superseded by charview_ready.
<span class="lineNum">   13063 </span>            : 
<span class="lineNum">   13064 </span><span class="lineNoCov">          0 :     if ( charview_ready )</span>
<span class="lineNum">   13065 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   13066 </span><span class="lineNoCov">          0 :     charview_ready = true;</span>
<span class="lineNum">   13067 </span>            : //    TRACE(&quot;CharViewInit(top) mblist[0].text before translation: %s\n&quot;, mblist[0].ti.text );
<span class="lineNum">   13068 </span>            : 
<span class="lineNum">   13069 </span><span class="lineNoCov">          0 :     mb2DoGetText(mblist);</span>
<span class="lineNum">   13070 </span>            : 
<span class="lineNum">   13071 </span>            : //    TRACE(&quot;CharViewInit(2) mblist[0].text after    translation: %s\n&quot;, u_to_c(mblist[0].ti.text) );
<span class="lineNum">   13072 </span>            : //    TRACE(&quot;CharViewInit(2) mblist[0].text_untranslated notrans: %s\n&quot;, mblist[0].ti.text_untranslated );
<span class="lineNum">   13073 </span>            : 
<span class="lineNum">   13074 </span><span class="lineNoCov">          0 :     mb2DoGetText(spiroptlist);</span>
<span class="lineNum">   13075 </span><span class="lineNoCov">          0 :     for ( i=0; mblist_nomm[i].ti.text!=NULL; ++i )</span>
<span class="lineNum">   13076 </span>            :     {
<span class="lineNum">   13077 </span>            :         // Note that because we are doing this ourself we have to set
<span class="lineNum">   13078 </span>            :         // the text_untranslated ourself too.
<span class="lineNum">   13079 </span><span class="lineNoCov">          0 :         if( mblist_nomm[i].shortcut )</span>
<span class="lineNum">   13080 </span><span class="lineNoCov">          0 :             mblist_nomm[i].ti.text_untranslated = copy(mblist_nomm[i].shortcut);</span>
<span class="lineNum">   13081 </span>            :         else
<span class="lineNum">   13082 </span><span class="lineNoCov">          0 :             mblist_nomm[i].ti.text_untranslated = copy((char*)mblist_nomm[i].ti.text);</span>
<span class="lineNum">   13083 </span>            : 
<span class="lineNum">   13084 </span><span class="lineNoCov">          0 :         mblist_nomm[i].ti.text = (unichar_t *) _((char *) mblist_nomm[i].ti.text);</span>
<span class="lineNum">   13085 </span>            :     }
<span class="lineNum">   13086 </span><span class="lineNoCov">          0 :     atexit(&amp;CharViewFinishNonStatic);</span>
<a name="13087"><span class="lineNum">   13087 </span>            : }</a>
<span class="lineNum">   13088 </span>            : 
<span class="lineNum">   13089 </span><span class="lineNoCov">          0 : static int nested_cv_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">   13090 </span><span class="lineNoCov">          0 :     CharView *cv = (CharView *) GDrawGetUserData(gw);</span>
<span class="lineNum">   13091 </span>            : 
<span class="lineNum">   13092 </span><span class="lineNoCov">          0 :     switch ( event-&gt;type ) {</span>
<span class="lineNum">   13093 </span>            :       case et_expose:
<span class="lineNum">   13094 </span><span class="lineNoCov">          0 :         InfoExpose(cv,gw,event);</span>
<span class="lineNum">   13095 </span><span class="lineNoCov">          0 :         CVLogoExpose(cv,gw,event);</span>
<span class="lineNum">   13096 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">   13097 </span>            :       case et_char:
<span class="lineNum">   13098 </span><span class="lineNoCov">          0 :         (cv-&gt;b.container-&gt;funcs-&gt;charEvent)(cv-&gt;b.container,event);</span>
<span class="lineNum">   13099 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">   13100 </span>            :       case et_charup:
<span class="lineNum">   13101 </span><span class="lineNoCov">          0 :         CVCharUp(cv,event);</span>
<span class="lineNum">   13102 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">   13103 </span>            :       case et_controlevent:
<span class="lineNum">   13104 </span><span class="lineNoCov">          0 :         switch ( event-&gt;u.control.subtype ) {</span>
<span class="lineNum">   13105 </span>            :           case et_scrollbarchange:
<span class="lineNum">   13106 </span><span class="lineNoCov">          0 :             if ( event-&gt;u.control.g == cv-&gt;hsb )</span>
<span class="lineNum">   13107 </span><span class="lineNoCov">          0 :                 CVHScroll(cv,&amp;event-&gt;u.control.u.sb);</span>
<span class="lineNum">   13108 </span>            :             else
<span class="lineNum">   13109 </span><span class="lineNoCov">          0 :                 CVVScroll(cv,&amp;event-&gt;u.control.u.sb);</span>
<span class="lineNum">   13110 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">   13111 </span>            :         }
<span class="lineNum">   13112 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">   13113 </span>            :       case et_map:
<span class="lineNum">   13114 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.map.is_visible )</span>
<span class="lineNum">   13115 </span><span class="lineNoCov">          0 :             CVPaletteActivate(cv);</span>
<span class="lineNum">   13116 </span>            :         else
<span class="lineNum">   13117 </span><span class="lineNoCov">          0 :             CVPalettesHideIfMine(cv);</span>
<span class="lineNum">   13118 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">   13119 </span>            :       case et_resize:
<span class="lineNum">   13120 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.resize.sized )</span>
<span class="lineNum">   13121 </span><span class="lineNoCov">          0 :             CVResize(cv);</span>
<span class="lineNum">   13122 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">   13123 </span>            :       case et_destroy:
<span class="lineNum">   13124 </span><span class="lineNoCov">          0 :         if ( cv-&gt;backimgs!=NULL ) {</span>
<span class="lineNum">   13125 </span><span class="lineNoCov">          0 :             GDrawDestroyWindow(cv-&gt;backimgs);</span>
<span class="lineNum">   13126 </span><span class="lineNoCov">          0 :             cv-&gt;backimgs = NULL;</span>
<span class="lineNum">   13127 </span>            :         }
<span class="lineNum">   13128 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">   13129 </span>            :       case et_mouseup: case et_mousedown:
<span class="lineNum">   13130 </span><span class="lineNoCov">          0 :         GGadgetEndPopup();</span>
<span class="lineNum">   13131 </span><span class="lineNoCov">          0 :         CVPaletteActivate(cv);</span>
<span class="lineNum">   13132 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">   13133 </span>            :     }
<span class="lineNum">   13134 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="13135"><span class="lineNum">   13135 </span>            : }</a>
<span class="lineNum">   13136 </span>            : 
<span class="lineNum">   13137 </span><span class="lineNoCov">          0 : void SVCharViewInits(SearchView *sv) {</span>
<span class="lineNum">   13138 </span>            :     GGadgetData gd;
<span class="lineNum">   13139 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">   13140 </span>            :     GRect pos, gsize;
<span class="lineNum">   13141 </span>            : 
<span class="lineNum">   13142 </span><span class="lineNoCov">          0 :     CharViewInit();</span>
<span class="lineNum">   13143 </span>            : 
<span class="lineNum">   13144 </span><span class="lineNoCov">          0 :     memset(&amp;gd,0,sizeof(gd));</span>
<span class="lineNum">   13145 </span><span class="lineNoCov">          0 :     gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">   13146 </span><span class="lineNoCov">          0 :     helplist[0].invoke = CVMenuContextualHelp;</span>
<span class="lineNum">   13147 </span><span class="lineNoCov">          0 :     gd.u.menu2 = mblist_nomm;</span>
<span class="lineNum">   13148 </span><span class="lineNoCov">          0 :     sv-&gt;mb = GMenu2BarCreate( sv-&gt;gw, &amp;gd, NULL);</span>
<span class="lineNum">   13149 </span><span class="lineNoCov">          0 :     GGadgetGetSize(sv-&gt;mb,&amp;gsize);</span>
<span class="lineNum">   13150 </span><span class="lineNoCov">          0 :     sv-&gt;mbh = gsize.height;</span>
<span class="lineNum">   13151 </span>            : 
<span class="lineNum">   13152 </span><span class="lineNoCov">          0 :     pos.y = sv-&gt;mbh+sv-&gt;fh+10; pos.height = 220;</span>
<span class="lineNum">   13153 </span><span class="lineNoCov">          0 :     pos.width = pos.height; pos.x = 10+pos.width+20;    /* Do replace first so palettes appear propperly */</span>
<span class="lineNum">   13154 </span><span class="lineNoCov">          0 :     sv-&gt;rpl_x = pos.x; sv-&gt;cv_y = pos.y;</span>
<span class="lineNum">   13155 </span><span class="lineNoCov">          0 :     sv-&gt;cv_height = pos.height; sv-&gt;cv_width = pos.width;</span>
<span class="lineNum">   13156 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">   13157 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor;</span>
<span class="lineNum">   13158 </span><span class="lineNoCov">          0 :     wattrs.event_masks = -1;</span>
<span class="lineNum">   13159 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_mypointer;</span>
<span class="lineNum">   13160 </span><span class="lineNoCov">          0 :     sv-&gt;cv_rpl.gw = GWidgetCreateSubWindow(sv-&gt;gw,&amp;pos,nested_cv_e_h,&amp;sv-&gt;cv_rpl,&amp;wattrs);</span>
<span class="lineNum">   13161 </span><span class="lineNoCov">          0 :     _CharViewCreate(&amp;sv-&gt;cv_rpl, &amp;sv-&gt;sd.sc_rpl, &amp;sv-&gt;dummy_fv, 1, 1);</span>
<span class="lineNum">   13162 </span>            : 
<span class="lineNum">   13163 </span><span class="lineNoCov">          0 :     pos.x = 10;</span>
<span class="lineNum">   13164 </span><span class="lineNoCov">          0 :     sv-&gt;cv_srch.gw = GWidgetCreateSubWindow(sv-&gt;gw,&amp;pos,nested_cv_e_h,&amp;sv-&gt;cv_srch,&amp;wattrs);</span>
<span class="lineNum">   13165 </span><span class="lineNoCov">          0 :     _CharViewCreate(&amp;sv-&gt;cv_srch, &amp;sv-&gt;sd.sc_srch, &amp;sv-&gt;dummy_fv, 0, 1);</span>
<span class="lineNum">   13166 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   13167 </span>            : 
<a name="13168"><span class="lineNum">   13168 </span>            : /* Same for the MATH Kern dlg */</a>
<span class="lineNum">   13169 </span>            : 
<span class="lineNum">   13170 </span><span class="lineNoCov">          0 : void MKDCharViewInits(MathKernDlg *mkd) {</span>
<span class="lineNum">   13171 </span>            :     GGadgetData gd;
<span class="lineNum">   13172 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">   13173 </span>            :     GRect pos, gsize;
<span class="lineNum">   13174 </span>            :     int i;
<span class="lineNum">   13175 </span>            : 
<span class="lineNum">   13176 </span><span class="lineNoCov">          0 :     CharViewInit();</span>
<span class="lineNum">   13177 </span>            : 
<span class="lineNum">   13178 </span><span class="lineNoCov">          0 :     memset(&amp;gd,0,sizeof(gd));</span>
<span class="lineNum">   13179 </span><span class="lineNoCov">          0 :     gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">   13180 </span><span class="lineNoCov">          0 :     helplist[0].invoke = CVMenuContextualHelp;</span>
<span class="lineNum">   13181 </span><span class="lineNoCov">          0 :     gd.u.menu2 = mblist_nomm;</span>
<span class="lineNum">   13182 </span><span class="lineNoCov">          0 :     mkd-&gt;mb = GMenu2BarCreate( mkd-&gt;gw, &amp;gd, NULL);</span>
<span class="lineNum">   13183 </span><span class="lineNoCov">          0 :     GGadgetGetSize(mkd-&gt;mb,&amp;gsize);</span>
<span class="lineNum">   13184 </span><span class="lineNoCov">          0 :     mkd-&gt;mbh = gsize.height;</span>
<span class="lineNum">   13185 </span>            : 
<span class="lineNum">   13186 </span><span class="lineNoCov">          0 :     mkd-&gt;mid_space = 20;</span>
<span class="lineNum">   13187 </span><span class="lineNoCov">          0 :     for ( i=3; i&gt;=0; --i ) { /* Create backwards so palettes get set in topright (last created) */</span>
<span class="lineNum">   13188 </span><span class="lineNoCov">          0 :         pos.y = mkd-&gt;fh+10; pos.height = 220;        /* Size doesn't matter, adjusted later */</span>
<span class="lineNum">   13189 </span><span class="lineNoCov">          0 :         pos.width = pos.height; pos.x = 10+i*(pos.width+20);</span>
<span class="lineNum">   13190 </span><span class="lineNoCov">          0 :         mkd-&gt;cv_y = pos.y;</span>
<span class="lineNum">   13191 </span><span class="lineNoCov">          0 :         mkd-&gt;cv_height = pos.height; mkd-&gt;cv_width = pos.width;</span>
<span class="lineNum">   13192 </span><span class="lineNoCov">          0 :         memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">   13193 </span><span class="lineNoCov">          0 :         wattrs.mask = wam_events|wam_cursor;</span>
<span class="lineNum">   13194 </span><span class="lineNoCov">          0 :         wattrs.event_masks = -1;</span>
<span class="lineNum">   13195 </span><span class="lineNoCov">          0 :         wattrs.cursor = ct_mypointer;</span>
<span class="lineNum">   13196 </span><span class="lineNoCov">          0 :         (&amp;mkd-&gt;cv_topright)[i].gw = GWidgetCreateSubWindow(mkd-&gt;cvparent_w,&amp;pos,nested_cv_e_h,(&amp;mkd-&gt;cv_topright)+i,&amp;wattrs);</span>
<span class="lineNum">   13197 </span><span class="lineNoCov">          0 :         _CharViewCreate((&amp;mkd-&gt;cv_topright)+i, (&amp;mkd-&gt;sc_topright)+i, &amp;mkd-&gt;dummy_fv, i, 1);</span>
<span class="lineNum">   13198 </span>            :     }
<span class="lineNum">   13199 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   13200 </span>            : 
<span class="lineNum">   13201 </span>            : /* Same for the Tile Path dlg */
<span class="lineNum">   13202 </span>            : 
<span class="lineNum">   13203 </span>            : #ifdef FONTFORGE_CONFIG_TILEPATH
<span class="lineNum">   13204 </span>            : 
<span class="lineNum">   13205 </span>            : void TPDCharViewInits(TilePathDlg *tpd, int cid) {
<span class="lineNum">   13206 </span>            :     GGadgetData gd;
<span class="lineNum">   13207 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">   13208 </span>            :     GRect pos, gsize;
<span class="lineNum">   13209 </span>            :     int i;
<span class="lineNum">   13210 </span>            : 
<span class="lineNum">   13211 </span>            :     CharViewInit();
<span class="lineNum">   13212 </span>            : 
<span class="lineNum">   13213 </span>            :     memset(&amp;gd,0,sizeof(gd));
<span class="lineNum">   13214 </span>            :     gd.flags = gg_visible | gg_enabled;
<span class="lineNum">   13215 </span>            :     helplist[0].invoke = CVMenuContextualHelp;
<span class="lineNum">   13216 </span>            :     gd.u.menu2 = mblist_nomm;
<span class="lineNum">   13217 </span>            :     tpd-&gt;mb = GMenu2BarCreate( tpd-&gt;gw, &amp;gd, NULL);
<span class="lineNum">   13218 </span>            :     GGadgetGetSize(tpd-&gt;mb,&amp;gsize);
<span class="lineNum">   13219 </span>            :     tpd-&gt;mbh = gsize.height;
<span class="lineNum">   13220 </span>            : 
<span class="lineNum">   13221 </span>            :     tpd-&gt;mid_space = 20;
<span class="lineNum">   13222 </span>            :     for ( i=3; i&gt;=0; --i ) { /* Create backwards so palettes get set in topright (last created) */
<span class="lineNum">   13223 </span>            :         pos.y = 0; pos.height = 220;    /* Size doesn't matter, adjusted later */
<span class="lineNum">   13224 </span>            :         pos.width = pos.height; pos.x = 0;
<span class="lineNum">   13225 </span>            :         tpd-&gt;cv_y = pos.y;
<span class="lineNum">   13226 </span>            :         tpd-&gt;cv_height = pos.height; tpd-&gt;cv_width = pos.width;
<span class="lineNum">   13227 </span>            :         memset(&amp;wattrs,0,sizeof(wattrs));
<span class="lineNum">   13228 </span>            :         wattrs.mask = wam_events|wam_cursor;
<span class="lineNum">   13229 </span>            :         wattrs.event_masks = -1;
<span class="lineNum">   13230 </span>            :         wattrs.cursor = ct_mypointer;
<span class="lineNum">   13231 </span>            :         (&amp;tpd-&gt;cv_first)[i].gw = GWidgetCreateSubWindow(GDrawableGetWindow(GWidgetGetControl(tpd-&gt;gw,cid+i)),
<span class="lineNum">   13232 </span>            :                 &amp;pos,nested_cv_e_h,(&amp;tpd-&gt;cv_first)+i,&amp;wattrs);
<span class="lineNum">   13233 </span>            :         _CharViewCreate((&amp;tpd-&gt;cv_first)+i, (&amp;tpd-&gt;sc_first)+i, &amp;tpd-&gt;dummy_fv, i, 1 );
<span class="lineNum">   13234 </span>            :     }
<span class="lineNum">   13235 </span>            : }
<span class="lineNum">   13236 </span>            : 
<span class="lineNum">   13237 </span>            : void PTDCharViewInits(TilePathDlg *tpd, int cid) {
<span class="lineNum">   13238 </span>            :     GGadgetData gd;
<span class="lineNum">   13239 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">   13240 </span>            :     GRect pos, gsize;
<span class="lineNum">   13241 </span>            : 
<span class="lineNum">   13242 </span>            :     CharViewInit();
<span class="lineNum">   13243 </span>            : 
<span class="lineNum">   13244 </span>            :     memset(&amp;gd,0,sizeof(gd));
<span class="lineNum">   13245 </span>            :     gd.flags = gg_visible | gg_enabled;
<span class="lineNum">   13246 </span>            :     helplist[0].invoke = CVMenuContextualHelp;
<span class="lineNum">   13247 </span>            :     gd.u.menu2 = mblist_nomm;
<span class="lineNum">   13248 </span>            :     tpd-&gt;mb = GMenu2BarCreate( tpd-&gt;gw, &amp;gd, NULL);
<span class="lineNum">   13249 </span>            :     GGadgetGetSize(tpd-&gt;mb,&amp;gsize);
<span class="lineNum">   13250 </span>            :     tpd-&gt;mbh = gsize.height;
<span class="lineNum">   13251 </span>            : 
<span class="lineNum">   13252 </span>            :     tpd-&gt;mid_space = 20;
<span class="lineNum">   13253 </span>            :      {
<span class="lineNum">   13254 </span>            :         pos.y = 0; pos.height = 220;    /* Size doesn't matter, adjusted later */
<span class="lineNum">   13255 </span>            :         pos.width = pos.height; pos.x = 0;
<span class="lineNum">   13256 </span>            :         tpd-&gt;cv_y = pos.y;
<span class="lineNum">   13257 </span>            :         tpd-&gt;cv_height = pos.height; tpd-&gt;cv_width = pos.width;
<span class="lineNum">   13258 </span>            :         memset(&amp;wattrs,0,sizeof(wattrs));
<span class="lineNum">   13259 </span>            :         wattrs.mask = wam_events|wam_cursor;
<span class="lineNum">   13260 </span>            :         wattrs.event_masks = -1;
<span class="lineNum">   13261 </span>            :         wattrs.cursor = ct_mypointer;
<span class="lineNum">   13262 </span>            :         tpd-&gt;cv_first.gw = GWidgetCreateSubWindow(GDrawableGetWindow(GWidgetGetControl(tpd-&gt;gw,cid)),
<span class="lineNum">   13263 </span>            :                 &amp;pos,nested_cv_e_h,&amp;tpd-&gt;cv_first,&amp;wattrs);
<span class="lineNum">   13264 </span>            :         _CharViewCreate(&amp;tpd-&gt;cv_first, &amp;tpd-&gt;sc_first, &amp;tpd-&gt;dummy_fv, 0, 1 );
<span class="lineNum">   13265 </span>            :     }
<span class="lineNum">   13266 </span>            : }
<a name="13267"><span class="lineNum">   13267 </span>            : #endif          /* TilePath */</a>
<span class="lineNum">   13268 </span>            : 
<span class="lineNum">   13269 </span><span class="lineNoCov">          0 : void GDDCharViewInits(GradientDlg *gdd, int cid) {</span>
<span class="lineNum">   13270 </span>            :     GGadgetData gd;
<span class="lineNum">   13271 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">   13272 </span>            :     GRect pos, gsize;
<span class="lineNum">   13273 </span>            : 
<span class="lineNum">   13274 </span><span class="lineNoCov">          0 :     CharViewInit();</span>
<span class="lineNum">   13275 </span>            : 
<span class="lineNum">   13276 </span><span class="lineNoCov">          0 :     memset(&amp;gd,0,sizeof(gd));</span>
<span class="lineNum">   13277 </span><span class="lineNoCov">          0 :     gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">   13278 </span><span class="lineNoCov">          0 :     helplist[0].invoke = CVMenuContextualHelp;</span>
<span class="lineNum">   13279 </span><span class="lineNoCov">          0 :     gd.u.menu2 = mblist_nomm;</span>
<span class="lineNum">   13280 </span><span class="lineNoCov">          0 :     gdd-&gt;mb = GMenu2BarCreate( gdd-&gt;gw, &amp;gd, NULL);</span>
<span class="lineNum">   13281 </span><span class="lineNoCov">          0 :     GGadgetGetSize(gdd-&gt;mb,&amp;gsize);</span>
<span class="lineNum">   13282 </span><span class="lineNoCov">          0 :     gdd-&gt;mbh = gsize.height;</span>
<span class="lineNum">   13283 </span>            : 
<span class="lineNum">   13284 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">   13285 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor;</span>
<span class="lineNum">   13286 </span><span class="lineNoCov">          0 :     wattrs.event_masks = -1;</span>
<span class="lineNum">   13287 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_mypointer;</span>
<span class="lineNum">   13288 </span>            : 
<span class="lineNum">   13289 </span><span class="lineNoCov">          0 :     pos.y = 1; pos.height = 220;</span>
<span class="lineNum">   13290 </span><span class="lineNoCov">          0 :     pos.width = pos.height; pos.x = 0;</span>
<span class="lineNum">   13291 </span><span class="lineNoCov">          0 :     gdd-&gt;cv_grad.gw = GWidgetCreateSubWindow(</span>
<span class="lineNum">   13292 </span><span class="lineNoCov">          0 :             GDrawableGetWindow(GWidgetGetControl(gdd-&gt;gw,cid)),</span>
<span class="lineNum">   13293 </span><span class="lineNoCov">          0 :             &amp;pos,nested_cv_e_h,&amp;gdd-&gt;cv_grad,&amp;wattrs);</span>
<span class="lineNum">   13294 </span><span class="lineNoCov">          0 :     _CharViewCreate(&amp;gdd-&gt;cv_grad, &amp;gdd-&gt;sc_grad, &amp;gdd-&gt;dummy_fv, 0, 1 );</span>
<a name="13295"><span class="lineNum">   13295 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   13296 </span>            : 
<span class="lineNum">   13297 </span><span class="lineNoCov">          0 : void StrokeCharViewInits(StrokeDlg *sd, int cid) {</span>
<span class="lineNum">   13298 </span>            :     GGadgetData gd;
<span class="lineNum">   13299 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">   13300 </span>            :     GRect pos, gsize;
<span class="lineNum">   13301 </span>            : 
<span class="lineNum">   13302 </span><span class="lineNoCov">          0 :     CharViewInit();</span>
<span class="lineNum">   13303 </span>            : 
<span class="lineNum">   13304 </span><span class="lineNoCov">          0 :     memset(&amp;gd,0,sizeof(gd));</span>
<span class="lineNum">   13305 </span><span class="lineNoCov">          0 :     gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">   13306 </span><span class="lineNoCov">          0 :     helplist[0].invoke = CVMenuContextualHelp;</span>
<span class="lineNum">   13307 </span><span class="lineNoCov">          0 :     gd.u.menu2 = mblist_nomm;</span>
<span class="lineNum">   13308 </span><span class="lineNoCov">          0 :     sd-&gt;mb = GMenu2BarCreate( sd-&gt;gw, &amp;gd, NULL);</span>
<span class="lineNum">   13309 </span><span class="lineNoCov">          0 :     GGadgetGetSize(sd-&gt;mb,&amp;gsize);</span>
<span class="lineNum">   13310 </span><span class="lineNoCov">          0 :     sd-&gt;mbh = gsize.height;</span>
<span class="lineNum">   13311 </span>            : 
<span class="lineNum">   13312 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">   13313 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor;</span>
<span class="lineNum">   13314 </span><span class="lineNoCov">          0 :     wattrs.event_masks = -1;</span>
<span class="lineNum">   13315 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_mypointer;</span>
<span class="lineNum">   13316 </span>            : 
<span class="lineNum">   13317 </span><span class="lineNoCov">          0 :     pos.y = 1; pos.height = 220;</span>
<span class="lineNum">   13318 </span><span class="lineNoCov">          0 :     pos.width = pos.height; pos.x = 0;</span>
<span class="lineNum">   13319 </span><span class="lineNoCov">          0 :     sd-&gt;cv_stroke.gw = GWidgetCreateSubWindow(</span>
<span class="lineNum">   13320 </span><span class="lineNoCov">          0 :             GDrawableGetWindow(GWidgetGetControl(sd-&gt;gw,cid)),</span>
<span class="lineNum">   13321 </span><span class="lineNoCov">          0 :             &amp;pos,nested_cv_e_h,&amp;sd-&gt;cv_stroke,&amp;wattrs);</span>
<span class="lineNum">   13322 </span><span class="lineNoCov">          0 :     _CharViewCreate(&amp;sd-&gt;cv_stroke, &amp;sd-&gt;sc_stroke, &amp;sd-&gt;dummy_fv, 0, 1 );</span>
<a name="13323"><span class="lineNum">   13323 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">   13324 </span>            : 
<span class="lineNum">   13325 </span><span class="lineNoCov">          0 : static void SC_CloseAllWindows(SplineChar *sc) {</span>
<span class="lineNum">   13326 </span>            :     CharViewBase *cv, *next;
<span class="lineNum">   13327 </span>            :     BitmapView *bv, *bvnext;
<span class="lineNum">   13328 </span>            :     BDFFont *bdf;
<span class="lineNum">   13329 </span>            :     BDFChar *bfc;
<span class="lineNum">   13330 </span>            :     FontView *fvs;
<span class="lineNum">   13331 </span>            : 
<span class="lineNum">   13332 </span><span class="lineNoCov">          0 :     if ( sc-&gt;views ) {</span>
<span class="lineNum">   13333 </span><span class="lineNoCov">          0 :         for ( cv = sc-&gt;views; cv!=NULL; cv=next ) {</span>
<span class="lineNum">   13334 </span><span class="lineNoCov">          0 :             next = cv-&gt;next;</span>
<span class="lineNum">   13335 </span><span class="lineNoCov">          0 :             GDrawDestroyWindow(((CharView *) cv)-&gt;gw);</span>
<span class="lineNum">   13336 </span>            :         }
<span class="lineNum">   13337 </span><span class="lineNoCov">          0 :         GDrawSync(NULL);</span>
<span class="lineNum">   13338 </span><span class="lineNoCov">          0 :         GDrawProcessPendingEvents(NULL);</span>
<span class="lineNum">   13339 </span><span class="lineNoCov">          0 :         GDrawSync(NULL);</span>
<span class="lineNum">   13340 </span><span class="lineNoCov">          0 :         GDrawProcessPendingEvents(NULL);</span>
<span class="lineNum">   13341 </span>            :     }
<span class="lineNum">   13342 </span>            : 
<span class="lineNum">   13343 </span><span class="lineNoCov">          0 :     for ( bdf=sc-&gt;parent-&gt;bitmaps; bdf!=NULL; bdf = bdf-&gt;next ) {</span>
<span class="lineNum">   13344 </span><span class="lineNoCov">          0 :         if ( sc-&gt;orig_pos&lt;bdf-&gt;glyphcnt &amp;&amp; (bfc = bdf-&gt;glyphs[sc-&gt;orig_pos])!= NULL ) {</span>
<span class="lineNum">   13345 </span><span class="lineNoCov">          0 :             if ( bfc-&gt;views!=NULL ) {</span>
<span class="lineNum">   13346 </span><span class="lineNoCov">          0 :                 for ( bv= bfc-&gt;views; bv!=NULL; bv=bvnext ) {</span>
<span class="lineNum">   13347 </span><span class="lineNoCov">          0 :                     bvnext = bv-&gt;next;</span>
<span class="lineNum">   13348 </span><span class="lineNoCov">          0 :                     GDrawDestroyWindow(bv-&gt;gw);</span>
<span class="lineNum">   13349 </span>            :                 }
<span class="lineNum">   13350 </span><span class="lineNoCov">          0 :                 GDrawSync(NULL);</span>
<span class="lineNum">   13351 </span><span class="lineNoCov">          0 :                 GDrawProcessPendingEvents(NULL);</span>
<span class="lineNum">   13352 </span><span class="lineNoCov">          0 :                 GDrawSync(NULL);</span>
<span class="lineNum">   13353 </span><span class="lineNoCov">          0 :                 GDrawProcessPendingEvents(NULL);</span>
<span class="lineNum">   13354 </span>            :             }
<span class="lineNum">   13355 </span>            :         }
<span class="lineNum">   13356 </span>            :     }
<span class="lineNum">   13357 </span>            : 
<span class="lineNum">   13358 </span>            :     /* Turn any searcher references to this glyph into inline copies of it */
<span class="lineNum">   13359 </span><span class="lineNoCov">          0 :     for ( fvs=(FontView *) sc-&gt;parent-&gt;fv; fvs!=NULL; fvs=(FontView *) fvs-&gt;b.nextsame ) {</span>
<span class="lineNum">   13360 </span><span class="lineNoCov">          0 :         if ( fvs-&gt;sv!=NULL ) {</span>
<span class="lineNum">   13361 </span>            :             RefChar *rf, *rnext;
<span class="lineNum">   13362 </span><span class="lineNoCov">          0 :             for ( rf = fvs-&gt;sv-&gt;sd.sc_srch.layers[ly_fore].refs; rf!=NULL; rf=rnext ) {</span>
<span class="lineNum">   13363 </span><span class="lineNoCov">          0 :                 rnext = rf-&gt;next;</span>
<span class="lineNum">   13364 </span><span class="lineNoCov">          0 :                 if ( rf-&gt;sc==sc )</span>
<span class="lineNum">   13365 </span><span class="lineNoCov">          0 :                     SCRefToSplines(&amp;fvs-&gt;sv-&gt;sd.sc_srch,rf,ly_fore);</span>
<span class="lineNum">   13366 </span>            :             }
<span class="lineNum">   13367 </span><span class="lineNoCov">          0 :             for ( rf = fvs-&gt;sv-&gt;sd.sc_rpl.layers[ly_fore].refs; rf!=NULL; rf=rnext ) {</span>
<span class="lineNum">   13368 </span><span class="lineNoCov">          0 :                 rnext = rf-&gt;next;</span>
<span class="lineNum">   13369 </span><span class="lineNoCov">          0 :                 if ( rf-&gt;sc==sc )</span>
<span class="lineNum">   13370 </span><span class="lineNoCov">          0 :                     SCRefToSplines(&amp;fvs-&gt;sv-&gt;sd.sc_rpl,rf,ly_fore);</span>
<span class="lineNum">   13371 </span>            :             }
<span class="lineNum">   13372 </span>            :         }
<span class="lineNum">   13373 </span>            :     }
<span class="lineNum">   13374 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">   13375 </span>            : 
<span class="lineNum">   13376 </span>            : struct sc_interface gdraw_sc_interface = {
<span class="lineNum">   13377 </span>            :     SC_UpdateAll,
<span class="lineNum">   13378 </span>            :     SC_OutOfDateBackground,
<span class="lineNum">   13379 </span>            :     SC_RefreshTitles,
<span class="lineNum">   13380 </span>            :     SC_HintsChanged,
<span class="lineNum">   13381 </span>            :     SC_CharChangedUpdate,
<span class="lineNum">   13382 </span>            :     _SC_CharChangedUpdate,
<span class="lineNum">   13383 </span>            :     SC_MarkInstrDlgAsChanged,
<span class="lineNum">   13384 </span>            :     SC_CloseAllWindows,
<span class="lineNum">   13385 </span>            :     SC_MoreLayers
<a name="13386"><span class="lineNum">   13386 </span>            : };</a>
<span class="lineNum">   13387 </span>            : 
<span class="lineNum">   13388 </span><span class="lineNoCov">          0 : static void UI_CVGlyphRenameFixup(SplineFont *sf, const char *oldname, const char *newname) {</span>
<span class="lineNum">   13389 </span>            :     int gid, i;
<span class="lineNum">   13390 </span>            :     SplineChar *sc;
<span class="lineNum">   13391 </span>            :     CharView *cv;
<span class="lineNum">   13392 </span>            : 
<span class="lineNum">   13393 </span><span class="lineNoCov">          0 :     if ( no_windowing_ui )</span>
<span class="lineNum">   13394 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">   13395 </span>            : 
<span class="lineNum">   13396 </span><span class="lineNoCov">          0 :     for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( (sc=sf-&gt;glyphs[gid])!=NULL) {</span>
<span class="lineNum">   13397 </span><span class="lineNoCov">          0 :         for ( cv=(CharView *) (sc-&gt;views); cv!=NULL; cv = (CharView *) (cv-&gt;b.next)) {</span>
<span class="lineNum">   13398 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;cv-&gt;former_cnt; ++i ) if ( strcmp(oldname,cv-&gt;former_names[i])==0 ) {</span>
<span class="lineNum">   13399 </span><span class="lineNoCov">          0 :                 free( cv-&gt;former_names[i] );</span>
<span class="lineNum">   13400 </span><span class="lineNoCov">          0 :                 cv-&gt;former_names[i] = copy( newname );</span>
<span class="lineNum">   13401 </span><span class="lineNoCov">          0 :                 if ( cv-&gt;tabs!=NULL ) {</span>
<span class="lineNum">   13402 </span><span class="lineNoCov">          0 :                     GTabSetChangeTabName(cv-&gt;tabs,newname,i);</span>
<span class="lineNum">   13403 </span><span class="lineNoCov">          0 :                     GTabSetRemetric(cv-&gt;tabs);</span>
<span class="lineNum">   13404 </span><span class="lineNoCov">          0 :                     GGadgetRedraw(cv-&gt;tabs);</span>
<span class="lineNum">   13405 </span>            :                 }
<span class="lineNum">   13406 </span>            :             }
<span class="lineNum">   13407 </span>            :         }
<span class="lineNum">   13408 </span>            :     }
<span class="lineNum">   13409 </span>            : }
<span class="lineNum">   13410 </span>            : 
<span class="lineNum">   13411 </span>            : struct cv_interface gdraw_cv_interface = {
<span class="lineNum">   13412 </span>            :     (void (*)(CharViewBase *)) CV_CharChangedUpdate,
<span class="lineNum">   13413 </span>            :     (void (*)(CharViewBase *,int)) _CV_CharChangedUpdate,
<span class="lineNum">   13414 </span>            :     UI_CVGlyphRenameFixup,
<span class="lineNum">   13415 </span>            :     CV_LayerPaletteCheck
<span class="lineNum">   13416 </span>            : };
<span class="lineNum">   13417 </span>            : 
<span class="lineNum">   13418 </span>            : extern GResInfo metricsview_ri;
<span class="lineNum">   13419 </span>            : GResInfo charview2_ri = {
<span class="lineNum">   13420 </span>            :     &amp;metricsview_ri, NULL,NULL, NULL,
<span class="lineNum">   13421 </span>            :     NULL,
<span class="lineNum">   13422 </span>            :     NULL,
<span class="lineNum">   13423 </span>            :     NULL,
<span class="lineNum">   13424 </span>            :     charview2_re,
<span class="lineNum">   13425 </span>            :     N_(&quot;Outline View 2&quot;),
<span class="lineNum">   13426 </span>            :     N_(&quot;This window displays a single outline glyph (more data)&quot;),
<span class="lineNum">   13427 </span>            :     &quot;CharView&quot;,
<span class="lineNum">   13428 </span>            :     &quot;fontforge&quot;,
<span class="lineNum">   13429 </span>            :     false,
<span class="lineNum">   13430 </span>            :     0,
<span class="lineNum">   13431 </span>            :     NULL,
<span class="lineNum">   13432 </span>            :     GBOX_EMPTY,
<span class="lineNum">   13433 </span>            :     NULL,
<span class="lineNum">   13434 </span>            :     NULL,
<span class="lineNum">   13435 </span>            :     NULL
<span class="lineNum">   13436 </span>            : };
<span class="lineNum">   13437 </span>            : GResInfo charview_ri = {
<span class="lineNum">   13438 </span>            :     &amp;charview2_ri, NULL,NULL, NULL,
<span class="lineNum">   13439 </span>            :     NULL,
<span class="lineNum">   13440 </span>            :     NULL,
<span class="lineNum">   13441 </span>            :     NULL,
<span class="lineNum">   13442 </span>            :     charview_re,
<span class="lineNum">   13443 </span>            :     N_(&quot;Outline View&quot;),
<span class="lineNum">   13444 </span>            :     N_(&quot;This window displays a single outline glyph&quot;),
<span class="lineNum">   13445 </span>            :     &quot;CharView&quot;,
<span class="lineNum">   13446 </span>            :     &quot;fontforge&quot;,
<span class="lineNum">   13447 </span>            :     false,
<span class="lineNum">   13448 </span>            :     0,
<span class="lineNum">   13449 </span>            :     NULL,
<span class="lineNum">   13450 </span>            :     GBOX_EMPTY,
<span class="lineNum">   13451 </span>            :     NULL,
<span class="lineNum">   13452 </span>            :     NULL,
<span class="lineNum">   13453 </span>            :     NULL
<span class="lineNum">   13454 </span>            : };
<a name="13455"><span class="lineNum">   13455 </span>            : </a>
<span class="lineNum">   13456 </span>            : 
<span class="lineNum">   13457 </span><span class="lineNoCov">          0 : void SPSelectNextPoint( SplinePoint *sp, int state )</span>
<span class="lineNum">   13458 </span>            : {
<span class="lineNum">   13459 </span><span class="lineNoCov">          0 :     if( !sp )</span>
<span class="lineNum">   13460 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">   13461 </span><span class="lineNoCov">          0 :     if( !sp-&gt;next )</span>
<span class="lineNum">   13462 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">   13463 </span><span class="lineNoCov">          0 :     if( !sp-&gt;next-&gt;to )</span>
<span class="lineNum">   13464 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">   13465 </span><span class="lineNoCov">          0 :     sp-&gt;next-&gt;to-&gt;selected = state;</span>
<a name="13466"><span class="lineNum">   13466 </span>            : }</a>
<span class="lineNum">   13467 </span>            : 
<span class="lineNum">   13468 </span><span class="lineNoCov">          0 : void SPSelectPrevPoint( SplinePoint *sp, int state )</span>
<span class="lineNum">   13469 </span>            : {
<span class="lineNum">   13470 </span><span class="lineNoCov">          0 :     if( !sp )</span>
<span class="lineNum">   13471 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">   13472 </span><span class="lineNoCov">          0 :     if( !sp-&gt;prev )</span>
<span class="lineNum">   13473 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">   13474 </span><span class="lineNoCov">          0 :     if( !sp-&gt;prev-&gt;from )</span>
<span class="lineNum">   13475 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">   13476 </span><span class="lineNoCov">          0 :     sp-&gt;prev-&gt;from-&gt;selected = state;</span>
<span class="lineNum">   13477 </span>            : }
<span class="lineNum">   13478 </span>            : 
<a name="13479"><span class="lineNum">   13479 </span>            : </a>
<span class="lineNum">   13480 </span>            : 
<span class="lineNum">   13481 </span><span class="lineNoCov">          0 : bool SPIsNextCPSelectedSingle( SplinePoint *sp, CharView *cv )</span>
<span class="lineNum">   13482 </span>            : {
<span class="lineNum">   13483 </span><span class="lineNoCov">          0 :     if( cv )</span>
<span class="lineNum">   13484 </span>            :     {
<span class="lineNum">   13485 </span><span class="lineNoCov">          0 :         int iscurrent = sp == (cv-&gt;p.sp!=NULL?cv-&gt;p.sp:cv-&gt;lastselpt);</span>
<span class="lineNum">   13486 </span><span class="lineNoCov">          0 :         if( iscurrent &amp;&amp; cv-&gt;p.nextcp )</span>
<span class="lineNum">   13487 </span><span class="lineNoCov">          0 :             return true;</span>
<span class="lineNum">   13488 </span>            :     }
<span class="lineNum">   13489 </span><span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">   13490 </span>            : }
<a name="13491"><span class="lineNum">   13491 </span>            : </a>
<span class="lineNum">   13492 </span>            : 
<span class="lineNum">   13493 </span><span class="lineNoCov">          0 : bool SPIsNextCPSelected( SplinePoint *sp, CharView *cv )</span>
<span class="lineNum">   13494 </span>            : {
<span class="lineNum">   13495 </span><span class="lineNoCov">          0 :     if( SPIsNextCPSelectedSingle( sp, cv ))</span>
<span class="lineNum">   13496 </span><span class="lineNoCov">          0 :         return true;</span>
<span class="lineNum">   13497 </span><span class="lineNoCov">          0 :     return sp-&gt;nextcpselected;</span>
<a name="13498"><span class="lineNum">   13498 </span>            : }</a>
<span class="lineNum">   13499 </span>            : 
<span class="lineNum">   13500 </span><span class="lineNoCov">          0 : bool SPIsPrevCPSelectedSingle( SplinePoint *sp, CharView *cv )</span>
<span class="lineNum">   13501 </span>            : {
<span class="lineNum">   13502 </span><span class="lineNoCov">          0 :     if( cv )</span>
<span class="lineNum">   13503 </span>            :     {
<span class="lineNum">   13504 </span><span class="lineNoCov">          0 :         int iscurrent = sp == (cv-&gt;p.sp!=NULL?cv-&gt;p.sp:cv-&gt;lastselpt);</span>
<span class="lineNum">   13505 </span><span class="lineNoCov">          0 :         if( iscurrent &amp;&amp; cv-&gt;p.prevcp )</span>
<span class="lineNum">   13506 </span><span class="lineNoCov">          0 :             return true;</span>
<span class="lineNum">   13507 </span>            :     }
<span class="lineNum">   13508 </span><span class="lineNoCov">          0 :     return false;</span>
<a name="13509"><span class="lineNum">   13509 </span>            : }</a>
<span class="lineNum">   13510 </span>            : 
<span class="lineNum">   13511 </span><span class="lineNoCov">          0 : bool SPIsPrevCPSelected( SplinePoint *sp, CharView *cv )</span>
<span class="lineNum">   13512 </span>            : {
<span class="lineNum">   13513 </span><span class="lineNoCov">          0 :     if( SPIsPrevCPSelectedSingle( sp, cv ))</span>
<span class="lineNum">   13514 </span>            :     {
<span class="lineNum">   13515 </span><span class="lineNoCov">          0 :         return true;</span>
<span class="lineNum">   13516 </span>            :     }
<span class="lineNum">   13517 </span><span class="lineNoCov">          0 :     return sp-&gt;prevcpselected;</span>
<a name="13518"><span class="lineNum">   13518 </span>            : }</a>
<span class="lineNum">   13519 </span>            : 
<span class="lineNum">   13520 </span><span class="lineNoCov">          0 : bool CVShouldInterpolateCPsOnMotion( CharView* cv )</span>
<span class="lineNum">   13521 </span>            : {
<span class="lineNum">   13522 </span><span class="lineNoCov">          0 :     bool ret = interpCPsOnMotion;</span>
<span class="lineNum">   13523 </span>            : 
<span class="lineNum">   13524 </span><span class="lineNoCov">          0 :     if( cv-&gt;activeModifierControl &amp;&amp; cv-&gt;activeModifierAlt )</span>
<span class="lineNum">   13525 </span><span class="lineNoCov">          0 :         ret = !ret;</span>
<span class="lineNum">   13526 </span>            :     
<span class="lineNum">   13527 </span><span class="lineNoCov">          0 :     return ret;</span>
<span class="lineNum">   13528 </span>            : }
<span class="lineNum">   13529 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
