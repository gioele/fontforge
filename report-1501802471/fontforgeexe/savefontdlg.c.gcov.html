<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd) - fontforgeexe/savefontdlg.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">fontforgeexe</a> - savefontdlg.c<span style="font-size: 80%;"> (source / <a href="savefontdlg.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd)</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">1915</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-08-04</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">36</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* -*- coding: utf-8 -*- */</a>
<span class="lineNum">       2 </span>            : /* Copyright (C) 2000-2012 by George Williams */
<span class="lineNum">       3 </span>            : /*
<span class="lineNum">       4 </span>            :  * Redistribution and use in source and binary forms, with or without
<span class="lineNum">       5 </span>            :  * modification, are permitted provided that the following conditions are met:
<span class="lineNum">       6 </span>            : 
<span class="lineNum">       7 </span>            :  * Redistributions of source code must retain the above copyright notice, this
<span class="lineNum">       8 </span>            :  * list of conditions and the following disclaimer.
<span class="lineNum">       9 </span>            : 
<span class="lineNum">      10 </span>            :  * Redistributions in binary form must reproduce the above copyright notice,
<span class="lineNum">      11 </span>            :  * this list of conditions and the following disclaimer in the documentation
<span class="lineNum">      12 </span>            :  * and/or other materials provided with the distribution.
<span class="lineNum">      13 </span>            : 
<span class="lineNum">      14 </span>            :  * The name of the author may not be used to endorse or promote products
<span class="lineNum">      15 </span>            :  * derived from this software without specific prior written permission.
<span class="lineNum">      16 </span>            : 
<span class="lineNum">      17 </span>            :  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
<span class="lineNum">      18 </span>            :  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
<span class="lineNum">      19 </span>            :  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
<span class="lineNum">      20 </span>            :  * EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span class="lineNum">      21 </span>            :  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
<span class="lineNum">      22 </span>            :  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
<span class="lineNum">      23 </span>            :  * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
<span class="lineNum">      24 </span>            :  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
<span class="lineNum">      25 </span>            :  * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
<span class="lineNum">      26 </span>            :  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span class="lineNum">      27 </span>            :  */
<span class="lineNum">      28 </span>            : #include &quot;encoding.h&quot;
<span class="lineNum">      29 </span>            : #include &quot;fontforgeui.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;macbinary.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;mm.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;namelist.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;splinefill.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;splinesaveafm.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;splineutil.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;tottf.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;woff.h&quot;
<span class="lineNum">      38 </span>            : #include &lt;ustring.h&gt;
<span class="lineNum">      39 </span>            : #include &lt;locale.h&gt;
<span class="lineNum">      40 </span>            : #include &lt;gfile.h&gt;
<span class="lineNum">      41 </span>            : #include &lt;gresource.h&gt;
<span class="lineNum">      42 </span>            : #include &lt;utype.h&gt;
<span class="lineNum">      43 </span>            : #include &lt;gio.h&gt;
<span class="lineNum">      44 </span>            : #include &lt;stdlib.h&gt;
<span class="lineNum">      45 </span>            : #include &lt;math.h&gt;
<span class="lineNum">      46 </span>            : #include &lt;unistd.h&gt;
<span class="lineNum">      47 </span>            : #include &lt;string.h&gt;
<span class="lineNum">      48 </span>            : #include &lt;gicons.h&gt;
<span class="lineNum">      49 </span>            : #include &lt;gkeysym.h&gt;
<span class="lineNum">      50 </span>            : #include &quot;psfont.h&quot;
<span class="lineNum">      51 </span>            : #include &quot;savefont.h&quot;
<span class="lineNum">      52 </span>            : #include &lt;time.h&gt;
<span class="lineNum">      53 </span>            : 
<span class="lineNum">      54 </span>            : int ask_user_for_resolution = true;
<span class="lineNum">      55 </span>            : int old_fontlog=false;
<span class="lineNum">      56 </span>            : 
<span class="lineNum">      57 </span>            : static int nfnt_warned = false, post_warned = false;
<span class="lineNum">      58 </span>            : 
<span class="lineNum">      59 </span>            : #define CID_MergeTables 100
<span class="lineNum">      60 </span>            : #define CID_TTC_CFF     101
<span class="lineNum">      61 </span>            : #define CID_Family      2000
<span class="lineNum">      62 </span>            : 
<span class="lineNum">      63 </span>            : #define CID_AppendFontLog       400
<span class="lineNum">      64 </span>            : #define CID_FontLogBit          401
<span class="lineNum">      65 </span>            : #define CID_Layers              402
<span class="lineNum">      66 </span>            : #define CID_PrependTimestamp    403
<span class="lineNum">      67 </span>            : 
<span class="lineNum">      68 </span>            : #define CID_OK                  1001
<span class="lineNum">      69 </span>            : #define CID_PS_AFM              1002
<span class="lineNum">      70 </span>            : #define CID_PS_PFM              1003
<span class="lineNum">      71 </span>            : #define CID_PS_TFM              1004
<span class="lineNum">      72 </span>            : #define CID_PS_HintSubs         1005
<span class="lineNum">      73 </span>            : #define CID_PS_Flex             1006
<span class="lineNum">      74 </span>            : #define CID_PS_Hints            1007
<span class="lineNum">      75 </span>            : #define CID_PS_Restrict256      1008
<span class="lineNum">      76 </span>            : #define CID_PS_Round            1009
<span class="lineNum">      77 </span>            : #define CID_PS_OFM              1010
<span class="lineNum">      78 </span>            : #define CID_PS_AFMmarks         1011
<span class="lineNum">      79 </span>            : #define CID_TTF_Hints           1101
<span class="lineNum">      80 </span>            : #define CID_TTF_FullPS          1102
<span class="lineNum">      81 </span>            : #define CID_TTF_AppleMode       1103
<span class="lineNum">      82 </span>            : #define CID_TTF_PfEdComments    1104
<span class="lineNum">      83 </span>            : #define CID_TTF_PfEdColors      1105
<span class="lineNum">      84 </span>            : #define CID_TTF_PfEd            1106
<span class="lineNum">      85 </span>            : #define CID_TTF_TeXTable        1107
<span class="lineNum">      86 </span>            : #define CID_TTF_OpenTypeMode    1108
<span class="lineNum">      87 </span>            : #define CID_TTF_OldKern         1109
<span class="lineNum">      88 </span>            : #define CID_TTF_GlyphMap        1110
<span class="lineNum">      89 </span>            : #define CID_TTF_OFM             1111
<span class="lineNum">      90 </span>            : #define CID_TTF_PfEdLookups     1113
<span class="lineNum">      91 </span>            : #define CID_TTF_PfEdGuides      1114
<span class="lineNum">      92 </span>            : #define CID_TTF_PfEdLayers      1115
<span class="lineNum">      93 </span>            : #define CID_FontLog             1116
<span class="lineNum">      94 </span>            : #define CID_TTF_DummyDSIG       1117
<span class="lineNum">      95 </span>            : #define CID_NativeKern          1118
<span class="lineNum">      96 </span>            : #define CID_TTF_OldKernMappedOnly 1119
<span class="lineNum">      97 </span>            : 
<span class="lineNum">      98 </span>            : struct gfc_data {
<span class="lineNum">      99 </span>            :     int done;
<span class="lineNum">     100 </span>            :     int sod_done;
<span class="lineNum">     101 </span>            :     int sod_which;
<span class="lineNum">     102 </span>            :     int sod_invoked;
<span class="lineNum">     103 </span>            :     int ret;
<span class="lineNum">     104 </span>            :     int family, familycnt;
<span class="lineNum">     105 </span>            :     GWindow gw;
<span class="lineNum">     106 </span>            :     GGadget *gfc;
<span class="lineNum">     107 </span>            :     GGadget *pstype;
<span class="lineNum">     108 </span>            :     GGadget *bmptype;
<span class="lineNum">     109 </span>            :     GGadget *bmpsizes;
<span class="lineNum">     110 </span>            :     GGadget *options;
<span class="lineNum">     111 </span>            :     GGadget *rename;
<span class="lineNum">     112 </span>            :     GGadget *validate;
<span class="lineNum">     113 </span>            :     int ps_flags;               /* The ordering of these flags fields is */
<span class="lineNum">     114 </span>            :     int sfnt_flags;             /*  important. We index into them */
<span class="lineNum">     115 </span>            :   /* WAS otf_flags */
<span class="lineNum">     116 </span>            :     int psotb_flags;            /*  don't reorder or put junk in between */
<span class="lineNum">     117 </span>            :     uint8 optset[3];
<span class="lineNum">     118 </span>            :     SplineFont *sf;
<span class="lineNum">     119 </span>            :     EncMap *map;
<span class="lineNum">     120 </span>            :     int layer;
<span class="lineNum">     121 </span>            : };
<span class="lineNum">     122 </span>            : 
<span class="lineNum">     123 </span>            : static GTextInfo formattypes[] = {
<span class="lineNum">     124 </span>            :     { (unichar_t *) N_(&quot;PS Type 1 (Ascii)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     125 </span>            :     { (unichar_t *) N_(&quot;PS Type 1 (Binary)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     126 </span>            : #if __Mac
<span class="lineNum">     127 </span>            :     { (unichar_t *) N_(&quot;PS Type 1 (Resource)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     128 </span>            : #else
<span class="lineNum">     129 </span>            :     { (unichar_t *) N_(&quot;PS Type 1 (MacBin)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     130 </span>            : #endif
<span class="lineNum">     131 </span>            :     { (unichar_t *) N_(&quot;PS Type 1 (Multiple)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     132 </span>            :     { (unichar_t *) N_(&quot;PS Multiple Master(A)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     133 </span>            :     { (unichar_t *) N_(&quot;PS Multiple Master(B)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     134 </span>            :     { (unichar_t *) N_(&quot;PS Type 3&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     135 </span>            :     { (unichar_t *) N_(&quot;PS Type 0&quot;), NULL, 0, 0, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     136 </span>            :     { (unichar_t *) N_(&quot;PS CID&quot;), NULL, 0, 0, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     137 </span>            : /* GT: &quot;CFF (Bare)&quot; means a CFF font without the normal OpenType wrapper */
<span class="lineNum">     138 </span>            : /* GT: CFF is a font format that normally lives inside an OpenType font */
<span class="lineNum">     139 </span>            : /* GT: but it is perfectly meaningful to remove all the OpenType complexity */
<span class="lineNum">     140 </span>            : /* GT: and just leave a bare CFF font */
<span class="lineNum">     141 </span>            :     { (unichar_t *) N_(&quot;CFF (Bare)&quot;), NULL, 0, 0, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     142 </span>            :     { (unichar_t *) N_(&quot;CFF CID (Bare)&quot;), NULL, 0, 0, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     143 </span>            :     { (unichar_t *) N_(&quot;Type42&quot;), NULL, 0, 0, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     144 </span>            :     { (unichar_t *) N_(&quot;Type11 (CID 2)&quot;), NULL, 0, 0, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     145 </span>            :     { (unichar_t *) N_(&quot;TrueType&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     146 </span>            :     { (unichar_t *) N_(&quot;TrueType (Symbol)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     147 </span>            : #if __Mac
<span class="lineNum">     148 </span>            :     { (unichar_t *) N_(&quot;TrueType (Resource)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     149 </span>            : #else
<span class="lineNum">     150 </span>            :     { (unichar_t *) N_(&quot;TrueType (MacBin)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     151 </span>            : #endif
<span class="lineNum">     152 </span>            :     { (unichar_t *) N_(&quot;TrueType (TTC)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     153 </span>            :     { (unichar_t *) N_(&quot;TrueType (Mac dfont)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     154 </span>            :     { (unichar_t *) N_(&quot;OpenType (CFF)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     155 </span>            :     { (unichar_t *) N_(&quot;OpenType (Mac dfont)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     156 </span>            :     { (unichar_t *) N_(&quot;OpenType CID&quot;), NULL, 0, 0, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     157 </span>            :     { (unichar_t *) N_(&quot;OpenType CID (dfont)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     158 </span>            :     { (unichar_t *) N_(&quot;SVG font&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     159 </span>            :     { (unichar_t *) N_(&quot;Unified Font Object&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     160 </span>            :     { (unichar_t *) N_(&quot;Web Open Font&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     161 </span>            :     { (unichar_t *) N_(&quot;No Outline Font&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     162 </span>            :     GTEXTINFO_EMPTY
<span class="lineNum">     163 </span>            : };
<span class="lineNum">     164 </span>            : static GTextInfo bitmaptypes[] = {
<span class="lineNum">     165 </span>            :     { (unichar_t *) N_(&quot;BDF&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     166 </span>            :     { (unichar_t *) N_(&quot;In TTF/OTF&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     167 </span>            :     { (unichar_t *) N_(&quot;Apple bitmap only sfnt (dfont)&quot;), NULL, 0, 0, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     168 </span>            :     { (unichar_t *) N_(&quot;(faked) MS bitmap only sfnt (ttf)&quot;), NULL, 0, 0, NULL, NULL, 1, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     169 </span>            :     { (unichar_t *) N_(&quot;X11 bitmap only sfnt (otb)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     170 </span>            : #if __Mac
<span class="lineNum">     171 </span>            :     { (unichar_t *) N_(&quot;NFNT (Resource)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     172 </span>            : #else
<span class="lineNum">     173 </span>            :     { (unichar_t *) N_(&quot;NFNT (MacBin)&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     174 </span>            : #endif
<span class="lineNum">     175 </span>            : /* OS/X doesn't seem to support NFNTs, so there's no point in putting them in a dfont */
<span class="lineNum">     176 </span>            : /*  { (unichar_t *) &quot;NFNT (dfont)&quot;, NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },*/
<span class="lineNum">     177 </span>            :     { (unichar_t *) N_(&quot;Win FON&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     178 </span>            :     { (unichar_t *) N_(&quot;Win FNT&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     179 </span>            :     { (unichar_t *) N_(&quot;Palm OS Bitmap&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     180 </span>            :     { (unichar_t *) N_(&quot;PS Type3 Bitmap&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     181 </span>            :     { (unichar_t *) N_(&quot;No Bitmap Fonts&quot;), NULL, 0, 0, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, '\0' },
<span class="lineNum">     182 </span>            :     GTEXTINFO_EMPTY
<span class="lineNum">     183 </span>            : };
<span class="lineNum">     184 </span>            : 
<span class="lineNum">     185 </span>            : int old_validate = true;
<span class="lineNum">     186 </span>            : 
<span class="lineNum">     187 </span>            : extern int old_sfnt_flags;
<span class="lineNum">     188 </span>            : extern int old_ps_flags;
<span class="lineNum">     189 </span>            : extern int old_psotb_flags;
<span class="lineNum">     190 </span>            : 
<span class="lineNum">     191 </span>            : extern int oldformatstate;
<span class="lineNum">     192 </span>            : extern int oldbitmapstate;
<span class="lineNum">     193 </span>            : 
<a name="194"><span class="lineNum">     194 </span>            : static const char *pfaeditflag = &quot;SplineFontDB:&quot;;</a>
<span class="lineNum">     195 </span>            : 
<span class="lineNum">     196 </span><span class="lineNoCov">          0 : int32 *ParseBitmapSizes(GGadget *g,char *msg,int *err) {</span>
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :     const unichar_t *val = _GGadgetGetTitle(g), *pt; unichar_t *end, *end2;</span>
<span class="lineNum">     198 </span>            :     int i;
<span class="lineNum">     199 </span>            :     int32 *sizes;
<span class="lineNum">     200 </span>            : 
<span class="lineNum">     201 </span>            :     locale_t tmplocale; locale_t oldlocale; // Declare temporary locale storage.
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :     switch_to_c_locale(&amp;tmplocale, &amp;oldlocale); // Switch to the C locale temporarily and cache the old locale.</span>
<span class="lineNum">     203 </span>            : 
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :     *err = false;</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :     end2 = NULL;</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :     for ( i=1, pt = val; (end = u_strchr(pt,',')) || (end2=u_strchr(pt,' ')); ++i ) {</span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :         if ( end!=NULL &amp;&amp; end2!=NULL ) {</span>
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :             if ( end2&lt;end ) end = end2;</span>
<span class="lineNum">     209 </span><span class="lineNoCov">          0 :         } else if ( end2!=NULL )</span>
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :             end = end2;</span>
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :         pt = end+1;</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :         end2 = NULL;</span>
<span class="lineNum">     213 </span>            :     }
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :     sizes = malloc((i+1)*sizeof(int32));</span>
<span class="lineNum">     215 </span>            : 
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :     for ( i=0, pt = val; *pt!='\0' ; ) {</span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :         sizes[i]=rint(u_strtod(pt,&amp;end));</span>
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :         if ( msg!=_(&quot;Pixel List&quot;) )</span>
<span class="lineNum">     219 </span>            :             /* No bit depth allowed */;
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :         else if ( *end!='@' )</span>
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :             sizes[i] |= 0x10000;</span>
<span class="lineNum">     222 </span>            :         else
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :             sizes[i] |= (u_strtol(end+1,&amp;end,10)&lt;&lt;16);</span>
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :         if ( sizes[i]&gt;0 ) ++i;</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :         if ( *end!=' ' &amp;&amp; *end!=',' &amp;&amp; *end!='\0' ) {</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :             free(sizes);</span>
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :             GGadgetProtest8(msg);</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :             *err = true;</span>
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     230 </span>            :         }
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :         while ( *end==' ' || *end==',' ) ++end;</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :         pt = end;</span>
<span class="lineNum">     233 </span>            :     }
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :     switch_to_old_locale(&amp;tmplocale, &amp;oldlocale); // Switch to the cached locale.</span>
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :     if ( *err )</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :     sizes[i] = 0;</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 : return( sizes );</span>
<a name="239"><span class="lineNum">     239 </span>            : }</a>
<span class="lineNum">     240 </span>            : 
<span class="lineNum">     241 </span><span class="lineNoCov">          0 : static int OPT_PSHints(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :         GWindow gw = GGadgetGetWindow(g);</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :         if ( GGadgetIsChecked(g)) {</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :             int which = d-&gt;sod_which&gt;1? d-&gt;sod_which-1 : d-&gt;sod_which;</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :             int flags = (&amp;d-&gt;ps_flags)[which];</span>
<span class="lineNum">     248 </span>            :             /*GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_HintSubs),true);*/
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :             GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_Flex),true);</span>
<span class="lineNum">     250 </span>            :             /*GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_HintSubs),!(flags&amp;ps_flag_nohintsubs));*/
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :             GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_Flex),!(flags&amp;ps_flag_noflex));</span>
<span class="lineNum">     252 </span>            :         } else {
<span class="lineNum">     253 </span>            :             /*GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_HintSubs),false);*/
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :             GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_Flex),false);</span>
<span class="lineNum">     255 </span>            :             /*GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_HintSubs),false);*/
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :             GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_Flex),false);</span>
<span class="lineNum">     257 </span>            :         }
<span class="lineNum">     258 </span>            :     }
<span class="lineNum">     259 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="260"><span class="lineNum">     260 </span>            : }</a>
<span class="lineNum">     261 </span>            : 
<span class="lineNum">     262 </span><span class="lineNoCov">          0 : static int OPT_Applemode(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :         GWindow gw = GGadgetGetWindow(g);</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :         if ( GGadgetIsChecked(g))</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :             GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_OldKern),false);</span>
<span class="lineNum">     267 </span>            :     }
<span class="lineNum">     268 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="269"><span class="lineNum">     269 </span>            : }</a>
<span class="lineNum">     270 </span>            : 
<span class="lineNum">     271 </span><span class="lineNoCov">          0 : static int OPT_OldKern(GGadget *g, GEvent *e) {</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :         GWindow gw = GGadgetGetWindow(g);</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :         if ( GGadgetIsChecked(g))</span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :             GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_AppleMode),false);</span>
<span class="lineNum">     276 </span>            :     }
<span class="lineNum">     277 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="278"><span class="lineNum">     278 </span>            : }</a>
<span class="lineNum">     279 </span>            : 
<span class="lineNum">     280 </span><span class="lineNoCov">          0 : static int sod_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(gw);</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :         d-&gt;sod_done = true;</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_char ) {</span>
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.keysym == GK_F1 || event-&gt;u.chr.keysym == GK_Help ) {</span>
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :             help(&quot;generate.html#Options&quot;);</span>
<span class="lineNum">     287 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     288 </span>            :         }
<span class="lineNum">     289 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     290 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_controlevent &amp;&amp; event-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(gw);</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :         if ( GGadgetGetCid(event-&gt;u.control.g)==CID_OK ) {</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :             if ( d-&gt;sod_which==0 ) {         /* PostScript */</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :                 d-&gt;ps_flags = 0;</span>
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_AFM)) )</span>
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :                     d-&gt;ps_flags |= ps_flag_afm;</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_AFMmarks)) )</span>
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :                     d-&gt;ps_flags |= ps_flag_afmwithmarks;</span>
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_PFM)) )</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :                     d-&gt;ps_flags |= ps_flag_pfm;</span>
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_TFM)) )</span>
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :                     d-&gt;ps_flags |= ps_flag_tfm;</span>
<span class="lineNum">     303 </span>            :                 /*if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_HintSubs)) )*/
<span class="lineNum">     304 </span>            :                     /*d-&gt;ps_flags |= ps_flag_nohintsubs;*/
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :                 if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_Flex)) )</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :                     d-&gt;ps_flags |= ps_flag_noflex;</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :                 if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_Hints)) )</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :                     d-&gt;ps_flags |= ps_flag_nohints;</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_Round)) )</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :                     d-&gt;ps_flags |= ps_flag_round;</span>
<span class="lineNum">     311 </span>            :                 /*if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_Restrict256)) )*/
<span class="lineNum">     312 </span>            :                     /*d-&gt;ps_flags |= ps_flag_restrict256;*/
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_FontLog)) )</span>
<span class="lineNum">     314 </span><span class="lineNoCov">          0 :                     d-&gt;ps_flags |= ps_flag_outputfontlog;</span>
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :             } else if ( d-&gt;sod_which==1 || d-&gt;sod_which==2 ) {    /* Open/TrueType */</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :                 d-&gt;sfnt_flags = 0;</span>
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :                 if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_Hints)) )</span>
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_nohints;</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :                 if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_FullPS)) )</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_shortps;</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_AppleMode)) )</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_applemode;</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_OpenTypeMode)) )</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_otmode;</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_OldKern)) &amp;&amp;</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :                         !(d-&gt;sfnt_flags&amp;ttf_flag_applemode) )</span>
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_oldkern;</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_DummyDSIG)) )</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_dummyDSIG;</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_PfEdComments)) )</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_pfed_comments;</span>
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_PfEdColors)) )</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_pfed_colors;</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_PfEdLookups)) )</span>
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_pfed_lookupnames;</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_PfEdGuides)) )</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_pfed_guides;</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_PfEdLayers)) )</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_pfed_layers;</span>
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_TeXTable)) )</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_TeXtable;</span>
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_GlyphMap)) )</span>
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_glyphmap;</span>
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_OFM)) )</span>
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_ofm;</span>
<span class="lineNum">     346 </span>            : 
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_AFM)) )</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ps_flag_afm;</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_AFMmarks)) )</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ps_flag_afmwithmarks;</span>
<span class="lineNum">     351 </span>            :                 /*if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_HintSubs)) )*/
<span class="lineNum">     352 </span>            :                     /*d-&gt;sfnt_flags |= ps_flag_nohintsubs;*/
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :                 if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_Flex)) )</span>
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ps_flag_noflex;</span>
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :                 if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_Hints)) )</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ps_flag_nohints;</span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_Round)) )</span>
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ps_flag_round;</span>
<span class="lineNum">     359 </span>            : 
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_FontLog)) )</span>
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ps_flag_outputfontlog;</span>
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_NativeKern)) )</span>
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_native_kern; // This applies mostly to U. F. O. right now.</span>
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_OldKernMappedOnly)) )</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :                     d-&gt;sfnt_flags |= ttf_flag_oldkernmappedonly;</span>
<span class="lineNum">     366 </span>            :             } else {                            /* PS + OpenType Bitmap */
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :                 d-&gt;ps_flags = d-&gt;psotb_flags = 0;</span>
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_AFMmarks)) )</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :                      d-&gt;psotb_flags = d-&gt;ps_flags |= ps_flag_afmwithmarks;</span>
<span class="lineNum">     370 </span>            :                 /*if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_HintSubs)) )*/
<span class="lineNum">     371 </span>            :                      /*d-&gt;psotb_flags = d-&gt;ps_flags |= ps_flag_nohintsubs;*/
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :                 if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_Flex)) )</span>
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :                      d-&gt;psotb_flags = d-&gt;ps_flags |= ps_flag_noflex;</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :                 if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_Hints)) )</span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :                      d-&gt;psotb_flags = d-&gt;ps_flags |= ps_flag_nohints;</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_Round)) )</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :                      d-&gt;psotb_flags = d-&gt;ps_flags |= ps_flag_round;</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_PFM)) )</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :                      d-&gt;psotb_flags = d-&gt;ps_flags |= ps_flag_pfm;</span>
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_PS_TFM)) )</span>
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :                      d-&gt;psotb_flags = d-&gt;ps_flags |= ps_flag_tfm;</span>
<span class="lineNum">     382 </span>            : 
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :                 if ( !GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_FullPS)) )</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :                     d-&gt;psotb_flags |= ttf_flag_shortps;</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_PfEdComments)) )</span>
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :                     d-&gt;psotb_flags |= ttf_flag_pfed_comments;</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_PfEdColors)) )</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :                     d-&gt;psotb_flags |= ttf_flag_pfed_colors;</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_PfEdLookups)) )</span>
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :                     d-&gt;psotb_flags |= ttf_flag_pfed_lookupnames;</span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_PfEdGuides)) )</span>
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :                     d-&gt;psotb_flags |= ttf_flag_pfed_guides;</span>
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_PfEdLayers)) )</span>
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :                     d-&gt;psotb_flags |= ttf_flag_pfed_layers;</span>
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_TeXTable)) )</span>
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :                     d-&gt;psotb_flags |= ttf_flag_TeXtable;</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_GlyphMap)) )</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :                     d-&gt;psotb_flags |= ttf_flag_glyphmap;</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :                 if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_OFM)) )</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :                     d-&gt;psotb_flags |= ttf_flag_ofm;</span>
<span class="lineNum">     401 </span>            :             }
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :             d-&gt;sod_invoked = true;</span>
<span class="lineNum">     403 </span>            :         }
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :         d-&gt;sod_done = true;</span>
<span class="lineNum">     405 </span>            :     }
<span class="lineNum">     406 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="407"><span class="lineNum">     407 </span>            : }</a>
<span class="lineNum">     408 </span>            : 
<span class="lineNum">     409 </span><span class="lineNoCov">          0 : static void OptSetDefaults(GWindow gw,struct gfc_data *d,int which,int iscid) {</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :     int w = which&gt;1 ? which-1 : which;</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :     int flags = (&amp;d-&gt;ps_flags)[w];</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :     int fs = GGadgetGetFirstListSelectedItem(d-&gt;pstype);</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :     int bf = GGadgetGetFirstListSelectedItem(d-&gt;bmptype);</span>
<span class="lineNum">     414 </span>            :     /* which==0 =&gt; pure postscript */
<span class="lineNum">     415 </span>            :     /* which==1 =&gt; truetype or bitmap in sfnt wrapper */
<span class="lineNum">     416 </span>            :     /* which==2 =&gt; opentype (ps) */
<span class="lineNum">     417 </span>            :     /* which==3 =&gt; generating an sfnt based bitmap only font with a postscript outline font */
<span class="lineNum">     418 </span>            : 
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_Hints),!(flags&amp;ps_flag_nohints));</span>
<span class="lineNum">     420 </span>            :     /*GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_HintSubs),!(flags&amp;ps_flag_nohintsubs));*/
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_Flex),!(flags&amp;ps_flag_noflex));</span>
<span class="lineNum">     422 </span>            :     /*GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_Restrict256),flags&amp;ps_flag_restrict256);*/
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_Round),flags&amp;ps_flag_round);</span>
<span class="lineNum">     424 </span>            : 
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_AFM),flags&amp;ps_flag_afm);</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_AFMmarks),flags&amp;ps_flag_afmwithmarks);</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_PFM),(flags&amp;ps_flag_pfm) &amp;&amp; !iscid);</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_TFM),flags&amp;ps_flag_tfm);</span>
<span class="lineNum">     429 </span>            : 
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_Hints),!(flags&amp;ttf_flag_nohints));</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_FullPS),!(flags&amp;ttf_flag_shortps));</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_OFM),flags&amp;ttf_flag_ofm);</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :     if ( d-&gt;optset[which] )</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_AppleMode),flags&amp;ttf_flag_applemode);</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :     else if ( which==0 || which==3 )    /* PostScript */</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_AppleMode),false);</span>
<span class="lineNum">     437 </span>            :     else
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_AppleMode),(flags&amp;ttf_flag_applemode));</span>
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :     if ( d-&gt;optset[which] )</span>
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_OpenTypeMode),flags&amp;ttf_flag_otmode);</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :     else if ( which==0 )        /* PostScript */</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_OpenTypeMode),false);</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :     else if ( (fs==ff_ttfmacbin || fs==ff_ttfdfont || fs==ff_otfdfont ||</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :              fs==ff_otfciddfont || d-&gt;family==gf_macfamily || (fs==ff_none &amp;&amp; bf==bf_sfnt_dfont)))</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_OpenTypeMode),false);</span>
<span class="lineNum">     446 </span>            :     else
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_OpenTypeMode),(flags&amp;ttf_flag_otmode));</span>
<span class="lineNum">     448 </span>            : 
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_PfEdComments),flags&amp;ttf_flag_pfed_comments);</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_PfEdColors),flags&amp;ttf_flag_pfed_colors);</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_PfEdLookups),flags&amp;ttf_flag_pfed_lookupnames);</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_PfEdGuides),flags&amp;ttf_flag_pfed_guides);</span>
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_PfEdLayers),flags&amp;ttf_flag_pfed_layers);</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_TeXTable),flags&amp;ttf_flag_TeXtable);</span>
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_GlyphMap),flags&amp;ttf_flag_glyphmap);</span>
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_OldKern),</span>
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :             (flags&amp;ttf_flag_oldkern) &amp;&amp; !GGadgetIsChecked(GWidgetGetControl(gw,CID_TTF_AppleMode)));</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_DummyDSIG),flags&amp;ttf_flag_dummyDSIG);</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_FontLog),flags&amp;ps_flag_outputfontlog);</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_NativeKern),flags&amp;ttf_native_kern);</span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(GWidgetGetControl(gw,CID_TTF_OldKernMappedOnly),flags&amp;ttf_flag_oldkernmappedonly);</span>
<span class="lineNum">     462 </span>            : 
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_Hints),which!=1);</span>
<span class="lineNum">     464 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_Flex),which!=1);</span>
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_Round),which!=1);</span>
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :     if ( which!=1 &amp;&amp; (flags&amp;ps_flag_nohints)) {</span>
<span class="lineNum">     467 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_Flex),false);</span>
<span class="lineNum">     468 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(gw,CID_PS_Flex),false);</span>
<span class="lineNum">     469 </span>            :     }
<span class="lineNum">     470 </span>            : 
<span class="lineNum">     471 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_AFM),which!=1);</span>
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_AFMmarks),which!=1);</span>
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_PFM),which==0 || which==3);</span>
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_PS_TFM),which==0 || which==3);</span>
<span class="lineNum">     475 </span>            : 
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_Hints),which==1);</span>
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_FullPS),which!=0);</span>
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_AppleMode),which!=0 &amp;&amp; which!=3);</span>
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_OpenTypeMode),which!=0 &amp;&amp; which!=3);</span>
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_OldKern),which!=0 );</span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_DummyDSIG),which!=0 );</span>
<span class="lineNum">     482 </span>            : 
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_PfEd),which!=0);</span>
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_PfEdComments),which!=0);</span>
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_PfEdColors),which!=0);</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_PfEdLookups),which!=0);</span>
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_PfEdGuides),which!=0);</span>
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_PfEdColors),which!=0);</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_PfEdLayers),which!=0);</span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_TeXTable),which!=0);</span>
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_GlyphMap),which!=0);</span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_OFM),which!=0);</span>
<span class="lineNum">     493 </span>            :     
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :     GGadgetSetEnabled(GWidgetGetControl(gw,CID_TTF_OldKernMappedOnly),which!=0 );</span>
<span class="lineNum">     495 </span>            : 
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :     d-&gt;optset[which] = true;</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     498 </span>            : 
<span class="lineNum">     499 </span>            : #define OPT_Width       230
<a name="500"><span class="lineNum">     500 </span>            : #define OPT_Height      233</a>
<span class="lineNum">     501 </span>            : 
<span class="lineNum">     502 </span><span class="lineNoCov">          0 : static void SaveOptionsDlg(struct gfc_data *d,int which,int iscid) {</span>
<span class="lineNum">     503 </span>            :     int k,fontlog_k,group,group2;
<span class="lineNum">     504 </span>            :     GWindow gw;
<span class="lineNum">     505 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">     506 </span>            :     GGadgetCreateData gcd[34];
<span class="lineNum">     507 </span>            :     GTextInfo label[34];
<span class="lineNum">     508 </span>            :     GRect pos;
<span class="lineNum">     509 </span>            :     GGadgetCreateData *hvarray1[21], *hvarray2[42], *hvarray3[6], *harray[7], *varray[11];
<span class="lineNum">     510 </span>            :     GGadgetCreateData boxes[6];
<span class="lineNum">     511 </span>            : 
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :     d-&gt;sod_done = false;</span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :     d-&gt;sod_which = which;</span>
<span class="lineNum">     514 </span>            : 
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_isdlg|wam_restrict;</span>
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :     wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :     wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :     wattrs.undercursor = 1;</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_pointer;</span>
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :     wattrs.utf8_window_title = _(&quot;Options&quot;);</span>
<span class="lineNum">     522 </span><span class="lineNoCov">          0 :     wattrs.is_dlg = true;</span>
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :     pos.x = pos.y = 0;</span>
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :     pos.width = GGadgetScale(GDrawPointsToPixels(NULL,OPT_Width));</span>
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :     pos.height = GDrawPointsToPixels(NULL,OPT_Height);</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :     gw = GDrawCreateTopWindow(NULL,&amp;pos,sod_e_h,d,&amp;wattrs);</span>
<span class="lineNum">     527 </span>            : 
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :     memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :     memset(&amp;gcd,0,sizeof(gcd));</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :     memset(boxes,0,sizeof(boxes));</span>
<span class="lineNum">     531 </span>            : 
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :     k = 0;</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 2; gcd[k].gd.pos.y = 2;</span>
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = pos.width-4; gcd[k].gd.pos.height = pos.height-4;</span>
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_enabled | gg_visible | gg_pos_in_pixels;</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GGroupCreate;</span>
<span class="lineNum">     537 </span>            : 
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) U_(&quot;PostScript&quot;);</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 8; gcd[k].gd.pos.y = 5;</span>
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_enabled | gg_visible;</span>
<span class="lineNum">     543 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">     544 </span>            : 
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :     group = k;</span>
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 4; gcd[k].gd.pos.y = 9;</span>
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = OPT_Width-8; gcd[k].gd.pos.height = 72;</span>
<span class="lineNum">     548 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_enabled | gg_visible ;</span>
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GGroupCreate;</span>
<span class="lineNum">     550 </span>            : 
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = 16;</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     553 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Round&quot;);</span>
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Do you want to round coordinates to integers (this saves space)?&quot;);</span>
<span class="lineNum">     556 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_PS_Round;</span>
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :     hvarray1[0] = &amp;gcd[k-1]; hvarray1[1] = GCD_ColSpan;</span>
<span class="lineNum">     560 </span>            : 
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Hints&quot;);</span>
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Do you want the font file to contain PostScript hints?&quot;);</span>
<span class="lineNum">     566 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     567 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = OPT_PSHints;</span>
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_PS_Hints;</span>
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :     hvarray1[5] = &amp;gcd[k-1]; hvarray1[6] = GCD_ColSpan;</span>
<span class="lineNum">     571 </span>            : 
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x+4; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Flex Hints&quot;);</span>
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Do you want the font file to contain PostScript flex hints?&quot;);</span>
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_PS_Flex;</span>
<span class="lineNum">     579 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     580 </span><span class="lineNoCov">          0 :     hvarray1[10] = GCD_HPad10; hvarray1[11] = &amp;gcd[k-1];</span>
<span class="lineNum">     581 </span><span class="lineNoCov">          0 :     hvarray1[15] = GCD_Glue; hvarray1[16] = GCD_Glue;</span>
<span class="lineNum">     582 </span>            : 
<span class="lineNum">     583 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_utf8_popup ;</span>
<span class="lineNum">     585 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Hint Substitution&quot;);</span>
<span class="lineNum">     586 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     587 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Do you want the font file to do hint substitution?&quot;);</span>
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_PS_HintSubs;</span>
<span class="lineNum">     590 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     591 </span>            : 
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_utf8_popup ;</span>
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;First 256&quot;);</span>
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Limit the font so that only the glyphs referenced in the first 256 encodings\nwill be included in the file&quot;);</span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     598 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_PS_Restrict256;</span>
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     600 </span>            : 
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 110; gcd[k].gd.pos.y = gcd[k-5].gd.pos.y;</span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Output AFM&quot;);</span>
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     605 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) U_(&quot;The AFM file contains metrics information that many word-processors will read when using a PostScript font.&quot;);</span>
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_PS_AFM;</span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :     hvarray1[2] = &amp;gcd[k-1]; hvarray1[3] = GCD_ColSpan; hvarray1[4] = NULL;</span>
<span class="lineNum">     610 </span>            : 
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 112; gcd[k].gd.pos.y = gcd[k-5].gd.pos.y;</span>
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     613 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Composites in AFM&quot;);</span>
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) U_(&quot;The AFM format allows some information about composites\n(roughly the same as mark to base anchor classes) to be\nincluded. However it tends to make AFM files huge as it\nis not stored in an efficient manner.&quot;);</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_PS_AFMmarks;</span>
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :     hvarray1[7] = GCD_HPad10; hvarray1[8] = &amp;gcd[k-1]; hvarray1[9] = NULL;</span>
<span class="lineNum">     620 </span>            : 
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-2].gd.pos.x; gcd[k].gd.pos.y = gcd[k-5].gd.pos.y;</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Output PFM&quot;);</span>
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) U_(&quot;The PFM file contains information Windows needs to install a PostScript font.&quot;);</span>
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_PS_PFM;</span>
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :     hvarray1[12] = &amp;gcd[k-1]; hvarray1[13] = GCD_ColSpan; hvarray1[14] = NULL;</span>
<span class="lineNum">     630 </span>            : 
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible |gg_utf8_popup;</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Output TFM &amp; ENC&quot;);</span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) U_(&quot;The tfm and enc files contain information TeX needs to install a PostScript font.&quot;);</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_PS_TFM;</span>
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :     hvarray1[17] = &amp;gcd[k-1]; hvarray1[18] = GCD_ColSpan; hvarray1[19] = NULL;</span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :     hvarray1[20] = NULL;</span>
<span class="lineNum">     641 </span>            : 
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :     boxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :     boxes[2].gd.u.boxelements = hvarray1;</span>
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :     boxes[2].gd.label = (GTextInfo *) &amp;gcd[1];</span>
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :     boxes[2].creator = GHVGroupCreate;</span>
<span class="lineNum">     646 </span>            : 
<span class="lineNum">     647 </span>            : 
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;SFNT&quot;);</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     650 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 8; gcd[k].gd.pos.y = gcd[group].gd.pos.y+gcd[group].gd.pos.height+6;</span>
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_enabled | gg_visible;</span>
<span class="lineNum">     653 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">     654 </span>            : 
<span class="lineNum">     655 </span><span class="lineNoCov">          0 :     group2 = k;</span>
<span class="lineNum">     656 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 4; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+4;</span>
<span class="lineNum">     657 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = OPT_Width-8; gcd[k].gd.pos.height = 100;</span>
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_enabled | gg_visible ;</span>
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GGroupCreate;</span>
<span class="lineNum">     660 </span>            : 
<span class="lineNum">     661 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[group+1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+8;</span>
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible |gg_utf8_popup;</span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;TrueType Hints&quot;);</span>
<span class="lineNum">     664 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     665 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Do you want the font file to contain truetype hints? This will not\ngenerate new instructions, it will just make use of whatever is associated\nwith each character.&quot;);</span>
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_Hints;</span>
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :     hvarray2[0] = &amp;gcd[k-1]; hvarray2[1] = GCD_ColSpan;</span>
<span class="lineNum">     670 </span>            : 
<span class="lineNum">     671 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     672 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;PS Glyph Names&quot;);</span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     675 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Do you want the font file to contain the names of each glyph in the font?&quot;);</span>
<span class="lineNum">     676 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_FullPS;</span>
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :     hvarray2[5] = &amp;gcd[k-1]; hvarray2[6] = GCD_ColSpan;</span>
<span class="lineNum">     680 </span>            : 
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Apple&quot;);</span>
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     685 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Apple and MS/Adobe differ about the format of truetype and opentype files\nThis allows you to select which standard to follow for your font.\nThe main differences are:\n The requirements for the 'postscript' name in the name table conflict\n Bitmap data are stored in different tables\n Scaled composite characters are treated differently\n Use of GSUB rather than morx(t)/feat\n Use of GPOS rather than kern/opbd\n Use of GDEF rather than lcar/prop&quot;);</span>
<span class="lineNum">     686 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_AppleMode;</span>
<span class="lineNum">     688 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = OPT_Applemode;</span>
<span class="lineNum">     689 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     690 </span><span class="lineNoCov">          0 :     hvarray2[10] = &amp;gcd[k-1]; hvarray2[11] = GCD_ColSpan;</span>
<span class="lineNum">     691 </span>            : 
<span class="lineNum">     692 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     694 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;OpenType&quot;);</span>
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Apple and MS/Adobe differ about the format of truetype and opentype files\nThis allows you to select which standard to follow for your font.\nThe main differences are:\n The requirements for the 'postscript' name in the name table conflict\n Bitmap data are stored in different tables\n Scaled composite glyphs are treated differently\n Use of GSUB rather than morx(t)/feat\n Use of GPOS rather than kern/opbd\n Use of GDEF rather than lcar/prop&quot;);</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_OpenTypeMode;</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :     hvarray2[15] = &amp;gcd[k-1]; hvarray2[16] = GCD_ColSpan;</span>
<span class="lineNum">     701 </span>            : 
<span class="lineNum">     702 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x+4; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Old style 'kern'&quot;);</span>
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Many applications still don't support 'GPOS' kerning.\nIf you want to include both 'GPOS' and old-style 'kern'\ntables set this check box.\nIt may not be set in conjunction with the Apple checkbox.\nThis may confuse other applications though.&quot;);</span>
<span class="lineNum">     707 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     708 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_OldKern;</span>
<span class="lineNum">     709 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = OPT_OldKern;</span>
<span class="lineNum">     710 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :     hvarray2[20] = GCD_HPad10; hvarray2[21] = &amp;gcd[k-1];</span>
<span class="lineNum">     712 </span>            : 
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x+4; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Dummy 'DSIG'&quot;);</span>
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(</span>
<span class="lineNum">     718 </span>            :         &quot;MS uses the presence of a 'DSIG' table to determine whether to use an OpenType\n&quot;
<span class="lineNum">     719 </span>            :         &quot;icon for the tt font. FontForge can't generate a useful 'DSIG' table, but it can\n&quot;
<span class="lineNum">     720 </span>            :         &quot;generate an empty one with no signature info. A pointless table.&quot;);
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_DummyDSIG;</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :     hvarray2[25] = GCD_HPad10; hvarray2[26] = &amp;gcd[k-1];</span>
<span class="lineNum">     725 </span>            : 
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Output Glyph Map&quot;);</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;When generating a truetype or opentype font it is occasionally\nuseful to know the mapping between truetype glyph ids and\nglyph names. Setting this option will cause FontForge to\nproduce a file (with extension .g2n) containing those data.&quot;);</span>
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_GlyphMap;</span>
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :     hvarray2[30] = &amp;gcd[k-1]; hvarray2[31] = GCD_ColSpan;</span>
<span class="lineNum">     735 </span>            : 
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     737 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Output OFM &amp; CFG&quot;);</span>
<span class="lineNum">     739 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;The ofm and cfg files contain information Omega needs to process a font.&quot;);</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_OFM;</span>
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :     hvarray2[35] = &amp;gcd[k-1]; hvarray2[36] = GCD_ColSpan;</span>
<span class="lineNum">     745 </span>            : 
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[group+6].gd.pos.x; gcd[k].gd.pos.y = gcd[k-5].gd.pos.y;</span>
<span class="lineNum">     747 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     748 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;PfaEdit Table&quot;);</span>
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;The PfaEdit table is an extension to the TrueType format\nand contains various data used by FontForge\n(It should be called the FontForge table,\nbut isn't for historical reasons)&quot;);</span>
<span class="lineNum">     751 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_PfEd;</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :     hvarray2[2] = &amp;gcd[k-1]; hvarray2[3] = GCD_ColSpan; hvarray2[4] = NULL;</span>
<span class="lineNum">     755 </span>            : 
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x+2; gcd[k].gd.pos.y = gcd[k-5].gd.pos.y-4;</span>
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Save Comments&quot;);</span>
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Save glyph comments in the PfEd table&quot;);</span>
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_PfEdComments;</span>
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :     hvarray2[7] = GCD_HPad10; hvarray2[8] = &amp;gcd[k-1]; hvarray2[9] = NULL;</span>
<span class="lineNum">     765 </span>            : 
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-5].gd.pos.y-4;</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Save Colors&quot;);</span>
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Save glyph colors in the PfEd table&quot;);</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_PfEdColors;</span>
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :     hvarray2[12] = GCD_HPad10; hvarray2[13] = &amp;gcd[k-1]; hvarray2[14] = NULL;</span>
<span class="lineNum">     775 </span>            : 
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-3].gd.pos.x; gcd[k].gd.pos.y = gcd[k-5].gd.pos.y;</span>
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Lookup Names&quot;);</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Preserve the names of the GPOS/GSUB lookups and subtables&quot;);</span>
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_PfEdLookups;</span>
<span class="lineNum">     783 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :     hvarray2[17] = GCD_HPad10; hvarray2[18] = &amp;gcd[k-1]; hvarray2[19] = NULL;</span>
<span class="lineNum">     785 </span>            : 
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Save Guides&quot;);</span>
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Save the guidelines in the Guide layer.&quot;);</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_PfEdGuides;</span>
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :     hvarray2[22] = GCD_HPad10; hvarray2[23] = &amp;gcd[k-1]; hvarray2[24] = NULL;</span>
<span class="lineNum">     795 </span>            : 
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+14;</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Save Layers&quot;);</span>
<span class="lineNum">     799 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(</span>
<span class="lineNum">     801 </span>            :             &quot;Preserve any background and spiro layers.\n&quot;
<span class="lineNum">     802 </span>            :             &quot;Also if we output a truetype font from a\n&quot;
<span class="lineNum">     803 </span>            :             &quot;cubic database, save the cubic splines.&quot;);
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_PfEdLayers;</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :     hvarray2[27] = GCD_HPad10; hvarray2[28] = &amp;gcd[k-1]; hvarray2[29] = NULL;</span>
<span class="lineNum">     808 </span>            : 
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-3].gd.pos.x; gcd[k].gd.pos.y = gcd[k-5].gd.pos.y;</span>
<span class="lineNum">     810 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">     811 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;TeX Table&quot;);</span>
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;The TeX table is an extension to the TrueType format\nand the various data you would expect to find in\na tfm file (that isn't already stored elsewhere\nin the ttf file)\n&quot;);</span>
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_TeXTable;</span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     817 </span><span class="lineNoCov">          0 :     hvarray2[32] = &amp;gcd[k-1]; hvarray2[33] = GCD_ColSpan; hvarray2[34] = NULL;</span>
<span class="lineNum">     818 </span><span class="lineNoCov">          0 :     hvarray2[37] = GCD_Glue; hvarray2[38] = GCD_Glue; hvarray2[39] = NULL;</span>
<span class="lineNum">     819 </span><span class="lineNoCov">          0 :     hvarray2[40] = NULL;</span>
<span class="lineNum">     820 </span>            : 
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :     boxes[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :     boxes[3].gd.u.boxelements = hvarray2;</span>
<span class="lineNum">     823 </span><span class="lineNoCov">          0 :     boxes[3].gd.label = (GTextInfo *) &amp;gcd[group2-1];</span>
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :     boxes[3].creator = GHVGroupCreate;</span>
<span class="lineNum">     825 </span>            : 
<span class="lineNum">     826 </span><span class="lineNoCov">          0 :     fontlog_k = k;</span>
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">     828 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Output FONTLOG.txt&quot;);</span>
<span class="lineNum">     829 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     830 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(</span>
<span class="lineNum">     831 </span>            :         &quot;The FONTLOG is a text file containing relevant information\n&quot;
<span class="lineNum">     832 </span>            :         &quot;about the font including such things as its changelog.\n&quot;
<span class="lineNum">     833 </span>            :         &quot;(A general template is available in the OFL FAQ on http://scripts.sil.org/OFL-FAQ_web)\n&quot;
<span class="lineNum">     834 </span>            :         &quot;Usage within an open font project is highly recommended but not required.\n&quot;
<span class="lineNum">     835 </span>            :         &quot;If your font already contains a fontlog table (see the Element-&gt;Font Info)\n&quot;
<span class="lineNum">     836 </span>            :         &quot;and you check this box, then the internal fontlog information will be\n&quot;
<span class="lineNum">     837 </span>            :         &quot;appended to the file \&quot;FONTLOG.txt\&quot; in the same directory\n&quot;
<span class="lineNum">     838 </span>            :         &quot;as the font itself.&quot;);
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_FontLog;</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     842 </span><span class="lineNoCov">          0 :     hvarray3[0] = &amp;gcd[k-1];</span>
<span class="lineNum">     843 </span>            : 
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.y = gcd[k-1].gd.pos.y; gcd[k].gd.pos.x = gcd[k-2].gd.pos.x;</span>
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Prefer native kerning&quot;);</span>
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(</span>
<span class="lineNum">     849 </span>            :         &quot;Use native kerning structures (instead of a feature file) even when this might lose information.\n&quot;);
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_NativeKern;</span>
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :     hvarray3[1] = &amp;gcd[k-1]; hvarray3[2]=NULL;</span>
<span class="lineNum">     854 </span>            :     
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-1].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y;</span>
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Windows-compatible \'kern\'&quot;);</span>
<span class="lineNum">     858 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;If the old-style \'kern\' table contains unencoded glyphs\n(or glyphs encoded outside of the BMP), many Windows applications\nwon't have any kerning at all. This option excludes such\nproblematic glyphs from the old-style \'kern\' table.&quot;);</span>
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_TTF_OldKernMappedOnly;</span>
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :     hvarray3[3] = &amp;gcd[k-1];</span>
<span class="lineNum">     864 </span>            : 
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :     hvarray3[4] = NULL; hvarray3[5] = NULL;</span>
<span class="lineNum">     866 </span>            : 
<span class="lineNum">     867 </span><span class="lineNoCov">          0 :     boxes[4].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :     boxes[4].gd.u.boxelements = hvarray3;</span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :     boxes[4].gd.label = NULL;</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :     boxes[4].creator = GHVGroupCreate;</span>
<span class="lineNum">     871 </span>            : 
<span class="lineNum">     872 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 30-3; gcd[k].gd.pos.y = gcd[group2].gd.pos.y+gcd[group2].gd.pos.height+10-3;</span>
<span class="lineNum">     873 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = -1;</span>
<span class="lineNum">     874 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :     label[k].text_in_resource = true;</span>
<span class="lineNum">     878 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_OK;</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GButtonCreate;</span>
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :     harray[0] = GCD_Glue; harray[1] = &amp;gcd[k-1]; harray[2] = GCD_Glue;</span>
<span class="lineNum">     882 </span>            : 
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = -30; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+3;</span>
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = -1;</span>
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">     887 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">     888 </span><span class="lineNoCov">          0 :     label[k].text_in_resource = true;</span>
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">     890 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GButtonCreate;</span>
<span class="lineNum">     891 </span><span class="lineNoCov">          0 :     harray[3] = GCD_Glue; harray[4] = &amp;gcd[k-1]; harray[5] = GCD_Glue;</span>
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :     harray[6] = NULL;</span>
<span class="lineNum">     893 </span>            : 
<span class="lineNum">     894 </span><span class="lineNoCov">          0 :     boxes[5].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :     boxes[5].gd.u.boxelements = harray;</span>
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :     boxes[5].creator = GHBoxCreate;</span>
<span class="lineNum">     897 </span>            : 
<span class="lineNum">     898 </span><span class="lineNoCov">          0 :     varray[0] = &amp;boxes[2]; varray[1] = NULL;</span>
<span class="lineNum">     899 </span><span class="lineNoCov">          0 :     varray[2] = &amp;boxes[3]; varray[3] = NULL;</span>
<span class="lineNum">     900 </span><span class="lineNoCov">          0 :     varray[4] = &amp;boxes[4]; varray[5] = NULL;</span>
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :     varray[6] = GCD_Glue; varray[7] = NULL;</span>
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :     varray[8] = &amp;boxes[5]; varray[9] = NULL;</span>
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :     varray[10] = NULL;</span>
<span class="lineNum">     904 </span>            : 
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :     boxes[0].gd.pos.x = boxes[0].gd.pos.y = 2;</span>
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :     boxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">     907 </span><span class="lineNoCov">          0 :     boxes[0].gd.u.boxelements = varray;</span>
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :     boxes[0].creator = GHVGroupCreate;</span>
<span class="lineNum">     909 </span>            : 
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :     GGadgetsCreate(gw,boxes);</span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(boxes[0].ret,gb_expandglue);</span>
<span class="lineNum">     912 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(boxes[4].ret,gb_expandgluesame);</span>
<span class="lineNum">     913 </span><span class="lineNoCov">          0 :     GHVBoxFitWindow(boxes[0].ret);</span>
<span class="lineNum">     914 </span>            : 
<span class="lineNum">     915 </span><span class="lineNoCov">          0 :     OptSetDefaults(gw,d,which,iscid);</span>
<span class="lineNum">     916 </span>            : 
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :     while ( !d-&gt;sod_done )</span>
<span class="lineNum">     919 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(gw);</span>
<a name="921"><span class="lineNum">     921 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     922 </span>            : 
<span class="lineNum">     923 </span><span class="lineNoCov">          0 : static int br_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :         int *done = GDrawGetUserData(gw);</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :         *done = -1;</span>
<span class="lineNum">     927 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_char ) {</span>
<span class="lineNum">     928 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_map ) {</span>
<span class="lineNum">     930 </span>            :         /* Above palettes */
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :         GDrawRaise(gw);</span>
<span class="lineNum">     932 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_controlevent &amp;&amp; event-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :         int *done = GDrawGetUserData(gw);</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :         if ( GGadgetGetCid(event-&gt;u.control.g)==1001 )</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :             *done = true;</span>
<span class="lineNum">     936 </span>            :         else
<span class="lineNum">     937 </span><span class="lineNoCov">          0 :             *done = -1;</span>
<span class="lineNum">     938 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_controlevent &amp;&amp; event-&gt;u.control.subtype == et_textchanged &amp;&amp;</span>
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :             GGadgetGetCid(event-&gt;u.control.g)==1003 ) {</span>
<span class="lineNum">     940 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(gw,1004),true);</span>
<span class="lineNum">     941 </span>            :     }
<span class="lineNum">     942 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="943"><span class="lineNum">     943 </span>            : }</a>
<span class="lineNum">     944 </span>            : 
<span class="lineNum">     945 </span><span class="lineNoCov">          0 : static int AskResolution(int bf,BDFFont *bdf) {</span>
<span class="lineNum">     946 </span>            :     GRect pos;
<span class="lineNum">     947 </span>            :     static GWindow bdf_gw, fon_gw;
<span class="lineNum">     948 </span>            :     GWindow gw;
<span class="lineNum">     949 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">     950 </span>            :     GGadgetCreateData gcd[10], *varray[22], *harray[7], *harray2[4], boxes[4];
<span class="lineNum">     951 </span>            :     GTextInfo label[10];
<span class="lineNum">     952 </span><span class="lineNoCov">          0 :     int done=-3;</span>
<span class="lineNum">     953 </span><span class="lineNoCov">          0 :     int def_res = -1;</span>
<span class="lineNum">     954 </span>            :     char buf[20];
<span class="lineNum">     955 </span>            : 
<span class="lineNum">     956 </span><span class="lineNoCov">          0 :     if ( bdf!=NULL )</span>
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :         def_res = bdf-&gt;res;</span>
<span class="lineNum">     958 </span>            : 
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :     if ( no_windowing_ui )</span>
<span class="lineNum">     960 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     961 </span>            : 
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :     gw = bf==bf_bdf ? bdf_gw : fon_gw;</span>
<span class="lineNum">     963 </span><span class="lineNoCov">          0 :     if ( gw==NULL ) {</span>
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :         memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">     965 </span><span class="lineNoCov">          0 :         wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_isdlg|wam_restrict;</span>
<span class="lineNum">     966 </span><span class="lineNoCov">          0 :         wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :         wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">     968 </span><span class="lineNoCov">          0 :         wattrs.undercursor = 1;</span>
<span class="lineNum">     969 </span><span class="lineNoCov">          0 :         wattrs.cursor = ct_pointer;</span>
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :         wattrs.utf8_window_title = _(&quot;BDF Resolution&quot;);</span>
<span class="lineNum">     971 </span><span class="lineNoCov">          0 :         wattrs.is_dlg = true;</span>
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :         pos.x = pos.y = 0;</span>
<span class="lineNum">     973 </span><span class="lineNoCov">          0 :         pos.width = GGadgetScale(GDrawPointsToPixels(NULL,150));</span>
<span class="lineNum">     974 </span><span class="lineNoCov">          0 :         pos.height = GDrawPointsToPixels(NULL,130);</span>
<span class="lineNum">     975 </span><span class="lineNoCov">          0 :         gw = GDrawCreateTopWindow(NULL,&amp;pos,br_e_h,&amp;done,&amp;wattrs);</span>
<span class="lineNum">     976 </span><span class="lineNoCov">          0 :         if ( bf==bf_bdf )</span>
<span class="lineNum">     977 </span><span class="lineNoCov">          0 :             bdf_gw = gw;</span>
<span class="lineNum">     978 </span>            :         else
<span class="lineNum">     979 </span><span class="lineNoCov">          0 :             fon_gw = gw;</span>
<span class="lineNum">     980 </span>            : 
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :         memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">     982 </span><span class="lineNoCov">          0 :         memset(&amp;gcd,0,sizeof(gcd));</span>
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :         memset(&amp;boxes,0,sizeof(boxes));</span>
<span class="lineNum">     984 </span>            : 
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :         label[0].text = (unichar_t *) _(&quot;BDF Resolution&quot;);</span>
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :         label[0].text_is_1byte = true;</span>
<span class="lineNum">     987 </span><span class="lineNoCov">          0 :         gcd[0].gd.label = &amp;label[0];</span>
<span class="lineNum">     988 </span><span class="lineNoCov">          0 :         gcd[0].gd.pos.x = 5; gcd[0].gd.pos.y = 7;</span>
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :         gcd[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">     990 </span><span class="lineNoCov">          0 :         gcd[0].creator = GLabelCreate;</span>
<span class="lineNum">     991 </span><span class="lineNoCov">          0 :         harray2[0] = GCD_Glue; harray2[1] = &amp;gcd[0]; harray2[2] = GCD_Glue; harray2[3] = NULL;</span>
<span class="lineNum">     992 </span>            : 
<span class="lineNum">     993 </span><span class="lineNoCov">          0 :         boxes[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :         boxes[3].gd.u.boxelements = harray2;</span>
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :         boxes[3].creator = GHBoxCreate;</span>
<span class="lineNum">     996 </span><span class="lineNoCov">          0 :         varray[0] = &amp;boxes[3]; varray[1] = GCD_ColSpan; varray[2] = NULL;</span>
<span class="lineNum">     997 </span>            : 
<span class="lineNum">     998 </span><span class="lineNoCov">          0 :         label[1].text = (unichar_t *) (bf==bf_bdf ? &quot;75&quot; : &quot;96&quot;);</span>
<span class="lineNum">     999 </span><span class="lineNoCov">          0 :         label[1].text_is_1byte = true;</span>
<span class="lineNum">    1000 </span><span class="lineNoCov">          0 :         gcd[1].gd.label = &amp;label[1];</span>
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 :         gcd[1].gd.mnemonic = (bf==bf_bdf ? '7' : '9');</span>
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 :         gcd[1].gd.pos.x = 20; gcd[1].gd.pos.y = 13+7;</span>
<span class="lineNum">    1003 </span><span class="lineNoCov">          0 :         gcd[1].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1004 </span><span class="lineNoCov">          0 :         if ( (bf==bf_bdf ? 75 : 96)==def_res )</span>
<span class="lineNum">    1005 </span><span class="lineNoCov">          0 :             gcd[1].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    1006 </span><span class="lineNoCov">          0 :         gcd[1].gd.cid = 75;</span>
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 :         gcd[1].creator = GRadioCreate;</span>
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 :         varray[3] = &amp;gcd[1]; varray[4] = GCD_Glue; varray[5] = NULL;</span>
<span class="lineNum">    1009 </span>            : 
<span class="lineNum">    1010 </span><span class="lineNoCov">          0 :         label[2].text = (unichar_t *) (bf==bf_bdf ? &quot;100&quot; : &quot;120&quot;);</span>
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :         label[2].text_is_1byte = true;</span>
<span class="lineNum">    1012 </span><span class="lineNoCov">          0 :         gcd[2].gd.label = &amp;label[2];</span>
<span class="lineNum">    1013 </span><span class="lineNoCov">          0 :         gcd[2].gd.mnemonic = '1';</span>
<span class="lineNum">    1014 </span><span class="lineNoCov">          0 :         gcd[2].gd.pos.x = 20; gcd[2].gd.pos.y = gcd[1].gd.pos.y+17;</span>
<span class="lineNum">    1015 </span><span class="lineNoCov">          0 :         gcd[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 :         if ( (bf==bf_bdf ? 100 : 120)==def_res )</span>
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :             gcd[2].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :         gcd[2].gd.cid = 100;</span>
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :         gcd[2].creator = GRadioCreate;</span>
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 :         varray[6] = &amp;gcd[2]; varray[7] = GCD_Glue; varray[8] = NULL;</span>
<span class="lineNum">    1021 </span>            : 
<span class="lineNum">    1022 </span><span class="lineNoCov">          0 :         label[3].text = (unichar_t *) _(&quot;_Guess&quot;);</span>
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 :         label[3].text_is_1byte = true;</span>
<span class="lineNum">    1024 </span><span class="lineNoCov">          0 :         label[3].text_in_resource = true;</span>
<span class="lineNum">    1025 </span><span class="lineNoCov">          0 :         gcd[3].gd.label = &amp;label[3];</span>
<span class="lineNum">    1026 </span><span class="lineNoCov">          0 :         gcd[3].gd.pos.x = 20; gcd[3].gd.pos.y = gcd[2].gd.pos.y+17;</span>
<span class="lineNum">    1027 </span><span class="lineNoCov">          0 :         gcd[3].gd.flags = gg_enabled|gg_visible|gg_utf8_popup;</span>
<span class="lineNum">    1028 </span><span class="lineNoCov">          0 :         if ( !((gcd[1].gd.flags|gcd[2].gd.flags)&amp;gg_cb_on) )</span>
<span class="lineNum">    1029 </span><span class="lineNoCov">          0 :             gcd[3].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 :         gcd[3].gd.cid = -1;</span>
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :         gcd[3].gd.popup_msg = (unichar_t *) _(&quot;Guess each font's resolution based on its pixel size&quot;);</span>
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :         gcd[3].creator = GRadioCreate;</span>
<span class="lineNum">    1033 </span><span class="lineNoCov">          0 :         varray[9] = &amp;gcd[3]; varray[10] = GCD_Glue; varray[11] = NULL;</span>
<span class="lineNum">    1034 </span>            : 
<span class="lineNum">    1035 </span><span class="lineNoCov">          0 :         label[4].text = (unichar_t *) _(&quot;_Other&quot;);</span>
<span class="lineNum">    1036 </span><span class="lineNoCov">          0 :         label[4].text_is_1byte = true;</span>
<span class="lineNum">    1037 </span><span class="lineNoCov">          0 :         label[4].text_in_resource = true;</span>
<span class="lineNum">    1038 </span><span class="lineNoCov">          0 :         gcd[4].gd.label = &amp;label[4];</span>
<span class="lineNum">    1039 </span><span class="lineNoCov">          0 :         gcd[4].gd.pos.x = 20; gcd[4].gd.pos.y = gcd[3].gd.pos.y+17;</span>
<span class="lineNum">    1040 </span><span class="lineNoCov">          0 :         gcd[4].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 :         gcd[4].gd.cid = 1004;</span>
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :         gcd[4].creator = GRadioCreate;</span>
<span class="lineNum">    1043 </span>            : 
<span class="lineNum">    1044 </span><span class="lineNoCov">          0 :         label[5].text = (unichar_t *) (bf == bf_bdf ? &quot;96&quot; : &quot;72&quot;);</span>
<span class="lineNum">    1045 </span><span class="lineNoCov">          0 :         if ( def_res&gt;0 ) {</span>
<span class="lineNum">    1046 </span><span class="lineNoCov">          0 :             sprintf( buf, &quot;%d&quot;, def_res );</span>
<span class="lineNum">    1047 </span><span class="lineNoCov">          0 :             label[5].text = (unichar_t *) buf;</span>
<span class="lineNum">    1048 </span>            :         }
<span class="lineNum">    1049 </span><span class="lineNoCov">          0 :         label[5].text_is_1byte = true;</span>
<span class="lineNum">    1050 </span><span class="lineNoCov">          0 :         gcd[5].gd.label = &amp;label[5];</span>
<span class="lineNum">    1051 </span><span class="lineNoCov">          0 :         gcd[5].gd.pos.x = 70; gcd[5].gd.pos.y = gcd[4].gd.pos.y-3; gcd[5].gd.pos.width = 40;</span>
<span class="lineNum">    1052 </span><span class="lineNoCov">          0 :         gcd[5].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1053 </span><span class="lineNoCov">          0 :         gcd[5].gd.cid = 1003;</span>
<span class="lineNum">    1054 </span><span class="lineNoCov">          0 :         gcd[5].creator = GTextFieldCreate;</span>
<span class="lineNum">    1055 </span><span class="lineNoCov">          0 :         varray[12] = &amp;gcd[4]; varray[13] = &amp;gcd[5]; varray[14] = NULL;</span>
<span class="lineNum">    1056 </span><span class="lineNoCov">          0 :         varray[15] = GCD_Glue; varray[16] = GCD_Glue; varray[17] = NULL;</span>
<span class="lineNum">    1057 </span>            : 
<span class="lineNum">    1058 </span><span class="lineNoCov">          0 :         gcd[6].gd.pos.x = 15-3; gcd[6].gd.pos.y = gcd[4].gd.pos.y+24;</span>
<span class="lineNum">    1059 </span><span class="lineNoCov">          0 :         gcd[6].gd.pos.width = -1; gcd[6].gd.pos.height = 0;</span>
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :         gcd[6].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">    1061 </span><span class="lineNoCov">          0 :         label[6].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">    1062 </span><span class="lineNoCov">          0 :         label[6].text_is_1byte = true;</span>
<span class="lineNum">    1063 </span><span class="lineNoCov">          0 :         label[6].text_in_resource = true;</span>
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :         gcd[6].gd.mnemonic = 'O';</span>
<span class="lineNum">    1065 </span><span class="lineNoCov">          0 :         gcd[6].gd.label = &amp;label[6];</span>
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 :         gcd[6].gd.cid = 1001;</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :         gcd[6].creator = GButtonCreate;</span>
<span class="lineNum">    1068 </span><span class="lineNoCov">          0 :         harray[0] = GCD_Glue; harray[1] = &amp;gcd[6]; harray[2] = GCD_Glue;</span>
<span class="lineNum">    1069 </span>            : 
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :         gcd[7].gd.pos.x = -15; gcd[7].gd.pos.y = gcd[6].gd.pos.y+3;</span>
<span class="lineNum">    1071 </span><span class="lineNoCov">          0 :         gcd[7].gd.pos.width = -1; gcd[7].gd.pos.height = 0;</span>
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 :         gcd[7].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">    1073 </span><span class="lineNoCov">          0 :         label[7].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :         label[7].text_is_1byte = true;</span>
<span class="lineNum">    1075 </span><span class="lineNoCov">          0 :         label[7].text_in_resource = true;</span>
<span class="lineNum">    1076 </span><span class="lineNoCov">          0 :         gcd[7].gd.label = &amp;label[7];</span>
<span class="lineNum">    1077 </span><span class="lineNoCov">          0 :         gcd[7].gd.mnemonic = 'C';</span>
<span class="lineNum">    1078 </span>            :         /*gcd[7].gd.handle_controlevent = CH_Cancel;*/
<span class="lineNum">    1079 </span><span class="lineNoCov">          0 :         gcd[7].gd.cid = 1002;</span>
<span class="lineNum">    1080 </span><span class="lineNoCov">          0 :         gcd[7].creator = GButtonCreate;</span>
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 :         harray[3] = GCD_Glue; harray[4] = &amp;gcd[7]; harray[5] = GCD_Glue;</span>
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :         harray[6] = NULL;</span>
<span class="lineNum">    1083 </span>            : 
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :         boxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">          0 :         boxes[2].gd.u.boxelements = harray;</span>
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :         boxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :         varray[18] = &amp;boxes[2]; varray[19] = GCD_ColSpan; varray[20] = NULL;</span>
<span class="lineNum">    1088 </span><span class="lineNoCov">          0 :         varray[21] = NULL;</span>
<span class="lineNum">    1089 </span>            : 
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :         boxes[0].gd.pos.x = boxes[0].gd.pos.y = 2;</span>
<span class="lineNum">    1091 </span><span class="lineNoCov">          0 :         boxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :         boxes[0].gd.u.boxelements = varray;</span>
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 :         boxes[0].creator = GHVGroupCreate;</span>
<span class="lineNum">    1094 </span>            : 
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 :         gcd[8].gd.pos.x = 2; gcd[8].gd.pos.y = 2;</span>
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 :         gcd[8].gd.pos.width = pos.width-4; gcd[8].gd.pos.height = pos.height-2;</span>
<span class="lineNum">    1097 </span><span class="lineNoCov">          0 :         gcd[8].gd.flags = gg_enabled | gg_visible | gg_pos_in_pixels;</span>
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :         gcd[8].creator = GGroupCreate;</span>
<span class="lineNum">    1099 </span>            : 
<span class="lineNum">    1100 </span><span class="lineNoCov">          0 :         GGadgetsCreate(gw,boxes);</span>
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(boxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    1102 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(boxes[2].ret,gb_expandgluesame);</span>
<span class="lineNum">    1103 </span>            :     } else
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :         GDrawSetUserData(gw,&amp;done);</span>
<span class="lineNum">    1105 </span>            : 
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :     GWidgetHidePalettes();</span>
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<span class="lineNum">    1108 </span>            :     while ( true ) {
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :         done = 0;</span>
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :         while ( !done )</span>
<span class="lineNum">    1111 </span><span class="lineNoCov">          0 :             GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :         if ( GGadgetIsChecked(GWidgetGetControl(gw,1004)) ) {</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :             int err = false;</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :             int res = GetInt8(gw,1003,_(&quot;Other ...&quot;),&amp;err);</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :             if ( res&lt;10 )</span>
<span class="lineNum">    1116 </span><span class="lineNoCov">          0 :                 GGadgetProtest8( _(&quot;_Other&quot;));</span>
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :             else if ( !err ) {</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :                 GDrawSetVisible(gw,false);</span>
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 : return( res );</span>
<span class="lineNum">    1120 </span>            :             }
<span class="lineNum">    1121 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    1122 </span>            :         }
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :         GDrawSetVisible(gw,false);</span>
<span class="lineNum">    1124 </span><span class="lineNoCov">          0 :         if ( done==-1 )</span>
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 : return( -2 );</span>
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :         if ( GGadgetIsChecked(GWidgetGetControl(gw,75)) )</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 : return( bf == bf_bdf ? 75 : 96 );</span>
<span class="lineNum">    1128 </span><span class="lineNoCov">          0 :         if ( GGadgetIsChecked(GWidgetGetControl(gw,100)) )</span>
<span class="lineNum">    1129 </span><span class="lineNoCov">          0 : return( bf == bf_bdf ? 100 : 120 );</span>
<span class="lineNum">    1130 </span>            :         /*if ( GGadgetIsChecked(GWidgetGetControl(gw,-1)) )*/
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 :     }</span>
<a name="1133"><span class="lineNum">    1133 </span>            : }</a>
<span class="lineNum">    1134 </span>            : 
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 : static char *SearchDirForWernerFile(char *dir,char *filename) {</span>
<span class="lineNum">    1136 </span>            :     char buffer[1025], buf2[200];
<span class="lineNum">    1137 </span>            :     FILE *file;
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 :     int good = 0;</span>
<span class="lineNum">    1139 </span>            : 
<span class="lineNum">    1140 </span><span class="lineNoCov">          0 :     if ( dir==NULL || filename==NULL || \</span>
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :          strlen(dir)+strlen(filename)&gt;sizeof(buffer)-2 )</span>
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :         return( NULL );</span>
<span class="lineNum">    1143 </span>            : 
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :     strcpy(buffer,dir);</span>
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :     strcat(buffer,&quot;/&quot;);</span>
<span class="lineNum">    1146 </span><span class="lineNoCov">          0 :     strcat(buffer,filename);</span>
<span class="lineNum">    1147 </span><span class="lineNoCov">          0 :     if ( (file=fopen(buffer,&quot;r&quot;))==NULL )</span>
<span class="lineNum">    1148 </span><span class="lineNoCov">          0 :         return( NULL );</span>
<span class="lineNum">    1149 </span><span class="lineNoCov">          0 :     if ( fgets(buf2,sizeof(buf2),file)!=NULL &amp;&amp; \</span>
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :           strncmp(buf2,pfaeditflag,strlen(pfaeditflag))==0 )</span>
<span class="lineNum">    1151 </span><span class="lineNoCov">          0 :         good = 1;</span>
<span class="lineNum">    1152 </span><span class="lineNoCov">          0 :     fclose( file );</span>
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :     if ( good )</span>
<span class="lineNum">    1154 </span><span class="lineNoCov">          0 :         return( copy(buffer) );</span>
<span class="lineNum">    1155 </span>            : 
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :     return( NULL );</span>
<a name="1157"><span class="lineNum">    1157 </span>            : }</a>
<span class="lineNum">    1158 </span>            : 
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 : static char *SearchNoLibsDirForWernerFile(char *dir,char *filename) {</span>
<span class="lineNum">    1160 </span>            :     char *ret;
<span class="lineNum">    1161 </span>            : 
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :     if ( dir==NULL || strstr(dir,&quot;/.libs&quot;)==NULL )</span>
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    1164 </span>            : 
<span class="lineNum">    1165 </span><span class="lineNoCov">          0 :     dir = copy(dir);</span>
<span class="lineNum">    1166 </span><span class="lineNoCov">          0 :     *strstr(dir,&quot;/.libs&quot;) = '\0';</span>
<span class="lineNum">    1167 </span>            : 
<span class="lineNum">    1168 </span><span class="lineNoCov">          0 :     ret = SearchDirForWernerFile(dir,filename);</span>
<span class="lineNum">    1169 </span><span class="lineNoCov">          0 :     free(dir);</span>
<span class="lineNum">    1170 </span><span class="lineNoCov">          0 : return( ret );</span>
<a name="1171"><span class="lineNum">    1171 </span>            : }</a>
<span class="lineNum">    1172 </span>            : 
<span class="lineNum">    1173 </span><span class="lineNoCov">          0 : static enum fchooserret GFileChooserFilterWernerSFDs(GGadget *g,GDirEntry *ent,</span>
<span class="lineNum">    1174 </span>            :         const unichar_t *dir) {
<span class="lineNum">    1175 </span><span class="lineNoCov">          0 :     enum fchooserret ret = GFileChooserDefFilter(g,ent,dir);</span>
<span class="lineNum">    1176 </span>            :     char buf2[200];
<span class="lineNum">    1177 </span>            :     FILE *file;
<span class="lineNum">    1178 </span>            : 
<span class="lineNum">    1179 </span><span class="lineNoCov">          0 :     if ( ret==fc_show &amp;&amp; !ent-&gt;isdir ) {</span>
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :         char *filename = malloc(u_strlen(dir)+u_strlen(ent-&gt;name)+5);</span>
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 :         cu_strcpy(filename,dir);</span>
<span class="lineNum">    1182 </span><span class="lineNoCov">          0 :         strcat(filename,&quot;/&quot;);</span>
<span class="lineNum">    1183 </span><span class="lineNoCov">          0 :         cu_strcat(filename,ent-&gt;name);</span>
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :         file = fopen(filename,&quot;r&quot;);</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :         if ( file==NULL )</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :             ret = fc_hide;</span>
<span class="lineNum">    1187 </span>            :         else {
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :             if ( fgets(buf2,sizeof(buf2),file)==NULL ||</span>
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 :                     strncmp(buf2,pfaeditflag,strlen(pfaeditflag))==0 )</span>
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :                 ret = fc_hide;</span>
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 :             fclose(file);</span>
<span class="lineNum">    1192 </span>            :         }
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :         free(filename);</span>
<span class="lineNum">    1194 </span>            :     }
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 : return( ret );</span>
<a name="1196"><span class="lineNum">    1196 </span>            : }</a>
<span class="lineNum">    1197 </span>            : 
<span class="lineNum">    1198 </span><span class="lineNoCov">          0 : static char *GetWernerSFDFile(SplineFont *sf,EncMap *map) {</span>
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :     char *def=NULL, *ret;</span>
<span class="lineNum">    1200 </span>            :     char buffer[100];
<span class="lineNum">    1201 </span><span class="lineNoCov">          0 :     int supl = sf-&gt;supplement;</span>
<span class="lineNum">    1202 </span>            : 
<span class="lineNum">    1203 </span><span class="lineNoCov">          0 :     for ( supl = sf-&gt;supplement; supl&lt;sf-&gt;supplement+10 ; ++supl ) {</span>
<span class="lineNum">    1204 </span><span class="lineNoCov">          0 :         if ( no_windowing_ui ) {</span>
<span class="lineNum">    1205 </span><span class="lineNoCov">          0 :             if ( sf-&gt;subfontcnt!=0 ) {</span>
<span class="lineNum">    1206 </span><span class="lineNoCov">          0 :                 sprintf(buffer,&quot;%.40s-%.40s-%d.sfd&quot;, sf-&gt;cidregistry,sf-&gt;ordering,supl);</span>
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :                 def = buffer;</span>
<span class="lineNum">    1208 </span><span class="lineNoCov">          0 :             } else if ( strstrmatch(map-&gt;enc-&gt;enc_name,&quot;big&quot;)!=NULL &amp;&amp;</span>
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :                     strchr(map-&gt;enc-&gt;enc_name,'5')!=NULL ) {</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :                 if (strstrmatch(map-&gt;enc-&gt;enc_name,&quot;hkscs&quot;)!=NULL )</span>
<span class="lineNum">    1211 </span><span class="lineNoCov">          0 :                     def = &quot;Big5HKSCS.sfd&quot;;</span>
<span class="lineNum">    1212 </span>            :                 else
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :                     def = &quot;Big5.sfd&quot;;</span>
<span class="lineNum">    1214 </span><span class="lineNoCov">          0 :             } else if ( strstrmatch(map-&gt;enc-&gt;enc_name,&quot;sjis&quot;)!=NULL )</span>
<span class="lineNum">    1215 </span><span class="lineNoCov">          0 :                 def = &quot;Sjis.sfd&quot;;</span>
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 :             else if ( strstrmatch(map-&gt;enc-&gt;enc_name,&quot;Wansung&quot;)!=NULL ||</span>
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 :                     strstrmatch(map-&gt;enc-&gt;enc_name,&quot;EUC-KR&quot;)!=NULL )</span>
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :                 def = &quot;Wansung.sfd&quot;;</span>
<span class="lineNum">    1219 </span><span class="lineNoCov">          0 :             else if ( strstrmatch(map-&gt;enc-&gt;enc_name,&quot;johab&quot;)!=NULL )</span>
<span class="lineNum">    1220 </span><span class="lineNoCov">          0 :                 def = &quot;Johab.sfd&quot;;</span>
<span class="lineNum">    1221 </span><span class="lineNoCov">          0 :             else if ( map-&gt;enc-&gt;is_unicodebmp || map-&gt;enc-&gt;is_unicodefull )</span>
<span class="lineNum">    1222 </span><span class="lineNoCov">          0 :                 def = &quot;Unicode.sfd&quot;;</span>
<span class="lineNum">    1223 </span>            :         }
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :         if ( def!=NULL ) {</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :             ret = SearchDirForWernerFile(&quot;.&quot;,def);</span>
<span class="lineNum">    1226 </span><span class="lineNoCov">          0 :             if ( ret==NULL )</span>
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :                 ret = SearchDirForWernerFile(GResourceProgramDir,def);</span>
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 :             if ( ret==NULL )</span>
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :                 ret = SearchDirForWernerFile(getFontForgeShareDir(),def);</span>
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :             if ( ret==NULL )</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :                 ret = SearchNoLibsDirForWernerFile(GResourceProgramDir,def);</span>
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :             if ( ret!=NULL )</span>
<span class="lineNum">    1233 </span><span class="lineNoCov">          0 : return( ret );</span>
<span class="lineNum">    1234 </span>            :         }
<span class="lineNum">    1235 </span><span class="lineNoCov">          0 :         if ( sf-&gt;subfontcnt!=0 )</span>
<span class="lineNum">    1236 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1237 </span>            :     }
<span class="lineNum">    1238 </span>            : 
<span class="lineNum">    1239 </span><span class="lineNoCov">          0 :     if ( no_windowing_ui )</span>
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 : return( NULL );</span>
<span class="lineNum">    1241 </span>            : 
<span class="lineNum">    1242 </span>            :     /*if ( def==NULL )*/
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :         def = &quot;*.sfd&quot;;</span>
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :     ret = gwwv_open_filename(_(&quot;Find Sub Font Definition file&quot;),NULL,&quot;*.sfd&quot;,GFileChooserFilterWernerSFDs);</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 : return( ret );</span>
<a name="1246"><span class="lineNum">    1246 </span>            : }</a>
<span class="lineNum">    1247 </span>            : 
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 : static int AnyRefs(RefChar *refs) {</span>
<span class="lineNum">    1249 </span>            :     int j;
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :     while ( refs!=NULL ) {</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :         for ( j=0; j&lt;refs-&gt;layer_cnt; ++j )</span>
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :             if ( refs-&gt;layers[j].splines!=NULL )</span>
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :         refs = refs-&gt;next;</span>
<span class="lineNum">    1255 </span>            :     }
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1257 </span>            : }
<span class="lineNum">    1258 </span>            : 
<a name="1259"><span class="lineNum">    1259 </span>            : int will_prepend_timestamp = false;</a>
<span class="lineNum">    1260 </span>            : 
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 : static void prepend_timestamp(struct gfc_data *d){</span>
<span class="lineNum">    1262 </span>            : 
<span class="lineNum">    1263 </span><span class="lineNoCov">          0 :   if (d-&gt;sf-&gt;familyname_with_timestamp)</span>
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 :     free(d-&gt;sf-&gt;familyname_with_timestamp);</span>
<span class="lineNum">    1265 </span><span class="lineNoCov">          0 :   d-&gt;sf-&gt;familyname_with_timestamp = NULL;</span>
<span class="lineNum">    1266 </span>            : 
<span class="lineNum">    1267 </span><span class="lineNoCov">          0 :   if (will_prepend_timestamp){</span>
<span class="lineNum">    1268 </span>            :     //prepend &quot;YYMMDDHHMM-&quot;
<span class="lineNum">    1269 </span>            : 
<span class="lineNum">    1270 </span>            :     time_t rawtime;
<span class="lineNum">    1271 </span>            :     struct tm * timeinfo;
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 :     time(&amp;rawtime);</span>
<span class="lineNum">    1273 </span><span class="lineNoCov">          0 :     timeinfo = localtime(&amp;rawtime);</span>
<span class="lineNum">    1274 </span>            :     char timestamp[11];
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :     strftime(timestamp, 11, &quot;%y%m%d%H%M&quot;, timeinfo);</span>
<span class="lineNum">    1276 </span>            : 
<span class="lineNum">    1277 </span>            :     char* new_name;
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 :     char* original_name = (d-&gt;sf-&gt;familyname) ? d-&gt;sf-&gt;familyname : d-&gt;sf-&gt;fontname;</span>
<span class="lineNum">    1279 </span>            :     int i;
<span class="lineNum">    1280 </span>            : 
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :     if (original_name!=NULL){</span>
<span class="lineNum">    1282 </span>            :     //if we already have a timestamp prepended, we should remove it before appending a new one
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 :       int timestamp_found = (original_name[10]=='-');</span>
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :       for (i=0;i&lt;10;i++)</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :         if (original_name[i]&lt;'0' || original_name[i]&gt;'9')</span>
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :           timestamp_found = false;</span>
<span class="lineNum">    1287 </span>            : 
<span class="lineNum">    1288 </span><span class="lineNoCov">          0 :       if (timestamp_found)</span>
<span class="lineNum">    1289 </span><span class="lineNoCov">          0 :         original_name = original_name + 11; //skip previous timestamp</span>
<span class="lineNum">    1290 </span>            : 
<span class="lineNum">    1291 </span><span class="lineNoCov">          0 :       new_name = malloc (sizeof(char) * (strlen(original_name) + 12));</span>
<span class="lineNum">    1292 </span><span class="lineNoCov">          0 :       sprintf(new_name, &quot;%s-%s&quot;, timestamp, original_name);</span>
<span class="lineNum">    1293 </span>            : 
<span class="lineNum">    1294 </span><span class="lineNoCov">          0 :       d-&gt;sf-&gt;familyname_with_timestamp = new_name;</span>
<span class="lineNum">    1295 </span>            :     }
<span class="lineNum">    1296 </span>            :   }
<a name="1297"><span class="lineNum">    1297 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1298 </span>            : 
<span class="lineNum">    1299 </span><span class="lineNoCov">          0 : static void DoSave(struct gfc_data *d,unichar_t *path) {</span>
<span class="lineNum">    1300 </span><span class="lineNoCov">          0 :     int err=false;</span>
<span class="lineNum">    1301 </span>            :     char *temp;
<span class="lineNum">    1302 </span><span class="lineNoCov">          0 :     int32 *sizes=NULL;</span>
<span class="lineNum">    1303 </span>            :     int iscid, i;
<span class="lineNum">    1304 </span><span class="lineNoCov">          0 :     struct sflist *sfs=NULL, *cur, *last=NULL;</span>
<span class="lineNum">    1305 </span>            :     static int psscalewarned=0, ttfscalewarned=0, psfnlenwarned=0;
<span class="lineNum">    1306 </span>            :     int flags;
<span class="lineNum">    1307 </span>            :     struct sflist *sfl;
<span class="lineNum">    1308 </span>            :     char **former;
<span class="lineNum">    1309 </span>            :     NameList *rename_to;
<span class="lineNum">    1310 </span><span class="lineNoCov">          0 :     GTextInfo *ti = GGadgetGetListItemSelected(d-&gt;rename);</span>
<span class="lineNum">    1311 </span><span class="lineNoCov">          0 :     char *nlname = u2utf8_copy(ti-&gt;text);</span>
<span class="lineNum">    1312 </span>            :     extern NameList *force_names_when_saving;
<span class="lineNum">    1313 </span><span class="lineNoCov">          0 :     int notdef_pos = SFFindNotdef(d-&gt;sf,-1);</span>
<span class="lineNum">    1314 </span><span class="lineNoCov">          0 :     int layer = ly_fore;</span>
<span class="lineNum">    1315 </span>            :     int likecff;
<span class="lineNum">    1316 </span>            :     char *buts[3];
<span class="lineNum">    1317 </span>            : 
<span class="lineNum">    1318 </span><span class="lineNoCov">          0 :     prepend_timestamp(d);</span>
<span class="lineNum">    1319 </span>            : 
<span class="lineNum">    1320 </span><span class="lineNoCov">          0 :     buts[0] = _(&quot;_Yes&quot;);</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :     buts[1] = _(&quot;_No&quot;);</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 :     buts[2] = NULL;</span>
<span class="lineNum">    1323 </span>            : 
<span class="lineNum">    1324 </span><span class="lineNoCov">          0 :     rename_to = NameListByName(nlname);</span>
<span class="lineNum">    1325 </span><span class="lineNoCov">          0 :     free(nlname);</span>
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :     if ( rename_to!=NULL &amp;&amp; rename_to-&gt;uses_unicode ) {</span>
<span class="lineNum">    1327 </span>            :         /* I'll let someone generate a font with utf8 names, but I won't let */
<span class="lineNum">    1328 </span>            :         /*  them take a font and force it to unicode here. */
<span class="lineNum">    1329 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Namelist contains non-ASCII names&quot;),_(&quot;Glyph names should be limited to characters in the ASCII character set, but there are names in this namelist which use characters outside that range.&quot;));</span>
<span class="lineNum">    1330 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1331 </span>            :     }
<span class="lineNum">    1332 </span>            : 
<span class="lineNum">    1333 </span><span class="lineNoCov">          0 :     for ( i=d-&gt;sf-&gt;glyphcnt-1; i&gt;=1; --i ) if ( i!=notdef_pos )</span>
<span class="lineNum">    1334 </span><span class="lineNoCov">          0 :         if ( d-&gt;sf-&gt;glyphs[i]!=NULL &amp;&amp; strcmp(d-&gt;sf-&gt;glyphs[i]-&gt;name,&quot;.notdef&quot;)==0 &amp;&amp;</span>
<span class="lineNum">    1335 </span><span class="lineNoCov">          0 :                 (d-&gt;sf-&gt;glyphs[i]-&gt;layers[ly_fore].splines!=NULL || AnyRefs(d-&gt;sf-&gt;glyphs[i]-&gt;layers[ly_fore].refs )))</span>
<span class="lineNum">    1336 </span>            :     break;
<span class="lineNum">    1337 </span><span class="lineNoCov">          0 :     if ( i&gt;0 ) {</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">          0 :         if ( gwwv_ask(_(&quot;Notdef name&quot;),(const char **) buts,0,1,_(&quot;The glyph at encoding %d is named \&quot;.notdef\&quot; but contains an outline. Because it is called \&quot;.notdef\&quot; it will not be included in the generated font. You may give it a new name using Element-&gt;Glyph Info. Do you wish to continue font generation (and omit this character)?&quot;),d-&gt;map-&gt;backmap[i])==1 )</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1340 </span>            :     }
<span class="lineNum">    1341 </span>            : 
<span class="lineNum">    1342 </span><span class="lineNoCov">          0 :     if ( d-&gt;family==gf_none )</span>
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 :         layer = (intpt) GGadgetGetListItemSelected(GWidgetGetControl(d-&gt;gw,CID_Layers))-&gt;userdata;</span>
<span class="lineNum">    1344 </span>            : 
<span class="lineNum">    1345 </span><span class="lineNoCov">          0 :     temp = u2def_copy(path);</span>
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :     oldformatstate = GGadgetGetFirstListSelectedItem(d-&gt;pstype);</span>
<span class="lineNum">    1347 </span><span class="lineNoCov">          0 :     iscid = oldformatstate==ff_cid || oldformatstate==ff_cffcid ||</span>
<span class="lineNum">    1348 </span><span class="lineNoCov">          0 :             oldformatstate==ff_otfcid || oldformatstate==ff_otfciddfont;</span>
<span class="lineNum">    1349 </span><span class="lineNoCov">          0 :     if ( !iscid &amp;&amp; (d-&gt;sf-&gt;cidmaster!=NULL || d-&gt;sf-&gt;subfontcnt&gt;1)) {</span>
<span class="lineNum">    1350 </span><span class="lineNoCov">          0 :         if ( gwwv_ask(_(&quot;Not a CID format&quot;),(const char **) buts,0,1,_(&quot;You are attempting to save a CID font in a non-CID format. This is ok, but it means that only the current sub-font will be saved.\nIs that what you want?&quot;))==1 )</span>
<span class="lineNum">    1351 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1352 </span>            :     }
<span class="lineNum">    1353 </span><span class="lineNoCov">          0 :     if ( oldformatstate == ff_ttf || oldformatstate==ff_ttfsym ||</span>
<span class="lineNum">    1354 </span><span class="lineNoCov">          0 :             oldformatstate==ff_ttfmacbin || oldformatstate==ff_ttfdfont ) {</span>
<span class="lineNum">    1355 </span>            :         SplineChar *sc; RefChar *ref;
<span class="lineNum">    1356 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;d-&gt;sf-&gt;glyphcnt; ++i ) if ( (sc = d-&gt;sf-&gt;glyphs[i])!=NULL ) {</span>
<span class="lineNum">    1357 </span><span class="lineNoCov">          0 :             if ( sc-&gt;ttf_instrs_len!=0 &amp;&amp; sc-&gt;instructions_out_of_date ) {</span>
<span class="lineNum">    1358 </span><span class="lineNoCov">          0 :                 if ( gwwv_ask(_(&quot;Instructions out of date&quot;),(const char **) buts,0,1,_(&quot;The truetype instructions on glyph %s are out of date.\nDo you want to proceed anyway?&quot;), sc-&gt;name)==1 ) {</span>
<span class="lineNum">    1359 </span><span class="lineNoCov">          0 :                     CharViewCreate(sc,(FontView *) d-&gt;sf-&gt;fv,-1);</span>
<span class="lineNum">    1360 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1361 </span>            :                 } else
<span class="lineNum">    1362 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1363 </span>            :             }
<span class="lineNum">    1364 </span><span class="lineNoCov">          0 :             for ( ref=sc-&gt;layers[ly_fore].refs; ref!=NULL ; ref=ref-&gt;next )</span>
<span class="lineNum">    1365 </span><span class="lineNoCov">          0 :                 if ( ref-&gt;point_match_out_of_date &amp;&amp; ref-&gt;point_match ) {</span>
<span class="lineNum">    1366 </span><span class="lineNoCov">          0 :                     if ( gwwv_ask(_(&quot;Reference point match out of date&quot;),(const char **) buts,0,1,_(&quot;In glyph %s the reference to %s is positioned by point matching, and the point numbers may no longer reflect the original intent.\nDo you want to proceed anyway?&quot;), sc-&gt;name, ref-&gt;sc-&gt;name)==1 ) {</span>
<span class="lineNum">    1367 </span><span class="lineNoCov">          0 :                         CharViewCreate(sc,(FontView *) d-&gt;sf-&gt;fv,-1);</span>
<span class="lineNum">    1368 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1369 </span>            :                     } else
<span class="lineNum">    1370 </span><span class="lineNoCov">          0 :         goto end_of_loop;</span>
<span class="lineNum">    1371 </span>            :                 }
<span class="lineNum">    1372 </span>            :         }
<span class="lineNum">    1373 </span>            :         end_of_loop:;
<span class="lineNum">    1374 </span>            :     }
<span class="lineNum">    1375 </span>            : 
<span class="lineNum">    1376 </span><span class="lineNoCov">          0 :     if ( d-&gt;sf-&gt;os2_version==1 &amp;&amp; (oldformatstate&gt;=ff_otf &amp;&amp; oldformatstate&lt;=ff_otfciddfont)) {</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Bad OS/2 version&quot;), _(&quot;OpenType fonts must have a version greater than 1\nUse Element-&gt;Font Info-&gt;OS/2-&gt;Misc to change this.&quot;));</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1379 </span>            :     }
<span class="lineNum">    1380 </span>            : 
<span class="lineNum">    1381 </span><span class="lineNoCov">          0 :     likecff = 0;</span>
<span class="lineNum">    1382 </span><span class="lineNoCov">          0 :     if ( oldformatstate==ff_ttc ) {</span>
<span class="lineNum">    1383 </span><span class="lineNoCov">          0 :         likecff = GGadgetIsChecked(GWidgetGetControl(d-&gt;gw,CID_TTC_CFF));</span>
<span class="lineNum">    1384 </span>            :     }
<span class="lineNum">    1385 </span>            : 
<span class="lineNum">    1386 </span><span class="lineNoCov">          0 :     if ( likecff || oldformatstate&lt;=ff_cffcid ||</span>
<span class="lineNum">    1387 </span><span class="lineNoCov">          0 :             (oldformatstate&gt;=ff_otf &amp;&amp; oldformatstate&lt;=ff_otfciddfont)) {</span>
<span class="lineNum">    1388 </span><span class="lineNoCov">          0 :         if ( d-&gt;sf-&gt;ascent+d-&gt;sf-&gt;descent!=1000 &amp;&amp; !psscalewarned ) {</span>
<span class="lineNum">    1389 </span><span class="lineNoCov">          0 :             if ( gwwv_ask(_(&quot;Non-standard Em-Size&quot;),(const char **) buts,0,1,_(&quot;The convention is that PostScript fonts should have an Em-Size of 1000. But this font has a size of %d. This is not an error, but you might consider altering the Em-Size with the Element-&gt;Font Info-&gt;General dialog.\nDo you wish to continue to generate your font in spite of this?&quot;),</span>
<span class="lineNum">    1390 </span><span class="lineNoCov">          0 :                     d-&gt;sf-&gt;ascent+d-&gt;sf-&gt;descent)==1 )</span>
<span class="lineNum">    1391 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1392 </span><span class="lineNoCov">          0 :             psscalewarned = true;</span>
<span class="lineNum">    1393 </span>            :         }
<span class="lineNum">    1394 </span><span class="lineNoCov">          0 :         if ( (strlen(d-&gt;sf-&gt;fontname)&gt;31 || (d-&gt;sf-&gt;familyname!=NULL &amp;&amp; strlen(d-&gt;sf-&gt;familyname)&gt;31)) &amp;&amp; !psfnlenwarned ) {</span>
<span class="lineNum">    1395 </span><span class="lineNoCov">          0 :             if ( gwwv_ask(_(&quot;Bad Font Name&quot;),(const char **) buts,0,1,_(&quot;Some versions of Windows will refuse to install postscript fonts if the fontname is longer than 31 characters. Do you want to continue anyway?&quot;))==1 )</span>
<span class="lineNum">    1396 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1397 </span><span class="lineNoCov">          0 :             psfnlenwarned = true;</span>
<span class="lineNum">    1398 </span>            :         }
<span class="lineNum">    1399 </span><span class="lineNoCov">          0 :     } else if ( oldformatstate!=ff_none &amp;&amp; oldformatstate!=ff_svg &amp;&amp;</span>
<span class="lineNum">    1400 </span><span class="lineNoCov">          0 :             oldformatstate!=ff_ufo ) {</span>
<span class="lineNum">    1401 </span><span class="lineNoCov">          0 :         int val = d-&gt;sf-&gt;ascent+d-&gt;sf-&gt;descent;</span>
<span class="lineNum">    1402 </span>            :         int bit;
<span class="lineNum">    1403 </span><span class="lineNoCov">          0 :         for ( bit=0x800000; bit!=0; bit&gt;&gt;=1 )</span>
<span class="lineNum">    1404 </span><span class="lineNoCov">          0 :             if ( bit==val )</span>
<span class="lineNum">    1405 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1406 </span><span class="lineNoCov">          0 :         if ( bit==0 &amp;&amp; !ttfscalewarned ) {</span>
<span class="lineNum">    1407 </span><span class="lineNoCov">          0 :             if ( gwwv_ask(_(&quot;Non-standard Em-Size&quot;),(const char **) buts,0,1,_(&quot;The convention is that TrueType fonts should have an Em-Size which is a power of 2. But this font has a size of %d. This is not an error, but you might consider altering the Em-Size with the Element-&gt;Font Info-&gt;General dialog.\nDo you wish to continue to generate your font in spite of this?&quot;),val)==1 )</span>
<span class="lineNum">    1408 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1409 </span><span class="lineNoCov">          0 :             ttfscalewarned = true;</span>
<span class="lineNum">    1410 </span>            :         }
<span class="lineNum">    1411 </span>            :     }
<span class="lineNum">    1412 </span>            : 
<span class="lineNum">    1413 </span><span class="lineNoCov">          0 :     if ( oldformatstate==ff_ttfsym &amp;&amp; AlreadyMSSymbolArea(d-&gt;sf,d-&gt;map))</span>
<span class="lineNum">    1414 </span>            :         /* Don't complain */;
<span class="lineNum">    1415 </span><span class="lineNoCov">          0 :     else if ( ((oldformatstate&lt;ff_ptype0 &amp;&amp; oldformatstate!=ff_multiple) ||</span>
<span class="lineNum">    1416 </span><span class="lineNoCov">          0 :                 oldformatstate==ff_ttfsym || oldformatstate==ff_cff ) &amp;&amp;</span>
<span class="lineNum">    1417 </span><span class="lineNoCov">          0 :                 d-&gt;map-&gt;enc-&gt;has_2byte ) {</span>
<span class="lineNum">    1418 </span>            :         char *buts[3];
<span class="lineNum">    1419 </span><span class="lineNoCov">          0 :         buts[0] = _(&quot;_Yes&quot;);</span>
<span class="lineNum">    1420 </span><span class="lineNoCov">          0 :         buts[1] = _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    1421 </span><span class="lineNoCov">          0 :         buts[2] = NULL;</span>
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 :         if ( gwwv_ask(_(&quot;Encoding Too Large&quot;),(const char **) buts,0,1,_(&quot;Your font has a 2 byte encoding, but you are attempting to save it in a format that only supports one byte encodings. This means that you won't be able to access anything after the first 256 characters without reencoding the font.\n\nDo you want to proceed anyway?&quot;))==1 )</span>
<span class="lineNum">    1423 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1424 </span>            :     }
<span class="lineNum">    1425 </span>            : 
<span class="lineNum">    1426 </span><span class="lineNoCov">          0 :     oldbitmapstate = GGadgetGetFirstListSelectedItem(d-&gt;bmptype);</span>
<span class="lineNum">    1427 </span><span class="lineNoCov">          0 :     if ( oldbitmapstate!=bf_none )</span>
<span class="lineNum">    1428 </span><span class="lineNoCov">          0 :         sizes = ParseBitmapSizes(d-&gt;bmpsizes,_(&quot;Pixel List&quot;),&amp;err);</span>
<span class="lineNum">    1429 </span><span class="lineNoCov">          0 :     if ( err )</span>
<span class="lineNum">    1430 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1431 </span><span class="lineNoCov">          0 :     if ( oldbitmapstate==bf_nfntmacbin &amp;&amp; oldformatstate!=ff_pfbmacbin &amp;&amp; !nfnt_warned ) {</span>
<span class="lineNum">    1432 </span><span class="lineNoCov">          0 :         nfnt_warned = true;</span>
<span class="lineNum">    1433 </span><span class="lineNoCov">          0 :         ff_post_notice(_(&quot;The 'NFNT' bitmap format is obsolete&quot;),_(&quot;The 'NFNT' bitmap format is not used under OS/X (though you still need to create a (useless) bitmap font if you are saving a type1 PostScript resource)&quot;));</span>
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :     } else if ( oldformatstate==ff_pfbmacbin &amp;&amp;</span>
<span class="lineNum">    1435 </span><span class="lineNoCov">          0 :             (oldbitmapstate!=bf_nfntmacbin || sizes[0]==0)) {</span>
<span class="lineNum">    1436 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Needs bitmap font&quot;),_(&quot;When generating a Mac Type1 resource font, you MUST generate at least one NFNT bitmap font to go with it. If you have not created any bitmaps for this font, cancel this dlg and use the Element-&gt;Bitmaps Available command to create one&quot;));</span>
<span class="lineNum">    1437 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1438 </span><span class="lineNoCov">          0 :     } else if ( oldformatstate==ff_pfbmacbin &amp;&amp; !post_warned) {</span>
<span class="lineNum">    1439 </span><span class="lineNoCov">          0 :         post_warned = true;</span>
<span class="lineNum">    1440 </span><span class="lineNoCov">          0 :         ff_post_notice(_(&quot;The 'POST' type1 format is probably deprecated&quot;),_(&quot;The 'POST' type1 format is probably deprecated and may not work in future version of the mac.&quot;));</span>
<span class="lineNum">    1441 </span>            :     }
<span class="lineNum">    1442 </span>            : 
<span class="lineNum">    1443 </span><span class="lineNoCov">          0 :     if ( d-&gt;family ) {</span>
<span class="lineNum">    1444 </span><span class="lineNoCov">          0 :         cur = chunkalloc(sizeof(struct sflist));</span>
<span class="lineNum">    1445 </span><span class="lineNoCov">          0 :         cur-&gt;next = NULL;</span>
<span class="lineNum">    1446 </span><span class="lineNoCov">          0 :         sfs = last = cur;</span>
<span class="lineNum">    1447 </span><span class="lineNoCov">          0 :         cur-&gt;sf = d-&gt;sf;</span>
<span class="lineNum">    1448 </span><span class="lineNoCov">          0 :         cur-&gt;map = EncMapCopy(d-&gt;map);</span>
<span class="lineNum">    1449 </span><span class="lineNoCov">          0 :         cur-&gt;sizes = sizes;</span>
<span class="lineNum">    1450 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;d-&gt;familycnt; ++i ) {</span>
<span class="lineNum">    1451 </span><span class="lineNoCov">          0 :             if ( GGadgetIsChecked(GWidgetGetControl(d-&gt;gw,CID_Family+10*i)) ) {</span>
<span class="lineNum">    1452 </span><span class="lineNoCov">          0 :                 cur = chunkalloc(sizeof(struct sflist));</span>
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :                 last-&gt;next = cur;</span>
<span class="lineNum">    1454 </span><span class="lineNoCov">          0 :                 last = cur;</span>
<span class="lineNum">    1455 </span><span class="lineNoCov">          0 :                 cur-&gt;sf = GGadgetGetUserData(GWidgetGetControl(d-&gt;gw,CID_Family+10*i));</span>
<span class="lineNum">    1456 </span><span class="lineNoCov">          0 :                 if ( oldbitmapstate!=bf_none )</span>
<span class="lineNum">    1457 </span><span class="lineNoCov">          0 :                     cur-&gt;sizes = ParseBitmapSizes(GWidgetGetControl(d-&gt;gw,CID_Family+10*i+1),_(&quot;Pixel List&quot;),&amp;err);</span>
<span class="lineNum">    1458 </span><span class="lineNoCov">          0 :                 if ( err ) {</span>
<span class="lineNum">    1459 </span><span class="lineNoCov">          0 :                     SfListFree(sfs);</span>
<span class="lineNum">    1460 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1461 </span>            :                 }
<span class="lineNum">    1462 </span><span class="lineNoCov">          0 :                 cur-&gt;map = EncMapFromEncoding(cur-&gt;sf,d-&gt;map-&gt;enc);</span>
<span class="lineNum">    1463 </span>            :             }
<span class="lineNum">    1464 </span>            :         }
<span class="lineNum">    1465 </span><span class="lineNoCov">          0 :     } else if ( !d-&gt;sf-&gt;multilayer &amp;&amp; !d-&gt;sf-&gt;strokedfont &amp;&amp; !d-&gt;sf-&gt;onlybitmaps ) {</span>
<span class="lineNum">    1466 </span><span class="lineNoCov">          0 :         if ( oldformatstate == ff_ptype3 || oldformatstate == ff_none )</span>
<span class="lineNum">    1467 </span>            :             /* No point in validating type3 fonts */;
<span class="lineNum">    1468 </span><span class="lineNoCov">          0 :         else if ( (old_validate = GGadgetIsChecked(d-&gt;validate))) {</span>
<span class="lineNum">    1469 </span><span class="lineNoCov">          0 :             int vs = SFValidate(d-&gt;sf,layer,false);</span>
<span class="lineNum">    1470 </span><span class="lineNoCov">          0 :             int mask = VSMaskFromFormat(d-&gt;sf,layer,oldformatstate);</span>
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 :             int blues = ValidatePrivate(d-&gt;sf)&amp; ~pds_missingblue;</span>
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 :             if ( (vs&amp;mask) || blues!=0 ) {</span>
<span class="lineNum">    1473 </span>            :                 const char *rsb[3];
<span class="lineNum">    1474 </span>            :                 char *errs;
<span class="lineNum">    1475 </span>            :                 int ret;
<span class="lineNum">    1476 </span>            : 
<span class="lineNum">    1477 </span><span class="lineNoCov">          0 :                 rsb[0] =  _(&quot;_Review&quot;);</span>
<span class="lineNum">    1478 </span><span class="lineNoCov">          0 :                 rsb[1] =  _(&quot;_Generate&quot;);</span>
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 :                 rsb[2]=NULL;</span>
<span class="lineNum">    1480 </span><span class="lineNoCov">          0 :                 errs = VSErrorsFromMask(vs&amp;mask,blues);</span>
<span class="lineNum">    1481 </span><span class="lineNoCov">          0 :                 ret = gwwv_ask(_(&quot;Errors detected&quot;),rsb,0,0,_(&quot;The font contains errors.\n%sWould you like to review the errors or save the font anyway?&quot;),errs);</span>
<span class="lineNum">    1482 </span><span class="lineNoCov">          0 :                 free(errs);</span>
<span class="lineNum">    1483 </span><span class="lineNoCov">          0 :                 if ( ret==0 ) {</span>
<span class="lineNum">    1484 </span><span class="lineNoCov">          0 :                     d-&gt;done = true;</span>
<span class="lineNum">    1485 </span><span class="lineNoCov">          0 :                     d-&gt;ret = false;</span>
<span class="lineNum">    1486 </span><span class="lineNoCov">          0 :                     SFValidationWindow(d-&gt;sf,layer,oldformatstate);</span>
<span class="lineNum">    1487 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1488 </span>            :                 }
<span class="lineNum">    1489 </span>            :                 /* Ok... they want to proceed */
<span class="lineNum">    1490 </span>            :             }
<span class="lineNum">    1491 </span>            :         }
<span class="lineNum">    1492 </span>            :     }
<span class="lineNum">    1493 </span>            : 
<span class="lineNum">    1494 </span><span class="lineNoCov">          0 :     switch ( d-&gt;sod_which ) {</span>
<span class="lineNum">    1495 </span>            :       case 0:   /* PostScript */
<span class="lineNum">    1496 </span><span class="lineNoCov">          0 :         flags = old_ps_flags = d-&gt;ps_flags;</span>
<span class="lineNum">    1497 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1498 </span>            :       case 1:   /* TrueType */
<span class="lineNum">    1499 </span><span class="lineNoCov">          0 :         flags = old_sfnt_flags = d-&gt;sfnt_flags;</span>
<span class="lineNum">    1500 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1501 </span>            :       case 2:   /* OpenType */
<span class="lineNum">    1502 </span><span class="lineNoCov">          0 :         flags = old_sfnt_flags = d-&gt;sfnt_flags;</span>
<span class="lineNum">    1503 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1504 </span>            :       case 3:   /* PostScript &amp; OpenType bitmaps */
<span class="lineNum">    1505 </span><span class="lineNoCov">          0 :         old_ps_flags = d-&gt;ps_flags;</span>
<span class="lineNum">    1506 </span><span class="lineNoCov">          0 :         flags = old_psotb_flags = d-&gt;psotb_flags;</span>
<span class="lineNum">    1507 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1508 </span>            :     }
<span class="lineNum">    1509 </span>            : 
<span class="lineNum">    1510 </span><span class="lineNoCov">          0 :     former = NULL;</span>
<span class="lineNum">    1511 </span><span class="lineNoCov">          0 :     if ( d-&gt;family &amp;&amp; sfs!=NULL ) {</span>
<span class="lineNum">    1512 </span><span class="lineNoCov">          0 :         for ( sfl=sfs; sfl!=NULL; sfl=sfl-&gt;next ) {</span>
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 :             PrepareUnlinkRmOvrlp(sfl-&gt;sf,temp,layer);</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">          0 :             if ( rename_to!=NULL &amp;&amp; !iscid )</span>
<span class="lineNum">    1515 </span><span class="lineNoCov">          0 :                 sfl-&gt;former_names = SFTemporaryRenameGlyphsToNamelist(sfl-&gt;sf,rename_to);</span>
<span class="lineNum">    1516 </span>            :         }
<span class="lineNum">    1517 </span>            :     } else {
<span class="lineNum">    1518 </span><span class="lineNoCov">          0 :         PrepareUnlinkRmOvrlp(d-&gt;sf,temp,layer);</span>
<span class="lineNum">    1519 </span><span class="lineNoCov">          0 :         if ( rename_to!=NULL &amp;&amp; !iscid )</span>
<span class="lineNum">    1520 </span><span class="lineNoCov">          0 :             former = SFTemporaryRenameGlyphsToNamelist(d-&gt;sf,rename_to);</span>
<span class="lineNum">    1521 </span>            :     }
<span class="lineNum">    1522 </span>            : 
<span class="lineNum">    1523 </span><span class="lineNoCov">          0 :     if ( d-&gt;family==gf_none ) {</span>
<span class="lineNum">    1524 </span><span class="lineNoCov">          0 :         char *wernersfdname = NULL;</span>
<span class="lineNum">    1525 </span>            :         char *old_fontlog_contents;
<span class="lineNum">    1526 </span><span class="lineNoCov">          0 :         int res = -1;</span>
<span class="lineNum">    1527 </span><span class="lineNoCov">          0 :         if ( oldformatstate == ff_multiple )</span>
<span class="lineNum">    1528 </span><span class="lineNoCov">          0 :             wernersfdname = GetWernerSFDFile(d-&gt;sf,d-&gt;map);</span>
<span class="lineNum">    1529 </span><span class="lineNoCov">          0 :         if (( oldbitmapstate==bf_bdf || oldbitmapstate==bf_fnt ||</span>
<span class="lineNum">    1530 </span><span class="lineNoCov">          0 :                 oldbitmapstate==bf_fon ) &amp;&amp; ask_user_for_resolution ) {</span>
<span class="lineNum">    1531 </span><span class="lineNoCov">          0 :             ff_progress_pause_timer();</span>
<span class="lineNum">    1532 </span><span class="lineNoCov">          0 :             res = AskResolution(oldbitmapstate,d-&gt;sf-&gt;bitmaps);</span>
<span class="lineNum">    1533 </span><span class="lineNoCov">          0 :             ff_progress_resume_timer();</span>
<span class="lineNum">    1534 </span>            :         }
<span class="lineNum">    1535 </span><span class="lineNoCov">          0 :         old_fontlog = GGadgetIsChecked(GWidgetGetControl(d-&gt;gw,CID_AppendFontLog));</span>
<span class="lineNum">    1536 </span><span class="lineNoCov">          0 :         old_fontlog_contents = NULL;</span>
<span class="lineNum">    1537 </span><span class="lineNoCov">          0 :         if ( old_fontlog ) {</span>
<span class="lineNum">    1538 </span><span class="lineNoCov">          0 :             char *new = GGadgetGetTitle8(GWidgetGetControl(d-&gt;gw,CID_FontLogBit));</span>
<span class="lineNum">    1539 </span><span class="lineNoCov">          0 :             if ( new!=NULL &amp;&amp; *new!='\0' ) {</span>
<span class="lineNum">    1540 </span><span class="lineNoCov">          0 :                 old_fontlog_contents=d-&gt;sf-&gt;fontlog;</span>
<span class="lineNum">    1541 </span><span class="lineNoCov">          0 :                 if ( d-&gt;sf-&gt;fontlog==NULL )</span>
<span class="lineNum">    1542 </span><span class="lineNoCov">          0 :                     d-&gt;sf-&gt;fontlog = new;</span>
<span class="lineNum">    1543 </span>            :                 else {
<span class="lineNum">    1544 </span><span class="lineNoCov">          0 :                     d-&gt;sf-&gt;fontlog = strconcat3(d-&gt;sf-&gt;fontlog,&quot;\n\n&quot;,new);</span>
<span class="lineNum">    1545 </span><span class="lineNoCov">          0 :                     free(new);</span>
<span class="lineNum">    1546 </span>            :                 }
<span class="lineNum">    1547 </span><span class="lineNoCov">          0 :                 d-&gt;sf-&gt;changed = true;</span>
<span class="lineNum">    1548 </span>            :             }
<span class="lineNum">    1549 </span>            :         }
<span class="lineNum">    1550 </span><span class="lineNoCov">          0 :         if ( res!=-2 )</span>
<span class="lineNum">    1551 </span><span class="lineNoCov">          0 :             err = _DoSave(d-&gt;sf,temp,sizes,res,d-&gt;map, wernersfdname, layer );</span>
<span class="lineNum">    1552 </span><span class="lineNoCov">          0 :         if ( err &amp;&amp; old_fontlog ) {</span>
<span class="lineNum">    1553 </span><span class="lineNoCov">          0 :             free(d-&gt;sf-&gt;fontlog);</span>
<span class="lineNum">    1554 </span><span class="lineNoCov">          0 :             d-&gt;sf-&gt;fontlog = old_fontlog_contents;</span>
<span class="lineNum">    1555 </span>            :         } else
<span class="lineNum">    1556 </span><span class="lineNoCov">          0 :             free( old_fontlog_contents );</span>
<span class="lineNum">    1557 </span><span class="lineNoCov">          0 :         free(wernersfdname);</span>
<span class="lineNum">    1558 </span><span class="lineNoCov">          0 :     } else if ( d-&gt;family == gf_macfamily )</span>
<span class="lineNum">    1559 </span><span class="lineNoCov">          0 :         err = !WriteMacFamily(temp,sfs,oldformatstate,oldbitmapstate,flags,layer);</span>
<span class="lineNum">    1560 </span>            :     else {
<span class="lineNum">    1561 </span><span class="lineNoCov">          0 :         int ttcflags =</span>
<span class="lineNum">    1562 </span><span class="lineNoCov">          0 :             (GGadgetIsChecked(GWidgetGetControl(d-&gt;gw,CID_MergeTables))?ttc_flag_trymerge:0) |</span>
<span class="lineNum">    1563 </span><span class="lineNoCov">          0 :             (GGadgetIsChecked(GWidgetGetControl(d-&gt;gw,CID_TTC_CFF))?ttc_flag_cff:0);</span>
<span class="lineNum">    1564 </span><span class="lineNoCov">          0 :         err = !WriteTTC(temp,sfs,oldformatstate,oldbitmapstate,flags,layer,ttcflags);</span>
<span class="lineNum">    1565 </span>            :     }
<span class="lineNum">    1566 </span>            : 
<span class="lineNum">    1567 </span><span class="lineNoCov">          0 :     if ( d-&gt;family &amp;&amp; sfs!=NULL ) {</span>
<span class="lineNum">    1568 </span><span class="lineNoCov">          0 :         for ( sfl=sfs; sfl!=NULL; sfl=sfl-&gt;next ) {</span>
<span class="lineNum">    1569 </span><span class="lineNoCov">          0 :             RestoreUnlinkRmOvrlp(sfl-&gt;sf,temp,layer);</span>
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 :             if ( rename_to!=NULL &amp;&amp; !iscid )</span>
<span class="lineNum">    1571 </span><span class="lineNoCov">          0 :                 SFTemporaryRestoreGlyphNames(sfl-&gt;sf,sfl-&gt;former_names);</span>
<span class="lineNum">    1572 </span>            :         }
<span class="lineNum">    1573 </span>            :     } else {
<span class="lineNum">    1574 </span><span class="lineNoCov">          0 :         RestoreUnlinkRmOvrlp(d-&gt;sf,temp,layer);</span>
<span class="lineNum">    1575 </span><span class="lineNoCov">          0 :         if ( rename_to!=NULL &amp;&amp; !iscid )</span>
<span class="lineNum">    1576 </span><span class="lineNoCov">          0 :             SFTemporaryRestoreGlyphNames(d-&gt;sf,former);</span>
<span class="lineNum">    1577 </span>            :     }
<span class="lineNum">    1578 </span><span class="lineNoCov">          0 :     if ( !iscid )</span>
<span class="lineNum">    1579 </span><span class="lineNoCov">          0 :         force_names_when_saving = rename_to;</span>
<span class="lineNum">    1580 </span>            : 
<span class="lineNum">    1581 </span><span class="lineNoCov">          0 :     free(temp);</span>
<span class="lineNum">    1582 </span><span class="lineNoCov">          0 :     d-&gt;done = !err;</span>
<span class="lineNum">    1583 </span><span class="lineNoCov">          0 :     d-&gt;ret = !err;</span>
<a name="1584"><span class="lineNum">    1584 </span>            : }</a>
<span class="lineNum">    1585 </span>            : 
<span class="lineNum">    1586 </span><span class="lineNoCov">          0 : static void GFD_doesnt(GIOControl *gio) {</span>
<span class="lineNum">    1587 </span>            :     /* The filename the user chose doesn't exist, so everything is happy */
<span class="lineNum">    1588 </span><span class="lineNoCov">          0 :     struct gfc_data *d = gio-&gt;userdata;</span>
<span class="lineNum">    1589 </span><span class="lineNoCov">          0 :     DoSave(d,gio-&gt;path);</span>
<span class="lineNum">    1590 </span><span class="lineNoCov">          0 :     GFileChooserReplaceIO(d-&gt;gfc,NULL);</span>
<a name="1591"><span class="lineNum">    1591 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1592 </span>            : 
<span class="lineNum">    1593 </span><span class="lineNoCov">          0 : static void GFD_exists(GIOControl *gio) {</span>
<span class="lineNum">    1594 </span>            :     /* The filename the user chose exists, ask user if s/he wants to overwrite */
<span class="lineNum">    1595 </span><span class="lineNoCov">          0 :     struct gfc_data *d = gio-&gt;userdata;</span>
<span class="lineNum">    1596 </span>            :     char *temp;
<span class="lineNum">    1597 </span>            :     const char *rcb[3];
<span class="lineNum">    1598 </span>            : 
<span class="lineNum">    1599 </span><span class="lineNoCov">          0 :     rcb[2]=NULL;</span>
<span class="lineNum">    1600 </span><span class="lineNoCov">          0 :     rcb[0] =  _(&quot;_Replace&quot;);</span>
<span class="lineNum">    1601 </span><span class="lineNoCov">          0 :     rcb[1] =  _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    1602 </span>            : 
<span class="lineNum">    1603 </span><span class="lineNoCov">          0 :     if ( gwwv_ask(_(&quot;File Exists&quot;),rcb,0,1,_(&quot;File, %s, exists. Replace it?&quot;),</span>
<span class="lineNum">    1604 </span><span class="lineNoCov">          0 :             temp = u2utf8_copy(u_GFileNameTail(gio-&gt;path)))==0 ) {</span>
<span class="lineNum">    1605 </span><span class="lineNoCov">          0 :         DoSave(d,gio-&gt;path);</span>
<span class="lineNum">    1606 </span>            :     }
<span class="lineNum">    1607 </span><span class="lineNoCov">          0 :     free(temp);</span>
<span class="lineNum">    1608 </span><span class="lineNoCov">          0 :     GFileChooserReplaceIO(d-&gt;gfc,NULL);</span>
<a name="1609"><span class="lineNum">    1609 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1610 </span>            : 
<span class="lineNum">    1611 </span><span class="lineNoCov">          0 : static void _GFD_SaveOk(struct gfc_data *d) {</span>
<span class="lineNum">    1612 </span>            :     GGadget *tf;
<span class="lineNum">    1613 </span>            :     unichar_t *ret;
<span class="lineNum">    1614 </span><span class="lineNoCov">          0 :     int formatstate = GGadgetGetFirstListSelectedItem(d-&gt;pstype);</span>
<span class="lineNum">    1615 </span>            : 
<span class="lineNum">    1616 </span><span class="lineNoCov">          0 :     GFileChooserGetChildren(d-&gt;gfc,NULL,NULL,&amp;tf);</span>
<span class="lineNum">    1617 </span><span class="lineNoCov">          0 :     if ( *_GGadgetGetTitle(tf)!='\0' ) {</span>
<span class="lineNum">    1618 </span><span class="lineNoCov">          0 :         ret = GGadgetGetTitle(d-&gt;gfc);</span>
<span class="lineNum">    1619 </span><span class="lineNoCov">          0 :         if ( formatstate!=ff_none )     /* are we actually generating an outline font? */</span>
<span class="lineNum">    1620 </span><span class="lineNoCov">          0 :             GIOfileExists(GFileChooserReplaceIO(d-&gt;gfc,</span>
<span class="lineNum">    1621 </span><span class="lineNoCov">          0 :                     GIOCreate(ret,d,GFD_exists,GFD_doesnt)));</span>
<span class="lineNum">    1622 </span>            :         else
<span class="lineNum">    1623 </span><span class="lineNoCov">          0 :             GFD_doesnt(GIOCreate(ret,d,GFD_exists,GFD_doesnt)); /* No point in bugging the user if we aren't doing anything */</span>
<span class="lineNum">    1624 </span><span class="lineNoCov">          0 :         free(ret);</span>
<span class="lineNum">    1625 </span>            :     }
<a name="1626"><span class="lineNum">    1626 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1627 </span>            : 
<span class="lineNum">    1628 </span><span class="lineNoCov">          0 : static int GFD_SaveOk(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1629 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1630 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    1631 </span><span class="lineNoCov">          0 :         _GFD_SaveOk(d);</span>
<span class="lineNum">    1632 </span>            :     }
<span class="lineNum">    1633 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1634"><span class="lineNum">    1634 </span>            : }</a>
<span class="lineNum">    1635 </span>            : 
<span class="lineNum">    1636 </span><span class="lineNoCov">          0 : static int GFD_Cancel(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1637 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1638 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    1639 </span><span class="lineNoCov">          0 :         d-&gt;done = true;</span>
<span class="lineNum">    1640 </span><span class="lineNoCov">          0 :         d-&gt;ret = false;</span>
<span class="lineNum">    1641 </span>            :     }
<span class="lineNum">    1642 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1643"><span class="lineNum">    1643 </span>            : }</a>
<span class="lineNum">    1644 </span>            : 
<span class="lineNum">    1645 </span><span class="lineNoCov">          0 : static void GFD_FigureWhich(struct gfc_data *d) {</span>
<span class="lineNum">    1646 </span><span class="lineNoCov">          0 :     int fs = GGadgetGetFirstListSelectedItem(d-&gt;pstype);</span>
<span class="lineNum">    1647 </span><span class="lineNoCov">          0 :     int bf = GGadgetGetFirstListSelectedItem(d-&gt;bmptype);</span>
<span class="lineNum">    1648 </span>            :     int which;
<span class="lineNum">    1649 </span><span class="lineNoCov">          0 :     if ( fs==ff_none )</span>
<span class="lineNum">    1650 </span><span class="lineNoCov">          0 :         which = 1;              /* Some bitmaps get stuffed int ttf files */</span>
<span class="lineNum">    1651 </span><span class="lineNoCov">          0 :     else if ( fs&lt;=ff_cffcid )</span>
<span class="lineNum">    1652 </span><span class="lineNoCov">          0 :         which = 0;              /* PostScript options */</span>
<span class="lineNum">    1653 </span><span class="lineNoCov">          0 :     else if ( fs&lt;=ff_ttfdfont )</span>
<span class="lineNum">    1654 </span><span class="lineNoCov">          0 :         which = 1;              /* truetype options */ /* type42 also */</span>
<span class="lineNum">    1655 </span>            :     else
<span class="lineNum">    1656 </span><span class="lineNoCov">          0 :         which = 2;              /* opentype options */</span>
<span class="lineNum">    1657 </span><span class="lineNoCov">          0 :     if ( fs==ff_woff ) {</span>
<span class="lineNum">    1658 </span><span class="lineNoCov">          0 :         SplineFont *sf = d-&gt;sf;</span>
<span class="lineNum">    1659 </span><span class="lineNoCov">          0 :         int layer = d-&gt;layer;</span>
<span class="lineNum">    1660 </span><span class="lineNoCov">          0 :         if ( sf-&gt;layers[layer].order2 )</span>
<span class="lineNum">    1661 </span><span class="lineNoCov">          0 :             which = 1;                  /* truetype */</span>
<span class="lineNum">    1662 </span>            :         else
<span class="lineNum">    1663 </span><span class="lineNoCov">          0 :             which = 2;                  /* opentype */</span>
<span class="lineNum">    1664 </span>            :     }
<span class="lineNum">    1665 </span><span class="lineNoCov">          0 :     if ( bf == bf_otb &amp;&amp; which==0 )</span>
<span class="lineNum">    1666 </span><span class="lineNoCov">          0 :         which = 3;              /* postscript options with opentype bitmap options */</span>
<span class="lineNum">    1667 </span><span class="lineNoCov">          0 :     d-&gt;sod_which = which;</span>
<a name="1668"><span class="lineNum">    1668 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1669 </span>            : 
<span class="lineNum">    1670 </span><span class="lineNoCov">          0 : static int GFD_Options(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1671 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1672 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    1673 </span><span class="lineNoCov">          0 :         int fs = GGadgetGetFirstListSelectedItem(d-&gt;pstype);</span>
<span class="lineNum">    1674 </span><span class="lineNoCov">          0 :         int iscid = fs==ff_cid || fs==ff_cffcid || fs==ff_otfcid ||</span>
<span class="lineNum">    1675 </span><span class="lineNoCov">          0 :                 fs==ff_otfciddfont || fs==ff_type42cid;</span>
<span class="lineNum">    1676 </span><span class="lineNoCov">          0 :         GFD_FigureWhich(d);</span>
<span class="lineNum">    1677 </span><span class="lineNoCov">          0 :         SaveOptionsDlg(d,d-&gt;sod_which,iscid);</span>
<span class="lineNum">    1678 </span>            :     }
<span class="lineNum">    1679 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1680"><span class="lineNum">    1680 </span>            : }</a>
<span class="lineNum">    1681 </span>            : 
<span class="lineNum">    1682 </span><span class="lineNoCov">          0 : static void GFD_dircreated(GIOControl *gio) {</span>
<span class="lineNum">    1683 </span><span class="lineNoCov">          0 :     struct gfc_data *d = gio-&gt;userdata;</span>
<span class="lineNum">    1684 </span><span class="lineNoCov">          0 :     unichar_t *dir = u_copy(gio-&gt;path);</span>
<span class="lineNum">    1685 </span>            : 
<span class="lineNum">    1686 </span><span class="lineNoCov">          0 :     GFileChooserReplaceIO(d-&gt;gfc,NULL);</span>
<span class="lineNum">    1687 </span><span class="lineNoCov">          0 :     GFileChooserSetDir(d-&gt;gfc,dir);</span>
<span class="lineNum">    1688 </span><span class="lineNoCov">          0 :     free(dir);</span>
<a name="1689"><span class="lineNum">    1689 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1690 </span>            : 
<span class="lineNum">    1691 </span><span class="lineNoCov">          0 : static void GFD_dircreatefailed(GIOControl *gio) {</span>
<span class="lineNum">    1692 </span>            :     /* We couldn't create the directory */
<span class="lineNum">    1693 </span><span class="lineNoCov">          0 :     struct gfc_data *d = gio-&gt;userdata;</span>
<span class="lineNum">    1694 </span>            :     char *temp;
<span class="lineNum">    1695 </span>            : 
<span class="lineNum">    1696 </span><span class="lineNoCov">          0 :     ff_post_notice(_(&quot;Couldn't create directory&quot;),_(&quot;Couldn't create directory: %s&quot;),</span>
<span class="lineNum">    1697 </span><span class="lineNoCov">          0 :                 temp = u2utf8_copy(u_GFileNameTail(gio-&gt;path)));</span>
<span class="lineNum">    1698 </span><span class="lineNoCov">          0 :     free(temp);</span>
<span class="lineNum">    1699 </span><span class="lineNoCov">          0 :     GFileChooserReplaceIO(d-&gt;gfc,NULL);</span>
<a name="1700"><span class="lineNum">    1700 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1701 </span>            : 
<span class="lineNum">    1702 </span><span class="lineNoCov">          0 : static int GFD_NewDir(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1703 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1704 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    1705 </span>            :         char *newdir;
<span class="lineNum">    1706 </span>            :         unichar_t *temp;
<span class="lineNum">    1707 </span><span class="lineNoCov">          0 :         newdir = gwwv_ask_string(_(&quot;Create directory...&quot;),NULL,_(&quot;Directory name?&quot;));</span>
<span class="lineNum">    1708 </span><span class="lineNoCov">          0 :         if ( newdir==NULL )</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1710 </span><span class="lineNoCov">          0 :         if ( !GFileIsAbsolute(newdir)) {</span>
<span class="lineNum">    1711 </span><span class="lineNoCov">          0 :             char *olddir = u2utf8_copy(GFileChooserGetDir(d-&gt;gfc));</span>
<span class="lineNum">    1712 </span><span class="lineNoCov">          0 :             char *temp = GFileAppendFile(olddir,newdir,false);</span>
<span class="lineNum">    1713 </span><span class="lineNoCov">          0 :             free(newdir); free(olddir);</span>
<span class="lineNum">    1714 </span><span class="lineNoCov">          0 :             newdir = temp;</span>
<span class="lineNum">    1715 </span>            :         }
<span class="lineNum">    1716 </span><span class="lineNoCov">          0 :         temp = utf82u_copy(newdir);</span>
<span class="lineNum">    1717 </span><span class="lineNoCov">          0 :         GIOmkDir(GFileChooserReplaceIO(d-&gt;gfc,</span>
<span class="lineNum">    1718 </span><span class="lineNoCov">          0 :                 GIOCreate(temp,d,GFD_dircreated,GFD_dircreatefailed)));</span>
<span class="lineNum">    1719 </span><span class="lineNoCov">          0 :         free(newdir); free(temp);</span>
<span class="lineNum">    1720 </span>            :     }
<span class="lineNum">    1721 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1722"><span class="lineNum">    1722 </span>            : }</a>
<span class="lineNum">    1723 </span>            : 
<span class="lineNum">    1724 </span><span class="lineNoCov">          0 : static void BitmapName(struct gfc_data *d) {</span>
<span class="lineNum">    1725 </span><span class="lineNoCov">          0 :     int bf = GGadgetGetFirstListSelectedItem(d-&gt;bmptype);</span>
<span class="lineNum">    1726 </span><span class="lineNoCov">          0 :     int format = GGadgetGetFirstListSelectedItem(d-&gt;pstype);</span>
<span class="lineNum">    1727 </span>            : 
<span class="lineNum">    1728 </span><span class="lineNoCov">          0 :     if ( bf&lt;0 || format&lt;0 || format!=ff_none )</span>
<span class="lineNum">    1729 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1730 </span>            : 
<span class="lineNum">    1731 </span><span class="lineNoCov">          0 :     unichar_t *ret = GGadgetGetTitle(d-&gt;gfc);</span>
<span class="lineNum">    1732 </span>            :     unichar_t *dup, *pt, *tpt;
<span class="lineNum">    1733 </span>            : 
<span class="lineNum">    1734 </span><span class="lineNoCov">          0 :     dup = malloc((u_strlen(ret)+30)*sizeof(unichar_t));</span>
<span class="lineNum">    1735 </span><span class="lineNoCov">          0 :     u_strcpy(dup,ret);</span>
<span class="lineNum">    1736 </span><span class="lineNoCov">          0 :     free(ret);</span>
<span class="lineNum">    1737 </span><span class="lineNoCov">          0 :     pt = u_strrchr(dup,'.');</span>
<span class="lineNum">    1738 </span><span class="lineNoCov">          0 :     tpt = u_strrchr(dup,'/');</span>
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 :     if ( pt&lt;tpt )</span>
<span class="lineNum">    1740 </span><span class="lineNoCov">          0 :         pt = NULL;</span>
<span class="lineNum">    1741 </span><span class="lineNoCov">          0 :     if ( pt==NULL ) pt = dup+u_strlen(dup);</span>
<span class="lineNum">    1742 </span><span class="lineNoCov">          0 :     if ( uc_strcmp(pt-5, &quot;.bmap.bin&quot; )==0 ) pt -= 5;</span>
<span class="lineNum">    1743 </span><span class="lineNoCov">          0 :     if ( uc_strcmp(pt-4, &quot;.ttf.bin&quot; )==0 ) pt -= 4;</span>
<span class="lineNum">    1744 </span><span class="lineNoCov">          0 :     if ( uc_strcmp(pt-4, &quot;.otf.dfont&quot; )==0 ) pt -= 4;</span>
<span class="lineNum">    1745 </span><span class="lineNoCov">          0 :     if ( uc_strncmp(pt-2, &quot;%s&quot;, 2 )==0 ) pt -= 2;</span>
<span class="lineNum">    1746 </span><span class="lineNoCov">          0 :     if ( uc_strncmp(pt-2, &quot;-*&quot;, 2 )==0 ) pt -= 2;</span>
<span class="lineNum">    1747 </span><span class="lineNoCov">          0 :     uc_strcpy(pt,bitmapextensions[bf]);</span>
<span class="lineNum">    1748 </span><span class="lineNoCov">          0 :     GGadgetSetTitle(d-&gt;gfc,dup);</span>
<span class="lineNum">    1749 </span><span class="lineNoCov">          0 :     free(dup);</span>
<a name="1750"><span class="lineNum">    1750 </span>            : }</a>
<span class="lineNum">    1751 </span>            : 
<span class="lineNum">    1752 </span><span class="lineNoCov">          0 : static int GFD_Format(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1753 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_listselected ) {</span>
<span class="lineNum">    1754 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    1755 </span>            :         unichar_t *pt, *dup, *tpt, *ret;
<span class="lineNum">    1756 </span><span class="lineNoCov">          0 :         int format = GGadgetGetFirstListSelectedItem(d-&gt;pstype);</span>
<span class="lineNum">    1757 </span>            :         int32 len; int bf;
<span class="lineNum">    1758 </span>            :         static unichar_t nullstr[] = { 0 };
<span class="lineNum">    1759 </span>            :         GTextInfo **list;
<span class="lineNum">    1760 </span>            :         SplineFont *temp;
<span class="lineNum">    1761 </span>            : 
<span class="lineNum">    1762 </span><span class="lineNoCov">          0 :         list = GGadgetGetList(d-&gt;bmptype,&amp;len);</span>
<span class="lineNum">    1763 </span><span class="lineNoCov">          0 :         temp = d-&gt;sf-&gt;cidmaster ? d-&gt;sf-&gt;cidmaster : d-&gt;sf;</span>
<span class="lineNum">    1764 </span><span class="lineNoCov">          0 :         if ( format==ff_none ) {</span>
<span class="lineNum">    1765 </span><span class="lineNoCov">          0 :             if ( temp-&gt;bitmaps!=NULL ) {</span>
<span class="lineNum">    1766 </span><span class="lineNoCov">          0 :                 list[bf_sfnt_dfont]-&gt;disabled = false;</span>
<span class="lineNum">    1767 </span><span class="lineNoCov">          0 :                 list[bf_sfnt_ms]-&gt;disabled = false;</span>
<span class="lineNum">    1768 </span><span class="lineNoCov">          0 :                 list[bf_otb]-&gt;disabled = false;</span>
<span class="lineNum">    1769 </span><span class="lineNoCov">          0 :                 list[bf_ttf]-&gt;disabled = true;</span>
<span class="lineNum">    1770 </span>            :             }
<span class="lineNum">    1771 </span><span class="lineNoCov">          0 :             BitmapName(d);</span>
<span class="lineNum">    1772 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1773 </span>            :         }
<span class="lineNum">    1774 </span>            : 
<span class="lineNum">    1775 </span><span class="lineNoCov">          0 :         ret = GGadgetGetTitle(d-&gt;gfc);</span>
<span class="lineNum">    1776 </span><span class="lineNoCov">          0 :         dup = malloc((u_strlen(ret)+30)*sizeof(unichar_t));</span>
<span class="lineNum">    1777 </span><span class="lineNoCov">          0 :         u_strcpy(dup,ret);</span>
<span class="lineNum">    1778 </span><span class="lineNoCov">          0 :         free(ret);</span>
<span class="lineNum">    1779 </span><span class="lineNoCov">          0 :         pt = u_strrchr(dup,'.');</span>
<span class="lineNum">    1780 </span><span class="lineNoCov">          0 :         tpt = u_strrchr(dup,'/');</span>
<span class="lineNum">    1781 </span><span class="lineNoCov">          0 :         if ( pt&lt;tpt )</span>
<span class="lineNum">    1782 </span><span class="lineNoCov">          0 :             pt = NULL;</span>
<span class="lineNum">    1783 </span><span class="lineNoCov">          0 :         if ( pt==NULL ) pt = dup+u_strlen(dup);</span>
<span class="lineNum">    1784 </span><span class="lineNoCov">          0 :         if ( uc_strcmp(pt-5, &quot;.bmap.bin&quot; )==0 ) pt -= 5;</span>
<span class="lineNum">    1785 </span><span class="lineNoCov">          0 :         if ( uc_strcmp(pt-4, &quot;.ttf.bin&quot; )==0 ) pt -= 4;</span>
<span class="lineNum">    1786 </span><span class="lineNoCov">          0 :         if ( uc_strcmp(pt-4, &quot;.otf.dfont&quot; )==0 ) pt -= 4;</span>
<span class="lineNum">    1787 </span><span class="lineNoCov">          0 :         if ( uc_strcmp(pt-4, &quot;.cid.t42&quot; )==0 ) pt -= 4;</span>
<span class="lineNum">    1788 </span><span class="lineNoCov">          0 :         if ( uc_strncmp(pt-2, &quot;%s&quot;, 2 )==0 ) pt -= 2;</span>
<span class="lineNum">    1789 </span><span class="lineNoCov">          0 :         if ( uc_strncmp(pt-2, &quot;-*&quot;, 2 )==0 ) pt -= 2;</span>
<span class="lineNum">    1790 </span><span class="lineNoCov">          0 :         uc_strcpy(pt,savefont_extensions[format]);</span>
<span class="lineNum">    1791 </span><span class="lineNoCov">          0 :         GGadgetSetTitle(d-&gt;gfc,dup);</span>
<span class="lineNum">    1792 </span><span class="lineNoCov">          0 :         free(dup);</span>
<span class="lineNum">    1793 </span>            : 
<span class="lineNum">    1794 </span><span class="lineNoCov">          0 :         if ( d-&gt;sf-&gt;cidmaster!=NULL ) {</span>
<span class="lineNum">    1795 </span><span class="lineNoCov">          0 :             if ( format!=ff_none &amp;&amp; format != ff_cid &amp;&amp; format != ff_cffcid &amp;&amp;</span>
<span class="lineNum">    1796 </span><span class="lineNoCov">          0 :                     format != ff_otfcid &amp;&amp; format!=ff_otfciddfont ) {</span>
<span class="lineNum">    1797 </span><span class="lineNoCov">          0 :                 GGadgetSetTitle(d-&gt;bmpsizes,nullstr);</span>
<span class="lineNum">    1798 </span>            :             }
<span class="lineNum">    1799 </span>            :         }
<span class="lineNum">    1800 </span>            : 
<span class="lineNum">    1801 </span><span class="lineNoCov">          0 :         bf = GGadgetGetFirstListSelectedItem(d-&gt;bmptype);</span>
<span class="lineNum">    1802 </span><span class="lineNoCov">          0 :         list[bf_sfnt_dfont]-&gt;disabled = true;</span>
<span class="lineNum">    1803 </span><span class="lineNoCov">          0 :         if ( temp-&gt;bitmaps==NULL )</span>
<span class="lineNum">    1804 </span>            :             /* Don't worry about what formats are possible, they're disabled */;
<span class="lineNum">    1805 </span><span class="lineNoCov">          0 :         else if ( format!=ff_ttf &amp;&amp; format!=ff_ttfsym &amp;&amp; format!=ff_otf &amp;&amp;</span>
<span class="lineNum">    1806 </span><span class="lineNoCov">          0 :                 format!=ff_ttfdfont &amp;&amp; format!=ff_otfdfont &amp;&amp; format!=ff_otfciddfont &amp;&amp;</span>
<span class="lineNum">    1807 </span><span class="lineNoCov">          0 :                 format!=ff_otfcid &amp;&amp; format!=ff_ttfmacbin &amp;&amp; format!=ff_none ) {</span>
<span class="lineNum">    1808 </span>            :             /* If we're not in a ttf format then we can't output ttf bitmaps */
<span class="lineNum">    1809 </span><span class="lineNoCov">          0 :             list[bf_ttf]-&gt;disabled = true;</span>
<span class="lineNum">    1810 </span><span class="lineNoCov">          0 :             list[bf_sfnt_dfont]-&gt;disabled = false;</span>
<span class="lineNum">    1811 </span><span class="lineNoCov">          0 :             list[bf_sfnt_ms]-&gt;disabled = false;</span>
<span class="lineNum">    1812 </span><span class="lineNoCov">          0 :             list[bf_otb]-&gt;disabled = false;</span>
<span class="lineNum">    1813 </span><span class="lineNoCov">          0 :             if ( bf==bf_ttf )</span>
<span class="lineNum">    1814 </span><span class="lineNoCov">          0 :                 GGadgetSelectOneListItem(d-&gt;bmptype,bf_otb);</span>
<span class="lineNum">    1815 </span><span class="lineNoCov">          0 :             if ( format==ff_pfbmacbin )</span>
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 :                 GGadgetSelectOneListItem(d-&gt;bmptype,bf_nfntmacbin);</span>
<span class="lineNum">    1817 </span><span class="lineNoCov">          0 :             bf = GGadgetGetFirstListSelectedItem(d-&gt;bmptype);</span>
<span class="lineNum">    1818 </span><span class="lineNoCov">          0 :             GGadgetSetEnabled(d-&gt;bmpsizes, format!=ff_multiple &amp;&amp; bf!=bf_none );     /* We know there are bitmaps */</span>
<span class="lineNum">    1819 </span>            :         } else {
<span class="lineNum">    1820 </span><span class="lineNoCov">          0 :             list[bf_ttf]-&gt;disabled = false;</span>
<span class="lineNum">    1821 </span><span class="lineNoCov">          0 :             list[bf_sfnt_dfont]-&gt;disabled = true;</span>
<span class="lineNum">    1822 </span><span class="lineNoCov">          0 :             list[bf_sfnt_ms]-&gt;disabled = true;</span>
<span class="lineNum">    1823 </span><span class="lineNoCov">          0 :             list[bf_otb]-&gt;disabled = true;</span>
<span class="lineNum">    1824 </span><span class="lineNoCov">          0 :             if ( bf==bf_none )</span>
<span class="lineNum">    1825 </span>            :                 /* Do nothing, always appropriate */;
<span class="lineNum">    1826 </span><span class="lineNoCov">          0 :             else if ( format==ff_ttf || format==ff_ttfsym || format==ff_otf ||</span>
<span class="lineNum">    1827 </span><span class="lineNoCov">          0 :                     format==ff_otfcid ||</span>
<span class="lineNum">    1828 </span><span class="lineNoCov">          0 :                     bf==bf_sfnt_dfont || bf == bf_sfnt_ms || bf == bf_otb )</span>
<span class="lineNum">    1829 </span><span class="lineNoCov">          0 :                 GGadgetSelectOneListItem(d-&gt;bmptype,bf_ttf);</span>
<span class="lineNum">    1830 </span>            :         }
<span class="lineNum">    1831 </span>            : #if __Mac
<span class="lineNum">    1832 </span>            :         { GGadget *pulldown, *list, *tf;
<span class="lineNum">    1833 </span>            :             /* The name of the postscript file is fixed and depends solely on */
<span class="lineNum">    1834 </span>            :             /*  the font name. If the user tried to change it, the font would */
<span class="lineNum">    1835 </span>            :             /*  not be found */
<span class="lineNum">    1836 </span>            :             /* See MakeMacPSName for a full description */
<span class="lineNum">    1837 </span>            :             GFileChooserGetChildren(d-&gt;gfc,&amp;pulldown,&amp;list,&amp;tf);
<span class="lineNum">    1838 </span>            :             GGadgetSetVisible(tf,format!=ff_pfbmacbin);
<span class="lineNum">    1839 </span>            :         }
<span class="lineNum">    1840 </span>            : #endif
<span class="lineNum">    1841 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(d-&gt;bmptype, format!=ff_multiple );</span>
<span class="lineNum">    1842 </span>            :     }
<span class="lineNum">    1843 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1844"><span class="lineNum">    1844 </span>            : }</a>
<span class="lineNum">    1845 </span>            : 
<span class="lineNum">    1846 </span><span class="lineNoCov">          0 : static int GFD_BitmapFormat(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1847 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_listselected ) {</span>
<span class="lineNum">    1848 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    1849 </span>            :         /*int format = GGadgetGetFirstListSelectedItem(d-&gt;pstype);*/
<span class="lineNum">    1850 </span><span class="lineNoCov">          0 :         int bf = GGadgetGetFirstListSelectedItem(d-&gt;bmptype);</span>
<span class="lineNum">    1851 </span>            :         int i;
<span class="lineNum">    1852 </span>            : 
<span class="lineNum">    1853 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(d-&gt;bmpsizes,bf!=bf_none);</span>
<span class="lineNum">    1854 </span><span class="lineNoCov">          0 :         if ( d-&gt;family ) {</span>
<span class="lineNum">    1855 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;d-&gt;familycnt; ++i )</span>
<span class="lineNum">    1856 </span><span class="lineNoCov">          0 :                 GGadgetSetEnabled(GWidgetGetControl(d-&gt;gw,CID_Family+10*i+1),</span>
<span class="lineNum">    1857 </span>            :                         bf!=bf_none);
<span class="lineNum">    1858 </span>            :         }
<span class="lineNum">    1859 </span><span class="lineNoCov">          0 :         BitmapName(d);</span>
<span class="lineNum">    1860 </span>            :     }
<span class="lineNum">    1861 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1862"><span class="lineNum">    1862 </span>            : }</a>
<span class="lineNum">    1863 </span>            : 
<span class="lineNum">    1864 </span><span class="lineNoCov">          0 : static int GFD_TogglePrependTimestamp(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1865 </span><span class="lineNoCov">          0 :   if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">    1866 </span><span class="lineNoCov">          0 :     will_prepend_timestamp = GGadgetIsChecked(g);</span>
<span class="lineNum">    1867 </span>            :   }
<span class="lineNum">    1868 </span><span class="lineNoCov">          0 :   return( true );</span>
<a name="1869"><span class="lineNum">    1869 </span>            : }</a>
<span class="lineNum">    1870 </span>            : 
<span class="lineNum">    1871 </span><span class="lineNoCov">          0 : static int GFD_ToggleFontLog(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1872 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">    1873 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    1874 </span>            :         static int cids[] = {
<span class="lineNum">    1875 </span>            :             CID_FontLogBit,
<span class="lineNum">    1876 </span>            :             0 };
<span class="lineNum">    1877 </span><span class="lineNoCov">          0 :         int i, visible = GGadgetIsChecked(g);</span>
<span class="lineNum">    1878 </span>            : 
<span class="lineNum">    1879 </span><span class="lineNoCov">          0 :         for ( i=0; cids[i]!=0; ++i )</span>
<span class="lineNum">    1880 </span><span class="lineNoCov">          0 :             GGadgetSetVisible(GWidgetGetControl(d-&gt;gw,cids[i]),visible);</span>
<span class="lineNum">    1881 </span>            : 
<span class="lineNum">    1882 </span><span class="lineNoCov">          0 :         GWidgetToDesiredSize(d-&gt;gw);</span>
<span class="lineNum">    1883 </span>            :     }
<span class="lineNum">    1884 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1885"><span class="lineNum">    1885 </span>            : }</a>
<span class="lineNum">    1886 </span>            : 
<span class="lineNum">    1887 </span><span class="lineNoCov">          0 : static int e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    1888 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">    1889 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(gw);</span>
<span class="lineNum">    1890 </span><span class="lineNoCov">          0 :         d-&gt;done = true;</span>
<span class="lineNum">    1891 </span><span class="lineNoCov">          0 :         d-&gt;ret = false;</span>
<span class="lineNum">    1892 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_char ) {</span>
<span class="lineNum">    1893 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.keysym == GK_F1 || event-&gt;u.chr.keysym == GK_Help ) {</span>
<span class="lineNum">    1894 </span><span class="lineNoCov">          0 :             help(&quot;generate.html&quot;);</span>
<span class="lineNum">    1895 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1896 </span><span class="lineNoCov">          0 :         } else if ( (event-&gt;u.chr.keysym=='s' || event-&gt;u.chr.keysym=='g' ||</span>
<span class="lineNum">    1897 </span><span class="lineNoCov">          0 :                 event-&gt;u.chr.keysym=='G' ) &amp;&amp;</span>
<span class="lineNum">    1898 </span><span class="lineNoCov">          0 :                 (event-&gt;u.chr.state&amp;ksm_control) ) {</span>
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :             _GFD_SaveOk(GDrawGetUserData(gw));</span>
<span class="lineNum">    1900 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1901 </span>            :         }
<span class="lineNum">    1902 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1903 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_mousemove ||</span>
<span class="lineNum">    1904 </span><span class="lineNoCov">          0 :             (event-&gt;type==et_mousedown &amp;&amp; event-&gt;u.mouse.button==3 )) {</span>
<span class="lineNum">    1905 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(gw);</span>
<span class="lineNum">    1906 </span><span class="lineNoCov">          0 :         if ( !GGadgetWithin(d-&gt;gfc,event-&gt;u.mouse.x,event-&gt;u.mouse.y))</span>
<span class="lineNum">    1907 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1908 </span><span class="lineNoCov">          0 :         GFileChooserPopupCheck(d-&gt;gfc,event);</span>
<span class="lineNum">    1909 </span><span class="lineNoCov">          0 :     } else if (( event-&gt;type==et_mouseup || event-&gt;type==et_mousedown ) &amp;&amp;</span>
<span class="lineNum">    1910 </span><span class="lineNoCov">          0 :             (event-&gt;u.mouse.button&gt;=4 &amp;&amp; event-&gt;u.mouse.button&lt;=7) ) {</span>
<span class="lineNum">    1911 </span><span class="lineNoCov">          0 :         struct gfc_data *d = GDrawGetUserData(gw);</span>
<span class="lineNum">    1912 </span><span class="lineNoCov">          0 : return( GGadgetDispatchEvent((GGadget *) (d-&gt;gfc),event));</span>
<span class="lineNum">    1913 </span>            :     }
<span class="lineNum">    1914 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1915"><span class="lineNum">    1915 </span>            : }</a>
<span class="lineNum">    1916 </span>            : 
<span class="lineNum">    1917 </span><span class="lineNoCov">          0 : static unichar_t *BitmapList(SplineFont *sf) {</span>
<span class="lineNum">    1918 </span>            :     BDFFont *bdf;
<span class="lineNum">    1919 </span>            :     int i;
<span class="lineNum">    1920 </span>            :     char *cret, *pt;
<span class="lineNum">    1921 </span>            :     unichar_t *uret;
<span class="lineNum">    1922 </span>            : 
<span class="lineNum">    1923 </span><span class="lineNoCov">          0 :     for ( bdf=sf-&gt;bitmaps, i=0; bdf!=NULL; bdf=bdf-&gt;next, ++i );</span>
<span class="lineNum">    1924 </span><span class="lineNoCov">          0 :     pt = cret = malloc((i+1)*20);</span>
<span class="lineNum">    1925 </span><span class="lineNoCov">          0 :     for ( bdf=sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">    1926 </span><span class="lineNoCov">          0 :         if ( pt!=cret ) *pt++ = ',';</span>
<span class="lineNum">    1927 </span><span class="lineNoCov">          0 :         if ( bdf-&gt;clut==NULL )</span>
<span class="lineNum">    1928 </span><span class="lineNoCov">          0 :             sprintf( pt, &quot;%d&quot;, bdf-&gt;pixelsize );</span>
<span class="lineNum">    1929 </span>            :         else
<span class="lineNum">    1930 </span><span class="lineNoCov">          0 :             sprintf( pt, &quot;%d@%d&quot;, bdf-&gt;pixelsize, BDFDepth(bdf) );</span>
<span class="lineNum">    1931 </span><span class="lineNoCov">          0 :         pt += strlen(pt);</span>
<span class="lineNum">    1932 </span>            :     }
<span class="lineNum">    1933 </span><span class="lineNoCov">          0 :     *pt = '\0';</span>
<span class="lineNum">    1934 </span><span class="lineNoCov">          0 :     uret = uc_copy(cret);</span>
<span class="lineNum">    1935 </span><span class="lineNoCov">          0 :     free(cret);</span>
<span class="lineNum">    1936 </span><span class="lineNoCov">          0 : return( uret );</span>
<a name="1937"><span class="lineNum">    1937 </span>            : }</a>
<span class="lineNum">    1938 </span>            : 
<span class="lineNum">    1939 </span><span class="lineNoCov">          0 : static unichar_t *uStyleName(SplineFont *sf) {</span>
<span class="lineNum">    1940 </span><span class="lineNoCov">          0 :     int stylecode = MacStyleCode(sf,NULL);</span>
<span class="lineNum">    1941 </span>            :     char buffer[200];
<span class="lineNum">    1942 </span>            : 
<span class="lineNum">    1943 </span><span class="lineNoCov">          0 :     buffer[0]='\0';</span>
<span class="lineNum">    1944 </span><span class="lineNoCov">          0 :     if ( stylecode&amp;sf_bold )</span>
<span class="lineNum">    1945 </span><span class="lineNoCov">          0 :         strcpy(buffer,&quot; Bold&quot;);</span>
<span class="lineNum">    1946 </span><span class="lineNoCov">          0 :     if ( stylecode&amp;sf_italic )</span>
<span class="lineNum">    1947 </span><span class="lineNoCov">          0 :         strcat(buffer,&quot; Italic&quot;);</span>
<span class="lineNum">    1948 </span><span class="lineNoCov">          0 :     if ( stylecode&amp;sf_outline )</span>
<span class="lineNum">    1949 </span><span class="lineNoCov">          0 :         strcat(buffer,&quot; Outline&quot;);</span>
<span class="lineNum">    1950 </span><span class="lineNoCov">          0 :     if ( stylecode&amp;sf_shadow )</span>
<span class="lineNum">    1951 </span><span class="lineNoCov">          0 :         strcat(buffer,&quot; Shadow&quot;);</span>
<span class="lineNum">    1952 </span><span class="lineNoCov">          0 :     if ( stylecode&amp;sf_condense )</span>
<span class="lineNum">    1953 </span><span class="lineNoCov">          0 :         strcat(buffer,&quot; Condensed&quot;);</span>
<span class="lineNum">    1954 </span><span class="lineNoCov">          0 :     if ( stylecode&amp;sf_extend )</span>
<span class="lineNum">    1955 </span><span class="lineNoCov">          0 :         strcat(buffer,&quot; Extended&quot;);</span>
<span class="lineNum">    1956 </span><span class="lineNoCov">          0 :     if ( buffer[0]=='\0' )</span>
<span class="lineNum">    1957 </span><span class="lineNoCov">          0 :         strcpy(buffer,&quot; Plain&quot;);</span>
<span class="lineNum">    1958 </span><span class="lineNoCov">          0 : return( uc_copy(buffer+1));</span>
<a name="1959"><span class="lineNum">    1959 </span>            : }</a>
<span class="lineNum">    1960 </span>            : 
<span class="lineNum">    1961 </span><span class="lineNoCov">          0 : static GTextInfo *SFUsableLayerNames(SplineFont *sf,int def_layer) {</span>
<span class="lineNum">    1962 </span><span class="lineNoCov">          0 :     int gid, layer, cnt = 1, k, known;</span>
<span class="lineNum">    1963 </span>            :     SplineFont *_sf;
<span class="lineNum">    1964 </span>            :     SplineChar *sc;
<span class="lineNum">    1965 </span>            :     GTextInfo *ti;
<span class="lineNum">    1966 </span>            : 
<span class="lineNum">    1967 </span><span class="lineNoCov">          0 :     for ( layer=0; layer&lt;sf-&gt;layer_cnt; ++layer )</span>
<span class="lineNum">    1968 </span><span class="lineNoCov">          0 :         sf-&gt;layers[layer].ticked = false;</span>
<span class="lineNum">    1969 </span><span class="lineNoCov">          0 :     sf-&gt;layers[ly_fore].ticked = true;</span>
<span class="lineNum">    1970 </span><span class="lineNoCov">          0 :     for ( layer=0; layer&lt;sf-&gt;layer_cnt; ++layer ) if ( !sf-&gt;layers[layer].background ) {</span>
<span class="lineNum">    1971 </span><span class="lineNoCov">          0 :         known = -1;</span>
<span class="lineNum">    1972 </span><span class="lineNoCov">          0 :         k = 0;</span>
<span class="lineNum">    1973 </span>            :         do {
<span class="lineNum">    1974 </span><span class="lineNoCov">          0 :             _sf = sf-&gt;subfontcnt==0 ? sf : sf-&gt;subfonts[k];</span>
<span class="lineNum">    1975 </span><span class="lineNoCov">          0 :             for ( gid = 0; gid&lt;_sf-&gt;glyphcnt; ++gid ) if ( (sc=_sf-&gt;glyphs[gid])!=NULL ) {</span>
<span class="lineNum">    1976 </span><span class="lineNoCov">          0 :                 if ( sc-&gt;layers[layer].images!=NULL ) {</span>
<span class="lineNum">    1977 </span><span class="lineNoCov">          0 :                     known = 0;</span>
<span class="lineNum">    1978 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1979 </span>            :                 }
<span class="lineNum">    1980 </span><span class="lineNoCov">          0 :                 if ( sc-&gt;layers[layer].splines!=NULL )</span>
<span class="lineNum">    1981 </span><span class="lineNoCov">          0 :                     known = 1;</span>
<span class="lineNum">    1982 </span>            :             }
<span class="lineNum">    1983 </span><span class="lineNoCov">          0 :             ++k;</span>
<span class="lineNum">    1984 </span><span class="lineNoCov">          0 :         } while ( known!=0 &amp;&amp; k&lt;sf-&gt;subfontcnt );</span>
<span class="lineNum">    1985 </span><span class="lineNoCov">          0 :         if ( known == 1 ) {</span>
<span class="lineNum">    1986 </span><span class="lineNoCov">          0 :             sf-&gt;layers[layer].ticked = true;</span>
<span class="lineNum">    1987 </span><span class="lineNoCov">          0 :             ++cnt;</span>
<span class="lineNum">    1988 </span><span class="lineNoCov">          0 :         } else if ( layer==def_layer )</span>
<span class="lineNum">    1989 </span><span class="lineNoCov">          0 :             def_layer = ly_fore;</span>
<span class="lineNum">    1990 </span>            :     }
<span class="lineNum">    1991 </span>            : 
<span class="lineNum">    1992 </span><span class="lineNoCov">          0 :     ti = calloc(cnt+1,sizeof(GTextInfo));</span>
<span class="lineNum">    1993 </span><span class="lineNoCov">          0 :     cnt=0;</span>
<span class="lineNum">    1994 </span><span class="lineNoCov">          0 :     for ( layer=0; layer&lt;sf-&gt;layer_cnt; ++layer ) if ( sf-&gt;layers[layer].ticked ) {</span>
<span class="lineNum">    1995 </span><span class="lineNoCov">          0 :         ti[cnt].text = (unichar_t *) sf-&gt;layers[layer].name;</span>
<span class="lineNum">    1996 </span><span class="lineNoCov">          0 :         ti[cnt].text_is_1byte = true;</span>
<span class="lineNum">    1997 </span><span class="lineNoCov">          0 :         ti[cnt].selected = layer==def_layer;</span>
<span class="lineNum">    1998 </span><span class="lineNoCov">          0 :         ti[cnt++].userdata = (void *) (intpt) layer;</span>
<span class="lineNum">    1999 </span>            :     }
<span class="lineNum">    2000 </span><span class="lineNoCov">          0 : return( ti );</span>
<span class="lineNum">    2001 </span>            : }
<span class="lineNum">    2002 </span>            : 
<a name="2003"><span class="lineNum">    2003 </span>            : typedef SplineFont *SFArray[48];</a>
<span class="lineNum">    2004 </span>            : 
<span class="lineNum">    2005 </span><span class="lineNoCov">          0 : int SFGenerateFont(SplineFont *sf,int layer,int family,EncMap *map) {</span>
<span class="lineNum">    2006 </span>            :     GRect pos;
<span class="lineNum">    2007 </span>            :     GWindow gw;
<span class="lineNum">    2008 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    2009 </span>            :     GGadgetCreateData gcd[20+2*48+5+1], *varray[13], *hvarray[33], *famarray[3*52+1],
<span class="lineNum">    2010 </span>            :             *harray[10], boxes[7];
<span class="lineNum">    2011 </span>            :     GTextInfo label[20+2*48+4+1];
<span class="lineNum">    2012 </span>            :     struct gfc_data d;
<span class="lineNum">    2013 </span>            :     GGadget *pulldown, *files, *tf;
<span class="lineNum">    2014 </span>            :     int hvi, i, j, k, f, old, ofs, y, fc, dupfc, dupstyle, rk, vk;
<span class="lineNum">    2015 </span><span class="lineNoCov">          0 :     int bs = GIntGetResource(_NUM_Buttonsize), bsbigger, totwid, spacing;</span>
<span class="lineNum">    2016 </span>            :     SplineFont *temp;
<span class="lineNum">    2017 </span><span class="lineNoCov">          0 :     int familycnt=0;</span>
<span class="lineNum">    2018 </span><span class="lineNoCov">          0 :     int fondcnt = 0, fondmax = 10;</span>
<span class="lineNum">    2019 </span><span class="lineNoCov">          0 :     SFArray *familysfs=NULL;</span>
<span class="lineNum">    2020 </span>            :     uint16 psstyle;
<span class="lineNum">    2021 </span>            :     static int done=false;
<span class="lineNum">    2022 </span>            :     extern NameList *force_names_when_saving;
<span class="lineNum">    2023 </span>            :     char **nlnames;
<span class="lineNum">    2024 </span>            :     int cnt, any;
<span class="lineNum">    2025 </span><span class="lineNoCov">          0 :     GTextInfo *namelistnames, *lynames=NULL;</span>
<span class="lineNum">    2026 </span>            : 
<span class="lineNum">    2027 </span><span class="lineNoCov">          0 :     memset(&amp;d,'\0',sizeof(d));</span>
<span class="lineNum">    2028 </span><span class="lineNoCov">          0 :     d.sf = sf;</span>
<span class="lineNum">    2029 </span><span class="lineNoCov">          0 :     d.layer = layer;</span>
<span class="lineNum">    2030 </span>            : 
<span class="lineNum">    2031 </span><span class="lineNoCov">          0 :     if ( !done ) {</span>
<span class="lineNum">    2032 </span><span class="lineNoCov">          0 :         done = true;</span>
<span class="lineNum">    2033 </span><span class="lineNoCov">          0 :         for ( i=0; formattypes[i].text; ++i )</span>
<span class="lineNum">    2034 </span><span class="lineNoCov">          0 :             formattypes[i].text = (unichar_t *) _((char *) formattypes[i].text);</span>
<span class="lineNum">    2035 </span><span class="lineNoCov">          0 :         for ( i=0; bitmaptypes[i].text; ++i )</span>
<span class="lineNum">    2036 </span><span class="lineNoCov">          0 :             bitmaptypes[i].text = (unichar_t *) _((char *) bitmaptypes[i].text);</span>
<span class="lineNum">    2037 </span>            :     }
<span class="lineNum">    2038 </span>            : 
<span class="lineNum">    2039 </span><span class="lineNoCov">          0 :     if ( family==gf_macfamily ) {</span>
<span class="lineNum">    2040 </span><span class="lineNoCov">          0 :         old_sfnt_flags |=  ttf_flag_applemode;</span>
<span class="lineNum">    2041 </span><span class="lineNoCov">          0 :         old_sfnt_flags &amp;= ~ttf_flag_otmode;</span>
<span class="lineNum">    2042 </span>            :     }
<span class="lineNum">    2043 </span>            : 
<span class="lineNum">    2044 </span><span class="lineNoCov">          0 :     if ( family ) {</span>
<span class="lineNum">    2045 </span>            :         /* I could just disable the menu item, but I think it's a bit confusing*/
<span class="lineNum">    2046 </span>            :         /*  and I want people to know why they can't generate a family */
<span class="lineNum">    2047 </span>            :         FontView *fv;
<span class="lineNum">    2048 </span><span class="lineNoCov">          0 :         SplineFont *dup=NULL/*, *badenc=NULL*/;</span>
<span class="lineNum">    2049 </span><span class="lineNoCov">          0 :         familysfs = malloc((fondmax=10)*sizeof(SFArray));</span>
<span class="lineNum">    2050 </span><span class="lineNoCov">          0 :         memset(familysfs[0],0,sizeof(familysfs[0]));</span>
<span class="lineNum">    2051 </span><span class="lineNoCov">          0 :         familysfs[0][0] = sf;</span>
<span class="lineNum">    2052 </span><span class="lineNoCov">          0 :         fondcnt = 1;</span>
<span class="lineNum">    2053 </span><span class="lineNoCov">          0 :         for ( fv=fv_list; fv!=NULL; fv=(FontView *) (fv-&gt;b.next) ) {</span>
<span class="lineNum">    2054 </span><span class="lineNoCov">          0 :             if ( fv-&gt;b.sf==sf )</span>
<span class="lineNum">    2055 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    2056 </span><span class="lineNoCov">          0 :             if ( family==gf_ttc ) {</span>
<span class="lineNum">    2057 </span><span class="lineNoCov">          0 :                 fc = fondcnt;</span>
<span class="lineNum">    2058 </span><span class="lineNoCov">          0 :                 psstyle = 0;</span>
<span class="lineNum">    2059 </span><span class="lineNoCov">          0 :             } else if ( family==gf_macfamily &amp;&amp; strcmp(fv-&gt;b.sf-&gt;familyname,sf-&gt;familyname)==0 ) {</span>
<span class="lineNum">    2060 </span><span class="lineNoCov">          0 :                 MacStyleCode(fv-&gt;b.sf,&amp;psstyle);</span>
<span class="lineNum">    2061 </span><span class="lineNoCov">          0 :                 if ( fv-&gt;b.sf-&gt;fondname==NULL ) {</span>
<span class="lineNum">    2062 </span><span class="lineNoCov">          0 :                     fc = 0;</span>
<span class="lineNum">    2063 </span><span class="lineNoCov">          0 :                     if ( familysfs[0][0]-&gt;fondname==NULL &amp;&amp;</span>
<span class="lineNum">    2064 </span><span class="lineNoCov">          0 :                             (familysfs[0][psstyle]==NULL || familysfs[0][psstyle]==fv-&gt;b.sf))</span>
<span class="lineNum">    2065 </span><span class="lineNoCov">          0 :                         familysfs[0][psstyle] = fv-&gt;b.sf;</span>
<span class="lineNum">    2066 </span>            :                     else {
<span class="lineNum">    2067 </span><span class="lineNoCov">          0 :                         for ( fc=0; fc&lt;fondcnt; ++fc ) {</span>
<span class="lineNum">    2068 </span><span class="lineNoCov">          0 :                             for ( i=0; i&lt;48; ++i )</span>
<span class="lineNum">    2069 </span><span class="lineNoCov">          0 :                                 if ( familysfs[fc][i]!=NULL )</span>
<span class="lineNum">    2070 </span><span class="lineNoCov">          0 :                             break;</span>
<span class="lineNum">    2071 </span><span class="lineNoCov">          0 :                             if ( i&lt;48 &amp;&amp; familysfs[fc][i]-&gt;fondname==NULL &amp;&amp;</span>
<span class="lineNum">    2072 </span><span class="lineNoCov">          0 :                                     familysfs[fc][psstyle]==fv-&gt;b.sf )</span>
<span class="lineNum">    2073 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    2074 </span>            :                         }
<span class="lineNum">    2075 </span>            :                     }
<span class="lineNum">    2076 </span>            :                 } else {
<span class="lineNum">    2077 </span><span class="lineNoCov">          0 :                     for ( fc=0; fc&lt;fondcnt; ++fc ) {</span>
<span class="lineNum">    2078 </span><span class="lineNoCov">          0 :                         for ( i=0; i&lt;48; ++i )</span>
<span class="lineNum">    2079 </span><span class="lineNoCov">          0 :                             if ( familysfs[fc][i]!=NULL )</span>
<span class="lineNum">    2080 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    2081 </span><span class="lineNoCov">          0 :                         if ( i&lt;48 &amp;&amp; familysfs[fc][i]-&gt;fondname!=NULL &amp;&amp;</span>
<span class="lineNum">    2082 </span><span class="lineNoCov">          0 :                                 strcmp(familysfs[fc][i]-&gt;fondname,fv-&gt;b.sf-&gt;fondname)==0 ) {</span>
<span class="lineNum">    2083 </span><span class="lineNoCov">          0 :                             if ( familysfs[fc][psstyle]==fv-&gt;b.sf )</span>
<span class="lineNum">    2084 </span>            :                                 /* several windows may point to same font */;
<span class="lineNum">    2085 </span><span class="lineNoCov">          0 :                             else if ( familysfs[fc][psstyle]!=NULL ) {</span>
<span class="lineNum">    2086 </span><span class="lineNoCov">          0 :                                 dup = fv-&gt;b.sf;</span>
<span class="lineNum">    2087 </span><span class="lineNoCov">          0 :                                 dupstyle = psstyle;</span>
<span class="lineNum">    2088 </span><span class="lineNoCov">          0 :                                 dupfc = fc;</span>
<span class="lineNum">    2089 </span>            :                             } else
<span class="lineNum">    2090 </span><span class="lineNoCov">          0 :                                 familysfs[fc][psstyle] = fv-&gt;b.sf;</span>
<span class="lineNum">    2091 </span><span class="lineNoCov">          0 :                     break;</span>
<span class="lineNum">    2092 </span>            :                         }
<span class="lineNum">    2093 </span>            :                     }
<span class="lineNum">    2094 </span>            :                 }
<span class="lineNum">    2095 </span>            :             }
<span class="lineNum">    2096 </span><span class="lineNoCov">          0 :             if ( fc==fondcnt ) {</span>
<span class="lineNum">    2097 </span>            :                 /* Create a new fond containing just this font */
<span class="lineNum">    2098 </span><span class="lineNoCov">          0 :                 if ( fondcnt&gt;=fondmax )</span>
<span class="lineNum">    2099 </span><span class="lineNoCov">          0 :                     familysfs = realloc(familysfs,(fondmax+=10)*sizeof(SFArray));</span>
<span class="lineNum">    2100 </span><span class="lineNoCov">          0 :                 memset(familysfs[fondcnt],0,sizeof(SFArray));</span>
<span class="lineNum">    2101 </span><span class="lineNoCov">          0 :                 familysfs[fondcnt++][psstyle] = fv-&gt;b.sf;</span>
<span class="lineNum">    2102 </span>            :             }
<span class="lineNum">    2103 </span>            :         }
<span class="lineNum">    2104 </span><span class="lineNoCov">          0 :         if ( family==gf_macfamily ) {</span>
<span class="lineNum">    2105 </span><span class="lineNoCov">          0 :             for ( fc=0; fc&lt;fondcnt; ++fc ) for ( i=0; i&lt;48; ++i ) {</span>
<span class="lineNum">    2106 </span><span class="lineNoCov">          0 :                 if ( familysfs[fc][i]!=NULL ) {</span>
<span class="lineNum">    2107 </span><span class="lineNoCov">          0 :                     ++familycnt;</span>
<span class="lineNum">    2108 </span>            :                 }
<span class="lineNum">    2109 </span>            :             }
<span class="lineNum">    2110 </span><span class="lineNoCov">          0 :             if ( MacStyleCode(sf,NULL)!=0 || familycnt&lt;=1 || sf-&gt;multilayer ) {</span>
<span class="lineNum">    2111 </span><span class="lineNoCov">          0 :                 ff_post_error(_(&quot;Bad Mac Family&quot;),_(&quot;To generate a Mac family file, the current font must have plain (Normal, Regular, etc.) style, and there must be other open fonts with the same family name.&quot;));</span>
<span class="lineNum">    2112 </span><span class="lineNoCov">          0 : return( 0 );</span>
<span class="lineNum">    2113 </span><span class="lineNoCov">          0 :             } else if ( dup ) {</span>
<span class="lineNum">    2114 </span><span class="lineNoCov">          0 :                 MacStyleCode(dup,&amp;psstyle);</span>
<span class="lineNum">    2115 </span><span class="lineNoCov">          0 :                 ff_post_error(_(&quot;Bad Mac Family&quot;),_(&quot;There are two open fonts with the current family name and the same style. %.30s and %.30s&quot;),</span>
<span class="lineNum">    2116 </span><span class="lineNoCov">          0 :                     dup-&gt;fontname, familysfs[dupfc][dupstyle]-&gt;fontname);</span>
<span class="lineNum">    2117 </span><span class="lineNoCov">          0 :     return( 0 );</span>
<span class="lineNum">    2118 </span>            :             }
<span class="lineNum">    2119 </span>            :         } else {
<span class="lineNum">    2120 </span><span class="lineNoCov">          0 :             familycnt = fondcnt;</span>
<span class="lineNum">    2121 </span>            :         }
<span class="lineNum">    2122 </span>            :     }
<span class="lineNum">    2123 </span>            : 
<span class="lineNum">    2124 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    2125 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_isdlg|wam_restrict;</span>
<span class="lineNum">    2126 </span><span class="lineNoCov">          0 :     wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">    2127 </span><span class="lineNoCov">          0 :     wattrs.is_dlg = true;</span>
<span class="lineNum">    2128 </span><span class="lineNoCov">          0 :     wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">    2129 </span><span class="lineNoCov">          0 :     wattrs.undercursor = 1;</span>
<span class="lineNum">    2130 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_pointer;</span>
<span class="lineNum">    2131 </span>            :     {
<span class="lineNum">    2132 </span><span class="lineNoCov">          0 :         const char *label = _(&quot;Generate Fonts&quot;);</span>
<span class="lineNum">    2133 </span><span class="lineNoCov">          0 :         switch (family) {</span>
<span class="lineNum">    2134 </span>            :         case gf_ttc:
<span class="lineNum">    2135 </span><span class="lineNoCov">          0 :             label = _(&quot;Generate TTC&quot;);</span>
<span class="lineNum">    2136 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2137 </span>            :         case gf_macfamily:
<span class="lineNum">    2138 </span><span class="lineNoCov">          0 :             label = _(&quot;Generate Mac Family&quot;);</span>
<span class="lineNum">    2139 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2140 </span>            :         }
<span class="lineNum">    2141 </span><span class="lineNoCov">          0 :         wattrs.utf8_window_title = label;</span>
<span class="lineNum">    2142 </span>            :     }
<span class="lineNum">    2143 </span><span class="lineNoCov">          0 :     pos.x = pos.y = 0;</span>
<span class="lineNum">    2144 </span><span class="lineNoCov">          0 :     totwid = GGadgetScale(295);</span>
<span class="lineNum">    2145 </span><span class="lineNoCov">          0 :     bsbigger = 4*bs+4*14&gt;totwid; totwid = bsbigger?4*bs+4*12:totwid;</span>
<span class="lineNum">    2146 </span><span class="lineNoCov">          0 :     spacing = (totwid-4*bs-2*12)/3;</span>
<span class="lineNum">    2147 </span><span class="lineNoCov">          0 :     pos.width = GDrawPointsToPixels(NULL,totwid);</span>
<span class="lineNum">    2148 </span><span class="lineNoCov">          0 :     if ( family )</span>
<span class="lineNum">    2149 </span><span class="lineNoCov">          0 :         pos.height = GDrawPointsToPixels(NULL,310+13+26*(familycnt-1));</span>
<span class="lineNum">    2150 </span>            :     else
<span class="lineNum">    2151 </span><span class="lineNoCov">          0 :         pos.height = GDrawPointsToPixels(NULL,310);</span>
<span class="lineNum">    2152 </span><span class="lineNoCov">          0 :     gw = GDrawCreateTopWindow(NULL,&amp;pos,e_h,&amp;d,&amp;wattrs);</span>
<span class="lineNum">    2153 </span>            : 
<span class="lineNum">    2154 </span><span class="lineNoCov">          0 :     memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">    2155 </span><span class="lineNoCov">          0 :     memset(&amp;gcd,0,sizeof(gcd));</span>
<span class="lineNum">    2156 </span><span class="lineNoCov">          0 :     memset(&amp;boxes,0,sizeof(boxes));</span>
<span class="lineNum">    2157 </span><span class="lineNoCov">          0 :     gcd[0].gd.pos.x = 12; gcd[0].gd.pos.y = 6; gcd[0].gd.pos.width = 100*totwid/GIntGetResource(_NUM_ScaleFactor)-24; gcd[0].gd.pos.height = 182;</span>
<span class="lineNum">    2158 </span><span class="lineNoCov">          0 :     gcd[0].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2159 </span><span class="lineNoCov">          0 :     gcd[0].creator = GFileChooserCreate;</span>
<span class="lineNum">    2160 </span><span class="lineNoCov">          0 :     varray[0] = &amp;gcd[0]; varray[1] = NULL;</span>
<span class="lineNum">    2161 </span>            : 
<span class="lineNum">    2162 </span><span class="lineNoCov">          0 :     y = 276;</span>
<span class="lineNum">    2163 </span><span class="lineNoCov">          0 :     if ( family )</span>
<span class="lineNum">    2164 </span><span class="lineNoCov">          0 :         y += 13 + 26*(familycnt-1);</span>
<span class="lineNum">    2165 </span>            : 
<span class="lineNum">    2166 </span><span class="lineNoCov">          0 :     gcd[1].gd.pos.x = 12; gcd[1].gd.pos.y = y-3;</span>
<span class="lineNum">    2167 </span><span class="lineNoCov">          0 :     gcd[1].gd.pos.width = -1;</span>
<span class="lineNum">    2168 </span><span class="lineNoCov">          0 :     gcd[1].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">    2169 </span><span class="lineNoCov">          0 :     label[1].text = (unichar_t *) _(&quot;_Generate&quot;);</span>
<span class="lineNum">    2170 </span><span class="lineNoCov">          0 :     label[1].text_is_1byte = true;</span>
<span class="lineNum">    2171 </span><span class="lineNoCov">          0 :     label[1].text_in_resource = true;</span>
<span class="lineNum">    2172 </span><span class="lineNoCov">          0 :     gcd[1].gd.mnemonic = 'S';</span>
<span class="lineNum">    2173 </span><span class="lineNoCov">          0 :     gcd[1].gd.label = &amp;label[1];</span>
<span class="lineNum">    2174 </span><span class="lineNoCov">          0 :     gcd[1].gd.handle_controlevent = GFD_SaveOk;</span>
<span class="lineNum">    2175 </span><span class="lineNoCov">          0 :     gcd[1].creator = GButtonCreate;</span>
<span class="lineNum">    2176 </span><span class="lineNoCov">          0 :     harray[0] = GCD_Glue; harray[1] = &amp;gcd[1];</span>
<span class="lineNum">    2177 </span>            : 
<span class="lineNum">    2178 </span><span class="lineNoCov">          0 :     gcd[2].gd.pos.x = -(spacing+bs)*100/GIntGetResource(_NUM_ScaleFactor)-12; gcd[2].gd.pos.y = y;</span>
<span class="lineNum">    2179 </span><span class="lineNoCov">          0 :     gcd[2].gd.pos.width = -1;</span>
<span class="lineNum">    2180 </span><span class="lineNoCov">          0 :     gcd[2].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2181 </span><span class="lineNoCov">          0 :     label[2].text = (unichar_t *) _(&quot;_Filter&quot;);</span>
<span class="lineNum">    2182 </span><span class="lineNoCov">          0 :     label[2].text_is_1byte = true;</span>
<span class="lineNum">    2183 </span><span class="lineNoCov">          0 :     label[2].text_in_resource = true;</span>
<span class="lineNum">    2184 </span><span class="lineNoCov">          0 :     gcd[2].gd.mnemonic = 'F';</span>
<span class="lineNum">    2185 </span><span class="lineNoCov">          0 :     gcd[2].gd.label = &amp;label[2];</span>
<span class="lineNum">    2186 </span><span class="lineNoCov">          0 :     gcd[2].gd.handle_controlevent = GFileChooserFilterEh;</span>
<span class="lineNum">    2187 </span><span class="lineNoCov">          0 :     gcd[2].creator = GButtonCreate;</span>
<span class="lineNum">    2188 </span><span class="lineNoCov">          0 :     harray[2] = GCD_Glue; harray[3] = &amp;gcd[2];</span>
<span class="lineNum">    2189 </span>            : 
<span class="lineNum">    2190 </span><span class="lineNoCov">          0 :     gcd[3].gd.pos.x = -12; gcd[3].gd.pos.y = y; gcd[3].gd.pos.width = -1; gcd[3].gd.pos.height = 0;</span>
<span class="lineNum">    2191 </span><span class="lineNoCov">          0 :     gcd[3].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">    2192 </span><span class="lineNoCov">          0 :     label[3].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    2193 </span><span class="lineNoCov">          0 :     label[3].text_is_1byte = true;</span>
<span class="lineNum">    2194 </span><span class="lineNoCov">          0 :     label[3].text_in_resource = true;</span>
<span class="lineNum">    2195 </span><span class="lineNoCov">          0 :     gcd[3].gd.label = &amp;label[3];</span>
<span class="lineNum">    2196 </span><span class="lineNoCov">          0 :     gcd[3].gd.mnemonic = 'C';</span>
<span class="lineNum">    2197 </span><span class="lineNoCov">          0 :     gcd[3].gd.handle_controlevent = GFD_Cancel;</span>
<span class="lineNum">    2198 </span><span class="lineNoCov">          0 :     gcd[3].creator = GButtonCreate;</span>
<span class="lineNum">    2199 </span><span class="lineNoCov">          0 :     harray[6] = GCD_Glue; harray[7] = &amp;gcd[3]; harray[8] = GCD_Glue; harray[9] = NULL;</span>
<span class="lineNum">    2200 </span>            : 
<span class="lineNum">    2201 </span><span class="lineNoCov">          0 :     gcd[4].gd.pos.x = (spacing+bs)*100/GIntGetResource(_NUM_ScaleFactor)+12; gcd[4].gd.pos.y = y; gcd[4].gd.pos.width = -1; gcd[4].gd.pos.height = 0;</span>
<span class="lineNum">    2202 </span><span class="lineNoCov">          0 :     gcd[4].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2203 </span><span class="lineNoCov">          0 :     label[4].text = (unichar_t *) S_(&quot;Directory|_New&quot;);</span>
<span class="lineNum">    2204 </span><span class="lineNoCov">          0 :     label[4].text_is_1byte = true;</span>
<span class="lineNum">    2205 </span><span class="lineNoCov">          0 :     label[4].text_in_resource = true;</span>
<span class="lineNum">    2206 </span><span class="lineNoCov">          0 :     label[4].image = &amp;_GIcon_dir;</span>
<span class="lineNum">    2207 </span><span class="lineNoCov">          0 :     label[4].image_precedes = false;</span>
<span class="lineNum">    2208 </span><span class="lineNoCov">          0 :     gcd[4].gd.mnemonic = 'N';</span>
<span class="lineNum">    2209 </span><span class="lineNoCov">          0 :     gcd[4].gd.label = &amp;label[4];</span>
<span class="lineNum">    2210 </span><span class="lineNoCov">          0 :     gcd[4].gd.handle_controlevent = GFD_NewDir;</span>
<span class="lineNum">    2211 </span><span class="lineNoCov">          0 :     gcd[4].creator = GButtonCreate;</span>
<span class="lineNum">    2212 </span><span class="lineNoCov">          0 :     harray[4] = GCD_Glue; harray[5] = &amp;gcd[4];</span>
<span class="lineNum">    2213 </span>            : 
<span class="lineNum">    2214 </span><span class="lineNoCov">          0 :     boxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2215 </span><span class="lineNoCov">          0 :     boxes[2].gd.u.boxelements = harray;</span>
<span class="lineNum">    2216 </span><span class="lineNoCov">          0 :     boxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">    2217 </span>            : 
<span class="lineNum">    2218 </span><span class="lineNoCov">          0 :     gcd[5].gd.pos.x = 12; gcd[5].gd.pos.y = 218; gcd[5].gd.pos.width = 0; gcd[5].gd.pos.height = 0;</span>
<span class="lineNum">    2219 </span><span class="lineNoCov">          0 :     gcd[5].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    2220 </span><span class="lineNoCov">          0 :     label[5].text = (unichar_t *) _(&quot;Options&quot;);</span>
<span class="lineNum">    2221 </span><span class="lineNoCov">          0 :     label[5].text_is_1byte = true;</span>
<span class="lineNum">    2222 </span><span class="lineNoCov">          0 :     gcd[5].gd.popup_msg = (unichar_t *) _(&quot;Allows you to select optional behavior when generating the font&quot;);</span>
<span class="lineNum">    2223 </span><span class="lineNoCov">          0 :     gcd[5].gd.label = &amp;label[5];</span>
<span class="lineNum">    2224 </span><span class="lineNoCov">          0 :     gcd[5].gd.handle_controlevent = GFD_Options;</span>
<span class="lineNum">    2225 </span><span class="lineNoCov">          0 :     gcd[5].creator = GButtonCreate;</span>
<span class="lineNum">    2226 </span><span class="lineNoCov">          0 :     hvarray[4] = &amp;gcd[5]; hvarray[5] = GCD_Glue;</span>
<span class="lineNum">    2227 </span>            : 
<span class="lineNum">    2228 </span><span class="lineNoCov">          0 :     gcd[6].gd.pos.x = 12; gcd[6].gd.pos.y = 190; gcd[6].gd.pos.width = 0; gcd[6].gd.pos.height = 0;</span>
<span class="lineNum">    2229 </span><span class="lineNoCov">          0 :     gcd[6].gd.flags = gg_visible | gg_enabled ;</span>
<span class="lineNum">    2230 </span><span class="lineNoCov">          0 :     gcd[6].gd.u.list = formattypes;</span>
<span class="lineNum">    2231 </span><span class="lineNoCov">          0 :     gcd[6].creator = GListButtonCreate;</span>
<span class="lineNum">    2232 </span><span class="lineNoCov">          0 :     hvarray[0] = &amp;gcd[6]; hvarray[1] = GCD_ColSpan;</span>
<span class="lineNum">    2233 </span>            : 
<span class="lineNum">    2234 </span><span class="lineNoCov">          0 :     any = false;</span>
<span class="lineNum">    2235 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;sf-&gt;glyphcnt; ++i ) if ( SCWorthOutputting(sf-&gt;glyphs[i])) {</span>
<span class="lineNum">    2236 </span><span class="lineNoCov">          0 :         any = true;</span>
<span class="lineNum">    2237 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    2238 </span>            :     }
<span class="lineNum">    2239 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;sizeof(formattypes)/sizeof(formattypes[0])-1; ++i )</span>
<span class="lineNum">    2240 </span><span class="lineNoCov">          0 :         formattypes[i].disabled = !any;</span>
<span class="lineNum">    2241 </span><span class="lineNoCov">          0 :     formattypes[ff_ptype0].disabled = sf-&gt;onlybitmaps || map-&gt;enc-&gt;only_1byte;</span>
<span class="lineNum">    2242 </span><span class="lineNoCov">          0 :     formattypes[ff_mma].disabled = formattypes[ff_mmb].disabled =</span>
<span class="lineNum">    2243 </span><span class="lineNoCov">          0 :              sf-&gt;mm==NULL || sf-&gt;mm-&gt;apple || !MMValid(sf-&gt;mm,false);</span>
<span class="lineNum">    2244 </span><span class="lineNoCov">          0 :     formattypes[ff_cffcid].disabled = sf-&gt;cidmaster==NULL;</span>
<span class="lineNum">    2245 </span><span class="lineNoCov">          0 :     formattypes[ff_cid].disabled = sf-&gt;cidmaster==NULL;</span>
<span class="lineNum">    2246 </span><span class="lineNoCov">          0 :     formattypes[ff_otfcid].disabled = sf-&gt;cidmaster==NULL;</span>
<span class="lineNum">    2247 </span><span class="lineNoCov">          0 :     formattypes[ff_otfciddfont].disabled = sf-&gt;cidmaster==NULL;</span>
<span class="lineNum">    2248 </span><span class="lineNoCov">          0 :     if ( map-&gt;enc-&gt;is_unicodefull )</span>
<span class="lineNum">    2249 </span><span class="lineNoCov">          0 :         formattypes[ff_type42cid].disabled = true;      /* Identity CMap only handles BMP */</span>
<span class="lineNum">    2250 </span><span class="lineNoCov">          0 :     ofs = oldformatstate;</span>
<span class="lineNum">    2251 </span><span class="lineNoCov">          0 :     if (( ofs==ff_ptype0 &amp;&amp; formattypes[ff_ptype0].disabled ) ||</span>
<span class="lineNum">    2252 </span><span class="lineNoCov">          0 :             ((ofs==ff_mma || ofs==ff_mmb) &amp;&amp; sf-&gt;mm==NULL) ||</span>
<span class="lineNum">    2253 </span><span class="lineNoCov">          0 :             ((ofs==ff_cid || ofs==ff_cffcid || ofs==ff_otfcid || ofs==ff_otfciddfont) &amp;&amp; formattypes[ff_cid].disabled))</span>
<span class="lineNum">    2254 </span><span class="lineNoCov">          0 :         ofs = ff_pfb;</span>
<span class="lineNum">    2255 </span><span class="lineNoCov">          0 :     else if ( (ofs!=ff_cid &amp;&amp; ofs!=ff_cffcid &amp;&amp; ofs!=ff_otfcid &amp;&amp; ofs!=ff_otfciddfont) &amp;&amp; sf-&gt;cidmaster!=NULL )</span>
<span class="lineNum">    2256 </span><span class="lineNoCov">          0 :         ofs = ff_otfcid;</span>
<span class="lineNum">    2257 </span><span class="lineNoCov">          0 :     else if ( !formattypes[ff_mmb].disabled &amp;&amp; ofs!=ff_mma )</span>
<span class="lineNum">    2258 </span><span class="lineNoCov">          0 :         ofs = ff_mmb;</span>
<span class="lineNum">    2259 </span><span class="lineNoCov">          0 :     if ( ofs==ff_ttc )</span>
<span class="lineNum">    2260 </span><span class="lineNoCov">          0 :         ofs = ff_ttf;</span>
<span class="lineNum">    2261 </span><span class="lineNoCov">          0 :     if ( sf-&gt;onlybitmaps )</span>
<span class="lineNum">    2262 </span><span class="lineNoCov">          0 :         ofs = ff_none;</span>
<span class="lineNum">    2263 </span><span class="lineNoCov">          0 :     if ( sf-&gt;multilayer ) {</span>
<span class="lineNum">    2264 </span><span class="lineNoCov">          0 :         formattypes[ff_pfa].disabled = true;</span>
<span class="lineNum">    2265 </span><span class="lineNoCov">          0 :         formattypes[ff_pfb].disabled = true;</span>
<span class="lineNum">    2266 </span><span class="lineNoCov">          0 :         formattypes[ff_pfbmacbin].disabled = true;</span>
<span class="lineNum">    2267 </span><span class="lineNoCov">          0 :         formattypes[ff_mma].disabled = true;</span>
<span class="lineNum">    2268 </span><span class="lineNoCov">          0 :         formattypes[ff_mmb].disabled = true;</span>
<span class="lineNum">    2269 </span><span class="lineNoCov">          0 :         formattypes[ff_multiple].disabled = true;</span>
<span class="lineNum">    2270 </span><span class="lineNoCov">          0 :         formattypes[ff_ptype0].disabled = true;</span>
<span class="lineNum">    2271 </span><span class="lineNoCov">          0 :         formattypes[ff_cff].disabled = true;</span>
<span class="lineNum">    2272 </span><span class="lineNoCov">          0 :         formattypes[ff_cffcid].disabled = true;</span>
<span class="lineNum">    2273 </span><span class="lineNoCov">          0 :         formattypes[ff_cid].disabled = true;</span>
<span class="lineNum">    2274 </span><span class="lineNoCov">          0 :         formattypes[ff_ttf].disabled = true;</span>
<span class="lineNum">    2275 </span><span class="lineNoCov">          0 :         formattypes[ff_type42].disabled = true;</span>
<span class="lineNum">    2276 </span><span class="lineNoCov">          0 :         formattypes[ff_type42cid].disabled = true;</span>
<span class="lineNum">    2277 </span><span class="lineNoCov">          0 :         formattypes[ff_ttfsym].disabled = true;</span>
<span class="lineNum">    2278 </span><span class="lineNoCov">          0 :         formattypes[ff_ttfmacbin].disabled = true;</span>
<span class="lineNum">    2279 </span><span class="lineNoCov">          0 :         formattypes[ff_ttfdfont].disabled = true;</span>
<span class="lineNum">    2280 </span><span class="lineNoCov">          0 :         formattypes[ff_otfdfont].disabled = true;</span>
<span class="lineNum">    2281 </span><span class="lineNoCov">          0 :         formattypes[ff_otf].disabled = true;</span>
<span class="lineNum">    2282 </span><span class="lineNoCov">          0 :         formattypes[ff_otfcid].disabled = true;</span>
<span class="lineNum">    2283 </span><span class="lineNoCov">          0 :         formattypes[ff_cffcid].disabled = true;</span>
<span class="lineNum">    2284 </span>            :         // formattypes[ff_ufo].disabled = true;
<span class="lineNum">    2285 </span><span class="lineNoCov">          0 :         if ( ofs!=ff_svg )</span>
<span class="lineNum">    2286 </span><span class="lineNoCov">          0 :             ofs = ff_ptype3;</span>
<span class="lineNum">    2287 </span><span class="lineNoCov">          0 :     } else if ( sf-&gt;strokedfont ) {</span>
<span class="lineNum">    2288 </span><span class="lineNoCov">          0 :         formattypes[ff_ttf].disabled = true;</span>
<span class="lineNum">    2289 </span><span class="lineNoCov">          0 :         formattypes[ff_ttfsym].disabled = true;</span>
<span class="lineNum">    2290 </span><span class="lineNoCov">          0 :         formattypes[ff_ttfmacbin].disabled = true;</span>
<span class="lineNum">    2291 </span><span class="lineNoCov">          0 :         formattypes[ff_ttfdfont].disabled = true;</span>
<span class="lineNum">    2292 </span><span class="lineNoCov">          0 :         formattypes[ff_ufo].disabled = true;</span>
<span class="lineNum">    2293 </span><span class="lineNoCov">          0 :         if ( ofs==ff_ttf || ofs==ff_ttfsym || ofs==ff_ttfmacbin || ofs==ff_ttfdfont )</span>
<span class="lineNum">    2294 </span><span class="lineNoCov">          0 :             ofs = ff_otf;</span>
<span class="lineNum">    2295 </span>            :     }
<span class="lineNum">    2296 </span><span class="lineNoCov">          0 :     formattypes[ff_ttc].disabled = true;</span>
<span class="lineNum">    2297 </span><span class="lineNoCov">          0 :     if ( family == gf_macfamily ) {</span>
<span class="lineNum">    2298 </span><span class="lineNoCov">          0 :         if ( ofs==ff_pfa || ofs==ff_pfb || ofs==ff_multiple || ofs==ff_ptype3 ||</span>
<span class="lineNum">    2299 </span><span class="lineNoCov">          0 :                 ofs==ff_ptype0 || ofs==ff_mma || ofs==ff_mmb )</span>
<span class="lineNum">    2300 </span><span class="lineNoCov">          0 :             ofs = ff_pfbmacbin;</span>
<span class="lineNum">    2301 </span><span class="lineNoCov">          0 :         else if ( ofs==ff_cid || ofs==ff_otfcid || ofs==ff_cffcid )</span>
<span class="lineNum">    2302 </span><span class="lineNoCov">          0 :             ofs = ff_otfciddfont;</span>
<span class="lineNum">    2303 </span><span class="lineNoCov">          0 :         else if ( ofs==ff_ttf || ofs==ff_ttfsym )</span>
<span class="lineNum">    2304 </span><span class="lineNoCov">          0 :             ofs = ff_ttfmacbin;</span>
<span class="lineNum">    2305 </span><span class="lineNoCov">          0 :         else if ( ofs==ff_otf || ofs==ff_cff )</span>
<span class="lineNum">    2306 </span><span class="lineNoCov">          0 :             ofs = ff_otfdfont;</span>
<span class="lineNum">    2307 </span><span class="lineNoCov">          0 :         else if ( ofs==ff_ufo || ofs==ff_ttc )</span>
<span class="lineNum">    2308 </span><span class="lineNoCov">          0 :             ofs = ff_ttfdfont;</span>
<span class="lineNum">    2309 </span><span class="lineNoCov">          0 :         formattypes[ff_pfa].disabled = true;</span>
<span class="lineNum">    2310 </span><span class="lineNoCov">          0 :         formattypes[ff_pfb].disabled = true;</span>
<span class="lineNum">    2311 </span><span class="lineNoCov">          0 :         formattypes[ff_mma].disabled = true;</span>
<span class="lineNum">    2312 </span><span class="lineNoCov">          0 :         formattypes[ff_mmb].disabled = true;</span>
<span class="lineNum">    2313 </span><span class="lineNoCov">          0 :         formattypes[ff_multiple].disabled = true;</span>
<span class="lineNum">    2314 </span><span class="lineNoCov">          0 :         formattypes[ff_ptype3].disabled = true;</span>
<span class="lineNum">    2315 </span><span class="lineNoCov">          0 :         formattypes[ff_ptype0].disabled = true;</span>
<span class="lineNum">    2316 </span><span class="lineNoCov">          0 :         formattypes[ff_type42].disabled = true;</span>
<span class="lineNum">    2317 </span><span class="lineNoCov">          0 :         formattypes[ff_type42cid].disabled = true;</span>
<span class="lineNum">    2318 </span><span class="lineNoCov">          0 :         formattypes[ff_ttf].disabled = true;</span>
<span class="lineNum">    2319 </span><span class="lineNoCov">          0 :         formattypes[ff_ttfsym].disabled = true;</span>
<span class="lineNum">    2320 </span><span class="lineNoCov">          0 :         formattypes[ff_otf].disabled = true;</span>
<span class="lineNum">    2321 </span><span class="lineNoCov">          0 :         formattypes[ff_otfcid].disabled = true;</span>
<span class="lineNum">    2322 </span><span class="lineNoCov">          0 :         formattypes[ff_cff].disabled = true;</span>
<span class="lineNum">    2323 </span><span class="lineNoCov">          0 :         formattypes[ff_cffcid].disabled = true;</span>
<span class="lineNum">    2324 </span><span class="lineNoCov">          0 :         formattypes[ff_svg].disabled = true;</span>
<span class="lineNum">    2325 </span><span class="lineNoCov">          0 :         formattypes[ff_ufo].disabled = true;</span>
<span class="lineNum">    2326 </span><span class="lineNoCov">          0 :     } else if ( family == gf_ttc ) {</span>
<span class="lineNum">    2327 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;=ff_none; ++i )</span>
<span class="lineNum">    2328 </span><span class="lineNoCov">          0 :             formattypes[i].disabled = true;</span>
<span class="lineNum">    2329 </span><span class="lineNoCov">          0 :         formattypes[ff_ttc].disabled = false;</span>
<span class="lineNum">    2330 </span><span class="lineNoCov">          0 :         ofs = ff_ttc;</span>
<span class="lineNum">    2331 </span>            :     }
<span class="lineNum">    2332 </span><span class="lineNoCov">          0 :     if ( !CanWoff())</span>
<span class="lineNum">    2333 </span><span class="lineNoCov">          0 :         formattypes[ff_woff].disabled = true;</span>
<span class="lineNum">    2334 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;sizeof(formattypes)/sizeof(formattypes[0]); ++i )</span>
<span class="lineNum">    2335 </span><span class="lineNoCov">          0 :         formattypes[i].selected = false;</span>
<span class="lineNum">    2336 </span><span class="lineNoCov">          0 :     formattypes[ofs].selected = true;</span>
<span class="lineNum">    2337 </span><span class="lineNoCov">          0 :     gcd[6].gd.handle_controlevent = GFD_Format;</span>
<span class="lineNum">    2338 </span><span class="lineNoCov">          0 :     gcd[6].gd.label = &amp;formattypes[ofs];</span>
<span class="lineNum">    2339 </span>            : 
<span class="lineNum">    2340 </span><span class="lineNoCov">          0 :     gcd[7].gd.pos.x = 2; gcd[7].gd.pos.y = 2;</span>
<span class="lineNum">    2341 </span><span class="lineNoCov">          0 :     gcd[7].gd.pos.width = pos.width-4; gcd[7].gd.pos.height = pos.height-4;</span>
<span class="lineNum">    2342 </span><span class="lineNoCov">          0 :     gcd[7].gd.flags = gg_enabled | gg_visible | gg_pos_in_pixels;</span>
<span class="lineNum">    2343 </span><span class="lineNoCov">          0 :     gcd[7].creator = GGroupCreate;</span>
<span class="lineNum">    2344 </span>            : 
<span class="lineNum">    2345 </span><span class="lineNoCov">          0 :     gcd[8].gd.pos.x = 155; gcd[8].gd.pos.y = 190; gcd[8].gd.pos.width = 126;</span>
<span class="lineNum">    2346 </span><span class="lineNoCov">          0 :     gcd[8].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2347 </span><span class="lineNoCov">          0 :     gcd[8].gd.u.list = bitmaptypes;</span>
<span class="lineNum">    2348 </span><span class="lineNoCov">          0 :     gcd[8].creator = GListButtonCreate;</span>
<span class="lineNum">    2349 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;sizeof(bitmaptypes)/sizeof(bitmaptypes[0]); ++i ) {</span>
<span class="lineNum">    2350 </span><span class="lineNoCov">          0 :         bitmaptypes[i].selected = false;</span>
<span class="lineNum">    2351 </span><span class="lineNoCov">          0 :         bitmaptypes[i].disabled = false;</span>
<span class="lineNum">    2352 </span>            :     }
<span class="lineNum">    2353 </span><span class="lineNoCov">          0 :     hvarray[2] = &amp;gcd[8]; hvarray[3] = NULL;</span>
<span class="lineNum">    2354 </span><span class="lineNoCov">          0 :     old = oldbitmapstate;</span>
<span class="lineNum">    2355 </span><span class="lineNoCov">          0 :     if ( family==gf_macfamily ) {</span>
<span class="lineNum">    2356 </span><span class="lineNoCov">          0 :         if ( old==bf_bdf || old==bf_fon || old==bf_fnt || old==bf_sfnt_ms ||</span>
<span class="lineNum">    2357 </span><span class="lineNoCov">          0 :                 old==bf_otb || old==bf_palm || old==bf_ptype3 ) {</span>
<span class="lineNum">    2358 </span><span class="lineNoCov">          0 :             if ( ofs==ff_otfdfont || ofs==ff_otfciddfont || ofs==ff_ttfdfont )</span>
<span class="lineNum">    2359 </span><span class="lineNoCov">          0 :                 old = bf_ttf;</span>
<span class="lineNum">    2360 </span>            :             else
<span class="lineNum">    2361 </span><span class="lineNoCov">          0 :                 old = bf_sfnt_dfont;</span>
<span class="lineNum">    2362 </span><span class="lineNoCov">          0 :         } else if ( old==bf_nfntmacbin &amp;&amp;</span>
<span class="lineNum">    2363 </span><span class="lineNoCov">          0 :                     ( ofs==ff_otfdfont || ofs==ff_otfciddfont || ofs==ff_ttfdfont ))</span>
<span class="lineNum">    2364 </span><span class="lineNoCov">          0 :             old = bf_ttf;</span>
<span class="lineNum">    2365 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_bdf].disabled = true;</span>
<span class="lineNum">    2366 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_fon].disabled = true;</span>
<span class="lineNum">    2367 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_fnt].disabled = true;</span>
<span class="lineNum">    2368 </span><span class="lineNoCov">          0 :     } else if ( family==gf_ttc ) {</span>
<span class="lineNum">    2369 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;bf_none; ++i )</span>
<span class="lineNum">    2370 </span><span class="lineNoCov">          0 :             bitmaptypes[i].disabled = true;</span>
<span class="lineNum">    2371 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_ttf].disabled = false;</span>
<span class="lineNum">    2372 </span><span class="lineNoCov">          0 :         if ( old!=bf_none )</span>
<span class="lineNum">    2373 </span><span class="lineNoCov">          0 :             old = bf_ttf;</span>
<span class="lineNum">    2374 </span>            :     }
<span class="lineNum">    2375 </span><span class="lineNoCov">          0 :     temp = sf-&gt;cidmaster ? sf-&gt;cidmaster : sf;</span>
<span class="lineNum">    2376 </span><span class="lineNoCov">          0 :     if ( temp-&gt;bitmaps==NULL ) {</span>
<span class="lineNum">    2377 </span><span class="lineNoCov">          0 :         old = bf_none;</span>
<span class="lineNum">    2378 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_bdf].disabled = true;</span>
<span class="lineNum">    2379 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_ttf].disabled = true;</span>
<span class="lineNum">    2380 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_sfnt_dfont].disabled = true;</span>
<span class="lineNum">    2381 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_sfnt_ms].disabled = true;</span>
<span class="lineNum">    2382 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_otb].disabled = true;</span>
<span class="lineNum">    2383 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_nfntmacbin].disabled = true;</span>
<span class="lineNum">    2384 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_fon].disabled = true;</span>
<span class="lineNum">    2385 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_fnt].disabled = true;</span>
<span class="lineNum">    2386 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_palm].disabled = true;</span>
<span class="lineNum">    2387 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_ptype3].disabled = true;</span>
<span class="lineNum">    2388 </span><span class="lineNoCov">          0 :     } else if ( ofs==ff_ttf || ofs==ff_ttfsym || ofs==ff_ttfmacbin ||</span>
<span class="lineNum">    2389 </span><span class="lineNoCov">          0 :             ofs==ff_ttfdfont || ofs==ff_otf || ofs==ff_otfdfont || ofs==ff_otfcid ||</span>
<span class="lineNum">    2390 </span>            :             ofs==ff_otfciddfont ) {
<span class="lineNum">    2391 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_ttf].disabled = false;</span>
<span class="lineNum">    2392 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_sfnt_dfont].disabled = true;</span>
<span class="lineNum">    2393 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_sfnt_ms].disabled = true;</span>
<span class="lineNum">    2394 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_otb].disabled = true;</span>
<span class="lineNum">    2395 </span>            :     } else {
<span class="lineNum">    2396 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_ttf].disabled = true;</span>
<span class="lineNum">    2397 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_sfnt_dfont].disabled = false;</span>
<span class="lineNum">    2398 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_sfnt_ms].disabled = false;</span>
<span class="lineNum">    2399 </span><span class="lineNoCov">          0 :         bitmaptypes[bf_otb].disabled = false;</span>
<span class="lineNum">    2400 </span>            :     }
<span class="lineNum">    2401 </span><span class="lineNoCov">          0 :     bitmaptypes[old].selected = true;</span>
<span class="lineNum">    2402 </span><span class="lineNoCov">          0 :     gcd[8].gd.label = &amp;bitmaptypes[old];</span>
<span class="lineNum">    2403 </span><span class="lineNoCov">          0 :     gcd[8].gd.handle_controlevent = GFD_BitmapFormat;</span>
<span class="lineNum">    2404 </span>            : 
<span class="lineNum">    2405 </span><span class="lineNoCov">          0 :     gcd[9].gd.pos.x = gcd[8].gd.pos.x; gcd[9].gd.pos.y = 219; gcd[9].gd.pos.width = gcd[8].gd.pos.width;</span>
<span class="lineNum">    2406 </span><span class="lineNoCov">          0 :     gcd[9].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2407 </span><span class="lineNoCov">          0 :     if ( old==bf_none )</span>
<span class="lineNum">    2408 </span><span class="lineNoCov">          0 :         gcd[9].gd.flags &amp;= ~gg_enabled;</span>
<span class="lineNum">    2409 </span><span class="lineNoCov">          0 :     gcd[9].creator = GTextFieldCreate;</span>
<span class="lineNum">    2410 </span><span class="lineNoCov">          0 :     label[9].text = BitmapList(temp);</span>
<span class="lineNum">    2411 </span><span class="lineNoCov">          0 :     gcd[9].gd.label = &amp;label[9];</span>
<span class="lineNum">    2412 </span><span class="lineNoCov">          0 :     hvarray[6] = &amp;gcd[9]; hvarray[7] = NULL;</span>
<span class="lineNum">    2413 </span>            : 
<span class="lineNum">    2414 </span><span class="lineNoCov">          0 :     k = 10;</span>
<span class="lineNum">    2415 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Force glyph names to:&quot;);</span>
<span class="lineNum">    2416 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2417 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2418 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 8; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+24+6;</span>
<span class="lineNum">    2419 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_enabled | gg_visible | gg_utf8_popup;</span>
<span class="lineNum">    2420 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;In the saved font, force all glyph names to match those in the specified namelist&quot;);</span>
<span class="lineNum">    2421 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    2422 </span><span class="lineNoCov">          0 :     hvarray[8] = &amp;gcd[k-1]; hvarray[9] = GCD_ColSpan;</span>
<span class="lineNum">    2423 </span>            : 
<span class="lineNum">    2424 </span><span class="lineNoCov">          0 :     rk = k;</span>
<span class="lineNum">    2425 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = gcd[k-2].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y-6;</span>
<span class="lineNum">    2426 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = gcd[k-2].gd.pos.width;</span>
<span class="lineNum">    2427 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    2428 </span><span class="lineNoCov">          0 :     gcd[k].gd.popup_msg = (unichar_t *) _(&quot;In the saved font, force all glyph names to match those in the specified namelist&quot;);</span>
<span class="lineNum">    2429 </span><span class="lineNoCov">          0 :     gcd[k].creator = GListButtonCreate;</span>
<span class="lineNum">    2430 </span><span class="lineNoCov">          0 :     nlnames = AllNamelistNames();</span>
<span class="lineNum">    2431 </span><span class="lineNoCov">          0 :     for ( cnt=0; nlnames[cnt]!=NULL; ++cnt);</span>
<span class="lineNum">    2432 </span><span class="lineNoCov">          0 :     namelistnames = calloc(cnt+3,sizeof(GTextInfo));</span>
<span class="lineNum">    2433 </span><span class="lineNoCov">          0 :     namelistnames[0].text = (unichar_t *) _(&quot;No Rename&quot;);</span>
<span class="lineNum">    2434 </span><span class="lineNoCov">          0 :     namelistnames[0].text_is_1byte = true;</span>
<span class="lineNum">    2435 </span><span class="lineNoCov">          0 :     if ( force_names_when_saving==NULL ) {</span>
<span class="lineNum">    2436 </span><span class="lineNoCov">          0 :         namelistnames[0].selected = true;</span>
<span class="lineNum">    2437 </span><span class="lineNoCov">          0 :         gcd[k].gd.label = &amp;namelistnames[0];</span>
<span class="lineNum">    2438 </span>            :     }
<span class="lineNum">    2439 </span><span class="lineNoCov">          0 :     namelistnames[1].line = true;</span>
<span class="lineNum">    2440 </span><span class="lineNoCov">          0 :     for ( cnt=0; nlnames[cnt]!=NULL; ++cnt) {</span>
<span class="lineNum">    2441 </span><span class="lineNoCov">          0 :         namelistnames[cnt+2].text = (unichar_t *) nlnames[cnt];</span>
<span class="lineNum">    2442 </span><span class="lineNoCov">          0 :         namelistnames[cnt+2].text_is_1byte = true;</span>
<span class="lineNum">    2443 </span><span class="lineNoCov">          0 :         if ( force_names_when_saving!=NULL &amp;&amp;</span>
<span class="lineNum">    2444 </span><span class="lineNoCov">          0 :                 strcmp(_(force_names_when_saving-&gt;title),nlnames[cnt])==0 ) {</span>
<span class="lineNum">    2445 </span><span class="lineNoCov">          0 :             namelistnames[cnt+2].selected = true;</span>
<span class="lineNum">    2446 </span><span class="lineNoCov">          0 :             gcd[k].gd.label = &amp;namelistnames[cnt+2];</span>
<span class="lineNum">    2447 </span>            :         }
<span class="lineNum">    2448 </span>            :     }
<span class="lineNum">    2449 </span><span class="lineNoCov">          0 :     gcd[k++].gd.u.list = namelistnames;</span>
<span class="lineNum">    2450 </span><span class="lineNoCov">          0 :     free(nlnames);</span>
<span class="lineNum">    2451 </span><span class="lineNoCov">          0 :     hvarray[10] = &amp;gcd[k-1]; hvarray[11] = NULL;</span>
<span class="lineNum">    2452 </span>            : 
<span class="lineNum">    2453 </span><span class="lineNoCov">          0 :     if ( !family ) {</span>
<span class="lineNum">    2454 </span>            :         /* Too annoying to check if all fonts in a family have the same set of*/
<span class="lineNum">    2455 </span>            :         /*  useful layers. So only do this if not family */
<span class="lineNum">    2456 </span><span class="lineNoCov">          0 :         label[k].text = (unichar_t *) _(&quot;Layer:&quot;);</span>
<span class="lineNum">    2457 </span><span class="lineNoCov">          0 :         label[k].text_is_1byte = true;</span>
<span class="lineNum">    2458 </span><span class="lineNoCov">          0 :         gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2459 </span><span class="lineNoCov">          0 :         gcd[k].gd.pos.x = 8; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+24+6;</span>
<span class="lineNum">    2460 </span><span class="lineNoCov">          0 :         gcd[k].gd.flags = gg_enabled | gg_visible | gg_utf8_popup;</span>
<span class="lineNum">    2461 </span><span class="lineNoCov">          0 :         gcd[k].gd.popup_msg = (unichar_t *) _(&quot;In the saved font, force all glyph names to match those in the specified namelist&quot;);</span>
<span class="lineNum">    2462 </span><span class="lineNoCov">          0 :         gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    2463 </span>            : 
<span class="lineNum">    2464 </span><span class="lineNoCov">          0 :         gcd[k].gd.pos.x = gcd[k-2].gd.pos.x; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y-6;</span>
<span class="lineNum">    2465 </span><span class="lineNoCov">          0 :         gcd[k].gd.pos.width = gcd[k-2].gd.pos.width;</span>
<span class="lineNum">    2466 </span><span class="lineNoCov">          0 :         gcd[k].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    2467 </span><span class="lineNoCov">          0 :         gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Save a font based on the specified layer&quot;);</span>
<span class="lineNum">    2468 </span><span class="lineNoCov">          0 :         gcd[k].creator = GListButtonCreate;</span>
<span class="lineNum">    2469 </span><span class="lineNoCov">          0 :         gcd[k].gd.cid = CID_Layers;</span>
<span class="lineNum">    2470 </span><span class="lineNoCov">          0 :         gcd[k++].gd.u.list = lynames = SFUsableLayerNames(sf,layer);</span>
<span class="lineNum">    2471 </span><span class="lineNoCov">          0 :         if ( lynames[1].text==NULL ) {</span>
<span class="lineNum">    2472 </span><span class="lineNoCov">          0 :             gcd[k-2].gd.flags &amp;= ~gg_visible;</span>
<span class="lineNum">    2473 </span><span class="lineNoCov">          0 :             gcd[k-1].gd.flags &amp;= ~gg_visible;</span>
<span class="lineNum">    2474 </span>            :         }
<span class="lineNum">    2475 </span><span class="lineNoCov">          0 :         hvi=12;</span>
<span class="lineNum">    2476 </span><span class="lineNoCov">          0 :         hvarray[hvi++] = &amp;gcd[k-2]; hvarray[hvi++] = GCD_ColSpan; hvarray[hvi++] = &amp;gcd[k-1];</span>
<span class="lineNum">    2477 </span><span class="lineNoCov">          0 :         hvarray[hvi++] = NULL;</span>
<span class="lineNum">    2478 </span>            : 
<span class="lineNum">    2479 </span>            :         /* Too time consuming to validate lots of fonts, and what UI would I use? */
<span class="lineNum">    2480 </span>            :         /*  so only do this if not family */
<span class="lineNum">    2481 </span><span class="lineNoCov">          0 :         vk = k;</span>
<span class="lineNum">    2482 </span><span class="lineNoCov">          0 :         label[k].text = (unichar_t *) _(&quot;Validate Before Saving&quot;);</span>
<span class="lineNum">    2483 </span><span class="lineNoCov">          0 :         label[k].text_is_1byte = true;</span>
<span class="lineNum">    2484 </span><span class="lineNoCov">          0 :         gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2485 </span><span class="lineNoCov">          0 :         gcd[k].gd.pos.x = 8; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+24+6;</span>
<span class="lineNum">    2486 </span><span class="lineNoCov">          0 :         if ( sf-&gt;multilayer || sf-&gt;strokedfont || sf-&gt;onlybitmaps )</span>
<span class="lineNum">    2487 </span><span class="lineNoCov">          0 :             gcd[k].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">    2488 </span><span class="lineNoCov">          0 :         else if ( old_validate )</span>
<span class="lineNum">    2489 </span><span class="lineNoCov">          0 :             gcd[k].gd.flags = (gg_enabled | gg_visible | gg_cb_on | gg_utf8_popup);</span>
<span class="lineNum">    2490 </span>            :         else
<span class="lineNum">    2491 </span><span class="lineNoCov">          0 :             gcd[k].gd.flags = (gg_enabled | gg_visible | gg_utf8_popup);</span>
<span class="lineNum">    2492 </span><span class="lineNoCov">          0 :         gcd[k].gd.popup_msg = (unichar_t *) _(&quot;Check the glyph outlines for standard errors before saving\nThis can be slow.&quot;);</span>
<span class="lineNum">    2493 </span><span class="lineNoCov">          0 :         gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">    2494 </span><span class="lineNoCov">          0 :         hvarray[hvi++] = &amp;gcd[k-1]; hvarray[hvi++] = GCD_ColSpan; hvarray[hvi++] = GCD_ColSpan;</span>
<span class="lineNum">    2495 </span><span class="lineNoCov">          0 :         hvarray[hvi++] = NULL;</span>
<span class="lineNum">    2496 </span>            : 
<span class="lineNum">    2497 </span><span class="lineNoCov">          0 :         label[k].text = (unichar_t *) _(&quot;Append a FONTLOG entry&quot;);</span>
<span class="lineNum">    2498 </span><span class="lineNoCov">          0 :         label[k].text_is_1byte = true;</span>
<span class="lineNum">    2499 </span><span class="lineNoCov">          0 :         gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2500 </span><span class="lineNoCov">          0 :         gcd[k].gd.pos.x = 8; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+24+6;</span>
<span class="lineNum">    2501 </span><span class="lineNoCov">          0 :         gcd[k].gd.flags = (gg_enabled | gg_visible | gg_utf8_popup);</span>
<span class="lineNum">    2502 </span><span class="lineNoCov">          0 :         if ( old_fontlog )</span>
<span class="lineNum">    2503 </span><span class="lineNoCov">          0 :             gcd[k].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    2504 </span><span class="lineNoCov">          0 :         gcd[k].gd.popup_msg = (unichar_t *) _(&quot;The FONTLOG allows you to keep a log of changes made to your font.&quot;);</span>
<span class="lineNum">    2505 </span><span class="lineNoCov">          0 :         gcd[k].gd.cid = CID_AppendFontLog;</span>
<span class="lineNum">    2506 </span><span class="lineNoCov">          0 :         gcd[k].gd.handle_controlevent = GFD_ToggleFontLog;</span>
<span class="lineNum">    2507 </span><span class="lineNoCov">          0 :         gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">    2508 </span><span class="lineNoCov">          0 :         hvarray[hvi++] = &amp;gcd[k-1]; hvarray[hvi++] = GCD_ColSpan; hvarray[hvi++] = GCD_ColSpan;</span>
<span class="lineNum">    2509 </span><span class="lineNoCov">          0 :         hvarray[hvi++] = NULL;</span>
<span class="lineNum">    2510 </span>            : 
<span class="lineNum">    2511 </span><span class="lineNoCov">          0 :         gcd[k].gd.flags = old_fontlog ? (gg_visible | gg_enabled | gg_textarea_wrap) : (gg_enabled|gg_textarea_wrap);</span>
<span class="lineNum">    2512 </span><span class="lineNoCov">          0 :         gcd[k].gd.cid = CID_FontLogBit;</span>
<span class="lineNum">    2513 </span><span class="lineNoCov">          0 :         gcd[k++].creator = GTextAreaCreate;</span>
<span class="lineNum">    2514 </span><span class="lineNoCov">          0 :         hvarray[hvi++] = &amp;gcd[k-1];</span>
<span class="lineNum">    2515 </span><span class="lineNoCov">          0 :         hvarray[hvi++] = GCD_ColSpan; hvarray[hvi++] = GCD_ColSpan; hvarray[hvi++] = NULL;</span>
<span class="lineNum">    2516 </span>            : 
<span class="lineNum">    2517 </span><span class="lineNoCov">          0 :         label[k].text = (unichar_t *) _(&quot;Prepend timestamp&quot;);</span>
<span class="lineNum">    2518 </span><span class="lineNoCov">          0 :         label[k].text_is_1byte = true;</span>
<span class="lineNum">    2519 </span><span class="lineNoCov">          0 :         gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2520 </span><span class="lineNoCov">          0 :         gcd[k].gd.pos.x = 8; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+24+6;</span>
<span class="lineNum">    2521 </span><span class="lineNoCov">          0 :         gcd[k].gd.flags = (gg_enabled | gg_visible | gg_utf8_popup);</span>
<span class="lineNum">    2522 </span><span class="lineNoCov">          0 :         gcd[k].gd.popup_msg = (unichar_t *) _(&quot;This option prepends a timestamp in the format YYMMDDHHMM to the filename and font-family name metadata.&quot;);</span>
<span class="lineNum">    2523 </span><span class="lineNoCov">          0 :         gcd[k].gd.cid = CID_PrependTimestamp;</span>
<span class="lineNum">    2524 </span><span class="lineNoCov">          0 :         gcd[k].gd.handle_controlevent = GFD_TogglePrependTimestamp;</span>
<span class="lineNum">    2525 </span><span class="lineNoCov">          0 :         gcd[k++].creator = GCheckBoxCreate; //???</span>
<span class="lineNum">    2526 </span><span class="lineNoCov">          0 :         hvarray[hvi++] = &amp;gcd[k-1]; hvarray[hvi++] = GCD_ColSpan; hvarray[hvi++] = GCD_ColSpan;</span>
<span class="lineNum">    2527 </span><span class="lineNoCov">          0 :         hvarray[hvi++] = NULL; hvarray[hvi++] = NULL;</span>
<span class="lineNum">    2528 </span>            :     } else {
<span class="lineNum">    2529 </span><span class="lineNoCov">          0 :         hvarray[12] = NULL;</span>
<span class="lineNum">    2530 </span>            :     }
<span class="lineNum">    2531 </span>            : 
<span class="lineNum">    2532 </span><span class="lineNoCov">          0 :     boxes[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2533 </span><span class="lineNoCov">          0 :     boxes[3].gd.u.boxelements = hvarray;</span>
<span class="lineNum">    2534 </span><span class="lineNoCov">          0 :     boxes[3].creator = GHVBoxCreate;</span>
<span class="lineNum">    2535 </span><span class="lineNoCov">          0 :     varray[2] = GCD_Glue; varray[3] = NULL;</span>
<span class="lineNum">    2536 </span><span class="lineNoCov">          0 :     varray[4] = &amp;boxes[3]; varray[5] = NULL;</span>
<span class="lineNum">    2537 </span><span class="lineNoCov">          0 :     varray[6] = GCD_Glue; varray[7] = NULL;</span>
<span class="lineNum">    2538 </span><span class="lineNoCov">          0 :     varray[8] = GCD_Glue; varray[9] = NULL;</span>
<span class="lineNum">    2539 </span><span class="lineNoCov">          0 :     varray[10] = &amp;boxes[2]; varray[11] = NULL;</span>
<span class="lineNum">    2540 </span><span class="lineNoCov">          0 :     varray[12] = NULL;</span>
<span class="lineNum">    2541 </span>            : 
<span class="lineNum">    2542 </span><span class="lineNoCov">          0 :     if ( family ) {</span>
<span class="lineNum">    2543 </span><span class="lineNoCov">          0 :         y = 276;</span>
<span class="lineNum">    2544 </span>            : 
<span class="lineNum">    2545 </span><span class="lineNoCov">          0 :         f = 0;</span>
<span class="lineNum">    2546 </span><span class="lineNoCov">          0 :         gcd[k].gd.pos.x = 5; gcd[k].gd.pos.y = y;</span>
<span class="lineNum">    2547 </span><span class="lineNoCov">          0 :         gcd[k].gd.pos.width = totwid-5-5;</span>
<span class="lineNum">    2548 </span><span class="lineNoCov">          0 :         gcd[k].gd.flags = gg_visible | gg_enabled ;</span>
<span class="lineNum">    2549 </span><span class="lineNoCov">          0 :         gcd[k++].creator = GLineCreate;</span>
<span class="lineNum">    2550 </span><span class="lineNoCov">          0 :         famarray[f++] = &amp;gcd[k-1]; famarray[f++] = GCD_ColSpan; famarray[f++] = NULL;</span>
<span class="lineNum">    2551 </span><span class="lineNoCov">          0 :         y += 7;</span>
<span class="lineNum">    2552 </span>            : 
<span class="lineNum">    2553 </span><span class="lineNoCov">          0 :         for ( i=0, fc=0, j=1; i&lt;familycnt &amp;&amp; j&lt;48 ; ++i ) {</span>
<span class="lineNum">    2554 </span><span class="lineNoCov">          0 :             while ( fc&lt;fondcnt ) {</span>
<span class="lineNum">    2555 </span><span class="lineNoCov">          0 :                 while ( j&lt;48 &amp;&amp; familysfs[fc][j]==NULL ) ++j;</span>
<span class="lineNum">    2556 </span><span class="lineNoCov">          0 :                 if ( j!=48 )</span>
<span class="lineNum">    2557 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2558 </span><span class="lineNoCov">          0 :                 ++fc;</span>
<span class="lineNum">    2559 </span><span class="lineNoCov">          0 :                 j=0;</span>
<span class="lineNum">    2560 </span>            :             }
<span class="lineNum">    2561 </span><span class="lineNoCov">          0 :             if ( fc==fondcnt )</span>
<span class="lineNum">    2562 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2563 </span><span class="lineNoCov">          0 :             gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = y;</span>
<span class="lineNum">    2564 </span><span class="lineNoCov">          0 :             gcd[k].gd.pos.width = gcd[8].gd.pos.x-gcd[k].gd.pos.x-5;</span>
<span class="lineNum">    2565 </span><span class="lineNoCov">          0 :             gcd[k].gd.flags = gg_visible | gg_enabled | gg_cb_on ;</span>
<span class="lineNum">    2566 </span><span class="lineNoCov">          0 :             label[k].text = (unichar_t *) (familysfs[fc][j]-&gt;fontname);</span>
<span class="lineNum">    2567 </span><span class="lineNoCov">          0 :             label[k].text_is_1byte = true;</span>
<span class="lineNum">    2568 </span><span class="lineNoCov">          0 :             gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2569 </span><span class="lineNoCov">          0 :             gcd[k].gd.cid = CID_Family+i*10;</span>
<span class="lineNum">    2570 </span><span class="lineNoCov">          0 :             gcd[k].data = familysfs[fc][j];</span>
<span class="lineNum">    2571 </span><span class="lineNoCov">          0 :             gcd[k].gd.popup_msg = uStyleName(familysfs[fc][j]);</span>
<span class="lineNum">    2572 </span><span class="lineNoCov">          0 :             gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">    2573 </span><span class="lineNoCov">          0 :             famarray[f++] = &amp;gcd[k-1];</span>
<span class="lineNum">    2574 </span>            : 
<span class="lineNum">    2575 </span><span class="lineNoCov">          0 :             gcd[k].gd.pos.x = gcd[8].gd.pos.x; gcd[k].gd.pos.y = y; gcd[k].gd.pos.width = gcd[8].gd.pos.width;</span>
<span class="lineNum">    2576 </span><span class="lineNoCov">          0 :             gcd[k].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2577 </span><span class="lineNoCov">          0 :             if ( old==bf_none )</span>
<span class="lineNum">    2578 </span><span class="lineNoCov">          0 :                 gcd[k].gd.flags &amp;= ~gg_enabled;</span>
<span class="lineNum">    2579 </span><span class="lineNoCov">          0 :             temp = familysfs[fc][j]-&gt;cidmaster ? familysfs[fc][j]-&gt;cidmaster : familysfs[fc][j];</span>
<span class="lineNum">    2580 </span><span class="lineNoCov">          0 :             label[k].text = BitmapList(temp);</span>
<span class="lineNum">    2581 </span><span class="lineNoCov">          0 :             gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2582 </span><span class="lineNoCov">          0 :             gcd[k].gd.cid = CID_Family+i*10+1;</span>
<span class="lineNum">    2583 </span><span class="lineNoCov">          0 :             gcd[k].data = familysfs[fc][j];</span>
<span class="lineNum">    2584 </span><span class="lineNoCov">          0 :             gcd[k++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2585 </span><span class="lineNoCov">          0 :             famarray[f++] = &amp;gcd[k-1]; famarray[f++] = NULL;</span>
<span class="lineNum">    2586 </span><span class="lineNoCov">          0 :             y+=26;</span>
<span class="lineNum">    2587 </span><span class="lineNoCov">          0 :             ++j;</span>
<span class="lineNum">    2588 </span>            :         }
<span class="lineNum">    2589 </span>            : 
<span class="lineNum">    2590 </span><span class="lineNoCov">          0 :         gcd[k].gd.pos.x = 5; gcd[k].gd.pos.y = y;</span>
<span class="lineNum">    2591 </span><span class="lineNoCov">          0 :         gcd[k].gd.pos.width = totwid-5-5;</span>
<span class="lineNum">    2592 </span><span class="lineNoCov">          0 :         gcd[k].gd.flags = gg_visible | gg_enabled ;</span>
<span class="lineNum">    2593 </span><span class="lineNoCov">          0 :         gcd[k++].creator = GLineCreate;</span>
<span class="lineNum">    2594 </span><span class="lineNoCov">          0 :         famarray[f++] = &amp;gcd[k-1]; famarray[f++] = GCD_ColSpan; famarray[f++] = NULL;</span>
<span class="lineNum">    2595 </span><span class="lineNoCov">          0 :         if ( family == gf_ttc ) {</span>
<span class="lineNum">    2596 </span><span class="lineNoCov">          0 :             gcd[k].gd.flags = gg_visible | gg_enabled | gg_cb_on | gg_utf8_popup ;</span>
<span class="lineNum">    2597 </span><span class="lineNoCov">          0 :             label[k].text = (unichar_t *) _(&quot;Merge tables across fonts&quot;);</span>
<span class="lineNum">    2598 </span><span class="lineNoCov">          0 :             label[k].text_is_1byte = true;</span>
<span class="lineNum">    2599 </span><span class="lineNoCov">          0 :             gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2600 </span><span class="lineNoCov">          0 :             gcd[k].gd.cid = CID_MergeTables;</span>
<span class="lineNum">    2601 </span><span class="lineNoCov">          0 :             gcd[k].gd.popup_msg = (unichar_t *) copy(_(</span>
<span class="lineNum">    2602 </span>            :                 &quot;FontForge can generate two styles of ttc file.\n&quot;
<span class="lineNum">    2603 </span>            :                 &quot;In the first each font is a separate entity\n&quot;
<span class="lineNum">    2604 </span>            :                 &quot;with no connection to other fonts. In the second\n&quot;
<span class="lineNum">    2605 </span>            :                 &quot;FontForge will attempt to use the same glyph table\n&quot;
<span class="lineNum">    2606 </span>            :                 &quot;for all fonts, merging duplicate glyphs. It will\n&quot;
<span class="lineNum">    2607 </span>            :                 &quot;also attempt to use the same space for tables in\n&quot;
<span class="lineNum">    2608 </span>            :                 &quot;different fonts which are bit by bit the same.\n\n&quot;
<span class="lineNum">    2609 </span>            :                 &quot;FontForge isn't always able to perform a merge, in\n&quot;
<span class="lineNum">    2610 </span>            :                 &quot;which case it falls back on generating independent\n&quot;
<span class="lineNum">    2611 </span>            :                 &quot;fonts within the ttc.\n&quot;
<span class="lineNum">    2612 </span>            :                 &quot; FontForge cannot merge if:\n&quot;
<span class="lineNum">    2613 </span>            :                 &quot;  * The fonts have different em-sizes\n&quot;
<span class="lineNum">    2614 </span>            :                 &quot;  * Bitmaps are involved\n&quot;
<span class="lineNum">    2615 </span>            :                 &quot;  * The merged glyf table has more than 65534 glyphs\n\n&quot;
<span class="lineNum">    2616 </span>            :                 &quot;(Merging will take longer)&quot; ));
<span class="lineNum">    2617 </span><span class="lineNoCov">          0 :             gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">    2618 </span><span class="lineNoCov">          0 :             famarray[f++] = &amp;gcd[k-1]; famarray[f++] = GCD_ColSpan; famarray[f++] = NULL;</span>
<span class="lineNum">    2619 </span>            : 
<span class="lineNum">    2620 </span><span class="lineNoCov">          0 :             gcd[k].gd.flags = gg_visible | gg_enabled | gg_utf8_popup ;</span>
<span class="lineNum">    2621 </span><span class="lineNoCov">          0 :             label[k].text = (unichar_t *) _(&quot;As CFF fonts&quot;);</span>
<span class="lineNum">    2622 </span><span class="lineNoCov">          0 :             label[k].text_is_1byte = true;</span>
<span class="lineNum">    2623 </span><span class="lineNoCov">          0 :             gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2624 </span><span class="lineNoCov">          0 :             gcd[k].gd.cid = CID_TTC_CFF;</span>
<span class="lineNum">    2625 </span><span class="lineNoCov">          0 :             gcd[k].gd.popup_msg = (unichar_t *) copy(_(</span>
<span class="lineNum">    2626 </span>            :                 &quot;Put CFF fonts into the ttc rather than TTF.\n These seem to work on the mac and linux\n but are documented not to work on Windows.&quot; ));
<span class="lineNum">    2627 </span><span class="lineNoCov">          0 :             gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">    2628 </span><span class="lineNoCov">          0 :             famarray[f++] = &amp;gcd[k-1]; famarray[f++] = GCD_ColSpan; famarray[f++] = NULL;</span>
<span class="lineNum">    2629 </span>            :         }
<span class="lineNum">    2630 </span><span class="lineNoCov">          0 :         famarray[f++] = NULL;</span>
<span class="lineNum">    2631 </span>            : 
<span class="lineNum">    2632 </span><span class="lineNoCov">          0 :         free(familysfs);</span>
<span class="lineNum">    2633 </span>            : 
<span class="lineNum">    2634 </span><span class="lineNoCov">          0 :         boxes[4].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2635 </span><span class="lineNoCov">          0 :         boxes[4].gd.u.boxelements = famarray;</span>
<span class="lineNum">    2636 </span><span class="lineNoCov">          0 :         boxes[4].creator = GHVBoxCreate;</span>
<span class="lineNum">    2637 </span><span class="lineNoCov">          0 :         varray[6] = &amp;boxes[4];</span>
<span class="lineNum">    2638 </span>            :     }
<span class="lineNum">    2639 </span>            : 
<span class="lineNum">    2640 </span><span class="lineNoCov">          0 :     boxes[0].gd.pos.x = boxes[0].gd.pos.y = 2;</span>
<span class="lineNum">    2641 </span><span class="lineNoCov">          0 :     boxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2642 </span><span class="lineNoCov">          0 :     boxes[0].gd.u.boxelements = varray;</span>
<span class="lineNum">    2643 </span><span class="lineNoCov">          0 :     boxes[0].creator = GHVGroupCreate;</span>
<span class="lineNum">    2644 </span>            : 
<span class="lineNum">    2645 </span><span class="lineNoCov">          0 :     GGadgetsCreate(gw,boxes);</span>
<span class="lineNum">    2646 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(boxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    2647 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(boxes[2].ret,gb_expandgluesame);</span>
<span class="lineNum">    2648 </span><span class="lineNoCov">          0 :     GHVBoxFitWindow(boxes[0].ret);</span>
<span class="lineNum">    2649 </span>            : 
<span class="lineNum">    2650 </span><span class="lineNoCov">          0 :     GGadgetSetUserData(gcd[2].ret,gcd[0].ret);</span>
<span class="lineNum">    2651 </span><span class="lineNoCov">          0 :     free(namelistnames);</span>
<span class="lineNum">    2652 </span><span class="lineNoCov">          0 :     free(lynames);</span>
<span class="lineNum">    2653 </span><span class="lineNoCov">          0 :     free(label[9].text);</span>
<span class="lineNum">    2654 </span><span class="lineNoCov">          0 :     if ( family ) {</span>
<span class="lineNum">    2655 </span><span class="lineNoCov">          0 :         for ( i=13; i&lt;k; ++i )</span>
<span class="lineNum">    2656 </span><span class="lineNoCov">          0 :             free((unichar_t *) gcd[i].gd.popup_msg);</span>
<span class="lineNum">    2657 </span>            :     }
<span class="lineNum">    2658 </span>            : 
<span class="lineNum">    2659 </span><span class="lineNoCov">          0 :     GFileChooserConnectButtons(gcd[0].ret,gcd[1].ret,gcd[2].ret);</span>
<span class="lineNum">    2660 </span>            :     {
<span class="lineNum">    2661 </span><span class="lineNoCov">          0 :         SplineFont *master = sf-&gt;cidmaster ? sf-&gt;cidmaster : sf;</span>
<span class="lineNum">    2662 </span><span class="lineNoCov">          0 :         char *fn = master-&gt;defbasefilename!=NULL ? master-&gt;defbasefilename :</span>
<span class="lineNum">    2663 </span>            :                 master-&gt;fontname;
<span class="lineNum">    2664 </span><span class="lineNoCov">          0 :         unichar_t *temp = malloc(sizeof(unichar_t)*(strlen(fn)+30));</span>
<span class="lineNum">    2665 </span><span class="lineNoCov">          0 :         uc_strcpy(temp,fn);</span>
<span class="lineNum">    2666 </span><span class="lineNoCov">          0 :         uc_strcat(temp,savefont_extensions[ofs]!=NULL?savefont_extensions[ofs]:bitmapextensions[old]);</span>
<span class="lineNum">    2667 </span><span class="lineNoCov">          0 :         GGadgetSetTitle(gcd[0].ret,temp);</span>
<span class="lineNum">    2668 </span><span class="lineNoCov">          0 :         free(temp);</span>
<span class="lineNum">    2669 </span>            :     }
<span class="lineNum">    2670 </span><span class="lineNoCov">          0 :     GFileChooserGetChildren(gcd[0].ret,&amp;pulldown,&amp;files,&amp;tf);</span>
<span class="lineNum">    2671 </span><span class="lineNoCov">          0 :     GWidgetIndicateFocusGadget(tf);</span>
<span class="lineNum">    2672 </span>            : #if __Mac
<span class="lineNum">    2673 </span>            :         /* The name of the postscript file is fixed and depends solely on */
<span class="lineNum">    2674 </span>            :         /*  the font name. If the user tried to change it, the font would */
<span class="lineNum">    2675 </span>            :         /*  not be found */
<span class="lineNum">    2676 </span>            :         GGadgetSetVisible(tf,ofs!=ff_pfbmacbin);
<span class="lineNum">    2677 </span>            : #endif
<span class="lineNum">    2678 </span>            : 
<span class="lineNum">    2679 </span><span class="lineNoCov">          0 :     d.sf = sf;</span>
<span class="lineNum">    2680 </span><span class="lineNoCov">          0 :     d.map = map;</span>
<span class="lineNum">    2681 </span><span class="lineNoCov">          0 :     d.family = family;</span>
<span class="lineNum">    2682 </span><span class="lineNoCov">          0 :     d.familycnt = familycnt-1;          /* Don't include the &quot;normal&quot; instance */</span>
<span class="lineNum">    2683 </span><span class="lineNoCov">          0 :     d.gfc = gcd[0].ret;</span>
<span class="lineNum">    2684 </span><span class="lineNoCov">          0 :     d.pstype = gcd[6].ret;</span>
<span class="lineNum">    2685 </span><span class="lineNoCov">          0 :     d.bmptype = gcd[8].ret;</span>
<span class="lineNum">    2686 </span><span class="lineNoCov">          0 :     d.bmpsizes = gcd[9].ret;</span>
<span class="lineNum">    2687 </span><span class="lineNoCov">          0 :     d.rename = gcd[rk].ret;</span>
<span class="lineNum">    2688 </span><span class="lineNoCov">          0 :     d.validate = family ? NULL : gcd[vk].ret;</span>
<span class="lineNum">    2689 </span><span class="lineNoCov">          0 :     d.gw = gw;</span>
<span class="lineNum">    2690 </span>            : 
<span class="lineNum">    2691 </span><span class="lineNoCov">          0 :     d.ps_flags = old_ps_flags;</span>
<span class="lineNum">    2692 </span><span class="lineNoCov">          0 :     d.sfnt_flags = old_sfnt_flags;</span>
<span class="lineNum">    2693 </span><span class="lineNoCov">          0 :     d.psotb_flags = old_ps_flags | (old_psotb_flags&amp;~ps_flag_mask);</span>
<span class="lineNum">    2694 </span>            : 
<span class="lineNum">    2695 </span><span class="lineNoCov">          0 :     GFD_FigureWhich(&amp;d);</span>
<span class="lineNum">    2696 </span>            : 
<span class="lineNum">    2697 </span><span class="lineNoCov">          0 :     GWidgetHidePalettes();</span>
<span class="lineNum">    2698 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<span class="lineNum">    2699 </span><span class="lineNoCov">          0 :     while ( !d.done )</span>
<span class="lineNum">    2700 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">    2701 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(gw);</span>
<span class="lineNum">    2702 </span><span class="lineNoCov">          0 : return(d.ret);</span>
<span class="lineNum">    2703 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
