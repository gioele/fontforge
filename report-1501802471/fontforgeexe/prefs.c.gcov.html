<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd) - fontforgeexe/prefs.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">fontforgeexe</a> - prefs.c<span style="font-size: 80%;"> (source / <a href="prefs.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd)</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">137</td>
            <td class="headerCovTableEntry">1728</td>
            <td class="headerCovTableEntryLo">7.9 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-08-04</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">14</td>
            <td class="headerCovTableEntry">46</td>
            <td class="headerCovTableEntryLo">30.4 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* -*- coding: utf-8 -*- */</a>
<span class="lineNum">       2 </span>            : /* Copyright (C) 2000-2012 by George Williams */
<span class="lineNum">       3 </span>            : /*
<span class="lineNum">       4 </span>            :  * Redistribution and use in source and binary forms, with or without
<span class="lineNum">       5 </span>            :  * modification, are permitted provided that the following conditions are met:
<span class="lineNum">       6 </span>            : 
<span class="lineNum">       7 </span>            :  * Redistributions of source code must retain the above copyright notice, this
<span class="lineNum">       8 </span>            :  * list of conditions and the following disclaimer.
<span class="lineNum">       9 </span>            : 
<span class="lineNum">      10 </span>            :  * Redistributions in binary form must reproduce the above copyright notice,
<span class="lineNum">      11 </span>            :  * this list of conditions and the following disclaimer in the documentation
<span class="lineNum">      12 </span>            :  * and/or other materials provided with the distribution.
<span class="lineNum">      13 </span>            : 
<span class="lineNum">      14 </span>            :  * The name of the author may not be used to endorse or promote products
<span class="lineNum">      15 </span>            :  * derived from this software without specific prior written permission.
<span class="lineNum">      16 </span>            : 
<span class="lineNum">      17 </span>            :  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
<span class="lineNum">      18 </span>            :  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
<span class="lineNum">      19 </span>            :  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
<span class="lineNum">      20 </span>            :  * EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span class="lineNum">      21 </span>            :  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
<span class="lineNum">      22 </span>            :  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
<span class="lineNum">      23 </span>            :  * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
<span class="lineNum">      24 </span>            :  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
<span class="lineNum">      25 </span>            :  * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
<span class="lineNum">      26 </span>            :  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span class="lineNum">      27 </span>            :  */
<span class="lineNum">      28 </span>            : #include &quot;autotrace.h&quot;
<span class="lineNum">      29 </span>            : #include &quot;encoding.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;fontforgeui.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;groups.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;macenc.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;namelist.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;othersubrs.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;plugins.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;sfd.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;splineutil.h&quot;
<span class="lineNum">      38 </span>            : #include &lt;charset.h&gt;
<span class="lineNum">      39 </span>            : #include &lt;gfile.h&gt;
<span class="lineNum">      40 </span>            : #include &lt;gresource.h&gt;
<span class="lineNum">      41 </span>            : #include &lt;gresedit.h&gt;
<span class="lineNum">      42 </span>            : #include &lt;ustring.h&gt;
<span class="lineNum">      43 </span>            : #include &lt;gkeysym.h&gt;
<span class="lineNum">      44 </span>            : 
<span class="lineNum">      45 </span>            : #include &lt;sys/types.h&gt;
<span class="lineNum">      46 </span>            : #include &lt;dirent.h&gt;
<span class="lineNum">      47 </span>            : #include &lt;locale.h&gt;
<span class="lineNum">      48 </span>            : #include &lt;time.h&gt;
<span class="lineNum">      49 </span>            : #include &lt;sys/time.h&gt;
<span class="lineNum">      50 </span>            : #include &lt;stdlib.h&gt;
<span class="lineNum">      51 </span>            : 
<span class="lineNum">      52 </span>            : #include &quot;ttf.h&quot;
<span class="lineNum">      53 </span>            : 
<span class="lineNum">      54 </span>            : #if HAVE_LANGINFO_H
<span class="lineNum">      55 </span>            : # include &lt;langinfo.h&gt;
<span class="lineNum">      56 </span>            : #endif
<span class="lineNum">      57 </span>            : 
<span class="lineNum">      58 </span>            : #define GTimer GTimer_GTK
<span class="lineNum">      59 </span>            : #include &lt;glib.h&gt;
<span class="lineNum">      60 </span>            : #undef GTimer
<span class="lineNum">      61 </span>            : 
<span class="lineNum">      62 </span>            : #include &quot;collabclient.h&quot;
<span class="lineNum">      63 </span>            : 
<span class="lineNum">      64 </span>            : #define RAD2DEG (180/3.1415926535897932)
<span class="lineNum">      65 </span>            : 
<span class="lineNum">      66 </span>            : static void change_res_filename(const char *newname);
<span class="lineNum">      67 </span>            : 
<span class="lineNum">      68 </span>            : #include &quot;gutils/prefs.h&quot;
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span>            : extern int splash;
<span class="lineNum">      71 </span>            : extern int adjustwidth;
<span class="lineNum">      72 </span>            : extern int adjustlbearing;
<span class="lineNum">      73 </span>            : extern Encoding *default_encoding;
<span class="lineNum">      74 </span>            : extern int autohint_before_generate;
<span class="lineNum">      75 </span>            : extern int use_freetype_to_rasterize_fv;
<span class="lineNum">      76 </span>            : extern int use_freetype_with_aa_fill_cv;
<span class="lineNum">      77 </span>            : extern int OpenCharsInNewWindow;
<span class="lineNum">      78 </span>            : extern int ItalicConstrained;
<span class="lineNum">      79 </span>            : extern int accent_offset;
<span class="lineNum">      80 </span>            : extern int GraveAcuteCenterBottom;
<span class="lineNum">      81 </span>            : extern int PreferSpacingAccents;
<span class="lineNum">      82 </span>            : extern int CharCenterHighest;
<span class="lineNum">      83 </span>            : extern int ask_user_for_resolution;
<span class="lineNum">      84 </span>            : extern int stop_at_join;
<span class="lineNum">      85 </span>            : extern int recognizePUA;
<span class="lineNum">      86 </span>            : extern float arrowAmount;
<span class="lineNum">      87 </span>            : extern float arrowAccelFactor;
<span class="lineNum">      88 </span>            : extern float snapdistance;
<span class="lineNum">      89 </span>            : extern float snapdistancemeasuretool;
<span class="lineNum">      90 </span>            : extern int measuretoolshowhorizontolvertical;
<span class="lineNum">      91 </span>            : extern int xorrubberlines;
<span class="lineNum">      92 </span>            : extern int snaptoint;
<span class="lineNum">      93 </span>            : extern float joinsnap;
<span class="lineNum">      94 </span>            : extern char *BDFFoundry;
<span class="lineNum">      95 </span>            : extern char *TTFFoundry;
<span class="lineNum">      96 </span>            : extern char *xuid;
<span class="lineNum">      97 </span>            : extern char *SaveTablesPref;
<span class="lineNum">      98 </span>            : /*struct cvshows CVShows = { 1, 1, 1, 1, 1, 0, 1 };*/ /* in charview */
<span class="lineNum">      99 </span>            : /* int default_fv_font_size = 24; */    /* in fontview */
<span class="lineNum">     100 </span>            : /* int default_fv_antialias = false */  /* in fontview */
<span class="lineNum">     101 </span>            : /* int default_fv_bbsized = false */    /* in fontview */
<span class="lineNum">     102 </span>            : extern int default_fv_row_count;        /* in fontview */
<span class="lineNum">     103 </span>            : extern int default_fv_col_count;        /* in fontview */
<span class="lineNum">     104 </span>            : extern int default_fv_showhmetrics;     /* in fontview */
<span class="lineNum">     105 </span>            : extern int default_fv_showvmetrics;     /* in fontview */
<span class="lineNum">     106 </span>            : extern int default_fv_glyphlabel;       /* in fontview */
<span class="lineNum">     107 </span>            : extern int save_to_dir;                 /* in fontview, use sfdir rather than sfd */
<span class="lineNum">     108 </span>            : extern int palettes_docked;             /* in cvpalettes */
<span class="lineNum">     109 </span>            : extern int cvvisible[2], bvvisible[3];  /* in cvpalettes.c */
<span class="lineNum">     110 </span>            : extern int maxundoes;                   /* in cvundoes */
<span class="lineNum">     111 </span>            : extern int pref_mv_shift_and_arrow_skip;         /* in metricsview.c */
<span class="lineNum">     112 </span>            : extern int pref_mv_control_shift_and_arrow_skip; /* in metricsview.c */
<span class="lineNum">     113 </span>            : extern int mv_type;                              /* in metricsview.c */
<span class="lineNum">     114 </span>            : extern int prefer_cjk_encodings;        /* in parsettf */
<span class="lineNum">     115 </span>            : extern int onlycopydisplayed, copymetadata, copyttfinstr;
<span class="lineNum">     116 </span>            : extern struct cvshows CVShows;
<span class="lineNum">     117 </span>            : extern int infowindowdistance;          /* in cvruler.c */
<span class="lineNum">     118 </span>            : extern int oldformatstate;              /* in savefontdlg.c */
<span class="lineNum">     119 </span>            : extern int oldbitmapstate;              /* in savefontdlg.c */
<span class="lineNum">     120 </span>            : static int old_ttf_flags=0, old_otf_flags=0;
<span class="lineNum">     121 </span>            : extern int old_sfnt_flags;              /* in savefont.c */
<span class="lineNum">     122 </span>            : extern int old_ps_flags;                /* in savefont.c */
<span class="lineNum">     123 </span>            : extern int old_validate;                /* in savefontdlg.c */
<span class="lineNum">     124 </span>            : extern int old_fontlog;                 /* in savefontdlg.c */
<span class="lineNum">     125 </span>            : extern int oldsystem;                   /* in bitmapdlg.c */
<span class="lineNum">     126 </span>            : extern int preferpotrace;               /* in autotrace.c */
<span class="lineNum">     127 </span>            : extern int autotrace_ask;               /* in autotrace.c */
<span class="lineNum">     128 </span>            : extern int mf_ask;                      /* in autotrace.c */
<span class="lineNum">     129 </span>            : extern int mf_clearbackgrounds;         /* in autotrace.c */
<span class="lineNum">     130 </span>            : extern int mf_showerrors;               /* in autotrace.c */
<span class="lineNum">     131 </span>            : extern char *mf_args;                   /* in autotrace.c */
<span class="lineNum">     132 </span>            : static int glyph_2_name_map=0;          /* was in tottf.c, now a flag in savefont options dlg */
<span class="lineNum">     133 </span>            : extern int coverageformatsallowed;      /* in tottfgpos.c */
<span class="lineNum">     134 </span>            : extern int debug_wins;                  /* in cvdebug.c */
<span class="lineNum">     135 </span>            : extern int gridfit_dpi, gridfit_depth;  /* in cvgridfit.c */
<span class="lineNum">     136 </span>            : extern float gridfit_pointsizey;        /* in cvgridfit.c */
<span class="lineNum">     137 </span>            : extern float gridfit_pointsizex;        /* in cvgridfit.c */
<span class="lineNum">     138 </span>            : extern int gridfit_x_sameas_y;          /* in cvgridfit.c */
<span class="lineNum">     139 </span>            : extern int hint_diagonal_ends;          /* in stemdb.c */
<span class="lineNum">     140 </span>            : extern int hint_diagonal_intersections; /* in stemdb.c */
<span class="lineNum">     141 </span>            : extern int hint_bounding_boxes;         /* in stemdb.c */
<span class="lineNum">     142 </span>            : extern int detect_diagonal_stems;       /* in stemdb.c */
<span class="lineNum">     143 </span>            : extern float stem_slope_error;          /* in stemdb.c */
<span class="lineNum">     144 </span>            : extern float stub_slope_error;          /* in stemdb.c */
<span class="lineNum">     145 </span>            : extern int instruct_diagonal_stems;     /* in nowakowskittfinstr.c */
<span class="lineNum">     146 </span>            : extern int instruct_serif_stems;                /* in nowakowskittfinstr.c */
<span class="lineNum">     147 </span>            : extern int instruct_ball_terminals;     /* in nowakowskittfinstr.c */
<span class="lineNum">     148 </span>            : extern int interpolate_strong;          /* in nowakowskittfinstr.c */
<span class="lineNum">     149 </span>            : extern int control_counters;            /* in nowakowskittfinstr.c */
<span class="lineNum">     150 </span>            : extern unichar_t *script_menu_names[SCRIPT_MENU_MAX];
<span class="lineNum">     151 </span>            : extern char *script_filenames[SCRIPT_MENU_MAX];
<span class="lineNum">     152 </span>            : static char *xdefs_filename;
<span class="lineNum">     153 </span>            : extern int new_em_size;                         /* in splineutil2.c */
<span class="lineNum">     154 </span>            : extern int new_fonts_are_order2;                /* in splineutil2.c */
<span class="lineNum">     155 </span>            : extern int loaded_fonts_same_as_new;            /* in splineutil2.c */
<span class="lineNum">     156 </span>            : extern int use_second_indic_scripts;            /* in tottfgpos.c */
<span class="lineNum">     157 </span>            : static char *othersubrsfile = NULL;
<span class="lineNum">     158 </span>            : extern MacFeat *default_mac_feature_map,        /* from macenc.c */
<span class="lineNum">     159 </span>            :                 *user_mac_feature_map;
<span class="lineNum">     160 </span>            : extern int updateflex;                          /* in charview.c */
<span class="lineNum">     161 </span>            : extern int default_autokern_dlg;                /* in lookupui.c */
<span class="lineNum">     162 </span>            : extern int allow_utf8_glyphnames;               /* in lookupui.c */
<span class="lineNum">     163 </span>            : extern int add_char_to_name_list;               /* in charinfo.c */
<span class="lineNum">     164 </span>            : extern int clear_tt_instructions_when_needed;   /* in cvundoes.c */
<span class="lineNum">     165 </span>            : extern int export_clipboard;                    /* in cvundoes.c */
<span class="lineNum">     166 </span>            : extern int cv_width;                    /* in charview.c */
<span class="lineNum">     167 </span>            : extern int cv_height;                   /* in charview.c */
<span class="lineNum">     168 </span>            : extern int cv_show_fill_with_space; /* in charview.c */
<span class="lineNum">     169 </span>            : extern int interpCPsOnMotion;                   /* in charview.c */
<span class="lineNum">     170 </span>            : extern int DrawOpenPathsWithHighlight;          /* in charview.c */
<span class="lineNum">     171 </span>            : extern float prefs_cvEditHandleSize;            /* in charview.c */
<span class="lineNum">     172 </span>            : extern int prefs_cvInactiveHandleAlpha;         /* in charview.c */
<span class="lineNum">     173 </span>            : extern int mv_width;                            /* in metricsview.c */
<span class="lineNum">     174 </span>            : extern int mv_height;                           /* in metricsview.c */
<span class="lineNum">     175 </span>            : extern int bv_width;                            /* in bitmapview.c */
<span class="lineNum">     176 </span>            : extern int bv_height;                           /* in bitmapview.c */
<span class="lineNum">     177 </span>            : extern int ask_user_for_cmap;                   /* in parsettf.c */
<span class="lineNum">     178 </span>            : extern int mvshowgrid;                          /* in metricsview.c */
<span class="lineNum">     179 </span>            : 
<span class="lineNum">     180 </span>            : extern int rectelipse, polystar, regular_star;  /* from cvpalettes.c */
<span class="lineNum">     181 </span>            : extern int center_out[2];                       /* from cvpalettes.c */
<span class="lineNum">     182 </span>            : extern float rr_radius;                         /* from cvpalettes.c */
<span class="lineNum">     183 </span>            : extern int ps_pointcnt;                         /* from cvpalettes.c */
<span class="lineNum">     184 </span>            : extern float star_percent;                      /* from cvpalettes.c */
<span class="lineNum">     185 </span>            : extern int home_char;                           /* from fontview.c */
<span class="lineNum">     186 </span>            : extern int compact_font_on_open;                /* from fontview.c */
<span class="lineNum">     187 </span>            : extern int aa_pixelsize;                        /* from anchorsaway.c */
<span class="lineNum">     188 </span>            : extern enum cvtools cv_b1_tool, cv_cb1_tool, cv_b2_tool, cv_cb2_tool; /* cvpalettes.c */
<span class="lineNum">     189 </span>            : extern int show_kerning_pane_in_class;          /* kernclass.c */
<span class="lineNum">     190 </span>            : extern int AutoSaveFrequency;                   /* autosave.c */
<span class="lineNum">     191 </span>            : extern int UndoRedoLimitToSave;  /* sfd.c */
<span class="lineNum">     192 </span>            : extern int UndoRedoLimitToLoad;  /* sfd.c */
<span class="lineNum">     193 </span>            : extern int prefRevisionsToRetain; /* sfd.c */
<span class="lineNum">     194 </span>            : extern int prefs_cv_show_control_points_always_initially; /* from charview.c */
<span class="lineNum">     195 </span>            : extern int prefs_create_dragging_comparison_outline;      /* from charview.c */
<span class="lineNum">     196 </span>            : extern int prefs_cv_outline_thickness; /* from charview.c */
<span class="lineNum">     197 </span>            : 
<span class="lineNum">     198 </span>            : extern char *pref_collab_last_server_connected_to; /* in collabclient.c */
<span class="lineNum">     199 </span>            : 
<span class="lineNum">     200 </span>            : extern float OpenTypeLoadHintEqualityTolerance;  /* autohint.c */
<span class="lineNum">     201 </span>            : extern float GenerateHintWidthEqualityTolerance; /* splinesave.c */
<span class="lineNum">     202 </span>            : extern NameList *force_names_when_opening;
<span class="lineNum">     203 </span>            : extern NameList *force_names_when_saving;
<span class="lineNum">     204 </span>            : extern NameList *namelist_for_new_fonts;
<span class="lineNum">     205 </span>            : 
<span class="lineNum">     206 </span>            : extern int default_font_filter_index;
<span class="lineNum">     207 </span>            : extern struct openfilefilters *user_font_filters;
<span class="lineNum">     208 </span>            : static int alwaysgenapple=false, alwaysgenopentype=false;
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span>            : static int gfc_showhidden, gfc_dirplace;
<span class="lineNum">     211 </span>            : static char *gfc_bookmarks=NULL;
<span class="lineNum">     212 </span>            : 
<span class="lineNum">     213 </span>            : static int prefs_usecairo = true;
<span class="lineNum">     214 </span>            : 
<span class="lineNum">     215 </span>            : static int pointless;
<span class="lineNum">     216 </span>            : 
<span class="lineNum">     217 </span>            :     /* These first three must match the values in macenc.c */
<span class="lineNum">     218 </span>            : #define CID_Features    101
<span class="lineNum">     219 </span>            : #define CID_FeatureDel  103
<span class="lineNum">     220 </span>            : #define CID_FeatureEdit 105
<span class="lineNum">     221 </span>            : 
<span class="lineNum">     222 </span>            : #define CID_Mapping     102
<span class="lineNum">     223 </span>            : #define CID_MappingDel  104
<span class="lineNum">     224 </span>            : #define CID_MappingEdit 106
<span class="lineNum">     225 </span>            : 
<span class="lineNum">     226 </span>            : #define CID_ScriptMNameBase     200
<span class="lineNum">     227 </span>            : #define CID_ScriptMFileBase     (200+SCRIPT_MENU_MAX)
<span class="lineNum">     228 </span>            : #define CID_ScriptMBrowseBase   (200+2*SCRIPT_MENU_MAX)
<span class="lineNum">     229 </span>            : 
<span class="lineNum">     230 </span>            : #define CID_PrefsBase   1000
<span class="lineNum">     231 </span>            : #define CID_PrefsOffset 100
<span class="lineNum">     232 </span>            : #define CID_PrefsBrowseOffset   (CID_PrefsOffset/2)
<span class="lineNum">     233 </span>            : 
<span class="lineNum">     234 </span>            : //////////////////////////////////
<span class="lineNum">     235 </span>            : // The _oldval_ are used to cache the setting when the prefs window
<span class="lineNum">     236 </span>            : // is created so that a redraw can be performed only when the
<span class="lineNum">     237 </span>            : // value has changed.
<span class="lineNum">     238 </span>            : float prefs_oldval_cvEditHandleSize = 0;
<span class="lineNum">     239 </span>            : int   prefs_oldval_cvInactiveHandleAlpha = 0;
<span class="lineNum">     240 </span>            : 
<span class="lineNum">     241 </span>            : /* ************************************************************************** */
<span class="lineNum">     242 </span>            : /* *****************************    mac data    ***************************** */
<span class="lineNum">     243 </span>            : /* ************************************************************************** */
<span class="lineNum">     244 </span>            : 
<a name="245"><span class="lineNum">     245 </span>            : extern struct macsettingname macfeat_otftag[], *user_macfeat_otftag;</a>
<span class="lineNum">     246 </span>            : 
<span class="lineNum">     247 </span><span class="lineNoCov">          0 : static void UserSettingsFree(void) {</span>
<span class="lineNum">     248 </span>            : 
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :     free( user_macfeat_otftag );</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :     user_macfeat_otftag = NULL;</span>
<a name="251"><span class="lineNum">     251 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     252 </span>            : 
<span class="lineNum">     253 </span><span class="lineNoCov">          0 : static int UserSettingsDiffer(void) {</span>
<span class="lineNum">     254 </span>            :     int i,j;
<span class="lineNum">     255 </span>            : 
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :     if ( user_macfeat_otftag==NULL )</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     258 </span>            : 
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :     for ( i=0; user_macfeat_otftag[i].otf_tag!=0; ++i );</span>
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :     for ( j=0; macfeat_otftag[j].otf_tag!=0; ++j );</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :     if ( i!=j )</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :     for ( i=0; user_macfeat_otftag[i].otf_tag!=0; ++i ) {</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :         for ( j=0; macfeat_otftag[j].otf_tag!=0; ++j ) {</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :             if ( macfeat_otftag[j].mac_feature_type ==</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag[i].mac_feature_type &amp;&amp;</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :                     macfeat_otftag[j].mac_feature_setting ==</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag[i].mac_feature_setting &amp;&amp;</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :                     macfeat_otftag[j].otf_tag ==</span>
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag[i].otf_tag )</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     272 </span>            :         }
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :         if ( macfeat_otftag[j].otf_tag==0 )</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     275 </span>            :     }
<span class="lineNum">     276 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     277 </span>            : }
<span class="lineNum">     278 </span>            : 
<span class="lineNum">     279 </span>            : /**************************************************************************** */
<span class="lineNum">     280 </span>            : 
<span class="lineNum">     281 </span>            : 
<span class="lineNum">     282 </span>            : /* don't use mnemonics 'C' or 'O' (Cancel &amp; OK) */
<span class="lineNum">     283 </span>            : enum pref_types { pr_int, pr_real, pr_bool, pr_enum, pr_encoding, pr_string,
<span class="lineNum">     284 </span>            :         pr_file, pr_namelist, pr_unicode, pr_angle };
<span class="lineNum">     285 </span>            : struct enums { char *name; int value; };
<span class="lineNum">     286 </span>            : 
<span class="lineNum">     287 </span>            : struct enums fvsize_enums[] = { {NULL, 0} };
<span class="lineNum">     288 </span>            : 
<span class="lineNum">     289 </span>            : #define PREFS_LIST_EMPTY { NULL, 0, NULL, NULL, NULL, '\0', NULL, 0, NULL }
<span class="lineNum">     290 </span>            : static struct prefs_list {
<span class="lineNum">     291 </span>            :     char *name;
<span class="lineNum">     292 </span>            :         /* In the prefs file the untranslated name will always be used, but */
<span class="lineNum">     293 </span>            :         /* in the UI that name may be translated. */
<span class="lineNum">     294 </span>            :     enum pref_types type;
<span class="lineNum">     295 </span>            :     void *val;
<span class="lineNum">     296 </span>            :     void *(*get)(void);
<span class="lineNum">     297 </span>            :     void (*set)(void *);
<span class="lineNum">     298 </span>            :     char mn;
<span class="lineNum">     299 </span>            :     struct enums *enums;
<span class="lineNum">     300 </span>            :     unsigned int dontdisplay: 1;
<span class="lineNum">     301 </span>            :     char *popup;
<span class="lineNum">     302 </span>            : } general_list[] = {
<span class="lineNum">     303 </span>            : /* GT: The following strings have no spaces and an odd capitalization */
<span class="lineNum">     304 </span>            : /* GT: this is because these strings are used in two different ways, one */
<span class="lineNum">     305 </span>            : /* GT: translated (which the user sees, and should probably have added spaces,*/
<span class="lineNum">     306 </span>            : /* GT: and one untranslated which needs the current odd format */
<span class="lineNum">     307 </span>            :         { N_(&quot;ResourceFile&quot;), pr_file, &amp;xdefs_filename, NULL, NULL, 'R', NULL, 0, N_(&quot;When FontForge starts up, it loads the user interface theme from\nthis file. Any changes will only take effect the next time you start FontForge.&quot;) },
<span class="lineNum">     308 </span>            :         { N_(&quot;OtherSubrsFile&quot;), pr_file, &amp;othersubrsfile, NULL, NULL, 'O', NULL, 0, N_(&quot;If you wish to replace Adobe's OtherSubrs array (for Type1 fonts)\nwith an array of your own, set this to point to a file containing\na list of up to 14 PostScript subroutines. Each subroutine must\nbe preceded by a line starting with '%%%%' (any text before the\nfirst '%%%%' line will be treated as an initial copyright notice).\nThe first three subroutines are for flex hints, the next for hint\nsubstitution (this MUST be present), the 14th (or 13 as the\nnumbering actually starts with 0) is for counter hints.\nThe subroutines should not be enclosed in a [ ] pair.&quot;) },
<span class="lineNum">     309 </span>            :         { N_(&quot;FreeTypeInFontView&quot;), pr_bool, &amp;use_freetype_to_rasterize_fv, NULL, NULL, 'O', NULL, 0, N_(&quot;Use the FreeType rasterizer (when available)\nto rasterize glyphs in the font view.\nThis generally results in better quality.&quot;) },
<span class="lineNum">     310 </span>            :         { N_(&quot;FreeTypeAAFillInOutlineView&quot;), pr_bool, &amp;use_freetype_with_aa_fill_cv, NULL, NULL, 'O', NULL, 0, N_(&quot;When filling using freetype in the outline view,\nhave freetype render the glyph antialiased.&quot;) },
<span class="lineNum">     311 </span>            :         { N_(&quot;SplashScreen&quot;), pr_bool, &amp;splash, NULL, NULL, 'S', NULL, 0, N_(&quot;Show splash screen on start-up&quot;) },
<span class="lineNum">     312 </span>            : #ifndef _NO_LIBCAIRO
<span class="lineNum">     313 </span>            :         { N_(&quot;UseCairoDrawing&quot;), pr_bool, &amp;prefs_usecairo, NULL, NULL, '\0', NULL, 0, N_(&quot;Use the cairo library for drawing (if available)\nThis makes for prettier (anti-aliased) but slower drawing\nThis applies to any windows created AFTER this is set.\nAlready existing windows will continue as they are.&quot;) },
<span class="lineNum">     314 </span>            : #endif
<span class="lineNum">     315 </span>            :         { N_(&quot;ExportClipboard&quot;), pr_bool, &amp;export_clipboard, NULL, NULL, '\0', NULL, 0, N_( &quot;If you are running an X11 clipboard manager you might want\nto turn this off. FF can put things into its internal clipboard\nwhich it cannot export to X11 (things like copying more than\none glyph in the fontview). If you have a clipboard manager\nrunning it will force these to be exported with consequent\nloss of data.&quot;) },
<span class="lineNum">     316 </span>            :         { N_(&quot;AutoSaveFrequency&quot;), pr_int, &amp;AutoSaveFrequency, NULL, NULL, '\0', NULL, 0, N_( &quot;The number of seconds between autosaves. If you set this to 0 there will be no autosaves.&quot;) },
<span class="lineNum">     317 </span>            :         { N_(&quot;RevisionsToRetain&quot;), pr_int, &amp;prefRevisionsToRetain, NULL, NULL, '\0', NULL, 0, N_( &quot;When Saving, keep this number of previous versions of the file. file.sfd-01 will be the last saved file, file.sfd-02 will be the file saved before that, and so on. If you set this to 0 then no revisions will be retained.&quot;) },
<span class="lineNum">     318 </span>            :         { N_(&quot;UndoRedoLimitToSave&quot;), pr_int, &amp;UndoRedoLimitToSave, NULL, NULL, '\0', NULL, 0, N_( &quot;The number of undo and redo operations which will be saved in sfd files.\nIf you set this to 0 undo/redo information is not saved to sfd files.\nIf set to -1 then all available undo/redo information is saved without limit.&quot;) },
<span class="lineNum">     319 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     320 </span>            : },
<span class="lineNum">     321 </span>            :   new_list[] = {
<span class="lineNum">     322 </span>            :         { N_(&quot;NewCharset&quot;), pr_encoding, &amp;default_encoding, NULL, NULL, 'N', NULL, 0, N_(&quot;Default encoding for\nnew fonts&quot;) },
<span class="lineNum">     323 </span>            :         { N_(&quot;NewEmSize&quot;), pr_int, &amp;new_em_size, NULL, NULL, 'S', NULL, 0, N_(&quot;The default size of the Em-Square in a newly created font.&quot;) },
<span class="lineNum">     324 </span>            :         { N_(&quot;NewFontsQuadratic&quot;), pr_bool, &amp;new_fonts_are_order2, NULL, NULL, 'Q', NULL, 0, N_(&quot;Whether new fonts should contain splines of quadratic (truetype)\nor cubic (postscript &amp; opentype).&quot;) },
<span class="lineNum">     325 </span>            :         { N_(&quot;LoadedFontsAsNew&quot;), pr_bool, &amp;loaded_fonts_same_as_new, NULL, NULL, 'L', NULL, 0, N_(&quot;Whether fonts loaded from the disk should retain their splines\nwith the original order (quadratic or cubic), or whether the\nsplines should be converted to the default order for new fonts\n(see NewFontsQuadratic).&quot;) },
<span class="lineNum">     326 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     327 </span>            : },
<span class="lineNum">     328 </span>            :   open_list[] = {
<span class="lineNum">     329 </span>            :         { N_(&quot;PreferCJKEncodings&quot;), pr_bool, &amp;prefer_cjk_encodings, NULL, NULL, 'C', NULL, 0, N_(&quot;When loading a truetype or opentype font which has both a unicode\nand a CJK encoding table, use this flag to specify which\nshould be loaded for the font.&quot;) },
<span class="lineNum">     330 </span>            :         { N_(&quot;AskUserForCMap&quot;), pr_bool, &amp;ask_user_for_cmap, NULL, NULL, 'O', NULL, 0, N_(&quot;When loading a font in sfnt format (TrueType, OpenType, etc.),\nask the user to specify which cmap to use initially.&quot;) },
<span class="lineNum">     331 </span>            :         { N_(&quot;PreserveTables&quot;), pr_string, &amp;SaveTablesPref, NULL, NULL, 'P', NULL, 0, N_(&quot;Enter a list of 4 letter table tags, separated by commas.\nFontForge will make a binary copy of these tables when it\nloads a True/OpenType font, and will output them (unchanged)\nwhen it generates the font. Do not include table tags which\nFontForge thinks it understands.&quot;) },
<span class="lineNum">     332 </span>            :         { N_(&quot;SeekCharacter&quot;), pr_unicode, &amp;home_char, NULL, NULL, '\0', NULL, 0, N_(&quot;When fontforge opens a (non-sfd) font it will try to display this unicode character in the fontview.&quot;)},
<span class="lineNum">     333 </span>            :         { N_(&quot;CompactOnOpen&quot;), pr_bool, &amp;compact_font_on_open, NULL, NULL, 'O', NULL, 0, N_(&quot;When a font is opened, should it be made compact?&quot;)},
<span class="lineNum">     334 </span>            :         { N_(&quot;UndoRedoLimitToLoad&quot;), pr_int, &amp;UndoRedoLimitToLoad, NULL, NULL, '\0', NULL, 0, N_( &quot;The number of undo and redo operations to load from sfd files.\nWith this option you can disregard undo information while loading SFD files.\nIf set to 0 then no undo/redo information is loaded.\nIf set to -1 then all available undo/redo information is loaded without limit.&quot;) },
<span class="lineNum">     335 </span>            :         { N_(&quot;OpenTypeLoadHintEqualityTolerance&quot;), pr_real, &amp;OpenTypeLoadHintEqualityTolerance, NULL, NULL, '\0', NULL, 0, N_( &quot;When importing an OpenType font, for the purposes of hinting spline points might not exactly match boundaries. For example, a point might be -0.0002 instead of exactly 0\nThis setting gives the user some control over this allowing a small tolerance value to be fed into the OpenType loading code.\nComparisons are then not performed for raw equality but for equality within tolerance (e.g., values within the range -0.0002 to 0.0002 will be considered equal to 0 when figuring out hints).&quot;) },
<span class="lineNum">     336 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     337 </span>            : },
<span class="lineNum">     338 </span>            :   navigation_list[] = {
<span class="lineNum">     339 </span>            :         { N_(&quot;GlyphAutoGoto&quot;), pr_bool, &amp;cv_auto_goto, NULL, NULL, '\0', NULL, 0, N_(&quot;Typing a normal character in the glyph view window changes the window to look at that character.\nEnabling GlyphAutoGoto will disable the shortcut where holding just the ` key will enable Preview mode as long as the key is held.&quot;) },
<span class="lineNum">     340 </span>            :         { N_(&quot;OpenCharsInNewWindow&quot;), pr_bool, &amp;OpenCharsInNewWindow, NULL, NULL, '\0', NULL, 0, N_(&quot;When double clicking on a character in the font view\nopen that character in a new window, otherwise\nreuse an existing one.&quot;) },
<span class="lineNum">     341 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     342 </span>            : },
<span class="lineNum">     343 </span>            :   editing_list[] = {
<span class="lineNum">     344 </span>            :         { N_(&quot;ItalicConstrained&quot;), pr_bool, &amp;ItalicConstrained, NULL, NULL, '\0', NULL, 0, N_(&quot;In the Outline View, the Shift key constrains motion to be parallel to the ItalicAngle rather than constraining it to be vertical.&quot;) },
<span class="lineNum">     345 </span>            :         { N_(&quot;InterpolateCPsOnMotion&quot;), pr_bool, &amp;interpCPsOnMotion, NULL, NULL, '\0', NULL, 0, N_(&quot;When moving one end point of a spline but not the other\ninterpolate the control points between the two.&quot;) },
<span class="lineNum">     346 </span>            :         { N_(&quot;SnapDistance&quot;), pr_real, &amp;snapdistance, NULL, NULL, '\0', NULL, 0, N_(&quot;When the mouse pointer is within this many pixels\nof one of the various interesting features (baseline,\nwidth, grid splines, etc.) the pointer will snap\nto that feature.&quot;) },
<span class="lineNum">     347 </span>            :         { N_(&quot;SnapDistanceMeasureTool&quot;), pr_real, &amp;snapdistancemeasuretool, NULL, NULL, '\0', NULL, 0, N_(&quot;When the measure tool is active and when the mouse pointer is within this many pixels\nof one of the various interesting features (baseline,\nwidth, grid splines, etc.) the pointer will snap\nto that feature.&quot;) },
<span class="lineNum">     348 </span>            :         { N_(&quot;SnapToInt&quot;), pr_bool, &amp;snaptoint, NULL, NULL, '\0', NULL, 0, N_(&quot;When the user clicks in the editing window, round the location to the nearest integers.&quot;) },
<span class="lineNum">     349 </span>            :         { N_(&quot;StopAtJoin&quot;), pr_bool, &amp;stop_at_join, NULL, NULL, '\0', NULL, 0, N_(&quot;When dragging points in the outline view a join may occur\n(two open contours may connect at their endpoints). When\nthis is On a join will cause FontForge to stop moving the\nselection (as if the user had released the mouse button).\nThis is handy if your fingers are inclined to wiggle a bit.&quot;) },
<span class="lineNum">     350 </span>            :         { N_(&quot;JoinSnap&quot;), pr_real, &amp;joinsnap, NULL, NULL, '\0', NULL, 0, N_(&quot;The Edit-&gt;Join command will join points which are this close together\nA value of 0 means they must be coincident&quot;) },
<span class="lineNum">     351 </span>            :         { N_(&quot;CopyMetaData&quot;), pr_bool, &amp;copymetadata, NULL, NULL, '\0', NULL, 0, N_(&quot;When copying glyphs from the font view, also copy the\nglyphs' metadata (name, encoding, comment, etc).&quot;) },
<span class="lineNum">     352 </span>            :         { N_(&quot;UndoDepth&quot;), pr_int, &amp;maxundoes, NULL, NULL, '\0', NULL, 0, N_(&quot;The maximum number of Undoes/Redoes stored in a glyph. Use -1 for infinite Undoes\n(but watch RAM consumption and use the Edit menu's Remove Undoes as needed)&quot;) },
<span class="lineNum">     353 </span>            :         { N_(&quot;UpdateFlex&quot;), pr_bool, &amp;updateflex, NULL, NULL, '\0', NULL, 0, N_(&quot;Figure out flex hints after every change&quot;) },
<span class="lineNum">     354 </span>            :         { N_(&quot;AutoKernDialog&quot;), pr_bool, &amp;default_autokern_dlg, NULL, NULL, '\0', NULL, 0, N_(&quot;Open AutoKern dialog for new kerning subtables&quot;) },
<span class="lineNum">     355 </span>            :         { N_(&quot;MetricsShiftSkip&quot;), pr_int, &amp;pref_mv_shift_and_arrow_skip, NULL, NULL, '\0', NULL, 0, N_(&quot;Number of units to increment/decrement a table value by in the metrics window when shift is held&quot;) },
<span class="lineNum">     356 </span>            :         { N_(&quot;MetricsControlShiftSkip&quot;), pr_int, &amp;pref_mv_control_shift_and_arrow_skip, NULL, NULL, '\0', NULL, 0, N_(&quot;Number of units to increment/decrement a table value by in the metrics window when both control and shift is held&quot;) },
<span class="lineNum">     357 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     358 </span>            : },
<span class="lineNum">     359 </span>            :   editing_interface_list[] = {
<span class="lineNum">     360 </span>            :         { N_(&quot;ArrowMoveSize&quot;), pr_real, &amp;arrowAmount, NULL, NULL, '\0', NULL, 0, N_(&quot;The number of em-units by which an arrow key will move a selected point&quot;) },
<span class="lineNum">     361 </span>            :         { N_(&quot;ArrowAccelFactor&quot;), pr_real, &amp;arrowAccelFactor, NULL, NULL, '\0', NULL, 0, N_(&quot;Holding down the Shift key will speed up arrow key motion by this factor&quot;) },
<span class="lineNum">     362 </span>            :         { N_(&quot;DrawOpenPathsWithHighlight&quot;), pr_bool, &amp;DrawOpenPathsWithHighlight, NULL, NULL, '\0', NULL, 0, N_(&quot;Open paths should be drawn in a special highlight color to make them more apparent.&quot;) },
<span class="lineNum">     363 </span>            :         { N_(&quot;MeasureToolShowHorizontalVertical&quot;), pr_bool, &amp;measuretoolshowhorizontolvertical, NULL, NULL, '\0', NULL, 0, N_(&quot;Have the measure tool show horizontal and vertical distances on the canvas.&quot;) },
<span class="lineNum">     364 </span>            :         { N_(&quot;XORRubberLines&quot;), pr_bool, &amp;xorrubberlines, NULL, NULL, '\0', NULL, 0, N_(&quot;Use XOR based rubber lines.&quot;) },
<span class="lineNum">     365 </span>            :         { N_(&quot;EditHandleSize&quot;), pr_real, &amp;prefs_cvEditHandleSize, NULL, NULL, '\0', NULL, 0, N_(&quot;The size of the handles showing control points and other interesting points in the glyph editor (default is 5).&quot;) },
<span class="lineNum">     366 </span>            :         { N_(&quot;InactiveHandleAlpha&quot;), pr_int, &amp;prefs_cvInactiveHandleAlpha, NULL, NULL, '\0', NULL, 0, N_(&quot;Inactive handles in the glyph editor will be drawn with this alpha value (range: 0-255 default is 255).&quot;) },
<span class="lineNum">     367 </span>            :         { N_(&quot;ShowControlPointsAlways&quot;), pr_bool, &amp;prefs_cv_show_control_points_always_initially, NULL, NULL, '\0', NULL, 0, N_(&quot;Always show the control points when editing a glyph.\nThis can be turned off in the menu View/Show, this setting will effect if control points are shown initially.\nChange requires a restart of fontforge.&quot;) },
<span class="lineNum">     368 </span>            :         { N_(&quot;ShowFillWithSpace&quot;), pr_bool, &amp;cv_show_fill_with_space, NULL, NULL, '\0', NULL, 0, N_(&quot;Also enable preview mode when the space bar is pressed.&quot;) },
<span class="lineNum">     369 </span>            :         { N_(&quot;OutlineThickness&quot;), pr_int, &amp;prefs_cv_outline_thickness, NULL, NULL, '\0', NULL, 0, N_(&quot;Setting above 1 will cause a thick outline to be drawn for glyph paths\n which is only extended inwards from the edge of the glyph.\n See also the ForegroundThickOutlineColor Resource for the color of this outline.&quot;) },
<span class="lineNum">     370 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     371 </span>            : },
<span class="lineNum">     372 </span>            :   sync_list[] = {
<span class="lineNum">     373 </span>            :         { N_(&quot;AutoWidthSync&quot;), pr_bool, &amp;adjustwidth, NULL, NULL, '\0', NULL, 0, N_(&quot;Changing the width of a glyph\nchanges the widths of all accented\nglyphs based on it.&quot;) },
<span class="lineNum">     374 </span>            :         { N_(&quot;AutoLBearingSync&quot;), pr_bool, &amp;adjustlbearing, NULL, NULL, '\0', NULL, 0, N_(&quot;Changing the left side bearing\nof a glyph adjusts the lbearing\nof other references in all accented\nglyphs based on it.&quot;) },
<span class="lineNum">     375 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     376 </span>            : },
<span class="lineNum">     377 </span>            :  tt_list[] = {
<span class="lineNum">     378 </span>            :         { N_(&quot;ClearInstrsBigChanges&quot;), pr_bool, &amp;clear_tt_instructions_when_needed, NULL, NULL, 'C', NULL, 0, N_(&quot;Instructions in a TrueType font refer to\npoints by number, so if you edit a glyph\nin such a way that some points have different\nnumbers (add points, remove them, etc.) then\nthe instructions will be applied to the wrong\npoints with disasterous results.\n  Normally FontForge will remove the instructions\nif it detects that the points have been renumbered\nin order to avoid the above problem. You may turn\nthis behavior off -- but be careful!&quot;) },
<span class="lineNum">     379 </span>            :         { N_(&quot;CopyTTFInstrs&quot;), pr_bool, &amp;copyttfinstr, NULL, NULL, '\0', NULL, 0, N_(&quot;When copying glyphs from the font view, also copy the\nglyphs' truetype instructions.&quot;) },
<span class="lineNum">     380 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     381 </span>            : },
<span class="lineNum">     382 </span>            :   accent_list[] = {
<span class="lineNum">     383 </span>            :         { N_(&quot;AccentOffsetPercent&quot;), pr_int, &amp;accent_offset, NULL, NULL, '\0', NULL, 0, N_(&quot;The percentage of an em by which an accent is offset from its base glyph in Build Accent&quot;) },
<span class="lineNum">     384 </span>            :         { N_(&quot;AccentCenterLowest&quot;), pr_bool, &amp;GraveAcuteCenterBottom, NULL, NULL, '\0', NULL, 0, N_(&quot;When placing grave and acute accents above letters, should\nFontForge center them based on their full width, or\nshould it just center based on the lowest point\nof the accent.&quot;) },
<span class="lineNum">     385 </span>            :         { N_(&quot;CharCenterHighest&quot;), pr_bool, &amp;CharCenterHighest, NULL, NULL, '\0', NULL, 0, N_(&quot;When centering an accent over a glyph, should the accent\nbe centered on the highest point(s) of the glyph,\nor the middle of the glyph?&quot;) },
<span class="lineNum">     386 </span>            :         { N_(&quot;PreferSpacingAccents&quot;), pr_bool, &amp;PreferSpacingAccents, NULL, NULL, '\0', NULL, 0, N_(&quot;Use spacing accents (Unicode: 02C0-02FF) rather than\ncombining accents (Unicode: 0300-036F) when\nbuilding accented glyphs.&quot;) },
<span class="lineNum">     387 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     388 </span>            : },
<span class="lineNum">     389 </span>            :  args_list[] = {
<span class="lineNum">     390 </span>            :         { N_(&quot;PreferPotrace&quot;), pr_bool, &amp;preferpotrace, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge supports two different helper applications to do autotracing\n autotrace and potrace\nIf your system only has one it will use that one, if you have both\nuse this option to tell FontForge which to pick.&quot;) },
<span class="lineNum">     391 </span>            :         { N_(&quot;AutotraceArgs&quot;), pr_string, NULL, GetAutoTraceArgs, SetAutoTraceArgs, '\0', NULL, 0, N_(&quot;Extra arguments for configuring the autotrace program\n(either autotrace or potrace)&quot;) },
<span class="lineNum">     392 </span>            :         { N_(&quot;AutotraceAsk&quot;), pr_bool, &amp;autotrace_ask, NULL, NULL, '\0', NULL, 0, N_(&quot;Ask the user for autotrace arguments each time autotrace is invoked&quot;) },
<span class="lineNum">     393 </span>            :         { N_(&quot;MfArgs&quot;), pr_string, &amp;mf_args, NULL, NULL, '\0', NULL, 0, N_(&quot;Commands to pass to mf (metafont) program, the filename will follow these&quot;) },
<span class="lineNum">     394 </span>            :         { N_(&quot;MfAsk&quot;), pr_bool, &amp;mf_ask, NULL, NULL, '\0', NULL, 0, N_(&quot;Ask the user for mf commands each time mf is invoked&quot;) },
<span class="lineNum">     395 </span>            :         { N_(&quot;MfClearBg&quot;), pr_bool, &amp;mf_clearbackgrounds, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge loads large images into the background of each glyph\nprior to autotracing them. You may retain those\nimages to look at after mf processing is complete, or\nremove them to save space&quot;) },
<span class="lineNum">     396 </span>            :         { N_(&quot;MfShowErr&quot;), pr_bool, &amp;mf_showerrors, NULL, NULL, '\0', NULL, 0, N_(&quot;MetaFont (mf) generates lots of verbiage to stdout.\nMost of the time I find it an annoyance but it is\nimportant to see if something goes wrong.&quot;) },
<span class="lineNum">     397 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     398 </span>            : },
<span class="lineNum">     399 </span>            :  fontinfo_list[] = {
<span class="lineNum">     400 </span>            :         { N_(&quot;FoundryName&quot;), pr_string, &amp;BDFFoundry, NULL, NULL, 'F', NULL, 0, N_(&quot;Name used for foundry field in bdf\nfont generation&quot;) },
<span class="lineNum">     401 </span>            :         { N_(&quot;TTFFoundry&quot;), pr_string, &amp;TTFFoundry, NULL, NULL, 'T', NULL, 0, N_(&quot;Name used for Vendor ID field in\nttf (OS/2 table) font generation.\nMust be no more than 4 characters&quot;) },
<span class="lineNum">     402 </span>            :         { N_(&quot;NewFontNameList&quot;), pr_namelist, &amp;namelist_for_new_fonts, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge will use this namelist when assigning\nglyph names to code points in a new font.&quot;) },
<span class="lineNum">     403 </span>            :         { N_(&quot;RecognizePUANames&quot;), pr_bool, &amp;recognizePUA, NULL, NULL, 'U', NULL, 0, N_(&quot;Once upon a time, Adobe assigned PUA (public use area) encodings\nfor many stylistic variants of characters (small caps, old style\nnumerals, etc.). Adobe no longer believes this to be a good idea,\nand recommends that these encodings be ignored.\n\n The assignments were originally made because most applications\ncould not handle OpenType features for accessing variants. Adobe\nnow believes that all apps that matter can now do so. Applications\nlike Word and OpenOffice still can't handle these features, so\n fontforge's default behavior is to ignore Adobe's current\nrecommendations.\n\nNote: This does not affect figuring out unicode from the font's encoding,\nit just controls determining unicode from a name.&quot;) },
<span class="lineNum">     404 </span>            :         { N_(&quot;UnicodeGlyphNames&quot;), pr_bool, &amp;allow_utf8_glyphnames, NULL, NULL, 'O', NULL, 0, N_(&quot;Allow the full unicode character set in glyph names.\nThis does not conform to adobe's glyph name standard.\nSuch names should be for internal use only and\nshould NOT end up in production fonts.&quot; ) },
<span class="lineNum">     405 </span>            :         { N_(&quot;AddCharToNameList&quot;), pr_bool, &amp;add_char_to_name_list, NULL, NULL, 'O', NULL, 0, N_( &quot;When displaying a list of glyph names\n(or sometimes just a single glyph name)\nFontForge will add the unicode character\nthe name refers to in parenthesis after\nthe name. It does this because some names\nare obscure.\nSome people would prefer not to see this,\nso this preference item lets you turn off\n this behavior&quot; ) },
<span class="lineNum">     406 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     407 </span>            : },
<span class="lineNum">     408 </span>            :  generate_list[] = {
<span class="lineNum">     409 </span>            :         { N_(&quot;AskBDFResolution&quot;), pr_bool, &amp;ask_user_for_resolution, NULL, NULL, 'B', NULL, 0, N_(&quot;When generating a set of BDF fonts ask the user\nto specify the screen resolution of the fonts\notherwise FontForge will guess depending on the pixel size.&quot;) },
<span class="lineNum">     410 </span>            :         { N_(&quot;AutoHint&quot;), pr_bool, &amp;autohint_before_generate, NULL, NULL, 'H', NULL, 0, N_(&quot;AutoHint changed glyphs before generating a font&quot;) },
<span class="lineNum">     411 </span>            : 
<span class="lineNum">     412 </span>            :         { N_(&quot;GenerateHintWidthEqualityTolerance&quot;), pr_real, &amp;GenerateHintWidthEqualityTolerance, NULL, NULL, '\0', NULL, 0, N_( &quot;When generating a font, ignore slight rounding errors for hints that should be at the top or bottom of the glyph. For example, you might like to set this to 0.02 so that 19.999 will be considered 20. But only for the hint width value.&quot;) },
<span class="lineNum">     413 </span>            :         
<span class="lineNum">     414 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     415 </span>            : },
<span class="lineNum">     416 </span>            :  hints_list[] = {
<span class="lineNum">     417 </span>            :         { N_(&quot;StandardSlopeError&quot;), pr_angle, &amp;stem_slope_error, NULL, NULL, '\0', NULL, 0, N_(&quot;The maximum slope difference which still allows to consider two points \&quot;parallel\&quot;.\nEnlarge this to make the autohinter more tolerable to small deviations from straight lines when detecting stem edges.&quot;) },
<span class="lineNum">     418 </span>            :         { N_(&quot;SerifSlopeError&quot;), pr_angle, &amp;stub_slope_error, NULL, NULL, '\0', NULL, 0, N_(&quot;Same as above, but for terminals of small features (e. g. serifs), which can deviate more significantly from the horizontal or vertical direction.&quot;) },
<span class="lineNum">     419 </span>            :         { N_(&quot;HintBoundingBoxes&quot;), pr_bool, &amp;hint_bounding_boxes, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge will place vertical or horizontal hints to describe the bounding boxes of suitable glyphs.&quot;) },
<span class="lineNum">     420 </span>            :         { N_(&quot;HintDiagonalEnds&quot;), pr_bool, &amp;hint_diagonal_ends, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge will place vertical or horizontal hints at the ends of diagonal stems.&quot;) },
<span class="lineNum">     421 </span>            :         { N_(&quot;HintDiagonalInter&quot;), pr_bool, &amp;hint_diagonal_intersections, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge will place vertical or horizontal hints at the intersections of diagonal stems.&quot;) },
<span class="lineNum">     422 </span>            :         { N_(&quot;DetectDiagonalStems&quot;), pr_bool, &amp;detect_diagonal_stems, NULL, NULL, '\0', NULL, 0, N_(&quot;FontForge will generate diagonal stem hints, which then can be used by the AutoInstr command.&quot;) },
<span class="lineNum">     423 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     424 </span>            : },
<span class="lineNum">     425 </span>            :  instrs_list[] = {
<span class="lineNum">     426 </span>            :         { N_(&quot;InstructDiagonalStems&quot;), pr_bool, &amp;instruct_diagonal_stems, NULL, NULL, '\0', NULL, 0, N_(&quot;Generate instructions for diagonal stem hints.&quot;) },
<span class="lineNum">     427 </span>            :         { N_(&quot;InstructSerifs&quot;), pr_bool, &amp;instruct_serif_stems, NULL, NULL, '\0', NULL, 0, N_(&quot;Try to detect serifs and other elements protruding from base stems and generate instructions for them.&quot;) },
<span class="lineNum">     428 </span>            :         { N_(&quot;InstructBallTerminals&quot;), pr_bool, &amp;instruct_ball_terminals, NULL, NULL, '\0', NULL, 0, N_(&quot;Generate instructions for ball terminals.&quot;) },
<span class="lineNum">     429 </span>            :         { N_(&quot;InterpolateStrongPoints&quot;), pr_bool, &amp;interpolate_strong, NULL, NULL, '\0', NULL, 0, N_(&quot;Interpolate between stem edges some important points, not affected by other instructions.&quot;) },
<span class="lineNum">     430 </span>            :         { N_(&quot;CounterControl&quot;), pr_bool, &amp;control_counters, NULL, NULL, '\0', NULL, 0, N_(&quot;Make sure similar or equal counters remain the same in gridfitted outlines.\nEnabling this option may result in glyph advance widths being\ninconsistently scaled at some PPEMs.&quot;) },
<span class="lineNum">     431 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     432 </span>            : },
<span class="lineNum">     433 </span>            :  opentype_list[] = {
<span class="lineNum">     434 </span>            :         { N_(&quot;UseNewIndicScripts&quot;), pr_bool, &amp;use_second_indic_scripts, NULL, NULL, 'C', NULL, 0, N_(&quot;MS has changed (in August 2006) the inner workings of their Indic shaping\nengine, and to disambiguate this change has created a parallel set of script\ntags (generally ending in '2') for Indic writing systems. If you are working\nwith the new system set this flag, if you are working with the old unset it.\n(if you aren't doing Indic work, this flag is irrelevant).&quot;) },
<span class="lineNum">     435 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     436 </span>            : },
<span class="lineNum">     437 </span>            : #ifdef BUILD_COLLAB
<span class="lineNum">     438 </span>            :  collab_list[] = {
<span class="lineNum">     439 </span>            :         { N_(&quot;SessionJoinTimeout&quot;), pr_int, &amp;pref_collab_sessionJoinTimeoutMS, NULL, NULL, 'C', NULL, 0, N_(&quot;The number of milliseconds to wait for a connection to the collaboration server to happen. FontForge may be unresponsive during this session connection time. (default 1000 which is 1 second)&quot;) },
<span class="lineNum">     440 </span>            :         { N_(&quot;RoundTripMessageMaxTime&quot;), pr_int, &amp;pref_collab_roundTripTimerMS, NULL, NULL, 'C', NULL, 0, N_(&quot;The number of milliseconds that are allowed to pass between sending an update to the server and hearing it sent back as a message to all clients. The FontForge user interface may be unresponsive during this time. A change requires a restart of FontForge. (default 2000 which is 2 seconds)&quot;) },
<span class="lineNum">     441 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     442 </span>            : },
<span class="lineNum">     443 </span>            : #endif
<span class="lineNum">     444 </span>            : /* These are hidden, so will never appear in preference ui, hence, no &quot;N_(&quot; */
<span class="lineNum">     445 </span>            : /*  They are controled elsewhere AntiAlias is a menu item in the font window's View menu */
<span class="lineNum">     446 </span>            : /*  etc. */
<span class="lineNum">     447 </span>            :  hidden_list[] = {
<span class="lineNum">     448 </span>            :         { &quot;AntiAlias&quot;, pr_bool, &amp;default_fv_antialias, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     449 </span>            :         { &quot;DefaultFVShowHmetrics&quot;, pr_int, &amp;default_fv_showhmetrics, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     450 </span>            :         { &quot;DefaultFVShowVmetrics&quot;, pr_int, &amp;default_fv_showvmetrics, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     451 </span>            :         { &quot;DefaultFVSize&quot;, pr_int, &amp;default_fv_font_size, NULL, NULL, 'S', NULL, 1, NULL },
<span class="lineNum">     452 </span>            :         { &quot;DefaultFVRowCount&quot;, pr_int, &amp;default_fv_row_count, NULL, NULL, 'S', NULL, 1, NULL },
<span class="lineNum">     453 </span>            :         { &quot;DefaultFVColCount&quot;, pr_int, &amp;default_fv_col_count, NULL, NULL, 'S', NULL, 1, NULL },
<span class="lineNum">     454 </span>            :         { &quot;DefaultFVGlyphLabel&quot;, pr_int, &amp;default_fv_glyphlabel, NULL, NULL, 'S', NULL, 1, NULL },
<span class="lineNum">     455 </span>            :         { &quot;SaveToDir&quot;, pr_int, &amp;save_to_dir, NULL, NULL, 'S', NULL, 1, NULL },
<span class="lineNum">     456 </span>            :         { &quot;OnlyCopyDisplayed&quot;, pr_bool, &amp;onlycopydisplayed, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     457 </span>            :         { &quot;PalettesDocked&quot;, pr_bool, &amp;palettes_docked, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     458 </span>            :         { &quot;DefaultCVWidth&quot;, pr_int, &amp;cv_width, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     459 </span>            :         { &quot;DefaultCVHeight&quot;, pr_int, &amp;cv_height, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     460 </span>            :         { &quot;CVVisible0&quot;, pr_bool, &amp;cvvisible[0], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     461 </span>            :         { &quot;CVVisible1&quot;, pr_bool, &amp;cvvisible[1], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     462 </span>            :         { &quot;BVVisible0&quot;, pr_bool, &amp;bvvisible[0], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     463 </span>            :         { &quot;BVVisible1&quot;, pr_bool, &amp;bvvisible[1], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     464 </span>            :         { &quot;BVVisible2&quot;, pr_bool, &amp;bvvisible[2], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     465 </span>            :         { &quot;MarkExtrema&quot;, pr_int, &amp;CVShows.markextrema, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     466 </span>            :         { &quot;MarkPointsOfInflect&quot;, pr_int, &amp;CVShows.markpoi, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     467 </span>            :         { &quot;ShowRulers&quot;, pr_bool, &amp;CVShows.showrulers, NULL, NULL, '\0', NULL, 1, N_(&quot;Display rulers in the Outline Glyph View&quot;) },
<span class="lineNum">     468 </span>            :         { &quot;ShowCPInfo&quot;, pr_int, &amp;CVShows.showcpinfo, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     469 </span>            :         { &quot;CreateDraggingComparisonOutline&quot;, pr_int, &amp;prefs_create_dragging_comparison_outline, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     470 </span>            :         { &quot;InfoWindowDistance&quot;, pr_int, &amp;infowindowdistance, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     471 </span>            :         { &quot;ShowSideBearings&quot;, pr_int, &amp;CVShows.showsidebearings, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     472 </span>            :         { &quot;ShowRefNames&quot;, pr_int, &amp;CVShows.showrefnames, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     473 </span>            :         { &quot;ShowPoints&quot;, pr_bool, &amp;CVShows.showpoints, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     474 </span>            :         { &quot;ShowFilled&quot;, pr_int, &amp;CVShows.showfilled, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     475 </span>            :         { &quot;ShowTabs&quot;, pr_int, &amp;CVShows.showtabs, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     476 </span>            :         { &quot;SnapOutlines&quot;, pr_int, &amp;CVShows.snapoutlines, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     477 </span>            :         { &quot;ShowAlmostHVLines&quot;, pr_bool, &amp;CVShows.showalmosthvlines, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     478 </span>            :         { &quot;ShowAlmostHVCurves&quot;, pr_bool, &amp;CVShows.showalmosthvcurves, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     479 </span>            :         { &quot;AlmostHVBound&quot;, pr_int, &amp;CVShows.hvoffset, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     480 </span>            :         { &quot;CheckSelfIntersects&quot;, pr_bool, &amp;CVShows.checkselfintersects, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     481 </span>            :         { &quot;ShowDebugChanges&quot;, pr_bool, &amp;CVShows.showdebugchanges, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     482 </span>            :         { &quot;DefaultScreenDpiSystem&quot;, pr_int, &amp;oldsystem, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     483 </span>            :         { &quot;DefaultOutputFormat&quot;, pr_int, &amp;oldformatstate, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     484 </span>            :         { &quot;DefaultBitmapFormat&quot;, pr_int, &amp;oldbitmapstate, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     485 </span>            :         { &quot;SaveValidate&quot;, pr_int, &amp;old_validate, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     486 </span>            :         { &quot;SaveFontLogAsk&quot;, pr_int, &amp;old_fontlog, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     487 </span>            :         { &quot;DefaultSFNTflags&quot;, pr_int, &amp;old_sfnt_flags, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     488 </span>            :         { &quot;DefaultPSflags&quot;, pr_int, &amp;old_ps_flags, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     489 </span>            :         { &quot;PageWidth&quot;, pr_int, &amp;pagewidth, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     490 </span>            :         { &quot;PageHeight&quot;, pr_int, &amp;pageheight, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     491 </span>            :         { &quot;PrintType&quot;, pr_int, &amp;printtype, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     492 </span>            :         { &quot;PrintCommand&quot;, pr_string, &amp;printcommand, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     493 </span>            :         { &quot;PageLazyPrinter&quot;, pr_string, &amp;printlazyprinter, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     494 </span>            :         { &quot;RegularStar&quot;, pr_bool, &amp;regular_star, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     495 </span>            :         { &quot;PolyStar&quot;, pr_bool, &amp;polystar, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     496 </span>            :         { &quot;RectEllipse&quot;, pr_bool, &amp;rectelipse, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     497 </span>            :         { &quot;RectCenterOut&quot;, pr_bool, &amp;center_out[0], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     498 </span>            :         { &quot;EllipseCenterOut&quot;, pr_bool, &amp;center_out[1], NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     499 </span>            :         { &quot;PolyStartPointCnt&quot;, pr_int, &amp;ps_pointcnt, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     500 </span>            :         { &quot;RoundRectRadius&quot;, pr_real, &amp;rr_radius, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     501 </span>            :         { &quot;StarPercent&quot;, pr_real, &amp;star_percent, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     502 </span>            :         { &quot;CoverageFormatsAllowed&quot;, pr_int, &amp;coverageformatsallowed, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     503 </span>            :         { &quot;DebugWins&quot;, pr_int, &amp;debug_wins, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     504 </span>            :         { &quot;GridFitDpi&quot;, pr_int, &amp;gridfit_dpi, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     505 </span>            :         { &quot;GridFitDepth&quot;, pr_int, &amp;gridfit_depth, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     506 </span>            :         { &quot;GridFitPointSize&quot;, pr_real, &amp;gridfit_pointsizey, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     507 </span>            :         { &quot;GridFitPointSizeX&quot;, pr_real, &amp;gridfit_pointsizex, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     508 </span>            :         { &quot;GridFitSameAs&quot;, pr_int, &amp;gridfit_x_sameas_y, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     509 </span>            :         { &quot;MVShowGrid&quot;, pr_int, &amp;mvshowgrid, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     510 </span>            :         { &quot;ForceNamesWhenOpening&quot;, pr_namelist, &amp;force_names_when_opening, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     511 </span>            :         { &quot;ForceNamesWhenSaving&quot;, pr_namelist, &amp;force_names_when_saving, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     512 </span>            :         { &quot;DefaultFontFilterIndex&quot;, pr_int, &amp;default_font_filter_index, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     513 </span>            :         { &quot;FCShowHidden&quot;, pr_bool, &amp;gfc_showhidden, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     514 </span>            :         { &quot;FCDirPlacement&quot;, pr_int, &amp;gfc_dirplace, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     515 </span>            :         { &quot;FCBookmarks&quot;, pr_string, &amp;gfc_bookmarks, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     516 </span>            :         { &quot;DefaultMVType&quot;,   pr_int, &amp;mv_type, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     517 </span>            :         { &quot;DefaultMVWidth&quot;,  pr_int, &amp;mv_width, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     518 </span>            :         { &quot;DefaultMVHeight&quot;, pr_int, &amp;mv_height, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     519 </span>            :         { &quot;DefaultBVWidth&quot;, pr_int, &amp;bv_width, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     520 </span>            :         { &quot;DefaultBVHeight&quot;, pr_int, &amp;bv_height, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     521 </span>            :         { &quot;AnchorControlPixelSize&quot;, pr_int, &amp;aa_pixelsize, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     522 </span>            :         { &quot;CollabLastServerConnectedTo&quot;, pr_string, &amp;pref_collab_last_server_connected_to, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     523 </span>            : #ifdef _NO_LIBCAIRO
<span class="lineNum">     524 </span>            :         { &quot;UseCairoDrawing&quot;, pr_bool, &amp;prefs_usecairo, NULL, NULL, '\0', NULL, 0, N_(&quot;Use the cairo library for drawing (if available)\nThis makes for prettier (anti-aliased) but slower drawing\nThis applies to any windows created AFTER this is set.\nAlready existing windows will continue as they are.&quot;) },
<span class="lineNum">     525 </span>            : #endif
<span class="lineNum">     526 </span>            :         { &quot;CV_B1Tool&quot;, pr_int, (int *) &amp;cv_b1_tool, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     527 </span>            :         { &quot;CV_CB1Tool&quot;, pr_int, (int *) &amp;cv_cb1_tool, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     528 </span>            :         { &quot;CV_B2Tool&quot;, pr_int, (int *) &amp;cv_b2_tool, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     529 </span>            :         { &quot;CV_CB2Tool&quot;, pr_int, (int *) &amp;cv_cb2_tool, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     530 </span>            :         { &quot;XUID-Base&quot;, pr_string, &amp;xuid, NULL, NULL, 'X', NULL, 0, N_(&quot;If specified this should be a space separated list of integers each\nless than 16777216 which uniquely identify your organization\nFontForge will generate a random number for the final component.&quot;) }, /* Obsolete */
<span class="lineNum">     531 </span>            :         { &quot;ShowKerningPane&quot;, pr_int, (int *) &amp;show_kerning_pane_in_class, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     532 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     533 </span>            : },
<span class="lineNum">     534 </span>            :  oldnames[] = {
<span class="lineNum">     535 </span>            :         { &quot;DumpGlyphMap&quot;, pr_bool, &amp;glyph_2_name_map, NULL, NULL, '\0', NULL, 0, N_(&quot;When generating a truetype or opentype font it is occasionally\nuseful to know the mapping between truetype glyph ids and\nglyph names. Setting this option will cause FontForge to\nproduce a file (with extension .g2n) containing those data.&quot;) },
<span class="lineNum">     536 </span>            :         { &quot;DefaultTTFApple&quot;, pr_int, &amp;pointless, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     537 </span>            :         { &quot;AcuteCenterBottom&quot;, pr_bool, &amp;GraveAcuteCenterBottom, NULL, NULL, '\0', NULL, 1, N_(&quot;When placing grave and acute accents above letters, should\nFontForge center them based on their full width, or\nshould it just center based on the lowest point\nof the accent.&quot;) },
<span class="lineNum">     538 </span>            :         { &quot;AlwaysGenApple&quot;, pr_bool, &amp;alwaysgenapple, NULL, NULL, 'A', NULL, 0, N_(&quot;Apple and MS/Adobe differ about the format of truetype and opentype files.\nThis controls the default setting of the Apple checkbox in the\nFile-&gt;Generate Font dialog.\nThe main differences are:\n Bitmap data are stored in different tables\n Scaled composite glyphs are treated differently\n Use of GSUB rather than morx(t)/feat\n Use of GPOS rather than kern/opbd\n Use of GDEF rather than lcar/prop\nIf both this and OpenType are set, both formats are generated&quot;) },
<span class="lineNum">     539 </span>            :         { &quot;AlwaysGenOpenType&quot;, pr_bool, &amp;alwaysgenopentype, NULL, NULL, 'O', NULL, 0, N_(&quot;Apple and MS/Adobe differ about the format of truetype and opentype files.\nThis controls the default setting of the OpenType checkbox in the\nFile-&gt;Generate Font dialog.\nThe main differences are:\n Bitmap data are stored in different tables\n Scaled composite glyphs are treated differently\n Use of GSUB rather than morx(t)/feat\n Use of GPOS rather than kern/opbd\n Use of GDEF rather than lcar/prop\nIf both this and Apple are set, both formats are generated&quot;) },
<span class="lineNum">     540 </span>            :         { &quot;DefaultTTFflags&quot;, pr_int, &amp;old_ttf_flags, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     541 </span>            :         { &quot;DefaultOTFflags&quot;, pr_int, &amp;old_otf_flags, NULL, NULL, '\0', NULL, 1, NULL },
<span class="lineNum">     542 </span>            :         PREFS_LIST_EMPTY
<span class="lineNum">     543 </span>            : },
<span class="lineNum">     544 </span>            :  *prefs_list[] = { general_list, new_list, open_list, navigation_list, sync_list, editing_list, editing_interface_list, accent_list, args_list, fontinfo_list, generate_list, tt_list, opentype_list, hints_list, instrs_list,
<span class="lineNum">     545 </span>            :  #ifdef BUILD_COLLAB
<span class="lineNum">     546 </span>            :  collab_list,
<span class="lineNum">     547 </span>            :  #endif
<span class="lineNum">     548 </span>            :  hidden_list, NULL },
<span class="lineNum">     549 </span>            :  *load_prefs_list[] = { general_list, new_list, open_list, navigation_list, sync_list, editing_list, editing_interface_list, accent_list, args_list, fontinfo_list, generate_list, tt_list, opentype_list, hints_list, instrs_list,
<span class="lineNum">     550 </span>            :  #ifdef BUILD_COLLAB
<span class="lineNum">     551 </span>            :  collab_list,
<span class="lineNum">     552 </span>            :  #endif
<span class="lineNum">     553 </span>            :  hidden_list, oldnames, NULL };
<span class="lineNum">     554 </span>            : 
<span class="lineNum">     555 </span>            : struct visible_prefs_list { char *tab_name; int nest; struct prefs_list *pl; } visible_prefs_list[] = {
<span class="lineNum">     556 </span>            :     { N_(&quot;Generic&quot;), 0, general_list},
<span class="lineNum">     557 </span>            :     { N_(&quot;New Font&quot;), 0, new_list},
<span class="lineNum">     558 </span>            :     { N_(&quot;Open Font&quot;), 0, open_list},
<span class="lineNum">     559 </span>            :     { N_(&quot;Navigation&quot;), 0, navigation_list},
<span class="lineNum">     560 </span>            :     { N_(&quot;Editing&quot;), 0, editing_list},
<span class="lineNum">     561 </span>            :     { N_(&quot;Interface&quot;), 1, editing_interface_list},
<span class="lineNum">     562 </span>            :     { N_(&quot;Synchronize&quot;), 1, sync_list},
<span class="lineNum">     563 </span>            :     { N_(&quot;TT&quot;), 1, tt_list},
<span class="lineNum">     564 </span>            :     { N_(&quot;Accents&quot;), 1, accent_list},
<span class="lineNum">     565 </span>            :     { N_(&quot;Apps&quot;), 1, args_list},
<span class="lineNum">     566 </span>            :     { N_(&quot;Font Info&quot;), 0, fontinfo_list},
<span class="lineNum">     567 </span>            :     { N_(&quot;Generate&quot;), 0, generate_list},
<span class="lineNum">     568 </span>            :     { N_(&quot;PS Hints&quot;), 1, hints_list},
<span class="lineNum">     569 </span>            :     { N_(&quot;TT Instrs&quot;), 1, instrs_list},
<span class="lineNum">     570 </span>            :     { N_(&quot;OpenType&quot;), 1, opentype_list},
<span class="lineNum">     571 </span>            : #ifdef BUILD_COLLAB
<span class="lineNum">     572 </span>            :     { N_(&quot;Collaboration&quot;), 0, collab_list},
<span class="lineNum">     573 </span>            : #endif
<span class="lineNum">     574 </span>            :     { NULL, 0, NULL }
<a name="575"><span class="lineNum">     575 </span>            : };</a>
<span class="lineNum">     576 </span>            : 
<span class="lineNum">     577 </span><span class="lineNoCov">          0 : static void FileChooserPrefsChanged(void *pointless) {</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<a name="579"><span class="lineNum">     579 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     580 </span>            : 
<span class="lineNum">     581 </span><span class="lineCov">          1 : static void ProcessFileChooserPrefs(void) {</span>
<span class="lineNum">     582 </span>            :     unichar_t **b;
<span class="lineNum">     583 </span>            :     int i;
<span class="lineNum">     584 </span>            : 
<span class="lineNum">     585 </span><span class="lineCov">          1 :     GFileChooserSetShowHidden(gfc_showhidden);</span>
<span class="lineNum">     586 </span><span class="lineCov">          1 :     GFileChooserSetDirectoryPlacement(gfc_dirplace);</span>
<span class="lineNum">     587 </span><span class="lineCov">          1 :     if ( gfc_bookmarks==NULL ) {</span>
<span class="lineNum">     588 </span><span class="lineCov">          1 :         b = malloc(8*sizeof(unichar_t *));</span>
<span class="lineNum">     589 </span><span class="lineCov">          1 :         i = 0;</span>
<span class="lineNum">     590 </span>            : #ifdef __Mac
<span class="lineNum">     591 </span>            :         b[i++] = uc_copy(&quot;~/Library/Fonts/&quot;);
<span class="lineNum">     592 </span>            : #endif
<span class="lineNum">     593 </span><span class="lineCov">          1 :         b[i++] = uc_copy(&quot;~/fonts&quot;);</span>
<span class="lineNum">     594 </span>            : #ifdef __Mac
<span class="lineNum">     595 </span>            :         b[i++] = uc_copy(&quot;/Library/Fonts/&quot;);
<span class="lineNum">     596 </span>            :         b[i++] = uc_copy(&quot;/System/Library/Fonts/&quot;);
<span class="lineNum">     597 </span>            : #endif
<span class="lineNum">     598 </span>            : #if __CygWin
<span class="lineNum">     599 </span>            :         b[i++] = uc_copy(&quot;/cygdrive/c/Windows/Fonts/&quot;);
<span class="lineNum">     600 </span>            : #endif
<span class="lineNum">     601 </span><span class="lineCov">          1 :         b[i++] = uc_copy(&quot;/usr/X11R6/lib/X11/fonts/&quot;);</span>
<span class="lineNum">     602 </span>            : #ifndef __CygWin                /* I'm not releasing ftp support on cygwin */
<span class="lineNum">     603 </span><span class="lineCov">          1 :         b[i++] = uc_copy(&quot;ftp://ctan.org/pub/tex-archive/fonts/&quot;);</span>
<span class="lineNum">     604 </span>            : #endif
<span class="lineNum">     605 </span><span class="lineCov">          1 :         b[i++] = NULL;</span>
<span class="lineNum">     606 </span><span class="lineCov">          1 :         GFileChooserSetBookmarks(b);</span>
<span class="lineNum">     607 </span>            :     } else {
<span class="lineNum">     608 </span>            :         char *pt, *start;
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :         start = gfc_bookmarks;</span>
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :         for ( i=0; ; ++i ) {</span>
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :             pt = strchr(start,';');</span>
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :             if ( pt==NULL )</span>
<span class="lineNum">     613 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :             start = pt+1;</span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :         start = gfc_bookmarks;</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :         b = malloc((i+2)*sizeof(unichar_t *));</span>
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :         for ( i=0; ; ++i ) {</span>
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :             pt = strchr(start,';');</span>
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :             if ( pt!=NULL )</span>
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :                 *pt = '\0';</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :             b[i] = utf82u_copy(start);</span>
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :             if ( pt==NULL )</span>
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :             *pt = ';';</span>
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :             start = pt+1;</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :         b[i+1] = NULL;</span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :         GFileChooserSetBookmarks(b);</span>
<span class="lineNum">     630 </span>            :     }
<span class="lineNum">     631 </span><span class="lineCov">          1 :     GFileChooserSetPrefsChangedCallback(NULL,FileChooserPrefsChanged);</span>
<a name="632"><span class="lineNum">     632 </span><span class="lineCov">          1 : }</span></a>
<span class="lineNum">     633 </span>            : 
<span class="lineNum">     634 </span><span class="lineNoCov">          0 : static void GetFileChooserPrefs(void) {</span>
<span class="lineNum">     635 </span>            :     unichar_t **foo;
<span class="lineNum">     636 </span>            : 
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :     gfc_showhidden = GFileChooserGetShowHidden();</span>
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :     gfc_dirplace = GFileChooserGetDirectoryPlacement();</span>
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :     foo = GFileChooserGetBookmarks();</span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :     free(gfc_bookmarks);</span>
<span class="lineNum">     641 </span><span class="lineNoCov">          0 :     if ( foo==NULL || foo[0]==NULL )</span>
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :         gfc_bookmarks = NULL;</span>
<span class="lineNum">     643 </span>            :     else {
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :         int i,len=0;</span>
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :         for ( i=0; foo[i]!=NULL; ++i )</span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :             len += 4*u_strlen(foo[i])+1;</span>
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :         gfc_bookmarks = malloc(len+10);</span>
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :         len = 0;</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :         for ( i=0; foo[i]!=NULL; ++i ) {</span>
<span class="lineNum">     650 </span><span class="lineNoCov">          0 :             u2utf8_strcpy(gfc_bookmarks+len,foo[i]);</span>
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :             len += strlen(gfc_bookmarks+len);</span>
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :             gfc_bookmarks[len++] = ';';</span>
<span class="lineNum">     653 </span>            :         }
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :         if ( len&gt;0 )</span>
<span class="lineNum">     655 </span><span class="lineNoCov">          0 :             gfc_bookmarks[len-1] = '\0';</span>
<span class="lineNum">     656 </span>            :         else {
<span class="lineNum">     657 </span><span class="lineNoCov">          0 :             free(gfc_bookmarks);</span>
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :             gfc_bookmarks = NULL;</span>
<span class="lineNum">     659 </span>            :         }
<span class="lineNum">     660 </span>            :     }
<span class="lineNum">     661 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     662 </span>            : 
<a name="663"><span class="lineNum">     663 </span>            : #define TOPICS  (sizeof(visible_prefs_list)/sizeof(visible_prefs_list[0])-1)</a>
<span class="lineNum">     664 </span>            : 
<span class="lineNum">     665 </span><span class="lineCov">          1 : static int PrefsUI_GetPrefs(char *name,Val *val) {</span>
<span class="lineNum">     666 </span>            :     int i,j;
<span class="lineNum">     667 </span>            : 
<span class="lineNum">     668 </span>            :     /* Support for obsolete preferences */
<span class="lineNum">     669 </span><span class="lineCov">          1 :     alwaysgenapple=(old_sfnt_flags&amp;ttf_flag_applemode)?1:0;</span>
<span class="lineNum">     670 </span><span class="lineCov">          1 :     alwaysgenopentype=(old_sfnt_flags&amp;ttf_flag_otmode)?1:0;</span>
<span class="lineNum">     671 </span>            : 
<span class="lineNum">     672 </span><span class="lineCov">         77 :     for ( i=0; prefs_list[i]!=NULL; ++i ) for ( j=0; prefs_list[i][j].name!=NULL; ++j ) {</span>
<span class="lineNum">     673 </span><span class="lineCov">         77 :         if ( strcmp(prefs_list[i][j].name,name)==0 ) {</span>
<span class="lineNum">     674 </span><span class="lineCov">          1 :             struct prefs_list *pf = &amp;prefs_list[i][j];</span>
<span class="lineNum">     675 </span><span class="lineCov">          1 :             if ( pf-&gt;type == pr_bool || pf-&gt;type == pr_int || pf-&gt;type == pr_unicode ) {</span>
<span class="lineNum">     676 </span><span class="lineCov">          1 :                 val-&gt;type = v_int;</span>
<span class="lineNum">     677 </span><span class="lineCov">          1 :                 val-&gt;u.ival = *((int *) (pf-&gt;val));</span>
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_string || pf-&gt;type == pr_file ) {</span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :                 val-&gt;type = v_str;</span>
<span class="lineNum">     680 </span>            : 
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :                 char *tmpstr = pf-&gt;val ? *((char **) (pf-&gt;val)) : (char *) (pf-&gt;get)();</span>
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :                 val-&gt;u.sval = copy( tmpstr ? tmpstr : &quot;&quot; );</span>
<span class="lineNum">     683 </span>            : 
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :                 if( ! pf-&gt;val )</span>
<span class="lineNum">     685 </span><span class="lineNoCov">          0 :                     free( tmpstr );</span>
<span class="lineNum">     686 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_encoding ) {</span>
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :                 val-&gt;type = v_str;</span>
<span class="lineNum">     688 </span><span class="lineNoCov">          0 :                 if ( *((NameList **) (pf-&gt;val))==NULL )</span>
<span class="lineNum">     689 </span><span class="lineNoCov">          0 :                     val-&gt;u.sval = copy( &quot;NULL&quot; );</span>
<span class="lineNum">     690 </span>            :                 else
<span class="lineNum">     691 </span><span class="lineNoCov">          0 :                     val-&gt;u.sval = copy( (*((Encoding **) (pf-&gt;val)))-&gt;enc_name );</span>
<span class="lineNum">     692 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_namelist ) {</span>
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :                 val-&gt;type = v_str;</span>
<span class="lineNum">     694 </span><span class="lineNoCov">          0 :                 val-&gt;u.sval = copy( (*((NameList **) (pf-&gt;val)))-&gt;title );</span>
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_real || pf-&gt;type == pr_angle ) {</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :                 val-&gt;type = v_real;</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :                 val-&gt;u.fval = *((float *) (pf-&gt;val));</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :                 if ( pf-&gt;type == pr_angle )</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :                     val-&gt;u.fval *= RAD2DEG;</span>
<span class="lineNum">     700 </span>            :             } else
<span class="lineNum">     701 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     702 </span>            : 
<span class="lineNum">     703 </span><span class="lineCov">          1 : return( true );</span>
<span class="lineNum">     704 </span>            :         }
<span class="lineNum">     705 </span>            :     }
<span class="lineNum">     706 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="707"><span class="lineNum">     707 </span>            : }</a>
<span class="lineNum">     708 </span>            : 
<span class="lineNum">     709 </span><span class="lineCov">          3 : static void CheckObsoletePrefs(void) {</span>
<span class="lineNum">     710 </span><span class="lineCov">          3 :     if ( alwaysgenapple==false ) {</span>
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :         old_sfnt_flags &amp;= ~ttf_flag_applemode;</span>
<span class="lineNum">     712 </span><span class="lineCov">          3 :     } else if ( alwaysgenapple==true ) {</span>
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :         old_sfnt_flags |= ttf_flag_applemode;</span>
<span class="lineNum">     714 </span>            :     }
<span class="lineNum">     715 </span><span class="lineCov">          3 :     if ( alwaysgenopentype==false ) {</span>
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :         old_sfnt_flags &amp;= ~ttf_flag_otmode;</span>
<span class="lineNum">     717 </span><span class="lineCov">          3 :     } else if ( alwaysgenopentype==true ) {</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :         old_sfnt_flags |= ttf_flag_otmode;</span>
<span class="lineNum">     719 </span>            :     }
<span class="lineNum">     720 </span><span class="lineCov">          3 :     if ( old_ttf_flags!=0 )</span>
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :         old_sfnt_flags = old_ttf_flags | old_otf_flags;</span>
<a name="722"><span class="lineNum">     722 </span><span class="lineCov">          3 : }</span></a>
<span class="lineNum">     723 </span>            : 
<span class="lineNum">     724 </span><span class="lineCov">          3 : static int PrefsUI_SetPrefs(char *name,Val *val1, Val *val2) {</span>
<span class="lineNum">     725 </span>            :     int i,j;
<span class="lineNum">     726 </span>            : 
<span class="lineNum">     727 </span>            :     /* Support for obsolete preferences */
<span class="lineNum">     728 </span><span class="lineCov">          3 :     alwaysgenapple=-1; alwaysgenopentype=-1;</span>
<span class="lineNum">     729 </span>            : 
<span class="lineNum">     730 </span><span class="lineCov">        231 :     for ( i=0; prefs_list[i]!=NULL; ++i ) for ( j=0; prefs_list[i][j].name!=NULL; ++j ) {</span>
<span class="lineNum">     731 </span><span class="lineCov">        231 :         if ( strcmp(prefs_list[i][j].name,name)==0 ) {</span>
<span class="lineNum">     732 </span><span class="lineCov">          3 :             struct prefs_list *pf = &amp;prefs_list[i][j];</span>
<span class="lineNum">     733 </span><span class="lineCov">          3 :             if ( pf-&gt;type == pr_bool || pf-&gt;type == pr_int || pf-&gt;type == pr_unicode ) {</span>
<span class="lineNum">     734 </span><span class="lineCov">          3 :                 if ( (val1-&gt;type!=v_int &amp;&amp; val1-&gt;type!=v_unicode) || val2!=NULL )</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     736 </span><span class="lineCov">          3 :                 *((int *) (pf-&gt;val)) = val1-&gt;u.ival;</span>
<span class="lineNum">     737 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_real || pf-&gt;type == pr_angle ) {</span>
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :                 if ( val1-&gt;type==v_real &amp;&amp; val2==NULL )</span>
<span class="lineNum">     739 </span><span class="lineNoCov">          0 :                     *((float *) (pf-&gt;val)) = val1-&gt;u.fval;</span>
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :                 else if ( val1-&gt;type!=v_int || (val2!=NULL &amp;&amp; val2-&gt;type!=v_int ))</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     742 </span>            :                 else
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :                     *((float *) (pf-&gt;val)) = (val2==NULL ? val1-&gt;u.ival : val1-&gt;u.ival / (double) val2-&gt;u.ival);</span>
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :                 if ( pf-&gt;type == pr_angle )</span>
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :                     *((float *) (pf-&gt;val)) /= RAD2DEG;</span>
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_string || pf-&gt;type == pr_file ) {</span>
<span class="lineNum">     747 </span><span class="lineNoCov">          0 :                 if ( val1-&gt;type!=v_str || val2!=NULL )</span>
<span class="lineNum">     748 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :                 if ( pf-&gt;set ) {</span>
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :                     pf-&gt;set( val1-&gt;u.sval );</span>
<span class="lineNum">     751 </span>            :                 } else {
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :                     free( *((char **) (pf-&gt;val)));</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :                     *((char **) (pf-&gt;val)) = copy( val1-&gt;u.sval );</span>
<span class="lineNum">     754 </span>            :                 }
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_encoding ) {</span>
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :                 if ( val2!=NULL )</span>
<span class="lineNum">     757 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :                 else if ( val1-&gt;type==v_str &amp;&amp; pf-&gt;val == &amp;default_encoding) {</span>
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :                     Encoding *enc = FindOrMakeEncoding(val1-&gt;u.sval);</span>
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :                     if ( enc==NULL )</span>
<span class="lineNum">     761 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :                     *((Encoding **) (pf-&gt;val)) = enc;</span>
<span class="lineNum">     763 </span>            :                 } else
<span class="lineNum">     764 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :             } else if ( pf-&gt;type == pr_namelist ) {</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :                 if ( val2!=NULL )</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :                 else if ( val1-&gt;type==v_str ) {</span>
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :                     NameList *nl = NameListByName(val1-&gt;u.sval);</span>
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :                     if ( strcmp(val1-&gt;u.sval,&quot;NULL&quot;)==0 &amp;&amp; pf-&gt;val != &amp;namelist_for_new_fonts )</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :                         nl = NULL;</span>
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :                     else if ( nl==NULL )</span>
<span class="lineNum">     773 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :                     *((NameList **) (pf-&gt;val)) = nl;</span>
<span class="lineNum">     775 </span>            :                 } else
<span class="lineNum">     776 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">     777 </span>            :             } else
<span class="lineNum">     778 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     779 </span>            : 
<span class="lineNum">     780 </span><span class="lineCov">          3 :             CheckObsoletePrefs();</span>
<span class="lineNum">     781 </span><span class="lineCov">          3 :             SavePrefs(true);</span>
<span class="lineNum">     782 </span><span class="lineCov">          3 : return( true );</span>
<span class="lineNum">     783 </span>            :         }
<span class="lineNum">     784 </span>            :     }
<span class="lineNum">     785 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="786"><span class="lineNum">     786 </span>            : }</a>
<span class="lineNum">     787 </span>            : 
<span class="lineNum">     788 </span><span class="lineCov">         36 : static char *getPfaEditPrefs(void) {</span>
<span class="lineNum">     789 </span>            :     static char *prefs=NULL;
<span class="lineNum">     790 </span>            :     char buffer[1025];
<span class="lineNum">     791 </span>            :     char *ffdir;
<span class="lineNum">     792 </span>            : 
<span class="lineNum">     793 </span><span class="lineCov">         36 :     if ( prefs!=NULL )</span>
<span class="lineNum">     794 </span><span class="lineCov">         21 :         return prefs;</span>
<span class="lineNum">     795 </span><span class="lineCov">         15 :     ffdir = getFontForgeUserDir(Config);</span>
<span class="lineNum">     796 </span><span class="lineCov">         15 :     if ( ffdir==NULL )</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :         return NULL;</span>
<span class="lineNum">     798 </span><span class="lineCov">         15 :     sprintf(buffer,&quot;%s/prefs&quot;, ffdir);</span>
<span class="lineNum">     799 </span><span class="lineCov">         15 :     free(ffdir);</span>
<span class="lineNum">     800 </span><span class="lineCov">         15 :     prefs = copy(buffer);</span>
<span class="lineNum">     801 </span><span class="lineCov">         15 :     return prefs;</span>
<a name="802"><span class="lineNum">     802 </span>            : }</a>
<span class="lineNum">     803 </span>            : 
<span class="lineNum">     804 </span><span class="lineCov">         15 : static char *PrefsUI_getFontForgeShareDir(void) {</span>
<span class="lineNum">     805 </span>            :     static char *sharedir=NULL;
<span class="lineNum">     806 </span>            :     static int set=false;
<span class="lineNum">     807 </span>            :     char *pt;
<span class="lineNum">     808 </span>            :     int len;
<span class="lineNum">     809 </span>            : 
<span class="lineNum">     810 </span><span class="lineCov">         15 :     if ( set )</span>
<span class="lineNum">     811 </span><span class="lineCov">          2 : return( sharedir );</span>
<span class="lineNum">     812 </span>            : 
<span class="lineNum">     813 </span><span class="lineCov">         13 :     set = true;</span>
<span class="lineNum">     814 </span>            : 
<span class="lineNum">     815 </span>            : #if defined(__MINGW32__)
<span class="lineNum">     816 </span>            : 
<span class="lineNum">     817 </span>            :     len = strlen(GResourceProgramDir) + strlen(&quot;/share/fontforge&quot;) +1;
<span class="lineNum">     818 </span>            :     sharedir = malloc(len);
<span class="lineNum">     819 </span>            :     strcpy(sharedir, GResourceProgramDir);
<span class="lineNum">     820 </span>            :     strcat(sharedir, &quot;/share/fontforge&quot;);
<span class="lineNum">     821 </span>            :     return sharedir;
<span class="lineNum">     822 </span>            : 
<span class="lineNum">     823 </span>            : #else
<span class="lineNum">     824 </span>            : 
<span class="lineNum">     825 </span><span class="lineCov">         13 :     pt = strstr(GResourceProgramDir,&quot;/bin&quot;);</span>
<span class="lineNum">     826 </span><span class="lineCov">         13 :     if ( pt==NULL ) {</span>
<span class="lineNum">     827 </span>            : #if defined(SHAREDIR)
<span class="lineNum">     828 </span><span class="lineCov">         13 :         sharedir = copy(SHAREDIR &quot;/fontforge&quot; );</span>
<span class="lineNum">     829 </span><span class="lineCov">         13 : return( sharedir );</span>
<span class="lineNum">     830 </span>            : #elif defined(PREFIX)
<span class="lineNum">     831 </span>            :         sharedir = copy( PREFIX &quot;/share/fontforge&quot; );
<span class="lineNum">     832 </span>            : return( sharedir );
<span class="lineNum">     833 </span>            : #else
<span class="lineNum">     834 </span>            : return( NULL );
<span class="lineNum">     835 </span>            : #endif
<span class="lineNum">     836 </span>            :     }
<span class="lineNum">     837 </span><span class="lineNoCov">          0 :     len = (pt-GResourceProgramDir)+strlen(&quot;/share/fontforge&quot;)+1;</span>
<span class="lineNum">     838 </span><span class="lineNoCov">          0 :     sharedir = malloc(len);</span>
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :     strncpy(sharedir,GResourceProgramDir,pt-GResourceProgramDir);</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :     strcpy(sharedir+(pt-GResourceProgramDir),&quot;/share/fontforge&quot;);</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 : return( sharedir );</span>
<span class="lineNum">     842 </span>            : 
<span class="lineNum">     843 </span>            : #endif
<span class="lineNum">     844 </span>            : }
<a name="845"><span class="lineNum">     845 </span>            : </a>
<span class="lineNum">     846 </span>            : #  include &lt;charset.h&gt;            /* we still need the charsets &amp; encoding to set local_encoding */
<span class="lineNum">     847 </span><span class="lineCov">         80 : static int encmatch(const char *enc,int subok) {</span>
<span class="lineNum">     848 </span>            :     static struct { char *name; int enc; } encs[] = {
<span class="lineNum">     849 </span>            :         { &quot;US-ASCII&quot;, e_usascii },
<span class="lineNum">     850 </span>            :         { &quot;ASCII&quot;, e_usascii },
<span class="lineNum">     851 </span>            :         { &quot;ISO646-NO&quot;, e_iso646_no },
<span class="lineNum">     852 </span>            :         { &quot;ISO646-SE&quot;, e_iso646_se },
<span class="lineNum">     853 </span>            :         { &quot;LATIN10&quot;, e_iso8859_16 },
<span class="lineNum">     854 </span>            :         { &quot;LATIN1&quot;, e_iso8859_1 },
<span class="lineNum">     855 </span>            :         { &quot;ISO-8859-1&quot;, e_iso8859_1 },
<span class="lineNum">     856 </span>            :         { &quot;ISO-8859-2&quot;, e_iso8859_2 },
<span class="lineNum">     857 </span>            :         { &quot;ISO-8859-3&quot;, e_iso8859_3 },
<span class="lineNum">     858 </span>            :         { &quot;ISO-8859-4&quot;, e_iso8859_4 },
<span class="lineNum">     859 </span>            :         { &quot;ISO-8859-5&quot;, e_iso8859_4 },
<span class="lineNum">     860 </span>            :         { &quot;ISO-8859-6&quot;, e_iso8859_4 },
<span class="lineNum">     861 </span>            :         { &quot;ISO-8859-7&quot;, e_iso8859_4 },
<span class="lineNum">     862 </span>            :         { &quot;ISO-8859-8&quot;, e_iso8859_4 },
<span class="lineNum">     863 </span>            :         { &quot;ISO-8859-9&quot;, e_iso8859_4 },
<span class="lineNum">     864 </span>            :         { &quot;ISO-8859-10&quot;, e_iso8859_10 },
<span class="lineNum">     865 </span>            :         { &quot;ISO-8859-11&quot;, e_iso8859_11 },
<span class="lineNum">     866 </span>            :         { &quot;ISO-8859-13&quot;, e_iso8859_13 },
<span class="lineNum">     867 </span>            :         { &quot;ISO-8859-14&quot;, e_iso8859_14 },
<span class="lineNum">     868 </span>            :         { &quot;ISO-8859-15&quot;, e_iso8859_15 },
<span class="lineNum">     869 </span>            :         { &quot;ISO-8859-16&quot;, e_iso8859_16 },
<span class="lineNum">     870 </span>            :         { &quot;ISO_8859-1&quot;, e_iso8859_1 },
<span class="lineNum">     871 </span>            :         { &quot;ISO_8859-2&quot;, e_iso8859_2 },
<span class="lineNum">     872 </span>            :         { &quot;ISO_8859-3&quot;, e_iso8859_3 },
<span class="lineNum">     873 </span>            :         { &quot;ISO_8859-4&quot;, e_iso8859_4 },
<span class="lineNum">     874 </span>            :         { &quot;ISO_8859-5&quot;, e_iso8859_4 },
<span class="lineNum">     875 </span>            :         { &quot;ISO_8859-6&quot;, e_iso8859_4 },
<span class="lineNum">     876 </span>            :         { &quot;ISO_8859-7&quot;, e_iso8859_4 },
<span class="lineNum">     877 </span>            :         { &quot;ISO_8859-8&quot;, e_iso8859_4 },
<span class="lineNum">     878 </span>            :         { &quot;ISO_8859-9&quot;, e_iso8859_4 },
<span class="lineNum">     879 </span>            :         { &quot;ISO_8859-10&quot;, e_iso8859_10 },
<span class="lineNum">     880 </span>            :         { &quot;ISO_8859-11&quot;, e_iso8859_11 },
<span class="lineNum">     881 </span>            :         { &quot;ISO_8859-13&quot;, e_iso8859_13 },
<span class="lineNum">     882 </span>            :         { &quot;ISO_8859-14&quot;, e_iso8859_14 },
<span class="lineNum">     883 </span>            :         { &quot;ISO_8859-15&quot;, e_iso8859_15 },
<span class="lineNum">     884 </span>            :         { &quot;ISO_8859-16&quot;, e_iso8859_16 },
<span class="lineNum">     885 </span>            :         { &quot;ISO8859-1&quot;, e_iso8859_1 },
<span class="lineNum">     886 </span>            :         { &quot;ISO8859-2&quot;, e_iso8859_2 },
<span class="lineNum">     887 </span>            :         { &quot;ISO8859-3&quot;, e_iso8859_3 },
<span class="lineNum">     888 </span>            :         { &quot;ISO8859-4&quot;, e_iso8859_4 },
<span class="lineNum">     889 </span>            :         { &quot;ISO8859-5&quot;, e_iso8859_4 },
<span class="lineNum">     890 </span>            :         { &quot;ISO8859-6&quot;, e_iso8859_4 },
<span class="lineNum">     891 </span>            :         { &quot;ISO8859-7&quot;, e_iso8859_4 },
<span class="lineNum">     892 </span>            :         { &quot;ISO8859-8&quot;, e_iso8859_4 },
<span class="lineNum">     893 </span>            :         { &quot;ISO8859-9&quot;, e_iso8859_4 },
<span class="lineNum">     894 </span>            :         { &quot;ISO8859-10&quot;, e_iso8859_10 },
<span class="lineNum">     895 </span>            :         { &quot;ISO8859-11&quot;, e_iso8859_11 },
<span class="lineNum">     896 </span>            :         { &quot;ISO8859-13&quot;, e_iso8859_13 },
<span class="lineNum">     897 </span>            :         { &quot;ISO8859-14&quot;, e_iso8859_14 },
<span class="lineNum">     898 </span>            :         { &quot;ISO8859-15&quot;, e_iso8859_15 },
<span class="lineNum">     899 </span>            :         { &quot;ISO8859-16&quot;, e_iso8859_16 },
<span class="lineNum">     900 </span>            :         { &quot;ISO88591&quot;, e_iso8859_1 },
<span class="lineNum">     901 </span>            :         { &quot;ISO88592&quot;, e_iso8859_2 },
<span class="lineNum">     902 </span>            :         { &quot;ISO88593&quot;, e_iso8859_3 },
<span class="lineNum">     903 </span>            :         { &quot;ISO88594&quot;, e_iso8859_4 },
<span class="lineNum">     904 </span>            :         { &quot;ISO88595&quot;, e_iso8859_4 },
<span class="lineNum">     905 </span>            :         { &quot;ISO88596&quot;, e_iso8859_4 },
<span class="lineNum">     906 </span>            :         { &quot;ISO88597&quot;, e_iso8859_4 },
<span class="lineNum">     907 </span>            :         { &quot;ISO88598&quot;, e_iso8859_4 },
<span class="lineNum">     908 </span>            :         { &quot;ISO88599&quot;, e_iso8859_4 },
<span class="lineNum">     909 </span>            :         { &quot;ISO885910&quot;, e_iso8859_10 },
<span class="lineNum">     910 </span>            :         { &quot;ISO885911&quot;, e_iso8859_11 },
<span class="lineNum">     911 </span>            :         { &quot;ISO885913&quot;, e_iso8859_13 },
<span class="lineNum">     912 </span>            :         { &quot;ISO885914&quot;, e_iso8859_14 },
<span class="lineNum">     913 </span>            :         { &quot;ISO885915&quot;, e_iso8859_15 },
<span class="lineNum">     914 </span>            :         { &quot;ISO885916&quot;, e_iso8859_16 },
<span class="lineNum">     915 </span>            :         { &quot;8859_1&quot;, e_iso8859_1 },
<span class="lineNum">     916 </span>            :         { &quot;8859_2&quot;, e_iso8859_2 },
<span class="lineNum">     917 </span>            :         { &quot;8859_3&quot;, e_iso8859_3 },
<span class="lineNum">     918 </span>            :         { &quot;8859_4&quot;, e_iso8859_4 },
<span class="lineNum">     919 </span>            :         { &quot;8859_5&quot;, e_iso8859_4 },
<span class="lineNum">     920 </span>            :         { &quot;8859_6&quot;, e_iso8859_4 },
<span class="lineNum">     921 </span>            :         { &quot;8859_7&quot;, e_iso8859_4 },
<span class="lineNum">     922 </span>            :         { &quot;8859_8&quot;, e_iso8859_4 },
<span class="lineNum">     923 </span>            :         { &quot;8859_9&quot;, e_iso8859_4 },
<span class="lineNum">     924 </span>            :         { &quot;8859_10&quot;, e_iso8859_10 },
<span class="lineNum">     925 </span>            :         { &quot;8859_11&quot;, e_iso8859_11 },
<span class="lineNum">     926 </span>            :         { &quot;8859_13&quot;, e_iso8859_13 },
<span class="lineNum">     927 </span>            :         { &quot;8859_14&quot;, e_iso8859_14 },
<span class="lineNum">     928 </span>            :         { &quot;8859_15&quot;, e_iso8859_15 },
<span class="lineNum">     929 </span>            :         { &quot;8859_16&quot;, e_iso8859_16 },
<span class="lineNum">     930 </span>            :         { &quot;KOI8-R&quot;, e_koi8_r },
<span class="lineNum">     931 </span>            :         { &quot;KOI8R&quot;, e_koi8_r },
<span class="lineNum">     932 </span>            :         { &quot;WINDOWS-1252&quot;, e_win },
<span class="lineNum">     933 </span>            :         { &quot;CP1252&quot;, e_win },
<span class="lineNum">     934 </span>            :         { &quot;Big5&quot;, e_big5 },
<span class="lineNum">     935 </span>            :         { &quot;Big-5&quot;, e_big5 },
<span class="lineNum">     936 </span>            :         { &quot;BigFive&quot;, e_big5 },
<span class="lineNum">     937 </span>            :         { &quot;Big-Five&quot;, e_big5 },
<span class="lineNum">     938 </span>            :         { &quot;Big5HKSCS&quot;, e_big5hkscs },
<span class="lineNum">     939 </span>            :         { &quot;Big5-HKSCS&quot;, e_big5hkscs },
<span class="lineNum">     940 </span>            :         { &quot;UTF-8&quot;, e_utf8 },
<span class="lineNum">     941 </span>            :         { &quot;ISO-10646/UTF-8&quot;, e_utf8 },
<span class="lineNum">     942 </span>            :         { &quot;ISO_10646/UTF-8&quot;, e_utf8 },
<span class="lineNum">     943 </span>            :         { &quot;UCS2&quot;, e_unicode },
<span class="lineNum">     944 </span>            :         { &quot;UCS-2&quot;, e_unicode },
<span class="lineNum">     945 </span>            :         { &quot;UCS-2-INTERNAL&quot;, e_unicode },
<span class="lineNum">     946 </span>            :         { &quot;ISO-10646&quot;, e_unicode },
<span class="lineNum">     947 </span>            :         { &quot;ISO_10646&quot;, e_unicode },
<span class="lineNum">     948 </span>            :         /* { &quot;eucJP&quot;, e_euc }, */
<span class="lineNum">     949 </span>            :         /* { &quot;EUC-JP&quot;, e_euc }, */
<span class="lineNum">     950 </span>            :         /* { &quot;ujis&quot;, ??? }, */
<span class="lineNum">     951 </span>            :         /* { &quot;EUC-KR&quot;, e_euckorean }, */
<span class="lineNum">     952 </span>            :         { NULL, 0 }
<span class="lineNum">     953 </span>            :     };
<span class="lineNum">     954 </span>            : 
<span class="lineNum">     955 </span>            :     int i;
<span class="lineNum">     956 </span>            :     char buffer[80];
<span class="lineNum">     957 </span>            : #if HAVE_ICONV
<span class="lineNum">     958 </span>            :     static char *last_complaint;
<span class="lineNum">     959 </span>            : 
<span class="lineNum">     960 </span>            :     iconv_t test;
<span class="lineNum">     961 </span><span class="lineCov">         80 :     free(iconv_local_encoding_name);</span>
<span class="lineNum">     962 </span><span class="lineCov">         80 :     iconv_local_encoding_name= NULL;</span>
<span class="lineNum">     963 </span>            : #endif
<span class="lineNum">     964 </span>            : 
<span class="lineNum">     965 </span><span class="lineCov">         80 :     if ( strchr(enc,'@')!=NULL &amp;&amp; strlen(enc)&lt;sizeof(buffer)-1 ) {</span>
<span class="lineNum">     966 </span><span class="lineNoCov">          0 :         strcpy(buffer,enc);</span>
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :         *strchr(buffer,'@') = '\0';</span>
<span class="lineNum">     968 </span><span class="lineNoCov">          0 :         enc = buffer;</span>
<span class="lineNum">     969 </span>            :     }
<span class="lineNum">     970 </span>            : 
<span class="lineNum">     971 </span><span class="lineCov">       8000 :     for ( i=0; encs[i].name!=NULL; ++i )</span>
<span class="lineNum">     972 </span><span class="lineCov">       7920 :         if ( strmatch(enc,encs[i].name)==0 )</span>
<span class="lineNum">     973 </span><span class="lineNoCov">          0 : return( encs[i].enc );</span>
<span class="lineNum">     974 </span>            : 
<span class="lineNum">     975 </span><span class="lineCov">         80 :     if ( subok ) {</span>
<span class="lineNum">     976 </span><span class="lineNoCov">          0 :         for ( i=0; encs[i].name!=NULL; ++i )</span>
<span class="lineNum">     977 </span><span class="lineNoCov">          0 :             if ( strstrmatch(enc,encs[i].name)!=NULL )</span>
<span class="lineNum">     978 </span><span class="lineNoCov">          0 : return( encs[i].enc );</span>
<span class="lineNum">     979 </span>            : 
<span class="lineNum">     980 </span>            : #if HAVE_ICONV
<span class="lineNum">     981 </span>            :         /* I only try to use iconv if the encoding doesn't match one I support*/
<span class="lineNum">     982 </span>            :         /*  loading iconv unicode data takes a while */
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :         test = iconv_open(enc,FindUnicharName());</span>
<span class="lineNum">     984 </span><span class="lineNoCov">          0 :         if ( test==(iconv_t) (-1) || test==NULL ) {</span>
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :             if ( last_complaint==NULL || strcmp(last_complaint,enc)!=0 ) {</span>
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :                 fprintf( stderr, &quot;Neither FontForge nor iconv() supports your encoding (%s) we will pretend\n you asked for latin1 instead.\n&quot;, enc );</span>
<span class="lineNum">     987 </span><span class="lineNoCov">          0 :                 free( last_complaint );</span>
<span class="lineNum">     988 </span><span class="lineNoCov">          0 :                 last_complaint = copy(enc);</span>
<span class="lineNum">     989 </span>            :             }
<span class="lineNum">     990 </span>            :         } else {
<span class="lineNum">     991 </span><span class="lineNoCov">          0 :             if ( last_complaint==NULL || strcmp(last_complaint,enc)!=0 ) {</span>
<span class="lineNum">     992 </span><span class="lineNoCov">          0 :                 fprintf( stderr, &quot;FontForge does not support your encoding (%s), it will try to use iconv()\n or it will pretend the local encoding is latin1\n&quot;, enc );</span>
<span class="lineNum">     993 </span><span class="lineNoCov">          0 :                 free( last_complaint );</span>
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :                 last_complaint = copy(enc);</span>
<span class="lineNum">     995 </span>            :             }
<span class="lineNum">     996 </span><span class="lineNoCov">          0 :             iconv_local_encoding_name= copy(enc);</span>
<span class="lineNum">     997 </span><span class="lineNoCov">          0 :             iconv_close(test);</span>
<span class="lineNum">     998 </span>            :         }
<span class="lineNum">     999 </span>            : #else
<span class="lineNum">    1000 </span>            :         fprintf( stderr, &quot;FontForge does not support your encoding (%s), it will pretend the local encoding is latin1\n&quot;, enc );
<span class="lineNum">    1001 </span>            : #endif
<span class="lineNum">    1002 </span>            : 
<span class="lineNum">    1003 </span><span class="lineNoCov">          0 : return( e_iso8859_1 );</span>
<span class="lineNum">    1004 </span>            :     }
<span class="lineNum">    1005 </span><span class="lineCov">         80 : return( e_unknown );</span>
<a name="1006"><span class="lineNum">    1006 </span>            : }</a>
<span class="lineNum">    1007 </span>            : 
<span class="lineNum">    1008 </span><span class="lineCov">         40 : static int DefaultEncoding(void) {</span>
<span class="lineNum">    1009 </span>            :     const char *loc;
<span class="lineNum">    1010 </span>            :     int enc;
<span class="lineNum">    1011 </span>            : 
<span class="lineNum">    1012 </span>            : #if HAVE_LANGINFO_H
<span class="lineNum">    1013 </span><span class="lineCov">         40 :     loc = nl_langinfo(CODESET);</span>
<span class="lineNum">    1014 </span><span class="lineCov">         40 :     enc = encmatch(loc,false);</span>
<span class="lineNum">    1015 </span><span class="lineCov">         40 :     if ( enc!=e_unknown )</span>
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 : return( enc );</span>
<span class="lineNum">    1017 </span>            : #endif
<span class="lineNum">    1018 </span><span class="lineCov">         40 :     loc = getenv(&quot;LC_ALL&quot;);</span>
<span class="lineNum">    1019 </span><span class="lineCov">         40 :     if ( loc==NULL ) loc = getenv(&quot;LC_CTYPE&quot;);</span>
<span class="lineNum">    1020 </span>            :     /*if ( loc==NULL ) loc = getenv(&quot;LC_MESSAGES&quot;);*/
<span class="lineNum">    1021 </span><span class="lineCov">         40 :     if ( loc==NULL ) loc = getenv(&quot;LANG&quot;);</span>
<span class="lineNum">    1022 </span>            : 
<span class="lineNum">    1023 </span><span class="lineCov">         40 :     if ( loc==NULL )</span>
<span class="lineNum">    1024 </span><span class="lineNoCov">          0 : return( e_iso8859_1 );</span>
<span class="lineNum">    1025 </span>            : 
<span class="lineNum">    1026 </span><span class="lineCov">         40 :     enc = encmatch(loc,false);</span>
<span class="lineNum">    1027 </span><span class="lineCov">         40 :     if ( enc==e_unknown ) {</span>
<span class="lineNum">    1028 </span><span class="lineCov">         40 :         loc = strrchr(loc,'.');</span>
<span class="lineNum">    1029 </span><span class="lineCov">         40 :         if ( loc==NULL )</span>
<span class="lineNum">    1030 </span><span class="lineCov">         40 : return( e_iso8859_1 );</span>
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :         enc = encmatch(loc+1,true);</span>
<span class="lineNum">    1032 </span>            :     }
<span class="lineNum">    1033 </span><span class="lineNoCov">          0 :     if ( enc==e_unknown )</span>
<span class="lineNum">    1034 </span><span class="lineNoCov">          0 : return( e_iso8859_1 );</span>
<span class="lineNum">    1035 </span>            : 
<span class="lineNum">    1036 </span><span class="lineNoCov">          0 : return( enc );</span>
<a name="1037"><span class="lineNum">    1037 </span>            : }</a>
<span class="lineNum">    1038 </span>            : 
<span class="lineNum">    1039 </span><span class="lineCov">         40 : static void DefaultXUID(void) {</span>
<span class="lineNum">    1040 </span>            :     /* Adobe has assigned PfaEdit a base XUID of 1021. Each new user is going */
<span class="lineNum">    1041 </span>            :     /*  to get a couple of random numbers appended to that, hoping that will */
<span class="lineNum">    1042 </span>            :     /*  make for a fairly safe system. */
<span class="lineNum">    1043 </span>            :     /* FontForge will use the same scheme */
<span class="lineNum">    1044 </span>            :     int r1, r2;
<span class="lineNum">    1045 </span>            :     char buffer[50];
<span class="lineNum">    1046 </span>            :     struct timeval tv;
<span class="lineNum">    1047 </span>            : 
<span class="lineNum">    1048 </span><span class="lineCov">         40 :     gettimeofday(&amp;tv,NULL);</span>
<span class="lineNum">    1049 </span><span class="lineCov">         40 :     srand(tv.tv_usec);</span>
<span class="lineNum">    1050 </span>            :     do {
<span class="lineNum">    1051 </span><span class="lineCov">         40 :         r1 = rand()&amp;0x3ff;</span>
<span class="lineNum">    1052 </span><span class="lineCov">         40 :     } while ( r1==0 );          /* I reserve &quot;0&quot; for me! */</span>
<span class="lineNum">    1053 </span><span class="lineCov">         40 :     gettimeofday(&amp;tv,NULL);</span>
<span class="lineNum">    1054 </span><span class="lineCov">         40 :     g_random_set_seed(tv.tv_usec+1);</span>
<span class="lineNum">    1055 </span><span class="lineCov">         40 :     r2 = g_random_int();</span>
<span class="lineNum">    1056 </span><span class="lineCov">         40 :     sprintf( buffer, &quot;1021 %d %d&quot;, r1, r2 );</span>
<span class="lineNum">    1057 </span><span class="lineCov">         40 :     if (xuid != NULL) free(xuid);</span>
<span class="lineNum">    1058 </span><span class="lineCov">         40 :     xuid = copy(buffer);</span>
<a name="1059"><span class="lineNum">    1059 </span><span class="lineCov">         40 : }</span></a>
<span class="lineNum">    1060 </span>            : 
<span class="lineNum">    1061 </span><span class="lineCov">         40 : static void PrefsUI_SetDefaults(void) {</span>
<span class="lineNum">    1062 </span>            : 
<span class="lineNum">    1063 </span><span class="lineCov">         40 :     DefaultXUID();</span>
<span class="lineNum">    1064 </span><span class="lineCov">         40 :     local_encoding = DefaultEncoding();</span>
<a name="1065"><span class="lineNum">    1065 </span><span class="lineCov">         40 : }</span></a>
<span class="lineNum">    1066 </span>            : 
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 : static void ParseMacMapping(char *pt,struct macsettingname *ms) {</span>
<span class="lineNum">    1068 </span>            :     char *end;
<span class="lineNum">    1069 </span>            : 
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :     ms-&gt;mac_feature_type = strtol(pt,&amp;end,10);</span>
<span class="lineNum">    1071 </span><span class="lineNoCov">          0 :     if ( *end==',' ) ++end;</span>
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 :     ms-&gt;mac_feature_setting = strtol(end,&amp;end,10);</span>
<span class="lineNum">    1073 </span><span class="lineNoCov">          0 :     if ( *end==' ' ) ++end;</span>
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :     ms-&gt;otf_tag =</span>
<span class="lineNum">    1075 </span><span class="lineNoCov">          0 :         ((end[0]&amp;0xff)&lt;&lt;24) |</span>
<span class="lineNum">    1076 </span><span class="lineNoCov">          0 :         ((end[1]&amp;0xff)&lt;&lt;16) |</span>
<span class="lineNum">    1077 </span><span class="lineNoCov">          0 :         ((end[2]&amp;0xff)&lt;&lt;8) |</span>
<span class="lineNum">    1078 </span><span class="lineNoCov">          0 :         (end[3]&amp;0xff);</span>
<a name="1079"><span class="lineNum">    1079 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1080 </span>            : 
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 : static void ParseNewMacFeature(FILE *p,char *line) {</span>
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :     fseek(p,-(strlen(line)-strlen(&quot;MacFeat:&quot;)),SEEK_CUR);</span>
<span class="lineNum">    1083 </span><span class="lineNoCov">          0 :     line[strlen(&quot;MacFeat:&quot;)] ='\0';</span>
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :     default_mac_feature_map = SFDParseMacFeatures(p,line);</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">          0 :     fseek(p,-strlen(line),SEEK_CUR);</span>
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :     if ( user_mac_feature_map!=NULL )</span>
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :         MacFeatListFree(user_mac_feature_map);</span>
<span class="lineNum">    1088 </span><span class="lineNoCov">          0 :     user_mac_feature_map = default_mac_feature_map;</span>
<a name="1089"><span class="lineNum">    1089 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1090 </span>            : 
<span class="lineNum">    1091 </span><span class="lineCov">         40 : static void PrefsUI_LoadPrefs_FromFile( char* filename )</span>
<span class="lineNum">    1092 </span>            : {
<span class="lineNum">    1093 </span>            :     FILE *p;
<span class="lineNum">    1094 </span>            :     char line[1100];
<span class="lineNum">    1095 </span><span class="lineCov">         40 :     int i, j, ri=0, mn=0, ms=0, fn=0, ff=0, filt_max=0;</span>
<span class="lineNum">    1096 </span><span class="lineCov">         40 :     int msp=0, msc=0;</span>
<span class="lineNum">    1097 </span>            :     char *pt;
<span class="lineNum">    1098 </span>            :     struct prefs_list *pl;
<span class="lineNum">    1099 </span>            : 
<span class="lineNum">    1100 </span><span class="lineCov">         40 :     if ( filename!=NULL &amp;&amp; (p=fopen(filename,&quot;r&quot;))!=NULL ) {</span>
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :         while ( fgets(line,sizeof(line),p)!=NULL ) {</span>
<span class="lineNum">    1102 </span><span class="lineNoCov">          0 :             if ( *line=='#' )</span>
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :             pt = strchr(line,':');</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :             if ( pt==NULL )</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :             for ( j=0; load_prefs_list[j]!=NULL; ++j ) {</span>
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :                 for ( i=0; load_prefs_list[j][i].name!=NULL; ++i )</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :                     if ( strncmp(line,load_prefs_list[j][i].name,pt-line)==0 )</span>
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1111 </span><span class="lineNoCov">          0 :                 if ( load_prefs_list[j][i].name!=NULL )</span>
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1113 </span>            :             }
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :             pl = NULL;</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :             if ( load_prefs_list[j]!=NULL )</span>
<span class="lineNum">    1116 </span><span class="lineNoCov">          0 :                 pl = &amp;load_prefs_list[j][i];</span>
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :             for ( ++pt; *pt=='\t'; ++pt );</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :             if ( line[strlen(line)-1]=='\n' )</span>
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 :                 line[strlen(line)-1] = '\0';</span>
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 :             if ( line[strlen(line)-1]=='\r' )</span>
<span class="lineNum">    1121 </span><span class="lineNoCov">          0 :                 line[strlen(line)-1] = '\0';</span>
<span class="lineNum">    1122 </span><span class="lineNoCov">          0 :             if ( pl==NULL ) {</span>
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :                 if ( strncmp(line,&quot;Recent:&quot;,strlen(&quot;Recent:&quot;))==0 &amp;&amp; ri&lt;RECENT_MAX )</span>
<span class="lineNum">    1124 </span><span class="lineNoCov">          0 :                     RecentFiles[ri++] = copy(pt);</span>
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 :                 else if ( strncmp(line,&quot;MenuScript:&quot;,strlen(&quot;MenuScript:&quot;))==0 &amp;&amp; ms&lt;SCRIPT_MENU_MAX )</span>
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :                     script_filenames[ms++] = copy(pt);</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 :                 else if ( strncmp(line,&quot;MenuName:&quot;,strlen(&quot;MenuName:&quot;))==0 &amp;&amp; mn&lt;SCRIPT_MENU_MAX )</span>
<span class="lineNum">    1128 </span><span class="lineNoCov">          0 :                     script_menu_names[mn++] = utf82u_copy(pt);</span>
<span class="lineNum">    1129 </span><span class="lineNoCov">          0 :                 else if ( strncmp(line,&quot;FontFilterName:&quot;,strlen(&quot;FontFilterName:&quot;))==0 ) {</span>
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :                     if ( fn&gt;=filt_max )</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 :                         user_font_filters = realloc(user_font_filters,((filt_max+=10)+1)*sizeof( struct openfilefilters));</span>
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 :                     user_font_filters[fn].filter = NULL;</span>
<span class="lineNum">    1133 </span><span class="lineNoCov">          0 :                     user_font_filters[fn++].name = copy(pt);</span>
<span class="lineNum">    1134 </span><span class="lineNoCov">          0 :                     user_font_filters[fn].name = NULL;</span>
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 :                 } else if ( strncmp(line,&quot;FontFilter:&quot;,strlen(&quot;FontFilter:&quot;))==0 ) {</span>
<span class="lineNum">    1136 </span><span class="lineNoCov">          0 :                     if ( ff&lt;filt_max )</span>
<span class="lineNum">    1137 </span><span class="lineNoCov">          0 :                         user_font_filters[ff++].filter = copy(pt);</span>
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 :                 } else if ( strncmp(line,&quot;MacMapCnt:&quot;,strlen(&quot;MacSetCnt:&quot;))==0 ) {</span>
<span class="lineNum">    1139 </span><span class="lineNoCov">          0 :                     sscanf( pt, &quot;%d&quot;, &amp;msc );</span>
<span class="lineNum">    1140 </span><span class="lineNoCov">          0 :                     msp = 0;</span>
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag = calloc(msc+1,sizeof(struct macsettingname));</span>
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :                 } else if ( strncmp(line,&quot;MacMapping:&quot;,strlen(&quot;MacMapping:&quot;))==0 &amp;&amp; msp&lt;msc ) {</span>
<span class="lineNum">    1143 </span><span class="lineNoCov">          0 :                     ParseMacMapping(pt,&amp;user_macfeat_otftag[msp++]);</span>
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :                 } else if ( strncmp(line,&quot;MacFeat:&quot;,strlen(&quot;MacFeat:&quot;))==0 ) {</span>
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :                     ParseNewMacFeature(p,line);</span>
<span class="lineNum">    1146 </span>            :                 }
<span class="lineNum">    1147 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    1148 </span>            :             }
<span class="lineNum">    1149 </span><span class="lineNoCov">          0 :             switch ( pl-&gt;type ) {</span>
<span class="lineNum">    1150 </span>            :               case pr_encoding:
<span class="lineNum">    1151 </span><span class="lineNoCov">          0 :                 { Encoding *enc = FindOrMakeEncoding(pt);</span>
<span class="lineNum">    1152 </span><span class="lineNoCov">          0 :                     if ( enc==NULL )</span>
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :                         enc = FindOrMakeEncoding(&quot;ISO8859-1&quot;);</span>
<span class="lineNum">    1154 </span><span class="lineNoCov">          0 :                     if ( enc==NULL )</span>
<span class="lineNum">    1155 </span><span class="lineNoCov">          0 :                         enc = &amp;custom;</span>
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :                     *((Encoding **) (pl-&gt;val)) = enc;</span>
<span class="lineNum">    1157 </span>            :                 }
<span class="lineNum">    1158 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1159 </span>            :               case pr_namelist:
<span class="lineNum">    1160 </span><span class="lineNoCov">          0 :                 { NameList *nl = NameListByName(pt);</span>
<span class="lineNum">    1161 </span><span class="lineNoCov">          0 :                     if ( strcmp(pt,&quot;NULL&quot;)==0 &amp;&amp; pl-&gt;val != &amp;namelist_for_new_fonts )</span>
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :                         *((NameList **) (pl-&gt;val)) = NULL;</span>
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 :                     else if ( nl!=NULL )</span>
<span class="lineNum">    1164 </span><span class="lineNoCov">          0 :                         *((NameList **) (pl-&gt;val)) = nl;</span>
<span class="lineNum">    1165 </span>            :                 }
<span class="lineNum">    1166 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1167 </span>            :               case pr_bool: case pr_int:
<span class="lineNum">    1168 </span><span class="lineNoCov">          0 :                 sscanf( pt, &quot;%d&quot;, (int *) pl-&gt;val );</span>
<span class="lineNum">    1169 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1170 </span>            :               case pr_unicode:
<span class="lineNum">    1171 </span><span class="lineNoCov">          0 :                 if ( sscanf( pt, &quot;U+%x&quot;, (int *) pl-&gt;val )!=1 )</span>
<span class="lineNum">    1172 </span><span class="lineNoCov">          0 :                     if ( sscanf( pt, &quot;u+%x&quot;, (int *) pl-&gt;val )!=1 )</span>
<span class="lineNum">    1173 </span><span class="lineNoCov">          0 :                         sscanf( pt, &quot;%x&quot;, (int *) pl-&gt;val );</span>
<span class="lineNum">    1174 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1175 </span>            :               case pr_real: case pr_angle:
<span class="lineNum">    1176 </span>            :                 { char *end;
<span class="lineNum">    1177 </span><span class="lineNoCov">          0 :                     *((float *) pl-&gt;val) = strtod(pt,&amp;end);</span>
<span class="lineNum">    1178 </span><span class="lineNoCov">          0 :                     if (( *end==',' || *end=='.' ) ) {</span>
<span class="lineNum">    1179 </span><span class="lineNoCov">          0 :                         *end = (*end=='.')?',':'.';</span>
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :                         *((float *) pl-&gt;val) = strtod(pt,NULL);</span>
<span class="lineNum">    1181 </span>            :                     }
<span class="lineNum">    1182 </span>            :                 }
<span class="lineNum">    1183 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;type == pr_angle )</span>
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :                     *(float *) pl-&gt;val /= RAD2DEG;</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1186 </span>            :               case pr_string: case pr_file:
<span class="lineNum">    1187 </span><span class="lineNoCov">          0 :                 if ( *pt=='\0' ) pt=NULL;</span>
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;val!=NULL )</span>
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 :                     *((char **) (pl-&gt;val)) = copy(pt);</span>
<span class="lineNum">    1190 </span>            :                 else
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 :                     (pl-&gt;set)(copy(pt));</span>
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1193 </span>            :             }
<span class="lineNum">    1194 </span>            :         }
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 :         fclose(p);</span>
<span class="lineNum">    1196 </span>            :     }
<a name="1197"><span class="lineNum">    1197 </span><span class="lineCov">         40 : }</span></a>
<span class="lineNum">    1198 </span>            : 
<span class="lineNum">    1199 </span><span class="lineCov">         40 : void Prefs_LoadDefaultPreferences( void )</span>
<span class="lineNum">    1200 </span>            : {
<span class="lineNum">    1201 </span>            :     char filename[PATH_MAX+1];
<span class="lineNum">    1202 </span><span class="lineCov">         40 :     char* sharedir = getShareDir();</span>
<span class="lineNum">    1203 </span>            : 
<span class="lineNum">    1204 </span><span class="lineCov">         40 :     snprintf(filename,PATH_MAX,&quot;%s/prefs&quot;, sharedir );</span>
<span class="lineNum">    1205 </span><span class="lineCov">         40 :     PrefsUI_LoadPrefs_FromFile( filename );</span>
<span class="lineNum">    1206 </span><span class="lineCov">         40 : }</span>
<a name="1207"><span class="lineNum">    1207 </span>            : </a>
<span class="lineNum">    1208 </span>            : 
<span class="lineNum">    1209 </span><span class="lineCov">          1 : static void PrefsUI_LoadPrefs(void)</span>
<span class="lineNum">    1210 </span>            : {
<span class="lineNum">    1211 </span><span class="lineCov">          1 :     char *prefs = getPfaEditPrefs();</span>
<span class="lineNum">    1212 </span>            :     FILE *p;
<span class="lineNum">    1213 </span>            :     char line[1100], path[PATH_MAX];
<span class="lineNum">    1214 </span><span class="lineCov">          1 :     int i, j, ri=0, mn=0, ms=0, fn=0, ff=0, filt_max=0;</span>
<span class="lineNum">    1215 </span><span class="lineCov">          1 :     int msp=0, msc=0;</span>
<span class="lineNum">    1216 </span><span class="lineCov">          1 :     char *pt, *real_xdefs_filename = NULL;</span>
<span class="lineNum">    1217 </span>            :     struct prefs_list *pl;
<span class="lineNum">    1218 </span>            : 
<span class="lineNum">    1219 </span><span class="lineCov">          1 :     LoadPluginDir(NULL);</span>
<span class="lineNum">    1220 </span><span class="lineCov">          1 :     LoadPfaEditEncodings();</span>
<span class="lineNum">    1221 </span><span class="lineCov">          1 :     LoadGroupList();</span>
<span class="lineNum">    1222 </span>            : 
<span class="lineNum">    1223 </span><span class="lineCov">          1 :     if ( prefs!=NULL &amp;&amp; (p=fopen(prefs,&quot;r&quot;))!=NULL ) {</span>
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :         while ( fgets(line,sizeof(line),p)!=NULL ) {</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :             if ( *line=='#' )</span>
<span class="lineNum">    1226 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :             pt = strchr(line,':');</span>
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 :             if ( pt==NULL )</span>
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :             for ( j=0; load_prefs_list[j]!=NULL; ++j ) {</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :                 for ( i=0; load_prefs_list[j][i].name!=NULL; ++i )</span>
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :                     if ( strncmp(line,load_prefs_list[j][i].name,pt-line)==0 )</span>
<span class="lineNum">    1233 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1234 </span><span class="lineNoCov">          0 :                 if ( load_prefs_list[j][i].name!=NULL )</span>
<span class="lineNum">    1235 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1236 </span>            :             }
<span class="lineNum">    1237 </span><span class="lineNoCov">          0 :             pl = NULL;</span>
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :             if ( load_prefs_list[j]!=NULL )</span>
<span class="lineNum">    1239 </span><span class="lineNoCov">          0 :                 pl = &amp;load_prefs_list[j][i];</span>
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 :             for ( ++pt; *pt=='\t'; ++pt );</span>
<span class="lineNum">    1241 </span><span class="lineNoCov">          0 :             if ( line[strlen(line)-1]=='\n' )</span>
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :                 line[strlen(line)-1] = '\0';</span>
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :             if ( line[strlen(line)-1]=='\r' )</span>
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :                 line[strlen(line)-1] = '\0';</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :             if ( pl==NULL ) {</span>
<span class="lineNum">    1246 </span><span class="lineNoCov">          0 :                 if ( strncmp(line,&quot;Recent:&quot;,strlen(&quot;Recent:&quot;))==0 &amp;&amp; ri&lt;RECENT_MAX )</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :                     RecentFiles[ri++] = copy(pt);</span>
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 :                 else if ( strncmp(line,&quot;MenuScript:&quot;,strlen(&quot;MenuScript:&quot;))==0 &amp;&amp; ms&lt;SCRIPT_MENU_MAX )</span>
<span class="lineNum">    1249 </span><span class="lineNoCov">          0 :                     script_filenames[ms++] = copy(pt);</span>
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :                 else if ( strncmp(line,&quot;MenuName:&quot;,strlen(&quot;MenuName:&quot;))==0 &amp;&amp; mn&lt;SCRIPT_MENU_MAX )</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :                     script_menu_names[mn++] = utf82u_copy(pt);</span>
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :                 else if ( strncmp(line,&quot;FontFilterName:&quot;,strlen(&quot;FontFilterName:&quot;))==0 ) {</span>
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :                     if ( fn&gt;=filt_max )</span>
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :                         user_font_filters = realloc(user_font_filters,((filt_max+=10)+1)*sizeof( struct openfilefilters));</span>
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 :                     user_font_filters[fn].filter = NULL;</span>
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :                     user_font_filters[fn++].name = copy(pt);</span>
<span class="lineNum">    1257 </span><span class="lineNoCov">          0 :                     user_font_filters[fn].name = NULL;</span>
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :                 } else if ( strncmp(line,&quot;FontFilter:&quot;,strlen(&quot;FontFilter:&quot;))==0 ) {</span>
<span class="lineNum">    1259 </span><span class="lineNoCov">          0 :                     if ( ff&lt;filt_max )</span>
<span class="lineNum">    1260 </span><span class="lineNoCov">          0 :                         user_font_filters[ff++].filter = copy(pt);</span>
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 :                 } else if ( strncmp(line,&quot;MacMapCnt:&quot;,strlen(&quot;MacSetCnt:&quot;))==0 ) {</span>
<span class="lineNum">    1262 </span><span class="lineNoCov">          0 :                     sscanf( pt, &quot;%d&quot;, &amp;msc );</span>
<span class="lineNum">    1263 </span><span class="lineNoCov">          0 :                     msp = 0;</span>
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag = calloc(msc+1,sizeof(struct macsettingname));</span>
<span class="lineNum">    1265 </span><span class="lineNoCov">          0 :                 } else if ( strncmp(line,&quot;MacMapping:&quot;,strlen(&quot;MacMapping:&quot;))==0 &amp;&amp; msp&lt;msc ) {</span>
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :                     ParseMacMapping(pt,&amp;user_macfeat_otftag[msp++]);</span>
<span class="lineNum">    1267 </span><span class="lineNoCov">          0 :                 } else if ( strncmp(line,&quot;MacFeat:&quot;,strlen(&quot;MacFeat:&quot;))==0 ) {</span>
<span class="lineNum">    1268 </span><span class="lineNoCov">          0 :                     ParseNewMacFeature(p,line);</span>
<span class="lineNum">    1269 </span>            :                 }
<span class="lineNum">    1270 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    1271 </span>            :             }
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 :             switch ( pl-&gt;type ) {</span>
<span class="lineNum">    1273 </span>            :               case pr_encoding:
<span class="lineNum">    1274 </span><span class="lineNoCov">          0 :                 { Encoding *enc = FindOrMakeEncoding(pt);</span>
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :                     if ( enc==NULL )</span>
<span class="lineNum">    1276 </span><span class="lineNoCov">          0 :                         enc = FindOrMakeEncoding(&quot;ISO8859-1&quot;);</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">          0 :                     if ( enc==NULL )</span>
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 :                         enc = &amp;custom;</span>
<span class="lineNum">    1279 </span><span class="lineNoCov">          0 :                     *((Encoding **) (pl-&gt;val)) = enc;</span>
<span class="lineNum">    1280 </span>            :                 }
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1282 </span>            :               case pr_namelist:
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 :                 { NameList *nl = NameListByName(pt);</span>
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :                     if ( strcmp(pt,&quot;NULL&quot;)==0 &amp;&amp; pl-&gt;val != &amp;namelist_for_new_fonts )</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :                         *((NameList **) (pl-&gt;val)) = NULL;</span>
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :                     else if ( nl!=NULL )</span>
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :                         *((NameList **) (pl-&gt;val)) = nl;</span>
<span class="lineNum">    1288 </span>            :                 }
<span class="lineNum">    1289 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1290 </span>            :               case pr_bool: case pr_int:
<span class="lineNum">    1291 </span><span class="lineNoCov">          0 :                 sscanf( pt, &quot;%d&quot;, (int *) pl-&gt;val );</span>
<span class="lineNum">    1292 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1293 </span>            :               case pr_unicode:
<span class="lineNum">    1294 </span><span class="lineNoCov">          0 :                 if ( sscanf( pt, &quot;U+%x&quot;, (int *) pl-&gt;val )!=1 )</span>
<span class="lineNum">    1295 </span><span class="lineNoCov">          0 :                     if ( sscanf( pt, &quot;u+%x&quot;, (int *) pl-&gt;val )!=1 )</span>
<span class="lineNum">    1296 </span><span class="lineNoCov">          0 :                         sscanf( pt, &quot;%x&quot;, (int *) pl-&gt;val );</span>
<span class="lineNum">    1297 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1298 </span>            :               case pr_real: case pr_angle:
<span class="lineNum">    1299 </span>            :                 { char *end;
<span class="lineNum">    1300 </span><span class="lineNoCov">          0 :                     *((float *) pl-&gt;val) = strtod(pt,&amp;end);</span>
<span class="lineNum">    1301 </span><span class="lineNoCov">          0 :                     if (( *end==',' || *end=='.' ) ) {</span>
<span class="lineNum">    1302 </span><span class="lineNoCov">          0 :                         *end = (*end=='.')?',':'.';</span>
<span class="lineNum">    1303 </span><span class="lineNoCov">          0 :                         *((float *) pl-&gt;val) = strtod(pt,NULL);</span>
<span class="lineNum">    1304 </span>            :                     }
<span class="lineNum">    1305 </span>            :                 }
<span class="lineNum">    1306 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;type == pr_angle )</span>
<span class="lineNum">    1307 </span><span class="lineNoCov">          0 :                     *(float *) pl-&gt;val /= RAD2DEG;</span>
<span class="lineNum">    1308 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1309 </span>            :               case pr_string: case pr_file:
<span class="lineNum">    1310 </span><span class="lineNoCov">          0 :                 if ( *pt=='\0' ) pt=NULL;</span>
<span class="lineNum">    1311 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;val!=NULL )</span>
<span class="lineNum">    1312 </span><span class="lineNoCov">          0 :                     *((char **) (pl-&gt;val)) = copy(pt);</span>
<span class="lineNum">    1313 </span>            :                 else
<span class="lineNum">    1314 </span><span class="lineNoCov">          0 :                     (pl-&gt;set)(copy(pt));</span>
<span class="lineNum">    1315 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1316 </span>            :             }
<span class="lineNum">    1317 </span>            :         }
<span class="lineNum">    1318 </span><span class="lineNoCov">          0 :         fclose(p);</span>
<span class="lineNum">    1319 </span>            :     }
<span class="lineNum">    1320 </span>            : 
<span class="lineNum">    1321 </span>            :     //
<span class="lineNum">    1322 </span>            :     // If the user has no theme set, then use the default
<span class="lineNum">    1323 </span>            :     //
<span class="lineNum">    1324 </span><span class="lineCov">          1 :     real_xdefs_filename = xdefs_filename;</span>
<span class="lineNum">    1325 </span><span class="lineCov">          1 :     if ( !real_xdefs_filename )</span>
<span class="lineNum">    1326 </span>            :     {
<span class="lineNum">    1327 </span><span class="lineCov">          1 :         fprintf(stderr,&quot;no xdefs_filename!\n&quot;);</span>
<span class="lineNum">    1328 </span><span class="lineCov">          1 :         if (!quiet) {</span>
<span class="lineNum">    1329 </span><span class="lineCov">          1 :             fprintf(stderr,&quot;TESTING: getPixmapDir:%s\n&quot;, getPixmapDir() );</span>
<span class="lineNum">    1330 </span><span class="lineCov">          1 :             fprintf(stderr,&quot;TESTING: getShareDir:%s\n&quot;, getShareDir() );</span>
<span class="lineNum">    1331 </span><span class="lineCov">          1 :             fprintf(stderr,&quot;TESTING: GResourceProgramDir:%s\n&quot;, GResourceProgramDir );</span>
<span class="lineNum">    1332 </span>            :         }
<span class="lineNum">    1333 </span><span class="lineCov">          1 :         snprintf(path, PATH_MAX, &quot;%s/%s&quot;, getPixmapDir(), &quot;resources&quot; );</span>
<span class="lineNum">    1334 </span><span class="lineCov">          1 :         if (!quiet)</span>
<span class="lineNum">    1335 </span><span class="lineCov">          1 :             fprintf(stderr,&quot;trying default theme:%s\n&quot;, path );</span>
<span class="lineNum">    1336 </span><span class="lineCov">          1 :         real_xdefs_filename = path;</span>
<span class="lineNum">    1337 </span>            :     }
<span class="lineNum">    1338 </span><span class="lineCov">          1 :     GResourceAddResourceFile(real_xdefs_filename,GResourceProgramName,true);</span>
<span class="lineNum">    1339 </span>            : 
<span class="lineNum">    1340 </span><span class="lineCov">          1 :     if ( othersubrsfile!=NULL &amp;&amp; ReadOtherSubrsFile(othersubrsfile)&lt;=0 )</span>
<span class="lineNum">    1341 </span><span class="lineNoCov">          0 :         fprintf( stderr, &quot;Failed to read OtherSubrs from %s\n&quot;, othersubrsfile );</span>
<span class="lineNum">    1342 </span>            : 
<span class="lineNum">    1343 </span><span class="lineCov">          1 :     if ( glyph_2_name_map )</span>
<span class="lineNum">    1344 </span><span class="lineNoCov">          0 :         old_sfnt_flags |= ttf_flag_glyphmap;</span>
<span class="lineNum">    1345 </span><span class="lineCov">          1 :     LoadNamelistDir(NULL);</span>
<span class="lineNum">    1346 </span><span class="lineCov">          1 :     ProcessFileChooserPrefs();</span>
<span class="lineNum">    1347 </span><span class="lineCov">          1 :     GDrawEnableCairo( prefs_usecairo );</span>
<a name="1348"><span class="lineNum">    1348 </span><span class="lineCov">          1 : }</span></a>
<span class="lineNum">    1349 </span>            : 
<span class="lineNum">    1350 </span><span class="lineCov">         35 : static void PrefsUI_SavePrefs(int not_if_script) {</span>
<span class="lineNum">    1351 </span><span class="lineCov">         35 :     char *prefs = getPfaEditPrefs();</span>
<span class="lineNum">    1352 </span>            :     FILE *p;
<span class="lineNum">    1353 </span>            :     int i, j;
<span class="lineNum">    1354 </span>            :     char *temp;
<span class="lineNum">    1355 </span>            :     struct prefs_list *pl;
<span class="lineNum">    1356 </span>            :     extern int running_script;
<span class="lineNum">    1357 </span>            : 
<span class="lineNum">    1358 </span><span class="lineCov">         35 :     if ( prefs==NULL )</span>
<span class="lineNum">    1359 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1360 </span><span class="lineCov">         35 :     if ( not_if_script &amp;&amp; running_script )</span>
<span class="lineNum">    1361 </span><span class="lineCov">         35 : return;</span>
<span class="lineNum">    1362 </span>            : 
<span class="lineNum">    1363 </span><span class="lineNoCov">          0 :     if ( (p=fopen(prefs,&quot;w&quot;))==NULL )</span>
<span class="lineNum">    1364 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1365 </span>            : 
<span class="lineNum">    1366 </span><span class="lineNoCov">          0 :     GetFileChooserPrefs();</span>
<span class="lineNum">    1367 </span>            : 
<span class="lineNum">    1368 </span><span class="lineNoCov">          0 :     for ( j=0; prefs_list[j]!=NULL; ++j ) for ( i=0; prefs_list[j][i].name!=NULL; ++i ) {</span>
<span class="lineNum">    1369 </span><span class="lineNoCov">          0 :         pl = &amp;prefs_list[j][i];</span>
<span class="lineNum">    1370 </span><span class="lineNoCov">          0 :         switch ( pl-&gt;type ) {</span>
<span class="lineNum">    1371 </span>            :           case pr_encoding:
<span class="lineNum">    1372 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;%s:\t%s\n&quot;, pl-&gt;name, (*((Encoding **) (pl-&gt;val)))-&gt;enc_name );</span>
<span class="lineNum">    1373 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1374 </span>            :           case pr_namelist:
<span class="lineNum">    1375 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;%s:\t%s\n&quot;, pl-&gt;name, *((NameList **) (pl-&gt;val))==NULL ? &quot;NULL&quot; :</span>
<span class="lineNum">    1376 </span><span class="lineNoCov">          0 :                     (*((NameList **) (pl-&gt;val)))-&gt;title );</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1378 </span>            :           case pr_bool: case pr_int:
<span class="lineNum">    1379 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;%s:\t%d\n&quot;, pl-&gt;name, *(int *) (pl-&gt;val) );</span>
<span class="lineNum">    1380 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1381 </span>            :           case pr_unicode:
<span class="lineNum">    1382 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;%s:\tU+%04x\n&quot;, pl-&gt;name, *(int *) (pl-&gt;val) );</span>
<span class="lineNum">    1383 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1384 </span>            :           case pr_real:
<span class="lineNum">    1385 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;%s:\t%g\n&quot;, pl-&gt;name, (double) *(float *) (pl-&gt;val) );</span>
<span class="lineNum">    1386 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1387 </span>            :           case pr_string: case pr_file:
<span class="lineNum">    1388 </span><span class="lineNoCov">          0 :             if ( (pl-&gt;val)!=NULL )</span>
<span class="lineNum">    1389 </span><span class="lineNoCov">          0 :                 temp = *(char **) (pl-&gt;val);</span>
<span class="lineNum">    1390 </span>            :             else
<span class="lineNum">    1391 </span><span class="lineNoCov">          0 :                 temp = (char *) (pl-&gt;get());</span>
<span class="lineNum">    1392 </span><span class="lineNoCov">          0 :             if ( temp!=NULL )</span>
<span class="lineNum">    1393 </span><span class="lineNoCov">          0 :                 fprintf( p, &quot;%s:\t%s\n&quot;, pl-&gt;name, temp );</span>
<span class="lineNum">    1394 </span><span class="lineNoCov">          0 :             if ( (pl-&gt;val)==NULL )</span>
<span class="lineNum">    1395 </span><span class="lineNoCov">          0 :                 free(temp);</span>
<span class="lineNum">    1396 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1397 </span>            :           case pr_angle:
<span class="lineNum">    1398 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;%s:\t%g\n&quot;, pl-&gt;name, ((double) *(float *) pl-&gt;val) * RAD2DEG );</span>
<span class="lineNum">    1399 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1400 </span>            :         }
<span class="lineNum">    1401 </span>            :     }
<span class="lineNum">    1402 </span>            : 
<span class="lineNum">    1403 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;RECENT_MAX &amp;&amp; RecentFiles[i]!=NULL; ++i )</span>
<span class="lineNum">    1404 </span><span class="lineNoCov">          0 :         fprintf( p, &quot;Recent:\t%s\n&quot;, RecentFiles[i]);</span>
<span class="lineNum">    1405 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;SCRIPT_MENU_MAX &amp;&amp; script_filenames[i]!=NULL; ++i ) {</span>
<span class="lineNum">    1406 </span><span class="lineNoCov">          0 :         fprintf( p, &quot;MenuScript:\t%s\n&quot;, script_filenames[i]);</span>
<span class="lineNum">    1407 </span><span class="lineNoCov">          0 :         fprintf( p, &quot;MenuName:\t%s\n&quot;, temp = u2utf8_copy(script_menu_names[i]));</span>
<span class="lineNum">    1408 </span><span class="lineNoCov">          0 :         free(temp);</span>
<span class="lineNum">    1409 </span>            :     }
<span class="lineNum">    1410 </span><span class="lineNoCov">          0 :     if ( user_font_filters!=NULL ) {</span>
<span class="lineNum">    1411 </span><span class="lineNoCov">          0 :         for ( i=0; user_font_filters[i].name!=NULL; ++i ) {</span>
<span class="lineNum">    1412 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;FontFilterName:\t%s\n&quot;, user_font_filters[i].name);</span>
<span class="lineNum">    1413 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;FontFilter:\t%s\n&quot;, user_font_filters[i].filter);</span>
<span class="lineNum">    1414 </span>            :         }
<span class="lineNum">    1415 </span>            :     }
<span class="lineNum">    1416 </span><span class="lineNoCov">          0 :     if ( user_macfeat_otftag!=NULL &amp;&amp; UserSettingsDiffer()) {</span>
<span class="lineNum">    1417 </span><span class="lineNoCov">          0 :         for ( i=0; user_macfeat_otftag[i].otf_tag!=0; ++i );</span>
<span class="lineNum">    1418 </span><span class="lineNoCov">          0 :         fprintf( p, &quot;MacMapCnt: %d\n&quot;, i );</span>
<span class="lineNum">    1419 </span><span class="lineNoCov">          0 :         for ( i=0; user_macfeat_otftag[i].otf_tag!=0; ++i ) {</span>
<span class="lineNum">    1420 </span><span class="lineNoCov">          0 :             fprintf( p, &quot;MacMapping: %d,%d %c%c%c%c\n&quot;,</span>
<span class="lineNum">    1421 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag[i].mac_feature_type,</span>
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 :                     user_macfeat_otftag[i].mac_feature_setting,</span>
<span class="lineNum">    1423 </span><span class="lineNoCov">          0 :                         (int) (user_macfeat_otftag[i].otf_tag&gt;&gt;24),</span>
<span class="lineNum">    1424 </span><span class="lineNoCov">          0 :                         (int) ((user_macfeat_otftag[i].otf_tag&gt;&gt;16)&amp;0xff),</span>
<span class="lineNum">    1425 </span><span class="lineNoCov">          0 :                         (int) ((user_macfeat_otftag[i].otf_tag&gt;&gt;8)&amp;0xff),</span>
<span class="lineNum">    1426 </span><span class="lineNoCov">          0 :                         (int) (user_macfeat_otftag[i].otf_tag&amp;0xff) );</span>
<span class="lineNum">    1427 </span>            :         }
<span class="lineNum">    1428 </span>            :     }
<span class="lineNum">    1429 </span>            : 
<span class="lineNum">    1430 </span><span class="lineNoCov">          0 :     if ( UserFeaturesDiffer())</span>
<span class="lineNum">    1431 </span><span class="lineNoCov">          0 :         SFDDumpMacFeat(p,default_mac_feature_map);</span>
<span class="lineNum">    1432 </span>            : 
<span class="lineNum">    1433 </span><span class="lineNoCov">          0 :     fclose(p);</span>
<span class="lineNum">    1434 </span>            : }
<span class="lineNum">    1435 </span>            : 
<span class="lineNum">    1436 </span>            : struct pref_data {
<span class="lineNum">    1437 </span>            :     int done;
<span class="lineNum">    1438 </span>            :     struct prefs_list* plist;
<a name="1439"><span class="lineNum">    1439 </span>            : };</a>
<span class="lineNum">    1440 </span>            : 
<span class="lineNum">    1441 </span><span class="lineNoCov">          0 : static int Prefs_ScriptBrowse(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1442 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1443 </span><span class="lineNoCov">          0 :         GWindow gw = GGadgetGetWindow(g);</span>
<span class="lineNum">    1444 </span><span class="lineNoCov">          0 :         GGadget *tf = GWidgetGetControl(gw,GGadgetGetCid(g)-SCRIPT_MENU_MAX);</span>
<span class="lineNum">    1445 </span><span class="lineNoCov">          0 :         char *cur = GGadgetGetTitle8(tf); char *ret;</span>
<span class="lineNum">    1446 </span>            : 
<span class="lineNum">    1447 </span><span class="lineNoCov">          0 :         if ( *cur=='\0' ) cur=NULL;</span>
<span class="lineNum">    1448 </span><span class="lineNoCov">          0 :         ret = gwwv_open_filename(_(&quot;Call Script&quot;), cur, &quot;*.pe&quot;, NULL);</span>
<span class="lineNum">    1449 </span><span class="lineNoCov">          0 :         free(cur);</span>
<span class="lineNum">    1450 </span><span class="lineNoCov">          0 :         if ( ret==NULL )</span>
<span class="lineNum">    1451 </span><span class="lineNoCov">          0 : return(true);</span>
<span class="lineNum">    1452 </span><span class="lineNoCov">          0 :         GGadgetSetTitle8(tf,ret);</span>
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :         free(ret);</span>
<span class="lineNum">    1454 </span>            :     }
<span class="lineNum">    1455 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1456"><span class="lineNum">    1456 </span>            : }</a>
<span class="lineNum">    1457 </span>            : 
<span class="lineNum">    1458 </span><span class="lineNoCov">          0 : static int Prefs_BrowseFile(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1459 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1460 </span><span class="lineNoCov">          0 :         GWindow gw = GGadgetGetWindow(g);</span>
<span class="lineNum">    1461 </span><span class="lineNoCov">          0 :         GGadget *tf = GWidgetGetControl(gw,GGadgetGetCid(g)-CID_PrefsBrowseOffset);</span>
<span class="lineNum">    1462 </span><span class="lineNoCov">          0 :         char *cur = GGadgetGetTitle8(tf); char *ret;</span>
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 :         struct prefs_list *pl = GGadgetGetUserData(tf);</span>
<span class="lineNum">    1464 </span>            : 
<span class="lineNum">    1465 </span><span class="lineNoCov">          0 :         ret = gwwv_open_filename(pl-&gt;name, *cur=='\0'? NULL : cur, NULL, NULL);</span>
<span class="lineNum">    1466 </span><span class="lineNoCov">          0 :         free(cur);</span>
<span class="lineNum">    1467 </span><span class="lineNoCov">          0 :         if ( ret==NULL )</span>
<span class="lineNum">    1468 </span><span class="lineNoCov">          0 : return(true);</span>
<span class="lineNum">    1469 </span><span class="lineNoCov">          0 :         GGadgetSetTitle8(tf,ret);</span>
<span class="lineNum">    1470 </span><span class="lineNoCov">          0 :         free(ret);</span>
<span class="lineNum">    1471 </span>            :     }
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1473"><span class="lineNum">    1473 </span>            : }</a>
<span class="lineNum">    1474 </span>            : 
<span class="lineNum">    1475 </span><span class="lineNoCov">          0 : static GTextInfo *Pref_MappingList(int use_user) {</span>
<span class="lineNum">    1476 </span><span class="lineNoCov">          0 :     struct macsettingname *msn = use_user &amp;&amp; user_macfeat_otftag!=NULL ?</span>
<span class="lineNum">    1477 </span><span class="lineNoCov">          0 :             user_macfeat_otftag :</span>
<span class="lineNum">    1478 </span>            :             macfeat_otftag;
<span class="lineNum">    1479 </span>            :     GTextInfo *ti;
<span class="lineNum">    1480 </span>            :     int i;
<span class="lineNum">    1481 </span>            :     char buf[60];
<span class="lineNum">    1482 </span>            : 
<span class="lineNum">    1483 </span><span class="lineNoCov">          0 :     for ( i=0; msn[i].otf_tag!=0; ++i );</span>
<span class="lineNum">    1484 </span><span class="lineNoCov">          0 :     ti = calloc(i+1,sizeof( GTextInfo ));</span>
<span class="lineNum">    1485 </span>            : 
<span class="lineNum">    1486 </span><span class="lineNoCov">          0 :     for ( i=0; msn[i].otf_tag!=0; ++i ) {</span>
<span class="lineNum">    1487 </span><span class="lineNoCov">          0 :         sprintf(buf,&quot;%3d,%2d %c%c%c%c&quot;,</span>
<span class="lineNum">    1488 </span><span class="lineNoCov">          0 :             msn[i].mac_feature_type, msn[i].mac_feature_setting,</span>
<span class="lineNum">    1489 </span><span class="lineNoCov">          0 :             (int) (msn[i].otf_tag&gt;&gt;24), (int) ((msn[i].otf_tag&gt;&gt;16)&amp;0xff), (int) ((msn[i].otf_tag&gt;&gt;8)&amp;0xff), (int) (msn[i].otf_tag&amp;0xff) );</span>
<span class="lineNum">    1490 </span><span class="lineNoCov">          0 :         ti[i].text = uc_copy(buf);</span>
<span class="lineNum">    1491 </span>            :     }
<span class="lineNum">    1492 </span><span class="lineNoCov">          0 : return( ti );</span>
<a name="1493"><span class="lineNum">    1493 </span>            : }</a>
<span class="lineNum">    1494 </span>            : 
<span class="lineNum">    1495 </span><span class="lineNoCov">          0 : void GListAddStr(GGadget *list,unichar_t *str, void *ud) {</span>
<span class="lineNum">    1496 </span>            :     int32 i,len;
<span class="lineNum">    1497 </span><span class="lineNoCov">          0 :     GTextInfo **ti = GGadgetGetList(list,&amp;len);</span>
<span class="lineNum">    1498 </span><span class="lineNoCov">          0 :     GTextInfo **replace = malloc((len+2)*sizeof(GTextInfo *));</span>
<span class="lineNum">    1499 </span>            : 
<span class="lineNum">    1500 </span><span class="lineNoCov">          0 :     replace[len+1] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">    1501 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;len; ++i ) {</span>
<span class="lineNum">    1502 </span><span class="lineNoCov">          0 :         replace[i] = malloc(sizeof(GTextInfo));</span>
<span class="lineNum">    1503 </span><span class="lineNoCov">          0 :         *replace[i] = *ti[i];</span>
<span class="lineNum">    1504 </span><span class="lineNoCov">          0 :         replace[i]-&gt;text = u_copy(ti[i]-&gt;text);</span>
<span class="lineNum">    1505 </span>            :     }
<span class="lineNum">    1506 </span><span class="lineNoCov">          0 :     replace[i] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">    1507 </span><span class="lineNoCov">          0 :     replace[i]-&gt;fg = replace[i]-&gt;bg = COLOR_DEFAULT;</span>
<span class="lineNum">    1508 </span><span class="lineNoCov">          0 :     replace[i]-&gt;text = str;</span>
<span class="lineNum">    1509 </span><span class="lineNoCov">          0 :     replace[i]-&gt;userdata = ud;</span>
<span class="lineNum">    1510 </span><span class="lineNoCov">          0 :     GGadgetSetList(list,replace,false);</span>
<a name="1511"><span class="lineNum">    1511 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1512 </span>            : 
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 : void GListReplaceStr(GGadget *list,int index, unichar_t *str, void *ud) {</span>
<span class="lineNum">    1514 </span>            :     int32 i,len;
<span class="lineNum">    1515 </span><span class="lineNoCov">          0 :     GTextInfo **ti = GGadgetGetList(list,&amp;len);</span>
<span class="lineNum">    1516 </span><span class="lineNoCov">          0 :     GTextInfo **replace = malloc((len+2)*sizeof(GTextInfo *));</span>
<span class="lineNum">    1517 </span>            : 
<span class="lineNum">    1518 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;len; ++i ) {</span>
<span class="lineNum">    1519 </span><span class="lineNoCov">          0 :         replace[i] = malloc(sizeof(GTextInfo));</span>
<span class="lineNum">    1520 </span><span class="lineNoCov">          0 :         *replace[i] = *ti[i];</span>
<span class="lineNum">    1521 </span><span class="lineNoCov">          0 :         if ( i!=index )</span>
<span class="lineNum">    1522 </span><span class="lineNoCov">          0 :             replace[i]-&gt;text = u_copy(ti[i]-&gt;text);</span>
<span class="lineNum">    1523 </span>            :     }
<span class="lineNum">    1524 </span><span class="lineNoCov">          0 :     replace[i] = calloc(1,sizeof(GTextInfo));</span>
<span class="lineNum">    1525 </span><span class="lineNoCov">          0 :     replace[index]-&gt;text = str;</span>
<span class="lineNum">    1526 </span><span class="lineNoCov">          0 :     replace[index]-&gt;userdata = ud;</span>
<span class="lineNum">    1527 </span><span class="lineNoCov">          0 :     GGadgetSetList(list,replace,false);</span>
<span class="lineNum">    1528 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1529 </span>            : 
<span class="lineNum">    1530 </span>            : struct setdata {
<span class="lineNum">    1531 </span>            :     GWindow gw;
<span class="lineNum">    1532 </span>            :     GGadget *list;
<span class="lineNum">    1533 </span>            :     GGadget *flist;
<span class="lineNum">    1534 </span>            :     GGadget *feature;
<span class="lineNum">    1535 </span>            :     GGadget *set_code;
<span class="lineNum">    1536 </span>            :     GGadget *otf;
<span class="lineNum">    1537 </span>            :     GGadget *ok;
<span class="lineNum">    1538 </span>            :     GGadget *cancel;
<span class="lineNum">    1539 </span>            :     int index;
<span class="lineNum">    1540 </span>            :     int done;
<span class="lineNum">    1541 </span>            :     unichar_t *ret;
<a name="1542"><span class="lineNum">    1542 </span>            : };</a>
<span class="lineNum">    1543 </span>            : 
<span class="lineNum">    1544 </span><span class="lineNoCov">          0 : static int set_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    1545 </span><span class="lineNoCov">          0 :     struct setdata *sd = GDrawGetUserData(gw);</span>
<span class="lineNum">    1546 </span>            :     int i;
<span class="lineNum">    1547 </span>            :     int32 len;
<span class="lineNum">    1548 </span>            :     GTextInfo **ti;
<span class="lineNum">    1549 </span>            :     const unichar_t *ret1; unichar_t *end;
<span class="lineNum">    1550 </span>            :     int on, feat, val1, val2;
<span class="lineNum">    1551 </span>            :     unichar_t ubuf[4];
<span class="lineNum">    1552 </span>            :     char buf[40];
<span class="lineNum">    1553 </span>            : 
<span class="lineNum">    1554 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">    1555 </span><span class="lineNoCov">          0 :         sd-&gt;done = true;</span>
<span class="lineNum">    1556 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_char ) {</span>
<span class="lineNum">    1557 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.keysym == GK_F1 || event-&gt;u.chr.keysym == GK_Help ) {</span>
<span class="lineNum">    1558 </span><span class="lineNoCov">          0 :             help(&quot;prefs.html#Features&quot;);</span>
<span class="lineNum">    1559 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1560 </span>            :         }
<span class="lineNum">    1561 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    1562 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_controlevent &amp;&amp; event-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1563 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.control.g == sd-&gt;cancel ) {</span>
<span class="lineNum">    1564 </span><span class="lineNoCov">          0 :             sd-&gt;done = true;</span>
<span class="lineNum">    1565 </span><span class="lineNoCov">          0 :         } else if ( event-&gt;u.control.g == sd-&gt;ok ) {</span>
<span class="lineNum">    1566 </span><span class="lineNoCov">          0 :             ret1 = _GGadgetGetTitle(sd-&gt;set_code);</span>
<span class="lineNum">    1567 </span><span class="lineNoCov">          0 :             on = u_strtol(ret1,&amp;end,10);</span>
<span class="lineNum">    1568 </span><span class="lineNoCov">          0 :             if ( *end!='\0' ) {</span>
<span class="lineNum">    1569 </span><span class="lineNoCov">          0 :                 ff_post_error(_(&quot;Bad Number&quot;),_(&quot;Bad Number&quot;));</span>
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1571 </span>            :             }
<span class="lineNum">    1572 </span><span class="lineNoCov">          0 :             ret1 = _GGadgetGetTitle(sd-&gt;feature);</span>
<span class="lineNum">    1573 </span><span class="lineNoCov">          0 :             feat = u_strtol(ret1,&amp;end,10);</span>
<span class="lineNum">    1574 </span><span class="lineNoCov">          0 :             if ( *end!='\0' &amp;&amp; *end!=' ' ) {</span>
<span class="lineNum">    1575 </span><span class="lineNoCov">          0 :                 ff_post_error(_(&quot;Bad Number&quot;),_(&quot;Bad Number&quot;));</span>
<span class="lineNum">    1576 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1577 </span>            :             }
<span class="lineNum">    1578 </span><span class="lineNoCov">          0 :             ti = GGadgetGetList(sd-&gt;list,&amp;len);</span>
<span class="lineNum">    1579 </span><span class="lineNoCov">          0 :             for ( i=0; i&lt;len; ++i ) if ( i!=sd-&gt;index ) {</span>
<span class="lineNum">    1580 </span><span class="lineNoCov">          0 :                 val1 = u_strtol(ti[i]-&gt;text,&amp;end,10);</span>
<span class="lineNum">    1581 </span><span class="lineNoCov">          0 :                 val2 = u_strtol(end+1,NULL,10);</span>
<span class="lineNum">    1582 </span><span class="lineNoCov">          0 :                 if ( val1==feat &amp;&amp; val2==on ) {</span>
<span class="lineNum">    1583 </span>            :                     static char *buts[3];
<span class="lineNum">    1584 </span><span class="lineNoCov">          0 :                     buts[0] = _(&quot;_Yes&quot;);</span>
<span class="lineNum">    1585 </span><span class="lineNoCov">          0 :                     buts[1] = _(&quot;_No&quot;);</span>
<span class="lineNum">    1586 </span><span class="lineNoCov">          0 :                     buts[2] = NULL;</span>
<span class="lineNum">    1587 </span><span class="lineNoCov">          0 :                     if ( gwwv_ask(_(&quot;This feature, setting combination is already used&quot;),(const char **) buts,0,1,</span>
<span class="lineNum">    1588 </span><span class="lineNoCov">          0 :                             _(&quot;This feature, setting combination is already used\nDo you really wish to reuse it?&quot;))==1 )</span>
<span class="lineNum">    1589 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1590 </span>            :                 }
<span class="lineNum">    1591 </span>            :             }
<span class="lineNum">    1592 </span>            : 
<span class="lineNum">    1593 </span><span class="lineNoCov">          0 :             ret1 = _GGadgetGetTitle(sd-&gt;otf);</span>
<span class="lineNum">    1594 </span><span class="lineNoCov">          0 :             if ( (ubuf[0] = ret1[0])==0 )</span>
<span class="lineNum">    1595 </span><span class="lineNoCov">          0 :                 ubuf[0] = ubuf[1] = ubuf[2] = ubuf[3] = ' ';</span>
<span class="lineNum">    1596 </span><span class="lineNoCov">          0 :             else if ( (ubuf[1] = ret1[1])==0 )</span>
<span class="lineNum">    1597 </span><span class="lineNoCov">          0 :                 ubuf[1] = ubuf[2] = ubuf[3] = ' ';</span>
<span class="lineNum">    1598 </span><span class="lineNoCov">          0 :             else if ( (ubuf[2] = ret1[2])==0 )</span>
<span class="lineNum">    1599 </span><span class="lineNoCov">          0 :                 ubuf[2] = ubuf[3] = ' ';</span>
<span class="lineNum">    1600 </span><span class="lineNoCov">          0 :             else if ( (ubuf[3] = ret1[3])==0 )</span>
<span class="lineNum">    1601 </span><span class="lineNoCov">          0 :                 ubuf[3] = ' ';</span>
<span class="lineNum">    1602 </span><span class="lineNoCov">          0 :             len = u_strlen(ret1);</span>
<span class="lineNum">    1603 </span><span class="lineNoCov">          0 :             if ( len&lt;2 || len&gt;4 || ubuf[0]&gt;=0x7f || ubuf[1]&gt;=0x7f || ubuf[2]&gt;=0x7f || ubuf[3]&gt;=0x7f ) {</span>
<span class="lineNum">    1604 </span><span class="lineNoCov">          0 :                 ff_post_error(_(&quot;Tag too long&quot;),_(&quot;Feature tags must be exactly 4 ASCII characters&quot;));</span>
<span class="lineNum">    1605 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1606 </span>            :             }
<span class="lineNum">    1607 </span><span class="lineNoCov">          0 :             sprintf(buf,&quot;%3d,%2d %c%c%c%c&quot;,</span>
<span class="lineNum">    1608 </span>            :                     feat, on,
<span class="lineNum">    1609 </span>            :                     ubuf[0], ubuf[1], ubuf[2], ubuf[3]);
<span class="lineNum">    1610 </span><span class="lineNoCov">          0 :             sd-&gt;done = true;</span>
<span class="lineNum">    1611 </span><span class="lineNoCov">          0 :             sd-&gt;ret = uc_copy(buf);</span>
<span class="lineNum">    1612 </span>            :         }
<span class="lineNum">    1613 </span>            :     }
<span class="lineNum">    1614 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1615"><span class="lineNum">    1615 </span>            : }</a>
<span class="lineNum">    1616 </span>            : 
<span class="lineNum">    1617 </span><span class="lineNoCov">          0 : static unichar_t *AskSetting(struct macsettingname *temp,GGadget *list, int index,GGadget *flist) {</span>
<span class="lineNum">    1618 </span>            :     GRect pos;
<span class="lineNum">    1619 </span>            :     GWindow gw;
<span class="lineNum">    1620 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    1621 </span>            :     GGadgetCreateData gcd[17];
<span class="lineNum">    1622 </span>            :     GTextInfo label[17];
<span class="lineNum">    1623 </span>            :     struct setdata sd;
<span class="lineNum">    1624 </span>            :     char buf[20];
<span class="lineNum">    1625 </span>            :     unichar_t ubuf3[6];
<span class="lineNum">    1626 </span>            :     int32 len, i;
<span class="lineNum">    1627 </span>            :     GTextInfo **ti;
<span class="lineNum">    1628 </span>            : 
<span class="lineNum">    1629 </span><span class="lineNoCov">          0 :     memset(&amp;sd,0,sizeof(sd));</span>
<span class="lineNum">    1630 </span><span class="lineNoCov">          0 :     sd.list = list;</span>
<span class="lineNum">    1631 </span><span class="lineNoCov">          0 :     sd.flist = flist;</span>
<span class="lineNum">    1632 </span><span class="lineNoCov">          0 :     sd.index = index;</span>
<span class="lineNum">    1633 </span>            : 
<span class="lineNum">    1634 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    1635 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_restrict|wam_isdlg;</span>
<span class="lineNum">    1636 </span><span class="lineNoCov">          0 :     wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">    1637 </span><span class="lineNoCov">          0 :     wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">    1638 </span><span class="lineNoCov">          0 :     wattrs.is_dlg = 1;</span>
<span class="lineNum">    1639 </span><span class="lineNoCov">          0 :     wattrs.undercursor = 1;</span>
<span class="lineNum">    1640 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_pointer;</span>
<span class="lineNum">    1641 </span><span class="lineNoCov">          0 :     wattrs.utf8_window_title = _(&quot;Mapping&quot;);</span>
<span class="lineNum">    1642 </span><span class="lineNoCov">          0 :     pos.x = pos.y = 0;</span>
<span class="lineNum">    1643 </span><span class="lineNoCov">          0 :     pos.width = GGadgetScale(GDrawPointsToPixels(NULL,240));</span>
<span class="lineNum">    1644 </span><span class="lineNoCov">          0 :     pos.height = GDrawPointsToPixels(NULL,120);</span>
<span class="lineNum">    1645 </span><span class="lineNoCov">          0 :     gw = GDrawCreateTopWindow(NULL,&amp;pos,set_e_h,&amp;sd,&amp;wattrs);</span>
<span class="lineNum">    1646 </span><span class="lineNoCov">          0 :     sd.gw = gw;</span>
<span class="lineNum">    1647 </span>            : 
<span class="lineNum">    1648 </span><span class="lineNoCov">          0 :     memset(gcd,0,sizeof(gcd));</span>
<span class="lineNum">    1649 </span><span class="lineNoCov">          0 :     memset(label,0,sizeof(label));</span>
<span class="lineNum">    1650 </span>            : 
<span class="lineNum">    1651 </span><span class="lineNoCov">          0 :     label[0].text = (unichar_t *) _(&quot;_Feature:&quot;);</span>
<span class="lineNum">    1652 </span><span class="lineNoCov">          0 :     label[0].text_is_1byte = true;</span>
<span class="lineNum">    1653 </span><span class="lineNoCov">          0 :     label[0].text_in_resource = true;</span>
<span class="lineNum">    1654 </span><span class="lineNoCov">          0 :     gcd[0].gd.label = &amp;label[0];</span>
<span class="lineNum">    1655 </span><span class="lineNoCov">          0 :     gcd[0].gd.pos.x = 5; gcd[0].gd.pos.y = 5+4;</span>
<span class="lineNum">    1656 </span><span class="lineNoCov">          0 :     gcd[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1657 </span><span class="lineNoCov">          0 :     gcd[0].creator = GLabelCreate;</span>
<span class="lineNum">    1658 </span>            : 
<span class="lineNum">    1659 </span><span class="lineNoCov">          0 :     gcd[1].gd.pos.x = 50; gcd[1].gd.pos.y = 5; gcd[1].gd.pos.width = 170;</span>
<span class="lineNum">    1660 </span><span class="lineNoCov">          0 :     gcd[1].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1661 </span><span class="lineNoCov">          0 :     gcd[1].creator = GListButtonCreate;</span>
<span class="lineNum">    1662 </span>            : 
<span class="lineNum">    1663 </span><span class="lineNoCov">          0 :     label[2].text = (unichar_t *) _(&quot;Setting&quot;);</span>
<span class="lineNum">    1664 </span><span class="lineNoCov">          0 :     label[2].text_is_1byte = true;</span>
<span class="lineNum">    1665 </span><span class="lineNoCov">          0 :     gcd[2].gd.label = &amp;label[2];</span>
<span class="lineNum">    1666 </span><span class="lineNoCov">          0 :     gcd[2].gd.pos.x = 5; gcd[2].gd.pos.y = gcd[0].gd.pos.y+26;</span>
<span class="lineNum">    1667 </span><span class="lineNoCov">          0 :     gcd[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1668 </span><span class="lineNoCov">          0 :     gcd[2].creator = GLabelCreate;</span>
<span class="lineNum">    1669 </span>            : 
<span class="lineNum">    1670 </span><span class="lineNoCov">          0 :     sprintf( buf, &quot;%d&quot;, temp-&gt;mac_feature_setting );</span>
<span class="lineNum">    1671 </span><span class="lineNoCov">          0 :     label[3].text = (unichar_t *) buf;</span>
<span class="lineNum">    1672 </span><span class="lineNoCov">          0 :     label[3].text_is_1byte = true;</span>
<span class="lineNum">    1673 </span><span class="lineNoCov">          0 :     gcd[3].gd.label = &amp;label[3];</span>
<span class="lineNum">    1674 </span><span class="lineNoCov">          0 :     gcd[3].gd.pos.x = gcd[1].gd.pos.x; gcd[3].gd.pos.y = gcd[2].gd.pos.y-4; gcd[3].gd.pos.width = 50;</span>
<span class="lineNum">    1675 </span><span class="lineNoCov">          0 :     gcd[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1676 </span><span class="lineNoCov">          0 :     gcd[3].creator = GTextFieldCreate;</span>
<span class="lineNum">    1677 </span>            : 
<span class="lineNum">    1678 </span><span class="lineNoCov">          0 :     label[4].text = (unichar_t *) _(&quot;_Tag:&quot;);</span>
<span class="lineNum">    1679 </span><span class="lineNoCov">          0 :     label[4].text_is_1byte = true;</span>
<span class="lineNum">    1680 </span><span class="lineNoCov">          0 :     label[4].text_in_resource = true;</span>
<span class="lineNum">    1681 </span><span class="lineNoCov">          0 :     gcd[4].gd.label = &amp;label[4];</span>
<span class="lineNum">    1682 </span><span class="lineNoCov">          0 :     gcd[4].gd.pos.x = 5; gcd[4].gd.pos.y = gcd[3].gd.pos.y+26;</span>
<span class="lineNum">    1683 </span><span class="lineNoCov">          0 :     gcd[4].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1684 </span><span class="lineNoCov">          0 :     gcd[4].creator = GLabelCreate;</span>
<span class="lineNum">    1685 </span>            : 
<span class="lineNum">    1686 </span><span class="lineNoCov">          0 :     ubuf3[0] = temp-&gt;otf_tag&gt;&gt;24; ubuf3[1] = (temp-&gt;otf_tag&gt;&gt;16)&amp;0xff; ubuf3[2] = (temp-&gt;otf_tag&gt;&gt;8)&amp;0xff; ubuf3[3] = temp-&gt;otf_tag&amp;0xff; ubuf3[4] = 0;</span>
<span class="lineNum">    1687 </span><span class="lineNoCov">          0 :     label[5].text = ubuf3;</span>
<span class="lineNum">    1688 </span><span class="lineNoCov">          0 :     gcd[5].gd.label = &amp;label[5];</span>
<span class="lineNum">    1689 </span><span class="lineNoCov">          0 :     gcd[5].gd.pos.x = gcd[3].gd.pos.x; gcd[5].gd.pos.y = gcd[4].gd.pos.y-4; gcd[5].gd.pos.width = 50;</span>
<span class="lineNum">    1690 </span><span class="lineNoCov">          0 :     gcd[5].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    1691 </span>            :     /*gcd[5].gd.u.list = tags;*/
<span class="lineNum">    1692 </span><span class="lineNoCov">          0 :     gcd[5].creator = GTextFieldCreate;</span>
<span class="lineNum">    1693 </span>            : 
<span class="lineNum">    1694 </span><span class="lineNoCov">          0 :     gcd[6].gd.pos.x = 13-3; gcd[6].gd.pos.y = gcd[5].gd.pos.y+30;</span>
<span class="lineNum">    1695 </span><span class="lineNoCov">          0 :     gcd[6].gd.pos.width = -1; gcd[6].gd.pos.height = 0;</span>
<span class="lineNum">    1696 </span><span class="lineNoCov">          0 :     gcd[6].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">    1697 </span><span class="lineNoCov">          0 :     label[6].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">    1698 </span><span class="lineNoCov">          0 :     label[6].text_is_1byte = true;</span>
<span class="lineNum">    1699 </span><span class="lineNoCov">          0 :     label[6].text_in_resource = true;</span>
<span class="lineNum">    1700 </span><span class="lineNoCov">          0 :     gcd[6].gd.label = &amp;label[6];</span>
<span class="lineNum">    1701 </span>            :     /*gcd[6].gd.handle_controlevent = Prefs_Ok;*/
<span class="lineNum">    1702 </span><span class="lineNoCov">          0 :     gcd[6].creator = GButtonCreate;</span>
<span class="lineNum">    1703 </span>            : 
<span class="lineNum">    1704 </span><span class="lineNoCov">          0 :     gcd[7].gd.pos.x = -13; gcd[7].gd.pos.y = gcd[7-1].gd.pos.y+3;</span>
<span class="lineNum">    1705 </span><span class="lineNoCov">          0 :     gcd[7].gd.pos.width = -1; gcd[7].gd.pos.height = 0;</span>
<span class="lineNum">    1706 </span><span class="lineNoCov">          0 :     gcd[7].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">    1707 </span><span class="lineNoCov">          0 :     label[7].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    1708 </span><span class="lineNoCov">          0 :     label[7].text_is_1byte = true;</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">          0 :     label[7].text_in_resource = true;</span>
<span class="lineNum">    1710 </span><span class="lineNoCov">          0 :     gcd[7].gd.label = &amp;label[7];</span>
<span class="lineNum">    1711 </span><span class="lineNoCov">          0 :     gcd[7].creator = GButtonCreate;</span>
<span class="lineNum">    1712 </span>            : 
<span class="lineNum">    1713 </span><span class="lineNoCov">          0 :     GGadgetsCreate(gw,gcd);</span>
<span class="lineNum">    1714 </span><span class="lineNoCov">          0 :     sd.feature = gcd[1].ret;</span>
<span class="lineNum">    1715 </span><span class="lineNoCov">          0 :     sd.set_code = gcd[3].ret;</span>
<span class="lineNum">    1716 </span><span class="lineNoCov">          0 :     sd.otf = gcd[5].ret;</span>
<span class="lineNum">    1717 </span><span class="lineNoCov">          0 :     sd.ok = gcd[6].ret;</span>
<span class="lineNum">    1718 </span><span class="lineNoCov">          0 :     sd.cancel = gcd[7].ret;</span>
<span class="lineNum">    1719 </span>            : 
<span class="lineNum">    1720 </span><span class="lineNoCov">          0 :     ti = GGadgetGetList(flist,&amp;len);</span>
<span class="lineNum">    1721 </span><span class="lineNoCov">          0 :     GGadgetSetList(sd.feature,ti,true);</span>
<span class="lineNum">    1722 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;len; ++i ) {</span>
<span class="lineNum">    1723 </span><span class="lineNoCov">          0 :         int val = u_strtol(ti[i]-&gt;text,NULL,10);</span>
<span class="lineNum">    1724 </span><span class="lineNoCov">          0 :         if ( val==temp-&gt;mac_feature_type ) {</span>
<span class="lineNum">    1725 </span><span class="lineNoCov">          0 :             GGadgetSetTitle(sd.feature,ti[i]-&gt;text);</span>
<span class="lineNum">    1726 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    1727 </span>            :         }
<span class="lineNum">    1728 </span>            :     }
<span class="lineNum">    1729 </span>            : 
<span class="lineNum">    1730 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<span class="lineNum">    1731 </span><span class="lineNoCov">          0 :     GWidgetIndicateFocusGadget(gcd[1].ret);</span>
<span class="lineNum">    1732 </span><span class="lineNoCov">          0 :     while ( !sd.done )</span>
<span class="lineNum">    1733 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">    1734 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(gw);</span>
<span class="lineNum">    1735 </span>            : 
<span class="lineNum">    1736 </span><span class="lineNoCov">          0 : return( sd.ret );</span>
<a name="1737"><span class="lineNum">    1737 </span>            : }</a>
<span class="lineNum">    1738 </span>            : 
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 : static void ChangeSetting(GGadget *list,int index,GGadget *flist) {</span>
<span class="lineNum">    1740 </span>            :     struct macsettingname temp;
<span class="lineNum">    1741 </span>            :     int32 len;
<span class="lineNum">    1742 </span><span class="lineNoCov">          0 :     GTextInfo **ti = GGadgetGetList(list,&amp;len);</span>
<span class="lineNum">    1743 </span>            :     char *str;
<span class="lineNum">    1744 </span>            :     unichar_t *ustr;
<span class="lineNum">    1745 </span>            : 
<span class="lineNum">    1746 </span><span class="lineNoCov">          0 :     str = cu_copy(ti[index]-&gt;text);</span>
<span class="lineNum">    1747 </span><span class="lineNoCov">          0 :     ParseMacMapping(str,&amp;temp);</span>
<span class="lineNum">    1748 </span><span class="lineNoCov">          0 :     free(str);</span>
<span class="lineNum">    1749 </span><span class="lineNoCov">          0 :     if ( (ustr=AskSetting(&amp;temp,list,index,flist))==NULL )</span>
<span class="lineNum">    1750 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    1751 </span><span class="lineNoCov">          0 :     GListReplaceStr(list,index,ustr,NULL);</span>
<a name="1752"><span class="lineNum">    1752 </span>            : }</a>
<span class="lineNum">    1753 </span>            : 
<span class="lineNum">    1754 </span><span class="lineNoCov">          0 : static int Pref_NewMapping(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1755 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1756 </span><span class="lineNoCov">          0 :         GWindow gw = GGadgetGetWindow(g);</span>
<span class="lineNum">    1757 </span><span class="lineNoCov">          0 :         GGadget *list = GWidgetGetControl(gw,CID_Mapping);</span>
<span class="lineNum">    1758 </span><span class="lineNoCov">          0 :         GGadget *flist = GWidgetGetControl(GDrawGetParentWindow(gw),CID_Features);</span>
<span class="lineNum">    1759 </span>            :         struct macsettingname temp;
<span class="lineNum">    1760 </span>            :         unichar_t *str;
<span class="lineNum">    1761 </span>            : 
<span class="lineNum">    1762 </span><span class="lineNoCov">          0 :         memset(&amp;temp,0,sizeof(temp));</span>
<span class="lineNum">    1763 </span><span class="lineNoCov">          0 :         temp.mac_feature_type = -1;</span>
<span class="lineNum">    1764 </span><span class="lineNoCov">          0 :         if ( (str=AskSetting(&amp;temp,list,-1,flist))==NULL )</span>
<span class="lineNum">    1765 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1766 </span><span class="lineNoCov">          0 :         GListAddStr(list,str,NULL);</span>
<span class="lineNum">    1767 </span>            :         /*free(str);*/
<span class="lineNum">    1768 </span>            :     }
<span class="lineNum">    1769 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1770"><span class="lineNum">    1770 </span>            : }</a>
<span class="lineNum">    1771 </span>            : 
<span class="lineNum">    1772 </span><span class="lineNoCov">          0 : static int Pref_DelMapping(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1773 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1774 </span><span class="lineNoCov">          0 :         GWindow gw = GGadgetGetWindow(g);</span>
<span class="lineNum">    1775 </span><span class="lineNoCov">          0 :         GListDelSelected(GWidgetGetControl(gw,CID_Mapping));</span>
<span class="lineNum">    1776 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(gw,CID_MappingDel),false);</span>
<span class="lineNum">    1777 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(gw,CID_MappingEdit),false);</span>
<span class="lineNum">    1778 </span>            :     }
<span class="lineNum">    1779 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1780"><span class="lineNum">    1780 </span>            : }</a>
<span class="lineNum">    1781 </span>            : 
<span class="lineNum">    1782 </span><span class="lineNoCov">          0 : static int Pref_EditMapping(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1783 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1784 </span><span class="lineNoCov">          0 :         GWindow gw = GDrawGetParentWindow(GGadgetGetWindow(g));</span>
<span class="lineNum">    1785 </span><span class="lineNoCov">          0 :         GGadget *list = GWidgetGetControl(gw,CID_Mapping);</span>
<span class="lineNum">    1786 </span><span class="lineNoCov">          0 :         GGadget *flist = GWidgetGetControl(gw,CID_Features);</span>
<span class="lineNum">    1787 </span><span class="lineNoCov">          0 :         ChangeSetting(list,GGadgetGetFirstListSelectedItem(list),flist);</span>
<span class="lineNum">    1788 </span>            :     }
<span class="lineNum">    1789 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1790"><span class="lineNum">    1790 </span>            : }</a>
<span class="lineNum">    1791 </span>            : 
<span class="lineNum">    1792 </span><span class="lineNoCov">          0 : static int Pref_MappingSel(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1793 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_listselected ) {</span>
<span class="lineNum">    1794 </span>            :         int32 len;
<span class="lineNum">    1795 </span><span class="lineNoCov">          0 :         GTextInfo **ti = GGadgetGetList(g,&amp;len);</span>
<span class="lineNum">    1796 </span><span class="lineNoCov">          0 :         GWindow gw = GGadgetGetWindow(g);</span>
<span class="lineNum">    1797 </span><span class="lineNoCov">          0 :         int i, sel_cnt=0;</span>
<span class="lineNum">    1798 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;len; ++i )</span>
<span class="lineNum">    1799 </span><span class="lineNoCov">          0 :             if ( ti[i]-&gt;selected ) ++sel_cnt;</span>
<span class="lineNum">    1800 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(gw,CID_MappingDel),sel_cnt!=0);</span>
<span class="lineNum">    1801 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(gw,CID_MappingEdit),sel_cnt==1);</span>
<span class="lineNum">    1802 </span><span class="lineNoCov">          0 :     } else if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_listdoubleclick ) {</span>
<span class="lineNum">    1803 </span><span class="lineNoCov">          0 :         GGadget *flist = GWidgetGetControl( GDrawGetParentWindow(GGadgetGetWindow(g)),CID_Features);</span>
<span class="lineNum">    1804 </span><span class="lineNoCov">          0 :         ChangeSetting(g,e-&gt;u.control.u.list.changed_index!=-1?e-&gt;u.control.u.list.changed_index:</span>
<span class="lineNum">    1805 </span>            :                 GGadgetGetFirstListSelectedItem(g),flist);
<span class="lineNum">    1806 </span>            :     }
<span class="lineNum">    1807 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1808"><span class="lineNum">    1808 </span>            : }</a>
<span class="lineNum">    1809 </span>            : 
<span class="lineNum">    1810 </span><span class="lineNoCov">          0 : static int Pref_DefaultMapping(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1811 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1812 </span><span class="lineNoCov">          0 :         GGadget *list = GWidgetGetControl(GGadgetGetWindow(g),CID_Mapping);</span>
<span class="lineNum">    1813 </span>            :         GTextInfo *ti, **arr;
<span class="lineNum">    1814 </span>            :         uint16 cnt;
<span class="lineNum">    1815 </span>            : 
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 :         ti = Pref_MappingList(false);</span>
<span class="lineNum">    1817 </span><span class="lineNoCov">          0 :         arr = GTextInfoArrayFromList(ti,&amp;cnt);</span>
<span class="lineNum">    1818 </span><span class="lineNoCov">          0 :         GGadgetSetList(list,arr,false);</span>
<span class="lineNum">    1819 </span><span class="lineNoCov">          0 :         GTextInfoListFree(ti);</span>
<span class="lineNum">    1820 </span>            :     }
<span class="lineNum">    1821 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="1822"><span class="lineNum">    1822 </span>            : }</a>
<span class="lineNum">    1823 </span>            : 
<span class="lineNum">    1824 </span><span class="lineNoCov">          0 : static int Prefs_Ok(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    1825 </span>            :     int i, j, mi;
<span class="lineNum">    1826 </span><span class="lineNoCov">          0 :     int err=0, enc;</span>
<span class="lineNum">    1827 </span>            :     struct pref_data *p;
<span class="lineNum">    1828 </span>            :     GWindow gw;
<span class="lineNum">    1829 </span>            :     const unichar_t *ret;
<span class="lineNum">    1830 </span>            :     const unichar_t *names[SCRIPT_MENU_MAX], *scripts[SCRIPT_MENU_MAX];
<span class="lineNum">    1831 </span>            :     struct prefs_list *pl;
<span class="lineNum">    1832 </span>            :     GTextInfo **list;
<span class="lineNum">    1833 </span>            :     int32 len;
<span class="lineNum">    1834 </span>            :     int maxl, t;
<span class="lineNum">    1835 </span>            :     char *str;
<span class="lineNum">    1836 </span>            :     real dangle;
<span class="lineNum">    1837 </span>            : 
<span class="lineNum">    1838 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    1839 </span><span class="lineNoCov">          0 :         gw = GGadgetGetWindow(g);</span>
<span class="lineNum">    1840 </span><span class="lineNoCov">          0 :         p = GDrawGetUserData(gw);</span>
<span class="lineNum">    1841 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;SCRIPT_MENU_MAX; ++i ) {</span>
<span class="lineNum">    1842 </span><span class="lineNoCov">          0 :             names[i] = _GGadgetGetTitle(GWidgetGetControl(gw,CID_ScriptMNameBase+i));</span>
<span class="lineNum">    1843 </span><span class="lineNoCov">          0 :             scripts[i] = _GGadgetGetTitle(GWidgetGetControl(gw,CID_ScriptMFileBase+i));</span>
<span class="lineNum">    1844 </span><span class="lineNoCov">          0 :             if ( *names[i]=='\0' ) names[i] = NULL;</span>
<span class="lineNum">    1845 </span><span class="lineNoCov">          0 :             if ( *scripts[i]=='\0' ) scripts[i] = NULL;</span>
<span class="lineNum">    1846 </span><span class="lineNoCov">          0 :             if ( scripts[i]==NULL &amp;&amp; names[i]!=NULL ) {</span>
<span class="lineNum">    1847 </span><span class="lineNoCov">          0 :                 ff_post_error(_(&quot;Menu name with no associated script&quot;),_(&quot;Menu name with no associated script&quot;));</span>
<span class="lineNum">    1848 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1849 </span><span class="lineNoCov">          0 :             } else if ( scripts[i]!=NULL &amp;&amp; names[i]==NULL ) {</span>
<span class="lineNum">    1850 </span><span class="lineNoCov">          0 :                 ff_post_error(_(&quot;Script with no associated menu name&quot;),_(&quot;Script with no associated menu name&quot;));</span>
<span class="lineNum">    1851 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1852 </span>            :             }
<span class="lineNum">    1853 </span>            :         }
<span class="lineNum">    1854 </span><span class="lineNoCov">          0 :         for ( i=mi=0; i&lt;SCRIPT_MENU_MAX; ++i ) {</span>
<span class="lineNum">    1855 </span><span class="lineNoCov">          0 :             if ( names[i]!=NULL ) {</span>
<span class="lineNum">    1856 </span><span class="lineNoCov">          0 :                 names[mi] = names[i];</span>
<span class="lineNum">    1857 </span><span class="lineNoCov">          0 :                 scripts[mi] = scripts[i];</span>
<span class="lineNum">    1858 </span><span class="lineNoCov">          0 :                 ++mi;</span>
<span class="lineNum">    1859 </span>            :             }
<span class="lineNum">    1860 </span>            :         }
<span class="lineNum">    1861 </span><span class="lineNoCov">          0 :         for ( j=0; visible_prefs_list[j].tab_name!=0; ++j ) for ( i=0; visible_prefs_list[j].pl[i].name!=NULL; ++i ) {</span>
<span class="lineNum">    1862 </span><span class="lineNoCov">          0 :             pl = &amp;visible_prefs_list[j].pl[i];</span>
<span class="lineNum">    1863 </span>            :             /* before assigning values, check for any errors */
<span class="lineNum">    1864 </span>            :             /* if any errors, then NO values should be assigned, in case they cancel */
<span class="lineNum">    1865 </span><span class="lineNoCov">          0 :             if ( pl-&gt;dontdisplay )</span>
<span class="lineNum">    1866 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    1867 </span><span class="lineNoCov">          0 :             if ( pl-&gt;type==pr_int ) {</span>
<span class="lineNum">    1868 </span><span class="lineNoCov">          0 :                 GetInt8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err);</span>
<span class="lineNum">    1869 </span><span class="lineNoCov">          0 :             } else if ( pl-&gt;type==pr_real ) {</span>
<span class="lineNum">    1870 </span><span class="lineNoCov">          0 :                 GetReal8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err);</span>
<span class="lineNum">    1871 </span><span class="lineNoCov">          0 :             } else if ( pl-&gt;type==pr_angle ) {</span>
<span class="lineNum">    1872 </span><span class="lineNoCov">          0 :                 dangle = GetReal8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err);</span>
<span class="lineNum">    1873 </span><span class="lineNoCov">          0 :                 if ( dangle &gt; 90 || dangle &lt; 0 ) {</span>
<span class="lineNum">    1874 </span><span class="lineNoCov">          0 :                     GGadgetProtest8(pl-&gt;name);</span>
<span class="lineNum">    1875 </span><span class="lineNoCov">          0 :                     err = true;</span>
<span class="lineNum">    1876 </span>            :                 }
<span class="lineNum">    1877 </span><span class="lineNoCov">          0 :             } else if ( pl-&gt;type==pr_unicode ) {</span>
<span class="lineNum">    1878 </span><span class="lineNoCov">          0 :                 GetUnicodeChar8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err);</span>
<span class="lineNum">    1879 </span>            :             }
<span class="lineNum">    1880 </span>            :         }
<span class="lineNum">    1881 </span><span class="lineNoCov">          0 :         if ( err )</span>
<span class="lineNum">    1882 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    1883 </span>            : 
<span class="lineNum">    1884 </span><span class="lineNoCov">          0 :         for ( j=0; visible_prefs_list[j].tab_name!=0; ++j ) for ( i=0; visible_prefs_list[j].pl[i].name!=NULL; ++i ) {</span>
<span class="lineNum">    1885 </span><span class="lineNoCov">          0 :             pl = &amp;visible_prefs_list[j].pl[i];</span>
<span class="lineNum">    1886 </span><span class="lineNoCov">          0 :             if ( pl-&gt;dontdisplay )</span>
<span class="lineNum">    1887 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    1888 </span><span class="lineNoCov">          0 :             switch( pl-&gt;type ) {</span>
<span class="lineNum">    1889 </span>            :               case pr_int:
<span class="lineNum">    1890 </span><span class="lineNoCov">          0 :                 *((int *) (pl-&gt;val)) = GetInt8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err);</span>
<span class="lineNum">    1891 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1892 </span>            :               case pr_unicode:
<span class="lineNum">    1893 </span><span class="lineNoCov">          0 :                 *((int *) (pl-&gt;val)) = GetUnicodeChar8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err);</span>
<span class="lineNum">    1894 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1895 </span>            :               case pr_bool:
<span class="lineNum">    1896 </span><span class="lineNoCov">          0 :                 *((int *) (pl-&gt;val)) = GGadgetIsChecked(GWidgetGetControl(gw,j*CID_PrefsOffset+CID_PrefsBase+i));</span>
<span class="lineNum">    1897 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1898 </span>            :               case pr_real:
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :                 *((float *) (pl-&gt;val)) = GetReal8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err);</span>
<span class="lineNum">    1900 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1901 </span>            :               case pr_encoding:
<span class="lineNum">    1902 </span>            :                 { Encoding *e;
<span class="lineNum">    1903 </span><span class="lineNoCov">          0 :                     e = ParseEncodingNameFromList(GWidgetGetControl(gw,j*CID_PrefsOffset+CID_PrefsBase+i));</span>
<span class="lineNum">    1904 </span><span class="lineNoCov">          0 :                     if ( e!=NULL )</span>
<span class="lineNum">    1905 </span><span class="lineNoCov">          0 :                         *((Encoding **) (pl-&gt;val)) = e;</span>
<span class="lineNum">    1906 </span><span class="lineNoCov">          0 :                     enc = 1;    /* So gcc doesn't complain about unused. It is unused, but why add the ifdef and make the code even messier? Sigh. icc complains anyway */</span>
<span class="lineNum">    1907 </span>            :                 }
<span class="lineNum">    1908 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1909 </span>            :               case pr_namelist:
<span class="lineNum">    1910 </span>            :                 { NameList *nl;
<span class="lineNum">    1911 </span><span class="lineNoCov">          0 :                   GTextInfo *ti = GGadgetGetListItemSelected(GWidgetGetControl(gw,j*CID_PrefsOffset+CID_PrefsBase+i));</span>
<span class="lineNum">    1912 </span><span class="lineNoCov">          0 :                   if ( ti!=NULL ) {</span>
<span class="lineNum">    1913 </span><span class="lineNoCov">          0 :                         char *name = u2utf8_copy(ti-&gt;text);</span>
<span class="lineNum">    1914 </span><span class="lineNoCov">          0 :                         nl = NameListByName(name);</span>
<span class="lineNum">    1915 </span><span class="lineNoCov">          0 :                         free(name);</span>
<span class="lineNum">    1916 </span><span class="lineNoCov">          0 :                         if ( nl!=NULL &amp;&amp; nl-&gt;uses_unicode &amp;&amp; !allow_utf8_glyphnames)</span>
<span class="lineNum">    1917 </span><span class="lineNoCov">          0 :                             ff_post_error(_(&quot;Namelist contains non-ASCII names&quot;),_(&quot;Glyph names should be limited to characters in the ASCII character set, but there are names in this namelist which use characters outside that range.&quot;));</span>
<span class="lineNum">    1918 </span><span class="lineNoCov">          0 :                         else if ( nl!=NULL )</span>
<span class="lineNum">    1919 </span><span class="lineNoCov">          0 :                             *((NameList **) (pl-&gt;val)) = nl;</span>
<span class="lineNum">    1920 </span>            :                     }
<span class="lineNum">    1921 </span>            :                 }
<span class="lineNum">    1922 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1923 </span>            :               case pr_string: case pr_file:
<span class="lineNum">    1924 </span><span class="lineNoCov">          0 :                 ret = _GGadgetGetTitle(GWidgetGetControl(gw,j*CID_PrefsOffset+CID_PrefsBase+i));</span>
<span class="lineNum">    1925 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;val!=NULL ) {</span>
<span class="lineNum">    1926 </span><span class="lineNoCov">          0 :                     free( *((char **) (pl-&gt;val)) );</span>
<span class="lineNum">    1927 </span><span class="lineNoCov">          0 :                     *((char **) (pl-&gt;val)) = NULL;</span>
<span class="lineNum">    1928 </span><span class="lineNoCov">          0 :                     if ( ret!=NULL &amp;&amp; *ret!='\0' )</span>
<span class="lineNum">    1929 </span><span class="lineNoCov">          0 :                         *((char **) (pl-&gt;val)) = /* u2def_*/ cu_copy(ret);</span>
<span class="lineNum">    1930 </span>            :                 } else {
<span class="lineNum">    1931 </span><span class="lineNoCov">          0 :                     char *cret = cu_copy(ret);</span>
<span class="lineNum">    1932 </span><span class="lineNoCov">          0 :                     (pl-&gt;set)(cret);</span>
<span class="lineNum">    1933 </span><span class="lineNoCov">          0 :                     free(cret);</span>
<span class="lineNum">    1934 </span>            :                 }
<span class="lineNum">    1935 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1936 </span>            :               case pr_angle:
<span class="lineNum">    1937 </span><span class="lineNoCov">          0 :                 *((float *) (pl-&gt;val)) = GetReal8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err)/RAD2DEG;</span>
<span class="lineNum">    1938 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1939 </span>            :             }
<span class="lineNum">    1940 </span>            :         }
<span class="lineNum">    1941 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;SCRIPT_MENU_MAX; ++i ) {</span>
<span class="lineNum">    1942 </span><span class="lineNoCov">          0 :             free(script_menu_names[i]); script_menu_names[i] = NULL;</span>
<span class="lineNum">    1943 </span><span class="lineNoCov">          0 :             free(script_filenames[i]); script_filenames[i] = NULL;</span>
<span class="lineNum">    1944 </span>            :         }
<span class="lineNum">    1945 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;mi; ++i ) {</span>
<span class="lineNum">    1946 </span><span class="lineNoCov">          0 :             script_menu_names[i] = u_copy(names[i]);</span>
<span class="lineNum">    1947 </span><span class="lineNoCov">          0 :             script_filenames[i] = u2def_copy(scripts[i]);</span>
<span class="lineNum">    1948 </span>            :         }
<span class="lineNum">    1949 </span>            : 
<span class="lineNum">    1950 </span><span class="lineNoCov">          0 :         list = GGadgetGetList(GWidgetGetControl(gw,CID_Mapping),&amp;len);</span>
<span class="lineNum">    1951 </span><span class="lineNoCov">          0 :         UserSettingsFree();</span>
<span class="lineNum">    1952 </span><span class="lineNoCov">          0 :         user_macfeat_otftag = malloc((len+1)*sizeof(struct macsettingname));</span>
<span class="lineNum">    1953 </span><span class="lineNoCov">          0 :         user_macfeat_otftag[len].otf_tag = 0;</span>
<span class="lineNum">    1954 </span><span class="lineNoCov">          0 :         maxl = 0;</span>
<span class="lineNum">    1955 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;len; ++i ) {</span>
<span class="lineNum">    1956 </span><span class="lineNoCov">          0 :             t = u_strlen(list[i]-&gt;text);</span>
<span class="lineNum">    1957 </span><span class="lineNoCov">          0 :             if ( t&gt;maxl ) maxl = t;</span>
<span class="lineNum">    1958 </span>            :         }
<span class="lineNum">    1959 </span><span class="lineNoCov">          0 :         str = malloc(maxl+3);</span>
<span class="lineNum">    1960 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;len; ++i ) {</span>
<span class="lineNum">    1961 </span><span class="lineNoCov">          0 :             u2encoding_strncpy(str,list[i]-&gt;text,maxl+1,e_mac);</span>
<span class="lineNum">    1962 </span><span class="lineNoCov">          0 :             ParseMacMapping(str,&amp;user_macfeat_otftag[i]);</span>
<span class="lineNum">    1963 </span>            :         }
<span class="lineNum">    1964 </span><span class="lineNoCov">          0 :         free(str);</span>
<span class="lineNum">    1965 </span>            : 
<span class="lineNum">    1966 </span><span class="lineNoCov">          0 :         Prefs_ReplaceMacFeatures(GWidgetGetControl(gw,CID_Features));</span>
<span class="lineNum">    1967 </span>            : 
<span class="lineNum">    1968 </span><span class="lineNoCov">          0 :         if ( xuid!=NULL ) {</span>
<span class="lineNum">    1969 </span>            :             char *pt;
<span class="lineNum">    1970 </span><span class="lineNoCov">          0 :             for ( pt=xuid; *pt==' ' ; ++pt );</span>
<span class="lineNum">    1971 </span><span class="lineNoCov">          0 :             if ( *pt=='[' ) {   /* People who know PS well, might want to put brackets arround the xuid base array, but I don't want them */</span>
<span class="lineNum">    1972 </span><span class="lineNoCov">          0 :                 pt = copy(pt+1);</span>
<span class="lineNum">    1973 </span><span class="lineNoCov">          0 :                 if (xuid != NULL) free( xuid );</span>
<span class="lineNum">    1974 </span><span class="lineNoCov">          0 :                 xuid = pt;</span>
<span class="lineNum">    1975 </span>            :             }
<span class="lineNum">    1976 </span><span class="lineNoCov">          0 :             for ( pt=xuid+strlen(xuid)-1; pt&gt;xuid &amp;&amp; *pt==' '; --pt );</span>
<span class="lineNum">    1977 </span><span class="lineNoCov">          0 :             if ( pt &gt;= xuid &amp;&amp; *pt==']' ) *pt = '\0';</span>
<span class="lineNum">    1978 </span>            :         }
<span class="lineNum">    1979 </span>            : 
<span class="lineNum">    1980 </span><span class="lineNoCov">          0 :         p-&gt;done = true;</span>
<span class="lineNum">    1981 </span><span class="lineNoCov">          0 :         PrefsUI_SavePrefs(true);</span>
<span class="lineNum">    1982 </span><span class="lineNoCov">          0 :         if ( maxundoes==0 ) { FontView *fv;</span>
<span class="lineNum">    1983 </span><span class="lineNoCov">          0 :             for ( fv=fv_list ; fv!=NULL; fv=(FontView *) (fv-&gt;b.next) )</span>
<span class="lineNum">    1984 </span><span class="lineNoCov">          0 :                 SFRemoveUndoes(fv-&gt;b.sf,NULL,NULL);</span>
<span class="lineNum">    1985 </span>            :         }
<span class="lineNum">    1986 </span><span class="lineNoCov">          0 :         if ( othersubrsfile!=NULL &amp;&amp; ReadOtherSubrsFile(othersubrsfile)&lt;=0 )</span>
<span class="lineNum">    1987 </span><span class="lineNoCov">          0 :             fprintf( stderr, &quot;Failed to read OtherSubrs from %s\n&quot;, othersubrsfile );</span>
<span class="lineNum">    1988 </span><span class="lineNoCov">          0 :         GDrawEnableCairo(prefs_usecairo);</span>
<span class="lineNum">    1989 </span>            : 
<span class="lineNum">    1990 </span><span class="lineNoCov">          0 :         int force_redraw_charviews = 0;</span>
<span class="lineNum">    1991 </span><span class="lineNoCov">          0 :         if( prefs_oldval_cvEditHandleSize != prefs_cvEditHandleSize )</span>
<span class="lineNum">    1992 </span><span class="lineNoCov">          0 :             force_redraw_charviews = 1;</span>
<span class="lineNum">    1993 </span><span class="lineNoCov">          0 :         if( prefs_oldval_cvInactiveHandleAlpha != prefs_cvInactiveHandleAlpha )</span>
<span class="lineNum">    1994 </span><span class="lineNoCov">          0 :             force_redraw_charviews = 1;</span>
<span class="lineNum">    1995 </span>            : 
<span class="lineNum">    1996 </span>            : 
<span class="lineNum">    1997 </span><span class="lineNoCov">          0 :         if( force_redraw_charviews )</span>
<span class="lineNum">    1998 </span>            :         {
<span class="lineNum">    1999 </span>            :             FontView *fv;
<span class="lineNum">    2000 </span><span class="lineNoCov">          0 :             for ( fv=fv_list ; fv!=NULL; fv=(FontView *) (fv-&gt;b.next) )</span>
<span class="lineNum">    2001 </span>            :             {
<span class="lineNum">    2002 </span><span class="lineNoCov">          0 :                 FVRedrawAllCharViews( fv );</span>
<span class="lineNum">    2003 </span>            :             }
<span class="lineNum">    2004 </span>            :         }
<span class="lineNum">    2005 </span>            :     }
<span class="lineNum">    2006 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2007"><span class="lineNum">    2007 </span>            : }</a>
<span class="lineNum">    2008 </span>            : 
<span class="lineNum">    2009 </span><span class="lineNoCov">          0 : static int Prefs_Cancel(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2010 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    2011 </span><span class="lineNoCov">          0 :         struct pref_data *p = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2012 </span><span class="lineNoCov">          0 :         MacFeatListFree(GGadgetGetUserData((GWidgetGetControl(</span>
<span class="lineNum">    2013 </span>            :                 GGadgetGetWindow(g),CID_Features))));
<span class="lineNum">    2014 </span><span class="lineNoCov">          0 :         p-&gt;done = true;</span>
<span class="lineNum">    2015 </span>            :     }
<span class="lineNum">    2016 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2017"><span class="lineNum">    2017 </span>            : }</a>
<span class="lineNum">    2018 </span>            : 
<span class="lineNum">    2019 </span><span class="lineNoCov">          0 : static int e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    2020 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">    2021 </span><span class="lineNoCov">          0 :         struct pref_data *p = GDrawGetUserData(gw);</span>
<span class="lineNum">    2022 </span><span class="lineNoCov">          0 :         p-&gt;done = true;</span>
<span class="lineNum">    2023 </span><span class="lineNoCov">          0 :         if(GWidgetGetControl(gw,CID_Features)) {</span>
<span class="lineNum">    2024 </span><span class="lineNoCov">          0 :             MacFeatListFree(GGadgetGetUserData((GWidgetGetControl(gw,CID_Features))));</span>
<span class="lineNum">    2025 </span>            :         }
<span class="lineNum">    2026 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_char ) {</span>
<span class="lineNum">    2027 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.keysym == GK_F1 || event-&gt;u.chr.keysym == GK_Help ) {</span>
<span class="lineNum">    2028 </span><span class="lineNoCov">          0 :             help(&quot;prefs.html&quot;);</span>
<span class="lineNum">    2029 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    2030 </span>            :         }
<span class="lineNum">    2031 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    2032 </span>            :     }
<span class="lineNum">    2033 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2034"><span class="lineNum">    2034 </span>            : }</a>
<span class="lineNum">    2035 </span>            : 
<span class="lineNum">    2036 </span><span class="lineNoCov">          0 : static void PrefsInit(void) {</span>
<span class="lineNum">    2037 </span>            :     static int done = false;
<span class="lineNum">    2038 </span>            :     int i;
<span class="lineNum">    2039 </span>            : 
<span class="lineNum">    2040 </span><span class="lineNoCov">          0 :     if ( done )</span>
<span class="lineNum">    2041 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    2042 </span><span class="lineNoCov">          0 :     done = true;</span>
<span class="lineNum">    2043 </span><span class="lineNoCov">          0 :     for ( i=0; visible_prefs_list[i].tab_name!=NULL; ++i )</span>
<span class="lineNum">    2044 </span><span class="lineNoCov">          0 :         visible_prefs_list[i].tab_name = _(visible_prefs_list[i].tab_name);</span>
<a name="2045"><span class="lineNum">    2045 </span>            : }</a>
<span class="lineNum">    2046 </span>            : 
<span class="lineNum">    2047 </span><span class="lineNoCov">          0 : void DoPrefs(void) {</span>
<span class="lineNum">    2048 </span>            :     GRect pos;
<span class="lineNum">    2049 </span>            :     GWindow gw;
<span class="lineNum">    2050 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    2051 </span>            :     GGadgetCreateData *pgcd, gcd[5], sgcd[45], mgcd[3], mfgcd[9], msgcd[9];
<span class="lineNum">    2052 </span>            :     GGadgetCreateData mfboxes[3], *mfarray[14];
<span class="lineNum">    2053 </span>            :     GGadgetCreateData mpboxes[3], *mparray[14];
<span class="lineNum">    2054 </span>            :     GGadgetCreateData sboxes[2], *sarray[50];
<span class="lineNum">    2055 </span>            :     GGadgetCreateData mboxes[3], *varray[5], *harray[8];
<span class="lineNum">    2056 </span>            :     GTextInfo *plabel, **list, label[5], slabel[45], *plabels[TOPICS+5], mflabels[9], mslabels[9];
<span class="lineNum">    2057 </span>            :     GTabInfo aspects[TOPICS+5], subaspects[3];
<span class="lineNum">    2058 </span>            :     GGadgetCreateData **hvarray, boxes[2*TOPICS];
<span class="lineNum">    2059 </span>            :     struct pref_data p;
<span class="lineNum">    2060 </span>            :     int i, gc, sgc, j, k, line, line_max, y, y2, ii, si;
<span class="lineNum">    2061 </span>            :     int32 llen;
<span class="lineNum">    2062 </span>            :     char buf[20];
<span class="lineNum">    2063 </span>            :     int gcnt[20];
<span class="lineNum">    2064 </span>            :     static unichar_t nullstr[] = { 0 };
<span class="lineNum">    2065 </span>            :     struct prefs_list *pl;
<span class="lineNum">    2066 </span>            :     char *tempstr;
<span class="lineNum">    2067 </span>            :     FontRequest rq;
<span class="lineNum">    2068 </span>            :     GFont *font;
<span class="lineNum">    2069 </span>            : 
<span class="lineNum">    2070 </span><span class="lineNoCov">          0 :     PrefsInit();</span>
<span class="lineNum">    2071 </span>            : 
<span class="lineNum">    2072 </span><span class="lineNoCov">          0 :     MfArgsInit();</span>
<span class="lineNum">    2073 </span><span class="lineNoCov">          0 :     for ( k=line_max=0; visible_prefs_list[k].tab_name!=0; ++k ) {</span>
<span class="lineNum">    2074 </span><span class="lineNoCov">          0 :         for ( i=line=gcnt[k]=0; visible_prefs_list[k].pl[i].name!=NULL; ++i ) {</span>
<span class="lineNum">    2075 </span><span class="lineNoCov">          0 :             if ( visible_prefs_list[k].pl[i].dontdisplay )</span>
<span class="lineNum">    2076 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    2077 </span><span class="lineNoCov">          0 :             gcnt[k] += 2;</span>
<span class="lineNum">    2078 </span><span class="lineNoCov">          0 :             if ( visible_prefs_list[k].pl[i].type==pr_bool ) ++gcnt[k];</span>
<span class="lineNum">    2079 </span><span class="lineNoCov">          0 :             else if ( visible_prefs_list[k].pl[i].type==pr_file ) ++gcnt[k];</span>
<span class="lineNum">    2080 </span><span class="lineNoCov">          0 :             else if ( visible_prefs_list[k].pl[i].type==pr_angle ) ++gcnt[k];</span>
<span class="lineNum">    2081 </span><span class="lineNoCov">          0 :             ++line;</span>
<span class="lineNum">    2082 </span>            :         }
<span class="lineNum">    2083 </span><span class="lineNoCov">          0 :         if ( visible_prefs_list[k].pl == args_list ) {</span>
<span class="lineNum">    2084 </span><span class="lineNoCov">          0 :             gcnt[k] += 6;</span>
<span class="lineNum">    2085 </span><span class="lineNoCov">          0 :             line += 6;</span>
<span class="lineNum">    2086 </span>            :         }
<span class="lineNum">    2087 </span><span class="lineNoCov">          0 :         if ( line&gt;line_max ) line_max = line;</span>
<span class="lineNum">    2088 </span>            :     }
<span class="lineNum">    2089 </span>            : 
<span class="lineNum">    2090 </span><span class="lineNoCov">          0 :     prefs_oldval_cvEditHandleSize = prefs_cvEditHandleSize;</span>
<span class="lineNum">    2091 </span><span class="lineNoCov">          0 :     prefs_oldval_cvInactiveHandleAlpha = prefs_cvInactiveHandleAlpha;</span>
<span class="lineNum">    2092 </span>            : 
<span class="lineNum">    2093 </span><span class="lineNoCov">          0 :     memset(&amp;p,'\0',sizeof(p));</span>
<span class="lineNum">    2094 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    2095 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_restrict|wam_isdlg;</span>
<span class="lineNum">    2096 </span><span class="lineNoCov">          0 :     wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">    2097 </span><span class="lineNoCov">          0 :     wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">    2098 </span><span class="lineNoCov">          0 :     wattrs.is_dlg = 1;</span>
<span class="lineNum">    2099 </span><span class="lineNoCov">          0 :     wattrs.undercursor = 1;</span>
<span class="lineNum">    2100 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_pointer;</span>
<span class="lineNum">    2101 </span><span class="lineNoCov">          0 :     wattrs.utf8_window_title = _(&quot;Preferences&quot;);</span>
<span class="lineNum">    2102 </span><span class="lineNoCov">          0 :     pos.x = pos.y = 0;</span>
<span class="lineNum">    2103 </span><span class="lineNoCov">          0 :     pos.width = GGadgetScale(GDrawPointsToPixels(NULL,350));</span>
<span class="lineNum">    2104 </span><span class="lineNoCov">          0 :     pos.height = GDrawPointsToPixels(NULL,line_max*26+69);</span>
<span class="lineNum">    2105 </span><span class="lineNoCov">          0 :     gw = GDrawCreateTopWindow(NULL,&amp;pos,e_h,&amp;p,&amp;wattrs);</span>
<span class="lineNum">    2106 </span>            : 
<span class="lineNum">    2107 </span><span class="lineNoCov">          0 :     memset(sgcd,0,sizeof(sgcd));</span>
<span class="lineNum">    2108 </span><span class="lineNoCov">          0 :     memset(slabel,0,sizeof(slabel));</span>
<span class="lineNum">    2109 </span><span class="lineNoCov">          0 :     memset(&amp;mfgcd,0,sizeof(mfgcd));</span>
<span class="lineNum">    2110 </span><span class="lineNoCov">          0 :     memset(&amp;msgcd,0,sizeof(msgcd));</span>
<span class="lineNum">    2111 </span><span class="lineNoCov">          0 :     memset(&amp;mflabels,0,sizeof(mflabels));</span>
<span class="lineNum">    2112 </span><span class="lineNoCov">          0 :     memset(&amp;mslabels,0,sizeof(mslabels));</span>
<span class="lineNum">    2113 </span><span class="lineNoCov">          0 :     memset(&amp;mfboxes,0,sizeof(mfboxes));</span>
<span class="lineNum">    2114 </span><span class="lineNoCov">          0 :     memset(&amp;mpboxes,0,sizeof(mpboxes));</span>
<span class="lineNum">    2115 </span><span class="lineNoCov">          0 :     memset(&amp;sboxes,0,sizeof(sboxes));</span>
<span class="lineNum">    2116 </span><span class="lineNoCov">          0 :     memset(&amp;boxes,0,sizeof(boxes));</span>
<span class="lineNum">    2117 </span>            : 
<span class="lineNum">    2118 </span><span class="lineNoCov">          0 :     GCDFillMacFeat(mfgcd,mflabels,250,default_mac_feature_map, true, mfboxes, mfarray);</span>
<span class="lineNum">    2119 </span>            : 
<span class="lineNum">    2120 </span><span class="lineNoCov">          0 :     sgc = 0;</span>
<span class="lineNum">    2121 </span>            : 
<span class="lineNum">    2122 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.pos.x = 6; msgcd[sgc].gd.pos.y = 6;</span>
<span class="lineNum">    2123 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.pos.width = 250; msgcd[sgc].gd.pos.height = 16*12+10;</span>
<span class="lineNum">    2124 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.flags = gg_visible | gg_enabled | gg_list_alphabetic | gg_list_multiplesel;</span>
<span class="lineNum">    2125 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.cid = CID_Mapping;</span>
<span class="lineNum">    2126 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.u.list = Pref_MappingList(true);</span>
<span class="lineNum">    2127 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.handle_controlevent = Pref_MappingSel;</span>
<span class="lineNum">    2128 </span><span class="lineNoCov">          0 :     msgcd[sgc++].creator = GListCreate;</span>
<span class="lineNum">    2129 </span><span class="lineNoCov">          0 :     mparray[0] = &amp;msgcd[sgc-1];</span>
<span class="lineNum">    2130 </span>            : 
<span class="lineNum">    2131 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.pos.x = 6; msgcd[sgc].gd.pos.y = msgcd[sgc-1].gd.pos.y+msgcd[sgc-1].gd.pos.height+10;</span>
<span class="lineNum">    2132 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2133 </span><span class="lineNoCov">          0 :     mslabels[sgc].text = (unichar_t *) S_(&quot;MacMap|_New...&quot;);</span>
<span class="lineNum">    2134 </span><span class="lineNoCov">          0 :     mslabels[sgc].text_is_1byte = true;</span>
<span class="lineNum">    2135 </span><span class="lineNoCov">          0 :     mslabels[sgc].text_in_resource = true;</span>
<span class="lineNum">    2136 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.label = &amp;mslabels[sgc];</span>
<span class="lineNum">    2137 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.handle_controlevent = Pref_NewMapping;</span>
<span class="lineNum">    2138 </span><span class="lineNoCov">          0 :     msgcd[sgc++].creator = GButtonCreate;</span>
<span class="lineNum">    2139 </span><span class="lineNoCov">          0 :     mparray[4] = GCD_Glue; mparray[5] = &amp;msgcd[sgc-1];</span>
<span class="lineNum">    2140 </span>            : 
<span class="lineNum">    2141 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.pos.x = msgcd[sgc-1].gd.pos.x+10+GIntGetResource(_NUM_Buttonsize)*100/GIntGetResource(_NUM_ScaleFactor);</span>
<span class="lineNum">    2142 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.pos.y = msgcd[sgc-1].gd.pos.y;</span>
<span class="lineNum">    2143 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.flags = gg_visible ;</span>
<span class="lineNum">    2144 </span><span class="lineNoCov">          0 :     mslabels[sgc].text = (unichar_t *) _(&quot;_Delete&quot;);</span>
<span class="lineNum">    2145 </span><span class="lineNoCov">          0 :     mslabels[sgc].text_is_1byte = true;</span>
<span class="lineNum">    2146 </span><span class="lineNoCov">          0 :     mslabels[sgc].text_in_resource = true;</span>
<span class="lineNum">    2147 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.label = &amp;mslabels[sgc];</span>
<span class="lineNum">    2148 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.cid = CID_MappingDel;</span>
<span class="lineNum">    2149 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.handle_controlevent = Pref_DelMapping;</span>
<span class="lineNum">    2150 </span><span class="lineNoCov">          0 :     msgcd[sgc++].creator = GButtonCreate;</span>
<span class="lineNum">    2151 </span><span class="lineNoCov">          0 :     mparray[5] = GCD_Glue; mparray[6] = &amp;msgcd[sgc-1];</span>
<span class="lineNum">    2152 </span>            : 
<span class="lineNum">    2153 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.pos.x = msgcd[sgc-1].gd.pos.x+10+GIntGetResource(_NUM_Buttonsize)*100/GIntGetResource(_NUM_ScaleFactor);</span>
<span class="lineNum">    2154 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.pos.y = msgcd[sgc-1].gd.pos.y;</span>
<span class="lineNum">    2155 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.flags = gg_visible ;</span>
<span class="lineNum">    2156 </span><span class="lineNoCov">          0 :     mslabels[sgc].text = (unichar_t *) _(&quot;_Edit...&quot;);</span>
<span class="lineNum">    2157 </span><span class="lineNoCov">          0 :     mslabels[sgc].text_is_1byte = true;</span>
<span class="lineNum">    2158 </span><span class="lineNoCov">          0 :     mslabels[sgc].text_in_resource = true;</span>
<span class="lineNum">    2159 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.label = &amp;mslabels[sgc];</span>
<span class="lineNum">    2160 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.cid = CID_MappingEdit;</span>
<span class="lineNum">    2161 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.handle_controlevent = Pref_EditMapping;</span>
<span class="lineNum">    2162 </span><span class="lineNoCov">          0 :     msgcd[sgc++].creator = GButtonCreate;</span>
<span class="lineNum">    2163 </span><span class="lineNoCov">          0 :     mparray[7] = GCD_Glue; mparray[8] = &amp;msgcd[sgc-1];</span>
<span class="lineNum">    2164 </span>            : 
<span class="lineNum">    2165 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.pos.x = msgcd[sgc-1].gd.pos.x+10+GIntGetResource(_NUM_Buttonsize)*100/GIntGetResource(_NUM_ScaleFactor);</span>
<span class="lineNum">    2166 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.pos.y = msgcd[sgc-1].gd.pos.y;</span>
<span class="lineNum">    2167 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2168 </span><span class="lineNoCov">          0 :     mslabels[sgc].text = (unichar_t *) S_(&quot;MacMapping|Default&quot;);</span>
<span class="lineNum">    2169 </span><span class="lineNoCov">          0 :     mslabels[sgc].text_is_1byte = true;</span>
<span class="lineNum">    2170 </span><span class="lineNoCov">          0 :     mslabels[sgc].text_in_resource = true;</span>
<span class="lineNum">    2171 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.label = &amp;mslabels[sgc];</span>
<span class="lineNum">    2172 </span><span class="lineNoCov">          0 :     msgcd[sgc].gd.handle_controlevent = Pref_DefaultMapping;</span>
<span class="lineNum">    2173 </span><span class="lineNoCov">          0 :     msgcd[sgc++].creator = GButtonCreate;</span>
<span class="lineNum">    2174 </span><span class="lineNoCov">          0 :     mparray[9] = GCD_Glue; mparray[10] = &amp;msgcd[sgc-1];</span>
<span class="lineNum">    2175 </span><span class="lineNoCov">          0 :     mparray[11] = GCD_Glue; mparray[12] = NULL;</span>
<span class="lineNum">    2176 </span>            : 
<span class="lineNum">    2177 </span><span class="lineNoCov">          0 :     mpboxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2178 </span><span class="lineNoCov">          0 :     mpboxes[2].gd.u.boxelements = mparray+4;</span>
<span class="lineNum">    2179 </span><span class="lineNoCov">          0 :     mpboxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">    2180 </span><span class="lineNoCov">          0 :     mparray[1] = GCD_Glue;</span>
<span class="lineNum">    2181 </span><span class="lineNoCov">          0 :     mparray[2] = &amp;mpboxes[2];</span>
<span class="lineNum">    2182 </span><span class="lineNoCov">          0 :     mparray[3] = NULL;</span>
<span class="lineNum">    2183 </span>            : 
<span class="lineNum">    2184 </span><span class="lineNoCov">          0 :     mpboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2185 </span><span class="lineNoCov">          0 :     mpboxes[0].gd.u.boxelements = mparray;</span>
<span class="lineNum">    2186 </span><span class="lineNoCov">          0 :     mpboxes[0].creator = GVBoxCreate;</span>
<span class="lineNum">    2187 </span>            : 
<span class="lineNum">    2188 </span><span class="lineNoCov">          0 :     sgc = 0;</span>
<span class="lineNum">    2189 </span><span class="lineNoCov">          0 :     y2=5;</span>
<span class="lineNum">    2190 </span><span class="lineNoCov">          0 :     si = 0;</span>
<span class="lineNum">    2191 </span>            : 
<span class="lineNum">    2192 </span><span class="lineNoCov">          0 :     slabel[sgc].text = (unichar_t *) _(&quot;Menu Name&quot;);</span>
<span class="lineNum">    2193 </span><span class="lineNoCov">          0 :     slabel[sgc].text_is_1byte = true;</span>
<span class="lineNum">    2194 </span><span class="lineNoCov">          0 :     sgcd[sgc].gd.label = &amp;slabel[sgc];</span>
<span class="lineNum">    2195 </span><span class="lineNoCov">          0 :     sgcd[sgc].gd.popup_msg = (unichar_t *) _(&quot;You may create a script menu containing up to 10 frequently used scripts.\nEach entry in the menu needs both a name to display in the menu and\na script file to execute. The menu name may contain any unicode characters.\nThe button labeled \&quot;...\&quot; will allow you to browse for a script file.&quot;);</span>
<span class="lineNum">    2196 </span><span class="lineNoCov">          0 :     sgcd[sgc].gd.pos.x = 8;</span>
<span class="lineNum">    2197 </span><span class="lineNoCov">          0 :     sgcd[sgc].gd.pos.y = y2;</span>
<span class="lineNum">    2198 </span><span class="lineNoCov">          0 :     sgcd[sgc].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    2199 </span><span class="lineNoCov">          0 :     sgcd[sgc++].creator = GLabelCreate;</span>
<span class="lineNum">    2200 </span><span class="lineNoCov">          0 :     sarray[si++] = &amp;sgcd[sgc-1];</span>
<span class="lineNum">    2201 </span>            : 
<span class="lineNum">    2202 </span><span class="lineNoCov">          0 :     slabel[sgc].text = (unichar_t *) _(&quot;Script File&quot;);</span>
<span class="lineNum">    2203 </span><span class="lineNoCov">          0 :     slabel[sgc].text_is_1byte = true;</span>
<span class="lineNum">    2204 </span><span class="lineNoCov">          0 :     sgcd[sgc].gd.label = &amp;slabel[sgc];</span>
<span class="lineNum">    2205 </span><span class="lineNoCov">          0 :     sgcd[sgc].gd.popup_msg = (unichar_t *) _(&quot;You may create a script menu containing up to 10 frequently used scripts\nEach entry in the menu needs both a name to display in the menu and\na script file to execute. The menu name may contain any unicode characters.\nThe button labeled \&quot;...\&quot; will allow you to browse for a script file.&quot;);</span>
<span class="lineNum">    2206 </span><span class="lineNoCov">          0 :     sgcd[sgc].gd.pos.x = 110;</span>
<span class="lineNum">    2207 </span><span class="lineNoCov">          0 :     sgcd[sgc].gd.pos.y = y2;</span>
<span class="lineNum">    2208 </span><span class="lineNoCov">          0 :     sgcd[sgc].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    2209 </span><span class="lineNoCov">          0 :     sgcd[sgc++].creator = GLabelCreate;</span>
<span class="lineNum">    2210 </span><span class="lineNoCov">          0 :     sarray[si++] = &amp;sgcd[sgc-1];</span>
<span class="lineNum">    2211 </span><span class="lineNoCov">          0 :     sarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2212 </span><span class="lineNoCov">          0 :     sarray[si++] = NULL;</span>
<span class="lineNum">    2213 </span>            : 
<span class="lineNum">    2214 </span><span class="lineNoCov">          0 :     y2 += 14;</span>
<span class="lineNum">    2215 </span>            : 
<span class="lineNum">    2216 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;SCRIPT_MENU_MAX; ++i ) {</span>
<span class="lineNum">    2217 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.pos.x = 8; sgcd[sgc].gd.pos.y = y2;</span>
<span class="lineNum">    2218 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.flags = gg_visible | gg_enabled | gg_text_xim;</span>
<span class="lineNum">    2219 </span><span class="lineNoCov">          0 :         slabel[sgc].text = script_menu_names[i]==NULL?nullstr:script_menu_names[i];</span>
<span class="lineNum">    2220 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.label = &amp;slabel[sgc];</span>
<span class="lineNum">    2221 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.cid = i+CID_ScriptMNameBase;</span>
<span class="lineNum">    2222 </span><span class="lineNoCov">          0 :         sgcd[sgc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2223 </span><span class="lineNoCov">          0 :         sarray[si++] = &amp;sgcd[sgc-1];</span>
<span class="lineNum">    2224 </span>            : 
<span class="lineNum">    2225 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.pos.x = 110; sgcd[sgc].gd.pos.y = y2;</span>
<span class="lineNum">    2226 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2227 </span><span class="lineNoCov">          0 :         slabel[sgc].text = (unichar_t *) (script_filenames[i]==NULL?&quot;&quot;:script_filenames[i]);</span>
<span class="lineNum">    2228 </span><span class="lineNoCov">          0 :         slabel[sgc].text_is_1byte = true;</span>
<span class="lineNum">    2229 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.label = &amp;slabel[sgc];</span>
<span class="lineNum">    2230 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.cid = i+CID_ScriptMFileBase;</span>
<span class="lineNum">    2231 </span><span class="lineNoCov">          0 :         sgcd[sgc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2232 </span><span class="lineNoCov">          0 :         sarray[si++] = &amp;sgcd[sgc-1];</span>
<span class="lineNum">    2233 </span>            : 
<span class="lineNum">    2234 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.pos.x = 210; sgcd[sgc].gd.pos.y = y2;</span>
<span class="lineNum">    2235 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2236 </span><span class="lineNoCov">          0 :         slabel[sgc].text = (unichar_t *) _(&quot;...&quot;);</span>
<span class="lineNum">    2237 </span><span class="lineNoCov">          0 :         slabel[sgc].text_is_1byte = true;</span>
<span class="lineNum">    2238 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.label = &amp;slabel[sgc];</span>
<span class="lineNum">    2239 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.cid = i+CID_ScriptMBrowseBase;</span>
<span class="lineNum">    2240 </span><span class="lineNoCov">          0 :         sgcd[sgc].gd.handle_controlevent = Prefs_ScriptBrowse;</span>
<span class="lineNum">    2241 </span><span class="lineNoCov">          0 :         sgcd[sgc++].creator = GButtonCreate;</span>
<span class="lineNum">    2242 </span><span class="lineNoCov">          0 :         sarray[si++] = &amp;sgcd[sgc-1];</span>
<span class="lineNum">    2243 </span><span class="lineNoCov">          0 :         sarray[si++] = NULL;</span>
<span class="lineNum">    2244 </span>            : 
<span class="lineNum">    2245 </span><span class="lineNoCov">          0 :         y2 += 26;</span>
<span class="lineNum">    2246 </span>            :     }
<span class="lineNum">    2247 </span><span class="lineNoCov">          0 :     sarray[si++] = GCD_Glue; sarray[si++] = GCD_Glue; sarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2248 </span><span class="lineNoCov">          0 :     sarray[si++] = NULL;</span>
<span class="lineNum">    2249 </span><span class="lineNoCov">          0 :     sarray[si++] = NULL;</span>
<span class="lineNum">    2250 </span>            : 
<span class="lineNum">    2251 </span><span class="lineNoCov">          0 :     sboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2252 </span><span class="lineNoCov">          0 :     sboxes[0].gd.u.boxelements = sarray;</span>
<span class="lineNum">    2253 </span><span class="lineNoCov">          0 :     sboxes[0].creator = GHVBoxCreate;</span>
<span class="lineNum">    2254 </span>            : 
<span class="lineNum">    2255 </span><span class="lineNoCov">          0 :     memset(&amp;mgcd,0,sizeof(mgcd));</span>
<span class="lineNum">    2256 </span><span class="lineNoCov">          0 :     memset(&amp;mgcd,0,sizeof(mgcd));</span>
<span class="lineNum">    2257 </span><span class="lineNoCov">          0 :     memset(&amp;subaspects,'\0',sizeof(subaspects));</span>
<span class="lineNum">    2258 </span><span class="lineNoCov">          0 :     memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">    2259 </span><span class="lineNoCov">          0 :     memset(&amp;gcd,0,sizeof(gcd));</span>
<span class="lineNum">    2260 </span><span class="lineNoCov">          0 :     memset(&amp;aspects,'\0',sizeof(aspects));</span>
<span class="lineNum">    2261 </span><span class="lineNoCov">          0 :     aspects[0].selected = true;</span>
<span class="lineNum">    2262 </span>            : 
<span class="lineNum">    2263 </span><span class="lineNoCov">          0 :     for ( k=0; visible_prefs_list[k].tab_name!=0; ++k ) {</span>
<span class="lineNum">    2264 </span><span class="lineNoCov">          0 :         pgcd = calloc(gcnt[k]+4,sizeof(GGadgetCreateData));</span>
<span class="lineNum">    2265 </span><span class="lineNoCov">          0 :         plabel = calloc(gcnt[k]+4,sizeof(GTextInfo));</span>
<span class="lineNum">    2266 </span><span class="lineNoCov">          0 :         hvarray = calloc((gcnt[k]+6)*5+2,sizeof(GGadgetCreateData *));</span>
<span class="lineNum">    2267 </span>            : 
<span class="lineNum">    2268 </span><span class="lineNoCov">          0 :         aspects[k].text = (unichar_t *) visible_prefs_list[k].tab_name;</span>
<span class="lineNum">    2269 </span><span class="lineNoCov">          0 :         aspects[k].text_is_1byte = true;</span>
<span class="lineNum">    2270 </span><span class="lineNoCov">          0 :         aspects[k].gcd = &amp;boxes[2*k];</span>
<span class="lineNum">    2271 </span><span class="lineNoCov">          0 :         aspects[k].nesting = visible_prefs_list[k].nest;</span>
<span class="lineNum">    2272 </span><span class="lineNoCov">          0 :         plabels[k] = plabel;</span>
<span class="lineNum">    2273 </span>            : 
<span class="lineNum">    2274 </span><span class="lineNoCov">          0 :         gc = si = 0;</span>
<span class="lineNum">    2275 </span><span class="lineNoCov">          0 :         for ( i=line=0, y=5; visible_prefs_list[k].pl[i].name!=NULL; ++i ) {</span>
<span class="lineNum">    2276 </span><span class="lineNoCov">          0 :             pl = &amp;visible_prefs_list[k].pl[i];</span>
<span class="lineNum">    2277 </span><span class="lineNoCov">          0 :             if ( pl-&gt;dontdisplay )</span>
<span class="lineNum">    2278 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">    2279 </span><span class="lineNoCov">          0 :             plabel[gc].text = (unichar_t *) _(pl-&gt;name);</span>
<span class="lineNum">    2280 </span><span class="lineNoCov">          0 :             plabel[gc].text_is_1byte = true;</span>
<span class="lineNum">    2281 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.label = &amp;plabel[gc];</span>
<span class="lineNum">    2282 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.mnemonic = '\0';</span>
<span class="lineNum">    2283 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.popup_msg = (unichar_t *) _(pl-&gt;popup);</span>
<span class="lineNum">    2284 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.pos.x = 8;</span>
<span class="lineNum">    2285 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.pos.y = y + 6;</span>
<span class="lineNum">    2286 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    2287 </span><span class="lineNoCov">          0 :             pgcd[gc++].creator = GLabelCreate;</span>
<span class="lineNum">    2288 </span><span class="lineNoCov">          0 :             hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2289 </span>            : 
<span class="lineNum">    2290 </span><span class="lineNoCov">          0 :             plabel[gc].text_is_1byte = true;</span>
<span class="lineNum">    2291 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.label = &amp;plabel[gc];</span>
<span class="lineNum">    2292 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.mnemonic = '\0';</span>
<span class="lineNum">    2293 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.popup_msg = (unichar_t *) _(pl-&gt;popup);</span>
<span class="lineNum">    2294 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.pos.x = 110;</span>
<span class="lineNum">    2295 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.pos.y = y;</span>
<span class="lineNum">    2296 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    2297 </span><span class="lineNoCov">          0 :             pgcd[gc].data = pl;</span>
<span class="lineNum">    2298 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.cid = k*CID_PrefsOffset+CID_PrefsBase+i;</span>
<span class="lineNum">    2299 </span><span class="lineNoCov">          0 :             switch ( pl-&gt;type ) {</span>
<span class="lineNum">    2300 </span>            :               case pr_bool:
<span class="lineNum">    2301 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) _(&quot;On&quot;);</span>
<span class="lineNum">    2302 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.y += 3;</span>
<span class="lineNum">    2303 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GRadioCreate;</span>
<span class="lineNum">    2304 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2305 </span><span class="lineNoCov">          0 :                 pgcd[gc] = pgcd[gc-1];</span>
<span class="lineNum">    2306 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.x += 50;</span>
<span class="lineNum">    2307 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.cid = 0;</span>
<span class="lineNum">    2308 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.label = &amp;plabel[gc];</span>
<span class="lineNum">    2309 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) _(&quot;Off&quot;);</span>
<span class="lineNum">    2310 </span><span class="lineNoCov">          0 :                 plabel[gc].text_is_1byte = true;</span>
<span class="lineNum">    2311 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc];</span>
<span class="lineNum">    2312 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2313 </span><span class="lineNoCov">          0 :                 if ( *((int *) pl-&gt;val))</span>
<span class="lineNum">    2314 </span><span class="lineNoCov">          0 :                     pgcd[gc-1].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    2315 </span>            :                 else
<span class="lineNum">    2316 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    2317 </span><span class="lineNoCov">          0 :                 ++gc;</span>
<span class="lineNum">    2318 </span><span class="lineNoCov">          0 :                 y += 22;</span>
<span class="lineNum">    2319 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2320 </span>            :               case pr_int:
<span class="lineNum">    2321 </span><span class="lineNoCov">          0 :                 sprintf(buf,&quot;%d&quot;, *((int *) pl-&gt;val));</span>
<span class="lineNum">    2322 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) copy( buf );</span>
<span class="lineNum">    2323 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2324 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2325 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_Glue; hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2326 </span><span class="lineNoCov">          0 :                 y += 26;</span>
<span class="lineNum">    2327 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2328 </span>            :               case pr_unicode:
<span class="lineNum">    2329 </span>            :                 /*sprintf(buf,&quot;U+%04x&quot;, *((int *) pl-&gt;val));*/
<span class="lineNum">    2330 </span><span class="lineNoCov">          0 :                 { char *pt; pt=buf; pt=utf8_idpb(pt,*((int *)pl-&gt;val),UTF8IDPB_NOZERO); *pt='\0'; }</span>
<span class="lineNum">    2331 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) copy( buf );</span>
<span class="lineNum">    2332 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2333 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2334 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_Glue; hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2335 </span><span class="lineNoCov">          0 :                 y += 26;</span>
<span class="lineNum">    2336 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2337 </span>            :               case pr_real:
<span class="lineNum">    2338 </span><span class="lineNoCov">          0 :                 sprintf(buf,&quot;%g&quot;, *((float *) pl-&gt;val));</span>
<span class="lineNum">    2339 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) copy( buf );</span>
<span class="lineNum">    2340 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2341 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2342 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_Glue; hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2343 </span><span class="lineNoCov">          0 :                 y += 26;</span>
<span class="lineNum">    2344 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2345 </span>            :               case pr_encoding:
<span class="lineNum">    2346 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.u.list = GetEncodingTypes();</span>
<span class="lineNum">    2347 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.label = EncodingTypesFindEnc(pgcd[gc].gd.u.list,</span>
<span class="lineNum">    2348 </span><span class="lineNoCov">          0 :                         *(Encoding **) pl-&gt;val);</span>
<span class="lineNum">    2349 </span><span class="lineNoCov">          0 :                 for ( ii=0; pgcd[gc].gd.u.list[ii].text!=NULL ||pgcd[gc].gd.u.list[ii].line; ++ii )</span>
<span class="lineNum">    2350 </span><span class="lineNoCov">          0 :                     if ( pgcd[gc].gd.u.list[ii].userdata!=NULL &amp;&amp;</span>
<span class="lineNum">    2351 </span><span class="lineNoCov">          0 :                             (strcmp(pgcd[gc].gd.u.list[ii].userdata,&quot;Compacted&quot;)==0 ||</span>
<span class="lineNum">    2352 </span><span class="lineNoCov">          0 :                              strcmp(pgcd[gc].gd.u.list[ii].userdata,&quot;Original&quot;)==0 ))</span>
<span class="lineNum">    2353 </span><span class="lineNoCov">          0 :                         pgcd[gc].gd.u.list[ii].disabled = true;</span>
<span class="lineNum">    2354 </span><span class="lineNoCov">          0 :                 pgcd[gc].creator = GListFieldCreate;</span>
<span class="lineNum">    2355 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.width = 160;</span>
<span class="lineNum">    2356 </span><span class="lineNoCov">          0 :                 if ( pgcd[gc].gd.label==NULL ) pgcd[gc].gd.label = &amp;encodingtypes[0];</span>
<span class="lineNum">    2357 </span><span class="lineNoCov">          0 :                 ++gc;</span>
<span class="lineNum">    2358 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2359 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_ColSpan; hvarray[si++] = GCD_ColSpan;</span>
<span class="lineNum">    2360 </span><span class="lineNoCov">          0 :                 y += 28;</span>
<span class="lineNum">    2361 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2362 </span>            :               case pr_namelist:
<span class="lineNum">    2363 </span><span class="lineNoCov">          0 :                 { char **nlnames = AllNamelistNames();</span>
<span class="lineNum">    2364 </span>            :                 int cnt;
<span class="lineNum">    2365 </span>            :                 GTextInfo *namelistnames;
<span class="lineNum">    2366 </span><span class="lineNoCov">          0 :                 for ( cnt=0; nlnames[cnt]!=NULL; ++cnt);</span>
<span class="lineNum">    2367 </span><span class="lineNoCov">          0 :                 namelistnames = calloc(cnt+1,sizeof(GTextInfo));</span>
<span class="lineNum">    2368 </span><span class="lineNoCov">          0 :                 for ( cnt=0; nlnames[cnt]!=NULL; ++cnt) {</span>
<span class="lineNum">    2369 </span><span class="lineNoCov">          0 :                     namelistnames[cnt].text = (unichar_t *) nlnames[cnt];</span>
<span class="lineNum">    2370 </span><span class="lineNoCov">          0 :                     namelistnames[cnt].text_is_1byte = true;</span>
<span class="lineNum">    2371 </span><span class="lineNoCov">          0 :                     if ( strcmp(_((*(NameList **) (pl-&gt;val))-&gt;title),nlnames[cnt])==0 ) {</span>
<span class="lineNum">    2372 </span><span class="lineNoCov">          0 :                         namelistnames[cnt].selected = true;</span>
<span class="lineNum">    2373 </span><span class="lineNoCov">          0 :                         pgcd[gc].gd.label = &amp;namelistnames[cnt];</span>
<span class="lineNum">    2374 </span>            :                     }
<span class="lineNum">    2375 </span>            :                 }
<span class="lineNum">    2376 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.u.list = namelistnames;</span>
<span class="lineNum">    2377 </span><span class="lineNoCov">          0 :                 pgcd[gc].creator = GListButtonCreate;</span>
<span class="lineNum">    2378 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.width = 160;</span>
<span class="lineNum">    2379 </span><span class="lineNoCov">          0 :                 ++gc;</span>
<span class="lineNum">    2380 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2381 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_ColSpan; hvarray[si++] = GCD_ColSpan;</span>
<span class="lineNum">    2382 </span><span class="lineNoCov">          0 :                 y += 28;</span>
<span class="lineNum">    2383 </span><span class="lineNoCov">          0 :               } break;</span>
<span class="lineNum">    2384 </span>            :               case pr_string: case pr_file:
<span class="lineNum">    2385 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;set==SetAutoTraceArgs || ((char **) pl-&gt;val)==&amp;mf_args )</span>
<span class="lineNum">    2386 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.pos.width = 160;</span>
<span class="lineNum">    2387 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;val!=NULL )</span>
<span class="lineNum">    2388 </span><span class="lineNoCov">          0 :                     tempstr = *((char **) (pl-&gt;val));</span>
<span class="lineNum">    2389 </span>            :                 else
<span class="lineNum">    2390 </span><span class="lineNoCov">          0 :                     tempstr = (char *) ((pl-&gt;get)());</span>
<span class="lineNum">    2391 </span><span class="lineNoCov">          0 :                 if ( tempstr!=NULL )</span>
<span class="lineNum">    2392 </span><span class="lineNoCov">          0 :                     plabel[gc].text = /* def2u_*/ uc_copy( tempstr );</span>
<span class="lineNum">    2393 </span><span class="lineNoCov">          0 :                 else if ( ((char **) pl-&gt;val)==&amp;BDFFoundry )</span>
<span class="lineNum">    2394 </span><span class="lineNoCov">          0 :                     plabel[gc].text = /* def2u_*/ uc_copy( &quot;FontForge&quot; );</span>
<span class="lineNum">    2395 </span>            :                 else
<span class="lineNum">    2396 </span><span class="lineNoCov">          0 :                     plabel[gc].text = /* def2u_*/ uc_copy( &quot;&quot; );</span>
<span class="lineNum">    2397 </span><span class="lineNoCov">          0 :                 plabel[gc].text_is_1byte = false;</span>
<span class="lineNum">    2398 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2399 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2400 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;type==pr_file ) {</span>
<span class="lineNum">    2401 </span><span class="lineNoCov">          0 :                     pgcd[gc] = pgcd[gc-1];</span>
<span class="lineNum">    2402 </span><span class="lineNoCov">          0 :                     pgcd[gc-1].gd.pos.width = 140;</span>
<span class="lineNum">    2403 </span><span class="lineNoCov">          0 :                     hvarray[si++] = GCD_ColSpan;</span>
<span class="lineNum">    2404 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.pos.x += 145;</span>
<span class="lineNum">    2405 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.cid += CID_PrefsBrowseOffset;</span>
<span class="lineNum">    2406 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.label = &amp;plabel[gc];</span>
<span class="lineNum">    2407 </span><span class="lineNoCov">          0 :                     plabel[gc].text = (unichar_t *) &quot;...&quot;;</span>
<span class="lineNum">    2408 </span><span class="lineNoCov">          0 :                     plabel[gc].text_is_1byte = true;</span>
<span class="lineNum">    2409 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.handle_controlevent = Prefs_BrowseFile;</span>
<span class="lineNum">    2410 </span><span class="lineNoCov">          0 :                     pgcd[gc++].creator = GButtonCreate;</span>
<span class="lineNum">    2411 </span><span class="lineNoCov">          0 :                     hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2412 </span><span class="lineNoCov">          0 :                 } else if ( pl-&gt;set==SetAutoTraceArgs || ((char **) pl-&gt;val)==&amp;mf_args ) {</span>
<span class="lineNum">    2413 </span><span class="lineNoCov">          0 :                     hvarray[si++] = GCD_ColSpan;</span>
<span class="lineNum">    2414 </span><span class="lineNoCov">          0 :                     hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2415 </span>            :                 } else {
<span class="lineNum">    2416 </span><span class="lineNoCov">          0 :                     hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2417 </span><span class="lineNoCov">          0 :                     hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2418 </span>            :                 }
<span class="lineNum">    2419 </span><span class="lineNoCov">          0 :                 y += 26;</span>
<span class="lineNum">    2420 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;val==NULL )</span>
<span class="lineNum">    2421 </span><span class="lineNoCov">          0 :                     free(tempstr);</span>
<span class="lineNum">    2422 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2423 </span>            :               case pr_angle:
<span class="lineNum">    2424 </span><span class="lineNoCov">          0 :                 sprintf(buf,&quot;%g&quot;, *((float *) pl-&gt;val) * RAD2DEG);</span>
<span class="lineNum">    2425 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) copy( buf );</span>
<span class="lineNum">    2426 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2427 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2428 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) U_(&quot;°&quot;);</span>
<span class="lineNum">    2429 </span><span class="lineNoCov">          0 :                 plabel[gc].text_is_1byte = true;</span>
<span class="lineNum">    2430 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.label = &amp;plabel[gc];</span>
<span class="lineNum">    2431 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.x = pgcd[gc-1].gd.pos.x+gcd[gc-1].gd.pos.width+2; pgcd[gc].gd.pos.y = pgcd[gc-1].gd.pos.y;</span>
<span class="lineNum">    2432 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2433 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GLabelCreate;</span>
<span class="lineNum">    2434 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2435 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2436 </span><span class="lineNoCov">          0 :                 y += 26;</span>
<span class="lineNum">    2437 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2438 </span>            :             }
<span class="lineNum">    2439 </span><span class="lineNoCov">          0 :             ++line;</span>
<span class="lineNum">    2440 </span><span class="lineNoCov">          0 :             hvarray[si++] = NULL;</span>
<span class="lineNum">    2441 </span>            :         }
<span class="lineNum">    2442 </span><span class="lineNoCov">          0 :         if ( visible_prefs_list[k].pl == args_list ) {</span>
<span class="lineNum">    2443 </span>            :             static char *text[] = {
<span class="lineNum">    2444 </span>            : /* GT: See the long comment at &quot;Property|New&quot; */
<span class="lineNum">    2445 </span>            : /* GT: This and the next few strings show a limitation of my widget set which */
<span class="lineNum">    2446 </span>            : /* GT: cannot handle multi-line text labels. These strings should be concatenated */
<span class="lineNum">    2447 </span>            : /* GT: (after striping off &quot;Prefs_App|&quot;) together, translated, and then broken up */
<span class="lineNum">    2448 </span>            : /* GT: to fit the dialog. There is an extra blank line, not used in English, */
<span class="lineNum">    2449 </span>            : /* GT: into which your text may extend if needed. */
<span class="lineNum">    2450 </span>            :                 N_(&quot;Prefs_App|Normally FontForge will find applications by searching for&quot;),
<span class="lineNum">    2451 </span>            :                 N_(&quot;Prefs_App|them in your PATH environment variable, if you want&quot;),
<span class="lineNum">    2452 </span>            :                 N_(&quot;Prefs_App|to alter that behavior you may set an environment&quot;),
<span class="lineNum">    2453 </span>            :                 N_(&quot;Prefs_App|variable giving the full path spec of the application.&quot;),
<span class="lineNum">    2454 </span>            :                 N_(&quot;Prefs_App|FontForge recognizes BROWSER, MF and AUTOTRACE.&quot;),
<span class="lineNum">    2455 </span>            :                 N_(&quot;Prefs_App| &quot;), /* A blank line */
<span class="lineNum">    2456 </span>            :                 NULL };
<span class="lineNum">    2457 </span><span class="lineNoCov">          0 :             y += 8;</span>
<span class="lineNum">    2458 </span><span class="lineNoCov">          0 :             for ( i=0; text[i]!=0; ++i ) {</span>
<span class="lineNum">    2459 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) S_(text[i]);</span>
<span class="lineNum">    2460 </span><span class="lineNoCov">          0 :                 plabel[gc].text_is_1byte = true;</span>
<span class="lineNum">    2461 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.label = &amp;plabel[gc];</span>
<span class="lineNum">    2462 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.x = 8;</span>
<span class="lineNum">    2463 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.y = y;</span>
<span class="lineNum">    2464 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2465 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GLabelCreate;</span>
<span class="lineNum">    2466 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2467 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_ColSpan; hvarray[si++] = GCD_ColSpan;</span>
<span class="lineNum">    2468 </span><span class="lineNoCov">          0 :                 hvarray[si++] = NULL;</span>
<span class="lineNum">    2469 </span><span class="lineNoCov">          0 :                 y += 12;</span>
<span class="lineNum">    2470 </span>            :             }
<span class="lineNum">    2471 </span>            :         }
<span class="lineNum">    2472 </span><span class="lineNoCov">          0 :         if ( y&gt;y2 ) y2 = y;</span>
<span class="lineNum">    2473 </span><span class="lineNoCov">          0 :         hvarray[si++] = GCD_Glue; hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2474 </span><span class="lineNoCov">          0 :         hvarray[si++] = GCD_Glue; hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2475 </span><span class="lineNoCov">          0 :         hvarray[si++] = NULL;</span>
<span class="lineNum">    2476 </span><span class="lineNoCov">          0 :         hvarray[si++] = NULL;</span>
<span class="lineNum">    2477 </span><span class="lineNoCov">          0 :         boxes[2*k].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2478 </span><span class="lineNoCov">          0 :         boxes[2*k].gd.u.boxelements = hvarray;</span>
<span class="lineNum">    2479 </span><span class="lineNoCov">          0 :         boxes[2*k].creator = GHVBoxCreate;</span>
<span class="lineNum">    2480 </span>            :     }
<span class="lineNum">    2481 </span>            : 
<span class="lineNum">    2482 </span><span class="lineNoCov">          0 :     aspects[k].text = (unichar_t *) _(&quot;Script Menu&quot;);</span>
<span class="lineNum">    2483 </span><span class="lineNoCov">          0 :     aspects[k].text_is_1byte = true;</span>
<span class="lineNum">    2484 </span><span class="lineNoCov">          0 :     aspects[k++].gcd = sboxes;</span>
<span class="lineNum">    2485 </span>            : 
<span class="lineNum">    2486 </span><span class="lineNoCov">          0 :     subaspects[0].text = (unichar_t *) _(&quot;Features&quot;);</span>
<span class="lineNum">    2487 </span><span class="lineNoCov">          0 :     subaspects[0].text_is_1byte = true;</span>
<span class="lineNum">    2488 </span><span class="lineNoCov">          0 :     subaspects[0].gcd = mfboxes;</span>
<span class="lineNum">    2489 </span>            : 
<span class="lineNum">    2490 </span><span class="lineNoCov">          0 :     subaspects[1].text = (unichar_t *) _(&quot;Mapping&quot;);</span>
<span class="lineNum">    2491 </span><span class="lineNoCov">          0 :     subaspects[1].text_is_1byte = true;</span>
<span class="lineNum">    2492 </span><span class="lineNoCov">          0 :     subaspects[1].gcd = mpboxes;</span>
<span class="lineNum">    2493 </span>            : 
<span class="lineNum">    2494 </span><span class="lineNoCov">          0 :     mgcd[0].gd.pos.x = 4; gcd[0].gd.pos.y = 6;</span>
<span class="lineNum">    2495 </span><span class="lineNoCov">          0 :     mgcd[0].gd.pos.width = GDrawPixelsToPoints(NULL,pos.width)-20;</span>
<span class="lineNum">    2496 </span><span class="lineNoCov">          0 :     mgcd[0].gd.pos.height = y2;</span>
<span class="lineNum">    2497 </span><span class="lineNoCov">          0 :     mgcd[0].gd.u.tabs = subaspects;</span>
<span class="lineNum">    2498 </span><span class="lineNoCov">          0 :     mgcd[0].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2499 </span><span class="lineNoCov">          0 :     mgcd[0].creator = GTabSetCreate;</span>
<span class="lineNum">    2500 </span>            : 
<span class="lineNum">    2501 </span><span class="lineNoCov">          0 :     aspects[k].text = (unichar_t *) _(&quot;Mac&quot;);</span>
<span class="lineNum">    2502 </span><span class="lineNoCov">          0 :     aspects[k].text_is_1byte = true;</span>
<span class="lineNum">    2503 </span><span class="lineNoCov">          0 :     aspects[k++].gcd = mgcd;</span>
<span class="lineNum">    2504 </span>            : 
<span class="lineNum">    2505 </span><span class="lineNoCov">          0 :     gc = 0;</span>
<span class="lineNum">    2506 </span>            : 
<span class="lineNum">    2507 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.x = gcd[gc].gd.pos.y = 2;</span>
<span class="lineNum">    2508 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.width = pos.width-4; gcd[gc].gd.pos.height = pos.height-2;</span>
<span class="lineNum">    2509 </span><span class="lineNoCov">          0 :     gcd[gc].gd.flags = gg_enabled | gg_visible | gg_pos_in_pixels;</span>
<span class="lineNum">    2510 </span><span class="lineNoCov">          0 :     gcd[gc++].creator = GGroupCreate;</span>
<span class="lineNum">    2511 </span>            : 
<span class="lineNum">    2512 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.x = 4; gcd[gc].gd.pos.y = 6;</span>
<span class="lineNum">    2513 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.width = GDrawPixelsToPoints(NULL,pos.width)-8;</span>
<span class="lineNum">    2514 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.height = y2+20+18+4;</span>
<span class="lineNum">    2515 </span><span class="lineNoCov">          0 :     gcd[gc].gd.u.tabs = aspects;</span>
<span class="lineNum">    2516 </span><span class="lineNoCov">          0 :     gcd[gc].gd.flags = gg_visible | gg_enabled | gg_tabset_vert;</span>
<span class="lineNum">    2517 </span><span class="lineNoCov">          0 :     gcd[gc++].creator = GTabSetCreate;</span>
<span class="lineNum">    2518 </span><span class="lineNoCov">          0 :     varray[0] = &amp;gcd[gc-1]; varray[1] = NULL;</span>
<span class="lineNum">    2519 </span>            : 
<span class="lineNum">    2520 </span><span class="lineNoCov">          0 :     y = gcd[gc-1].gd.pos.y+gcd[gc-1].gd.pos.height;</span>
<span class="lineNum">    2521 </span>            : 
<span class="lineNum">    2522 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.x = 30-3; gcd[gc].gd.pos.y = y+5-3;</span>
<span class="lineNum">    2523 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.width = -1; gcd[gc].gd.pos.height = 0;</span>
<span class="lineNum">    2524 </span><span class="lineNoCov">          0 :     gcd[gc].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">    2525 </span><span class="lineNoCov">          0 :     label[gc].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">    2526 </span><span class="lineNoCov">          0 :     label[gc].text_is_1byte = true;</span>
<span class="lineNum">    2527 </span><span class="lineNoCov">          0 :     label[gc].text_in_resource = true;</span>
<span class="lineNum">    2528 </span><span class="lineNoCov">          0 :     gcd[gc].gd.mnemonic = 'O';</span>
<span class="lineNum">    2529 </span><span class="lineNoCov">          0 :     gcd[gc].gd.label = &amp;label[gc];</span>
<span class="lineNum">    2530 </span><span class="lineNoCov">          0 :     gcd[gc].gd.handle_controlevent = Prefs_Ok;</span>
<span class="lineNum">    2531 </span><span class="lineNoCov">          0 :     gcd[gc++].creator = GButtonCreate;</span>
<span class="lineNum">    2532 </span><span class="lineNoCov">          0 :     harray[0] = GCD_Glue; harray[1] = &amp;gcd[gc-1]; harray[2] = GCD_Glue; harray[3] = GCD_Glue;</span>
<span class="lineNum">    2533 </span>            : 
<span class="lineNum">    2534 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.x = -30; gcd[gc].gd.pos.y = gcd[gc-1].gd.pos.y+3;</span>
<span class="lineNum">    2535 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.width = -1; gcd[gc].gd.pos.height = 0;</span>
<span class="lineNum">    2536 </span><span class="lineNoCov">          0 :     gcd[gc].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">    2537 </span><span class="lineNoCov">          0 :     label[gc].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    2538 </span><span class="lineNoCov">          0 :     label[gc].text_is_1byte = true;</span>
<span class="lineNum">    2539 </span><span class="lineNoCov">          0 :     label[gc].text_in_resource = true;</span>
<span class="lineNum">    2540 </span><span class="lineNoCov">          0 :     gcd[gc].gd.label = &amp;label[gc];</span>
<span class="lineNum">    2541 </span><span class="lineNoCov">          0 :     gcd[gc].gd.mnemonic = 'C';</span>
<span class="lineNum">    2542 </span><span class="lineNoCov">          0 :     gcd[gc].gd.handle_controlevent = Prefs_Cancel;</span>
<span class="lineNum">    2543 </span><span class="lineNoCov">          0 :     gcd[gc++].creator = GButtonCreate;</span>
<span class="lineNum">    2544 </span><span class="lineNoCov">          0 :     harray[4] = GCD_Glue; harray[5] = &amp;gcd[gc-1]; harray[6] = GCD_Glue; harray[7] = NULL;</span>
<span class="lineNum">    2545 </span>            : 
<span class="lineNum">    2546 </span><span class="lineNoCov">          0 :     memset(mboxes,0,sizeof(mboxes));</span>
<span class="lineNum">    2547 </span><span class="lineNoCov">          0 :     mboxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2548 </span><span class="lineNoCov">          0 :     mboxes[2].gd.u.boxelements = harray;</span>
<span class="lineNum">    2549 </span><span class="lineNoCov">          0 :     mboxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">    2550 </span><span class="lineNoCov">          0 :     varray[2] = &amp;mboxes[2];</span>
<span class="lineNum">    2551 </span><span class="lineNoCov">          0 :     varray[3] = NULL;</span>
<span class="lineNum">    2552 </span><span class="lineNoCov">          0 :     varray[4] = NULL;</span>
<span class="lineNum">    2553 </span>            : 
<span class="lineNum">    2554 </span><span class="lineNoCov">          0 :     mboxes[0].gd.pos.x = mboxes[0].gd.pos.y = 2;</span>
<span class="lineNum">    2555 </span><span class="lineNoCov">          0 :     mboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    2556 </span><span class="lineNoCov">          0 :     mboxes[0].gd.u.boxelements = varray;</span>
<span class="lineNum">    2557 </span><span class="lineNoCov">          0 :     mboxes[0].creator = GHVGroupCreate;</span>
<span class="lineNum">    2558 </span>            : 
<span class="lineNum">    2559 </span><span class="lineNoCov">          0 :     y = GDrawPointsToPixels(NULL,y+37);</span>
<span class="lineNum">    2560 </span><span class="lineNoCov">          0 :     gcd[0].gd.pos.height = y-4;</span>
<span class="lineNum">    2561 </span>            : 
<span class="lineNum">    2562 </span><span class="lineNoCov">          0 :     GGadgetsCreate(gw,mboxes);</span>
<span class="lineNum">    2563 </span><span class="lineNoCov">          0 :     GTextInfoListFree(mfgcd[0].gd.u.list);</span>
<span class="lineNum">    2564 </span><span class="lineNoCov">          0 :     GTextInfoListFree(msgcd[0].gd.u.list);</span>
<span class="lineNum">    2565 </span>            : 
<span class="lineNum">    2566 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(mboxes[0].ret,0);</span>
<span class="lineNum">    2567 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(mboxes[2].ret,gb_expandgluesame);</span>
<span class="lineNum">    2568 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(mfboxes[0].ret,0);</span>
<span class="lineNum">    2569 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(mfboxes[2].ret,gb_expandgluesame);</span>
<span class="lineNum">    2570 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(mpboxes[0].ret,0);</span>
<span class="lineNum">    2571 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(mpboxes[2].ret,gb_expandgluesame);</span>
<span class="lineNum">    2572 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(sboxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    2573 </span><span class="lineNoCov">          0 :     for ( k=0; k&lt;TOPICS; ++k )</span>
<span class="lineNum">    2574 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableRow(boxes[2*k].ret,gb_expandglue);</span>
<span class="lineNum">    2575 </span>            : 
<span class="lineNum">    2576 </span><span class="lineNoCov">          0 :     memset(&amp;rq,0,sizeof(rq));</span>
<span class="lineNum">    2577 </span><span class="lineNoCov">          0 :     rq.utf8_family_name = MONO_UI_FAMILIES;</span>
<span class="lineNum">    2578 </span><span class="lineNoCov">          0 :     rq.point_size = 12;</span>
<span class="lineNum">    2579 </span><span class="lineNoCov">          0 :     rq.weight = 400;</span>
<span class="lineNum">    2580 </span><span class="lineNoCov">          0 :     font = GDrawInstanciateFont(gw,&amp;rq);</span>
<span class="lineNum">    2581 </span><span class="lineNoCov">          0 :     GGadgetSetFont(mfgcd[0].ret,font);</span>
<span class="lineNum">    2582 </span><span class="lineNoCov">          0 :     GGadgetSetFont(msgcd[0].ret,font);</span>
<span class="lineNum">    2583 </span><span class="lineNoCov">          0 :     GHVBoxFitWindow(mboxes[0].ret);</span>
<span class="lineNum">    2584 </span>            : 
<span class="lineNum">    2585 </span><span class="lineNoCov">          0 :     for ( k=0; visible_prefs_list[k].tab_name!=0; ++k ) for ( gc=0,i=0; visible_prefs_list[k].pl[i].name!=NULL; ++i ) {</span>
<span class="lineNum">    2586 </span><span class="lineNoCov">          0 :         GGadgetCreateData *gcd = aspects[k].gcd[0].gd.u.boxelements[0];</span>
<span class="lineNum">    2587 </span><span class="lineNoCov">          0 :         pl = &amp;visible_prefs_list[k].pl[i];</span>
<span class="lineNum">    2588 </span><span class="lineNoCov">          0 :         if ( pl-&gt;dontdisplay )</span>
<span class="lineNum">    2589 </span><span class="lineNoCov">          0 :     continue;</span>
<span class="lineNum">    2590 </span><span class="lineNoCov">          0 :         switch ( pl-&gt;type ) {</span>
<span class="lineNum">    2591 </span>            :           case pr_bool:
<span class="lineNum">    2592 </span><span class="lineNoCov">          0 :             ++gc;</span>
<span class="lineNum">    2593 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    2594 </span>            :           case pr_encoding: {
<span class="lineNum">    2595 </span><span class="lineNoCov">          0 :             GGadget *g = gcd[gc+1].ret;</span>
<span class="lineNum">    2596 </span><span class="lineNoCov">          0 :             list = GGadgetGetList(g,&amp;llen);</span>
<span class="lineNum">    2597 </span><span class="lineNoCov">          0 :             for ( j=0; j&lt;llen ; ++j ) {</span>
<span class="lineNum">    2598 </span><span class="lineNoCov">          0 :                 if ( list[j]-&gt;text!=NULL &amp;&amp;</span>
<span class="lineNum">    2599 </span><span class="lineNoCov">          0 :                         (void *) (intpt) ( *((int *) pl-&gt;val)) == list[j]-&gt;userdata )</span>
<span class="lineNum">    2600 </span><span class="lineNoCov">          0 :                     list[j]-&gt;selected = true;</span>
<span class="lineNum">    2601 </span>            :                 else
<span class="lineNum">    2602 </span><span class="lineNoCov">          0 :                     list[j]-&gt;selected = false;</span>
<span class="lineNum">    2603 </span>            :             }
<span class="lineNum">    2604 </span><span class="lineNoCov">          0 :             if ( gcd[gc+1].gd.u.list!=encodingtypes )</span>
<span class="lineNum">    2605 </span><span class="lineNoCov">          0 :                 GTextInfoListFree(gcd[gc+1].gd.u.list);</span>
<span class="lineNum">    2606 </span><span class="lineNoCov">          0 :           } break;</span>
<span class="lineNum">    2607 </span>            :           case pr_namelist:
<span class="lineNum">    2608 </span><span class="lineNoCov">          0 :             free(gcd[gc+1].gd.u.list);</span>
<span class="lineNum">    2609 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    2610 </span>            :           case pr_string: case pr_file: case pr_int: case pr_real: case pr_unicode: case pr_angle:
<span class="lineNum">    2611 </span><span class="lineNoCov">          0 :             free(plabels[k][gc+1].text);</span>
<span class="lineNum">    2612 </span><span class="lineNoCov">          0 :             if ( pl-&gt;type==pr_file || pl-&gt;type==pr_angle )</span>
<span class="lineNum">    2613 </span><span class="lineNoCov">          0 :                 ++gc;</span>
<span class="lineNum">    2614 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    2615 </span>            :         }
<span class="lineNum">    2616 </span><span class="lineNoCov">          0 :         gc += 2;</span>
<span class="lineNum">    2617 </span>            :     }
<span class="lineNum">    2618 </span>            : 
<span class="lineNum">    2619 </span><span class="lineNoCov">          0 :     for ( k=0; visible_prefs_list[k].tab_name!=0; ++k ) {</span>
<span class="lineNum">    2620 </span><span class="lineNoCov">          0 :         free(aspects[k].gcd-&gt;gd.u.boxelements[0]);</span>
<span class="lineNum">    2621 </span><span class="lineNoCov">          0 :         free(aspects[k].gcd-&gt;gd.u.boxelements);</span>
<span class="lineNum">    2622 </span><span class="lineNoCov">          0 :         free(plabels[k]);</span>
<span class="lineNum">    2623 </span>            :     }
<span class="lineNum">    2624 </span>            : 
<span class="lineNum">    2625 </span><span class="lineNoCov">          0 :     GWidgetHidePalettes();</span>
<span class="lineNum">    2626 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<span class="lineNum">    2627 </span><span class="lineNoCov">          0 :     while ( !p.done )</span>
<span class="lineNum">    2628 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">    2629 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(gw);</span>
<a name="2630"><span class="lineNum">    2630 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2631 </span>            : 
<span class="lineNum">    2632 </span><span class="lineNoCov">          0 : void RecentFilesRemember(char *filename) {</span>
<span class="lineNum">    2633 </span>            :     int i,j;
<span class="lineNum">    2634 </span>            : 
<span class="lineNum">    2635 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;RECENT_MAX &amp;&amp; RecentFiles[i]!=NULL; ++i )</span>
<span class="lineNum">    2636 </span><span class="lineNoCov">          0 :         if ( strcmp(RecentFiles[i],filename)==0 )</span>
<span class="lineNum">    2637 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    2638 </span>            : 
<span class="lineNum">    2639 </span><span class="lineNoCov">          0 :     if ( i&lt;RECENT_MAX &amp;&amp; RecentFiles[i]!=NULL ) {</span>
<span class="lineNum">    2640 </span><span class="lineNoCov">          0 :         if ( i!=0 ) {</span>
<span class="lineNum">    2641 </span><span class="lineNoCov">          0 :             filename = RecentFiles[i];</span>
<span class="lineNum">    2642 </span><span class="lineNoCov">          0 :             for ( j=i; j&gt;0; --j )</span>
<span class="lineNum">    2643 </span><span class="lineNoCov">          0 :                 RecentFiles[j] = RecentFiles[j-1];</span>
<span class="lineNum">    2644 </span><span class="lineNoCov">          0 :             RecentFiles[0] = filename;</span>
<span class="lineNum">    2645 </span>            :         }
<span class="lineNum">    2646 </span>            :     } else {
<span class="lineNum">    2647 </span><span class="lineNoCov">          0 :         if ( RecentFiles[RECENT_MAX-1]!=NULL )</span>
<span class="lineNum">    2648 </span><span class="lineNoCov">          0 :             free( RecentFiles[RECENT_MAX-1]);</span>
<span class="lineNum">    2649 </span><span class="lineNoCov">          0 :         for ( i=RECENT_MAX-1; i&gt;0; --i )</span>
<span class="lineNum">    2650 </span><span class="lineNoCov">          0 :             RecentFiles[i] = RecentFiles[i-1];</span>
<span class="lineNum">    2651 </span><span class="lineNoCov">          0 :         RecentFiles[0] = copy(filename);</span>
<span class="lineNum">    2652 </span>            :     }
<span class="lineNum">    2653 </span>            : 
<span class="lineNum">    2654 </span><span class="lineNoCov">          0 :     PrefsUI_SavePrefs(true);</span>
<a name="2655"><span class="lineNum">    2655 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2656 </span>            : 
<span class="lineNum">    2657 </span><span class="lineNoCov">          0 : void LastFonts_Save(void) {</span>
<span class="lineNum">    2658 </span>            :     FontView *fv, *next;
<span class="lineNum">    2659 </span>            :     char buffer[1024];
<span class="lineNum">    2660 </span><span class="lineNoCov">          0 :     char *ffdir = getFontForgeUserDir(Config);</span>
<span class="lineNum">    2661 </span><span class="lineNoCov">          0 :     FILE *preserve = NULL;</span>
<span class="lineNum">    2662 </span>            : 
<span class="lineNum">    2663 </span><span class="lineNoCov">          0 :     if ( ffdir ) {</span>
<span class="lineNum">    2664 </span><span class="lineNoCov">          0 :         sprintf(buffer, &quot;%s/FontsOpenAtLastQuit&quot;, ffdir);</span>
<span class="lineNum">    2665 </span><span class="lineNoCov">          0 :         preserve = fopen(buffer,&quot;w&quot;);</span>
<span class="lineNum">    2666 </span><span class="lineNoCov">          0 :         free(ffdir);</span>
<span class="lineNum">    2667 </span>            :     }
<span class="lineNum">    2668 </span>            : 
<span class="lineNum">    2669 </span><span class="lineNoCov">          0 :     for ( fv = fv_list; fv!=NULL; fv = next ) {</span>
<span class="lineNum">    2670 </span><span class="lineNoCov">          0 :         next = (FontView *) (fv-&gt;b.next);</span>
<span class="lineNum">    2671 </span><span class="lineNoCov">          0 :         if ( preserve ) {</span>
<span class="lineNum">    2672 </span><span class="lineNoCov">          0 :             SplineFont *sf = fv-&gt;b.cidmaster?fv-&gt;b.cidmaster:fv-&gt;b.sf;</span>
<span class="lineNum">    2673 </span><span class="lineNoCov">          0 :             fprintf(preserve, &quot;%s\n&quot;, sf-&gt;filename?sf-&gt;filename:sf-&gt;origname);</span>
<span class="lineNum">    2674 </span>            :         }
<span class="lineNum">    2675 </span>            :     }
<span class="lineNum">    2676 </span>            : 
<span class="lineNum">    2677 </span><span class="lineNoCov">          0 :     if ( preserve )</span>
<span class="lineNum">    2678 </span><span class="lineNoCov">          0 :         fclose(preserve);</span>
<span class="lineNum">    2679 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2680 </span>            : 
<span class="lineNum">    2681 </span>            : struct prefs_interface gdraw_prefs_interface = {
<span class="lineNum">    2682 </span>            :     PrefsUI_SavePrefs,
<span class="lineNum">    2683 </span>            :     PrefsUI_LoadPrefs,
<span class="lineNum">    2684 </span>            :     PrefsUI_GetPrefs,
<span class="lineNum">    2685 </span>            :     PrefsUI_SetPrefs,
<span class="lineNum">    2686 </span>            :     PrefsUI_getFontForgeShareDir,
<span class="lineNum">    2687 </span>            :     PrefsUI_SetDefaults
<a name="2688"><span class="lineNum">    2688 </span>            : };</a>
<span class="lineNum">    2689 </span>            : 
<span class="lineNum">    2690 </span><span class="lineNoCov">          0 : static void change_res_filename(const char *newname) {</span>
<span class="lineNum">    2691 </span><span class="lineNoCov">          0 :     free(xdefs_filename);</span>
<span class="lineNum">    2692 </span><span class="lineNoCov">          0 :     xdefs_filename = copy( newname );</span>
<span class="lineNum">    2693 </span><span class="lineNoCov">          0 :     SavePrefs(true);</span>
<a name="2694"><span class="lineNum">    2694 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2695 </span>            : 
<span class="lineNum">    2696 </span><span class="lineNoCov">          0 : void DoXRes(void) {</span>
<span class="lineNum">    2697 </span>            :     extern GResInfo fontview_ri;
<span class="lineNum">    2698 </span>            : 
<span class="lineNum">    2699 </span><span class="lineNoCov">          0 :     MVColInit();</span>
<span class="lineNum">    2700 </span><span class="lineNoCov">          0 :     CVColInit();</span>
<span class="lineNum">    2701 </span><span class="lineNoCov">          0 :     GResEdit(&amp;fontview_ri,xdefs_filename,change_res_filename);</span>
<span class="lineNum">    2702 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2703 </span>            : 
<span class="lineNum">    2704 </span>            : struct prefs_list pointer_dialog_list[] = {
<span class="lineNum">    2705 </span>            :     { N_(&quot;ArrowMoveSize&quot;), pr_real, &amp;arrowAmount, NULL, NULL, '\0', NULL, 0, N_(&quot;The number of em-units by which an arrow key will move a selected point&quot;) },
<span class="lineNum">    2706 </span>            :     { N_(&quot;ArrowAccelFactor&quot;), pr_real, &amp;arrowAccelFactor, NULL, NULL, '\0', NULL, 0, N_(&quot;Holding down the Shift key will speed up arrow key motion by this factor&quot;) },
<span class="lineNum">    2707 </span>            :     { N_(&quot;InterpolateCPsOnMotion&quot;), pr_bool, &amp;interpCPsOnMotion, NULL, NULL, '\0', NULL, 0, N_(&quot;When moving one end point of a spline but not the other\ninterpolate the control points between the two.&quot;) },
<span class="lineNum">    2708 </span>            :     PREFS_LIST_EMPTY
<span class="lineNum">    2709 </span>            : };
<span class="lineNum">    2710 </span>            : 
<span class="lineNum">    2711 </span>            : struct prefs_list ruler_dialog_list[] = {
<span class="lineNum">    2712 </span>            :         { N_(&quot;SnapDistanceMeasureTool&quot;), pr_real, &amp;snapdistancemeasuretool, NULL, NULL, '\0', NULL, 0, N_(&quot;When the measure tool is active and when the mouse pointer is within this many pixels\nof one of the various interesting features (baseline,\nwidth, grid splines, etc.) the pointer will snap\nto that feature.&quot;) },
<span class="lineNum">    2713 </span>            :         { N_(&quot;MeasureToolShowHorizontalVertical&quot;), pr_bool, &amp;measuretoolshowhorizontolvertical, NULL, NULL, '\0', NULL, 0, N_(&quot;Have the measure tool show horizontal and vertical distances on the canvas.&quot;) },
<span class="lineNum">    2714 </span>            :     PREFS_LIST_EMPTY
<a name="2715"><span class="lineNum">    2715 </span>            : };</a>
<span class="lineNum">    2716 </span>            : 
<span class="lineNum">    2717 </span><span class="lineNoCov">          0 : static int PrefsSubSet_Ok(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2718 </span><span class="lineNoCov">          0 :     GWindow gw = GGadgetGetWindow(g);</span>
<span class="lineNum">    2719 </span><span class="lineNoCov">          0 :     struct pref_data *p = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2720 </span><span class="lineNoCov">          0 :     struct prefs_list* plist = p-&gt;plist;</span>
<span class="lineNum">    2721 </span><span class="lineNoCov">          0 :     struct prefs_list* pl = plist;</span>
<span class="lineNum">    2722 </span><span class="lineNoCov">          0 :     int i=0,j=0;</span>
<span class="lineNum">    2723 </span><span class="lineNoCov">          0 :     int err=0, enc;</span>
<span class="lineNum">    2724 </span>            :     const unichar_t *ret;
<span class="lineNum">    2725 </span>            : 
<span class="lineNum">    2726 </span><span class="lineNoCov">          0 :     p-&gt;done = true;</span>
<span class="lineNum">    2727 </span>            : 
<span class="lineNum">    2728 </span><span class="lineNoCov">          0 :     for ( i=0, pl=plist; pl-&gt;name; ++i, ++pl ) {</span>
<span class="lineNum">    2729 </span><span class="lineNoCov">          0 :         switch( pl-&gt;type ) {</span>
<span class="lineNum">    2730 </span>            :         case pr_int:
<span class="lineNum">    2731 </span><span class="lineNoCov">          0 :             *((int *) (pl-&gt;val)) = GetInt8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err);</span>
<span class="lineNum">    2732 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2733 </span>            :         case pr_unicode:
<span class="lineNum">    2734 </span><span class="lineNoCov">          0 :             *((int *) (pl-&gt;val)) = GetUnicodeChar8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err);</span>
<span class="lineNum">    2735 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2736 </span>            :         case pr_bool:
<span class="lineNum">    2737 </span><span class="lineNoCov">          0 :             *((int *) (pl-&gt;val)) = GGadgetIsChecked(GWidgetGetControl(gw,j*CID_PrefsOffset+CID_PrefsBase+i));</span>
<span class="lineNum">    2738 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2739 </span>            :         case pr_real:
<span class="lineNum">    2740 </span><span class="lineNoCov">          0 :             *((float *) (pl-&gt;val)) = GetReal8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err);</span>
<span class="lineNum">    2741 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2742 </span>            :         case pr_encoding:
<span class="lineNum">    2743 </span>            :         { Encoding *e;
<span class="lineNum">    2744 </span><span class="lineNoCov">          0 :                 e = ParseEncodingNameFromList(GWidgetGetControl(gw,j*CID_PrefsOffset+CID_PrefsBase+i));</span>
<span class="lineNum">    2745 </span><span class="lineNoCov">          0 :                 if ( e!=NULL )</span>
<span class="lineNum">    2746 </span><span class="lineNoCov">          0 :                     *((Encoding **) (pl-&gt;val)) = e;</span>
<span class="lineNum">    2747 </span><span class="lineNoCov">          0 :                 enc = 1;        /* So gcc doesn't complain about unused. It is unused, but why add the ifdef and make the code even messier? Sigh. icc complains anyway */</span>
<span class="lineNum">    2748 </span>            :         }
<span class="lineNum">    2749 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2750 </span>            :         case pr_namelist:
<span class="lineNum">    2751 </span>            :         { NameList *nl;
<span class="lineNum">    2752 </span><span class="lineNoCov">          0 :             GTextInfo *ti = GGadgetGetListItemSelected(GWidgetGetControl(gw,j*CID_PrefsOffset+CID_PrefsBase+i));</span>
<span class="lineNum">    2753 </span><span class="lineNoCov">          0 :             if ( ti!=NULL ) {</span>
<span class="lineNum">    2754 </span><span class="lineNoCov">          0 :                 char *name = u2utf8_copy(ti-&gt;text);</span>
<span class="lineNum">    2755 </span><span class="lineNoCov">          0 :                 nl = NameListByName(name);</span>
<span class="lineNum">    2756 </span><span class="lineNoCov">          0 :                 free(name);</span>
<span class="lineNum">    2757 </span><span class="lineNoCov">          0 :                 if ( nl!=NULL &amp;&amp; nl-&gt;uses_unicode &amp;&amp; !allow_utf8_glyphnames)</span>
<span class="lineNum">    2758 </span><span class="lineNoCov">          0 :                     ff_post_error(_(&quot;Namelist contains non-ASCII names&quot;),_(&quot;Glyph names should be limited to characters in the ASCII character set, but there are names in this namelist which use characters outside that range.&quot;));</span>
<span class="lineNum">    2759 </span><span class="lineNoCov">          0 :                 else if ( nl!=NULL )</span>
<span class="lineNum">    2760 </span><span class="lineNoCov">          0 :                     *((NameList **) (pl-&gt;val)) = nl;</span>
<span class="lineNum">    2761 </span>            :             }
<span class="lineNum">    2762 </span>            :         }
<span class="lineNum">    2763 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2764 </span>            :         case pr_string: case pr_file:
<span class="lineNum">    2765 </span><span class="lineNoCov">          0 :             ret = _GGadgetGetTitle(GWidgetGetControl(gw,j*CID_PrefsOffset+CID_PrefsBase+i));</span>
<span class="lineNum">    2766 </span><span class="lineNoCov">          0 :             if ( pl-&gt;val!=NULL ) {</span>
<span class="lineNum">    2767 </span><span class="lineNoCov">          0 :                 free( *((char **) (pl-&gt;val)) );</span>
<span class="lineNum">    2768 </span><span class="lineNoCov">          0 :                 *((char **) (pl-&gt;val)) = NULL;</span>
<span class="lineNum">    2769 </span><span class="lineNoCov">          0 :                 if ( ret!=NULL &amp;&amp; *ret!='\0' )</span>
<span class="lineNum">    2770 </span><span class="lineNoCov">          0 :                     *((char **) (pl-&gt;val)) = /* u2def_*/ cu_copy(ret);</span>
<span class="lineNum">    2771 </span>            :             } else {
<span class="lineNum">    2772 </span><span class="lineNoCov">          0 :                 char *cret = cu_copy(ret);</span>
<span class="lineNum">    2773 </span><span class="lineNoCov">          0 :                 (pl-&gt;set)(cret);</span>
<span class="lineNum">    2774 </span><span class="lineNoCov">          0 :                 free(cret);</span>
<span class="lineNum">    2775 </span>            :             }
<span class="lineNum">    2776 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2777 </span>            :         case pr_angle:
<span class="lineNum">    2778 </span><span class="lineNoCov">          0 :             *((float *) (pl-&gt;val)) = GetReal8(gw,j*CID_PrefsOffset+CID_PrefsBase+i,pl-&gt;name,&amp;err)/RAD2DEG;</span>
<span class="lineNum">    2779 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2780 </span>            :         }
<span class="lineNum">    2781 </span>            :     }
<span class="lineNum">    2782 </span>            : 
<span class="lineNum">    2783 </span><span class="lineNoCov">          0 :     return( true );</span>
<a name="2784"><span class="lineNum">    2784 </span>            : }</a>
<span class="lineNum">    2785 </span>            : 
<span class="lineNum">    2786 </span><span class="lineNoCov">          0 : static void PrefsSubSetDlg(CharView *cv,char* windowTitle,struct prefs_list* plist) {</span>
<span class="lineNum">    2787 </span><span class="lineNoCov">          0 :     struct prefs_list* pl = plist;</span>
<span class="lineNum">    2788 </span>            :     GRect pos;
<span class="lineNum">    2789 </span>            :     GWindow gw;
<span class="lineNum">    2790 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    2791 </span>            :     GGadgetCreateData *pgcd, gcd[20], sgcd[45], mgcd[3], mfgcd[9], msgcd[9];
<span class="lineNum">    2792 </span>            :     GGadgetCreateData mfboxes[3], *mfarray[14];
<span class="lineNum">    2793 </span>            :     GGadgetCreateData mpboxes[3];
<span class="lineNum">    2794 </span>            :     GGadgetCreateData sboxes[2];
<span class="lineNum">    2795 </span>            :     GGadgetCreateData mboxes[3], mboxes2[5], *varray[5], *harray[8];
<span class="lineNum">    2796 </span>            :     GTextInfo *plabel, label[20], slabel[45], mflabels[9], mslabels[9];
<span class="lineNum">    2797 </span>            :     GTabInfo aspects[TOPICS+5], subaspects[3];
<span class="lineNum">    2798 </span>            :     GGadgetCreateData **hvarray, boxes[2*TOPICS];
<span class="lineNum">    2799 </span>            :     struct pref_data p;
<span class="lineNum">    2800 </span><span class="lineNoCov">          0 :     int line = 0,line_max = 3;</span>
<span class="lineNum">    2801 </span><span class="lineNoCov">          0 :     int i = 0, gc = 0, ii, y=0, si=0, k=0;</span>
<span class="lineNum">    2802 </span>            :     char buf[20];
<span class="lineNum">    2803 </span>            :     char *tempstr;
<span class="lineNum">    2804 </span>            : 
<span class="lineNum">    2805 </span><span class="lineNoCov">          0 :     PrefsInit();</span>
<span class="lineNum">    2806 </span><span class="lineNoCov">          0 :     MfArgsInit();</span>
<span class="lineNum">    2807 </span>            : 
<span class="lineNum">    2808 </span><span class="lineNoCov">          0 :     line_max=0;</span>
<span class="lineNum">    2809 </span><span class="lineNoCov">          0 :     for ( i=0, pl=plist; pl-&gt;name; ++i, ++pl ) {</span>
<span class="lineNum">    2810 </span><span class="lineNoCov">          0 :             ++line_max;</span>
<span class="lineNum">    2811 </span>            :     }
<span class="lineNum">    2812 </span>            : 
<span class="lineNum">    2813 </span><span class="lineNoCov">          0 :     int itemCount = 100;</span>
<span class="lineNum">    2814 </span><span class="lineNoCov">          0 :     pgcd = calloc(itemCount,sizeof(GGadgetCreateData));</span>
<span class="lineNum">    2815 </span><span class="lineNoCov">          0 :     plabel = calloc(itemCount,sizeof(GTextInfo));</span>
<span class="lineNum">    2816 </span><span class="lineNoCov">          0 :     hvarray = calloc((itemCount)*5,sizeof(GGadgetCreateData *));</span>
<span class="lineNum">    2817 </span><span class="lineNoCov">          0 :     memset(&amp;p,'\0',sizeof(p));</span>
<span class="lineNum">    2818 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    2819 </span><span class="lineNoCov">          0 :     memset(sgcd,0,sizeof(sgcd));</span>
<span class="lineNum">    2820 </span><span class="lineNoCov">          0 :     memset(slabel,0,sizeof(slabel));</span>
<span class="lineNum">    2821 </span><span class="lineNoCov">          0 :     memset(&amp;mfgcd,0,sizeof(mfgcd));</span>
<span class="lineNum">    2822 </span><span class="lineNoCov">          0 :     memset(&amp;msgcd,0,sizeof(msgcd));</span>
<span class="lineNum">    2823 </span><span class="lineNoCov">          0 :     memset(&amp;mflabels,0,sizeof(mflabels));</span>
<span class="lineNum">    2824 </span><span class="lineNoCov">          0 :     memset(&amp;mslabels,0,sizeof(mslabels));</span>
<span class="lineNum">    2825 </span><span class="lineNoCov">          0 :     memset(&amp;mfboxes,0,sizeof(mfboxes));</span>
<span class="lineNum">    2826 </span><span class="lineNoCov">          0 :     memset(&amp;mpboxes,0,sizeof(mpboxes));</span>
<span class="lineNum">    2827 </span><span class="lineNoCov">          0 :     memset(&amp;sboxes,0,sizeof(sboxes));</span>
<span class="lineNum">    2828 </span><span class="lineNoCov">          0 :     memset(&amp;boxes,0,sizeof(boxes));</span>
<span class="lineNum">    2829 </span><span class="lineNoCov">          0 :     memset(&amp;mgcd,0,sizeof(mgcd));</span>
<span class="lineNum">    2830 </span><span class="lineNoCov">          0 :     memset(&amp;mgcd,0,sizeof(mgcd));</span>
<span class="lineNum">    2831 </span><span class="lineNoCov">          0 :     memset(&amp;subaspects,'\0',sizeof(subaspects));</span>
<span class="lineNum">    2832 </span><span class="lineNoCov">          0 :     memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">    2833 </span><span class="lineNoCov">          0 :     memset(&amp;gcd,0,sizeof(gcd));</span>
<span class="lineNum">    2834 </span><span class="lineNoCov">          0 :     memset(&amp;aspects,'\0',sizeof(aspects));</span>
<span class="lineNum">    2835 </span><span class="lineNoCov">          0 :     GCDFillMacFeat(mfgcd,mflabels,250,default_mac_feature_map, true, mfboxes, mfarray);</span>
<span class="lineNum">    2836 </span>            : 
<span class="lineNum">    2837 </span><span class="lineNoCov">          0 :     p.plist = plist;</span>
<span class="lineNum">    2838 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_restrict|wam_isdlg;</span>
<span class="lineNum">    2839 </span><span class="lineNoCov">          0 :     wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">    2840 </span><span class="lineNoCov">          0 :     wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">    2841 </span><span class="lineNoCov">          0 :     wattrs.is_dlg = 1;</span>
<span class="lineNum">    2842 </span><span class="lineNoCov">          0 :     wattrs.undercursor = 1;</span>
<span class="lineNum">    2843 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_pointer;</span>
<span class="lineNum">    2844 </span><span class="lineNoCov">          0 :     wattrs.utf8_window_title = windowTitle;</span>
<span class="lineNum">    2845 </span><span class="lineNoCov">          0 :     pos.x = pos.y = 0;</span>
<span class="lineNum">    2846 </span><span class="lineNoCov">          0 :     pos.width = GGadgetScale(GDrawPointsToPixels(NULL,340));</span>
<span class="lineNum">    2847 </span><span class="lineNoCov">          0 :     pos.height = GDrawPointsToPixels(NULL,line_max*26+25);</span>
<span class="lineNum">    2848 </span><span class="lineNoCov">          0 :     gw = GDrawCreateTopWindow(NULL,&amp;pos,e_h,&amp;p,&amp;wattrs);</span>
<span class="lineNum">    2849 </span>            : 
<span class="lineNum">    2850 </span>            : 
<span class="lineNum">    2851 </span>            : 
<span class="lineNum">    2852 </span><span class="lineNoCov">          0 :     for ( i=0, pl=plist; pl-&gt;name; ++i, ++pl ) {</span>
<span class="lineNum">    2853 </span>            : 
<span class="lineNum">    2854 </span><span class="lineNoCov">          0 :             plabel[gc].text = (unichar_t *) _(pl-&gt;name);</span>
<span class="lineNum">    2855 </span><span class="lineNoCov">          0 :             plabel[gc].text_is_1byte = true;</span>
<span class="lineNum">    2856 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.label = &amp;plabel[gc];</span>
<span class="lineNum">    2857 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.mnemonic = '\0';</span>
<span class="lineNum">    2858 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.popup_msg = (unichar_t *) 0;//_(pl-&gt;popup);</span>
<span class="lineNum">    2859 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.pos.x = 8;</span>
<span class="lineNum">    2860 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.pos.y = y + 6;</span>
<span class="lineNum">    2861 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    2862 </span><span class="lineNoCov">          0 :             pgcd[gc++].creator = GLabelCreate;</span>
<span class="lineNum">    2863 </span><span class="lineNoCov">          0 :             hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2864 </span>            : 
<span class="lineNum">    2865 </span><span class="lineNoCov">          0 :             plabel[gc].text_is_1byte = true;</span>
<span class="lineNum">    2866 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.label = &amp;plabel[gc];</span>
<span class="lineNum">    2867 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.mnemonic = '\0';</span>
<span class="lineNum">    2868 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.popup_msg = (unichar_t *) 0;//_(pl-&gt;popup);</span>
<span class="lineNum">    2869 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.pos.x = 110;</span>
<span class="lineNum">    2870 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.pos.y = y;</span>
<span class="lineNum">    2871 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    2872 </span><span class="lineNoCov">          0 :             pgcd[gc].data = pl;</span>
<span class="lineNum">    2873 </span><span class="lineNoCov">          0 :             pgcd[gc].gd.cid = k*CID_PrefsOffset+CID_PrefsBase+i;</span>
<span class="lineNum">    2874 </span><span class="lineNoCov">          0 :             switch ( pl-&gt;type ) {</span>
<span class="lineNum">    2875 </span>            :               case pr_bool:
<span class="lineNum">    2876 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) _(&quot;On&quot;);</span>
<span class="lineNum">    2877 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.y += 3;</span>
<span class="lineNum">    2878 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GRadioCreate;</span>
<span class="lineNum">    2879 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2880 </span><span class="lineNoCov">          0 :                 pgcd[gc] = pgcd[gc-1];</span>
<span class="lineNum">    2881 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.x += 50;</span>
<span class="lineNum">    2882 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.cid = 0;</span>
<span class="lineNum">    2883 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.label = &amp;plabel[gc];</span>
<span class="lineNum">    2884 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) _(&quot;Off&quot;);</span>
<span class="lineNum">    2885 </span><span class="lineNoCov">          0 :                 plabel[gc].text_is_1byte = true;</span>
<span class="lineNum">    2886 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc];</span>
<span class="lineNum">    2887 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2888 </span><span class="lineNoCov">          0 :                 if ( *((int *) pl-&gt;val))</span>
<span class="lineNum">    2889 </span><span class="lineNoCov">          0 :                     pgcd[gc-1].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    2890 </span>            :                 else
<span class="lineNum">    2891 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    2892 </span><span class="lineNoCov">          0 :                 ++gc;</span>
<span class="lineNum">    2893 </span><span class="lineNoCov">          0 :                 y += 22;</span>
<span class="lineNum">    2894 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2895 </span>            :               case pr_int:
<span class="lineNum">    2896 </span><span class="lineNoCov">          0 :                 sprintf(buf,&quot;%d&quot;, *((int *) pl-&gt;val));</span>
<span class="lineNum">    2897 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) copy( buf );</span>
<span class="lineNum">    2898 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2899 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2900 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_Glue; hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2901 </span><span class="lineNoCov">          0 :                 y += 26;</span>
<span class="lineNum">    2902 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2903 </span>            :               case pr_unicode:
<span class="lineNum">    2904 </span>            :                 /*sprintf(buf,&quot;U+%04x&quot;, *((int *) pl-&gt;val));*/
<span class="lineNum">    2905 </span><span class="lineNoCov">          0 :                 { char *pt; pt=buf; pt=utf8_idpb(pt,*((int *)pl-&gt;val),UTF8IDPB_NOZERO); *pt='\0'; }</span>
<span class="lineNum">    2906 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) copy( buf );</span>
<span class="lineNum">    2907 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2908 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2909 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_Glue; hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2910 </span><span class="lineNoCov">          0 :                 y += 26;</span>
<span class="lineNum">    2911 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2912 </span>            :               case pr_real:
<span class="lineNum">    2913 </span><span class="lineNoCov">          0 :                 sprintf(buf,&quot;%g&quot;, *((float *) pl-&gt;val));</span>
<span class="lineNum">    2914 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) copy( buf );</span>
<span class="lineNum">    2915 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2916 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2917 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_Glue; hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2918 </span><span class="lineNoCov">          0 :                 y += 26;</span>
<span class="lineNum">    2919 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2920 </span>            :               case pr_encoding:
<span class="lineNum">    2921 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.u.list = GetEncodingTypes();</span>
<span class="lineNum">    2922 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.label = EncodingTypesFindEnc(pgcd[gc].gd.u.list,</span>
<span class="lineNum">    2923 </span><span class="lineNoCov">          0 :                         *(Encoding **) pl-&gt;val);</span>
<span class="lineNum">    2924 </span><span class="lineNoCov">          0 :                 for ( ii=0; pgcd[gc].gd.u.list[ii].text!=NULL ||pgcd[gc].gd.u.list[ii].line; ++ii )</span>
<span class="lineNum">    2925 </span><span class="lineNoCov">          0 :                     if ( pgcd[gc].gd.u.list[ii].userdata!=NULL &amp;&amp;</span>
<span class="lineNum">    2926 </span><span class="lineNoCov">          0 :                             (strcmp(pgcd[gc].gd.u.list[ii].userdata,&quot;Compacted&quot;)==0 ||</span>
<span class="lineNum">    2927 </span><span class="lineNoCov">          0 :                              strcmp(pgcd[gc].gd.u.list[ii].userdata,&quot;Original&quot;)==0 ))</span>
<span class="lineNum">    2928 </span><span class="lineNoCov">          0 :                         pgcd[gc].gd.u.list[ii].disabled = true;</span>
<span class="lineNum">    2929 </span><span class="lineNoCov">          0 :                 pgcd[gc].creator = GListFieldCreate;</span>
<span class="lineNum">    2930 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.width = 160;</span>
<span class="lineNum">    2931 </span><span class="lineNoCov">          0 :                 if ( pgcd[gc].gd.label==NULL ) pgcd[gc].gd.label = &amp;encodingtypes[0];</span>
<span class="lineNum">    2932 </span><span class="lineNoCov">          0 :                 ++gc;</span>
<span class="lineNum">    2933 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2934 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_ColSpan; hvarray[si++] = GCD_ColSpan;</span>
<span class="lineNum">    2935 </span><span class="lineNoCov">          0 :                 y += 28;</span>
<span class="lineNum">    2936 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2937 </span>            :               case pr_namelist:
<span class="lineNum">    2938 </span><span class="lineNoCov">          0 :                 { char **nlnames = AllNamelistNames();</span>
<span class="lineNum">    2939 </span>            :                 int cnt;
<span class="lineNum">    2940 </span>            :                 GTextInfo *namelistnames;
<span class="lineNum">    2941 </span><span class="lineNoCov">          0 :                 for ( cnt=0; nlnames[cnt]!=NULL; ++cnt);</span>
<span class="lineNum">    2942 </span><span class="lineNoCov">          0 :                 namelistnames = calloc(cnt+1,sizeof(GTextInfo));</span>
<span class="lineNum">    2943 </span><span class="lineNoCov">          0 :                 for ( cnt=0; nlnames[cnt]!=NULL; ++cnt) {</span>
<span class="lineNum">    2944 </span><span class="lineNoCov">          0 :                     namelistnames[cnt].text = (unichar_t *) nlnames[cnt];</span>
<span class="lineNum">    2945 </span><span class="lineNoCov">          0 :                     namelistnames[cnt].text_is_1byte = true;</span>
<span class="lineNum">    2946 </span><span class="lineNoCov">          0 :                     if ( strcmp(_((*(NameList **) (pl-&gt;val))-&gt;title),nlnames[cnt])==0 ) {</span>
<span class="lineNum">    2947 </span><span class="lineNoCov">          0 :                         namelistnames[cnt].selected = true;</span>
<span class="lineNum">    2948 </span><span class="lineNoCov">          0 :                         pgcd[gc].gd.label = &amp;namelistnames[cnt];</span>
<span class="lineNum">    2949 </span>            :                     }
<span class="lineNum">    2950 </span>            :                 }
<span class="lineNum">    2951 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.u.list = namelistnames;</span>
<span class="lineNum">    2952 </span><span class="lineNoCov">          0 :                 pgcd[gc].creator = GListButtonCreate;</span>
<span class="lineNum">    2953 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.width = 160;</span>
<span class="lineNum">    2954 </span><span class="lineNoCov">          0 :                 ++gc;</span>
<span class="lineNum">    2955 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2956 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_ColSpan; hvarray[si++] = GCD_ColSpan;</span>
<span class="lineNum">    2957 </span><span class="lineNoCov">          0 :                 y += 28;</span>
<span class="lineNum">    2958 </span><span class="lineNoCov">          0 :               } break;</span>
<span class="lineNum">    2959 </span>            :               case pr_string: case pr_file:
<span class="lineNum">    2960 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;set==SetAutoTraceArgs || ((char **) pl-&gt;val)==&amp;mf_args )</span>
<span class="lineNum">    2961 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.pos.width = 160;</span>
<span class="lineNum">    2962 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;val!=NULL )</span>
<span class="lineNum">    2963 </span><span class="lineNoCov">          0 :                     tempstr = *((char **) (pl-&gt;val));</span>
<span class="lineNum">    2964 </span>            :                 else
<span class="lineNum">    2965 </span><span class="lineNoCov">          0 :                     tempstr = (char *) ((pl-&gt;get)());</span>
<span class="lineNum">    2966 </span><span class="lineNoCov">          0 :                 if ( tempstr!=NULL )</span>
<span class="lineNum">    2967 </span><span class="lineNoCov">          0 :                     plabel[gc].text = /* def2u_*/ uc_copy( tempstr );</span>
<span class="lineNum">    2968 </span><span class="lineNoCov">          0 :                 else if ( ((char **) pl-&gt;val)==&amp;BDFFoundry )</span>
<span class="lineNum">    2969 </span><span class="lineNoCov">          0 :                     plabel[gc].text = /* def2u_*/ uc_copy( &quot;FontForge&quot; );</span>
<span class="lineNum">    2970 </span>            :                 else
<span class="lineNum">    2971 </span><span class="lineNoCov">          0 :                     plabel[gc].text = /* def2u_*/ uc_copy( &quot;&quot; );</span>
<span class="lineNum">    2972 </span><span class="lineNoCov">          0 :                 plabel[gc].text_is_1byte = false;</span>
<span class="lineNum">    2973 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2974 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2975 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;type==pr_file ) {</span>
<span class="lineNum">    2976 </span><span class="lineNoCov">          0 :                     pgcd[gc] = pgcd[gc-1];</span>
<span class="lineNum">    2977 </span><span class="lineNoCov">          0 :                     pgcd[gc-1].gd.pos.width = 140;</span>
<span class="lineNum">    2978 </span><span class="lineNoCov">          0 :                     hvarray[si++] = GCD_ColSpan;</span>
<span class="lineNum">    2979 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.pos.x += 145;</span>
<span class="lineNum">    2980 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.cid += CID_PrefsBrowseOffset;</span>
<span class="lineNum">    2981 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.label = &amp;plabel[gc];</span>
<span class="lineNum">    2982 </span><span class="lineNoCov">          0 :                     plabel[gc].text = (unichar_t *) &quot;...&quot;;</span>
<span class="lineNum">    2983 </span><span class="lineNoCov">          0 :                     plabel[gc].text_is_1byte = true;</span>
<span class="lineNum">    2984 </span><span class="lineNoCov">          0 :                     pgcd[gc].gd.handle_controlevent = Prefs_BrowseFile;</span>
<span class="lineNum">    2985 </span><span class="lineNoCov">          0 :                     pgcd[gc++].creator = GButtonCreate;</span>
<span class="lineNum">    2986 </span><span class="lineNoCov">          0 :                     hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    2987 </span><span class="lineNoCov">          0 :                 } else if ( pl-&gt;set==SetAutoTraceArgs || ((char **) pl-&gt;val)==&amp;mf_args ) {</span>
<span class="lineNum">    2988 </span><span class="lineNoCov">          0 :                     hvarray[si++] = GCD_ColSpan;</span>
<span class="lineNum">    2989 </span><span class="lineNoCov">          0 :                     hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2990 </span>            :                 } else {
<span class="lineNum">    2991 </span><span class="lineNoCov">          0 :                     hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2992 </span><span class="lineNoCov">          0 :                     hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    2993 </span>            :                 }
<span class="lineNum">    2994 </span><span class="lineNoCov">          0 :                 y += 26;</span>
<span class="lineNum">    2995 </span><span class="lineNoCov">          0 :                 if ( pl-&gt;val==NULL )</span>
<span class="lineNum">    2996 </span><span class="lineNoCov">          0 :                     free(tempstr);</span>
<span class="lineNum">    2997 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    2998 </span>            :               case pr_angle:
<span class="lineNum">    2999 </span><span class="lineNoCov">          0 :                 sprintf(buf,&quot;%g&quot;, *((float *) pl-&gt;val) * RAD2DEG);</span>
<span class="lineNum">    3000 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) copy( buf );</span>
<span class="lineNum">    3001 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GTextFieldCreate;</span>
<span class="lineNum">    3002 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    3003 </span><span class="lineNoCov">          0 :                 plabel[gc].text = (unichar_t *) U_(&quot;°&quot;);</span>
<span class="lineNum">    3004 </span><span class="lineNoCov">          0 :                 plabel[gc].text_is_1byte = true;</span>
<span class="lineNum">    3005 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.label = &amp;plabel[gc];</span>
<span class="lineNum">    3006 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.pos.x = pgcd[gc-1].gd.pos.x+gcd[gc-1].gd.pos.width+2; pgcd[gc].gd.pos.y = pgcd[gc-1].gd.pos.y;</span>
<span class="lineNum">    3007 </span><span class="lineNoCov">          0 :                 pgcd[gc].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3008 </span><span class="lineNoCov">          0 :                 pgcd[gc++].creator = GLabelCreate;</span>
<span class="lineNum">    3009 </span><span class="lineNoCov">          0 :                 hvarray[si++] = &amp;pgcd[gc-1];</span>
<span class="lineNum">    3010 </span><span class="lineNoCov">          0 :                 hvarray[si++] = GCD_Glue;</span>
<span class="lineNum">    3011 </span><span class="lineNoCov">          0 :                 y += 26;</span>
<span class="lineNum">    3012 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    3013 </span>            :             }
<span class="lineNum">    3014 </span><span class="lineNoCov">          0 :             ++line;</span>
<span class="lineNum">    3015 </span><span class="lineNoCov">          0 :             hvarray[si++] = NULL;</span>
<span class="lineNum">    3016 </span>            : 
<span class="lineNum">    3017 </span>            :     }
<span class="lineNum">    3018 </span>            : 
<span class="lineNum">    3019 </span><span class="lineNoCov">          0 :     harray[4] = 0;</span>
<span class="lineNum">    3020 </span><span class="lineNoCov">          0 :     harray[5] = 0;</span>
<span class="lineNum">    3021 </span><span class="lineNoCov">          0 :     harray[6] = 0;</span>
<span class="lineNum">    3022 </span><span class="lineNoCov">          0 :     harray[7] = 0;</span>
<span class="lineNum">    3023 </span>            : 
<span class="lineNum">    3024 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.x = 30-3;</span>
<span class="lineNum">    3025 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.y = y+5-3;</span>
<span class="lineNum">    3026 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.width = -1;</span>
<span class="lineNum">    3027 </span><span class="lineNoCov">          0 :     gcd[gc].gd.pos.height = 0;</span>
<span class="lineNum">    3028 </span><span class="lineNoCov">          0 :     gcd[gc].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">    3029 </span><span class="lineNoCov">          0 :     label[gc].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">    3030 </span><span class="lineNoCov">          0 :     label[gc].text_is_1byte = true;</span>
<span class="lineNum">    3031 </span><span class="lineNoCov">          0 :     label[gc].text_in_resource = true;</span>
<span class="lineNum">    3032 </span><span class="lineNoCov">          0 :     gcd[gc].gd.mnemonic = 'O';</span>
<span class="lineNum">    3033 </span><span class="lineNoCov">          0 :     gcd[gc].gd.label = &amp;label[gc];</span>
<span class="lineNum">    3034 </span><span class="lineNoCov">          0 :     gcd[gc].gd.handle_controlevent = PrefsSubSet_Ok;</span>
<span class="lineNum">    3035 </span><span class="lineNoCov">          0 :     gcd[gc++].creator = GButtonCreate;</span>
<span class="lineNum">    3036 </span><span class="lineNoCov">          0 :     harray[0] = GCD_Glue; harray[1] = &amp;gcd[gc-1]; harray[2] = GCD_Glue; harray[3] = GCD_Glue;</span>
<span class="lineNum">    3037 </span>            : 
<span class="lineNum">    3038 </span>            : 
<span class="lineNum">    3039 </span><span class="lineNoCov">          0 :     memset(mboxes,0,sizeof(mboxes));</span>
<span class="lineNum">    3040 </span><span class="lineNoCov">          0 :     memset(mboxes2,0,sizeof(mboxes2));</span>
<span class="lineNum">    3041 </span>            : 
<span class="lineNum">    3042 </span><span class="lineNoCov">          0 :     mboxes[2].gd.pos.x = 2;</span>
<span class="lineNum">    3043 </span><span class="lineNoCov">          0 :     mboxes[2].gd.pos.y = 20;</span>
<span class="lineNum">    3044 </span><span class="lineNoCov">          0 :     mboxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3045 </span><span class="lineNoCov">          0 :     mboxes[2].gd.u.boxelements = harray;</span>
<span class="lineNum">    3046 </span><span class="lineNoCov">          0 :     mboxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">    3047 </span>            : 
<span class="lineNum">    3048 </span><span class="lineNoCov">          0 :     mboxes[0].gd.pos.x = mboxes[0].gd.pos.y = 2;</span>
<span class="lineNum">    3049 </span><span class="lineNoCov">          0 :     mboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3050 </span><span class="lineNoCov">          0 :     mboxes[0].gd.u.boxelements = hvarray;</span>
<span class="lineNum">    3051 </span><span class="lineNoCov">          0 :     mboxes[0].creator = GHVGroupCreate;</span>
<span class="lineNum">    3052 </span>            : 
<span class="lineNum">    3053 </span><span class="lineNoCov">          0 :     varray[0] = &amp;mboxes[0];</span>
<span class="lineNum">    3054 </span><span class="lineNoCov">          0 :     varray[1] = &amp;mboxes[2];</span>
<span class="lineNum">    3055 </span><span class="lineNoCov">          0 :     varray[2] = 0;</span>
<span class="lineNum">    3056 </span><span class="lineNoCov">          0 :     varray[3] = 0;</span>
<span class="lineNum">    3057 </span><span class="lineNoCov">          0 :     varray[4] = 0;</span>
<span class="lineNum">    3058 </span>            : 
<span class="lineNum">    3059 </span>            :     /* varray[0] = &amp;mboxes[2]; */
<span class="lineNum">    3060 </span>            :     /* varray[1] = 0;//&amp;mboxes[2]; */
<span class="lineNum">    3061 </span>            :     /* varray[2] = 0; */
<span class="lineNum">    3062 </span>            :     /* varray[3] = 0; */
<span class="lineNum">    3063 </span>            :     /* varray[4] = 0; */
<span class="lineNum">    3064 </span>            : 
<span class="lineNum">    3065 </span><span class="lineNoCov">          0 :     mboxes2[0].gd.pos.x = 4;</span>
<span class="lineNum">    3066 </span><span class="lineNoCov">          0 :     mboxes2[0].gd.pos.y = 4;</span>
<span class="lineNum">    3067 </span><span class="lineNoCov">          0 :     mboxes2[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3068 </span><span class="lineNoCov">          0 :     mboxes2[0].gd.u.boxelements = varray;</span>
<span class="lineNum">    3069 </span><span class="lineNoCov">          0 :     mboxes2[0].creator = GVBoxCreate;</span>
<span class="lineNum">    3070 </span>            : 
<span class="lineNum">    3071 </span><span class="lineNoCov">          0 :     GGadgetsCreate(gw,mboxes2);</span>
<span class="lineNum">    3072 </span>            : 
<span class="lineNum">    3073 </span>            : 
<span class="lineNum">    3074 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<span class="lineNum">    3075 </span><span class="lineNoCov">          0 :     while ( !p.done )</span>
<span class="lineNum">    3076 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">    3077 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(gw);</span>
<span class="lineNum">    3078 </span><span class="lineNoCov">          0 : }</span>
<a name="3079"><span class="lineNum">    3079 </span>            : </a>
<span class="lineNum">    3080 </span>            : 
<span class="lineNum">    3081 </span><span class="lineNoCov">          0 : void PointerDlg(CharView *cv) {</span>
<span class="lineNum">    3082 </span><span class="lineNoCov">          0 :     PrefsSubSetDlg( cv, _(&quot;Arrow Options&quot;), pointer_dialog_list );</span>
<a name="3083"><span class="lineNum">    3083 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3084 </span>            : 
<span class="lineNum">    3085 </span><span class="lineNoCov">          0 : void RulerDlg(CharView *cv) {</span>
<span class="lineNum">    3086 </span><span class="lineNoCov">          0 :     PrefsSubSetDlg( cv, _(&quot;Ruler Options&quot;), ruler_dialog_list );</span>
<span class="lineNum">    3087 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    3088 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
