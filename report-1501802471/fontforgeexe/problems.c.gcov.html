<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd) - fontforgeexe/problems.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">fontforgeexe</a> - problems.c<span style="font-size: 80%;"> (source / <a href="problems.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">FontForge coverage report 2017-08-04 01:21:11+02:00 (commit d35f7e4107a9e1db65cce47c468fcc914cecb8fd)</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">3715</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-08-04</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">85</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* -*- coding: utf-8 -*- */</a>
<span class="lineNum">       2 </span>            : /* Copyright (C) 2000-2012 by George Williams */
<span class="lineNum">       3 </span>            : /*
<span class="lineNum">       4 </span>            :  * Redistribution and use in source and binary forms, with or without
<span class="lineNum">       5 </span>            :  * modification, are permitted provided that the following conditions are met:
<span class="lineNum">       6 </span>            : 
<span class="lineNum">       7 </span>            :  * Redistributions of source code must retain the above copyright notice, this
<span class="lineNum">       8 </span>            :  * list of conditions and the following disclaimer.
<span class="lineNum">       9 </span>            : 
<span class="lineNum">      10 </span>            :  * Redistributions in binary form must reproduce the above copyright notice,
<span class="lineNum">      11 </span>            :  * this list of conditions and the following disclaimer in the documentation
<span class="lineNum">      12 </span>            :  * and/or other materials provided with the distribution.
<span class="lineNum">      13 </span>            : 
<span class="lineNum">      14 </span>            :  * The name of the author may not be used to endorse or promote products
<span class="lineNum">      15 </span>            :  * derived from this software without specific prior written permission.
<span class="lineNum">      16 </span>            : 
<span class="lineNum">      17 </span>            :  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
<span class="lineNum">      18 </span>            :  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
<span class="lineNum">      19 </span>            :  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
<span class="lineNum">      20 </span>            :  * EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span class="lineNum">      21 </span>            :  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
<span class="lineNum">      22 </span>            :  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
<span class="lineNum">      23 </span>            :  * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
<span class="lineNum">      24 </span>            :  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
<span class="lineNum">      25 </span>            :  * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
<span class="lineNum">      26 </span>            :  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span class="lineNum">      27 </span>            :  */
<span class="lineNum">      28 </span>            : #include &quot;autohint.h&quot;
<span class="lineNum">      29 </span>            : #include &quot;cvundoes.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;fontforgeui.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;fvfonts.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;namelist.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;ttf.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;splineorder2.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;splineoverlap.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;splinesaveafm.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;splineutil.h&quot;
<span class="lineNum">      38 </span>            : #include &quot;splineutil2.h&quot;
<span class="lineNum">      39 </span>            : #include &quot;tottf.h&quot;
<span class="lineNum">      40 </span>            : #include &quot;tottfgpos.h&quot;
<span class="lineNum">      41 </span>            : #include &lt;gwidget.h&gt;
<span class="lineNum">      42 </span>            : #include &lt;ustring.h&gt;
<span class="lineNum">      43 </span>            : #include &lt;math.h&gt;
<span class="lineNum">      44 </span>            : #include &lt;gkeysym.h&gt;
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span>            : /* ************************************************************************** */
<span class="lineNum">      47 </span>            : /* ***************************** Problems Dialog **************************** */
<span class="lineNum">      48 </span>            : /* ************************************************************************** */
<span class="lineNum">      49 </span>            : 
<span class="lineNum">      50 </span>            : struct mgrpl {
<span class="lineNum">      51 </span>            :     char *search;
<span class="lineNum">      52 </span>            :     char *rpl;          /* a rpl of &quot;&quot; means delete (NULL means not found) */
<span class="lineNum">      53 </span>            : };
<span class="lineNum">      54 </span>            : 
<span class="lineNum">      55 </span>            : struct mlrpl {
<span class="lineNum">      56 </span>            :     uint32 search;
<span class="lineNum">      57 </span>            :     uint32 rpl;
<span class="lineNum">      58 </span>            : };
<span class="lineNum">      59 </span>            : 
<span class="lineNum">      60 </span>            : struct problems {
<span class="lineNum">      61 </span>            :     FontView *fv;
<span class="lineNum">      62 </span>            :     CharView *cv;
<span class="lineNum">      63 </span>            :     SplineChar *sc;
<span class="lineNum">      64 </span>            :     SplineChar *msc;
<span class="lineNum">      65 </span>            :     int layer;
<span class="lineNum">      66 </span>            :     unsigned int openpaths: 1;
<span class="lineNum">      67 </span>            :     unsigned int intersectingpaths: 1;
<span class="lineNum">      68 </span>            :     unsigned int nonintegral: 1;
<span class="lineNum">      69 </span>            :     unsigned int pointstooclose: 1;
<span class="lineNum">      70 </span>            :     unsigned int pointstoofar: 1;
<span class="lineNum">      71 </span>            :     unsigned int xnearval: 1;
<span class="lineNum">      72 </span>            :     unsigned int ynearval: 1;
<span class="lineNum">      73 </span>            :     unsigned int ynearstd: 1;           /* baseline, xheight, cap, ascent, descent, etc. */
<span class="lineNum">      74 </span>            :     unsigned int linenearstd: 1;        /* horizontal, vertical, italicangle */
<span class="lineNum">      75 </span>            :     unsigned int cpnearstd: 1;          /* control points near: horizontal, vertical, italicangle */
<span class="lineNum">      76 </span>            :     unsigned int cpodd: 1;              /* control points beyond points on spline */
<span class="lineNum">      77 </span>            :     unsigned int hintwithnopt: 1;
<span class="lineNum">      78 </span>            :     unsigned int ptnearhint: 1;
<span class="lineNum">      79 </span>            :     unsigned int hintwidthnearval: 1;
<span class="lineNum">      80 </span>            :     unsigned int missingextrema: 1;
<span class="lineNum">      81 </span>            :     unsigned int direction: 1;
<span class="lineNum">      82 </span>            :     unsigned int flippedrefs: 1;
<span class="lineNum">      83 </span>            :     unsigned int cidmultiple: 1;
<span class="lineNum">      84 </span>            :     unsigned int cidblank: 1;
<span class="lineNum">      85 </span>            :     unsigned int bitmaps: 1;
<span class="lineNum">      86 </span>            :     unsigned int bitmapwidths: 1;
<span class="lineNum">      87 </span>            :     unsigned int advancewidth: 1;
<span class="lineNum">      88 </span>            :     unsigned int vadvancewidth: 1;
<span class="lineNum">      89 </span>            :     unsigned int stem3: 1;
<span class="lineNum">      90 </span>            :     unsigned int showexactstem3: 1;
<span class="lineNum">      91 </span>            :     unsigned int irrelevantcontrolpoints: 1;
<span class="lineNum">      92 </span>            :     unsigned int multuni: 1;
<span class="lineNum">      93 </span>            :     unsigned int multname: 1;
<span class="lineNum">      94 </span>            :     unsigned int uninamemismatch: 1;
<span class="lineNum">      95 </span>            :     unsigned int missinganchor: 1;
<span class="lineNum">      96 </span>            :     unsigned int badsubs: 1;
<span class="lineNum">      97 </span>            :     unsigned int missingglyph: 1;
<span class="lineNum">      98 </span>            :     unsigned int missingscriptinfeature: 1;
<span class="lineNum">      99 </span>            :     unsigned int toomanypoints: 1;
<span class="lineNum">     100 </span>            :     unsigned int toomanyhints: 1;
<span class="lineNum">     101 </span>            :     unsigned int toodeeprefs: 1;
<span class="lineNum">     102 </span>            :     unsigned int ptmatchrefsoutofdate: 1;
<span class="lineNum">     103 </span>            :     unsigned int multusemymetrics: 1;
<span class="lineNum">     104 </span>            :     unsigned int refsbadtransformttf: 1;
<span class="lineNum">     105 </span>            :     unsigned int refsbadtransformps: 1;
<span class="lineNum">     106 </span>            :     unsigned int mixedcontoursrefs: 1;
<span class="lineNum">     107 </span>            :     unsigned int bbymax: 1;
<span class="lineNum">     108 </span>            :     unsigned int bbymin: 1;
<span class="lineNum">     109 </span>            :     unsigned int bbxmax: 1;
<span class="lineNum">     110 </span>            :     unsigned int bbxmin: 1;
<span class="lineNum">     111 </span>            :     unsigned int overlappedhints: 1;
<span class="lineNum">     112 </span>            :     unsigned int explain: 1;
<span class="lineNum">     113 </span>            :     unsigned int done: 1;
<span class="lineNum">     114 </span>            :     unsigned int doneexplain: 1;
<span class="lineNum">     115 </span>            :     unsigned int finish: 1;
<span class="lineNum">     116 </span>            :     unsigned int ignorethis: 1;
<span class="lineNum">     117 </span>            :     double near, xval, yval, widthval;
<span class="lineNum">     118 </span>            :     char *explaining;
<span class="lineNum">     119 </span>            :     double found, expected;
<span class="lineNum">     120 </span>            :     double xheight, caph, ascent, descent;
<span class="lineNum">     121 </span>            :     double irrelevantfactor;
<span class="lineNum">     122 </span>            :     int advancewidthval, vadvancewidthval;
<span class="lineNum">     123 </span>            :     int bbymax_val, bbymin_val, bbxmax_val, bbxmin_val;
<span class="lineNum">     124 </span>            :     int pointsmax, hintsmax, refdepthmax;
<span class="lineNum">     125 </span>            :     GWindow explainw;
<span class="lineNum">     126 </span>            :     GGadget *explaintext, *explainvals, *ignoregadg, *topbox;
<span class="lineNum">     127 </span>            :     SplineChar *lastcharopened;
<span class="lineNum">     128 </span>            :     CharView *cvopened;
<span class="lineNum">     129 </span>            :     char *badsubsname;
<span class="lineNum">     130 </span>            :     struct lookup_subtable *badsubs_lsubtable;
<span class="lineNum">     131 </span>            :     AnchorClass *missinganchor_class;
<span class="lineNum">     132 </span>            :     int rpl_cnt, rpl_max;
<span class="lineNum">     133 </span>            :     struct mgrpl *mg;
<span class="lineNum">     134 </span>            :     struct mlrpl *mlt;
<span class="lineNum">     135 </span>            :     char *glyphname;
<span class="lineNum">     136 </span>            :     int glyphenc;
<span class="lineNum">     137 </span>            :     EncMap *map;
<span class="lineNum">     138 </span>            : };
<span class="lineNum">     139 </span>            : 
<span class="lineNum">     140 </span>            : static int openpaths=0, pointstooclose=0/*, missing=0*/, doxnear=0, doynear=0;
<span class="lineNum">     141 </span>            : static int nonintegral=0, pointstoofar=0;
<span class="lineNum">     142 </span>            : static int intersectingpaths=0, missingextrema=0;
<span class="lineNum">     143 </span>            : static int doynearstd=0, linestd=0, cpstd=0, cpodd=0, hintnopt=0, ptnearhint=0;
<span class="lineNum">     144 </span>            : static int hintwidth=0, direction=0, flippedrefs=0, bitmaps=0, bitmapwidths=0;
<span class="lineNum">     145 </span>            : static int cidblank=0, cidmultiple=0, advancewidth=0, vadvancewidth=0;
<span class="lineNum">     146 </span>            : static int bbymax=0, bbymin=0, bbxmax=0, bbxmin=0;
<span class="lineNum">     147 </span>            : static int irrelevantcp=0, missingglyph=0, missingscriptinfeature=0;
<span class="lineNum">     148 </span>            : static int badsubs=0, missinganchor=0, toomanypoints=0, pointsmax = 1500;
<span class="lineNum">     149 </span>            : static int multuni=0, multname=0, uninamemismatch=0, overlappedhints=0;
<span class="lineNum">     150 </span>            : static int toomanyhints=0, hintsmax=96, toodeeprefs=0, refdepthmax=9;
<span class="lineNum">     151 </span>            : static int ptmatchrefsoutofdate=0, refsbadtransformttf=0, refsbadtransformps=0;
<span class="lineNum">     152 </span>            : static int mixedcontoursrefs=0, multusemymetrics=0;
<span class="lineNum">     153 </span>            : static int stem3=0, showexactstem3=0;
<span class="lineNum">     154 </span>            : static double near=3, xval=0, yval=0, widthval=50, advancewidthval=0, vadvancewidthval=0;
<span class="lineNum">     155 </span>            : static double bbymax_val=0, bbymin_val=0, bbxmax_val=0, bbxmin_val=0;
<span class="lineNum">     156 </span>            : static double irrelevantfactor = .005;
<span class="lineNum">     157 </span>            : static SplineFont *lastsf=NULL;
<span class="lineNum">     158 </span>            : 
<span class="lineNum">     159 </span>            : #define CID_Stop                2001
<span class="lineNum">     160 </span>            : #define CID_Next                2002
<span class="lineNum">     161 </span>            : #define CID_Fix                 2003
<span class="lineNum">     162 </span>            : #define CID_ClearAll            2004
<span class="lineNum">     163 </span>            : #define CID_SetAll              2005
<span class="lineNum">     164 </span>            : 
<span class="lineNum">     165 </span>            : #define CID_OpenPaths           1001
<span class="lineNum">     166 </span>            : #define CID_IntersectingPaths   1002
<span class="lineNum">     167 </span>            : #define CID_PointsTooClose      1003
<span class="lineNum">     168 </span>            : #define CID_XNear               1004
<span class="lineNum">     169 </span>            : #define CID_YNear               1005
<span class="lineNum">     170 </span>            : #define CID_YNearStd            1006
<span class="lineNum">     171 </span>            : #define CID_HintNoPt            1007
<span class="lineNum">     172 </span>            : #define CID_PtNearHint          1008
<span class="lineNum">     173 </span>            : #define CID_HintWidthNear       1009
<span class="lineNum">     174 </span>            : #define CID_HintWidth           1010
<span class="lineNum">     175 </span>            : #define CID_Near                1011
<span class="lineNum">     176 </span>            : #define CID_XNearVal            1012
<span class="lineNum">     177 </span>            : #define CID_YNearVal            1013
<span class="lineNum">     178 </span>            : #define CID_LineStd             1014
<span class="lineNum">     179 </span>            : #define CID_Direction           1015
<span class="lineNum">     180 </span>            : #define CID_CpStd               1016
<span class="lineNum">     181 </span>            : #define CID_CpOdd               1017
<span class="lineNum">     182 </span>            : #define CID_CIDMultiple         1018
<span class="lineNum">     183 </span>            : #define CID_CIDBlank            1019
<span class="lineNum">     184 </span>            : #define CID_FlippedRefs         1020
<span class="lineNum">     185 </span>            : #define CID_Bitmaps             1021
<span class="lineNum">     186 </span>            : #define CID_AdvanceWidth        1022
<span class="lineNum">     187 </span>            : #define CID_AdvanceWidthVal     1023
<span class="lineNum">     188 </span>            : #define CID_VAdvanceWidth       1024
<span class="lineNum">     189 </span>            : #define CID_VAdvanceWidthVal    1025
<span class="lineNum">     190 </span>            : #define CID_Stem3               1026
<span class="lineNum">     191 </span>            : #define CID_ShowExactStem3      1027
<span class="lineNum">     192 </span>            : #define CID_IrrelevantCP        1028
<span class="lineNum">     193 </span>            : #define CID_IrrelevantFactor    1029
<span class="lineNum">     194 </span>            : #define CID_BadSubs             1030
<span class="lineNum">     195 </span>            : #define CID_MissingGlyph        1031
<span class="lineNum">     196 </span>            : #define CID_MissingScriptInFeature 1032
<span class="lineNum">     197 </span>            : #define CID_TooManyPoints       1033
<span class="lineNum">     198 </span>            : #define CID_PointsMax           1034
<span class="lineNum">     199 </span>            : #define CID_TooManyHints        1035
<span class="lineNum">     200 </span>            : #define CID_HintsMax            1036
<span class="lineNum">     201 </span>            : #define CID_TooDeepRefs         1037
<span class="lineNum">     202 </span>            : #define CID_RefDepthMax         1038
<span class="lineNum">     203 </span>            : #define CID_MultUni             1040
<span class="lineNum">     204 </span>            : #define CID_MultName            1041
<span class="lineNum">     205 </span>            : #define CID_PtMatchRefsOutOfDate 1042
<span class="lineNum">     206 </span>            : #define CID_RefBadTransformTTF  1043
<span class="lineNum">     207 </span>            : #define CID_RefBadTransformPS   1044
<span class="lineNum">     208 </span>            : #define CID_MixedContoursRefs   1045
<span class="lineNum">     209 </span>            : #define CID_MissingExtrema      1046
<span class="lineNum">     210 </span>            : #define CID_UniNameMisMatch     1047
<span class="lineNum">     211 </span>            : #define CID_BBYMax              1048
<span class="lineNum">     212 </span>            : #define CID_BBYMin              1049
<span class="lineNum">     213 </span>            : #define CID_BBXMax              1050
<span class="lineNum">     214 </span>            : #define CID_BBXMin              1051
<span class="lineNum">     215 </span>            : #define CID_BBYMaxVal           1052
<span class="lineNum">     216 </span>            : #define CID_BBYMinVal           1053
<span class="lineNum">     217 </span>            : #define CID_BBXMaxVal           1054
<span class="lineNum">     218 </span>            : #define CID_BBXMinVal           1055
<span class="lineNum">     219 </span>            : #define CID_NonIntegral         1056
<span class="lineNum">     220 </span>            : #define CID_PointsTooFar        1057
<span class="lineNum">     221 </span>            : #define CID_BitmapWidths        1058
<span class="lineNum">     222 </span>            : #define CID_MissingAnchor       1059
<span class="lineNum">     223 </span>            : #define CID_MultUseMyMetrics    1060
<span class="lineNum">     224 </span>            : #define CID_OverlappedHints     1061
<a name="225"><span class="lineNum">     225 </span>            : </a>
<span class="lineNum">     226 </span>            : 
<span class="lineNum">     227 </span><span class="lineNoCov">          0 : static void FixIt(struct problems *p) {</span>
<span class="lineNum">     228 </span>            :     SplinePointList *spl;
<span class="lineNum">     229 </span>            :     SplinePoint *sp;
<span class="lineNum">     230 </span>            :     /*StemInfo *h;*/
<span class="lineNum">     231 </span>            :     RefChar *r;
<span class="lineNum">     232 </span>            :     int ncp_changed, pcp_changed;
<span class="lineNum">     233 </span>            : 
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :     if ( p-&gt;explaining==_(&quot;This reference has been flipped, so the paths in it are drawn backwards&quot;) ) {</span>
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :         for ( r=p-&gt;sc-&gt;layers[p-&gt;layer].refs; r!=NULL &amp;&amp; !r-&gt;selected; r = r-&gt;next );</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :         if ( r!=NULL ) {</span>
<span class="lineNum">     237 </span>            :             SplineSet *ss, *spl;
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :             SCPreserveLayer(p-&gt;sc,p-&gt;layer,false);</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :             ss = p-&gt;sc-&gt;layers[p-&gt;layer].splines;</span>
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :             p-&gt;sc-&gt;layers[p-&gt;layer].splines = NULL;</span>
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :             SCRefToSplines(p-&gt;sc,r,p-&gt;layer);</span>
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :             for ( spl = p-&gt;sc-&gt;layers[p-&gt;layer].splines; spl!=NULL; spl=spl-&gt;next )</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :                 SplineSetReverse(spl);</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :             if ( p-&gt;sc-&gt;layers[p-&gt;layer].splines!=NULL ) {</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :                 for ( spl = p-&gt;sc-&gt;layers[p-&gt;layer].splines; spl-&gt;next!=NULL; spl=spl-&gt;next );</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :                 spl-&gt;next = ss;</span>
<span class="lineNum">     247 </span>            :             } else
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :                 p-&gt;sc-&gt;layers[p-&gt;layer].splines = ss;</span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :             SCCharChangedUpdate(p-&gt;sc,p-&gt;layer);</span>
<span class="lineNum">     250 </span>            :         } else
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :             IError(&quot;Could not find referenc&quot;);</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;explaining==_(&quot;This glyph's advance width is different from the standard width&quot;) ) {</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :         SCSynchronizeWidth(p-&gt;sc,p-&gt;advancewidthval,p-&gt;sc-&gt;width,NULL);</span>
<span class="lineNum">     255 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;explaining==_(&quot;This glyph's vertical advance is different from the standard width&quot;) ) {</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :         p-&gt;sc-&gt;vwidth=p-&gt;vadvancewidthval;</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     259 </span>            :     }
<span class="lineNum">     260 </span>            : 
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :     if ( p-&gt;explaining==_(&quot;This glyph is not mapped to any unicode code point, but its name should be.&quot;) ||</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :             p-&gt;explaining==_(&quot;This glyph is mapped to a unicode code point which is different from its name.&quot;) ) {</span>
<span class="lineNum">     263 </span>            :         char buf[100]; const char *newname;
<span class="lineNum">     264 </span>            :         SplineChar *foundsc;
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :         newname = StdGlyphName(buf,p-&gt;sc-&gt;unicodeenc,p-&gt;sc-&gt;parent-&gt;uni_interp,p-&gt;sc-&gt;parent-&gt;for_new_glyphs);</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :         foundsc = SFHashName(p-&gt;sc-&gt;parent,newname);</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :         if ( foundsc==NULL ) {</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :             free(p-&gt;sc-&gt;name);</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :             p-&gt;sc-&gt;name = copy(newname);</span>
<span class="lineNum">     270 </span>            :         } else {
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :             ff_post_error(_(&quot;Can't fix&quot;), _(&quot;The name FontForge would like to assign to this glyph, %.30s, is already used by a different glyph.&quot;),</span>
<span class="lineNum">     272 </span>            :                     newname );
<span class="lineNum">     273 </span>            :         }
<span class="lineNum">     274 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     275 </span>            :     }
<span class="lineNum">     276 </span>            : 
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :     sp = NULL;</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :     for ( spl=p-&gt;sc-&gt;layers[p-&gt;layer].splines; spl!=NULL; spl=spl-&gt;next ) {</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :         for ( sp = spl-&gt;first; ; ) {</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :             if ( sp-&gt;selected )</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :             if ( sp-&gt;next==NULL )</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :             sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :             if ( sp==spl-&gt;first )</span>
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :         if ( sp-&gt;selected )</span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     290 </span>            :     }
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :     if ( sp==NULL ) {</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :         IError(&quot;Nothing selected&quot;);</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     294 </span>            :     }
<span class="lineNum">     295 </span>            : 
<span class="lineNum">     296 </span>            : /* I do not handle:
<span class="lineNum">     297 </span>            :     _(&quot;The two selected points are the endpoints of an open path&quot;)
<span class="lineNum">     298 </span>            :     _(&quot;The paths that make up this glyph intersect one another&quot;)
<span class="lineNum">     299 </span>            :     _(&quot;The selected points are too close to each other&quot;)
<span class="lineNum">     300 </span>            :     _(&quot;The selected line segment is near the italic angle&quot;), _(&quot;The control point above the selected point is near the italic angle&quot;), _(&quot;The control point below the selected point is near the italic angle&quot;), _(&quot;The control point right of the selected point is near the italic angle&quot;), _(&quot;The control point left of the selected point is near the italic angle&quot;)
<span class="lineNum">     301 </span>            :     _(&quot;The control point above the selected point is outside the spline segment&quot;), _(&quot;The control point below the selected point is outside the spline segment&quot;), _(&quot;The control point right of the selected point is outside the spline segment&quot;), _(&quot;The control point left of the selected point is outside the spline segment&quot;)
<span class="lineNum">     302 </span>            :     _(&quot;This hint does not control any points&quot;)
<span class="lineNum">     303 </span>            :     _STR_ProbHint3*
<span class="lineNum">     304 </span>            :     _STR_ProbMultUni, STR_ProbMultName
<span class="lineNum">     305 </span>            : */
<span class="lineNum">     306 </span>            : 
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :     SCPreserveLayer(p-&gt;sc,p-&gt;layer,false);</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :     ncp_changed = pcp_changed = false;</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :     if ( p-&gt;explaining==_(&quot;The x coord of the selected point is near the specified value&quot;) || p-&gt;explaining==_(&quot;The selected point is near a vertical stem hint&quot;)) {</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :         sp-&gt;prevcp.x += p-&gt;expected-sp-&gt;me.x;</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :         sp-&gt;nextcp.x += p-&gt;expected-sp-&gt;me.x;</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :         sp-&gt;me.x = p-&gt;expected;</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :         ncp_changed = pcp_changed = true;</span>
<span class="lineNum">     314 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;explaining==_(&quot;The selected point is not at integral coordinates&quot;) ||</span>
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :             p-&gt;explaining==_(&quot;The selected point does not have integral control points&quot;)) {</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :         sp-&gt;me.x = rint(sp-&gt;me.x); sp-&gt;me.y = rint(sp-&gt;me.y);</span>
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :         sp-&gt;nextcp.x = rint(sp-&gt;nextcp.x); sp-&gt;nextcp.y = rint(sp-&gt;nextcp.y);</span>
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :         sp-&gt;prevcp.x = rint(sp-&gt;prevcp.x); sp-&gt;prevcp.y = rint(sp-&gt;prevcp.y);</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :         ncp_changed = pcp_changed = true;</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;explaining==_(&quot;The y coord of the selected point is near the specified value&quot;) || p-&gt;explaining==_(&quot;The selected point is near a horizontal stem hint&quot;) ||</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :             p-&gt;explaining==_(&quot;The y coord of the selected point is near the baseline&quot;) || p-&gt;explaining==_(&quot;The y coord of the selected point is near the xheight&quot;) ||</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :             p-&gt;explaining==_(&quot;The y coord of the selected point is near the cap height&quot;) || p-&gt;explaining==_(&quot;The y coord of the selected point is near the ascender height&quot;) ||</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :             p-&gt;explaining==_(&quot;The y coord of the selected point is near the descender height&quot;) ) {</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :         sp-&gt;prevcp.y += p-&gt;expected-sp-&gt;me.y;</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :         sp-&gt;nextcp.y += p-&gt;expected-sp-&gt;me.y;</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :         sp-&gt;me.y = p-&gt;expected;</span>
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :         ncp_changed = pcp_changed = true;</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;explaining==_(&quot;The selected spline attains its extrema somewhere other than its endpoints&quot;) ) {</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :         SplineCharAddExtrema(p-&gt;sc,p-&gt;sc-&gt;layers[p-&gt;layer].splines,</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :                 ae_between_selected,p-&gt;sc-&gt;parent-&gt;ascent+p-&gt;sc-&gt;parent-&gt;descent);</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;explaining==_(&quot;The selected line segment is nearly horizontal&quot;) ) {</span>
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :         if ( sp-&gt;me.y!=p-&gt;found ) {</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :             sp=sp-&gt;next-&gt;to;</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :             if ( !sp-&gt;selected || sp-&gt;me.y!=p-&gt;found ) {</span>
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :                 IError(&quot;Couldn't find line&quot;);</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     337 </span>            :             }
<span class="lineNum">     338 </span>            :         }
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :         sp-&gt;prevcp.y += p-&gt;expected-sp-&gt;me.y;</span>
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :         sp-&gt;nextcp.y += p-&gt;expected-sp-&gt;me.y;</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :         sp-&gt;me.y = p-&gt;expected;</span>
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :         ncp_changed = pcp_changed = true;</span>
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;explaining==_(&quot;The control point above the selected point is nearly horizontal&quot;) || p-&gt;explaining==_(&quot;The control point below the selected point is nearly horizontal&quot;) ||</span>
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :             p-&gt;explaining==_(&quot;The control point right of the selected point is nearly horizontal&quot;) || p-&gt;explaining==_(&quot;The control point left of the selected point is nearly horizontal&quot;) ) {</span>
<span class="lineNum">     345 </span>            :         BasePoint *tofix, *other;
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :         if ( sp-&gt;nextcp.y==p-&gt;found ) {</span>
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :             tofix = &amp;sp-&gt;nextcp;</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :             other = &amp;sp-&gt;prevcp;</span>
<span class="lineNum">     349 </span>            :         } else {
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :             tofix = &amp;sp-&gt;prevcp;</span>
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :             other = &amp;sp-&gt;nextcp;</span>
<span class="lineNum">     352 </span>            :         }
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :         if ( tofix-&gt;y!=p-&gt;found ) {</span>
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :             IError(&quot;Couldn't find control point&quot;);</span>
<span class="lineNum">     355 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     356 </span>            :         }
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :         tofix-&gt;y = p-&gt;expected;</span>
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :         ncp_changed = pcp_changed = true;</span>
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :         if ( sp-&gt;pointtype==pt_curve || sp-&gt;pointtype==pt_hvcurve )</span>
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :             other-&gt;y = p-&gt;expected;</span>
<span class="lineNum">     361 </span>            :         else {
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :             sp-&gt;pointtype = pt_corner;</span>
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :             if ( other==&amp;sp-&gt;nextcp )</span>
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :                 ncp_changed = false;</span>
<span class="lineNum">     365 </span>            :             else
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :                 pcp_changed = false;</span>
<span class="lineNum">     367 </span>            :         }
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;explaining==_(&quot;The selected line segment is nearly vertical&quot;) ) {</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :         if ( sp-&gt;me.x!=p-&gt;found ) {</span>
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :             sp=sp-&gt;next-&gt;to;</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :             if ( !sp-&gt;selected || sp-&gt;me.x!=p-&gt;found ) {</span>
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :                 IError(&quot;Couldn't find line&quot;);</span>
<span class="lineNum">     373 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     374 </span>            :             }
<span class="lineNum">     375 </span>            :         }
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :         sp-&gt;prevcp.x += p-&gt;expected-sp-&gt;me.x;</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :         sp-&gt;nextcp.x += p-&gt;expected-sp-&gt;me.x;</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :         sp-&gt;me.x = p-&gt;expected;</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :         ncp_changed = pcp_changed = true;</span>
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;explaining==_(&quot;The control point above the selected point is nearly vertical&quot;) || p-&gt;explaining==_(&quot;The control point below the selected point is nearly vertical&quot;) ||</span>
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :             p-&gt;explaining==_(&quot;The control point right of the selected point is nearly vertical&quot;) || p-&gt;explaining==_(&quot;The control point left of the selected point is nearly vertical&quot;) ) {</span>
<span class="lineNum">     382 </span>            :         BasePoint *tofix, *other;
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :         if ( sp-&gt;nextcp.x==p-&gt;found ) {</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :             tofix = &amp;sp-&gt;nextcp;</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :             other = &amp;sp-&gt;prevcp;</span>
<span class="lineNum">     386 </span>            :         } else {
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :             tofix = &amp;sp-&gt;prevcp;</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :             other = &amp;sp-&gt;nextcp;</span>
<span class="lineNum">     389 </span>            :         }
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :         if ( tofix-&gt;x!=p-&gt;found ) {</span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :             IError(&quot;Couldn't find control point&quot;);</span>
<span class="lineNum">     392 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     393 </span>            :         }
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :         tofix-&gt;x = p-&gt;expected;</span>
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :         ncp_changed = pcp_changed = true;</span>
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :         if ( sp-&gt;pointtype==pt_curve || sp-&gt;pointtype==pt_hvcurve )</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :             other-&gt;x = p-&gt;expected;</span>
<span class="lineNum">     398 </span>            :         else {
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :             sp-&gt;pointtype = pt_corner;</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :             if ( other==&amp;sp-&gt;nextcp )</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :                 ncp_changed = false;</span>
<span class="lineNum">     402 </span>            :             else
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :                 pcp_changed = false;</span>
<span class="lineNum">     404 </span>            :         }
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;explaining==_(&quot;This path should have been drawn in a counter-clockwise direction&quot;) || p-&gt;explaining==_(&quot;This path should have been drawn in a clockwise direction&quot;) ) {</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :         SplineSetReverse(spl);</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;explaining==_(&quot;This glyph contains control points which are probably too close to the main points to alter the look of the spline&quot;) ) {</span>
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :         if ( sp-&gt;next!=NULL ) {</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :             double len = sqrt((sp-&gt;me.x-sp-&gt;next-&gt;to-&gt;me.x)*(sp-&gt;me.x-sp-&gt;next-&gt;to-&gt;me.x) +</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :                     (sp-&gt;me.y-sp-&gt;next-&gt;to-&gt;me.y)*(sp-&gt;me.y-sp-&gt;next-&gt;to-&gt;me.y));</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :             double cplen = sqrt((sp-&gt;me.x-sp-&gt;nextcp.x)*(sp-&gt;me.x-sp-&gt;nextcp.x) +</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :                     (sp-&gt;me.y-sp-&gt;nextcp.y)*(sp-&gt;me.y-sp-&gt;nextcp.y));</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :             if ( cplen!=0 &amp;&amp; cplen&lt;p-&gt;irrelevantfactor*len ) {</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :                 sp-&gt;nextcp = sp-&gt;me;</span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :                 sp-&gt;nonextcp = true;</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :                 ncp_changed = true;</span>
<span class="lineNum">     417 </span>            :             }
<span class="lineNum">     418 </span>            :         }
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :         if ( sp-&gt;prev!=NULL ) {</span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :             double len = sqrt((sp-&gt;me.x-sp-&gt;prev-&gt;from-&gt;me.x)*(sp-&gt;me.x-sp-&gt;prev-&gt;from-&gt;me.x) +</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :                     (sp-&gt;me.y-sp-&gt;prev-&gt;from-&gt;me.y)*(sp-&gt;me.y-sp-&gt;prev-&gt;from-&gt;me.y));</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :             double cplen = sqrt((sp-&gt;me.x-sp-&gt;prevcp.x)*(sp-&gt;me.x-sp-&gt;prevcp.x) +</span>
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :                     (sp-&gt;me.y-sp-&gt;prevcp.y)*(sp-&gt;me.y-sp-&gt;prevcp.y));</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :             if ( cplen!=0 &amp;&amp; cplen&lt;p-&gt;irrelevantfactor*len ) {</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :                 sp-&gt;prevcp = sp-&gt;me;</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :                 sp-&gt;noprevcp = true;</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :                 pcp_changed = true;</span>
<span class="lineNum">     428 </span>            :             }
<span class="lineNum">     429 </span>            :         }
<span class="lineNum">     430 </span>            :     } else
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :         IError(&quot;Did not fix: %d&quot;, p-&gt;explaining );</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :     if ( p-&gt;sc-&gt;layers[p-&gt;layer].order2 ) {</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :         if ( ncp_changed )</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :             SplinePointNextCPChanged2(sp);</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :         if ( pcp_changed )</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :             SplinePointPrevCPChanged2(sp);</span>
<span class="lineNum">     437 </span>            :     }
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :     if ( sp-&gt;next!=NULL )</span>
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :         SplineRefigure(sp-&gt;next);</span>
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :     if ( sp-&gt;prev!=NULL )</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :         SplineRefigure(sp-&gt;prev);</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :     SCCharChangedUpdate(p-&gt;sc,p-&gt;layer);</span>
<a name="443"><span class="lineNum">     443 </span>            : }</a>
<span class="lineNum">     444 </span>            : 
<span class="lineNum">     445 </span><span class="lineNoCov">          0 : static int explain_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :         struct problems *p = GDrawGetUserData(gw);</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :         p-&gt;doneexplain = true;</span>
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_controlevent &amp;&amp;</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :             event-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :         struct problems *p = GDrawGetUserData(gw);</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :         if ( GGadgetGetCid(event-&gt;u.control.g)==CID_Stop )</span>
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :             p-&gt;finish = true;</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :         else if ( GGadgetGetCid(event-&gt;u.control.g)==CID_Fix )</span>
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :             FixIt(p);</span>
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :         p-&gt;doneexplain = true;</span>
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_controlevent &amp;&amp;</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :             event-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :         struct problems *p = GDrawGetUserData(gw);</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :         p-&gt;ignorethis = GGadgetIsChecked(event-&gt;u.control.g);</span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_char ) {</span>
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.keysym == GK_F1 || event-&gt;u.chr.keysym == GK_Help ) {</span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :             help(&quot;problems.html&quot;);</span>
<span class="lineNum">     464 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     465 </span>            :         }
<span class="lineNum">     466 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     467 </span>            :     }
<span class="lineNum">     468 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="469"><span class="lineNum">     469 </span>            : }</a>
<span class="lineNum">     470 </span>            : 
<span class="lineNum">     471 </span><span class="lineNoCov">          0 : static void ExplainIt(struct problems *p, SplineChar *sc, char *explain,</span>
<span class="lineNum">     472 </span>            :         real found, real expected ) {
<span class="lineNum">     473 </span>            :     GRect pos;
<span class="lineNum">     474 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">     475 </span>            :     GGadgetCreateData gcd[9], boxes[3], *varray[10], *barray[14];
<span class="lineNum">     476 </span>            :     GTextInfo label[9];
<span class="lineNum">     477 </span>            :     char buf[200];
<span class="lineNum">     478 </span>            :     SplinePointList *spl; Spline *spline, *first;
<span class="lineNum">     479 </span>            :     int fixable;
<span class="lineNum">     480 </span>            : 
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :     if ( !p-&gt;explain || p-&gt;finish )</span>
<span class="lineNum">     482 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :     if ( p-&gt;explainw==NULL ) {</span>
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :         memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :         wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor;</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :         wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :         wattrs.undercursor = 1;</span>
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :         wattrs.cursor = ct_pointer;</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :         wattrs.utf8_window_title = _(&quot;Problem explanation&quot;);</span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :         pos.x = pos.y = 0;</span>
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :         pos.width = GGadgetScale(GDrawPointsToPixels(NULL,400));</span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :         pos.height = GDrawPointsToPixels(NULL,86);</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :         p-&gt;explainw = GDrawCreateTopWindow(NULL,&amp;pos,explain_e_h,p,&amp;wattrs);</span>
<span class="lineNum">     494 </span>            : 
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :         memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :         memset(&amp;gcd,0,sizeof(gcd));</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :         memset(&amp;boxes,0,sizeof(boxes));</span>
<span class="lineNum">     498 </span>            : 
<span class="lineNum">     499 </span><span class="lineNoCov">          0 :         label[0].text = (unichar_t *) explain;</span>
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :         label[0].text_is_1byte = true;</span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :         gcd[0].gd.label = &amp;label[0];</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :         gcd[0].gd.pos.x = 6; gcd[0].gd.pos.y = 6; gcd[0].gd.pos.width = 400-12;</span>
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :         gcd[0].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :         gcd[0].creator = GLabelCreate;</span>
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :         varray[0] = &amp;gcd[0]; varray[1] = NULL;</span>
<span class="lineNum">     506 </span>            : 
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :         label[4].text = (unichar_t *) &quot;&quot;;</span>
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :         label[4].text_is_1byte = true;</span>
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :         gcd[4].gd.label = &amp;label[4];</span>
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :         gcd[4].gd.pos.x = 6; gcd[4].gd.pos.y = gcd[0].gd.pos.y+12; gcd[4].gd.pos.width = 400-12;</span>
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :         gcd[4].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :         gcd[4].creator = GLabelCreate;</span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :         varray[2] = &amp;gcd[4]; varray[3] = NULL;</span>
<span class="lineNum">     514 </span>            : 
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :         label[5].text = (unichar_t *) _(&quot;Ignore this problem in the future&quot;);</span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :         label[5].text_is_1byte = true;</span>
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :         gcd[5].gd.label = &amp;label[5];</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :         gcd[5].gd.pos.x = 6; gcd[5].gd.pos.y = gcd[4].gd.pos.y+12;</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :         gcd[5].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :         gcd[5].creator = GCheckBoxCreate;</span>
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :         varray[4] = &amp;gcd[5]; varray[5] = NULL;</span>
<span class="lineNum">     522 </span>            : 
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :         gcd[1].gd.pos.x = 15-3; gcd[1].gd.pos.y = gcd[5].gd.pos.y+20;</span>
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :         gcd[1].gd.pos.width = -1; gcd[1].gd.pos.height = 0;</span>
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :         gcd[1].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :         label[1].text = (unichar_t *) _(&quot;_Next&quot;);</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :         label[1].text_is_1byte = true;</span>
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :         label[1].text_in_resource = true;</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :         gcd[1].gd.mnemonic = 'N';</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :         gcd[1].gd.label = &amp;label[1];</span>
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :         gcd[1].gd.cid = CID_Next;</span>
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :         gcd[1].creator = GButtonCreate;</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :         barray[0] = GCD_Glue; barray[1] = &amp;gcd[1]; barray[2] = GCD_Glue; barray[3] = GCD_Glue;</span>
<span class="lineNum">     534 </span>            : 
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :         gcd[6].gd.pos.x = 200-30; gcd[6].gd.pos.y = gcd[2].gd.pos.y;</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :         gcd[6].gd.pos.width = -1; gcd[6].gd.pos.height = 0;</span>
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :         gcd[6].gd.flags = /*gg_visible |*/ gg_enabled;</span>
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :         label[6].text = (unichar_t *) _(&quot;Fix&quot;);</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :         label[6].text_is_1byte = true;</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :         gcd[6].gd.mnemonic = 'F';</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :         gcd[6].gd.label = &amp;label[6];</span>
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :         gcd[6].gd.cid = CID_Fix;</span>
<span class="lineNum">     543 </span><span class="lineNoCov">          0 :         gcd[6].creator = GButtonCreate;</span>
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :         barray[4] = GCD_Glue; barray[5] = GCD_Glue; barray[6] = &amp;gcd[6]; barray[7] = GCD_Glue;</span>
<span class="lineNum">     545 </span>            : 
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :         gcd[2].gd.pos.x = -15; gcd[2].gd.pos.y = gcd[1].gd.pos.y+3;</span>
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :         gcd[2].gd.pos.width = -1; gcd[2].gd.pos.height = 0;</span>
<span class="lineNum">     548 </span><span class="lineNoCov">          0 :         gcd[2].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :         label[2].text = (unichar_t *) _(&quot;_Stop&quot;);</span>
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :         label[2].text_is_1byte = true;</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :         label[2].text_in_resource = true;</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :         gcd[2].gd.label = &amp;label[2];</span>
<span class="lineNum">     553 </span><span class="lineNoCov">          0 :         gcd[2].gd.mnemonic = 'S';</span>
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :         gcd[2].gd.cid = CID_Stop;</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :         gcd[2].creator = GButtonCreate;</span>
<span class="lineNum">     556 </span><span class="lineNoCov">          0 :         barray[8] = GCD_Glue; barray[9] = GCD_Glue; barray[10] = GCD_Glue;</span>
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :         barray[11] = &amp;gcd[2]; barray[12] = GCD_Glue;</span>
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :         barray[13] = NULL;</span>
<span class="lineNum">     559 </span>            : 
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :         boxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :         boxes[2].gd.u.boxelements = barray;</span>
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :         boxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :         varray[6] = &amp;boxes[2]; varray[7] = NULL; varray[8] = NULL;</span>
<span class="lineNum">     564 </span>            : 
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :         boxes[0].gd.pos.x = boxes[0].gd.pos.y = 2;</span>
<span class="lineNum">     566 </span><span class="lineNoCov">          0 :         boxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">     567 </span><span class="lineNoCov">          0 :         boxes[0].gd.u.boxelements = varray;</span>
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :         boxes[0].creator = GHVGroupCreate;</span>
<span class="lineNum">     569 </span>            : 
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :         GGadgetsCreate(p-&gt;explainw,boxes);</span>
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :         GHVBoxSetExpandableCol(boxes[2].ret,gb_expandgluesame);</span>
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :         p-&gt;explaintext = gcd[0].ret;</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :         p-&gt;explainvals = gcd[4].ret;</span>
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :         p-&gt;ignoregadg = gcd[5].ret;</span>
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :         p-&gt;topbox = boxes[0].ret;</span>
<span class="lineNum">     576 </span>            :     } else
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :         GGadgetSetTitle8(p-&gt;explaintext,explain);</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :     p-&gt;explaining = explain;</span>
<span class="lineNum">     579 </span><span class="lineNoCov">          0 :     fixable = /*explain==_(&quot;This glyph contains a horizontal hint near the specified width&quot;) || explain==_(&quot;This glyph contains a vertical hint near the specified width&quot;) ||*/</span>
<span class="lineNum">     580 </span><span class="lineNoCov">          0 :             explain==_(&quot;This reference has been flipped, so the paths in it are drawn backwards&quot;) ||</span>
<span class="lineNum">     581 </span><span class="lineNoCov">          0 :             explain==_(&quot;The x coord of the selected point is near the specified value&quot;) || explain==_(&quot;The selected point is near a vertical stem hint&quot;) ||</span>
<span class="lineNum">     582 </span><span class="lineNoCov">          0 :             explain==_(&quot;The y coord of the selected point is near the specified value&quot;) || explain==_(&quot;The selected point is near a horizontal stem hint&quot;) ||</span>
<span class="lineNum">     583 </span><span class="lineNoCov">          0 :             explain==_(&quot;This glyph contains control points which are probably too close to the main points to alter the look of the spline&quot;) ||</span>
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :             explain==_(&quot;The y coord of the selected point is near the baseline&quot;) || explain==_(&quot;The y coord of the selected point is near the xheight&quot;) ||</span>
<span class="lineNum">     585 </span><span class="lineNoCov">          0 :             explain==_(&quot;The y coord of the selected point is near the cap height&quot;) || explain==_(&quot;The y coord of the selected point is near the ascender height&quot;) ||</span>
<span class="lineNum">     586 </span><span class="lineNoCov">          0 :             explain==_(&quot;The y coord of the selected point is near the descender height&quot;) ||</span>
<span class="lineNum">     587 </span><span class="lineNoCov">          0 :             explain==_(&quot;The selected line segment is nearly horizontal&quot;) || explain==_(&quot;The selected line segment is nearly vertical&quot;) ||</span>
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :             explain==_(&quot;The control point above the selected point is nearly horizontal&quot;) || explain==_(&quot;The control point below the selected point is nearly horizontal&quot;) ||</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :             explain==_(&quot;The control point right of the selected point is nearly horizontal&quot;) || explain==_(&quot;The control point left of the selected point is nearly horizontal&quot;) ||</span>
<span class="lineNum">     590 </span><span class="lineNoCov">          0 :             explain==_(&quot;The control point above the selected point is nearly vertical&quot;) || explain==_(&quot;The control point below the selected point is nearly vertical&quot;) ||</span>
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :             explain==_(&quot;The control point right of the selected point is nearly vertical&quot;) || explain==_(&quot;The control point left of the selected point is nearly vertical&quot;) ||</span>
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :             explain==_(&quot;This path should have been drawn in a counter-clockwise direction&quot;) || explain==_(&quot;This path should have been drawn in a clockwise direction&quot;) ||</span>
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :             explain==_(&quot;The selected spline attains its extrema somewhere other than its endpoints&quot;) ||</span>
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :             explain==_(&quot;This glyph's advance width is different from the standard width&quot;) ||</span>
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :             explain==_(&quot;This glyph's vertical advance is different from the standard width&quot;) ||</span>
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :             explain==_(&quot;This glyph is not mapped to any unicode code point, but its name should be.&quot;) ||</span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :             explain==_(&quot;The selected point is not at integral coordinates&quot;) ||</span>
<span class="lineNum">     598 </span><span class="lineNoCov">          0 :             explain==_(&quot;The selected point does not have integral control points&quot;) ||</span>
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :             explain==_(&quot;This glyph is mapped to a unicode code point which is different from its name.&quot;);</span>
<span class="lineNum">     600 </span>            :             
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :     GGadgetSetVisible(GWidgetGetControl(p-&gt;explainw,CID_Fix),fixable);</span>
<span class="lineNum">     602 </span>            : 
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :     if ( explain==_(&quot;This glyph contains a substitution or ligature entry which refers to an empty char&quot;) ) {</span>
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :         snprintf(buf,sizeof(buf),</span>
<span class="lineNum">     605 </span><span class="lineNoCov">          0 :                 _(&quot;%2$.20s refers to an empty character \&quot;%1$.20s\&quot;&quot;), p-&gt;badsubsname,</span>
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :                 p-&gt;badsubs_lsubtable-&gt;subtable_name );</span>
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :     } else if ( explain==_(&quot;This glyph contains anchor points from some, but not all anchor classes in a subtable&quot;) ) {</span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :         snprintf(buf,sizeof(buf),</span>
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :                 _(&quot;There is no anchor for class %1$.30s in subtable %2$.30s&quot;),</span>
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :                 p-&gt;missinganchor_class-&gt;name,</span>
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :                 p-&gt;missinganchor_class-&gt;subtable-&gt;subtable_name );</span>
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :     } else if ( explain==_(&quot;Two glyphs share the same unicode code point.\nChange the encoding to \&quot;Glyph Order\&quot; and use\nEdit-&gt;Select-&gt;Wildcard with the following code point&quot;) ) {</span>
<span class="lineNum">     613 </span><span class="lineNoCov">          0 :         snprintf(buf,sizeof(buf), _(&quot;U+%04x&quot;), sc-&gt;unicodeenc );</span>
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :     } else if ( explain==_(&quot;Two glyphs have the same name.\nChange the encoding to \&quot;Glyph Order\&quot; and use\nEdit-&gt;Select-&gt;Wildcard with the following name&quot;) ) {</span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :         snprintf(buf,sizeof(buf), _(&quot;%.40s&quot;), sc-&gt;name );</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :     } else if ( found==expected )</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :         buf[0]='\0';</span>
<span class="lineNum">     618 </span>            :     else {
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :         sprintf(buf,_(&quot;Found %1$.4g, expected %2$.4g&quot;), (double) found, (double) expected );</span>
<span class="lineNum">     620 </span>            :     }
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :     p-&gt;found = found; p-&gt;expected = expected;</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :     GGadgetSetTitle8(p-&gt;explainvals,buf);</span>
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :     GGadgetSetChecked(p-&gt;ignoregadg,false);</span>
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :     GHVBoxFitWindow(p-&gt;topbox);</span>
<span class="lineNum">     625 </span>            : 
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :     p-&gt;doneexplain = false;</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :     p-&gt;ignorethis = false;</span>
<span class="lineNum">     628 </span>            : 
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :     if ( sc!=p-&gt;lastcharopened || (CharView *) (sc-&gt;views)==NULL ) {</span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :         if ( p-&gt;cvopened!=NULL &amp;&amp; CVValid(p-&gt;fv-&gt;b.sf,p-&gt;lastcharopened,p-&gt;cvopened) )</span>
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :             GDrawDestroyWindow(p-&gt;cvopened-&gt;gw);</span>
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :         p-&gt;cvopened = NULL;</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :         if ( (CharView *) (sc-&gt;views)!=NULL )</span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :             GDrawRaise(((CharView *) (sc-&gt;views))-&gt;gw);</span>
<span class="lineNum">     635 </span>            :         else
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :             p-&gt;cvopened = CharViewCreate(sc,p-&gt;fv,-1);</span>
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :         GDrawSync(NULL);</span>
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :         GDrawProcessPendingEvents(NULL);</span>
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :         GDrawProcessPendingEvents(NULL);</span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :         p-&gt;lastcharopened = sc;</span>
<span class="lineNum">     641 </span>            :     }
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :     if ( explain==_(&quot;This glyph contains a substitution or ligature entry which refers to an empty char&quot;) ) {</span>
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :         SCCharInfo(sc,p-&gt;layer,p-&gt;fv-&gt;b.map,-1);</span>
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :         GDrawSync(NULL);</span>
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :         GDrawProcessPendingEvents(NULL);</span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :         GDrawProcessPendingEvents(NULL);</span>
<span class="lineNum">     647 </span>            :     }
<span class="lineNum">     648 </span>            :         
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :     SCUpdateAll(sc);            /* We almost certainly just selected something */</span>
<span class="lineNum">     650 </span>            : 
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :     GDrawSetVisible(p-&gt;explainw,true);</span>
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :     GDrawRaise(p-&gt;explainw);</span>
<span class="lineNum">     653 </span>            : 
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :     while ( !p-&gt;doneexplain )</span>
<span class="lineNum">     655 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">     656 </span>            :     /*GDrawSetVisible(p-&gt;explainw,false);*/          /* KDE gets unhappy about this and refuses to show the window later. I don't know why */
<span class="lineNum">     657 </span>            : 
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :     if ( p-&gt;cv!=NULL ) {</span>
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :         CVClearSel(p-&gt;cv);</span>
<span class="lineNum">     660 </span>            :     } else {
<span class="lineNum">     661 </span><span class="lineNoCov">          0 :         for ( spl = p-&gt;sc-&gt;layers[p-&gt;layer].splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :             spl-&gt;first-&gt;selected = false;</span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :             first = NULL;</span>
<span class="lineNum">     664 </span><span class="lineNoCov">          0 :             for ( spline = spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">     665 </span><span class="lineNoCov">          0 :                 spline-&gt;to-&gt;selected = false;</span>
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :                 if ( first==NULL ) first = spline;</span>
<span class="lineNum">     667 </span>            :             }
<span class="lineNum">     668 </span>            :         }
<span class="lineNum">     669 </span>            :     }
<a name="670"><span class="lineNum">     670 </span>            : }</a>
<span class="lineNum">     671 </span>            : 
<span class="lineNum">     672 </span><span class="lineNoCov">          0 : static void _ExplainIt(struct problems *p, int enc, char *explain,</span>
<span class="lineNum">     673 </span>            :         real found, real expected ) {
<span class="lineNum">     674 </span><span class="lineNoCov">          0 :     ExplainIt(p,p-&gt;sc=SFMakeChar(p-&gt;fv-&gt;b.sf,p-&gt;fv-&gt;b.map,enc),explain,found,expected);</span>
<span class="lineNum">     675 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     676 </span>            : 
<span class="lineNum">     677 </span>            : /* if they deleted a point or a splineset while we were explaining then we */
<a name="678"><span class="lineNum">     678 </span>            : /*  need to do some fix-ups. This routine detects a deletion and lets us know */</a>
<span class="lineNum">     679 </span>            : /*  that more processing is needed */
<span class="lineNum">     680 </span><span class="lineNoCov">          0 : static int missing(struct problems *p,SplineSet *test, SplinePoint *sp) {</span>
<span class="lineNum">     681 </span>            :     SplinePointList *spl, *check;
<span class="lineNum">     682 </span>            :     SplinePoint *tsp;
<span class="lineNum">     683 </span>            : 
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :     if ( !p-&gt;explain )</span>
<span class="lineNum">     685 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     686 </span>            : 
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :     if ( p-&gt;cv!=NULL )</span>
<span class="lineNum">     688 </span><span class="lineNoCov">          0 :         spl = p-&gt;cv-&gt;b.layerheads[p-&gt;cv-&gt;b.drawmode]-&gt;splines;</span>
<span class="lineNum">     689 </span>            :     else
<span class="lineNum">     690 </span><span class="lineNoCov">          0 :         spl = p-&gt;sc-&gt;layers[p-&gt;layer].splines;</span>
<span class="lineNum">     691 </span><span class="lineNoCov">          0 :     for ( check = spl; check!=test &amp;&amp; check!=NULL; check = check-&gt;next );</span>
<span class="lineNum">     692 </span><span class="lineNoCov">          0 :     if ( check==NULL )</span>
<span class="lineNum">     693 </span><span class="lineNoCov">          0 : return( true );         /* Deleted splineset */</span>
<span class="lineNum">     694 </span>            : 
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :     if ( sp!=NULL ) {</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :         for ( tsp=test-&gt;first; tsp!=sp ; ) {</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :             if ( tsp-&gt;next==NULL )</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :             tsp = tsp-&gt;next-&gt;to;</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :             if ( tsp==test-&gt;first )</span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     702 </span>            :         }
<span class="lineNum">     703 </span>            :     }
<span class="lineNum">     704 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="705"><span class="lineNum">     705 </span>            : }</a>
<span class="lineNum">     706 </span>            : 
<span class="lineNum">     707 </span><span class="lineNoCov">          0 : static int missingspline(struct problems *p,SplineSet *test, Spline *spline) {</span>
<span class="lineNum">     708 </span>            :     SplinePointList *spl, *check;
<span class="lineNum">     709 </span><span class="lineNoCov">          0 :     Spline *t, *first=NULL;</span>
<span class="lineNum">     710 </span>            : 
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :     if ( !p-&gt;explain )</span>
<span class="lineNum">     712 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     713 </span>            : 
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :     if ( p-&gt;cv!=NULL )</span>
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :         spl = p-&gt;cv-&gt;b.layerheads[p-&gt;cv-&gt;b.drawmode]-&gt;splines;</span>
<span class="lineNum">     716 </span>            :     else
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :         spl = p-&gt;sc-&gt;layers[p-&gt;layer].splines;</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :     for ( check = spl; check!=test &amp;&amp; check!=NULL; check = check-&gt;next );</span>
<span class="lineNum">     719 </span><span class="lineNoCov">          0 :     if ( check==NULL )</span>
<span class="lineNum">     720 </span><span class="lineNoCov">          0 : return( true );         /* Deleted splineset */</span>
<span class="lineNum">     721 </span>            : 
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :     for ( t=test-&gt;first-&gt;next; t!=NULL &amp;&amp; t!=first &amp;&amp; t!=spline; t = t-&gt;to-&gt;next )</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :         if ( first==NULL ) first = t;</span>
<span class="lineNum">     724 </span><span class="lineNoCov">          0 : return( t!=spline );</span>
<a name="725"><span class="lineNum">     725 </span>            : }</a>
<span class="lineNum">     726 </span>            : 
<span class="lineNum">     727 </span><span class="lineNoCov">          0 : static int missinghint(StemInfo *base, StemInfo *findme) {</span>
<span class="lineNum">     728 </span>            : 
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :     while ( base!=NULL &amp;&amp; base!=findme )</span>
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :         base = base-&gt;next;</span>
<span class="lineNum">     731 </span><span class="lineNoCov">          0 : return( base==NULL );</span>
<a name="732"><span class="lineNum">     732 </span>            : }</a>
<span class="lineNum">     733 </span>            : 
<span class="lineNum">     734 </span><span class="lineNoCov">          0 : static int missingschint(StemInfo *findme, SplineChar *sc) {</span>
<span class="lineNum">     735 </span>            :     StemInfo *base;
<span class="lineNum">     736 </span>            : 
<span class="lineNum">     737 </span><span class="lineNoCov">          0 :     for ( base = sc-&gt;hstem; base!=NULL; base=base-&gt;next )</span>
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :         if ( base==findme )</span>
<span class="lineNum">     739 </span><span class="lineNoCov">          0 : return( false );                /* Hasn't been deleted */</span>
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :     for ( base = sc-&gt;vstem; base!=NULL; base=base-&gt;next )</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :         if ( base==findme )</span>
<span class="lineNum">     742 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     743 </span>            : 
<span class="lineNum">     744 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="745"><span class="lineNum">     745 </span>            : }</a>
<span class="lineNum">     746 </span>            : 
<span class="lineNum">     747 </span><span class="lineNoCov">          0 : static int HVITest(struct problems *p,BasePoint *to, BasePoint *from,</span>
<span class="lineNum">     748 </span>            :         Spline *spline, int hasia, real ia) {
<span class="lineNum">     749 </span>            :     real yoff, xoff, angle;
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :     int ishor=false, isvert=false, isital=false;</span>
<span class="lineNum">     751 </span>            :     int isto;
<span class="lineNum">     752 </span>            :     int type;
<span class="lineNum">     753 </span>            :     BasePoint *base, *other;
<span class="lineNum">     754 </span>            :     static char *hmsgs[5] = {
<span class="lineNum">     755 </span>            :         N_(&quot;The selected line segment is nearly horizontal&quot;),
<span class="lineNum">     756 </span>            :         N_(&quot;The control point above the selected point is nearly horizontal&quot;),
<span class="lineNum">     757 </span>            :         N_(&quot;The control point below the selected point is nearly horizontal&quot;),
<span class="lineNum">     758 </span>            :         N_(&quot;The control point right of the selected point is nearly horizontal&quot;),
<span class="lineNum">     759 </span>            :         N_(&quot;The control point left of the selected point is nearly horizontal&quot;)
<span class="lineNum">     760 </span>            :     };
<span class="lineNum">     761 </span>            :     static char *vmsgs[5] = {
<span class="lineNum">     762 </span>            :         N_(&quot;The selected line segment is nearly vertical&quot;),
<span class="lineNum">     763 </span>            :         N_(&quot;The control point above the selected point is nearly vertical&quot;),
<span class="lineNum">     764 </span>            :         N_(&quot;The control point below the selected point is nearly vertical&quot;),
<span class="lineNum">     765 </span>            :         N_(&quot;The control point right of the selected point is nearly vertical&quot;),
<span class="lineNum">     766 </span>            :         N_(&quot;The control point left of the selected point is nearly vertical&quot;)
<span class="lineNum">     767 </span>            :     };
<span class="lineNum">     768 </span>            :     static char *imsgs[5] = {
<span class="lineNum">     769 </span>            :         N_(&quot;The selected line segment is near the italic angle&quot;),
<span class="lineNum">     770 </span>            :         N_(&quot;The control point above the selected point is near the italic angle&quot;),
<span class="lineNum">     771 </span>            :         N_(&quot;The control point below the selected point is near the italic angle&quot;),
<span class="lineNum">     772 </span>            :         N_(&quot;The control point right of the selected point is near the italic angle&quot;),
<span class="lineNum">     773 </span>            :         N_(&quot;The control point left of the selected point is near the italic angle&quot;)
<span class="lineNum">     774 </span>            :     };
<span class="lineNum">     775 </span>            : 
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :     yoff = to-&gt;y-from-&gt;y;</span>
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :     xoff = to-&gt;x-from-&gt;x;</span>
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :     angle = atan2(yoff,xoff);</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :     if ( angle&lt;0 )</span>
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :         angle += 3.1415926535897932;</span>
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :     if ( angle&lt;.1 || angle&gt;3.1415926535897932-.1 ) {</span>
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :         if ( yoff!=0 )</span>
<span class="lineNum">     783 </span><span class="lineNoCov">          0 :             ishor = true;</span>
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :     } else if ( angle&gt;1.5707963-.1 &amp;&amp; angle&lt;1.5707963+.1 ) {</span>
<span class="lineNum">     785 </span><span class="lineNoCov">          0 :         if ( xoff!=0 )</span>
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :             isvert = true;</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :     } else if ( hasia &amp;&amp; angle&gt;ia-.1 &amp;&amp; angle&lt;ia+.1 ) {</span>
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :         if ( angle&lt;ia-.03 || angle&gt;ia+.03 )</span>
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :             isital = true;</span>
<span class="lineNum">     790 </span>            :     }
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :     if ( ishor || isvert || isital ) {</span>
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :         isto = false;</span>
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :         if ( &amp;spline-&gt;from-&gt;me==from || &amp;spline-&gt;from-&gt;me==to )</span>
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :             spline-&gt;from-&gt;selected = true;</span>
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :         if ( &amp;spline-&gt;to-&gt;me==from || &amp;spline-&gt;to-&gt;me==to )</span>
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :             spline-&gt;to-&gt;selected = isto = true;</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :         if ( from==&amp;spline-&gt;from-&gt;me || from == &amp;spline-&gt;to-&gt;me ) {</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :             base = from; other = to;</span>
<span class="lineNum">     799 </span>            :         } else {
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :             base = to; other = from;</span>
<span class="lineNum">     801 </span>            :         }
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :         if ( &amp;spline-&gt;from-&gt;me==from &amp;&amp; &amp;spline-&gt;to-&gt;me==to ) {</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :             type = 0;   /* Line */</span>
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :             if ( (ishor &amp;&amp; xoff&lt;0) || (isvert &amp;&amp; yoff&lt;0)) {</span>
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :                 base = from;</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :                 other = to;</span>
<span class="lineNum">     807 </span>            :             } else {
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :                 base = to;</span>
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :                 other = from;</span>
<span class="lineNum">     810 </span>            :             }
<span class="lineNum">     811 </span><span class="lineNoCov">          0 :         } else if ( abs(yoff)&gt;abs(xoff) )</span>
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :             type = ((yoff&gt;0) ^ isto)?1:2;</span>
<span class="lineNum">     813 </span>            :         else
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :             type = ((xoff&gt;0) ^ isto)?3:4;</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :         if ( ishor )</span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :             ExplainIt(p,p-&gt;sc,_(hmsgs[type]), other-&gt;y,base-&gt;y);</span>
<span class="lineNum">     817 </span><span class="lineNoCov">          0 :         else if ( isvert )</span>
<span class="lineNum">     818 </span><span class="lineNoCov">          0 :             ExplainIt(p,p-&gt;sc,_(vmsgs[type]), other-&gt;x,base-&gt;x);</span>
<span class="lineNum">     819 </span>            :         else
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :             ExplainIt(p,p-&gt;sc,_(imsgs[type]),0,0);</span>
<span class="lineNum">     821 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     822 </span>            :     }
<span class="lineNum">     823 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     824 </span>            : }
<span class="lineNum">     825 </span>            : 
<a name="826"><span class="lineNum">     826 </span>            : /* Is the control point outside of the spline segment when projected onto the */</a>
<span class="lineNum">     827 </span>            : /*  vector between the end points of the spline segment? */
<span class="lineNum">     828 </span><span class="lineNoCov">          0 : static int OddCPCheck(BasePoint *cp,BasePoint *base,BasePoint *v,</span>
<span class="lineNum">     829 </span>            :         SplinePoint *sp, struct problems *p) {
<span class="lineNum">     830 </span><span class="lineNoCov">          0 :     real len = (cp-&gt;x-base-&gt;x)*v-&gt;x+ (cp-&gt;y-base-&gt;y)*v-&gt;y;</span>
<span class="lineNum">     831 </span>            :     real xoff, yoff;
<span class="lineNum">     832 </span><span class="lineNoCov">          0 :     char *msg=NULL;</span>
<span class="lineNum">     833 </span>            : 
<span class="lineNum">     834 </span><span class="lineNoCov">          0 :     if ( len&lt;0 || len&gt;1 || (len==0 &amp;&amp; &amp;sp-&gt;me!=base) || (len==1 &amp;&amp; &amp;sp-&gt;me==base)) {</span>
<span class="lineNum">     835 </span><span class="lineNoCov">          0 :         xoff = cp-&gt;x-sp-&gt;me.x; yoff = cp-&gt;y-sp-&gt;me.y;</span>
<span class="lineNum">     836 </span><span class="lineNoCov">          0 :         if ( fabs(yoff)&gt;fabs(xoff) )</span>
<span class="lineNum">     837 </span><span class="lineNoCov">          0 :             msg = yoff&gt;0?_(&quot;The control point above the selected point is outside the spline segment&quot;):_(&quot;The control point below the selected point is outside the spline segment&quot;);</span>
<span class="lineNum">     838 </span>            :         else
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :             msg = xoff&gt;0?_(&quot;The control point right of the selected point is outside the spline segment&quot;):_(&quot;The control point left of the selected point is outside the spline segment&quot;);</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :         sp-&gt;selected = true;</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :         ExplainIt(p,p-&gt;sc,msg, 0,0);</span>
<span class="lineNum">     842 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     843 </span>            :     }
<span class="lineNum">     844 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="845"><span class="lineNum">     845 </span>            : }</a>
<span class="lineNum">     846 </span>            : 
<span class="lineNum">     847 </span><span class="lineNoCov">          0 : static int Hint3Check(struct problems *p,StemInfo *h) {</span>
<span class="lineNum">     848 </span>            :     StemInfo *h2, *h3;
<span class="lineNum">     849 </span>            : 
<span class="lineNum">     850 </span>            :     /* Must be three hints to be interesting */
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :     if ( h==NULL || (h2=h-&gt;next)==NULL || (h3=h2-&gt;next)==NULL )</span>
<span class="lineNum">     852 </span><span class="lineNoCov">          0 : return(false);</span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :     if ( h3-&gt;next!=NULL ) {</span>
<span class="lineNum">     854 </span>            :         StemInfo *bad, *goods[3];
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :         if ( h3-&gt;next-&gt;next!=NULL )       /* Don't try to find a subset with 5 */</span>
<span class="lineNum">     856 </span><span class="lineNoCov">          0 : return(false);</span>
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :         if ( h-&gt;width==h2-&gt;width || h-&gt;width==h3-&gt;width ) {</span>
<span class="lineNum">     858 </span><span class="lineNoCov">          0 :             goods[0] = h;</span>
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :             if ( h-&gt;width==h2-&gt;width ) {</span>
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :                 goods[1] = h2;</span>
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :                 if ( h-&gt;width==h3-&gt;width &amp;&amp; h-&gt;width!=h3-&gt;next-&gt;width ) {</span>
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :                     goods[2] = h3;</span>
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :                     bad = h3-&gt;next;</span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :                 } else if ( h-&gt;width!=h3-&gt;width &amp;&amp; h-&gt;width==h3-&gt;next-&gt;width ) {</span>
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :                     goods[2] = h3-&gt;next;</span>
<span class="lineNum">     866 </span><span class="lineNoCov">          0 :                     bad = h3;</span>
<span class="lineNum">     867 </span>            :                 } else
<span class="lineNum">     868 </span><span class="lineNoCov">          0 : return(false);</span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :             } else if ( h-&gt;width==h3-&gt;width &amp;&amp; h-&gt;width==h3-&gt;next-&gt;width ) {</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :                 goods[1] = h3;</span>
<span class="lineNum">     871 </span><span class="lineNoCov">          0 :                 goods[2] = h3-&gt;next;</span>
<span class="lineNum">     872 </span><span class="lineNoCov">          0 :                 bad = h2;</span>
<span class="lineNum">     873 </span>            :             } else
<span class="lineNum">     874 </span><span class="lineNoCov">          0 : return(false);</span>
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :         } else if ( h2-&gt;width == h3-&gt;width &amp;&amp; h2-&gt;width==h3-&gt;next-&gt;width ) {</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :             bad = h;</span>
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :             goods[0] = h2; goods[1] = h3; goods[2] = h3-&gt;next;</span>
<span class="lineNum">     878 </span>            :         } else
<span class="lineNum">     879 </span><span class="lineNoCov">          0 : return(false);</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :         if ( goods[2]-&gt;start-goods[1]-&gt;start == goods[1]-&gt;start-goods[0]-&gt;start ) {</span>
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :             bad-&gt;active = true;</span>
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :             ExplainIt(p,p-&gt;sc,_(&quot;This glyph has four hints, but if this one were omitted it would fit a stem3 hint&quot;),0,0);</span>
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :             if ( !missinghint(p-&gt;sc-&gt;hstem,bad) || !missinghint(p-&gt;sc-&gt;vstem,bad))</span>
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :                 bad-&gt;active = false;</span>
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :                 p-&gt;stem3 = false;</span>
<span class="lineNum">     887 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     888 </span>            :         }
<span class="lineNum">     889 </span><span class="lineNoCov">          0 : return(false);</span>
<span class="lineNum">     890 </span>            :     }
<span class="lineNum">     891 </span>            : 
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :     if ( h-&gt;width==h2-&gt;width &amp;&amp; h-&gt;width==h3-&gt;width &amp;&amp;</span>
<span class="lineNum">     893 </span><span class="lineNoCov">          0 :             h2-&gt;start-h-&gt;start == h3-&gt;start-h2-&gt;start ) {</span>
<span class="lineNum">     894 </span><span class="lineNoCov">          0 :         if ( p-&gt;showexactstem3 ) {</span>
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :             ExplainIt(p,p-&gt;sc,_(&quot;This glyph can use a stem3 hint&quot;),0,0);</span>
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">     897 </span><span class="lineNoCov">          0 :                 p-&gt;showexactstem3 = false;</span>
<span class="lineNum">     898 </span>            :         }
<span class="lineNum">     899 </span><span class="lineNoCov">          0 : return( false );                /* It IS a stem3, so don't complain */</span>
<span class="lineNum">     900 </span>            :     }
<span class="lineNum">     901 </span>            : 
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :     if ( h-&gt;width==h2-&gt;width &amp;&amp; h-&gt;width==h3-&gt;width ) {</span>
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :         if ( h2-&gt;start-h-&gt;start+p-&gt;near &gt; h3-&gt;start-h2-&gt;start &amp;&amp;</span>
<span class="lineNum">     904 </span><span class="lineNoCov">          0 :                 h2-&gt;start-h-&gt;start-p-&gt;near &lt; h3-&gt;start-h2-&gt;start ) {</span>
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :             ExplainIt(p,p-&gt;sc,_(&quot;The counters between these hints are not the same size, bad for a stem3 hint&quot;),0,0);</span>
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">     907 </span><span class="lineNoCov">          0 :                 p-&gt;stem3 = false;</span>
<span class="lineNum">     908 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     909 </span>            :         }
<span class="lineNum">     910 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     911 </span>            :     }
<span class="lineNum">     912 </span>            : 
<span class="lineNum">     913 </span><span class="lineNoCov">          0 :     if ( (h2-&gt;start-h-&gt;start+p-&gt;near &gt; h3-&gt;start-h2-&gt;start &amp;&amp;</span>
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :              h2-&gt;start-h-&gt;start-p-&gt;near &lt; h3-&gt;start-h2-&gt;start ) ||</span>
<span class="lineNum">     915 </span><span class="lineNoCov">          0 :             (h2-&gt;start-h-&gt;start-h-&gt;width+p-&gt;near &gt; h3-&gt;start-h2-&gt;start-h2-&gt;width &amp;&amp;</span>
<span class="lineNum">     916 </span><span class="lineNoCov">          0 :              h2-&gt;start-h-&gt;start-h-&gt;width-p-&gt;near &lt; h3-&gt;start-h2-&gt;start-h2-&gt;width )) {</span>
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :         if ( h-&gt;width==h2-&gt;width ) {</span>
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :             if ( h-&gt;width+p-&gt;near &gt; h3-&gt;width &amp;&amp; h-&gt;width-p-&gt;near &lt; h3-&gt;width ) {</span>
<span class="lineNum">     919 </span><span class="lineNoCov">          0 :                 h3-&gt;active = true;</span>
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :                 ExplainIt(p,p-&gt;sc,_(&quot;This hint has the wrong width for a stem3 hint&quot;),0,0);</span>
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :                 if ( !missinghint(p-&gt;sc-&gt;hstem,h3) || !missinghint(p-&gt;sc-&gt;vstem,h3))</span>
<span class="lineNum">     922 </span><span class="lineNoCov">          0 :                     h3-&gt;active = false;</span>
<span class="lineNum">     923 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis )</span>
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :                     p-&gt;stem3 = false;</span>
<span class="lineNum">     925 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     926 </span>            :             } else
<span class="lineNum">     927 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     928 </span>            :         }
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :         if ( h-&gt;width==h3-&gt;width ) {</span>
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :             if ( h-&gt;width+p-&gt;near &gt; h2-&gt;width &amp;&amp; h-&gt;width-p-&gt;near &lt; h2-&gt;width ) {</span>
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :                 h2-&gt;active = true;</span>
<span class="lineNum">     932 </span><span class="lineNoCov">          0 :                 ExplainIt(p,p-&gt;sc,_(&quot;This hint has the wrong width for a stem3 hint&quot;),0,0);</span>
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :                 if ( !missinghint(p-&gt;sc-&gt;hstem,h2) || !missinghint(p-&gt;sc-&gt;vstem,h2))</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :                     h2-&gt;active = false;</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis )</span>
<span class="lineNum">     936 </span><span class="lineNoCov">          0 :                     p-&gt;stem3 = false;</span>
<span class="lineNum">     937 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     938 </span>            :             } else
<span class="lineNum">     939 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     940 </span>            :         }
<span class="lineNum">     941 </span><span class="lineNoCov">          0 :         if ( h2-&gt;width==h3-&gt;width ) {</span>
<span class="lineNum">     942 </span><span class="lineNoCov">          0 :             if ( h2-&gt;width+p-&gt;near &gt; h-&gt;width &amp;&amp; h2-&gt;width-p-&gt;near &lt; h-&gt;width ) {</span>
<span class="lineNum">     943 </span><span class="lineNoCov">          0 :                 h-&gt;active = true;</span>
<span class="lineNum">     944 </span><span class="lineNoCov">          0 :                 ExplainIt(p,p-&gt;sc,_(&quot;This hint has the wrong width for a stem3 hint&quot;),0,0);</span>
<span class="lineNum">     945 </span><span class="lineNoCov">          0 :                 if ( !missinghint(p-&gt;sc-&gt;hstem,h) || !missinghint(p-&gt;sc-&gt;vstem,h))</span>
<span class="lineNum">     946 </span><span class="lineNoCov">          0 :                     h-&gt;active = false;</span>
<span class="lineNum">     947 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis )</span>
<span class="lineNum">     948 </span><span class="lineNoCov">          0 :                     p-&gt;stem3 = false;</span>
<span class="lineNum">     949 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">     950 </span>            :             } else
<span class="lineNum">     951 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">     952 </span>            :         }
<span class="lineNum">     953 </span>            :     }
<span class="lineNum">     954 </span><span class="lineNoCov">          0 : return( false );</span>
<a name="955"><span class="lineNum">     955 </span>            : }</a>
<span class="lineNum">     956 </span>            : 
<span class="lineNum">     957 </span><span class="lineNoCov">          0 : static int probRefDepth(RefChar *r,int layer) {</span>
<span class="lineNum">     958 </span>            :     RefChar *ref;
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :     int cur, max=0;</span>
<span class="lineNum">     960 </span>            : 
<span class="lineNum">     961 </span><span class="lineNoCov">          0 :     for ( ref= r-&gt;sc-&gt;layers[layer].refs; ref!=NULL; ref=ref-&gt;next ) {</span>
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :         cur = probRefDepth(ref,layer);</span>
<span class="lineNum">     963 </span><span class="lineNoCov">          0 :         if ( cur&gt;max ) max = cur;</span>
<span class="lineNum">     964 </span>            :     }
<span class="lineNum">     965 </span><span class="lineNoCov">          0 : return( max+1 );</span>
<a name="966"><span class="lineNum">     966 </span>            : }</a>
<span class="lineNum">     967 </span>            : 
<span class="lineNum">     968 </span><span class="lineNoCov">          0 : static int SCRefDepth(SplineChar *sc,int layer) {</span>
<span class="lineNum">     969 </span>            :     RefChar *ref;
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :     int cur, max=0;</span>
<span class="lineNum">     971 </span>            : 
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :     for ( ref= sc-&gt;layers[layer].refs; ref!=NULL; ref=ref-&gt;next ) {</span>
<span class="lineNum">     973 </span><span class="lineNoCov">          0 :         cur = probRefDepth(ref,layer);</span>
<span class="lineNum">     974 </span><span class="lineNoCov">          0 :         if ( cur&gt;max ) max = cur;</span>
<span class="lineNum">     975 </span>            :     }
<span class="lineNum">     976 </span><span class="lineNoCov">          0 : return( max );</span>
<a name="977"><span class="lineNum">     977 </span>            : }</a>
<span class="lineNum">     978 </span>            : 
<span class="lineNum">     979 </span><span class="lineNoCov">          0 : static int SPLPointCnt(SplinePointList *spl) {</span>
<span class="lineNum">     980 </span>            :     SplinePoint *sp;
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :     int cnt=0;</span>
<span class="lineNum">     982 </span>            : 
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :     for ( ; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">     984 </span><span class="lineNoCov">          0 :         for ( sp = spl-&gt;first; ; ) {</span>
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :             ++cnt;</span>
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :             if ( sp-&gt;prev!=NULL &amp;&amp; !sp-&gt;prev-&gt;knownlinear ) {</span>
<span class="lineNum">     987 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;prev-&gt;order2 )</span>
<span class="lineNum">     988 </span><span class="lineNoCov">          0 :                     ++cnt;</span>
<span class="lineNum">     989 </span>            :                 else
<span class="lineNum">     990 </span><span class="lineNoCov">          0 :                     cnt += 2;</span>
<span class="lineNum">     991 </span>            :             }
<span class="lineNum">     992 </span><span class="lineNoCov">          0 :             if ( sp-&gt;next==NULL )</span>
<span class="lineNum">     993 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :             sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :             if ( sp==spl-&gt;first )</span>
<span class="lineNum">     996 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     997 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     998 </span>            :     }
<span class="lineNum">     999 </span><span class="lineNoCov">          0 : return( cnt );</span>
<a name="1000"><span class="lineNum">    1000 </span>            : }</a>
<span class="lineNum">    1001 </span>            : 
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 : static RefChar *FindRefOfSplineInLayer(Layer *layer,Spline *spline) {</span>
<span class="lineNum">    1003 </span>            :     RefChar *r;
<span class="lineNum">    1004 </span>            :     SplineSet *ss;
<span class="lineNum">    1005 </span>            :     Spline *s, *first;
<span class="lineNum">    1006 </span>            : 
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 :     for ( r=layer-&gt;refs; r!=NULL; r=r-&gt;next ) {</span>
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 :         for ( ss=r-&gt;layers[0].splines; ss!=NULL; ss=ss-&gt;next ) {</span>
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 :             first = NULL;</span>
<span class="lineNum">    1010 </span><span class="lineNoCov">          0 :             for ( s=ss-&gt;first-&gt;next ; s!=NULL &amp;&amp; s!=first; s=s-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :                 if ( first==NULL ) first = s;</span>
<span class="lineNum">    1012 </span><span class="lineNoCov">          0 :                 if ( s==spline )</span>
<span class="lineNum">    1013 </span><span class="lineNoCov">          0 : return( r );</span>
<span class="lineNum">    1014 </span>            :             }
<span class="lineNum">    1015 </span>            :         }
<span class="lineNum">    1016 </span>            :     }
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 : return( NULL );</span>
<a name="1018"><span class="lineNum">    1018 </span>            : }</a>
<span class="lineNum">    1019 </span>            : 
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 : static int SCProblems(CharView *cv,SplineChar *sc,struct problems *p) {</span>
<span class="lineNum">    1021 </span>            :     SplineSet *spl, *test;
<span class="lineNum">    1022 </span>            :     Spline *spline, *first;
<span class="lineNum">    1023 </span>            :     Layer *cur;
<span class="lineNum">    1024 </span>            :     SplinePoint *sp, *nsp;
<span class="lineNum">    1025 </span><span class="lineNoCov">          0 :     int needsupdate=false, changed=false;</span>
<span class="lineNum">    1026 </span>            :     StemInfo *h;
<span class="lineNum">    1027 </span>            :     RefChar *r1, *r2;
<span class="lineNum">    1028 </span>            :     int uni;
<span class="lineNum">    1029 </span>            :     DBounds bb;
<span class="lineNum">    1030 </span>            : 
<span class="lineNum">    1031 </span>            :   restart:
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :     if ( cv!=NULL ) {</span>
<span class="lineNum">    1033 </span><span class="lineNoCov">          0 :         needsupdate = CVClearSel(cv);</span>
<span class="lineNum">    1034 </span><span class="lineNoCov">          0 :         cur = cv-&gt;b.layerheads[cv-&gt;b.drawmode];</span>
<span class="lineNum">    1035 </span><span class="lineNoCov">          0 :         spl = cur-&gt;splines;</span>
<span class="lineNum">    1036 </span><span class="lineNoCov">          0 :         sc = cv-&gt;b.sc;</span>
<span class="lineNum">    1037 </span>            :     } else {
<span class="lineNum">    1038 </span><span class="lineNoCov">          0 :         for ( spl = sc-&gt;layers[p-&gt;layer].splines; spl!=NULL; spl = spl-&gt;next ) {</span>
<span class="lineNum">    1039 </span><span class="lineNoCov">          0 :             if ( spl-&gt;first-&gt;selected ) { needsupdate = true; spl-&gt;first-&gt;selected = false; }</span>
<span class="lineNum">    1040 </span><span class="lineNoCov">          0 :             first = NULL;</span>
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 :             for ( spline = spl-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :                 if ( spline-&gt;to-&gt;selected )</span>
<span class="lineNum">    1043 </span><span class="lineNoCov">          0 :                     { needsupdate = true; spline-&gt;to-&gt;selected = false; }</span>
<span class="lineNum">    1044 </span><span class="lineNoCov">          0 :                 if ( first==NULL ) first = spline;</span>
<span class="lineNum">    1045 </span>            :             }
<span class="lineNum">    1046 </span>            :         }
<span class="lineNum">    1047 </span><span class="lineNoCov">          0 :         cur = &amp;sc-&gt;layers[p-&gt;layer];</span>
<span class="lineNum">    1048 </span><span class="lineNoCov">          0 :         spl = cur-&gt;splines;</span>
<span class="lineNum">    1049 </span>            :     }
<span class="lineNum">    1050 </span><span class="lineNoCov">          0 :     p-&gt;sc = sc;</span>
<span class="lineNum">    1051 </span><span class="lineNoCov">          0 :     if (( p-&gt;ptnearhint || p-&gt;hintwidthnearval || p-&gt;hintwithnopt ) &amp;&amp;</span>
<span class="lineNum">    1052 </span><span class="lineNoCov">          0 :             sc-&gt;changedsincelasthinted &amp;&amp; !sc-&gt;manualhints )</span>
<span class="lineNum">    1053 </span><span class="lineNoCov">          0 :         SplineCharAutoHint(sc,p-&gt;layer,NULL);</span>
<span class="lineNum">    1054 </span>            : 
<span class="lineNum">    1055 </span><span class="lineNoCov">          0 :     if ( p-&gt;openpaths ) {</span>
<span class="lineNum">    1056 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish; test=test-&gt;next ) {</span>
<span class="lineNum">    1057 </span>            :             /* I'm also including in &quot;open paths&quot; the special case of a */
<span class="lineNum">    1058 </span>            :             /*  singleton point with connects to itself */
<span class="lineNum">    1059 </span><span class="lineNoCov">          0 :             if ( test-&gt;first!=NULL &amp;&amp; ( test-&gt;first-&gt;prev==NULL ||</span>
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :                     ( test-&gt;first-&gt;prev == test-&gt;first-&gt;next &amp;&amp;</span>
<span class="lineNum">    1061 </span><span class="lineNoCov">          0 :                         test-&gt;first-&gt;noprevcp &amp;&amp; test-&gt;first-&gt;nonextcp))) {</span>
<span class="lineNum">    1062 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    1063 </span><span class="lineNoCov">          0 :                 test-&gt;first-&gt;selected = test-&gt;last-&gt;selected = true;</span>
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;The two selected points are the endpoints of an open path&quot;),0,0);</span>
<span class="lineNum">    1065 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 :                     p-&gt;openpaths = false;</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1068 </span>            :                 }
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :                 if ( missing(p,test,NULL))</span>
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :       goto restart;</span>
<span class="lineNum">    1071 </span>            :             }
<span class="lineNum">    1072 </span>            :         }
<span class="lineNum">    1073 </span>            :     }
<span class="lineNum">    1074 </span>            : 
<span class="lineNum">    1075 </span><span class="lineNoCov">          0 :     if ( p-&gt;intersectingpaths &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1076 </span>            :         Spline *s, *s2;
<span class="lineNum">    1077 </span>            :         int found;
<span class="lineNum">    1078 </span><span class="lineNoCov">          0 :         spl = LayerAllSplines(cur);</span>
<span class="lineNum">    1079 </span><span class="lineNoCov">          0 :         found = SplineSetIntersect(spl,&amp;s,&amp;s2);</span>
<span class="lineNum">    1080 </span><span class="lineNoCov">          0 :         spl = LayerUnAllSplines(cur);</span>
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 :         if ( found ) {</span>
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    1083 </span><span class="lineNoCov">          0 :             if ( (r1 = FindRefOfSplineInLayer(cur,s))!=NULL )</span>
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :                 r1-&gt;selected = true;</span>
<span class="lineNum">    1085 </span>            :             else {
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :                 s-&gt;from-&gt;selected = true; s-&gt;to-&gt;selected = true;</span>
<span class="lineNum">    1087 </span>            :             }
<span class="lineNum">    1088 </span><span class="lineNoCov">          0 :             if ( (r2 = FindRefOfSplineInLayer(cur,s2))!=NULL )</span>
<span class="lineNum">    1089 </span><span class="lineNoCov">          0 :                 r2-&gt;selected = true;</span>
<span class="lineNum">    1090 </span>            :             else {
<span class="lineNum">    1091 </span><span class="lineNoCov">          0 :                 s2-&gt;from-&gt;selected = true; s2-&gt;to-&gt;selected = true;</span>
<span class="lineNum">    1092 </span>            :             }
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;The paths that make up this glyph intersect one another&quot;),0,0);</span>
<span class="lineNum">    1094 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 :                 p-&gt;intersectingpaths = false;</span>
<span class="lineNum">    1096 </span>            :     /* break; */
<span class="lineNum">    1097 </span>            :             }
<span class="lineNum">    1098 </span>            :         }
<span class="lineNum">    1099 </span>            :     }
<span class="lineNum">    1100 </span>            : 
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :     if ( p-&gt;nonintegral &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1102 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;nonintegral; test=test-&gt;next ) {</span>
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :             sp = test-&gt;first;</span>
<span class="lineNum">    1104 </span>            :             do {
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :                 int interp = SPInterpolate(sp);</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :                 int badme = interp</span>
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :                         ? (rint(2*sp-&gt;me.x)!=2*sp-&gt;me.x || rint(2*sp-&gt;me.y)!=2*sp-&gt;me.y)</span>
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :                         : (rint(sp-&gt;me.x)!=sp-&gt;me.x || rint(sp-&gt;me.y)!=sp-&gt;me.y);</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :                 if ( badme ||</span>
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :                         rint(sp-&gt;nextcp.x)!=sp-&gt;nextcp.x || rint(sp-&gt;nextcp.y)!=sp-&gt;nextcp.y ||</span>
<span class="lineNum">    1111 </span><span class="lineNoCov">          0 :                         rint(sp-&gt;prevcp.x)!=sp-&gt;prevcp.x || rint(sp-&gt;prevcp.y)!=sp-&gt;prevcp.y ) {</span>
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :                     changed = true;</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :                     sp-&gt;selected = true;</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :                     if ( badme )</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :                         ExplainIt(p,sc,_(&quot;The selected point is not at integral coordinates&quot;),0,0);</span>
<span class="lineNum">    1116 </span>            :                     else
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :                         ExplainIt(p,sc,_(&quot;The selected point does not have integral control points&quot;),0,0);</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :                     if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 :                         p-&gt;nonintegral = false;</span>
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1121 </span>            :                     }
<span class="lineNum">    1122 </span><span class="lineNoCov">          0 :                     if ( missing(p,test,nsp))</span>
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1124 </span>            :                 }
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 :                 sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1128 </span><span class="lineNoCov">          0 :             } while ( sp!=test-&gt;first &amp;&amp; !p-&gt;finish );</span>
<span class="lineNum">    1129 </span><span class="lineNoCov">          0 :             if ( !p-&gt;nonintegral )</span>
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1131 </span>            :         }
<span class="lineNum">    1132 </span>            :     }
<span class="lineNum">    1133 </span>            : 
<span class="lineNum">    1134 </span><span class="lineNoCov">          0 :     if ( p-&gt;pointstoofar &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 :         SplinePoint *lastsp=NULL;</span>
<span class="lineNum">    1136 </span>            :         BasePoint lastpt;
<span class="lineNum">    1137 </span>            : 
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 :         memset(&amp;lastpt,0,sizeof(lastpt));</span>
<span class="lineNum">    1139 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;pointstoofar; test=test-&gt;next ) {</span>
<span class="lineNum">    1140 </span><span class="lineNoCov">          0 :             sp = test-&gt;first;</span>
<span class="lineNum">    1141 </span>            :             do {
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :                 if ( BPTooFar(&amp;lastpt,&amp;sp-&gt;prevcp) ||</span>
<span class="lineNum">    1143 </span><span class="lineNoCov">          0 :                         BPTooFar(&amp;sp-&gt;prevcp,&amp;sp-&gt;me) ||</span>
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :                         BPTooFar(&amp;sp-&gt;me,&amp;sp-&gt;nextcp)) {</span>
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :                     changed = true;</span>
<span class="lineNum">    1146 </span><span class="lineNoCov">          0 :                     sp-&gt;selected = true;</span>
<span class="lineNum">    1147 </span><span class="lineNoCov">          0 :                     if ( lastsp==NULL ) {</span>
<span class="lineNum">    1148 </span><span class="lineNoCov">          0 :                         ExplainIt(p,sc,_(&quot;The selected point is too far from the origin&quot;),0,0);</span>
<span class="lineNum">    1149 </span>            :                     } else {
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :                         lastsp-&gt;selected = true;</span>
<span class="lineNum">    1151 </span><span class="lineNoCov">          0 :                         ExplainIt(p,sc,_(&quot;The selected points (or the intermediate control points) are too far apart&quot;),0,0);</span>
<span class="lineNum">    1152 </span>            :                     }
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :                     if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1154 </span><span class="lineNoCov">          0 :                         p-&gt;pointstoofar = false;</span>
<span class="lineNum">    1155 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1156 </span>            :                     }
<span class="lineNum">    1157 </span><span class="lineNoCov">          0 :                     if ( missing(p,test,sp))</span>
<span class="lineNum">    1158 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1159 </span>            :                 }
<span class="lineNum">    1160 </span><span class="lineNoCov">          0 :                 memcpy(&amp;lastpt,&amp;sp-&gt;nextcp,sizeof(lastpt));</span>
<span class="lineNum">    1161 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 :                 sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1164 </span><span class="lineNoCov">          0 :                 if ( sp==test-&gt;first ) {</span>
<span class="lineNum">    1165 </span><span class="lineNoCov">          0 :                     memcpy(&amp;lastpt,&amp;sp-&gt;me,sizeof(lastpt));</span>
<span class="lineNum">    1166 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1167 </span>            :                 }
<span class="lineNum">    1168 </span><span class="lineNoCov">          0 :             } while ( !p-&gt;finish );</span>
<span class="lineNum">    1169 </span><span class="lineNoCov">          0 :             if ( !p-&gt;pointstoofar )</span>
<span class="lineNum">    1170 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1171 </span>            :         }
<span class="lineNum">    1172 </span>            :     }
<span class="lineNum">    1173 </span>            : 
<span class="lineNum">    1174 </span><span class="lineNoCov">          0 :     if ( p-&gt;pointstooclose &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1175 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;pointstooclose; test=test-&gt;next ) {</span>
<span class="lineNum">    1176 </span><span class="lineNoCov">          0 :             sp = test-&gt;first;</span>
<span class="lineNum">    1177 </span>            :             do {
<span class="lineNum">    1178 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1179 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :                 nsp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 :                 if ( (nsp-&gt;me.x-sp-&gt;me.x)*(nsp-&gt;me.x-sp-&gt;me.x) + (nsp-&gt;me.y-sp-&gt;me.y)*(nsp-&gt;me.y-sp-&gt;me.y) &lt; 2*2 ) {</span>
<span class="lineNum">    1182 </span><span class="lineNoCov">          0 :                     changed = true;</span>
<span class="lineNum">    1183 </span><span class="lineNoCov">          0 :                     sp-&gt;selected = nsp-&gt;selected = true;</span>
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,_(&quot;The selected points are too close to each other&quot;),0,0);</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :                     if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :                         p-&gt;pointstooclose = false;</span>
<span class="lineNum">    1187 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1188 </span>            :                     }
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 :                     if ( missing(p,test,nsp))</span>
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1191 </span>            :                 }
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :                 sp = nsp;</span>
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :             } while ( sp!=test-&gt;first &amp;&amp; !p-&gt;finish );</span>
<span class="lineNum">    1194 </span><span class="lineNoCov">          0 :             if ( !p-&gt;pointstooclose )</span>
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1196 </span>            :         }
<span class="lineNum">    1197 </span>            :     }
<span class="lineNum">    1198 </span>            : 
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :     if ( p-&gt;xnearval &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1200 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;xnearval; test=test-&gt;next ) {</span>
<span class="lineNum">    1201 </span><span class="lineNoCov">          0 :             sp = test-&gt;first;</span>
<span class="lineNum">    1202 </span>            :             do {
<span class="lineNum">    1203 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;me.x-p-&gt;xval&lt;p-&gt;near &amp;&amp; p-&gt;xval-sp-&gt;me.x&lt;p-&gt;near &amp;&amp;</span>
<span class="lineNum">    1204 </span><span class="lineNoCov">          0 :                         sp-&gt;me.x!=p-&gt;xval ) {</span>
<span class="lineNum">    1205 </span><span class="lineNoCov">          0 :                     changed = true;</span>
<span class="lineNum">    1206 </span><span class="lineNoCov">          0 :                     sp-&gt;selected = true;</span>
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,_(&quot;The x coord of the selected point is near the specified value&quot;),sp-&gt;me.x,p-&gt;xval);</span>
<span class="lineNum">    1208 </span><span class="lineNoCov">          0 :                     if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :                         p-&gt;xnearval = false;</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1211 </span>            :                     }
<span class="lineNum">    1212 </span><span class="lineNoCov">          0 :                     if ( missing(p,test,sp))</span>
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1214 </span>            :                 }
<span class="lineNum">    1215 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 :                 sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :             } while ( sp!=test-&gt;first &amp;&amp; !p-&gt;finish );</span>
<span class="lineNum">    1219 </span><span class="lineNoCov">          0 :             if ( !p-&gt;xnearval )</span>
<span class="lineNum">    1220 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1221 </span>            :         }
<span class="lineNum">    1222 </span>            :     }
<span class="lineNum">    1223 </span>            : 
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :     if ( p-&gt;ynearval &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;ynearval; test=test-&gt;next ) {</span>
<span class="lineNum">    1226 </span><span class="lineNoCov">          0 :             sp = test-&gt;first;</span>
<span class="lineNum">    1227 </span>            :             do {
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;me.y-p-&gt;yval&lt;p-&gt;near &amp;&amp; p-&gt;yval-sp-&gt;me.y&lt;p-&gt;near &amp;&amp;</span>
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :                         sp-&gt;me.y != p-&gt;yval ) {</span>
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :                     changed = true;</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :                     sp-&gt;selected = true;</span>
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,_(&quot;The y coord of the selected point is near the specified value&quot;),sp-&gt;me.y,p-&gt;yval);</span>
<span class="lineNum">    1233 </span><span class="lineNoCov">          0 :                     if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1234 </span><span class="lineNoCov">          0 :                         p-&gt;ynearval = false;</span>
<span class="lineNum">    1235 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1236 </span>            :                     }
<span class="lineNum">    1237 </span><span class="lineNoCov">          0 :                     if ( missing(p,test,sp))</span>
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1239 </span>            :                 }
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1241 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :                 sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :             } while ( sp!=test-&gt;first &amp;&amp; !p-&gt;finish );</span>
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :             if ( !p-&gt;ynearval )</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1246 </span>            :         }
<span class="lineNum">    1247 </span>            :     }
<span class="lineNum">    1248 </span>            : 
<span class="lineNum">    1249 </span><span class="lineNoCov">          0 :     if ( p-&gt;ynearstd &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1250 </span>            :         real expected;
<span class="lineNum">    1251 </span>            :         char *msg;
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;ynearstd; test=test-&gt;next ) {</span>
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :             sp = test-&gt;first;</span>
<span class="lineNum">    1254 </span>            :             do {
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 :                 if (( sp-&gt;me.y-p-&gt;xheight&lt;p-&gt;near &amp;&amp; p-&gt;xheight-sp-&gt;me.y&lt;p-&gt;near &amp;&amp; sp-&gt;me.y!=p-&gt;xheight ) ||</span>
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :                         ( sp-&gt;me.y-p-&gt;caph&lt;p-&gt;near &amp;&amp; p-&gt;caph-sp-&gt;me.y&lt;p-&gt;near &amp;&amp; sp-&gt;me.y!=p-&gt;caph &amp;&amp; sp-&gt;me.y!=p-&gt;ascent ) ||</span>
<span class="lineNum">    1257 </span><span class="lineNoCov">          0 :                         ( sp-&gt;me.y-p-&gt;ascent&lt;p-&gt;near &amp;&amp; p-&gt;ascent-sp-&gt;me.y&lt;p-&gt;near &amp;&amp; sp-&gt;me.y!=p-&gt;caph &amp;&amp; sp-&gt;me.y!=p-&gt;ascent ) ||</span>
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :                         ( sp-&gt;me.y-p-&gt;descent&lt;p-&gt;near &amp;&amp; p-&gt;descent-sp-&gt;me.y&lt;p-&gt;near &amp;&amp; sp-&gt;me.y!=p-&gt;descent ) ||</span>
<span class="lineNum">    1259 </span><span class="lineNoCov">          0 :                         ( sp-&gt;me.y&lt;p-&gt;near &amp;&amp; -sp-&gt;me.y&lt;p-&gt;near &amp;&amp; sp-&gt;me.y!=0 ) ) {</span>
<span class="lineNum">    1260 </span><span class="lineNoCov">          0 :                     changed = true;</span>
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 :                     sp-&gt;selected = true;</span>
<span class="lineNum">    1262 </span><span class="lineNoCov">          0 :                     if ( sp-&gt;me.y&lt;p-&gt;near &amp;&amp; -sp-&gt;me.y&lt;p-&gt;near ) {</span>
<span class="lineNum">    1263 </span><span class="lineNoCov">          0 :                         msg = _(&quot;The y coord of the selected point is near the baseline&quot;);</span>
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 :                         expected = 0;</span>
<span class="lineNum">    1265 </span><span class="lineNoCov">          0 :                     } else if ( sp-&gt;me.y-p-&gt;xheight&lt;p-&gt;near &amp;&amp; p-&gt;xheight-sp-&gt;me.y&lt;p-&gt;near ) {</span>
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :                         msg = _(&quot;The y coord of the selected point is near the xheight&quot;);</span>
<span class="lineNum">    1267 </span><span class="lineNoCov">          0 :                         expected = p-&gt;xheight;</span>
<span class="lineNum">    1268 </span><span class="lineNoCov">          0 :                     } else if ( sp-&gt;me.y-p-&gt;caph&lt;p-&gt;near &amp;&amp; p-&gt;caph-sp-&gt;me.y&lt;p-&gt;near ) {</span>
<span class="lineNum">    1269 </span><span class="lineNoCov">          0 :                         msg = _(&quot;The y coord of the selected point is near the cap height&quot;);</span>
<span class="lineNum">    1270 </span><span class="lineNoCov">          0 :                         expected = p-&gt;caph;</span>
<span class="lineNum">    1271 </span><span class="lineNoCov">          0 :                     } else if ( sp-&gt;me.y-p-&gt;ascent&lt;p-&gt;near &amp;&amp; p-&gt;ascent-sp-&gt;me.y&lt;p-&gt;near ) {</span>
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 :                         msg = _(&quot;The y coord of the selected point is near the ascender height&quot;);</span>
<span class="lineNum">    1273 </span><span class="lineNoCov">          0 :                         expected = p-&gt;ascent;</span>
<span class="lineNum">    1274 </span>            :                     } else {
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :                         msg = _(&quot;The y coord of the selected point is near the descender height&quot;);</span>
<span class="lineNum">    1276 </span><span class="lineNoCov">          0 :                         expected = p-&gt;descent;</span>
<span class="lineNum">    1277 </span>            :                     }
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,msg,sp-&gt;me.y,expected);</span>
<span class="lineNum">    1279 </span><span class="lineNoCov">          0 :                     if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1280 </span><span class="lineNoCov">          0 :                         p-&gt;ynearstd = false;</span>
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1282 </span>            :                     }
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 :                     if ( missing(p,test,sp))</span>
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1285 </span>            :                 }
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1288 </span><span class="lineNoCov">          0 :                 sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1289 </span><span class="lineNoCov">          0 :             } while ( sp!=test-&gt;first &amp;&amp; !p-&gt;finish );</span>
<span class="lineNum">    1290 </span><span class="lineNoCov">          0 :             if ( !p-&gt;ynearstd )</span>
<span class="lineNum">    1291 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1292 </span>            :         }
<span class="lineNum">    1293 </span>            :     }
<span class="lineNum">    1294 </span>            : 
<span class="lineNum">    1295 </span><span class="lineNoCov">          0 :     if ( p-&gt;linenearstd &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1296 </span><span class="lineNoCov">          0 :         real ia = (90-p-&gt;fv-&gt;b.sf-&gt;italicangle)*(3.1415926535897932/180);</span>
<span class="lineNum">    1297 </span><span class="lineNoCov">          0 :         int hasia = p-&gt;fv-&gt;b.sf-&gt;italicangle!=0;</span>
<span class="lineNum">    1298 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;linenearstd; test = test-&gt;next ) {</span>
<span class="lineNum">    1299 </span><span class="lineNoCov">          0 :             first = NULL;</span>
<span class="lineNum">    1300 </span><span class="lineNoCov">          0 :             for ( spline = test-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first &amp;&amp; !p-&gt;finish; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1301 </span><span class="lineNoCov">          0 :                 if ( spline-&gt;knownlinear ) {</span>
<span class="lineNum">    1302 </span><span class="lineNoCov">          0 :                     if ( HVITest(p,&amp;spline-&gt;to-&gt;me,&amp;spline-&gt;from-&gt;me,spline,</span>
<span class="lineNum">    1303 </span>            :                             hasia, ia)) {
<span class="lineNum">    1304 </span><span class="lineNoCov">          0 :                         changed = true;</span>
<span class="lineNum">    1305 </span><span class="lineNoCov">          0 :                         if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1306 </span><span class="lineNoCov">          0 :                             p-&gt;linenearstd = false;</span>
<span class="lineNum">    1307 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1308 </span>            :                         }
<span class="lineNum">    1309 </span><span class="lineNoCov">          0 :                         if ( missingspline(p,test,spline))</span>
<span class="lineNum">    1310 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1311 </span>            :                     }
<span class="lineNum">    1312 </span>            :                 }
<span class="lineNum">    1313 </span><span class="lineNoCov">          0 :                 if ( first==NULL ) first = spline;</span>
<span class="lineNum">    1314 </span>            :             }
<span class="lineNum">    1315 </span><span class="lineNoCov">          0 :             if ( !p-&gt;linenearstd )</span>
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1317 </span>            :         }
<span class="lineNum">    1318 </span>            :     }
<span class="lineNum">    1319 </span>            : 
<span class="lineNum">    1320 </span><span class="lineNoCov">          0 :     if ( p-&gt;cpnearstd &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :         real ia = (90-p-&gt;fv-&gt;b.sf-&gt;italicangle)*(3.1415926535897932/180);</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 :         int hasia = p-&gt;fv-&gt;b.sf-&gt;italicangle!=0;</span>
<span class="lineNum">    1323 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;linenearstd; test = test-&gt;next ) {</span>
<span class="lineNum">    1324 </span><span class="lineNoCov">          0 :             first = NULL;</span>
<span class="lineNum">    1325 </span><span class="lineNoCov">          0 :             for ( spline = test-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first &amp;&amp; !p-&gt;finish; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :                 if ( !spline-&gt;knownlinear ) {</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :                     if ( !spline-&gt;from-&gt;nonextcp &amp;&amp;</span>
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 :                             HVITest(p,&amp;spline-&gt;from-&gt;nextcp,&amp;spline-&gt;from-&gt;me,spline,</span>
<span class="lineNum">    1329 </span>            :                                 hasia, ia)) {
<span class="lineNum">    1330 </span><span class="lineNoCov">          0 :                         changed = true;</span>
<span class="lineNum">    1331 </span><span class="lineNoCov">          0 :                         if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1332 </span><span class="lineNoCov">          0 :                             p-&gt;cpnearstd = false;</span>
<span class="lineNum">    1333 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1334 </span>            :                         }
<span class="lineNum">    1335 </span><span class="lineNoCov">          0 :                         if ( missingspline(p,test,spline))</span>
<span class="lineNum">    1336 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1337 </span>            :                     }
<span class="lineNum">    1338 </span><span class="lineNoCov">          0 :                     if ( !spline-&gt;to-&gt;noprevcp &amp;&amp;</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 :                             HVITest(p,&amp;spline-&gt;to-&gt;me,&amp;spline-&gt;to-&gt;prevcp,spline,</span>
<span class="lineNum">    1340 </span>            :                                 hasia, ia)) {
<span class="lineNum">    1341 </span><span class="lineNoCov">          0 :                         changed = true;</span>
<span class="lineNum">    1342 </span><span class="lineNoCov">          0 :                         if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 :                             p-&gt;cpnearstd = false;</span>
<span class="lineNum">    1344 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1345 </span>            :                         }
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :                         if ( missingspline(p,test,spline))</span>
<span class="lineNum">    1347 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1348 </span>            :                     }
<span class="lineNum">    1349 </span>            :                 }
<span class="lineNum">    1350 </span><span class="lineNoCov">          0 :                 if ( first==NULL ) first = spline;</span>
<span class="lineNum">    1351 </span>            :             }
<span class="lineNum">    1352 </span><span class="lineNoCov">          0 :             if ( !p-&gt;cpnearstd )</span>
<span class="lineNum">    1353 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1354 </span>            :         }
<span class="lineNum">    1355 </span>            :     }
<span class="lineNum">    1356 </span>            : 
<span class="lineNum">    1357 </span><span class="lineNoCov">          0 :     if ( p-&gt;cpodd &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1358 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;linenearstd; test = test-&gt;next ) {</span>
<span class="lineNum">    1359 </span><span class="lineNoCov">          0 :             first = NULL;</span>
<span class="lineNum">    1360 </span><span class="lineNoCov">          0 :             for ( spline = test-&gt;first-&gt;next; spline!=NULL &amp;&amp; spline!=first &amp;&amp; !p-&gt;finish; spline=spline-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1361 </span><span class="lineNoCov">          0 :                 if ( !spline-&gt;knownlinear ) {</span>
<span class="lineNum">    1362 </span>            :                     BasePoint v; real len;
<span class="lineNum">    1363 </span><span class="lineNoCov">          0 :                     v.x = spline-&gt;to-&gt;me.x-spline-&gt;from-&gt;me.x;</span>
<span class="lineNum">    1364 </span><span class="lineNoCov">          0 :                     v.y = spline-&gt;to-&gt;me.y-spline-&gt;from-&gt;me.y;</span>
<span class="lineNum">    1365 </span><span class="lineNoCov">          0 :                     len = /*sqrt*/(v.x*v.x+v.y*v.y);</span>
<span class="lineNum">    1366 </span><span class="lineNoCov">          0 :                     v.x /= len; v.y /= len;</span>
<span class="lineNum">    1367 </span><span class="lineNoCov">          0 :                     if ( !spline-&gt;from-&gt;nonextcp &amp;&amp;</span>
<span class="lineNum">    1368 </span><span class="lineNoCov">          0 :                             OddCPCheck(&amp;spline-&gt;from-&gt;nextcp,&amp;spline-&gt;from-&gt;me,&amp;v,</span>
<span class="lineNum">    1369 </span>            :                              spline-&gt;from,p)) {
<span class="lineNum">    1370 </span><span class="lineNoCov">          0 :                         changed = true;</span>
<span class="lineNum">    1371 </span><span class="lineNoCov">          0 :                         if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1372 </span><span class="lineNoCov">          0 :                             p-&gt;cpodd = false;</span>
<span class="lineNum">    1373 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1374 </span>            :                         }
<span class="lineNum">    1375 </span><span class="lineNoCov">          0 :                         if ( missingspline(p,test,spline))</span>
<span class="lineNum">    1376 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1377 </span>            :                     }
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 :                     if ( !spline-&gt;to-&gt;noprevcp &amp;&amp;</span>
<span class="lineNum">    1379 </span><span class="lineNoCov">          0 :                             OddCPCheck(&amp;spline-&gt;to-&gt;prevcp,&amp;spline-&gt;from-&gt;me,&amp;v,</span>
<span class="lineNum">    1380 </span>            :                              spline-&gt;to,p)) {
<span class="lineNum">    1381 </span><span class="lineNoCov">          0 :                         changed = true;</span>
<span class="lineNum">    1382 </span><span class="lineNoCov">          0 :                         if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1383 </span><span class="lineNoCov">          0 :                             p-&gt;cpodd = false;</span>
<span class="lineNum">    1384 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1385 </span>            :                         }
<span class="lineNum">    1386 </span><span class="lineNoCov">          0 :                         if ( missingspline(p,test,spline))</span>
<span class="lineNum">    1387 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1388 </span>            :                     }
<span class="lineNum">    1389 </span>            :                 }
<span class="lineNum">    1390 </span><span class="lineNoCov">          0 :                 if ( first==NULL ) first = spline;</span>
<span class="lineNum">    1391 </span>            :             }
<span class="lineNum">    1392 </span><span class="lineNoCov">          0 :             if ( !p-&gt;cpodd )</span>
<span class="lineNum">    1393 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1394 </span>            :         }
<span class="lineNum">    1395 </span>            :     }
<span class="lineNum">    1396 </span>            : 
<span class="lineNum">    1397 </span><span class="lineNoCov">          0 :     if ( p-&gt;irrelevantcontrolpoints &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1398 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;irrelevantcontrolpoints; test = test-&gt;next ) {</span>
<span class="lineNum">    1399 </span><span class="lineNoCov">          0 :             for ( sp=test-&gt;first; !p-&gt;finish &amp;&amp; p-&gt;irrelevantcontrolpoints; ) {</span>
<span class="lineNum">    1400 </span><span class="lineNoCov">          0 :                 int either = false;</span>
<span class="lineNum">    1401 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;prev!=NULL ) {</span>
<span class="lineNum">    1402 </span><span class="lineNoCov">          0 :                     double len = sqrt((sp-&gt;me.x-sp-&gt;prev-&gt;from-&gt;me.x)*(sp-&gt;me.x-sp-&gt;prev-&gt;from-&gt;me.x) +</span>
<span class="lineNum">    1403 </span><span class="lineNoCov">          0 :                             (sp-&gt;me.y-sp-&gt;prev-&gt;from-&gt;me.y)*(sp-&gt;me.y-sp-&gt;prev-&gt;from-&gt;me.y));</span>
<span class="lineNum">    1404 </span><span class="lineNoCov">          0 :                     double cplen = sqrt((sp-&gt;me.x-sp-&gt;prevcp.x)*(sp-&gt;me.x-sp-&gt;prevcp.x) +</span>
<span class="lineNum">    1405 </span><span class="lineNoCov">          0 :                             (sp-&gt;me.y-sp-&gt;prevcp.y)*(sp-&gt;me.y-sp-&gt;prevcp.y));</span>
<span class="lineNum">    1406 </span><span class="lineNoCov">          0 :                     if ( cplen!=0 &amp;&amp; cplen&lt;p-&gt;irrelevantfactor*len )</span>
<span class="lineNum">    1407 </span><span class="lineNoCov">          0 :                         either = true;</span>
<span class="lineNum">    1408 </span>            :                 }
<span class="lineNum">    1409 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next!=NULL ) {</span>
<span class="lineNum">    1410 </span><span class="lineNoCov">          0 :                     double len = sqrt((sp-&gt;me.x-sp-&gt;next-&gt;to-&gt;me.x)*(sp-&gt;me.x-sp-&gt;next-&gt;to-&gt;me.x) +</span>
<span class="lineNum">    1411 </span><span class="lineNoCov">          0 :                             (sp-&gt;me.y-sp-&gt;next-&gt;to-&gt;me.y)*(sp-&gt;me.y-sp-&gt;next-&gt;to-&gt;me.y));</span>
<span class="lineNum">    1412 </span><span class="lineNoCov">          0 :                     double cplen = sqrt((sp-&gt;me.x-sp-&gt;nextcp.x)*(sp-&gt;me.x-sp-&gt;nextcp.x) +</span>
<span class="lineNum">    1413 </span><span class="lineNoCov">          0 :                             (sp-&gt;me.y-sp-&gt;nextcp.y)*(sp-&gt;me.y-sp-&gt;nextcp.y));</span>
<span class="lineNum">    1414 </span><span class="lineNoCov">          0 :                     if ( cplen!=0 &amp;&amp; cplen&lt;p-&gt;irrelevantfactor*len )</span>
<span class="lineNum">    1415 </span><span class="lineNoCov">          0 :                         either = true;</span>
<span class="lineNum">    1416 </span>            :                 }
<span class="lineNum">    1417 </span><span class="lineNoCov">          0 :                 if ( either ) {</span>
<span class="lineNum">    1418 </span><span class="lineNoCov">          0 :                     sp-&gt;selected = true;</span>
<span class="lineNum">    1419 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,_(&quot;This glyph contains control points which are probably too close to the main points to alter the look of the spline&quot;),0,0);</span>
<span class="lineNum">    1420 </span><span class="lineNoCov">          0 :                     if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1421 </span><span class="lineNoCov">          0 :                         p-&gt;irrelevantcontrolpoints = false;</span>
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1423 </span>            :                     }
<span class="lineNum">    1424 </span>            :                 }
<span class="lineNum">    1425 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1426 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1427 </span><span class="lineNoCov">          0 :                 sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1428 </span><span class="lineNoCov">          0 :                 if ( sp==test-&gt;first )</span>
<span class="lineNum">    1429 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1430 </span>            :             }
<span class="lineNum">    1431 </span>            :         }
<span class="lineNum">    1432 </span>            :     }
<span class="lineNum">    1433 </span>            : 
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :     if ( p-&gt;hintwithnopt &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1435 </span>            :         int anys, anye;
<span class="lineNum">    1436 </span>            :       restarthhint:
<span class="lineNum">    1437 </span><span class="lineNoCov">          0 :         for ( h=sc-&gt;hstem; h!=NULL ; h=h-&gt;next ) {</span>
<span class="lineNum">    1438 </span><span class="lineNoCov">          0 :             anys = anye = false;</span>
<span class="lineNum">    1439 </span><span class="lineNoCov">          0 :             for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; (!anys || !anye); test=test-&gt;next ) {</span>
<span class="lineNum">    1440 </span><span class="lineNoCov">          0 :                 sp = test-&gt;first;</span>
<span class="lineNum">    1441 </span>            :                 do {
<span class="lineNum">    1442 </span><span class="lineNoCov">          0 :                     if (sp-&gt;me.y==h-&gt;start )</span>
<span class="lineNum">    1443 </span><span class="lineNoCov">          0 :                         anys = true;</span>
<span class="lineNum">    1444 </span><span class="lineNoCov">          0 :                     if (sp-&gt;me.y==h-&gt;start+h-&gt;width )</span>
<span class="lineNum">    1445 </span><span class="lineNoCov">          0 :                         anye = true;</span>
<span class="lineNum">    1446 </span><span class="lineNoCov">          0 :                     if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1447 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1448 </span><span class="lineNoCov">          0 :                     sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1449 </span><span class="lineNoCov">          0 :                 } while ( sp!=test-&gt;first &amp;&amp; !p-&gt;finish );</span>
<span class="lineNum">    1450 </span>            :             }
<span class="lineNum">    1451 </span><span class="lineNoCov">          0 :             if ( h-&gt;ghost &amp;&amp; ( anys || anye ))</span>
<span class="lineNum">    1452 </span>            :                 /* Ghost hints only define one edge */;
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :             else if ( !anys || !anye ) {</span>
<span class="lineNum">    1454 </span><span class="lineNoCov">          0 :                 h-&gt;active = true;</span>
<span class="lineNum">    1455 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    1456 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;This hint does not control any points&quot;),0,0);</span>
<span class="lineNum">    1457 </span><span class="lineNoCov">          0 :                 if ( !missinghint(sc-&gt;hstem,h))</span>
<span class="lineNum">    1458 </span><span class="lineNoCov">          0 :                     h-&gt;active = false;</span>
<span class="lineNum">    1459 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1460 </span><span class="lineNoCov">          0 :                     p-&gt;hintwithnopt = false;</span>
<span class="lineNum">    1461 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1462 </span>            :                 }
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 :                 if ( missinghint(sc-&gt;hstem,h))</span>
<span class="lineNum">    1464 </span><span class="lineNoCov">          0 :       goto restarthhint;</span>
<span class="lineNum">    1465 </span>            :             }
<span class="lineNum">    1466 </span>            :         }
<span class="lineNum">    1467 </span>            :       restartvhint:
<span class="lineNum">    1468 </span><span class="lineNoCov">          0 :         for ( h=sc-&gt;vstem; h!=NULL &amp;&amp; p-&gt;hintwithnopt &amp;&amp; !p-&gt;finish; h=h-&gt;next ) {</span>
<span class="lineNum">    1469 </span><span class="lineNoCov">          0 :             anys = anye = false;</span>
<span class="lineNum">    1470 </span><span class="lineNoCov">          0 :             for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; (!anys || !anye); test=test-&gt;next ) {</span>
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 :                 sp = test-&gt;first;</span>
<span class="lineNum">    1472 </span>            :                 do {
<span class="lineNum">    1473 </span><span class="lineNoCov">          0 :                     if (sp-&gt;me.x==h-&gt;start )</span>
<span class="lineNum">    1474 </span><span class="lineNoCov">          0 :                         anys = true;</span>
<span class="lineNum">    1475 </span><span class="lineNoCov">          0 :                     if (sp-&gt;me.x==h-&gt;start+h-&gt;width )</span>
<span class="lineNum">    1476 </span><span class="lineNoCov">          0 :                         anye = true;</span>
<span class="lineNum">    1477 </span><span class="lineNoCov">          0 :                     if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1478 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 :                     sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1480 </span><span class="lineNoCov">          0 :                 } while ( sp!=test-&gt;first &amp;&amp; !p-&gt;finish );</span>
<span class="lineNum">    1481 </span>            :             }
<span class="lineNum">    1482 </span><span class="lineNoCov">          0 :             if ( !anys || !anye ) {</span>
<span class="lineNum">    1483 </span><span class="lineNoCov">          0 :                 h-&gt;active = true;</span>
<span class="lineNum">    1484 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    1485 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;This hint does not control any points&quot;),0,0);</span>
<span class="lineNum">    1486 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1487 </span><span class="lineNoCov">          0 :                     p-&gt;hintwithnopt = false;</span>
<span class="lineNum">    1488 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1489 </span>            :                 }
<span class="lineNum">    1490 </span><span class="lineNoCov">          0 :                 if ( missinghint(sc-&gt;vstem,h))</span>
<span class="lineNum">    1491 </span><span class="lineNoCov">          0 :       goto restartvhint;</span>
<span class="lineNum">    1492 </span><span class="lineNoCov">          0 :                 h-&gt;active = false;</span>
<span class="lineNum">    1493 </span>            :             }
<span class="lineNum">    1494 </span>            :         }
<span class="lineNum">    1495 </span>            :     }
<span class="lineNum">    1496 </span>            : 
<span class="lineNum">    1497 </span><span class="lineNoCov">          0 :     if ( p-&gt;ptnearhint &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1498 </span>            :         real found, expected;
<span class="lineNum">    1499 </span><span class="lineNoCov">          0 :         h = NULL;</span>
<span class="lineNum">    1500 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;ptnearhint; test=test-&gt;next ) {</span>
<span class="lineNum">    1501 </span><span class="lineNoCov">          0 :             sp = test-&gt;first;</span>
<span class="lineNum">    1502 </span>            :             do {
<span class="lineNum">    1503 </span><span class="lineNoCov">          0 :                 int hs = false, vs = false;</span>
<span class="lineNum">    1504 </span><span class="lineNoCov">          0 :                 for ( h=sc-&gt;hstem; h!=NULL; h=h-&gt;next ) {</span>
<span class="lineNum">    1505 </span><span class="lineNoCov">          0 :                     if (( sp-&gt;me.y-h-&gt;start&lt;p-&gt;near &amp;&amp; h-&gt;start-sp-&gt;me.y&lt;p-&gt;near &amp;&amp;</span>
<span class="lineNum">    1506 </span><span class="lineNoCov">          0 :                                 sp-&gt;me.y!=h-&gt;start ) ||</span>
<span class="lineNum">    1507 </span><span class="lineNoCov">          0 :                             ( sp-&gt;me.y-h-&gt;start+h-&gt;width&lt;p-&gt;near &amp;&amp; h-&gt;start+h-&gt;width-sp-&gt;me.y&lt;p-&gt;near &amp;&amp;</span>
<span class="lineNum">    1508 </span><span class="lineNoCov">          0 :                                 sp-&gt;me.y!=h-&gt;start+h-&gt;width )) {</span>
<span class="lineNum">    1509 </span><span class="lineNoCov">          0 :                         found = sp-&gt;me.y;</span>
<span class="lineNum">    1510 </span><span class="lineNoCov">          0 :                         if ( sp-&gt;me.y-h-&gt;start&lt;p-&gt;near &amp;&amp; h-&gt;start-sp-&gt;me.y&lt;p-&gt;near )</span>
<span class="lineNum">    1511 </span><span class="lineNoCov">          0 :                             expected = h-&gt;start;</span>
<span class="lineNum">    1512 </span>            :                         else
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 :                             expected = h-&gt;start+h-&gt;width;</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">          0 :                         h-&gt;active = true;</span>
<span class="lineNum">    1515 </span><span class="lineNoCov">          0 :                         hs = true;</span>
<span class="lineNum">    1516 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1517 </span>            :                     }
<span class="lineNum">    1518 </span>            :                 }
<span class="lineNum">    1519 </span><span class="lineNoCov">          0 :                 if ( !hs ) {</span>
<span class="lineNum">    1520 </span><span class="lineNoCov">          0 :                     for ( h=sc-&gt;vstem; h!=NULL; h=h-&gt;next ) {</span>
<span class="lineNum">    1521 </span><span class="lineNoCov">          0 :                         if (( sp-&gt;me.x-h-&gt;start&lt;p-&gt;near &amp;&amp; h-&gt;start-sp-&gt;me.x&lt;p-&gt;near &amp;&amp;</span>
<span class="lineNum">    1522 </span><span class="lineNoCov">          0 :                                     sp-&gt;me.x!=h-&gt;start ) ||</span>
<span class="lineNum">    1523 </span><span class="lineNoCov">          0 :                                 ( sp-&gt;me.x-h-&gt;start+h-&gt;width&lt;p-&gt;near &amp;&amp; h-&gt;start+h-&gt;width-sp-&gt;me.x&lt;p-&gt;near &amp;&amp;</span>
<span class="lineNum">    1524 </span><span class="lineNoCov">          0 :                                     sp-&gt;me.x!=h-&gt;start+h-&gt;width )) {</span>
<span class="lineNum">    1525 </span><span class="lineNoCov">          0 :                             found = sp-&gt;me.x;</span>
<span class="lineNum">    1526 </span><span class="lineNoCov">          0 :                             if ( sp-&gt;me.x-h-&gt;start&lt;p-&gt;near &amp;&amp; h-&gt;start-sp-&gt;me.x&lt;p-&gt;near )</span>
<span class="lineNum">    1527 </span><span class="lineNoCov">          0 :                                 expected = h-&gt;start;</span>
<span class="lineNum">    1528 </span>            :                             else
<span class="lineNum">    1529 </span><span class="lineNoCov">          0 :                                 expected = h-&gt;start+h-&gt;width;</span>
<span class="lineNum">    1530 </span><span class="lineNoCov">          0 :                             h-&gt;active = true;</span>
<span class="lineNum">    1531 </span><span class="lineNoCov">          0 :                             vs = true;</span>
<span class="lineNum">    1532 </span><span class="lineNoCov">          0 :                     break;</span>
<span class="lineNum">    1533 </span>            :                         }
<span class="lineNum">    1534 </span>            :                     }
<span class="lineNum">    1535 </span>            :                 }
<span class="lineNum">    1536 </span><span class="lineNoCov">          0 :                 if ( hs || vs ) {</span>
<span class="lineNum">    1537 </span><span class="lineNoCov">          0 :                     changed = true;</span>
<span class="lineNum">    1538 </span><span class="lineNoCov">          0 :                     sp-&gt;selected = true;</span>
<span class="lineNum">    1539 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,hs?_(&quot;The selected point is near a horizontal stem hint&quot;):_(&quot;The selected point is near a vertical stem hint&quot;),found,expected);</span>
<span class="lineNum">    1540 </span><span class="lineNoCov">          0 :                     if ( h!=NULL )</span>
<span class="lineNum">    1541 </span><span class="lineNoCov">          0 :                         h-&gt;active = false;</span>
<span class="lineNum">    1542 </span><span class="lineNoCov">          0 :                     if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1543 </span><span class="lineNoCov">          0 :                         p-&gt;ptnearhint = false;</span>
<span class="lineNum">    1544 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1545 </span>            :                     }
<span class="lineNum">    1546 </span><span class="lineNoCov">          0 :                     if ( missing(p,test,sp))</span>
<span class="lineNum">    1547 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1548 </span>            :                 }
<span class="lineNum">    1549 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1550 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1551 </span><span class="lineNoCov">          0 :                 sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1552 </span><span class="lineNoCov">          0 :             } while ( sp!=test-&gt;first &amp;&amp; !p-&gt;finish );</span>
<span class="lineNum">    1553 </span><span class="lineNoCov">          0 :             if ( !p-&gt;ptnearhint )</span>
<span class="lineNum">    1554 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1555 </span>            :         }
<span class="lineNum">    1556 </span>            :     }
<span class="lineNum">    1557 </span>            : 
<span class="lineNum">    1558 </span><span class="lineNoCov">          0 :     if ( p-&gt;overlappedhints &amp;&amp; !p-&gt;finish &amp;&amp; !cur-&gt;order2 &amp;&amp; spl!=NULL ) {</span>
<span class="lineNum">    1559 </span><span class="lineNoCov">          0 :         int anyhm=0;</span>
<span class="lineNum">    1560 </span><span class="lineNoCov">          0 :         for ( test=spl; test!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;overlappedhints; test=test-&gt;next ) {</span>
<span class="lineNum">    1561 </span><span class="lineNoCov">          0 :             sp = test-&gt;first;</span>
<span class="lineNum">    1562 </span>            :             do {
<span class="lineNum">    1563 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;hintmask!=NULL ) {</span>
<span class="lineNum">    1564 </span><span class="lineNoCov">          0 :                     anyhm = true;</span>
<span class="lineNum">    1565 </span><span class="lineNoCov">          0 :                     h = SCHintOverlapInMask(sc,sp-&gt;hintmask);</span>
<span class="lineNum">    1566 </span><span class="lineNoCov">          0 :                     if ( h!=NULL ) {</span>
<span class="lineNum">    1567 </span><span class="lineNoCov">          0 :                         sp-&gt;selected = true;</span>
<span class="lineNum">    1568 </span><span class="lineNoCov">          0 :                         h-&gt;active = true;</span>
<span class="lineNum">    1569 </span><span class="lineNoCov">          0 :                         changed = true;</span>
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 :                         ExplainIt(p,sc,_(&quot;The hint mask of the selected point contains overlapping hints&quot;),0,0);</span>
<span class="lineNum">    1571 </span><span class="lineNoCov">          0 :                         if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1572 </span><span class="lineNoCov">          0 :                             p-&gt;overlappedhints = false;</span>
<span class="lineNum">    1573 </span><span class="lineNoCov">          0 :                         if ( missing(p,test,sp))</span>
<span class="lineNum">    1574 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1575 </span><span class="lineNoCov">          0 :                         if ( missingschint(h,sc))</span>
<span class="lineNum">    1576 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1577 </span><span class="lineNoCov">          0 :                         h-&gt;active = false;</span>
<span class="lineNum">    1578 </span><span class="lineNoCov">          0 :                         sp-&gt;selected = false;</span>
<span class="lineNum">    1579 </span><span class="lineNoCov">          0 :                         if ( !p-&gt;overlappedhints )</span>
<span class="lineNum">    1580 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1581 </span>            :                     }
<span class="lineNum">    1582 </span>            :                 }
<span class="lineNum">    1583 </span><span class="lineNoCov">          0 :                 if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1584 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1585 </span><span class="lineNoCov">          0 :                 sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1586 </span><span class="lineNoCov">          0 :             } while ( sp!=test-&gt;first &amp;&amp; !p-&gt;finish );</span>
<span class="lineNum">    1587 </span><span class="lineNoCov">          0 :             if ( !p-&gt;overlappedhints )</span>
<span class="lineNum">    1588 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1589 </span>            :         }
<span class="lineNum">    1590 </span><span class="lineNoCov">          0 :         if ( p-&gt;overlappedhints &amp;&amp; !anyhm ) {</span>
<span class="lineNum">    1591 </span><span class="lineNoCov">          0 :             h = SCHintOverlapInMask(sc,NULL);</span>
<span class="lineNum">    1592 </span><span class="lineNoCov">          0 :             if ( h!=NULL ) {</span>
<span class="lineNum">    1593 </span><span class="lineNoCov">          0 :                 h-&gt;active = true;</span>
<span class="lineNum">    1594 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    1595 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;There are no hint masks in this layer but there are overlapping hints.&quot;),0,0);</span>
<span class="lineNum">    1596 </span><span class="lineNoCov">          0 :                 if ( missingschint(h,sc))</span>
<span class="lineNum">    1597 </span><span class="lineNoCov">          0 :   goto restart;</span>
<span class="lineNum">    1598 </span><span class="lineNoCov">          0 :                 h-&gt;active = false;</span>
<span class="lineNum">    1599 </span>            :             }
<span class="lineNum">    1600 </span>            :         }
<span class="lineNum">    1601 </span>            :     }
<span class="lineNum">    1602 </span>            : 
<span class="lineNum">    1603 </span><span class="lineNoCov">          0 :     if ( p-&gt;hintwidthnearval &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1604 </span><span class="lineNoCov">          0 :         StemInfo *hs = NULL, *vs = NULL;</span>
<span class="lineNum">    1605 </span><span class="lineNoCov">          0 :         for ( h=sc-&gt;hstem; h!=NULL; h=h-&gt;next ) {</span>
<span class="lineNum">    1606 </span><span class="lineNoCov">          0 :             if ( h-&gt;width-p-&gt;widthval&lt;p-&gt;near &amp;&amp; p-&gt;widthval-h-&gt;width&lt;p-&gt;near &amp;&amp;</span>
<span class="lineNum">    1607 </span><span class="lineNoCov">          0 :                     h-&gt;width!=p-&gt;widthval ) {</span>
<span class="lineNum">    1608 </span><span class="lineNoCov">          0 :                 h-&gt;active = true;</span>
<span class="lineNum">    1609 </span><span class="lineNoCov">          0 :                 hs = h;</span>
<span class="lineNum">    1610 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1611 </span>            :             }
<span class="lineNum">    1612 </span>            :         }
<span class="lineNum">    1613 </span><span class="lineNoCov">          0 :         for ( h=sc-&gt;vstem; h!=NULL; h=h-&gt;next ) {</span>
<span class="lineNum">    1614 </span><span class="lineNoCov">          0 :             if ( h-&gt;width-p-&gt;widthval&lt;p-&gt;near &amp;&amp; p-&gt;widthval-h-&gt;width&lt;p-&gt;near &amp;&amp;</span>
<span class="lineNum">    1615 </span><span class="lineNoCov">          0 :                     h-&gt;width!=p-&gt;widthval ) {</span>
<span class="lineNum">    1616 </span><span class="lineNoCov">          0 :                 h-&gt;active = true;</span>
<span class="lineNum">    1617 </span><span class="lineNoCov">          0 :                 vs = h;</span>
<span class="lineNum">    1618 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1619 </span>            :             }
<span class="lineNum">    1620 </span>            :         }
<span class="lineNum">    1621 </span><span class="lineNoCov">          0 :         if ( hs || vs ) {</span>
<span class="lineNum">    1622 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    1623 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,hs?_(&quot;This glyph contains a horizontal hint near the specified width&quot;):_(&quot;This glyph contains a vertical hint near the specified width&quot;),</span>
<span class="lineNum">    1624 </span>            :                     hs?hs-&gt;width:vs-&gt;width,p-&gt;widthval);
<span class="lineNum">    1625 </span><span class="lineNoCov">          0 :             if ( hs!=NULL &amp;&amp; !missinghint(sc-&gt;hstem,hs)) hs-&gt;active = false;</span>
<span class="lineNum">    1626 </span><span class="lineNoCov">          0 :             if ( vs!=NULL &amp;&amp; !missinghint(sc-&gt;vstem,vs)) vs-&gt;active = false;</span>
<span class="lineNum">    1627 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1628 </span><span class="lineNoCov">          0 :                 p-&gt;hintwidthnearval = false;</span>
<span class="lineNum">    1629 </span><span class="lineNoCov">          0 :             else if ( (hs!=NULL &amp;&amp; missinghint(sc-&gt;hstem,hs)) &amp;&amp;</span>
<span class="lineNum">    1630 </span><span class="lineNoCov">          0 :                     ( vs!=NULL &amp;&amp; missinghint(sc-&gt;vstem,vs)))</span>
<span class="lineNum">    1631 </span><span class="lineNoCov">          0 :       goto restart;</span>
<span class="lineNum">    1632 </span>            :         }
<span class="lineNum">    1633 </span>            :     }
<span class="lineNum">    1634 </span>            : 
<span class="lineNum">    1635 </span><span class="lineNoCov">          0 :     if ( p-&gt;stem3 &amp;&amp; !p-&gt;finish )</span>
<span class="lineNum">    1636 </span><span class="lineNoCov">          0 :         changed |= Hint3Check(p,sc-&gt;hstem);</span>
<span class="lineNum">    1637 </span><span class="lineNoCov">          0 :     if ( p-&gt;stem3 &amp;&amp; !p-&gt;finish )</span>
<span class="lineNum">    1638 </span><span class="lineNoCov">          0 :         changed |= Hint3Check(p,sc-&gt;vstem);</span>
<span class="lineNum">    1639 </span>            : 
<span class="lineNum">    1640 </span><span class="lineNoCov">          0 :     if ( p-&gt;direction &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1641 </span>            :         SplineSet **base, *ret, *ss;
<span class="lineNum">    1642 </span>            :         Spline *s, *s2;
<span class="lineNum">    1643 </span>            :         Layer *layer;
<span class="lineNum">    1644 </span><span class="lineNoCov">          0 :         int lastscan= -1;</span>
<span class="lineNum">    1645 </span>            :         int self_intersects, dir;
<span class="lineNum">    1646 </span>            :         
<span class="lineNum">    1647 </span><span class="lineNoCov">          0 :         if ( cv!=NULL )</span>
<span class="lineNum">    1648 </span><span class="lineNoCov">          0 :             layer = cv-&gt;b.layerheads[cv-&gt;b.drawmode];</span>
<span class="lineNum">    1649 </span>            :         else
<span class="lineNum">    1650 </span><span class="lineNoCov">          0 :             layer = &amp;sc-&gt;layers[p-&gt;layer];</span>
<span class="lineNum">    1651 </span>            : 
<span class="lineNum">    1652 </span><span class="lineNoCov">          0 :         ss = LayerAllSplines(layer);</span>
<span class="lineNum">    1653 </span><span class="lineNoCov">          0 :         self_intersects = SplineSetIntersect(ss,&amp;s,&amp;s2);</span>
<span class="lineNum">    1654 </span><span class="lineNoCov">          0 :         LayerUnAllSplines(layer);</span>
<span class="lineNum">    1655 </span>            : 
<span class="lineNum">    1656 </span><span class="lineNoCov">          0 :         if ( self_intersects )</span>
<span class="lineNum">    1657 </span><span class="lineNoCov">          0 :             ff_post_error(_(&quot;This glyph self-intersects&quot;),_(&quot;This glyph self-intersects. Checking for correct direction is meaningless until that is fixed&quot;));</span>
<span class="lineNum">    1658 </span>            :         else {
<span class="lineNum">    1659 </span><span class="lineNoCov">          0 :             base = &amp;layer-&gt;splines;</span>
<span class="lineNum">    1660 </span>            : 
<span class="lineNum">    1661 </span><span class="lineNoCov">          0 :             while ( !p-&gt;finish &amp;&amp; (ret=SplineSetsDetectDir(base,&amp;lastscan))!=NULL ) {</span>
<span class="lineNum">    1662 </span><span class="lineNoCov">          0 :                 sp = ret-&gt;first;</span>
<span class="lineNum">    1663 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    1664 </span>            :                 while ( 1 ) {
<span class="lineNum">    1665 </span><span class="lineNoCov">          0 :                     sp-&gt;selected = true;</span>
<span class="lineNum">    1666 </span><span class="lineNoCov">          0 :                     if ( sp-&gt;next==NULL )</span>
<span class="lineNum">    1667 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1668 </span><span class="lineNoCov">          0 :                     sp = sp-&gt;next-&gt;to;</span>
<span class="lineNum">    1669 </span><span class="lineNoCov">          0 :                     if ( sp==ret-&gt;first )</span>
<span class="lineNum">    1670 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1671 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1672 </span><span class="lineNoCov">          0 :                 dir = SplinePointListIsClockwise(ret);</span>
<span class="lineNum">    1673 </span><span class="lineNoCov">          0 :                 if ( dir==-1 )</span>
<span class="lineNum">    1674 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,_(&quot;This path probably intersects itself (though I could not find that when\n I checked for intersections), look closely at the corners&quot;),0,0);</span>
<span class="lineNum">    1675 </span><span class="lineNoCov">          0 :                 else if ( dir==1 )</span>
<span class="lineNum">    1676 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,_(&quot;This path should have been drawn in a counter-clockwise direction&quot;),0,0);</span>
<span class="lineNum">    1677 </span>            :                 else
<span class="lineNum">    1678 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,_(&quot;This path should have been drawn in a clockwise direction&quot;),0,0);</span>
<span class="lineNum">    1679 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1680 </span><span class="lineNoCov">          0 :                     p-&gt;direction = false;</span>
<span class="lineNum">    1681 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1682 </span>            :                 }
<span class="lineNum">    1683 </span>            :             }
<span class="lineNum">    1684 </span>            :         }
<span class="lineNum">    1685 </span>            :     }
<span class="lineNum">    1686 </span>            : 
<span class="lineNum">    1687 </span><span class="lineNoCov">          0 :     if ( p-&gt;missingextrema &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1688 </span>            :         SplineSet *ss;
<span class="lineNum">    1689 </span>            :         Spline *s, *first;
<span class="lineNum">    1690 </span><span class="lineNoCov">          0 :         double len2, bound2 = p-&gt;sc-&gt;parent-&gt;extrema_bound;</span>
<span class="lineNum">    1691 </span>            :         double x,y;
<span class="lineNum">    1692 </span>            :         extended extrema[4];
<span class="lineNum">    1693 </span>            : 
<span class="lineNum">    1694 </span><span class="lineNoCov">          0 :         if ( bound2&lt;=0 )</span>
<span class="lineNum">    1695 </span><span class="lineNoCov">          0 :             bound2 = (p-&gt;sc-&gt;parent-&gt;ascent + p-&gt;sc-&gt;parent-&gt;descent)/32.0;</span>
<span class="lineNum">    1696 </span>            : 
<span class="lineNum">    1697 </span><span class="lineNoCov">          0 :         bound2 *= bound2;</span>
<span class="lineNum">    1698 </span>            :       ae_restart:
<span class="lineNum">    1699 </span><span class="lineNoCov">          0 :         for ( ss = sc-&gt;layers[p-&gt;layer].splines; ss!=NULL &amp;&amp; !p-&gt;finish; ss=ss-&gt;next ) {</span>
<span class="lineNum">    1700 </span>            :           ae2_restart:
<span class="lineNum">    1701 </span><span class="lineNoCov">          0 :             first = NULL;</span>
<span class="lineNum">    1702 </span><span class="lineNoCov">          0 :             for ( s=ss-&gt;first-&gt;next ; s!=NULL &amp;&amp; s!=first &amp;&amp; !p-&gt;finish; s=s-&gt;to-&gt;next ) {</span>
<span class="lineNum">    1703 </span><span class="lineNoCov">          0 :                 if ( first==NULL )</span>
<span class="lineNum">    1704 </span><span class="lineNoCov">          0 :                     first = s;</span>
<span class="lineNum">    1705 </span><span class="lineNoCov">          0 :                 if ( s-&gt;acceptableextrema )</span>
<span class="lineNum">    1706 </span><span class="lineNoCov">          0 :             continue;           /* If marked as good, don't check it */</span>
<span class="lineNum">    1707 </span>            :                 /* rough appoximation to spline's length */
<span class="lineNum">    1708 </span><span class="lineNoCov">          0 :                 x = (s-&gt;to-&gt;me.x-s-&gt;from-&gt;me.x);</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">          0 :                 y = (s-&gt;to-&gt;me.y-s-&gt;from-&gt;me.y);</span>
<span class="lineNum">    1710 </span><span class="lineNoCov">          0 :                 len2 = x*x + y*y;</span>
<span class="lineNum">    1711 </span>            :                 /* short splines (serifs) need not to have points at their extrema */
<span class="lineNum">    1712 </span>            :                 /*  But how do we define &quot;short&quot;? */
<span class="lineNum">    1713 </span><span class="lineNoCov">          0 :                 if ( len2&gt;bound2 &amp;&amp; Spline2DFindExtrema(s,extrema)&gt;0 ) {</span>
<span class="lineNum">    1714 </span><span class="lineNoCov">          0 :                     s-&gt;from-&gt;selected = true;</span>
<span class="lineNum">    1715 </span><span class="lineNoCov">          0 :                     s-&gt;to-&gt;selected = true;</span>
<span class="lineNum">    1716 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,_(&quot;The selected spline attains its extrema somewhere other than its endpoints&quot;),0,0);</span>
<span class="lineNum">    1717 </span><span class="lineNoCov">          0 :                     if ( !SSExistsInLayer(ss,sc-&gt;layers[p-&gt;layer].splines) )</span>
<span class="lineNum">    1718 </span><span class="lineNoCov">          0 :       goto ae_restart;</span>
<span class="lineNum">    1719 </span><span class="lineNoCov">          0 :                     if ( !SplineExistsInSS(s,ss))</span>
<span class="lineNum">    1720 </span><span class="lineNoCov">          0 :           goto ae2_restart;</span>
<span class="lineNum">    1721 </span><span class="lineNoCov">          0 :                     if ( !SplineExistsInSS(first,ss))</span>
<span class="lineNum">    1722 </span><span class="lineNoCov">          0 :                         first = s;</span>
<span class="lineNum">    1723 </span><span class="lineNoCov">          0 :                     if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1724 </span><span class="lineNoCov">          0 :                         p-&gt;missingextrema = false;</span>
<span class="lineNum">    1725 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1726 </span>            :                     }
<span class="lineNum">    1727 </span>            :                 }
<span class="lineNum">    1728 </span>            :             }
<span class="lineNum">    1729 </span><span class="lineNoCov">          0 :             if ( !p-&gt;missingextrema )</span>
<span class="lineNum">    1730 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1731 </span>            :         }
<span class="lineNum">    1732 </span>            :     }
<span class="lineNum">    1733 </span>            : 
<span class="lineNum">    1734 </span><span class="lineNoCov">          0 :     if ( p-&gt;flippedrefs &amp;&amp; !p-&gt;finish &amp;&amp; ( cv==NULL || cv-&gt;b.drawmode==dm_fore )) {</span>
<span class="lineNum">    1735 </span>            :         RefChar *ref;
<span class="lineNum">    1736 </span><span class="lineNoCov">          0 :         for ( ref = sc-&gt;layers[p-&gt;layer].refs; ref!=NULL ; ref = ref-&gt;next )</span>
<span class="lineNum">    1737 </span><span class="lineNoCov">          0 :             ref-&gt;selected = false;</span>
<span class="lineNum">    1738 </span><span class="lineNoCov">          0 :         for ( ref = sc-&gt;layers[p-&gt;layer].refs; !p-&gt;finish &amp;&amp; ref!=NULL ; ref = ref-&gt;next ) {</span>
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 :             if ( ref-&gt;transform[0]*ref-&gt;transform[3]&lt;0 ||</span>
<span class="lineNum">    1740 </span><span class="lineNoCov">          0 :                     (ref-&gt;transform[0]==0 &amp;&amp; ref-&gt;transform[1]*ref-&gt;transform[2]&gt;0)) {</span>
<span class="lineNum">    1741 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    1742 </span><span class="lineNoCov">          0 :                 ref-&gt;selected = true;</span>
<span class="lineNum">    1743 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;This reference has been flipped, so the paths in it are drawn backwards&quot;),0,0);</span>
<span class="lineNum">    1744 </span><span class="lineNoCov">          0 :                 ref-&gt;selected = false;</span>
<span class="lineNum">    1745 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1746 </span><span class="lineNoCov">          0 :                     p-&gt;flippedrefs = false;</span>
<span class="lineNum">    1747 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1748 </span>            :                 }
<span class="lineNum">    1749 </span>            :             }
<span class="lineNum">    1750 </span>            :         }
<span class="lineNum">    1751 </span>            :     }
<span class="lineNum">    1752 </span>            : 
<span class="lineNum">    1753 </span><span class="lineNoCov">          0 :     if ( p-&gt;refsbadtransformttf &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1754 </span>            :         RefChar *ref;
<span class="lineNum">    1755 </span><span class="lineNoCov">          0 :         for ( ref = sc-&gt;layers[p-&gt;layer].refs; ref!=NULL ; ref = ref-&gt;next )</span>
<span class="lineNum">    1756 </span><span class="lineNoCov">          0 :             ref-&gt;selected = false;</span>
<span class="lineNum">    1757 </span><span class="lineNoCov">          0 :         for ( ref = sc-&gt;layers[p-&gt;layer].refs; !p-&gt;finish &amp;&amp; ref!=NULL ; ref = ref-&gt;next ) {</span>
<span class="lineNum">    1758 </span><span class="lineNoCov">          0 :             if ( ref-&gt;transform[0]&gt;=2 || ref-&gt;transform[0]&lt;-2 ||</span>
<span class="lineNum">    1759 </span><span class="lineNoCov">          0 :                     ref-&gt;transform[1]&gt;=2 || ref-&gt;transform[1]&lt;-2 ||</span>
<span class="lineNum">    1760 </span><span class="lineNoCov">          0 :                     ref-&gt;transform[2]&gt;=2 || ref-&gt;transform[2]&lt;-2 ||</span>
<span class="lineNum">    1761 </span><span class="lineNoCov">          0 :                     ref-&gt;transform[3]&gt;=2 || ref-&gt;transform[3]&lt;-2 ||</span>
<span class="lineNum">    1762 </span><span class="lineNoCov">          0 :                     rint(ref-&gt;transform[4])!=ref-&gt;transform[4] ||</span>
<span class="lineNum">    1763 </span><span class="lineNoCov">          0 :                     rint(ref-&gt;transform[5])!=ref-&gt;transform[5]) {</span>
<span class="lineNum">    1764 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    1765 </span><span class="lineNoCov">          0 :                 ref-&gt;selected = true;</span>
<span class="lineNum">    1766 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;This reference has a transformation matrix which cannot be expressed in truetype.\nAll entries (except translation) must be between [-2.0,2.0).\nTranslation must be integral.&quot;),0,0);</span>
<span class="lineNum">    1767 </span><span class="lineNoCov">          0 :                 ref-&gt;selected = false;</span>
<span class="lineNum">    1768 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1769 </span><span class="lineNoCov">          0 :                     p-&gt;refsbadtransformttf = false;</span>
<span class="lineNum">    1770 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1771 </span>            :                 }
<span class="lineNum">    1772 </span>            :             }
<span class="lineNum">    1773 </span>            :         }
<span class="lineNum">    1774 </span>            :     }
<span class="lineNum">    1775 </span>            : 
<span class="lineNum">    1776 </span><span class="lineNoCov">          0 :     if ( p-&gt;mixedcontoursrefs &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1777 </span>            :         RefChar *ref;
<span class="lineNum">    1778 </span><span class="lineNoCov">          0 :         int hasref=0, hascontour = sc-&gt;layers[p-&gt;layer].splines!=NULL;</span>
<span class="lineNum">    1779 </span><span class="lineNoCov">          0 :         for ( ref = sc-&gt;layers[p-&gt;layer].refs; ref!=NULL ; ref = ref-&gt;next ) {</span>
<span class="lineNum">    1780 </span><span class="lineNoCov">          0 :             ref-&gt;selected = false;</span>
<span class="lineNum">    1781 </span><span class="lineNoCov">          0 :             if ( ref-&gt;transform[0]&gt;=2 || ref-&gt;transform[0]&lt;-2 ||</span>
<span class="lineNum">    1782 </span><span class="lineNoCov">          0 :                     ref-&gt;transform[1]&gt;=2 || ref-&gt;transform[1]&lt;-2 ||</span>
<span class="lineNum">    1783 </span><span class="lineNoCov">          0 :                     ref-&gt;transform[2]&gt;=2 || ref-&gt;transform[2]&lt;-2 ||</span>
<span class="lineNum">    1784 </span><span class="lineNoCov">          0 :                     ref-&gt;transform[3]&gt;=2 || ref-&gt;transform[3]&lt;-2 )</span>
<span class="lineNum">    1785 </span><span class="lineNoCov">          0 :                 hascontour = true;</span>
<span class="lineNum">    1786 </span>            :             else
<span class="lineNum">    1787 </span><span class="lineNoCov">          0 :                 hasref = true;</span>
<span class="lineNum">    1788 </span><span class="lineNoCov">          0 :             if ( hascontour &amp;&amp; hasref ) {</span>
<span class="lineNum">    1789 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    1790 </span><span class="lineNoCov">          0 :                 ref-&gt;selected = true;</span>
<span class="lineNum">    1791 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;This glyph contains both contours and references.\n(or contains a reference which has a bad transformation matrix and counts as a contour).\nThis cannot be expressed in the TrueType glyph format.&quot;),0,0);</span>
<span class="lineNum">    1792 </span><span class="lineNoCov">          0 :                 ref-&gt;selected = false;</span>
<span class="lineNum">    1793 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1794 </span><span class="lineNoCov">          0 :                     p-&gt;mixedcontoursrefs = false;</span>
<span class="lineNum">    1795 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1796 </span>            :                 }
<span class="lineNum">    1797 </span>            :             }
<span class="lineNum">    1798 </span>            :         }
<span class="lineNum">    1799 </span>            :     }
<span class="lineNum">    1800 </span>            : 
<span class="lineNum">    1801 </span><span class="lineNoCov">          0 :     if ( p-&gt;refsbadtransformps &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1802 </span>            :         RefChar *ref;
<span class="lineNum">    1803 </span><span class="lineNoCov">          0 :         for ( ref = sc-&gt;layers[p-&gt;layer].refs; ref!=NULL ; ref = ref-&gt;next )</span>
<span class="lineNum">    1804 </span><span class="lineNoCov">          0 :             ref-&gt;selected = false;</span>
<span class="lineNum">    1805 </span><span class="lineNoCov">          0 :         for ( ref = sc-&gt;layers[p-&gt;layer].refs; !p-&gt;finish &amp;&amp; ref!=NULL ; ref = ref-&gt;next ) {</span>
<span class="lineNum">    1806 </span><span class="lineNoCov">          0 :             if ( ref-&gt;transform[0]!=1.0 ||</span>
<span class="lineNum">    1807 </span><span class="lineNoCov">          0 :                     ref-&gt;transform[1]!=0 ||</span>
<span class="lineNum">    1808 </span><span class="lineNoCov">          0 :                     ref-&gt;transform[2]!=0 ||</span>
<span class="lineNum">    1809 </span><span class="lineNoCov">          0 :                     ref-&gt;transform[3]!= 1.0 ) {</span>
<span class="lineNum">    1810 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    1811 </span><span class="lineNoCov">          0 :                 ref-&gt;selected = true;</span>
<span class="lineNum">    1812 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;This reference has a transformation matrix which cannot be expressed in Type1/2 fonts.\nNo scaling or rotation allowed.&quot;),0,0);</span>
<span class="lineNum">    1813 </span><span class="lineNoCov">          0 :                 ref-&gt;selected = false;</span>
<span class="lineNum">    1814 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1815 </span><span class="lineNoCov">          0 :                     p-&gt;refsbadtransformps = false;</span>
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1817 </span>            :                 }
<span class="lineNum">    1818 </span>            :             }
<span class="lineNum">    1819 </span>            :         }
<span class="lineNum">    1820 </span>            :     }
<span class="lineNum">    1821 </span>            : 
<span class="lineNum">    1822 </span><span class="lineNoCov">          0 :     if ( p-&gt;multusemymetrics &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1823 </span>            :         RefChar *ref, *found;
<span class="lineNum">    1824 </span><span class="lineNoCov">          0 :         for ( ref = sc-&gt;layers[p-&gt;layer].refs; ref!=NULL ; ref = ref-&gt;next )</span>
<span class="lineNum">    1825 </span><span class="lineNoCov">          0 :             ref-&gt;selected = false;</span>
<span class="lineNum">    1826 </span><span class="lineNoCov">          0 :         found = NULL;</span>
<span class="lineNum">    1827 </span><span class="lineNoCov">          0 :         for ( ref = sc-&gt;layers[p-&gt;layer].refs; !p-&gt;finish &amp;&amp; ref!=NULL ; ref = ref-&gt;next ) {</span>
<span class="lineNum">    1828 </span><span class="lineNoCov">          0 :             if ( ref-&gt;use_my_metrics ) {</span>
<span class="lineNum">    1829 </span><span class="lineNoCov">          0 :                 if ( found==NULL )</span>
<span class="lineNum">    1830 </span><span class="lineNoCov">          0 :                     found = ref;</span>
<span class="lineNum">    1831 </span>            :                 else {
<span class="lineNum">    1832 </span><span class="lineNoCov">          0 :                     changed = true;</span>
<span class="lineNum">    1833 </span><span class="lineNoCov">          0 :                     ref-&gt;selected = true;</span>
<span class="lineNum">    1834 </span><span class="lineNoCov">          0 :                     found-&gt;selected = true;</span>
<span class="lineNum">    1835 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,_(&quot;Both selected references have use-my-metrics set&quot;),0,0);</span>
<span class="lineNum">    1836 </span><span class="lineNoCov">          0 :                     ref-&gt;selected = false;</span>
<span class="lineNum">    1837 </span><span class="lineNoCov">          0 :                     found-&gt;selected = false;</span>
<span class="lineNum">    1838 </span><span class="lineNoCov">          0 :                     if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1839 </span><span class="lineNoCov">          0 :                         p-&gt;multusemymetrics = false;</span>
<span class="lineNum">    1840 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1841 </span>            :                     }
<span class="lineNum">    1842 </span>            :                 }
<span class="lineNum">    1843 </span>            :             }
<span class="lineNum">    1844 </span>            :         }
<span class="lineNum">    1845 </span>            :     }
<span class="lineNum">    1846 </span>            : 
<span class="lineNum">    1847 </span><span class="lineNoCov">          0 :     if ( p-&gt;ptmatchrefsoutofdate &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1848 </span>            :         RefChar *ref;
<span class="lineNum">    1849 </span><span class="lineNoCov">          0 :         for ( ref = sc-&gt;layers[p-&gt;layer].refs; ref!=NULL ; ref = ref-&gt;next )</span>
<span class="lineNum">    1850 </span><span class="lineNoCov">          0 :             ref-&gt;selected = false;</span>
<span class="lineNum">    1851 </span><span class="lineNoCov">          0 :         for ( ref = sc-&gt;layers[p-&gt;layer].refs; !p-&gt;finish &amp;&amp; ref!=NULL ; ref = ref-&gt;next ) {</span>
<span class="lineNum">    1852 </span><span class="lineNoCov">          0 :             if ( ref-&gt;point_match_out_of_date ) {</span>
<span class="lineNum">    1853 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    1854 </span><span class="lineNoCov">          0 :                 ref-&gt;selected = true;</span>
<span class="lineNum">    1855 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;This reference uses point-matching but it refers to a glyph\n(or a previous reference refers to a glyph)\nwhose points have been renumbered.&quot;),0,0);</span>
<span class="lineNum">    1856 </span><span class="lineNoCov">          0 :                 ref-&gt;selected = false;</span>
<span class="lineNum">    1857 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis ) {</span>
<span class="lineNum">    1858 </span><span class="lineNoCov">          0 :                     p-&gt;ptmatchrefsoutofdate = false;</span>
<span class="lineNum">    1859 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1860 </span>            :                 }
<span class="lineNum">    1861 </span>            :             }
<span class="lineNum">    1862 </span>            :         }
<span class="lineNum">    1863 </span>            :     }
<span class="lineNum">    1864 </span>            : 
<span class="lineNum">    1865 </span><span class="lineNoCov">          0 :     if ( p-&gt;toodeeprefs &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1866 </span><span class="lineNoCov">          0 :         int cnt=SCRefDepth(sc,p-&gt;layer);</span>
<span class="lineNum">    1867 </span><span class="lineNoCov">          0 :         if ( cnt&gt;p-&gt;refdepthmax ) {</span>
<span class="lineNum">    1868 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    1869 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;References are nested more deeply in this glyph than the maximum allowed&quot;),cnt,p-&gt;refdepthmax);</span>
<span class="lineNum">    1870 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1871 </span><span class="lineNoCov">          0 :                 p-&gt;toodeeprefs = false;</span>
<span class="lineNum">    1872 </span>            :         }
<span class="lineNum">    1873 </span>            :     }
<span class="lineNum">    1874 </span>            : 
<span class="lineNum">    1875 </span><span class="lineNoCov">          0 :     if ( p-&gt;toomanypoints &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1876 </span><span class="lineNoCov">          0 :         int cnt=0;</span>
<span class="lineNum">    1877 </span>            :         RefChar *r;
<span class="lineNum">    1878 </span><span class="lineNoCov">          0 :         cnt = SPLPointCnt(sc-&gt;layers[p-&gt;layer].splines);</span>
<span class="lineNum">    1879 </span><span class="lineNoCov">          0 :         for ( r=sc-&gt;layers[p-&gt;layer].refs; r!=NULL ; r=r-&gt;next )</span>
<span class="lineNum">    1880 </span><span class="lineNoCov">          0 :             cnt += SPLPointCnt(r-&gt;layers[0].splines);</span>
<span class="lineNum">    1881 </span><span class="lineNoCov">          0 :         if ( cnt&gt;p-&gt;pointsmax ) {</span>
<span class="lineNum">    1882 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    1883 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;There are more points in this glyph than the maximum allowed&quot;),cnt,p-&gt;pointsmax);</span>
<span class="lineNum">    1884 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1885 </span><span class="lineNoCov">          0 :                 p-&gt;toomanypoints = false;</span>
<span class="lineNum">    1886 </span>            :         }
<span class="lineNum">    1887 </span>            :     }
<span class="lineNum">    1888 </span>            : 
<span class="lineNum">    1889 </span><span class="lineNoCov">          0 :     if ( p-&gt;toomanyhints &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1890 </span><span class="lineNoCov">          0 :         int cnt=0;</span>
<span class="lineNum">    1891 </span><span class="lineNoCov">          0 :         for ( h=sc-&gt;hstem; h!=NULL; h=h-&gt;next )</span>
<span class="lineNum">    1892 </span><span class="lineNoCov">          0 :             ++cnt;</span>
<span class="lineNum">    1893 </span><span class="lineNoCov">          0 :         for ( h=sc-&gt;vstem; h!=NULL; h=h-&gt;next )</span>
<span class="lineNum">    1894 </span><span class="lineNoCov">          0 :             ++cnt;</span>
<span class="lineNum">    1895 </span><span class="lineNoCov">          0 :         if ( cnt&gt;p-&gt;hintsmax ) {</span>
<span class="lineNum">    1896 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    1897 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;There are more hints in this glyph than the maximum allowed&quot;),cnt,p-&gt;hintsmax);</span>
<span class="lineNum">    1898 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :                 p-&gt;toomanyhints = false;</span>
<span class="lineNum">    1900 </span>            :         }
<span class="lineNum">    1901 </span>            :     }
<span class="lineNum">    1902 </span>            : 
<span class="lineNum">    1903 </span><span class="lineNoCov">          0 :     if ( p-&gt;bitmaps &amp;&amp; !p-&gt;finish &amp;&amp; SCWorthOutputting(sc)) {</span>
<span class="lineNum">    1904 </span>            :         BDFFont *bdf;
<span class="lineNum">    1905 </span>            : 
<span class="lineNum">    1906 </span><span class="lineNoCov">          0 :         for ( bdf=sc-&gt;parent-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">    1907 </span><span class="lineNoCov">          0 :             if ( sc-&gt;orig_pos&gt;=bdf-&gt;glyphcnt || bdf-&gt;glyphs[sc-&gt;orig_pos]==NULL ) {</span>
<span class="lineNum">    1908 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    1909 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;This outline glyph is missing a bitmap version&quot;),0,0);</span>
<span class="lineNum">    1910 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1911 </span><span class="lineNoCov">          0 :                     p-&gt;bitmaps = false;</span>
<span class="lineNum">    1912 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1913 </span>            :             }
<span class="lineNum">    1914 </span>            :         }
<span class="lineNum">    1915 </span>            :     }
<span class="lineNum">    1916 </span>            : 
<span class="lineNum">    1917 </span><span class="lineNoCov">          0 :     if ( p-&gt;bitmapwidths &amp;&amp; !p-&gt;finish &amp;&amp; SCWorthOutputting(sc)) {</span>
<span class="lineNum">    1918 </span>            :         BDFFont *bdf;
<span class="lineNum">    1919 </span><span class="lineNoCov">          0 :         double em = (sc-&gt;parent-&gt;ascent+sc-&gt;parent-&gt;descent);</span>
<span class="lineNum">    1920 </span>            : 
<span class="lineNum">    1921 </span><span class="lineNoCov">          0 :         for ( bdf=sc-&gt;parent-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next ) {</span>
<span class="lineNum">    1922 </span><span class="lineNoCov">          0 :             if ( sc-&gt;orig_pos&lt;bdf-&gt;glyphcnt &amp;&amp; bdf-&gt;glyphs[sc-&gt;orig_pos]!=NULL ) {</span>
<span class="lineNum">    1923 </span><span class="lineNoCov">          0 :                 BDFChar *bc = bdf-&gt;glyphs[sc-&gt;orig_pos];</span>
<span class="lineNum">    1924 </span><span class="lineNoCov">          0 :                 if ( bc-&gt;width!= (int) rint( (sc-&gt;width*bdf-&gt;pixelsize)/em ) ) {</span>
<span class="lineNum">    1925 </span><span class="lineNoCov">          0 :                     changed = true;</span>
<span class="lineNum">    1926 </span><span class="lineNoCov">          0 :                     ExplainIt(p,sc,_(&quot;This outline glyph's advance width is different from that of the bitmap's&quot;),</span>
<span class="lineNum">    1927 </span><span class="lineNoCov">          0 :                             bc-&gt;width,rint( (sc-&gt;width*bdf-&gt;pixelsize)/em ));</span>
<span class="lineNum">    1928 </span><span class="lineNoCov">          0 :                     if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1929 </span><span class="lineNoCov">          0 :                         p-&gt;bitmapwidths = false;</span>
<span class="lineNum">    1930 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    1931 </span>            :                 }
<span class="lineNum">    1932 </span>            :             }
<span class="lineNum">    1933 </span>            :         }
<span class="lineNum">    1934 </span>            :     }
<span class="lineNum">    1935 </span>            : 
<span class="lineNum">    1936 </span><span class="lineNoCov">          0 :     if ( p-&gt;advancewidth &amp;&amp; !p-&gt;finish &amp;&amp; SCWorthOutputting(sc)) {</span>
<span class="lineNum">    1937 </span><span class="lineNoCov">          0 :         if ( sc-&gt;width!=p-&gt;advancewidthval ) {</span>
<span class="lineNum">    1938 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    1939 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;This glyph's advance width is different from the standard width&quot;),sc-&gt;width,p-&gt;advancewidthval);</span>
<span class="lineNum">    1940 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1941 </span><span class="lineNoCov">          0 :                 p-&gt;advancewidth = false;</span>
<span class="lineNum">    1942 </span>            :         }
<span class="lineNum">    1943 </span>            :     }
<span class="lineNum">    1944 </span>            : 
<span class="lineNum">    1945 </span><span class="lineNoCov">          0 :     if ( p-&gt;vadvancewidth &amp;&amp; !p-&gt;finish &amp;&amp; SCWorthOutputting(sc)) {</span>
<span class="lineNum">    1946 </span><span class="lineNoCov">          0 :         if ( sc-&gt;vwidth!=p-&gt;vadvancewidthval ) {</span>
<span class="lineNum">    1947 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    1948 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;This glyph's vertical advance is different from the standard width&quot;),sc-&gt;vwidth,p-&gt;vadvancewidthval);</span>
<span class="lineNum">    1949 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1950 </span><span class="lineNoCov">          0 :                 p-&gt;vadvancewidth = false;</span>
<span class="lineNum">    1951 </span>            :         }
<span class="lineNum">    1952 </span>            :     }
<span class="lineNum">    1953 </span>            : 
<span class="lineNum">    1954 </span><span class="lineNoCov">          0 :     if ( (p-&gt;bbymax || p-&gt;bbxmax || p-&gt;bbymin || p-&gt;bbxmin) &amp;&amp; !p-&gt;finish &amp;&amp;</span>
<span class="lineNum">    1955 </span><span class="lineNoCov">          0 :             SCWorthOutputting(sc)) {</span>
<span class="lineNum">    1956 </span><span class="lineNoCov">          0 :         SplineCharFindBounds(sc,&amp;bb);</span>
<span class="lineNum">    1957 </span><span class="lineNoCov">          0 :         if ( p-&gt;bbymax &amp;&amp; bb.maxy &gt; p-&gt;bbymax_val ) {</span>
<span class="lineNum">    1958 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    1959 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;This glyph is taller than desired&quot;),bb.maxy,p-&gt;bbymax_val);</span>
<span class="lineNum">    1960 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1961 </span><span class="lineNoCov">          0 :                 p-&gt;bbymax = false;</span>
<span class="lineNum">    1962 </span>            :         }
<span class="lineNum">    1963 </span><span class="lineNoCov">          0 :         if ( p-&gt;bbymin &amp;&amp; bb.miny &lt; p-&gt;bbymin_val ) {</span>
<span class="lineNum">    1964 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    1965 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;This glyph extends further below the baseline than desired&quot;),bb.miny,p-&gt;bbymin_val);</span>
<span class="lineNum">    1966 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1967 </span><span class="lineNoCov">          0 :                 p-&gt;bbymin = false;</span>
<span class="lineNum">    1968 </span>            :         }
<span class="lineNum">    1969 </span><span class="lineNoCov">          0 :         if ( p-&gt;bbxmax &amp;&amp; bb.maxx &gt; p-&gt;bbxmax_val ) {</span>
<span class="lineNum">    1970 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    1971 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;This glyph is wider than desired&quot;),bb.maxx,p-&gt;bbxmax_val);</span>
<span class="lineNum">    1972 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1973 </span><span class="lineNoCov">          0 :                 p-&gt;bbxmax = false;</span>
<span class="lineNum">    1974 </span>            :         }
<span class="lineNum">    1975 </span><span class="lineNoCov">          0 :         if ( p-&gt;bbxmin &amp;&amp; bb.minx &lt; p-&gt;bbxmin_val ) {</span>
<span class="lineNum">    1976 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    1977 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;This glyph extends left further than desired&quot;),bb.minx,p-&gt;bbxmin_val);</span>
<span class="lineNum">    1978 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    1979 </span><span class="lineNoCov">          0 :                 p-&gt;bbxmin = false;</span>
<span class="lineNum">    1980 </span>            :         }
<span class="lineNum">    1981 </span>            :     }
<span class="lineNum">    1982 </span>            : 
<span class="lineNum">    1983 </span><span class="lineNoCov">          0 :     if ( p-&gt;badsubs &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    1984 </span>            :         PST *pst;
<span class="lineNum">    1985 </span>            :         char *pt, *end; int ch;
<span class="lineNum">    1986 </span><span class="lineNoCov">          0 :         for ( pst = sc-&gt;possub ; pst!=NULL; pst=pst-&gt;next ) {</span>
<span class="lineNum">    1987 </span><span class="lineNoCov">          0 :             if ( pst-&gt;type==pst_substitution || pst-&gt;type==pst_alternate ||</span>
<span class="lineNum">    1988 </span><span class="lineNoCov">          0 :                     pst-&gt;type==pst_multiple || pst-&gt;type==pst_ligature ) {</span>
<span class="lineNum">    1989 </span><span class="lineNoCov">          0 :                 for ( pt=pst-&gt;u.subs.variant; *pt!='\0' ; pt=end ) {</span>
<span class="lineNum">    1990 </span><span class="lineNoCov">          0 :                     end = strchr(pt,' ');</span>
<span class="lineNum">    1991 </span><span class="lineNoCov">          0 :                     if ( end==NULL ) end=pt+strlen(pt);</span>
<span class="lineNum">    1992 </span><span class="lineNoCov">          0 :                     ch = *end;</span>
<span class="lineNum">    1993 </span><span class="lineNoCov">          0 :                     *end = '\0';</span>
<span class="lineNum">    1994 </span><span class="lineNoCov">          0 :                     if ( !SCWorthOutputting(SFGetChar(sc-&gt;parent,-1,pt)) ) {</span>
<span class="lineNum">    1995 </span><span class="lineNoCov">          0 :                         changed = true;</span>
<span class="lineNum">    1996 </span><span class="lineNoCov">          0 :                         p-&gt;badsubsname = copy(pt);</span>
<span class="lineNum">    1997 </span><span class="lineNoCov">          0 :                         *end = ch;</span>
<span class="lineNum">    1998 </span><span class="lineNoCov">          0 :                         p-&gt;badsubs_lsubtable = pst-&gt;subtable;</span>
<span class="lineNum">    1999 </span><span class="lineNoCov">          0 :                         ExplainIt(p,sc,_(&quot;This glyph contains a substitution or ligature entry which refers to an empty char&quot;),0,0);</span>
<span class="lineNum">    2000 </span><span class="lineNoCov">          0 :                         free(p-&gt;badsubsname);</span>
<span class="lineNum">    2001 </span><span class="lineNoCov">          0 :                         if ( p-&gt;ignorethis )</span>
<span class="lineNum">    2002 </span><span class="lineNoCov">          0 :                             p-&gt;badsubs = false;</span>
<span class="lineNum">    2003 </span>            :                     } else
<span class="lineNum">    2004 </span><span class="lineNoCov">          0 :                         *end = ch;</span>
<span class="lineNum">    2005 </span><span class="lineNoCov">          0 :                     while ( *end==' ' ) ++end;</span>
<span class="lineNum">    2006 </span><span class="lineNoCov">          0 :                     if ( !p-&gt;badsubs )</span>
<span class="lineNum">    2007 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    2008 </span>            :                 }
<span class="lineNum">    2009 </span><span class="lineNoCov">          0 :                 if ( !p-&gt;badsubs )</span>
<span class="lineNum">    2010 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2011 </span>            :             }
<span class="lineNum">    2012 </span>            :         }
<span class="lineNum">    2013 </span>            :     }
<span class="lineNum">    2014 </span>            : 
<span class="lineNum">    2015 </span><span class="lineNoCov">          0 :     if ( p-&gt;missinganchor &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    2016 </span>            :         for (;;) {
<span class="lineNum">    2017 </span><span class="lineNoCov">          0 :             p-&gt;missinganchor_class = SCValidateAnchors(sc);</span>
<span class="lineNum">    2018 </span><span class="lineNoCov">          0 :             if ( p-&gt;missinganchor_class == NULL )</span>
<span class="lineNum">    2019 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2020 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;This glyph contains anchor points from some, but not all anchor classes in a subtable&quot;),0,0);</span>
<span class="lineNum">    2021 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    2022 </span><span class="lineNoCov">          0 :                 p-&gt;missinganchor = false;</span>
<span class="lineNum">    2023 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2024 </span>            :         }
<span class="lineNum">    2025 </span>            :     }
<span class="lineNum">    2026 </span>            : 
<span class="lineNum">    2027 </span><span class="lineNoCov">          0 :     if ( p-&gt;multuni &amp;&amp; !p-&gt;finish &amp;&amp; sc-&gt;unicodeenc!=-1 ) {</span>
<span class="lineNum">    2028 </span><span class="lineNoCov">          0 :         SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">    2029 </span>            :         int i;
<span class="lineNum">    2030 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;sf-&gt;glyphcnt; ++i )</span>
<span class="lineNum">    2031 </span><span class="lineNoCov">          0 :                 if ( sf-&gt;glyphs[i]!=NULL &amp;&amp; sf-&gt;glyphs[i]!=sc ) {</span>
<span class="lineNum">    2032 </span><span class="lineNoCov">          0 :             if ( sf-&gt;glyphs[i]-&gt;unicodeenc == sc-&gt;unicodeenc ) {</span>
<span class="lineNum">    2033 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    2034 </span><span class="lineNoCov">          0 :                 p-&gt;glyphname = sf-&gt;glyphs[i]-&gt;name;</span>
<span class="lineNum">    2035 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;Two glyphs share the same unicode code point.\nChange the encoding to \&quot;Glyph Order\&quot; and use\nEdit-&gt;Select-&gt;Wildcard with the following code point&quot;),0,0);</span>
<span class="lineNum">    2036 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis )</span>
<span class="lineNum">    2037 </span><span class="lineNoCov">          0 :                     p-&gt;multuni = false;</span>
<span class="lineNum">    2038 </span>            :             }
<span class="lineNum">    2039 </span>            :         }
<span class="lineNum">    2040 </span>            :     }
<span class="lineNum">    2041 </span>            : 
<span class="lineNum">    2042 </span><span class="lineNoCov">          0 :     if ( p-&gt;multname &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    2043 </span><span class="lineNoCov">          0 :         SplineFont *sf = sc-&gt;parent;</span>
<span class="lineNum">    2044 </span>            :         int i;
<span class="lineNum">    2045 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;sf-&gt;glyphcnt; ++i )</span>
<span class="lineNum">    2046 </span><span class="lineNoCov">          0 :                 if ( sf-&gt;glyphs[i]!=NULL &amp;&amp; sf-&gt;glyphs[i]!=sc ) {</span>
<span class="lineNum">    2047 </span><span class="lineNoCov">          0 :             if ( strcmp(sf-&gt;glyphs[i]-&gt;name, sc-&gt;name)==0 ) {</span>
<span class="lineNum">    2048 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    2049 </span><span class="lineNoCov">          0 :                 p-&gt;glyphenc = i;</span>
<span class="lineNum">    2050 </span><span class="lineNoCov">          0 :                 ExplainIt(p,sc,_(&quot;Two glyphs have the same name.\nChange the encoding to \&quot;Glyph Order\&quot; and use\nEdit-&gt;Select-&gt;Wildcard with the following name&quot;),0,0);</span>
<span class="lineNum">    2051 </span><span class="lineNoCov">          0 :                 if ( p-&gt;ignorethis )</span>
<span class="lineNum">    2052 </span><span class="lineNoCov">          0 :                     p-&gt;multname = false;</span>
<span class="lineNum">    2053 </span>            :             }
<span class="lineNum">    2054 </span>            :         }
<span class="lineNum">    2055 </span>            :     }
<span class="lineNum">    2056 </span>            : 
<span class="lineNum">    2057 </span><span class="lineNoCov">          0 :     if ( p-&gt;uninamemismatch &amp;&amp; !p-&gt;finish &amp;&amp;</span>
<span class="lineNum">    2058 </span><span class="lineNoCov">          0 :                 strcmp(sc-&gt;name,&quot;.notdef&quot;)!=0 &amp;&amp;</span>
<span class="lineNum">    2059 </span><span class="lineNoCov">          0 :                 strcmp(sc-&gt;name,&quot;.null&quot;)!=0 &amp;&amp;</span>
<span class="lineNum">    2060 </span><span class="lineNoCov">          0 :                 strcmp(sc-&gt;name,&quot;nonmarkingreturn&quot;)!=0 &amp;&amp;</span>
<span class="lineNum">    2061 </span><span class="lineNoCov">          0 :                 (uni = UniFromName(sc-&gt;name,sc-&gt;parent-&gt;uni_interp,p-&gt;fv-&gt;b.map-&gt;enc))!= -1 &amp;&amp;</span>
<span class="lineNum">    2062 </span><span class="lineNoCov">          0 :                 sc-&gt;unicodeenc != uni ) {</span>
<span class="lineNum">    2063 </span><span class="lineNoCov">          0 :         changed = true;</span>
<span class="lineNum">    2064 </span><span class="lineNoCov">          0 :         p-&gt;glyphenc = sc-&gt;orig_pos;</span>
<span class="lineNum">    2065 </span><span class="lineNoCov">          0 :         if ( sc-&gt;unicodeenc==-1 )</span>
<span class="lineNum">    2066 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;This glyph is not mapped to any unicode code point, but its name should be.&quot;),0,0);</span>
<span class="lineNum">    2067 </span><span class="lineNoCov">          0 :         else if ( strcmp(sc-&gt;name,&quot;alefmaksurainitialarabic&quot;)==0 ||</span>
<span class="lineNum">    2068 </span><span class="lineNoCov">          0 :                   strcmp(sc-&gt;name,&quot;alefmaksuramedialarabic&quot;)==0 )</span>
<span class="lineNum">    2069 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;The use of names 'alefmaksurainitialarabic' and 'alefmaksuramedialarabic' is discouraged.&quot;),0,0);</span>
<span class="lineNum">    2070 </span>            :         else
<span class="lineNum">    2071 </span><span class="lineNoCov">          0 :             ExplainIt(p,sc,_(&quot;This glyph is mapped to a unicode code point which is different from its name.&quot;),0,0);</span>
<span class="lineNum">    2072 </span><span class="lineNoCov">          0 :         if ( p-&gt;ignorethis )</span>
<span class="lineNum">    2073 </span><span class="lineNoCov">          0 :             p-&gt;uninamemismatch = false;</span>
<span class="lineNum">    2074 </span>            :     }
<span class="lineNum">    2075 </span>            : 
<span class="lineNum">    2076 </span>            : 
<span class="lineNum">    2077 </span><span class="lineNoCov">          0 :     if ( needsupdate || changed )</span>
<span class="lineNum">    2078 </span><span class="lineNoCov">          0 :         SCUpdateAll(sc);</span>
<span class="lineNum">    2079 </span><span class="lineNoCov">          0 : return( changed );</span>
<a name="2080"><span class="lineNum">    2080 </span>            : }</a>
<span class="lineNum">    2081 </span>            : 
<span class="lineNum">    2082 </span><span class="lineNoCov">          0 : static int CIDCheck(struct problems *p,int cid) {</span>
<span class="lineNum">    2083 </span><span class="lineNoCov">          0 :     int found = false;</span>
<span class="lineNum">    2084 </span>            : 
<span class="lineNum">    2085 </span><span class="lineNoCov">          0 :     if ( (p-&gt;cidmultiple || p-&gt;cidblank) &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    2086 </span><span class="lineNoCov">          0 :         SplineFont *csf = p-&gt;fv-&gt;b.cidmaster;</span>
<span class="lineNum">    2087 </span>            :         int i, cnt;
<span class="lineNum">    2088 </span><span class="lineNoCov">          0 :         for ( i=cnt=0; i&lt;csf-&gt;subfontcnt; ++i )</span>
<span class="lineNum">    2089 </span><span class="lineNoCov">          0 :             if ( cid&lt;csf-&gt;subfonts[i]-&gt;glyphcnt &amp;&amp;</span>
<span class="lineNum">    2090 </span><span class="lineNoCov">          0 :                     SCWorthOutputting(csf-&gt;subfonts[i]-&gt;glyphs[cid]) )</span>
<span class="lineNum">    2091 </span><span class="lineNoCov">          0 :                 ++cnt;</span>
<span class="lineNum">    2092 </span><span class="lineNoCov">          0 :         if ( cnt&gt;1 &amp;&amp; p-&gt;cidmultiple ) {</span>
<span class="lineNum">    2093 </span><span class="lineNoCov">          0 :             _ExplainIt(p,cid,_(&quot;This glyph is defined in more than one of the CID subfonts&quot;),cnt,1);</span>
<span class="lineNum">    2094 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    2095 </span><span class="lineNoCov">          0 :                 p-&gt;cidmultiple = false;</span>
<span class="lineNum">    2096 </span><span class="lineNoCov">          0 :             found = true;</span>
<span class="lineNum">    2097 </span><span class="lineNoCov">          0 :         } else if ( cnt==0 &amp;&amp; p-&gt;cidblank ) {</span>
<span class="lineNum">    2098 </span><span class="lineNoCov">          0 :             _ExplainIt(p,cid,_(&quot;This glyph is not defined in any of the CID subfonts&quot;),0,0);</span>
<span class="lineNum">    2099 </span><span class="lineNoCov">          0 :             if ( p-&gt;ignorethis )</span>
<span class="lineNum">    2100 </span><span class="lineNoCov">          0 :                 p-&gt;cidblank = false;</span>
<span class="lineNum">    2101 </span><span class="lineNoCov">          0 :             found = true;</span>
<span class="lineNum">    2102 </span>            :         }
<span class="lineNum">    2103 </span>            :     }
<span class="lineNum">    2104 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2105"><span class="lineNum">    2105 </span>            : }</a>
<span class="lineNum">    2106 </span>            : 
<span class="lineNum">    2107 </span><span class="lineNoCov">          0 : static char *missinglookup(struct problems *p,char *str) {</span>
<span class="lineNum">    2108 </span>            :     int i;
<span class="lineNum">    2109 </span>            : 
<span class="lineNum">    2110 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;p-&gt;rpl_cnt; ++i )</span>
<span class="lineNum">    2111 </span><span class="lineNoCov">          0 :         if ( strcmp(str,p-&gt;mg[i].search)==0 )</span>
<span class="lineNum">    2112 </span><span class="lineNoCov">          0 : return( p-&gt;mg[i].rpl );</span>
<span class="lineNum">    2113 </span>            : 
<span class="lineNum">    2114 </span><span class="lineNoCov">          0 : return( NULL );</span>
<a name="2115"><span class="lineNum">    2115 </span>            : }</a>
<span class="lineNum">    2116 </span>            : 
<span class="lineNum">    2117 </span><span class="lineNoCov">          0 : static void mgreplace(char **base, char *str,char *end, char *new, SplineChar *sc, PST *pst) {</span>
<span class="lineNum">    2118 </span>            :     PST *p, *ps;
<span class="lineNum">    2119 </span>            : 
<span class="lineNum">    2120 </span><span class="lineNoCov">          0 :     if ( new==NULL || *new=='\0' ) {</span>
<span class="lineNum">    2121 </span><span class="lineNoCov">          0 :         if ( *base==str &amp;&amp; *end=='\0' &amp;&amp; sc!=NULL ) {</span>
<span class="lineNum">    2122 </span>            :             /* We deleted the last name from the pst, it is meaningless, remove it */
<span class="lineNum">    2123 </span><span class="lineNoCov">          0 :             if ( sc-&gt;possub==pst )</span>
<span class="lineNum">    2124 </span><span class="lineNoCov">          0 :                 sc-&gt;possub = pst-&gt;next;</span>
<span class="lineNum">    2125 </span>            :             else {
<span class="lineNum">    2126 </span><span class="lineNoCov">          0 :                 for ( p = sc-&gt;possub, ps=p-&gt;next; ps!=NULL &amp;&amp; ps!=pst; p=ps, ps=ps-&gt;next );</span>
<span class="lineNum">    2127 </span><span class="lineNoCov">          0 :                 if ( ps!=NULL )</span>
<span class="lineNum">    2128 </span><span class="lineNoCov">          0 :                     p-&gt;next = pst-&gt;next;</span>
<span class="lineNum">    2129 </span>            :             }
<span class="lineNum">    2130 </span><span class="lineNoCov">          0 :             pst-&gt;next = NULL;</span>
<span class="lineNum">    2131 </span><span class="lineNoCov">          0 :             PSTFree(pst);</span>
<span class="lineNum">    2132 </span><span class="lineNoCov">          0 :         } else if ( *end=='\0' )</span>
<span class="lineNum">    2133 </span><span class="lineNoCov">          0 :             *str = '\0';</span>
<span class="lineNum">    2134 </span>            :         else
<span class="lineNum">    2135 </span><span class="lineNoCov">          0 :             strcpy(str,end+1);  /* Skip the space */</span>
<span class="lineNum">    2136 </span>            :     } else {
<span class="lineNum">    2137 </span><span class="lineNoCov">          0 :         char *res = malloc(strlen(*base)+strlen(new)-(end-str)+1);</span>
<span class="lineNum">    2138 </span><span class="lineNoCov">          0 :         strncpy(res,*base,str-*base);</span>
<span class="lineNum">    2139 </span><span class="lineNoCov">          0 :         strcpy(res+(str-*base),new);</span>
<span class="lineNum">    2140 </span><span class="lineNoCov">          0 :         strcat(res,end);</span>
<span class="lineNum">    2141 </span><span class="lineNoCov">          0 :         free(*base);</span>
<span class="lineNum">    2142 </span><span class="lineNoCov">          0 :         *base = res;</span>
<span class="lineNum">    2143 </span>            :     }
<a name="2144"><span class="lineNum">    2144 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2145 </span>            : 
<span class="lineNum">    2146 </span><span class="lineNoCov">          0 : static void ClearMissingState(struct problems *p) {</span>
<span class="lineNum">    2147 </span>            :     int i;
<span class="lineNum">    2148 </span>            : 
<span class="lineNum">    2149 </span><span class="lineNoCov">          0 :     if ( p-&gt;mg!=NULL ) {</span>
<span class="lineNum">    2150 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;p-&gt;rpl_cnt; ++i ) {</span>
<span class="lineNum">    2151 </span><span class="lineNoCov">          0 :             free(p-&gt;mg[i].search);</span>
<span class="lineNum">    2152 </span><span class="lineNoCov">          0 :             free(p-&gt;mg[i].rpl);</span>
<span class="lineNum">    2153 </span>            :         }
<span class="lineNum">    2154 </span><span class="lineNoCov">          0 :         free(p-&gt;mg);</span>
<span class="lineNum">    2155 </span>            :     } else
<span class="lineNum">    2156 </span><span class="lineNoCov">          0 :         free(p-&gt;mlt);</span>
<span class="lineNum">    2157 </span><span class="lineNoCov">          0 :     p-&gt;mlt = NULL;</span>
<span class="lineNum">    2158 </span><span class="lineNoCov">          0 :     p-&gt;mg = NULL;</span>
<span class="lineNum">    2159 </span><span class="lineNoCov">          0 :     p-&gt;rpl_cnt = p-&gt;rpl_max = 0;</span>
<span class="lineNum">    2160 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2161 </span>            : 
<span class="lineNum">    2162 </span>            : enum missingglyph_type { mg_pst, mg_fpst, mg_kern, mg_vkern, mg_asm };
<span class="lineNum">    2163 </span>            : struct mgask_data {
<span class="lineNum">    2164 </span>            :     GWindow gw;
<span class="lineNum">    2165 </span>            :     uint8 done, skipped;
<span class="lineNum">    2166 </span>            :     uint32 tag;
<span class="lineNum">    2167 </span>            :     char **_str, *start, *end;
<span class="lineNum">    2168 </span>            :     SplineChar *sc;
<span class="lineNum">    2169 </span>            :     PST *pst;
<span class="lineNum">    2170 </span>            :     struct problems *p;
<a name="2171"><span class="lineNum">    2171 </span>            : };</a>
<span class="lineNum">    2172 </span>            : 
<span class="lineNum">    2173 </span><span class="lineNoCov">          0 : static void mark_to_replace(struct problems *p,struct mgask_data *d, char *rpl) {</span>
<span class="lineNum">    2174 </span>            :     int ch;
<span class="lineNum">    2175 </span>            : 
<span class="lineNum">    2176 </span><span class="lineNoCov">          0 :     if ( p-&gt;rpl_cnt &gt;= p-&gt;rpl_max ) {</span>
<span class="lineNum">    2177 </span><span class="lineNoCov">          0 :         if ( p-&gt;rpl_max == 0 )</span>
<span class="lineNum">    2178 </span><span class="lineNoCov">          0 :             p-&gt;mg = malloc((p-&gt;rpl_max = 30)*sizeof(struct mgrpl));</span>
<span class="lineNum">    2179 </span>            :         else
<span class="lineNum">    2180 </span><span class="lineNoCov">          0 :             p-&gt;mg = realloc(p-&gt;mg,(p-&gt;rpl_max += 30)*sizeof(struct mgrpl));</span>
<span class="lineNum">    2181 </span>            :     }
<span class="lineNum">    2182 </span><span class="lineNoCov">          0 :     ch = *d-&gt;end; *d-&gt;end = '\0';</span>
<span class="lineNum">    2183 </span><span class="lineNoCov">          0 :     p-&gt;mg[p-&gt;rpl_cnt].search = copy( d-&gt;start );</span>
<span class="lineNum">    2184 </span><span class="lineNoCov">          0 :     p-&gt;mg[p-&gt;rpl_cnt++].rpl = copy( rpl );</span>
<span class="lineNum">    2185 </span><span class="lineNoCov">          0 :     *d-&gt;end = ch;</span>
<span class="lineNum">    2186 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2187 </span>            : 
<span class="lineNum">    2188 </span>            : #define CID_Always      1001
<span class="lineNum">    2189 </span>            : #define CID_RplText     1002
<span class="lineNum">    2190 </span>            : #define CID_Ignore      1003
<span class="lineNum">    2191 </span>            : #define CID_Rpl         1004
<span class="lineNum">    2192 </span>            : #define CID_Skip        1005
<a name="2193"><span class="lineNum">    2193 </span>            : #define CID_Delete      1006</a>
<span class="lineNum">    2194 </span>            : 
<span class="lineNum">    2195 </span><span class="lineNoCov">          0 : static int MGA_RplChange(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2196 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textchanged ) {</span>
<span class="lineNum">    2197 </span><span class="lineNoCov">          0 :         struct mgask_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2198 </span><span class="lineNoCov">          0 :         const unichar_t *rpl = _GGadgetGetTitle(g);</span>
<span class="lineNum">    2199 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(d-&gt;gw,CID_Rpl),*rpl!=0);</span>
<span class="lineNum">    2200 </span>            :     }
<span class="lineNum">    2201 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2202"><span class="lineNum">    2202 </span>            : }</a>
<span class="lineNum">    2203 </span>            : 
<span class="lineNum">    2204 </span><span class="lineNoCov">          0 : static int MGA_Rpl(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2205 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    2206 </span><span class="lineNoCov">          0 :         struct mgask_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2207 </span><span class="lineNoCov">          0 :         const unichar_t *_rpl = _GGadgetGetTitle(GWidgetGetControl(d-&gt;gw,CID_RplText));</span>
<span class="lineNum">    2208 </span><span class="lineNoCov">          0 :         char *rpl = cu_copy(_rpl);</span>
<span class="lineNum">    2209 </span><span class="lineNoCov">          0 :         if ( GGadgetIsChecked(GWidgetGetControl(d-&gt;gw,CID_Always)))</span>
<span class="lineNum">    2210 </span><span class="lineNoCov">          0 :             mark_to_replace(d-&gt;p,d,rpl);</span>
<span class="lineNum">    2211 </span><span class="lineNoCov">          0 :         mgreplace(d-&gt;_str,d-&gt;start,d-&gt;end,rpl,d-&gt;sc,d-&gt;pst);</span>
<span class="lineNum">    2212 </span><span class="lineNoCov">          0 :         free(rpl);</span>
<span class="lineNum">    2213 </span><span class="lineNoCov">          0 :         d-&gt;done = true;</span>
<span class="lineNum">    2214 </span>            :     }
<span class="lineNum">    2215 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2216"><span class="lineNum">    2216 </span>            : }</a>
<span class="lineNum">    2217 </span>            : 
<span class="lineNum">    2218 </span><span class="lineNoCov">          0 : static int MGA_Delete(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2219 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    2220 </span><span class="lineNoCov">          0 :         struct mgask_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2221 </span><span class="lineNoCov">          0 :         if ( GGadgetIsChecked(GWidgetGetControl(d-&gt;gw,CID_Always)))</span>
<span class="lineNum">    2222 </span><span class="lineNoCov">          0 :             mark_to_replace(d-&gt;p,d,&quot;&quot;);</span>
<span class="lineNum">    2223 </span><span class="lineNoCov">          0 :         mgreplace(d-&gt;_str,d-&gt;start,d-&gt;end,&quot;&quot;,d-&gt;sc,d-&gt;pst);</span>
<span class="lineNum">    2224 </span><span class="lineNoCov">          0 :         d-&gt;done = true;</span>
<span class="lineNum">    2225 </span>            :     }
<span class="lineNum">    2226 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2227"><span class="lineNum">    2227 </span>            : }</a>
<span class="lineNum">    2228 </span>            : 
<span class="lineNum">    2229 </span><span class="lineNoCov">          0 : static int MGA_Skip(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2230 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    2231 </span><span class="lineNoCov">          0 :         struct mgask_data *d = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2232 </span><span class="lineNoCov">          0 :         d-&gt;done = d-&gt;skipped = true;</span>
<span class="lineNum">    2233 </span>            :     }
<span class="lineNum">    2234 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2235"><span class="lineNum">    2235 </span>            : }</a>
<span class="lineNum">    2236 </span>            : 
<span class="lineNum">    2237 </span><span class="lineNoCov">          0 : static int mgask_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    2238 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">    2239 </span><span class="lineNoCov">          0 :         struct mgask_data *d = GDrawGetUserData(gw);</span>
<span class="lineNum">    2240 </span><span class="lineNoCov">          0 :         d-&gt;done = d-&gt;skipped = true;</span>
<span class="lineNum">    2241 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type==et_char ) {</span>
<span class="lineNum">    2242 </span><span class="lineNoCov">          0 :         if ( event-&gt;u.chr.keysym == GK_F1 || event-&gt;u.chr.keysym == GK_Help ) {</span>
<span class="lineNum">    2243 </span><span class="lineNoCov">          0 :             help(&quot;problems.html&quot;);</span>
<span class="lineNum">    2244 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    2245 </span>            :         }
<span class="lineNum">    2246 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    2247 </span>            :     }
<span class="lineNum">    2248 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2249"><span class="lineNum">    2249 </span>            : }</a>
<span class="lineNum">    2250 </span>            : 
<span class="lineNum">    2251 </span><span class="lineNoCov">          0 : static int mgAsk(struct problems *p,char **_str,char *str, char *end,uint32 tag,</span>
<span class="lineNum">    2252 </span>            :         SplineChar *sc,enum missingglyph_type which,void *data) {
<span class="lineNum">    2253 </span>            :     char buffer[200];
<span class="lineNum">    2254 </span>            :     static char *pstnames[] = { &quot;&quot;, N_(&quot;position&quot;), N_(&quot;pair&quot;), N_(&quot;substitution&quot;),
<span class="lineNum">    2255 </span>            :         N_(&quot;alternate subs&quot;), N_(&quot;multiple subs&quot;), N_(&quot;ligature&quot;), NULL };
<span class="lineNum">    2256 </span>            :     static char *fpstnames[] = { N_(&quot;Contextual position&quot;), N_(&quot;Contextual substitution&quot;),
<span class="lineNum">    2257 </span>            :         N_(&quot;Chaining position&quot;), N_(&quot;Chaining substitution&quot;), N_(&quot;Reverse chaining subs&quot;), NULL };
<span class="lineNum">    2258 </span>            :     static char *asmnames[] = { N_(&quot;Indic reordering&quot;), N_(&quot;Contextual substitution&quot;),
<span class="lineNum">    2259 </span>            :         N_(&quot;Lig&quot;), NULL, N_(&quot;Simple&quot;), N_(&quot;Contextual insertion&quot;), NULL, NULL, NULL,
<span class="lineNum">    2260 </span>            :         NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL,
<span class="lineNum">    2261 </span>            :         N_(&quot;Kerning&quot;), NULL };
<span class="lineNum">    2262 </span><span class="lineNoCov">          0 :     PST *pst = data;</span>
<span class="lineNum">    2263 </span><span class="lineNoCov">          0 :     FPST *fpst = data;</span>
<span class="lineNum">    2264 </span><span class="lineNoCov">          0 :     ASM *sm = data;</span>
<span class="lineNum">    2265 </span><span class="lineNoCov">          0 :     KernClass *kc = data;</span>
<span class="lineNum">    2266 </span>            :     char end_ch;
<span class="lineNum">    2267 </span>            :     GRect pos;
<span class="lineNum">    2268 </span>            :     GWindow gw;
<span class="lineNum">    2269 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    2270 </span>            :     GGadgetCreateData gcd[12];
<span class="lineNum">    2271 </span>            :     GTextInfo label[12];
<span class="lineNum">    2272 </span>            :     struct mgask_data d;
<span class="lineNum">    2273 </span><span class="lineNoCov">          0 :     int blen = GIntGetResource(_NUM_Buttonsize), ptwidth;</span>
<span class="lineNum">    2274 </span>            :     int k, rplpos;
<span class="lineNum">    2275 </span>            : 
<span class="lineNum">    2276 </span><span class="lineNoCov">          0 :     end_ch = *end; *end = '\0';</span>
<span class="lineNum">    2277 </span>            : 
<span class="lineNum">    2278 </span><span class="lineNoCov">          0 :     if ( which == mg_pst ) {</span>
<span class="lineNum">    2279 </span><span class="lineNoCov">          0 :         snprintf(buffer,sizeof(buffer),</span>
<span class="lineNum">    2280 </span><span class="lineNoCov">          0 :                 _(&quot;Glyph %1$.50s with a %2$s from lookup subtable %3$.50s&quot;),</span>
<span class="lineNum">    2281 </span><span class="lineNoCov">          0 :                 sc-&gt;name, _(pstnames[pst-&gt;type]),</span>
<span class="lineNum">    2282 </span><span class="lineNoCov">          0 :                 pst-&gt;subtable-&gt;subtable_name );</span>
<span class="lineNum">    2283 </span><span class="lineNoCov">          0 :     } else if ( which == mg_fpst )</span>
<span class="lineNum">    2284 </span><span class="lineNoCov">          0 :         snprintf(buffer,sizeof(buffer),</span>
<span class="lineNum">    2285 </span><span class="lineNoCov">          0 :                 _(&quot;%1$s from lookup subtable %2$.50s&quot;),</span>
<span class="lineNum">    2286 </span><span class="lineNoCov">          0 :                 _(fpstnames[fpst-&gt;type-pst_contextpos]),</span>
<span class="lineNum">    2287 </span><span class="lineNoCov">          0 :                 fpst-&gt;subtable-&gt;subtable_name );</span>
<span class="lineNum">    2288 </span><span class="lineNoCov">          0 :     else if ( which == mg_asm )</span>
<span class="lineNum">    2289 </span><span class="lineNoCov">          0 :         snprintf(buffer,sizeof(buffer),</span>
<span class="lineNum">    2290 </span><span class="lineNoCov">          0 :                 _(&quot;%1$s from lookup subtable %2$.50s&quot;),</span>
<span class="lineNum">    2291 </span><span class="lineNoCov">          0 :                 _(asmnames[sm-&gt;type]),</span>
<span class="lineNum">    2292 </span><span class="lineNoCov">          0 :                 sm-&gt;subtable-&gt;subtable_name );</span>
<span class="lineNum">    2293 </span>            :     else
<span class="lineNum">    2294 </span><span class="lineNoCov">          0 :         snprintf(buffer,sizeof(buffer),</span>
<span class="lineNum">    2295 </span><span class="lineNoCov">          0 :                 _(&quot;%1$s from lookup subtable %2$.50s&quot;),</span>
<span class="lineNum">    2296 </span>            :                 which==mg_kern ? _(&quot;Kerning Class&quot;): _(&quot;Vertical Kerning Class&quot;),
<span class="lineNum">    2297 </span><span class="lineNoCov">          0 :                 kc-&gt;subtable-&gt;subtable_name );</span>
<span class="lineNum">    2298 </span>            : 
<span class="lineNum">    2299 </span><span class="lineNoCov">          0 :     memset(&amp;d,'\0',sizeof(d));</span>
<span class="lineNum">    2300 </span><span class="lineNoCov">          0 :     d._str = _str;</span>
<span class="lineNum">    2301 </span><span class="lineNoCov">          0 :     d.start = str;</span>
<span class="lineNum">    2302 </span><span class="lineNoCov">          0 :     d.end = end;</span>
<span class="lineNum">    2303 </span><span class="lineNoCov">          0 :     d.sc = sc;</span>
<span class="lineNum">    2304 </span><span class="lineNoCov">          0 :     d.pst = which==mg_pst ? data : NULL;</span>
<span class="lineNum">    2305 </span><span class="lineNoCov">          0 :     d.p = p;</span>
<span class="lineNum">    2306 </span><span class="lineNoCov">          0 :     d.tag = tag;</span>
<span class="lineNum">    2307 </span>            : 
<span class="lineNum">    2308 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    2309 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_centered|wam_restrict|wam_isdlg;</span>
<span class="lineNum">    2310 </span><span class="lineNoCov">          0 :     wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">    2311 </span><span class="lineNoCov">          0 :     wattrs.is_dlg = 1;</span>
<span class="lineNum">    2312 </span><span class="lineNoCov">          0 :     wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">    2313 </span><span class="lineNoCov">          0 :     wattrs.centered = 1;</span>
<span class="lineNum">    2314 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_pointer;</span>
<span class="lineNum">    2315 </span><span class="lineNoCov">          0 :     wattrs.utf8_window_title = _(&quot;Check for missing glyph names&quot;);</span>
<span class="lineNum">    2316 </span><span class="lineNoCov">          0 :     pos.x = pos.y = 0;</span>
<span class="lineNum">    2317 </span><span class="lineNoCov">          0 :     ptwidth = 3*blen+GGadgetScale(80);</span>
<span class="lineNum">    2318 </span><span class="lineNoCov">          0 :     pos.width =GDrawPointsToPixels(NULL,ptwidth);</span>
<span class="lineNum">    2319 </span><span class="lineNoCov">          0 :     pos.height = GDrawPointsToPixels(NULL,180);</span>
<span class="lineNum">    2320 </span><span class="lineNoCov">          0 :     d.gw = gw = GDrawCreateTopWindow(NULL,&amp;pos,mgask_e_h,&amp;d,&amp;wattrs);</span>
<span class="lineNum">    2321 </span>            : 
<span class="lineNum">    2322 </span><span class="lineNoCov">          0 :     memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">    2323 </span><span class="lineNoCov">          0 :     memset(&amp;gcd,0,sizeof(gcd));</span>
<span class="lineNum">    2324 </span>            : 
<span class="lineNum">    2325 </span><span class="lineNoCov">          0 :     k=0;</span>
<span class="lineNum">    2326 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) buffer;</span>
<span class="lineNum">    2327 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2328 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2329 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = 6;</span>
<span class="lineNum">    2330 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2331 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    2332 </span>            : 
<span class="lineNum">    2333 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot; refers to a missing glyph&quot;);</span>
<span class="lineNum">    2334 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2335 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2336 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+13;</span>
<span class="lineNum">    2337 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2338 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    2339 </span>            : 
<span class="lineNum">    2340 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) str;</span>
<span class="lineNum">    2341 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2342 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2343 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+13;</span>
<span class="lineNum">    2344 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2345 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    2346 </span>            : 
<span class="lineNum">    2347 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Replace With:&quot;);</span>
<span class="lineNum">    2348 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2349 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2350 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 5; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+16;</span>
<span class="lineNum">    2351 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2352 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GLabelCreate;</span>
<span class="lineNum">    2353 </span>            : 
<span class="lineNum">    2354 </span><span class="lineNoCov">          0 :     rplpos = k;</span>
<span class="lineNum">    2355 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+13; gcd[k].gd.pos.width = ptwidth-20;</span>
<span class="lineNum">    2356 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2357 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_RplText;</span>
<span class="lineNum">    2358 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = MGA_RplChange;</span>
<span class="lineNum">    2359 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GTextFieldCreate;</span>
<span class="lineNum">    2360 </span>            : 
<span class="lineNum">    2361 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+30;</span>
<span class="lineNum">    2362 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2363 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Always&quot;);</span>
<span class="lineNum">    2364 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2365 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2366 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_Always;</span>
<span class="lineNum">    2367 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">    2368 </span>            : 
<span class="lineNum">    2369 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Ignore this problem in the future&quot;);</span>
<span class="lineNum">    2370 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2371 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2372 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+20;</span>
<span class="lineNum">    2373 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2374 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_Ignore;</span>
<span class="lineNum">    2375 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GCheckBoxCreate;</span>
<span class="lineNum">    2376 </span>            : 
<span class="lineNum">    2377 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10-3; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+30 -3;</span>
<span class="lineNum">    2378 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = -1;</span>
<span class="lineNum">    2379 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_but_default;</span>
<span class="lineNum">    2380 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Replace&quot;);</span>
<span class="lineNum">    2381 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2382 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2383 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = MGA_Rpl;</span>
<span class="lineNum">    2384 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_Rpl;</span>
<span class="lineNum">    2385 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GButtonCreate;</span>
<span class="lineNum">    2386 </span>            : 
<span class="lineNum">    2387 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 10+blen+(ptwidth-3*blen-GGadgetScale(20))/2;</span>
<span class="lineNum">    2388 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.y = gcd[k-1].gd.pos.y+3;</span>
<span class="lineNum">    2389 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = -1;</span>
<span class="lineNum">    2390 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    2391 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Remove&quot;);</span>
<span class="lineNum">    2392 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2393 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2394 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = MGA_Delete;</span>
<span class="lineNum">    2395 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_Delete;</span>
<span class="lineNum">    2396 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GButtonCreate;</span>
<span class="lineNum">    2397 </span>            : 
<span class="lineNum">    2398 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = -10; gcd[k].gd.pos.y = gcd[k-1].gd.pos.y;</span>
<span class="lineNum">    2399 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = -1;</span>
<span class="lineNum">    2400 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">    2401 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;Skip&quot;);</span>
<span class="lineNum">    2402 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    2403 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    2404 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = MGA_Skip;</span>
<span class="lineNum">    2405 </span><span class="lineNoCov">          0 :     gcd[k].gd.cid = CID_Skip;</span>
<span class="lineNum">    2406 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GButtonCreate;</span>
<span class="lineNum">    2407 </span>            : 
<span class="lineNum">    2408 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.x = 2; gcd[k].gd.pos.y = 2;</span>
<span class="lineNum">    2409 </span><span class="lineNoCov">          0 :     gcd[k].gd.pos.width = pos.width-4; gcd[k].gd.pos.height = pos.height-4;</span>
<span class="lineNum">    2410 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_pos_in_pixels;</span>
<span class="lineNum">    2411 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GGroupCreate;</span>
<span class="lineNum">    2412 </span>            : 
<span class="lineNum">    2413 </span><span class="lineNoCov">          0 :     GGadgetsCreate(gw,gcd);</span>
<span class="lineNum">    2414 </span><span class="lineNoCov">          0 :     *end = end_ch;</span>
<span class="lineNum">    2415 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<span class="lineNum">    2416 </span>            : 
<span class="lineNum">    2417 </span><span class="lineNoCov">          0 :     while ( !d.done )</span>
<span class="lineNum">    2418 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">    2419 </span><span class="lineNoCov">          0 :     if ( GGadgetIsChecked(GWidgetGetControl(gw,CID_Ignore)))</span>
<span class="lineNum">    2420 </span><span class="lineNoCov">          0 :         p-&gt;missingglyph = false;</span>
<span class="lineNum">    2421 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(gw);</span>
<span class="lineNum">    2422 </span><span class="lineNoCov">          0 : return( !d.skipped );</span>
<a name="2423"><span class="lineNum">    2423 </span>            : }</a>
<span class="lineNum">    2424 </span>            : 
<span class="lineNum">    2425 </span><span class="lineNoCov">          0 : static int StrMissingGlyph(struct problems *p,char **_str,SplineChar *sc,int which, void *data) {</span>
<span class="lineNum">    2426 </span><span class="lineNoCov">          0 :     char *end, ch, *str = *_str, *new;</span>
<span class="lineNum">    2427 </span>            :     int off;
<span class="lineNum">    2428 </span><span class="lineNoCov">          0 :     int found = false;</span>
<span class="lineNum">    2429 </span><span class="lineNoCov">          0 :     SplineFont *sf = p-&gt;fv!=NULL ? p-&gt;fv-&gt;b.sf : p-&gt;cv!=NULL ? p-&gt;cv-&gt;b.sc-&gt;parent : p-&gt;msc-&gt;parent;</span>
<span class="lineNum">    2430 </span>            :     SplineChar *ssc;
<span class="lineNum">    2431 </span><span class="lineNoCov">          0 :     int changed=false;</span>
<span class="lineNum">    2432 </span>            : 
<span class="lineNum">    2433 </span><span class="lineNoCov">          0 :     if ( str==NULL )</span>
<span class="lineNum">    2434 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    2435 </span>            : 
<span class="lineNum">    2436 </span><span class="lineNoCov">          0 :     while ( *str ) {</span>
<span class="lineNum">    2437 </span><span class="lineNoCov">          0 :         if ( p-&gt;finish || !p-&gt;missingglyph )</span>
<span class="lineNum">    2438 </span>            :     break;
<span class="lineNum">    2439 </span><span class="lineNoCov">          0 :         while ( *str==' ' ) ++str;</span>
<span class="lineNum">    2440 </span><span class="lineNoCov">          0 :         for ( end=str; *end!='\0' &amp;&amp; *end!=' '; ++end );</span>
<span class="lineNum">    2441 </span><span class="lineNoCov">          0 :         ch = *end; *end='\0';</span>
<span class="lineNum">    2442 </span><span class="lineNoCov">          0 :         if ( strcmp(str,MAC_DELETED_GLYPH_NAME)==0 )</span>
<span class="lineNum">    2443 </span><span class="lineNoCov">          0 :             ssc = (SplineChar *) 1;</span>
<span class="lineNum">    2444 </span>            :         else
<span class="lineNum">    2445 </span><span class="lineNoCov">          0 :             ssc = SFGetChar(sf,-1,str);</span>
<span class="lineNum">    2446 </span><span class="lineNoCov">          0 :         *end = ch;</span>
<span class="lineNum">    2447 </span><span class="lineNoCov">          0 :         if ( ssc==NULL ) {</span>
<span class="lineNum">    2448 </span><span class="lineNoCov">          0 :             off = end-*_str;</span>
<span class="lineNum">    2449 </span><span class="lineNoCov">          0 :             if ( (new = missinglookup(p,str))!=NULL ) {</span>
<span class="lineNum">    2450 </span><span class="lineNoCov">          0 :                 mgreplace(_str, str,end, new, sc, which==mg_pst ? data : NULL);</span>
<span class="lineNum">    2451 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    2452 </span><span class="lineNoCov">          0 :                 off += (strlen(new)-(end-str));</span>
<span class="lineNum">    2453 </span>            :             } else {
<span class="lineNum">    2454 </span><span class="lineNoCov">          0 :                 if ( mgAsk(p,_str,str,end,0,sc,which,data)) {</span>
<span class="lineNum">    2455 </span><span class="lineNoCov">          0 :                     changed = true;</span>
<span class="lineNum">    2456 </span><span class="lineNoCov">          0 :                     off = 0;</span>
<span class="lineNum">    2457 </span>            :                 }
<span class="lineNum">    2458 </span><span class="lineNoCov">          0 :                 found = true;</span>
<span class="lineNum">    2459 </span>            :             }
<span class="lineNum">    2460 </span><span class="lineNoCov">          0 :             if ( changed ) {</span>
<span class="lineNum">    2461 </span>            :                 PST *test;
<span class="lineNum">    2462 </span><span class="lineNoCov">          0 :                 if ( which==mg_pst ) {</span>
<span class="lineNum">    2463 </span><span class="lineNoCov">          0 :                     for ( test = sc-&gt;possub; test!=NULL &amp;&amp; test!=data; test=test-&gt;next );</span>
<span class="lineNum">    2464 </span><span class="lineNoCov">          0 :                     if ( test==NULL )           /* Entire pst was removed */</span>
<span class="lineNum">    2465 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    2466 </span><span class="lineNoCov">          0 :                     *_str = test-&gt;u.subs.variant;</span>
<span class="lineNum">    2467 </span>            :                 }
<span class="lineNum">    2468 </span><span class="lineNoCov">          0 :                 end = *_str+off;</span>
<span class="lineNum">    2469 </span>            :             }
<span class="lineNum">    2470 </span>            :         }
<span class="lineNum">    2471 </span><span class="lineNoCov">          0 :         str = end;</span>
<span class="lineNum">    2472 </span>            :     }
<span class="lineNum">    2473 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2474"><span class="lineNum">    2474 </span>            : }</a>
<span class="lineNum">    2475 </span>            :         
<span class="lineNum">    2476 </span><span class="lineNoCov">          0 : static int SCMissingGlyph(struct problems *p,SplineChar *sc) {</span>
<span class="lineNum">    2477 </span>            :     PST *pst, *next;
<span class="lineNum">    2478 </span><span class="lineNoCov">          0 :     int found = false;</span>
<span class="lineNum">    2479 </span>            : 
<span class="lineNum">    2480 </span><span class="lineNoCov">          0 :     if ( !p-&gt;missingglyph || p-&gt;finish || sc==NULL )</span>
<span class="lineNum">    2481 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    2482 </span>            : 
<span class="lineNum">    2483 </span><span class="lineNoCov">          0 :     for ( pst=sc-&gt;possub; pst!=NULL; pst=next ) {</span>
<span class="lineNum">    2484 </span><span class="lineNoCov">          0 :         next = pst-&gt;next;</span>
<span class="lineNum">    2485 </span><span class="lineNoCov">          0 :         switch ( pst-&gt;type ) {</span>
<span class="lineNum">    2486 </span>            :           case pst_pair:
<span class="lineNum">    2487 </span><span class="lineNoCov">          0 :             found |= StrMissingGlyph(p,&amp;pst-&gt;u.pair.paired,sc,mg_pst,pst);</span>
<span class="lineNum">    2488 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    2489 </span>            :           case pst_substitution:
<span class="lineNum">    2490 </span>            :           case pst_alternate:
<span class="lineNum">    2491 </span>            :           case pst_multiple:
<span class="lineNum">    2492 </span>            :           case pst_ligature:
<span class="lineNum">    2493 </span><span class="lineNoCov">          0 :             found |= StrMissingGlyph(p,&amp;pst-&gt;u.subs.variant,sc,mg_pst,pst);</span>
<span class="lineNum">    2494 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    2495 </span>            :         }
<span class="lineNum">    2496 </span>            :     }
<span class="lineNum">    2497 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2498"><span class="lineNum">    2498 </span>            : }</a>
<span class="lineNum">    2499 </span>            : 
<span class="lineNum">    2500 </span><span class="lineNoCov">          0 : static int KCMissingGlyph(struct problems *p,KernClass *kc,int isv) {</span>
<span class="lineNum">    2501 </span>            :     int i;
<span class="lineNum">    2502 </span><span class="lineNoCov">          0 :     int found = false;</span>
<span class="lineNum">    2503 </span><span class="lineNoCov">          0 :     int which = isv ? mg_vkern : mg_kern;</span>
<span class="lineNum">    2504 </span>            : 
<span class="lineNum">    2505 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;kc-&gt;first_cnt; ++i ) if ( kc-&gt;firsts[i]!=NULL )</span>
<span class="lineNum">    2506 </span><span class="lineNoCov">          0 :         found |= StrMissingGlyph(p,&amp;kc-&gt;firsts[i],NULL,which,kc);</span>
<span class="lineNum">    2507 </span><span class="lineNoCov">          0 :     for ( i=1; i&lt;kc-&gt;second_cnt; ++i )</span>
<span class="lineNum">    2508 </span><span class="lineNoCov">          0 :         found |= StrMissingGlyph(p,&amp;kc-&gt;seconds[i],NULL,which,kc);</span>
<span class="lineNum">    2509 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2510"><span class="lineNum">    2510 </span>            : }</a>
<span class="lineNum">    2511 </span>            : 
<span class="lineNum">    2512 </span><span class="lineNoCov">          0 : static int FPSTMissingGlyph(struct problems *p,FPST *fpst) {</span>
<span class="lineNum">    2513 </span>            :     int i,j;
<span class="lineNum">    2514 </span><span class="lineNoCov">          0 :     int found = false;</span>
<span class="lineNum">    2515 </span>            : 
<span class="lineNum">    2516 </span><span class="lineNoCov">          0 :     switch ( fpst-&gt;format ) {</span>
<span class="lineNum">    2517 </span>            :       case pst_glyphs:
<span class="lineNum">    2518 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;fpst-&gt;rule_cnt; ++i )</span>
<span class="lineNum">    2519 </span><span class="lineNoCov">          0 :             for ( j=0; j&lt;3; ++j )</span>
<span class="lineNum">    2520 </span><span class="lineNoCov">          0 :                 found |= StrMissingGlyph(p,&amp;(&amp;fpst-&gt;rules[i].u.glyph.names)[j],</span>
<span class="lineNum">    2521 </span>            :                         NULL,mg_fpst,fpst);
<span class="lineNum">    2522 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2523 </span>            :       case pst_class:
<span class="lineNum">    2524 </span><span class="lineNoCov">          0 :         for ( i=1; i&lt;3; ++i )</span>
<span class="lineNum">    2525 </span><span class="lineNoCov">          0 :             for ( j=0; j&lt;(&amp;fpst-&gt;nccnt)[i]; ++j )</span>
<span class="lineNum">    2526 </span><span class="lineNoCov">          0 :                 found |= StrMissingGlyph(p,&amp;(&amp;fpst-&gt;nclass)[i][j],NULL,mg_fpst,fpst);</span>
<span class="lineNum">    2527 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2528 </span>            :       case pst_reversecoverage:
<span class="lineNum">    2529 </span><span class="lineNoCov">          0 :         found |= StrMissingGlyph(p,&amp;fpst-&gt;rules[0].u.rcoverage.replacements,NULL,mg_fpst,fpst);</span>
<span class="lineNum">    2530 </span>            :         /* fall through */;
<span class="lineNum">    2531 </span>            :       case pst_coverage:
<span class="lineNum">    2532 </span><span class="lineNoCov">          0 :         for ( i=1; i&lt;3; ++i )</span>
<span class="lineNum">    2533 </span><span class="lineNoCov">          0 :             for ( j=0; j&lt;(&amp;fpst-&gt;rules[0].u.coverage.ncnt)[i]; ++j )</span>
<span class="lineNum">    2534 </span><span class="lineNoCov">          0 :                 found |= StrMissingGlyph(p,&amp;(&amp;fpst-&gt;rules[0].u.coverage.ncovers)[i][j],NULL,mg_fpst,fpst);</span>
<span class="lineNum">    2535 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2536 </span>            :     }
<span class="lineNum">    2537 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2538"><span class="lineNum">    2538 </span>            : }</a>
<span class="lineNum">    2539 </span>            : 
<span class="lineNum">    2540 </span><span class="lineNoCov">          0 : static int ASMMissingGlyph(struct problems *p,ASM *sm) {</span>
<span class="lineNum">    2541 </span>            :     int j;
<span class="lineNum">    2542 </span><span class="lineNoCov">          0 :     int found = false;</span>
<span class="lineNum">    2543 </span>            : 
<span class="lineNum">    2544 </span><span class="lineNoCov">          0 :     for ( j=4; j&lt;sm-&gt;class_cnt; ++j )</span>
<span class="lineNum">    2545 </span><span class="lineNoCov">          0 :         found |= StrMissingGlyph(p,&amp;sm-&gt;classes[j],NULL,mg_asm,sm);</span>
<span class="lineNum">    2546 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2547"><span class="lineNum">    2547 </span>            : }</a>
<span class="lineNum">    2548 </span>            : 
<span class="lineNum">    2549 </span><span class="lineNoCov">          0 : static int LookupFeaturesMissScript(struct problems *p,OTLookup *otl,OTLookup *nested,</span>
<span class="lineNum">    2550 </span>            :         uint32 script, SplineFont *sf, char *glyph_name) {
<span class="lineNum">    2551 </span>            :     OTLookup *invokers, *any;
<span class="lineNum">    2552 </span>            :     struct lookup_subtable *subs;
<span class="lineNum">    2553 </span>            :     int i,l, ret;
<span class="lineNum">    2554 </span><span class="lineNoCov">          0 :     int found = false;</span>
<span class="lineNum">    2555 </span>            :     FeatureScriptLangList *fsl;
<span class="lineNum">    2556 </span>            :     struct scriptlanglist *sl;
<span class="lineNum">    2557 </span>            :     char buffer[400];
<span class="lineNum">    2558 </span>            :     char *buts[4];
<span class="lineNum">    2559 </span>            : 
<span class="lineNum">    2560 </span><span class="lineNoCov">          0 :     if ( script==DEFAULT_SCRIPT )</span>
<span class="lineNum">    2561 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    2562 </span>            : 
<span class="lineNum">    2563 </span><span class="lineNoCov">          0 :     if ( otl-&gt;features == NULL ) {</span>
<span class="lineNum">    2564 </span>            :         /* No features invoke us, so presume that we are to be invoked by a */
<span class="lineNum">    2565 </span>            :         /*  contextual lookup, and check its scripts rather than ours */
<span class="lineNum">    2566 </span><span class="lineNoCov">          0 :         if ( nested!=NULL ) {</span>
<span class="lineNum">    2567 </span>            :             /* There is no need to have a nested contextual lookup */
<span class="lineNum">    2568 </span>            :             /*  so we don't support them */
<span class="lineNum">    2569 </span><span class="lineNoCov">          0 : return(false);</span>
<span class="lineNum">    2570 </span>            :         }
<span class="lineNum">    2571 </span><span class="lineNoCov">          0 :         any = NULL;</span>
<span class="lineNum">    2572 </span><span class="lineNoCov">          0 :         for ( invokers=otl-&gt;lookup_type&gt;=gpos_start?sf-&gt;gpos_lookups:sf-&gt;gsub_lookups;</span>
<span class="lineNum">    2573 </span><span class="lineNoCov">          0 :                 invokers!=NULL ; invokers = invokers-&gt;next ) {</span>
<span class="lineNum">    2574 </span><span class="lineNoCov">          0 :             for ( subs=invokers-&gt;subtables; subs!=NULL; subs=subs-&gt;next ) {</span>
<span class="lineNum">    2575 </span><span class="lineNoCov">          0 :                 if ( subs-&gt;fpst!=NULL ) {</span>
<span class="lineNum">    2576 </span><span class="lineNoCov">          0 :                     FPST *fpst = subs-&gt;fpst;</span>
<span class="lineNum">    2577 </span><span class="lineNoCov">          0 :                     for ( i=0; i&lt;fpst-&gt;rule_cnt; ++i ) {</span>
<span class="lineNum">    2578 </span><span class="lineNoCov">          0 :                         struct fpst_rule *r = &amp;fpst-&gt;rules[i];</span>
<span class="lineNum">    2579 </span><span class="lineNoCov">          0 :                         for ( l=0; l&lt;r-&gt;lookup_cnt; ++l )</span>
<span class="lineNum">    2580 </span><span class="lineNoCov">          0 :                             if ( r-&gt;lookups[l].lookup == otl ) {</span>
<span class="lineNum">    2581 </span><span class="lineNoCov">          0 :                                 found |= LookupFeaturesMissScript(p,invokers,otl,script,sf,glyph_name);</span>
<span class="lineNum">    2582 </span><span class="lineNoCov">          0 :                                 any = invokers;</span>
<span class="lineNum">    2583 </span>            :                             }
<span class="lineNum">    2584 </span>            :                     }
<span class="lineNum">    2585 </span>            :                 }
<span class="lineNum">    2586 </span>            :             }
<span class="lineNum">    2587 </span>            :         }
<span class="lineNum">    2588 </span>            :         if ( any==NULL ) {
<span class="lineNum">    2589 </span>            :             /* No opentype contextual lookup uses this lookup with no features*/
<span class="lineNum">    2590 </span>            :             /*  so it appears totally useless. But a mac feature might I guess*/
<span class="lineNum">    2591 </span>            :             /*  so don't complain */
<span class="lineNum">    2592 </span>            :         }
<span class="lineNum">    2593 </span>            :     } else {
<span class="lineNum">    2594 </span><span class="lineNoCov">          0 :         for ( fsl = otl-&gt;features; fsl!=NULL; fsl=fsl-&gt;next ) {</span>
<span class="lineNum">    2595 </span><span class="lineNoCov">          0 :             for ( sl=fsl-&gt;scripts; sl!=NULL; sl=sl-&gt;next ) {</span>
<span class="lineNum">    2596 </span><span class="lineNoCov">          0 :                 if ( sl-&gt;script==script )</span>
<span class="lineNum">    2597 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    2598 </span>            :             }
<span class="lineNum">    2599 </span><span class="lineNoCov">          0 :             if ( sl!=NULL )</span>
<span class="lineNum">    2600 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    2601 </span>            :         }
<span class="lineNum">    2602 </span><span class="lineNoCov">          0 :         if ( fsl==NULL ) {</span>
<span class="lineNum">    2603 </span><span class="lineNoCov">          0 :             buffer[0]='\0';</span>
<span class="lineNum">    2604 </span><span class="lineNoCov">          0 :             if ( nested!=NULL )</span>
<span class="lineNum">    2605 </span><span class="lineNoCov">          0 :                 snprintf(buffer,sizeof(buffer),</span>
<span class="lineNum">    2606 </span><span class="lineNoCov">          0 :                   _(&quot;The lookup %.30s which invokes lookup %.30s is active &quot;</span>
<span class="lineNum">    2607 </span>            :                     &quot;for glyph %.30s which has script '%c%c%c%c', yet this script does not &quot;
<span class="lineNum">    2608 </span>            :                     &quot;appear in any of the features which apply the lookup.\n&quot;
<span class="lineNum">    2609 </span>            :                     &quot;Would you like to add this script to one of those features?&quot;),
<span class="lineNum">    2610 </span>            :                         otl-&gt;lookup_name, nested-&gt;lookup_name,
<span class="lineNum">    2611 </span>            :                         glyph_name,
<span class="lineNum">    2612 </span>            :                         script&gt;&gt;24, script&gt;&gt;16, script&gt;&gt;8, script);
<span class="lineNum">    2613 </span>            :             else
<span class="lineNum">    2614 </span><span class="lineNoCov">          0 :                 snprintf(buffer,sizeof(buffer),</span>
<span class="lineNum">    2615 </span><span class="lineNoCov">          0 :                   _(&quot;The lookup %.30s is active for glyph %.30s which has script &quot;</span>
<span class="lineNum">    2616 </span>            :                     &quot;'%c%c%c%c', yet this script does not appear in any of the features which &quot;
<span class="lineNum">    2617 </span>            :                     &quot;apply the lookup.\n\n&quot;
<span class="lineNum">    2618 </span>            :                     &quot;Would you like to add this script to one of those features?&quot;),
<span class="lineNum">    2619 </span>            :                         otl-&gt;lookup_name, glyph_name,
<span class="lineNum">    2620 </span>            :                         script&gt;&gt;24, script&gt;&gt;16, script&gt;&gt;8, script);
<span class="lineNum">    2621 </span><span class="lineNoCov">          0 :             buts[0] = _(&quot;_OK&quot;); buts[1] = _(&quot;_Skip&quot;); buts[2]=&quot;_Ignore&quot;; buts[3] = NULL;</span>
<span class="lineNum">    2622 </span><span class="lineNoCov">          0 :             ret = ff_ask(_(&quot;Missing Script&quot;),(const char **) buts,0,1,buffer);</span>
<span class="lineNum">    2623 </span><span class="lineNoCov">          0 :             if ( ret==0 ) {</span>
<span class="lineNum">    2624 </span><span class="lineNoCov">          0 :                 sl = chunkalloc(sizeof(struct scriptlanglist));</span>
<span class="lineNum">    2625 </span><span class="lineNoCov">          0 :                 sl-&gt;script = script;</span>
<span class="lineNum">    2626 </span><span class="lineNoCov">          0 :                 sl-&gt;lang_cnt = 1;</span>
<span class="lineNum">    2627 </span><span class="lineNoCov">          0 :                 sl-&gt;langs[0] = DEFAULT_LANG;</span>
<span class="lineNum">    2628 </span><span class="lineNoCov">          0 :                 sl-&gt;next = otl-&gt;features-&gt;scripts;</span>
<span class="lineNum">    2629 </span><span class="lineNoCov">          0 :                 otl-&gt;features-&gt;scripts = sl;</span>
<span class="lineNum">    2630 </span><span class="lineNoCov">          0 :                 sf-&gt;changed = true;</span>
<span class="lineNum">    2631 </span><span class="lineNoCov">          0 :             } else if ( ret==2 )</span>
<span class="lineNum">    2632 </span><span class="lineNoCov">          0 :                 p-&gt;missingscriptinfeature = false;</span>
<span class="lineNum">    2633 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    2634 </span>            :         }
<span class="lineNum">    2635 </span>            :     }
<span class="lineNum">    2636 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2637"><span class="lineNum">    2637 </span>            : }</a>
<span class="lineNum">    2638 </span>            :     
<span class="lineNum">    2639 </span><span class="lineNoCov">          0 : static int SCMissingScriptFeat(struct problems *p,SplineFont *sf,SplineChar *sc) {</span>
<span class="lineNum">    2640 </span>            :     PST *pst;
<span class="lineNum">    2641 </span><span class="lineNoCov">          0 :     int found = false;</span>
<span class="lineNum">    2642 </span>            :     uint32 script;
<span class="lineNum">    2643 </span>            :     AnchorPoint *ap;
<span class="lineNum">    2644 </span>            : 
<span class="lineNum">    2645 </span><span class="lineNoCov">          0 :     if ( !p-&gt;missingscriptinfeature || p-&gt;finish || sc==NULL )</span>
<span class="lineNum">    2646 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    2647 </span><span class="lineNoCov">          0 :     script = SCScriptFromUnicode(sc);</span>
<span class="lineNum">    2648 </span>            : 
<span class="lineNum">    2649 </span><span class="lineNoCov">          0 :     for ( pst=sc-&gt;possub; pst!=NULL; pst=pst-&gt;next ) if ( pst-&gt;subtable!=NULL )</span>
<span class="lineNum">    2650 </span><span class="lineNoCov">          0 :         found |= LookupFeaturesMissScript(p,pst-&gt;subtable-&gt;lookup,NULL,script,sf,sc-&gt;name);</span>
<span class="lineNum">    2651 </span><span class="lineNoCov">          0 :     for ( ap=sc-&gt;anchor; ap!=NULL; ap=ap-&gt;next )</span>
<span class="lineNum">    2652 </span><span class="lineNoCov">          0 :         found |= LookupFeaturesMissScript(p,ap-&gt;anchor-&gt;subtable-&gt;lookup,NULL,script,sf,sc-&gt;name);</span>
<span class="lineNum">    2653 </span>            : 
<span class="lineNum">    2654 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2655"><span class="lineNum">    2655 </span>            : }</a>
<span class="lineNum">    2656 </span>            : 
<span class="lineNum">    2657 </span><span class="lineNoCov">          0 : static int StrMissingScript(struct problems *p,SplineFont *sf,OTLookup *otl,char *class) {</span>
<span class="lineNum">    2658 </span>            :     char *pt, *start;
<span class="lineNum">    2659 </span>            :     int ch;
<span class="lineNum">    2660 </span>            :     SplineChar *sc;
<span class="lineNum">    2661 </span>            :     uint32 script;
<span class="lineNum">    2662 </span><span class="lineNoCov">          0 :     int found = 0;</span>
<span class="lineNum">    2663 </span>            : 
<span class="lineNum">    2664 </span><span class="lineNoCov">          0 :     if ( class==NULL )</span>
<span class="lineNum">    2665 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    2666 </span>            : 
<span class="lineNum">    2667 </span><span class="lineNoCov">          0 :     for ( pt=class; *pt &amp;&amp; p-&gt;missingscriptinfeature; ) {</span>
<span class="lineNum">    2668 </span><span class="lineNoCov">          0 :         while ( *pt==' ' ) ++pt;</span>
<span class="lineNum">    2669 </span><span class="lineNoCov">          0 :         if ( *pt=='\0' )</span>
<span class="lineNum">    2670 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">    2671 </span><span class="lineNoCov">          0 :         for ( start=pt; *pt &amp;&amp; *pt!=' '; ++pt );</span>
<span class="lineNum">    2672 </span><span class="lineNoCov">          0 :         ch = *pt; *pt='\0';</span>
<span class="lineNum">    2673 </span><span class="lineNoCov">          0 :         sc = SFGetChar(sf,-1,start);</span>
<span class="lineNum">    2674 </span><span class="lineNoCov">          0 :         *pt = ch;</span>
<span class="lineNum">    2675 </span><span class="lineNoCov">          0 :         if ( sc!=NULL ) {</span>
<span class="lineNum">    2676 </span><span class="lineNoCov">          0 :             script = SCScriptFromUnicode(sc);</span>
<span class="lineNum">    2677 </span><span class="lineNoCov">          0 :             found |= LookupFeaturesMissScript(p,otl,NULL,script,sf,sc-&gt;name);</span>
<span class="lineNum">    2678 </span>            :         }
<span class="lineNum">    2679 </span>            :     }
<span class="lineNum">    2680 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2681"><span class="lineNum">    2681 </span>            : }</a>
<span class="lineNum">    2682 </span>            : 
<span class="lineNum">    2683 </span><span class="lineNoCov">          0 : static int KCMissingScriptFeat(struct problems *p,SplineFont *sf, KernClass *kc,int isv) {</span>
<span class="lineNum">    2684 </span>            :     int i;
<span class="lineNum">    2685 </span><span class="lineNoCov">          0 :     int found = false;</span>
<span class="lineNum">    2686 </span><span class="lineNoCov">          0 :     OTLookup *otl = kc-&gt;subtable-&gt;lookup;</span>
<span class="lineNum">    2687 </span>            : 
<span class="lineNum">    2688 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;kc-&gt;first_cnt; ++i )</span>
<span class="lineNum">    2689 </span><span class="lineNoCov">          0 :         found |= StrMissingScript(p,sf,otl,kc-&gt;firsts[i]);</span>
<span class="lineNum">    2690 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2691"><span class="lineNum">    2691 </span>            : }</a>
<span class="lineNum">    2692 </span>            : 
<span class="lineNum">    2693 </span><span class="lineNoCov">          0 : static int FPSTMissingScriptFeat(struct problems *p,SplineFont *sf,FPST *fpst) {</span>
<span class="lineNum">    2694 </span>            :     int i,j;
<span class="lineNum">    2695 </span><span class="lineNoCov">          0 :     int found = false;</span>
<span class="lineNum">    2696 </span><span class="lineNoCov">          0 :     OTLookup *otl = fpst-&gt;subtable-&gt;lookup;</span>
<span class="lineNum">    2697 </span>            : 
<span class="lineNum">    2698 </span><span class="lineNoCov">          0 :     switch ( fpst-&gt;format ) {</span>
<span class="lineNum">    2699 </span>            :       case pst_glyphs:
<span class="lineNum">    2700 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;fpst-&gt;rule_cnt; ++i )</span>
<span class="lineNum">    2701 </span><span class="lineNoCov">          0 :             for ( j=0; j&lt;3; ++j )</span>
<span class="lineNum">    2702 </span><span class="lineNoCov">          0 :                 found |= StrMissingScript(p,sf,otl,(&amp;fpst-&gt;rules[i].u.glyph.names)[j]);</span>
<span class="lineNum">    2703 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2704 </span>            :       case pst_class:
<span class="lineNum">    2705 </span><span class="lineNoCov">          0 :         for ( i=1; i&lt;3; ++i )</span>
<span class="lineNum">    2706 </span><span class="lineNoCov">          0 :             for ( j=0; j&lt;(&amp;fpst-&gt;nccnt)[i]; ++j )</span>
<span class="lineNum">    2707 </span><span class="lineNoCov">          0 :                 found |= StrMissingScript(p,sf,otl,(&amp;fpst-&gt;nclass)[i][j]);</span>
<span class="lineNum">    2708 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2709 </span>            :       case pst_reversecoverage:
<span class="lineNum">    2710 </span><span class="lineNoCov">          0 :                 found |= StrMissingScript(p,sf,otl,fpst-&gt;rules[0].u.rcoverage.replacements);</span>
<span class="lineNum">    2711 </span>            :         /* fall through */;
<span class="lineNum">    2712 </span>            :       case pst_coverage:
<span class="lineNum">    2713 </span><span class="lineNoCov">          0 :         for ( i=1; i&lt;3; ++i )</span>
<span class="lineNum">    2714 </span><span class="lineNoCov">          0 :             for ( j=0; j&lt;(&amp;fpst-&gt;rules[0].u.coverage.ncnt)[i]; ++j )</span>
<span class="lineNum">    2715 </span><span class="lineNoCov">          0 :                 found |= StrMissingScript(p,sf,otl,(&amp;fpst-&gt;rules[0].u.coverage.ncovers)[i][j]);</span>
<span class="lineNum">    2716 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    2717 </span>            :     }
<span class="lineNum">    2718 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2719"><span class="lineNum">    2719 </span>            : }</a>
<span class="lineNum">    2720 </span>            : 
<span class="lineNum">    2721 </span><span class="lineNoCov">          0 : static int CheckForATT(struct problems *p) {</span>
<span class="lineNum">    2722 </span><span class="lineNoCov">          0 :     int found = false;</span>
<span class="lineNum">    2723 </span>            :     int i,k;
<span class="lineNum">    2724 </span>            :     FPST *fpst;
<span class="lineNum">    2725 </span>            :     ASM *sm;
<span class="lineNum">    2726 </span>            :     KernClass *kc;
<span class="lineNum">    2727 </span>            :     SplineFont *_sf, *sf;
<span class="lineNum">    2728 </span>            :     static char *buts[3];
<span class="lineNum">    2729 </span><span class="lineNoCov">          0 :     buts[0] = _(&quot;_Yes&quot;);</span>
<span class="lineNum">    2730 </span><span class="lineNoCov">          0 :     buts[1] = _(&quot;_No&quot;);</span>
<span class="lineNum">    2731 </span><span class="lineNoCov">          0 :     buts[2] = NULL;</span>
<span class="lineNum">    2732 </span>            : 
<span class="lineNum">    2733 </span><span class="lineNoCov">          0 :     _sf = p-&gt;fv-&gt;b.sf;</span>
<span class="lineNum">    2734 </span><span class="lineNoCov">          0 :     if ( _sf-&gt;cidmaster ) _sf = _sf-&gt;cidmaster;</span>
<span class="lineNum">    2735 </span>            : 
<span class="lineNum">    2736 </span><span class="lineNoCov">          0 :     if ( p-&gt;missingglyph &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    2737 </span><span class="lineNoCov">          0 :         if ( p-&gt;cv!=NULL )</span>
<span class="lineNum">    2738 </span><span class="lineNoCov">          0 :             found = SCMissingGlyph(p,p-&gt;cv-&gt;b.sc);</span>
<span class="lineNum">    2739 </span><span class="lineNoCov">          0 :         else if ( p-&gt;msc!=NULL )</span>
<span class="lineNum">    2740 </span><span class="lineNoCov">          0 :             found = SCMissingGlyph(p,p-&gt;msc);</span>
<span class="lineNum">    2741 </span>            :         else {
<span class="lineNum">    2742 </span><span class="lineNoCov">          0 :             k=0;</span>
<span class="lineNum">    2743 </span>            :             do {
<span class="lineNum">    2744 </span><span class="lineNoCov">          0 :                 if ( _sf-&gt;subfonts==NULL ) sf = _sf;</span>
<span class="lineNum">    2745 </span><span class="lineNoCov">          0 :                 else sf = _sf-&gt;subfonts[k++];</span>
<span class="lineNum">    2746 </span><span class="lineNoCov">          0 :                 for ( i=0; i&lt;sf-&gt;glyphcnt &amp;&amp; !p-&gt;finish; ++i ) if ( sf-&gt;glyphs[i]!=NULL )</span>
<span class="lineNum">    2747 </span><span class="lineNoCov">          0 :                     found |= SCMissingGlyph(p,sf-&gt;glyphs[i]);</span>
<span class="lineNum">    2748 </span><span class="lineNoCov">          0 :             } while ( k&lt;_sf-&gt;subfontcnt &amp;&amp; !p-&gt;finish );</span>
<span class="lineNum">    2749 </span><span class="lineNoCov">          0 :             for ( kc=_sf-&gt;kerns; kc!=NULL &amp;&amp; !p-&gt;finish; kc=kc-&gt;next )</span>
<span class="lineNum">    2750 </span><span class="lineNoCov">          0 :                 found |= KCMissingGlyph(p,kc,false);</span>
<span class="lineNum">    2751 </span><span class="lineNoCov">          0 :             for ( kc=_sf-&gt;vkerns; kc!=NULL &amp;&amp; !p-&gt;finish; kc=kc-&gt;next )</span>
<span class="lineNum">    2752 </span><span class="lineNoCov">          0 :                 found |= KCMissingGlyph(p,kc,true);</span>
<span class="lineNum">    2753 </span><span class="lineNoCov">          0 :             for ( fpst=_sf-&gt;possub; fpst!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;missingglyph; fpst=fpst-&gt;next )</span>
<span class="lineNum">    2754 </span><span class="lineNoCov">          0 :                 found |= FPSTMissingGlyph(p,fpst);</span>
<span class="lineNum">    2755 </span><span class="lineNoCov">          0 :             for ( sm=_sf-&gt;sm; sm!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;missingglyph; sm=sm-&gt;next )</span>
<span class="lineNum">    2756 </span><span class="lineNoCov">          0 :                 found |= ASMMissingGlyph(p,sm);</span>
<span class="lineNum">    2757 </span>            :         }
<span class="lineNum">    2758 </span><span class="lineNoCov">          0 :         ClearMissingState(p);</span>
<span class="lineNum">    2759 </span>            :     }
<span class="lineNum">    2760 </span>            : 
<span class="lineNum">    2761 </span><span class="lineNoCov">          0 :     if ( p-&gt;missingscriptinfeature &amp;&amp; !p-&gt;finish ) {</span>
<span class="lineNum">    2762 </span><span class="lineNoCov">          0 :         if ( p-&gt;cv!=NULL )</span>
<span class="lineNum">    2763 </span><span class="lineNoCov">          0 :             found = SCMissingScriptFeat(p,_sf,p-&gt;cv-&gt;b.sc);</span>
<span class="lineNum">    2764 </span><span class="lineNoCov">          0 :         else if ( p-&gt;msc!=NULL )</span>
<span class="lineNum">    2765 </span><span class="lineNoCov">          0 :             found = SCMissingScriptFeat(p,_sf,p-&gt;msc);</span>
<span class="lineNum">    2766 </span>            :         else {
<span class="lineNum">    2767 </span><span class="lineNoCov">          0 :             k=0;</span>
<span class="lineNum">    2768 </span>            :             do {
<span class="lineNum">    2769 </span><span class="lineNoCov">          0 :                 if ( _sf-&gt;subfonts==NULL ) sf = _sf;</span>
<span class="lineNum">    2770 </span><span class="lineNoCov">          0 :                 else sf = _sf-&gt;subfonts[k++];</span>
<span class="lineNum">    2771 </span><span class="lineNoCov">          0 :                 for ( i=0; i&lt;sf-&gt;glyphcnt &amp;&amp; !p-&gt;finish; ++i ) if ( sf-&gt;glyphs[i]!=NULL )</span>
<span class="lineNum">    2772 </span><span class="lineNoCov">          0 :                     found |= SCMissingScriptFeat(p,_sf,sf-&gt;glyphs[i]);</span>
<span class="lineNum">    2773 </span><span class="lineNoCov">          0 :             } while ( k&lt;_sf-&gt;subfontcnt &amp;&amp; !p-&gt;finish );</span>
<span class="lineNum">    2774 </span><span class="lineNoCov">          0 :             for ( kc=_sf-&gt;kerns; kc!=NULL &amp;&amp; !p-&gt;finish; kc=kc-&gt;next )</span>
<span class="lineNum">    2775 </span><span class="lineNoCov">          0 :                 found |= KCMissingScriptFeat(p,_sf,kc,false);</span>
<span class="lineNum">    2776 </span><span class="lineNoCov">          0 :             for ( kc=_sf-&gt;vkerns; kc!=NULL &amp;&amp; !p-&gt;finish; kc=kc-&gt;next )</span>
<span class="lineNum">    2777 </span><span class="lineNoCov">          0 :                 found |= KCMissingScriptFeat(p,_sf,kc,true);</span>
<span class="lineNum">    2778 </span><span class="lineNoCov">          0 :             for ( fpst=_sf-&gt;possub; fpst!=NULL &amp;&amp; !p-&gt;finish &amp;&amp; p-&gt;missingglyph; fpst=fpst-&gt;next )</span>
<span class="lineNum">    2779 </span><span class="lineNoCov">          0 :                 found |= FPSTMissingScriptFeat(p,_sf,fpst);</span>
<span class="lineNum">    2780 </span>            :             /* Apple's state machines don't have the concept of &quot;script&quot; */
<span class="lineNum">    2781 </span>            :             /*  for their feature/settings */
<span class="lineNum">    2782 </span>            :         }
<span class="lineNum">    2783 </span>            :     }
<span class="lineNum">    2784 </span>            : 
<span class="lineNum">    2785 </span><span class="lineNoCov">          0 : return( found );</span>
<a name="2786"><span class="lineNum">    2786 </span>            : }</a>
<span class="lineNum">    2787 </span>            : 
<span class="lineNum">    2788 </span><span class="lineNoCov">          0 : static void DoProbs(struct problems *p) {</span>
<span class="lineNum">    2789 </span><span class="lineNoCov">          0 :     int i, ret=false, gid;</span>
<span class="lineNum">    2790 </span>            :     SplineChar *sc;
<span class="lineNum">    2791 </span>            :     BDFFont *bdf;
<span class="lineNum">    2792 </span>            : 
<span class="lineNum">    2793 </span><span class="lineNoCov">          0 :     ret = CheckForATT(p);</span>
<span class="lineNum">    2794 </span><span class="lineNoCov">          0 :     if ( p-&gt;cv!=NULL ) {</span>
<span class="lineNum">    2795 </span><span class="lineNoCov">          0 :         ret |= SCProblems(p-&gt;cv,NULL,p);</span>
<span class="lineNum">    2796 </span><span class="lineNoCov">          0 :         ret |= CIDCheck(p,p-&gt;cv-&gt;b.sc-&gt;orig_pos);</span>
<span class="lineNum">    2797 </span><span class="lineNoCov">          0 :     } else if ( p-&gt;msc!=NULL ) {</span>
<span class="lineNum">    2798 </span><span class="lineNoCov">          0 :         ret |= SCProblems(NULL,p-&gt;msc,p);</span>
<span class="lineNum">    2799 </span><span class="lineNoCov">          0 :         ret |= CIDCheck(p,p-&gt;msc-&gt;orig_pos);</span>
<span class="lineNum">    2800 </span>            :     } else {
<span class="lineNum">    2801 </span><span class="lineNoCov">          0 :         for ( i=0; i&lt;p-&gt;fv-&gt;b.map-&gt;enccount &amp;&amp; !p-&gt;finish; ++i )</span>
<span class="lineNum">    2802 </span><span class="lineNoCov">          0 :             if ( p-&gt;fv-&gt;b.selected[i] ) {</span>
<span class="lineNum">    2803 </span><span class="lineNoCov">          0 :                 sc = NULL;</span>
<span class="lineNum">    2804 </span><span class="lineNoCov">          0 :                 if ( (gid=p-&gt;fv-&gt;b.map-&gt;map[i])!=-1 &amp;&amp; (sc = p-&gt;fv-&gt;b.sf-&gt;glyphs[gid])!=NULL ) {</span>
<span class="lineNum">    2805 </span><span class="lineNoCov">          0 :                     if ( SCProblems(NULL,sc,p)) {</span>
<span class="lineNum">    2806 </span><span class="lineNoCov">          0 :                         if ( sc!=p-&gt;lastcharopened ) {</span>
<span class="lineNum">    2807 </span><span class="lineNoCov">          0 :                             if ( (CharView *) (sc-&gt;views)!=NULL )</span>
<span class="lineNum">    2808 </span><span class="lineNoCov">          0 :                                 GDrawRaise(((CharView *) (sc-&gt;views))-&gt;gw);</span>
<span class="lineNum">    2809 </span>            :                             else
<span class="lineNum">    2810 </span><span class="lineNoCov">          0 :                                 CharViewCreate(sc,p-&gt;fv,-1);</span>
<span class="lineNum">    2811 </span><span class="lineNoCov">          0 :                             p-&gt;lastcharopened = sc;</span>
<span class="lineNum">    2812 </span>            :                         }
<span class="lineNum">    2813 </span><span class="lineNoCov">          0 :                         ret = true;</span>
<span class="lineNum">    2814 </span>            :                     }
<span class="lineNum">    2815 </span>            :                 }
<span class="lineNum">    2816 </span><span class="lineNoCov">          0 :                 if ( !p-&gt;finish &amp;&amp; p-&gt;bitmaps &amp;&amp; !SCWorthOutputting(sc)) {</span>
<span class="lineNum">    2817 </span><span class="lineNoCov">          0 :                     for ( bdf=p-&gt;fv-&gt;b.sf-&gt;bitmaps; bdf!=NULL; bdf=bdf-&gt;next )</span>
<span class="lineNum">    2818 </span><span class="lineNoCov">          0 :                         if ( i&lt;bdf-&gt;glyphcnt &amp;&amp; bdf-&gt;glyphs[i]!=NULL ) {</span>
<span class="lineNum">    2819 </span><span class="lineNoCov">          0 :                             sc = SFMakeChar(p-&gt;fv-&gt;b.sf,p-&gt;fv-&gt;b.map,i);</span>
<span class="lineNum">    2820 </span><span class="lineNoCov">          0 :                             ExplainIt(p,sc,_(&quot;This blank outline glyph has an unexpected bitmap version&quot;),0,0);</span>
<span class="lineNum">    2821 </span><span class="lineNoCov">          0 :                             ret = true;</span>
<span class="lineNum">    2822 </span>            :                         }
<span class="lineNum">    2823 </span>            :                 }
<span class="lineNum">    2824 </span><span class="lineNoCov">          0 :                 ret |= CIDCheck(p,i);</span>
<span class="lineNum">    2825 </span>            :             }
<span class="lineNum">    2826 </span>            :     }
<span class="lineNum">    2827 </span><span class="lineNoCov">          0 :     if ( !ret )</span>
<span class="lineNum">    2828 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;No problems found&quot;),_(&quot;No problems found&quot;));</span>
<a name="2829"><span class="lineNum">    2829 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2830 </span>            : 
<span class="lineNum">    2831 </span><span class="lineNoCov">          0 : static void FigureStandardHeights(struct problems *p) {</span>
<span class="lineNum">    2832 </span>            :     BlueData bd;
<span class="lineNum">    2833 </span>            : 
<span class="lineNum">    2834 </span><span class="lineNoCov">          0 :     QuickBlues(p-&gt;fv-&gt;b.sf,p-&gt;layer,&amp;bd);</span>
<span class="lineNum">    2835 </span><span class="lineNoCov">          0 :     p-&gt;xheight = bd.xheight;</span>
<span class="lineNum">    2836 </span><span class="lineNoCov">          0 :     p-&gt;caph = bd.caph;</span>
<span class="lineNum">    2837 </span><span class="lineNoCov">          0 :     p-&gt;ascent = bd.ascent;</span>
<span class="lineNum">    2838 </span><span class="lineNoCov">          0 :     p-&gt;descent = bd.descent;</span>
<a name="2839"><span class="lineNum">    2839 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2840 </span>            : 
<span class="lineNum">    2841 </span><span class="lineNoCov">          0 : static int Prob_DoAll(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2842 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    2843 </span><span class="lineNoCov">          0 :         struct problems *p = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    2844 </span><span class="lineNoCov">          0 :         int set = GGadgetGetCid(g)==CID_SetAll;</span>
<span class="lineNum">    2845 </span><span class="lineNoCov">          0 :         GWindow gw = GGadgetGetWindow(g);</span>
<span class="lineNum">    2846 </span>            :         static int cbs[] = { CID_OpenPaths, CID_IntersectingPaths,
<span class="lineNum">    2847 </span>            :             CID_PointsTooClose, CID_XNear, CID_MissingExtrema,
<span class="lineNum">    2848 </span>            :             CID_PointsTooFar, CID_NonIntegral,
<span class="lineNum">    2849 </span>            :             CID_YNear, CID_YNearStd, CID_HintNoPt, CID_PtNearHint,
<span class="lineNum">    2850 </span>            :             CID_HintWidthNear, CID_LineStd, CID_Direction, CID_CpStd,
<span class="lineNum">    2851 </span>            :             CID_CpOdd, CID_FlippedRefs, CID_Bitmaps, CID_AdvanceWidth,
<span class="lineNum">    2852 </span>            :             CID_BadSubs, CID_MissingAnchor, CID_MissingGlyph,
<span class="lineNum">    2853 </span>            :             CID_MissingScriptInFeature,
<span class="lineNum">    2854 </span>            :             CID_Stem3, CID_IrrelevantCP, CID_TooManyPoints,
<span class="lineNum">    2855 </span>            :             CID_TooManyHints, CID_TooDeepRefs, CID_BitmapWidths,
<span class="lineNum">    2856 </span>            :             CID_MultUni, CID_MultName, CID_PtMatchRefsOutOfDate,
<span class="lineNum">    2857 </span>            :             CID_RefBadTransformTTF, CID_RefBadTransformPS, CID_MixedContoursRefs,
<span class="lineNum">    2858 </span>            :             CID_UniNameMisMatch, CID_BBYMax, CID_BBYMin, CID_BBXMax, CID_BBXMin,
<span class="lineNum">    2859 </span>            :             CID_MultUseMyMetrics, CID_OverlappedHints,
<span class="lineNum">    2860 </span>            :             0 };
<span class="lineNum">    2861 </span>            :         int i;
<span class="lineNum">    2862 </span><span class="lineNoCov">          0 :         if ( p-&gt;fv-&gt;b.cidmaster!=NULL ) {</span>
<span class="lineNum">    2863 </span><span class="lineNoCov">          0 :             GGadgetSetChecked(GWidgetGetControl(gw,CID_CIDMultiple),set);</span>
<span class="lineNum">    2864 </span><span class="lineNoCov">          0 :             GGadgetSetChecked(GWidgetGetControl(gw,CID_CIDBlank),set);</span>
<span class="lineNum">    2865 </span>            :         }
<span class="lineNum">    2866 </span><span class="lineNoCov">          0 :         if ( p-&gt;fv-&gt;b.sf-&gt;hasvmetrics )</span>
<span class="lineNum">    2867 </span><span class="lineNoCov">          0 :             GGadgetSetChecked(GWidgetGetControl(gw,CID_VAdvanceWidth),set);</span>
<span class="lineNum">    2868 </span><span class="lineNoCov">          0 :         for ( i=0; cbs[i]!=0; ++i )</span>
<span class="lineNum">    2869 </span><span class="lineNoCov">          0 :             GGadgetSetChecked(GWidgetGetControl(gw,cbs[i]),set);</span>
<span class="lineNum">    2870 </span>            :     }
<span class="lineNum">    2871 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2872"><span class="lineNum">    2872 </span>            : }</a>
<span class="lineNum">    2873 </span>            : 
<span class="lineNum">    2874 </span><span class="lineNoCov">          0 : static int Prob_OK(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    2875 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    2876 </span><span class="lineNoCov">          0 :         GWindow gw = GGadgetGetWindow(g);</span>
<span class="lineNum">    2877 </span><span class="lineNoCov">          0 :         struct problems *p = GDrawGetUserData(gw);</span>
<span class="lineNum">    2878 </span><span class="lineNoCov">          0 :         int errs = false;</span>
<span class="lineNum">    2879 </span>            : 
<span class="lineNum">    2880 </span><span class="lineNoCov">          0 :         openpaths = p-&gt;openpaths = GGadgetIsChecked(GWidgetGetControl(gw,CID_OpenPaths));</span>
<span class="lineNum">    2881 </span><span class="lineNoCov">          0 :         intersectingpaths = p-&gt;intersectingpaths = GGadgetIsChecked(GWidgetGetControl(gw,CID_IntersectingPaths));</span>
<span class="lineNum">    2882 </span><span class="lineNoCov">          0 :         nonintegral = p-&gt;nonintegral = GGadgetIsChecked(GWidgetGetControl(gw,CID_NonIntegral));</span>
<span class="lineNum">    2883 </span><span class="lineNoCov">          0 :         pointstooclose = p-&gt;pointstooclose = GGadgetIsChecked(GWidgetGetControl(gw,CID_PointsTooClose));</span>
<span class="lineNum">    2884 </span><span class="lineNoCov">          0 :         pointstoofar = p-&gt;pointstoofar = GGadgetIsChecked(GWidgetGetControl(gw,CID_PointsTooFar));</span>
<span class="lineNum">    2885 </span>            :         /*missing = p-&gt;missingextrema = GGadgetIsChecked(GWidgetGetControl(gw,CID_MissingExtrema))*/;
<span class="lineNum">    2886 </span><span class="lineNoCov">          0 :         doxnear = p-&gt;xnearval = GGadgetIsChecked(GWidgetGetControl(gw,CID_XNear));</span>
<span class="lineNum">    2887 </span><span class="lineNoCov">          0 :         doynear = p-&gt;ynearval = GGadgetIsChecked(GWidgetGetControl(gw,CID_YNear));</span>
<span class="lineNum">    2888 </span><span class="lineNoCov">          0 :         doynearstd = p-&gt;ynearstd = GGadgetIsChecked(GWidgetGetControl(gw,CID_YNearStd));</span>
<span class="lineNum">    2889 </span><span class="lineNoCov">          0 :         linestd = p-&gt;linenearstd = GGadgetIsChecked(GWidgetGetControl(gw,CID_LineStd));</span>
<span class="lineNum">    2890 </span><span class="lineNoCov">          0 :         cpstd = p-&gt;cpnearstd = GGadgetIsChecked(GWidgetGetControl(gw,CID_CpStd));</span>
<span class="lineNum">    2891 </span><span class="lineNoCov">          0 :         cpodd = p-&gt;cpodd = GGadgetIsChecked(GWidgetGetControl(gw,CID_CpOdd));</span>
<span class="lineNum">    2892 </span><span class="lineNoCov">          0 :         hintnopt = p-&gt;hintwithnopt = GGadgetIsChecked(GWidgetGetControl(gw,CID_HintNoPt));</span>
<span class="lineNum">    2893 </span><span class="lineNoCov">          0 :         ptnearhint = p-&gt;ptnearhint = GGadgetIsChecked(GWidgetGetControl(gw,CID_PtNearHint));</span>
<span class="lineNum">    2894 </span><span class="lineNoCov">          0 :         hintwidth = p-&gt;hintwidthnearval = GGadgetIsChecked(GWidgetGetControl(gw,CID_HintWidthNear));</span>
<span class="lineNum">    2895 </span><span class="lineNoCov">          0 :         missingextrema = p-&gt;missingextrema = GGadgetIsChecked(GWidgetGetControl(gw,CID_MissingExtrema));</span>
<span class="lineNum">    2896 </span><span class="lineNoCov">          0 :         direction = p-&gt;direction = GGadgetIsChecked(GWidgetGetControl(gw,CID_Direction));</span>
<span class="lineNum">    2897 </span><span class="lineNoCov">          0 :         flippedrefs = p-&gt;flippedrefs = GGadgetIsChecked(GWidgetGetControl(gw,CID_FlippedRefs));</span>
<span class="lineNum">    2898 </span><span class="lineNoCov">          0 :         bitmaps = p-&gt;bitmaps = GGadgetIsChecked(GWidgetGetControl(gw,CID_Bitmaps));</span>
<span class="lineNum">    2899 </span><span class="lineNoCov">          0 :         bitmapwidths = p-&gt;bitmapwidths = GGadgetIsChecked(GWidgetGetControl(gw,CID_BitmapWidths));</span>
<span class="lineNum">    2900 </span><span class="lineNoCov">          0 :         advancewidth = p-&gt;advancewidth = GGadgetIsChecked(GWidgetGetControl(gw,CID_AdvanceWidth));</span>
<span class="lineNum">    2901 </span><span class="lineNoCov">          0 :         bbymax = p-&gt;bbymax = GGadgetIsChecked(GWidgetGetControl(gw,CID_BBYMax));</span>
<span class="lineNum">    2902 </span><span class="lineNoCov">          0 :         bbymin = p-&gt;bbymin = GGadgetIsChecked(GWidgetGetControl(gw,CID_BBYMin));</span>
<span class="lineNum">    2903 </span><span class="lineNoCov">          0 :         bbxmax = p-&gt;bbxmax = GGadgetIsChecked(GWidgetGetControl(gw,CID_BBXMax));</span>
<span class="lineNum">    2904 </span><span class="lineNoCov">          0 :         bbxmin = p-&gt;bbxmin = GGadgetIsChecked(GWidgetGetControl(gw,CID_BBXMin));</span>
<span class="lineNum">    2905 </span><span class="lineNoCov">          0 :         irrelevantcp = p-&gt;irrelevantcontrolpoints = GGadgetIsChecked(GWidgetGetControl(gw,CID_IrrelevantCP));</span>
<span class="lineNum">    2906 </span><span class="lineNoCov">          0 :         multuni = p-&gt;multuni = GGadgetIsChecked(GWidgetGetControl(gw,CID_MultUni));</span>
<span class="lineNum">    2907 </span><span class="lineNoCov">          0 :         multname = p-&gt;multname = GGadgetIsChecked(GWidgetGetControl(gw,CID_MultName));</span>
<span class="lineNum">    2908 </span><span class="lineNoCov">          0 :         uninamemismatch = p-&gt;uninamemismatch = GGadgetIsChecked(GWidgetGetControl(gw,CID_UniNameMisMatch));</span>
<span class="lineNum">    2909 </span><span class="lineNoCov">          0 :         badsubs = p-&gt;badsubs = GGadgetIsChecked(GWidgetGetControl(gw,CID_BadSubs));</span>
<span class="lineNum">    2910 </span><span class="lineNoCov">          0 :         missinganchor = p-&gt;missinganchor = GGadgetIsChecked(GWidgetGetControl(gw,CID_MissingAnchor));</span>
<span class="lineNum">    2911 </span><span class="lineNoCov">          0 :         missingglyph = p-&gt;missingglyph = GGadgetIsChecked(GWidgetGetControl(gw,CID_MissingGlyph));</span>
<span class="lineNum">    2912 </span><span class="lineNoCov">          0 :         missingscriptinfeature = p-&gt;missingscriptinfeature = GGadgetIsChecked(GWidgetGetControl(gw,CID_MissingScriptInFeature));</span>
<span class="lineNum">    2913 </span><span class="lineNoCov">          0 :         toomanypoints = p-&gt;toomanypoints = GGadgetIsChecked(GWidgetGetControl(gw,CID_TooManyPoints));</span>
<span class="lineNum">    2914 </span><span class="lineNoCov">          0 :         toomanyhints = p-&gt;toomanyhints = GGadgetIsChecked(GWidgetGetControl(gw,CID_TooManyHints));</span>
<span class="lineNum">    2915 </span><span class="lineNoCov">          0 :         overlappedhints = p-&gt;overlappedhints = GGadgetIsChecked(GWidgetGetControl(gw,CID_OverlappedHints));</span>
<span class="lineNum">    2916 </span><span class="lineNoCov">          0 :         ptmatchrefsoutofdate = p-&gt;ptmatchrefsoutofdate = GGadgetIsChecked(GWidgetGetControl(gw,CID_PtMatchRefsOutOfDate));</span>
<span class="lineNum">    2917 </span><span class="lineNoCov">          0 :         multusemymetrics = p-&gt;multusemymetrics = GGadgetIsChecked(GWidgetGetControl(gw,CID_MultUseMyMetrics));</span>
<span class="lineNum">    2918 </span><span class="lineNoCov">          0 :         refsbadtransformttf = p-&gt;refsbadtransformttf = GGadgetIsChecked(GWidgetGetControl(gw,CID_RefBadTransformTTF));</span>
<span class="lineNum">    2919 </span><span class="lineNoCov">          0 :         refsbadtransformps = p-&gt;refsbadtransformps = GGadgetIsChecked(GWidgetGetControl(gw,CID_RefBadTransformPS));</span>
<span class="lineNum">    2920 </span><span class="lineNoCov">          0 :         mixedcontoursrefs = p-&gt;mixedcontoursrefs = GGadgetIsChecked(GWidgetGetControl(gw,CID_MixedContoursRefs));</span>
<span class="lineNum">    2921 </span><span class="lineNoCov">          0 :         toodeeprefs = p-&gt;toodeeprefs = GGadgetIsChecked(GWidgetGetControl(gw,CID_TooDeepRefs));</span>
<span class="lineNum">    2922 </span><span class="lineNoCov">          0 :         stem3 = p-&gt;stem3 = GGadgetIsChecked(GWidgetGetControl(gw,CID_Stem3));</span>
<span class="lineNum">    2923 </span><span class="lineNoCov">          0 :         if ( stem3 )</span>
<span class="lineNum">    2924 </span><span class="lineNoCov">          0 :             showexactstem3 = p-&gt;showexactstem3 = GGadgetIsChecked(GWidgetGetControl(gw,CID_ShowExactStem3));</span>
<span class="lineNum">    2925 </span><span class="lineNoCov">          0 :         if ( p-&gt;fv-&gt;b.cidmaster!=NULL ) {</span>
<span class="lineNum">    2926 </span><span class="lineNoCov">          0 :             cidmultiple = p-&gt;cidmultiple = GGadgetIsChecked(GWidgetGetControl(gw,CID_CIDMultiple));</span>
<span class="lineNum">    2927 </span><span class="lineNoCov">          0 :             cidblank = p-&gt;cidblank = GGadgetIsChecked(GWidgetGetControl(gw,CID_CIDBlank));</span>
<span class="lineNum">    2928 </span>            :         }
<span class="lineNum">    2929 </span><span class="lineNoCov">          0 :         if ( p-&gt;fv-&gt;b.sf-&gt;hasvmetrics ) {</span>
<span class="lineNum">    2930 </span><span class="lineNoCov">          0 :             vadvancewidth = p-&gt;vadvancewidth = GGadgetIsChecked(GWidgetGetControl(gw,CID_VAdvanceWidth));</span>
<span class="lineNum">    2931 </span>            :         } else
<span class="lineNum">    2932 </span><span class="lineNoCov">          0 :             p-&gt;vadvancewidth = false;</span>
<span class="lineNum">    2933 </span><span class="lineNoCov">          0 :         p-&gt;explain = true;</span>
<span class="lineNum">    2934 </span><span class="lineNoCov">          0 :         if ( doxnear )</span>
<span class="lineNum">    2935 </span><span class="lineNoCov">          0 :             p-&gt;xval = xval = GetReal8(gw,CID_XNearVal,U_(&quot;_X near¹&quot;),&amp;errs);</span>
<span class="lineNum">    2936 </span><span class="lineNoCov">          0 :         if ( doynear )</span>
<span class="lineNum">    2937 </span><span class="lineNoCov">          0 :             p-&gt;yval = yval = GetReal8(gw,CID_YNearVal,U_(&quot;_Y near¹&quot;),&amp;errs);</span>
<span class="lineNum">    2938 </span><span class="lineNoCov">          0 :         if ( hintwidth )</span>
<span class="lineNum">    2939 </span><span class="lineNoCov">          0 :             widthval = p-&gt;widthval = GetReal8(gw,CID_HintWidth,U_(&quot;Hint _Width Near¹&quot;),&amp;errs);</span>
<span class="lineNum">    2940 </span><span class="lineNoCov">          0 :         if ( p-&gt;advancewidth )</span>
<span class="lineNum">    2941 </span><span class="lineNoCov">          0 :             advancewidthval = p-&gt;advancewidthval = GetInt8(gw,CID_AdvanceWidthVal,U_(&quot;Advance Width not&quot;),&amp;errs);</span>
<span class="lineNum">    2942 </span><span class="lineNoCov">          0 :         if ( p-&gt;vadvancewidth )</span>
<span class="lineNum">    2943 </span><span class="lineNoCov">          0 :             vadvancewidthval = p-&gt;vadvancewidthval = GetInt8(gw,CID_VAdvanceWidthVal,U_(&quot;Vertical Advance not&quot;),&amp;errs);</span>
<span class="lineNum">    2944 </span><span class="lineNoCov">          0 :         if ( p-&gt;bbymax )</span>
<span class="lineNum">    2945 </span><span class="lineNoCov">          0 :             bbymax_val = p-&gt;bbymax_val = GetInt8(gw,CID_BBYMaxVal,U_(&quot;Bounding box above&quot;),&amp;errs);</span>
<span class="lineNum">    2946 </span><span class="lineNoCov">          0 :         if ( p-&gt;bbymin )</span>
<span class="lineNum">    2947 </span><span class="lineNoCov">          0 :             bbymin_val = p-&gt;bbymin_val = GetInt8(gw,CID_BBYMinVal,U_(&quot;Bounding box below&quot;),&amp;errs);</span>
<span class="lineNum">    2948 </span><span class="lineNoCov">          0 :         if ( p-&gt;bbxmax )</span>
<span class="lineNum">    2949 </span><span class="lineNoCov">          0 :             bbxmax_val = p-&gt;bbxmax_val = GetInt8(gw,CID_BBXMaxVal,U_(&quot;Bounding box right of&quot;),&amp;errs);</span>
<span class="lineNum">    2950 </span><span class="lineNoCov">          0 :         if ( p-&gt;bbxmin )</span>
<span class="lineNum">    2951 </span><span class="lineNoCov">          0 :             bbxmin_val = p-&gt;bbxmin_val = GetInt8(gw,CID_BBXMinVal,U_(&quot;Bounding box left of&quot;),&amp;errs);</span>
<span class="lineNum">    2952 </span><span class="lineNoCov">          0 :         if ( toomanypoints )</span>
<span class="lineNum">    2953 </span><span class="lineNoCov">          0 :             p-&gt;pointsmax = pointsmax = GetInt8(gw,CID_PointsMax,_(&quot;_More points than:&quot;),&amp;errs);</span>
<span class="lineNum">    2954 </span><span class="lineNoCov">          0 :         if ( toomanyhints )</span>
<span class="lineNum">    2955 </span><span class="lineNoCov">          0 :             p-&gt;hintsmax = hintsmax = GetInt8(gw,CID_HintsMax,_(&quot;_More hints than:&quot;),&amp;errs);</span>
<span class="lineNum">    2956 </span><span class="lineNoCov">          0 :         if ( toodeeprefs )</span>
<span class="lineNum">    2957 </span>            : /* GT: Refs is an abbreviation for References. Space is somewhat constrained here */
<span class="lineNum">    2958 </span><span class="lineNoCov">          0 :             p-&gt;refdepthmax = refdepthmax = GetInt8(gw,CID_RefDepthMax,_(&quot;Refs neste_d deeper than:&quot;),&amp;errs);</span>
<span class="lineNum">    2959 </span><span class="lineNoCov">          0 :         if ( irrelevantcp )</span>
<span class="lineNum">    2960 </span><span class="lineNoCov">          0 :             p-&gt;irrelevantfactor = irrelevantfactor = GetReal8(gw,CID_IrrelevantFactor,_(&quot;Irrelevant _Factor:&quot;),&amp;errs)/100.0;</span>
<span class="lineNum">    2961 </span><span class="lineNoCov">          0 :         near = p-&gt;near = GetReal8(gw,CID_Near,_(&quot;Near&quot;),&amp;errs);</span>
<span class="lineNum">    2962 </span><span class="lineNoCov">          0 :         if ( errs )</span>
<span class="lineNum">    2963 </span><span class="lineNoCov">          0 : return( true );</span>
<span class="lineNum">    2964 </span><span class="lineNoCov">          0 :         lastsf = p-&gt;fv-&gt;b.sf;</span>
<span class="lineNum">    2965 </span><span class="lineNoCov">          0 :         if ( doynearstd )</span>
<span class="lineNum">    2966 </span><span class="lineNoCov">          0 :             FigureStandardHeights(p);</span>
<span class="lineNum">    2967 </span><span class="lineNoCov">          0 :         GDrawSetVisible(gw,false);</span>
<span class="lineNum">    2968 </span><span class="lineNoCov">          0 :         if ( openpaths || intersectingpaths || pointstooclose  || doxnear || doynear ||</span>
<span class="lineNum">    2969 </span><span class="lineNoCov">          0 :                 doynearstd || linestd || hintnopt || ptnearhint || hintwidth ||</span>
<span class="lineNum">    2970 </span><span class="lineNoCov">          0 :                 direction || p-&gt;cidmultiple || p-&gt;cidblank || p-&gt;flippedrefs ||</span>
<span class="lineNum">    2971 </span><span class="lineNoCov">          0 :                 p-&gt;bitmaps || p-&gt;advancewidth || p-&gt;vadvancewidth || p-&gt;stem3 ||</span>
<span class="lineNum">    2972 </span><span class="lineNoCov">          0 :                 p-&gt;bitmapwidths || p-&gt;missinganchor ||</span>
<span class="lineNum">    2973 </span><span class="lineNoCov">          0 :                 p-&gt;irrelevantcontrolpoints || p-&gt;badsubs || p-&gt;missingglyph ||</span>
<span class="lineNum">    2974 </span><span class="lineNoCov">          0 :                 p-&gt;missingscriptinfeature || nonintegral || pointstoofar ||</span>
<span class="lineNum">    2975 </span><span class="lineNoCov">          0 :                 p-&gt;toomanypoints || p-&gt;toomanyhints || p-&gt;missingextrema ||</span>
<span class="lineNum">    2976 </span><span class="lineNoCov">          0 :                 p-&gt;toodeeprefs || multuni || multname || uninamemismatch ||</span>
<span class="lineNum">    2977 </span><span class="lineNoCov">          0 :                 p-&gt;ptmatchrefsoutofdate || p-&gt;refsbadtransformttf ||</span>
<span class="lineNum">    2978 </span><span class="lineNoCov">          0 :                 p-&gt;multusemymetrics || p-&gt;overlappedhints ||</span>
<span class="lineNum">    2979 </span><span class="lineNoCov">          0 :                 p-&gt;mixedcontoursrefs || p-&gt;refsbadtransformps ||</span>
<span class="lineNum">    2980 </span><span class="lineNoCov">          0 :                 p-&gt;bbymax || p-&gt;bbxmax || p-&gt;bbymin || p-&gt;bbxmin ) {</span>
<span class="lineNum">    2981 </span><span class="lineNoCov">          0 :             DoProbs(p);</span>
<span class="lineNum">    2982 </span>            :         }
<span class="lineNum">    2983 </span><span class="lineNoCov">          0 :         p-&gt;done = true;</span>
<span class="lineNum">    2984 </span>            :     }
<span class="lineNum">    2985 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="2986"><span class="lineNum">    2986 </span>            : }</a>
<span class="lineNum">    2987 </span>            : 
<span class="lineNum">    2988 </span><span class="lineNoCov">          0 : static void DummyFindProblems(CharView *cv) {</span>
<span class="lineNum">    2989 </span>            :     struct problems p;
<span class="lineNum">    2990 </span>            : 
<span class="lineNum">    2991 </span><span class="lineNoCov">          0 :     memset(&amp;p,0,sizeof(p));</span>
<span class="lineNum">    2992 </span><span class="lineNoCov">          0 :     p.fv = (FontView *) (cv-&gt;b.fv);</span>
<span class="lineNum">    2993 </span><span class="lineNoCov">          0 :     p.cv=cv;</span>
<span class="lineNum">    2994 </span><span class="lineNoCov">          0 :     p.layer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    2995 </span><span class="lineNoCov">          0 :     p.map = cv-&gt;b.fv-&gt;map;</span>
<span class="lineNum">    2996 </span><span class="lineNoCov">          0 :     p.lastcharopened = cv-&gt;b.sc;</span>
<span class="lineNum">    2997 </span>            : 
<span class="lineNum">    2998 </span><span class="lineNoCov">          0 :     p.openpaths = true;</span>
<span class="lineNum">    2999 </span><span class="lineNoCov">          0 :     p.intersectingpaths = true;</span>
<span class="lineNum">    3000 </span><span class="lineNoCov">          0 :     p.direction = true;</span>
<span class="lineNum">    3001 </span><span class="lineNoCov">          0 :     p.flippedrefs = true;</span>
<span class="lineNum">    3002 </span><span class="lineNoCov">          0 :     p.missingextrema = true;</span>
<span class="lineNum">    3003 </span><span class="lineNoCov">          0 :     p.toomanypoints = true;</span>
<span class="lineNum">    3004 </span><span class="lineNoCov">          0 :     p.toomanyhints = true;</span>
<span class="lineNum">    3005 </span><span class="lineNoCov">          0 :     p.pointstoofar = true;</span>
<span class="lineNum">    3006 </span><span class="lineNoCov">          0 :     p.nonintegral = true;</span>
<span class="lineNum">    3007 </span><span class="lineNoCov">          0 :     p.missinganchor = true;</span>
<span class="lineNum">    3008 </span><span class="lineNoCov">          0 :     p.overlappedhints = true;</span>
<span class="lineNum">    3009 </span>            : 
<span class="lineNum">    3010 </span><span class="lineNoCov">          0 :     p.pointsmax = 1500;</span>
<span class="lineNum">    3011 </span><span class="lineNoCov">          0 :     p.hintsmax = 96;</span>
<span class="lineNum">    3012 </span>            : 
<span class="lineNum">    3013 </span><span class="lineNoCov">          0 :     p.explain = true;</span>
<span class="lineNum">    3014 </span>            :     
<span class="lineNum">    3015 </span><span class="lineNoCov">          0 :     DoProbs(&amp;p);</span>
<span class="lineNum">    3016 </span><span class="lineNoCov">          0 :     if ( p.explainw!=NULL )</span>
<span class="lineNum">    3017 </span><span class="lineNoCov">          0 :         GDrawDestroyWindow(p.explainw);</span>
<a name="3018"><span class="lineNum">    3018 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3019 </span>            : 
<span class="lineNum">    3020 </span><span class="lineNoCov">          0 : static int Prob_Cancel(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    3021 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    3022 </span><span class="lineNoCov">          0 :         struct problems *p = GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    3023 </span><span class="lineNoCov">          0 :         p-&gt;done = true;</span>
<span class="lineNum">    3024 </span>            :     }
<span class="lineNum">    3025 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="3026"><span class="lineNum">    3026 </span>            : }</a>
<span class="lineNum">    3027 </span>            : 
<span class="lineNum">    3028 </span><span class="lineNoCov">          0 : static int Prob_TextChanged(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    3029 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_textchanged ) {</span>
<span class="lineNum">    3030 </span><span class="lineNoCov">          0 :         GGadgetSetChecked(GWidgetGetControl(GGadgetGetWindow(g),(intpt) GGadgetGetUserData(g)),true);</span>
<span class="lineNum">    3031 </span>            :     }
<span class="lineNum">    3032 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="3033"><span class="lineNum">    3033 </span>            : }</a>
<span class="lineNum">    3034 </span>            : 
<span class="lineNum">    3035 </span><span class="lineNoCov">          0 : static int Prob_EnableExact(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    3036 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_radiochanged ) {</span>
<span class="lineNum">    3037 </span><span class="lineNoCov">          0 :         GGadgetSetEnabled(GWidgetGetControl(GGadgetGetWindow(g),CID_ShowExactStem3),</span>
<span class="lineNum">    3038 </span>            :                 GGadgetIsChecked(g));
<span class="lineNum">    3039 </span>            :     }
<span class="lineNum">    3040 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="3041"><span class="lineNum">    3041 </span>            : }</a>
<span class="lineNum">    3042 </span>            : 
<span class="lineNum">    3043 </span><span class="lineNoCov">          0 : static int e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    3044 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">    3045 </span><span class="lineNoCov">          0 :         struct problems *p = GDrawGetUserData(gw);</span>
<span class="lineNum">    3046 </span><span class="lineNoCov">          0 :         p-&gt;done = true;</span>
<span class="lineNum">    3047 </span>            :     }
<span class="lineNum">    3048 </span><span class="lineNoCov">          0 : return( event-&gt;type!=et_char );</span>
<a name="3049"><span class="lineNum">    3049 </span>            : }</a>
<span class="lineNum">    3050 </span>            : 
<span class="lineNum">    3051 </span><span class="lineNoCov">          0 : void FindProblems(FontView *fv,CharView *cv, SplineChar *sc) {</span>
<span class="lineNum">    3052 </span>            :     GRect pos;
<span class="lineNum">    3053 </span>            :     GWindow gw;
<span class="lineNum">    3054 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    3055 </span>            :     GGadgetCreateData pgcd[15], pagcd[8], hgcd[10], rgcd[10], cgcd[5], mgcd[11], agcd[7], rfgcd[9];
<span class="lineNum">    3056 </span>            :     GGadgetCreateData bbgcd[14];
<span class="lineNum">    3057 </span>            :     GGadgetCreateData pboxes[6], paboxes[4], rfboxes[4], hboxes[5], aboxes[2],
<span class="lineNum">    3058 </span>            :             cboxes[2], bbboxes[2], rboxes[2], mboxes[5];
<span class="lineNum">    3059 </span>            :     GGadgetCreateData *parray[12], *pharray1[4], *pharray2[4], *pharray3[7],
<span class="lineNum">    3060 </span>            :             *paarray[8], *paharray[4], *rfarray[9], *rfharray[4],
<span class="lineNum">    3061 </span>            :             *harray[9], *hharray1[4], *hharray2[4], *hharray3[4], *aarray[6],
<span class="lineNum">    3062 </span>            :             *carray[5], *bbarray[8][4], *rarray[7], *marray[7][2],
<span class="lineNum">    3063 </span>            :             *mharray1[4], *mharray2[5], *barray[10];
<span class="lineNum">    3064 </span>            :     GTextInfo plabel[15], palabel[8], hlabel[9], rlabel[10], clabel[5], mlabel[10], alabel[7], rflabel[9];
<span class="lineNum">    3065 </span>            :     GTextInfo bblabel[14];
<span class="lineNum">    3066 </span>            :     GTabInfo aspects[9];
<span class="lineNum">    3067 </span>            :     struct problems p;
<span class="lineNum">    3068 </span>            :     char xnbuf[20], ynbuf[20], widthbuf[20], nearbuf[20], awidthbuf[20],
<span class="lineNum">    3069 </span>            :             vawidthbuf[20], irrel[20], pmax[20], hmax[20], rmax[20],
<span class="lineNum">    3070 </span>            :             xxmaxbuf[20], xxminbuf[20], yymaxbuf[20], yyminbuf[20];
<span class="lineNum">    3071 </span>            :     SplineChar *ssc;
<span class="lineNum">    3072 </span>            :     int i;
<span class="lineNum">    3073 </span>            :     SplineFont *sf;
<span class="lineNum">    3074 </span>            :     /*static GBox smallbox = { bt_raised, bs_rect, 2, 1, 0, 0, 0, 0, 0, 0, COLOR_DEFAULT, COLOR_DEFAULT, 0, 0, 0, 0, 0, 0, 0 };*/
<span class="lineNum">    3075 </span>            : 
<span class="lineNum">    3076 </span><span class="lineNoCov">          0 :     memset(&amp;p,0,sizeof(p));</span>
<span class="lineNum">    3077 </span><span class="lineNoCov">          0 :     if ( fv==NULL ) fv = (FontView *) (cv-&gt;b.fv);</span>
<span class="lineNum">    3078 </span><span class="lineNoCov">          0 :     p.fv = fv; p.cv=cv; p.msc = sc;</span>
<span class="lineNum">    3079 </span><span class="lineNoCov">          0 :     if ( cv!=NULL )</span>
<span class="lineNum">    3080 </span><span class="lineNoCov">          0 :         p.lastcharopened = cv-&gt;b.sc;</span>
<span class="lineNum">    3081 </span><span class="lineNoCov">          0 :     if ( fv!=NULL ) {</span>
<span class="lineNum">    3082 </span><span class="lineNoCov">          0 :         p.map = fv-&gt;b.map;</span>
<span class="lineNum">    3083 </span><span class="lineNoCov">          0 :         p.layer = fv-&gt;b.active_layer;</span>
<span class="lineNum">    3084 </span><span class="lineNoCov">          0 :     } else if ( cv!=NULL ) {</span>
<span class="lineNum">    3085 </span><span class="lineNoCov">          0 :         p.map = cv-&gt;b.fv-&gt;map;</span>
<span class="lineNum">    3086 </span><span class="lineNoCov">          0 :         p.layer = CVLayer((CharViewBase *) cv);</span>
<span class="lineNum">    3087 </span>            :     } else {
<span class="lineNum">    3088 </span><span class="lineNoCov">          0 :         p.map = sc-&gt;parent-&gt;fv-&gt;map;</span>
<span class="lineNum">    3089 </span><span class="lineNoCov">          0 :         p.layer = sc-&gt;parent-&gt;fv-&gt;active_layer;</span>
<span class="lineNum">    3090 </span>            :     }
<span class="lineNum">    3091 </span>            : 
<span class="lineNum">    3092 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    3093 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_restrict|wam_isdlg;</span>
<span class="lineNum">    3094 </span><span class="lineNoCov">          0 :     wattrs.event_masks = ~(1&lt;&lt;et_charup);</span>
<span class="lineNum">    3095 </span><span class="lineNoCov">          0 :     wattrs.restrict_input_to_me = 1;</span>
<span class="lineNum">    3096 </span><span class="lineNoCov">          0 :     wattrs.undercursor = 1;</span>
<span class="lineNum">    3097 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_pointer;</span>
<span class="lineNum">    3098 </span><span class="lineNoCov">          0 :     wattrs.utf8_window_title = _(&quot;Find Problems&quot;);</span>
<span class="lineNum">    3099 </span><span class="lineNoCov">          0 :     pos.x = pos.y = 0;</span>
<span class="lineNum">    3100 </span><span class="lineNoCov">          0 :     pos.width = GGadgetScale(GDrawPointsToPixels(NULL,218));</span>
<span class="lineNum">    3101 </span><span class="lineNoCov">          0 :     pos.height = GDrawPointsToPixels(NULL,294);</span>
<span class="lineNum">    3102 </span><span class="lineNoCov">          0 :     gw = GDrawCreateTopWindow(NULL,&amp;pos,e_h,&amp;p,&amp;wattrs);</span>
<span class="lineNum">    3103 </span>            : 
<span class="lineNum">    3104 </span><span class="lineNoCov">          0 :     memset(&amp;plabel,0,sizeof(plabel));</span>
<span class="lineNum">    3105 </span><span class="lineNoCov">          0 :     memset(&amp;pgcd,0,sizeof(pgcd));</span>
<span class="lineNum">    3106 </span><span class="lineNoCov">          0 :     memset(&amp;pboxes,0,sizeof(pboxes));</span>
<span class="lineNum">    3107 </span>            : 
<span class="lineNum">    3108 </span><span class="lineNoCov">          0 :     plabel[0].text = (unichar_t *) _(&quot;Non-_Integral coordinates&quot;);</span>
<span class="lineNum">    3109 </span><span class="lineNoCov">          0 :     plabel[0].text_is_1byte = true;</span>
<span class="lineNum">    3110 </span><span class="lineNoCov">          0 :     plabel[0].text_in_resource = true;</span>
<span class="lineNum">    3111 </span><span class="lineNoCov">          0 :     pgcd[0].gd.label = &amp;plabel[0];</span>
<span class="lineNum">    3112 </span><span class="lineNoCov">          0 :     pgcd[0].gd.pos.x = 3; pgcd[0].gd.pos.y = 5; </span>
<span class="lineNum">    3113 </span><span class="lineNoCov">          0 :     pgcd[0].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3114 </span><span class="lineNoCov">          0 :     if ( nonintegral ) pgcd[0].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3115 </span><span class="lineNoCov">          0 :     pgcd[0].gd.popup_msg = (unichar_t *) _(</span>
<span class="lineNum">    3116 </span>            :             &quot;The coordinates of all points and control points in truetype\n&quot;
<span class="lineNum">    3117 </span>            :             &quot;must be integers (if they are not integers then FontForge will\n&quot;
<span class="lineNum">    3118 </span>            :             &quot;round them when it outputs them, potentially causing havoc).\n&quot;
<span class="lineNum">    3119 </span>            :             &quot;Even in PostScript fonts it is generally a good idea to use\n&quot;
<span class="lineNum">    3120 </span>            :             &quot;integral values.&quot;);
<span class="lineNum">    3121 </span><span class="lineNoCov">          0 :     pgcd[0].gd.cid = CID_NonIntegral;</span>
<span class="lineNum">    3122 </span><span class="lineNoCov">          0 :     pgcd[0].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3123 </span><span class="lineNoCov">          0 :     parray[0] = &amp;pgcd[0];</span>
<span class="lineNum">    3124 </span>            : 
<span class="lineNum">    3125 </span><span class="lineNoCov">          0 :     plabel[1].text = (unichar_t *) U_(&quot;_X near¹&quot;);</span>
<span class="lineNum">    3126 </span><span class="lineNoCov">          0 :     plabel[1].text_is_1byte = true;</span>
<span class="lineNum">    3127 </span><span class="lineNoCov">          0 :     plabel[1].text_in_resource = true;</span>
<span class="lineNum">    3128 </span><span class="lineNoCov">          0 :     pgcd[1].gd.label = &amp;plabel[1];</span>
<span class="lineNum">    3129 </span><span class="lineNoCov">          0 :     pgcd[1].gd.mnemonic = 'X';</span>
<span class="lineNum">    3130 </span><span class="lineNoCov">          0 :     pgcd[1].gd.pos.x = 3; pgcd[1].gd.pos.y = pgcd[0].gd.pos.y+17; </span>
<span class="lineNum">    3131 </span><span class="lineNoCov">          0 :     pgcd[1].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3132 </span><span class="lineNoCov">          0 :     if ( doxnear ) pgcd[1].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3133 </span><span class="lineNoCov">          0 :     pgcd[1].gd.popup_msg = (unichar_t *) _(&quot;Allows you to check that vertical stems in several\ncharacters start at the same location.&quot;);</span>
<span class="lineNum">    3134 </span><span class="lineNoCov">          0 :     pgcd[1].gd.cid = CID_XNear;</span>
<span class="lineNum">    3135 </span><span class="lineNoCov">          0 :     pgcd[1].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3136 </span><span class="lineNoCov">          0 :     pharray1[0] = &amp;pgcd[1];</span>
<span class="lineNum">    3137 </span>            : 
<span class="lineNum">    3138 </span><span class="lineNoCov">          0 :     sprintf(xnbuf,&quot;%g&quot;,xval);</span>
<span class="lineNum">    3139 </span><span class="lineNoCov">          0 :     plabel[2].text = (unichar_t *) xnbuf;</span>
<span class="lineNum">    3140 </span><span class="lineNoCov">          0 :     plabel[2].text_is_1byte = true;</span>
<span class="lineNum">    3141 </span><span class="lineNoCov">          0 :     pgcd[2].gd.label = &amp;plabel[2];</span>
<span class="lineNum">    3142 </span><span class="lineNoCov">          0 :     pgcd[2].gd.pos.x = 60; pgcd[2].gd.pos.y = pgcd[1].gd.pos.y-5; pgcd[2].gd.pos.width = 40;</span>
<span class="lineNum">    3143 </span><span class="lineNoCov">          0 :     pgcd[2].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    3144 </span><span class="lineNoCov">          0 :     pgcd[2].gd.cid = CID_XNearVal;</span>
<span class="lineNum">    3145 </span><span class="lineNoCov">          0 :     pgcd[2].gd.handle_controlevent = Prob_TextChanged;</span>
<span class="lineNum">    3146 </span><span class="lineNoCov">          0 :     pgcd[2].data = (void *) CID_XNear;</span>
<span class="lineNum">    3147 </span><span class="lineNoCov">          0 :     pgcd[2].creator = GTextFieldCreate;</span>
<span class="lineNum">    3148 </span><span class="lineNoCov">          0 :     pharray1[1] = &amp;pgcd[2]; pharray1[2] = GCD_Glue; pharray1[3] = NULL;</span>
<span class="lineNum">    3149 </span>            : 
<span class="lineNum">    3150 </span><span class="lineNoCov">          0 :     pboxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3151 </span><span class="lineNoCov">          0 :     pboxes[2].gd.u.boxelements = pharray1;</span>
<span class="lineNum">    3152 </span><span class="lineNoCov">          0 :     pboxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">    3153 </span><span class="lineNoCov">          0 :     parray[1] = &amp;pboxes[2];</span>
<span class="lineNum">    3154 </span>            : 
<span class="lineNum">    3155 </span><span class="lineNoCov">          0 :     plabel[3].text = (unichar_t *) U_(&quot;_Y near¹&quot;);</span>
<span class="lineNum">    3156 </span><span class="lineNoCov">          0 :     plabel[3].text_is_1byte = true;</span>
<span class="lineNum">    3157 </span><span class="lineNoCov">          0 :     plabel[3].text_in_resource = true;</span>
<span class="lineNum">    3158 </span><span class="lineNoCov">          0 :     pgcd[3].gd.label = &amp;plabel[3];</span>
<span class="lineNum">    3159 </span><span class="lineNoCov">          0 :     pgcd[3].gd.mnemonic = 'Y';</span>
<span class="lineNum">    3160 </span><span class="lineNoCov">          0 :     pgcd[3].gd.pos.x = 3; pgcd[3].gd.pos.y = pgcd[1].gd.pos.y+24; </span>
<span class="lineNum">    3161 </span><span class="lineNoCov">          0 :     pgcd[3].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3162 </span><span class="lineNoCov">          0 :     if ( doynear ) pgcd[3].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3163 </span><span class="lineNoCov">          0 :     pgcd[3].gd.popup_msg = (unichar_t *) _(&quot;Allows you to check that horizontal stems in several\ncharacters start at the same location.&quot;);</span>
<span class="lineNum">    3164 </span><span class="lineNoCov">          0 :     pgcd[3].gd.cid = CID_YNear;</span>
<span class="lineNum">    3165 </span><span class="lineNoCov">          0 :     pgcd[3].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3166 </span><span class="lineNoCov">          0 :     pharray2[0] = &amp;pgcd[3];</span>
<span class="lineNum">    3167 </span>            : 
<span class="lineNum">    3168 </span><span class="lineNoCov">          0 :     sprintf(ynbuf,&quot;%g&quot;,yval);</span>
<span class="lineNum">    3169 </span><span class="lineNoCov">          0 :     plabel[4].text = (unichar_t *) ynbuf;</span>
<span class="lineNum">    3170 </span><span class="lineNoCov">          0 :     plabel[4].text_is_1byte = true;</span>
<span class="lineNum">    3171 </span><span class="lineNoCov">          0 :     pgcd[4].gd.label = &amp;plabel[4];</span>
<span class="lineNum">    3172 </span><span class="lineNoCov">          0 :     pgcd[4].gd.pos.x = 60; pgcd[4].gd.pos.y = pgcd[3].gd.pos.y-5; pgcd[4].gd.pos.width = 40;</span>
<span class="lineNum">    3173 </span><span class="lineNoCov">          0 :     pgcd[4].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    3174 </span><span class="lineNoCov">          0 :     pgcd[4].gd.cid = CID_YNearVal;</span>
<span class="lineNum">    3175 </span><span class="lineNoCov">          0 :     pgcd[4].gd.handle_controlevent = Prob_TextChanged;</span>
<span class="lineNum">    3176 </span><span class="lineNoCov">          0 :     pgcd[4].data = (void *) CID_YNear;</span>
<span class="lineNum">    3177 </span><span class="lineNoCov">          0 :     pgcd[4].creator = GTextFieldCreate;</span>
<span class="lineNum">    3178 </span><span class="lineNoCov">          0 :     pharray2[1] = &amp;pgcd[4]; pharray2[2] = GCD_Glue; pharray2[3] = NULL;</span>
<span class="lineNum">    3179 </span>            : 
<span class="lineNum">    3180 </span><span class="lineNoCov">          0 :     pboxes[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3181 </span><span class="lineNoCov">          0 :     pboxes[3].gd.u.boxelements = pharray2;</span>
<span class="lineNum">    3182 </span><span class="lineNoCov">          0 :     pboxes[3].creator = GHBoxCreate;</span>
<span class="lineNum">    3183 </span><span class="lineNoCov">          0 :     parray[2] = &amp;pboxes[3];</span>
<span class="lineNum">    3184 </span>            : 
<span class="lineNum">    3185 </span><span class="lineNoCov">          0 :     plabel[5].text = (unichar_t *) U_(&quot;Y near¹ _standard heights&quot;);</span>
<span class="lineNum">    3186 </span><span class="lineNoCov">          0 :     plabel[5].text_is_1byte = true;</span>
<span class="lineNum">    3187 </span><span class="lineNoCov">          0 :     plabel[5].text_in_resource = true;</span>
<span class="lineNum">    3188 </span><span class="lineNoCov">          0 :     pgcd[5].gd.label = &amp;plabel[5];</span>
<span class="lineNum">    3189 </span><span class="lineNoCov">          0 :     pgcd[5].gd.mnemonic = 'S';</span>
<span class="lineNum">    3190 </span><span class="lineNoCov">          0 :     pgcd[5].gd.pos.x = 3; pgcd[5].gd.pos.y = pgcd[3].gd.pos.y+18; </span>
<span class="lineNum">    3191 </span><span class="lineNoCov">          0 :     pgcd[5].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3192 </span><span class="lineNoCov">          0 :     if ( doynearstd ) pgcd[5].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3193 </span><span class="lineNoCov">          0 :     pgcd[5].gd.popup_msg = (unichar_t *) _(&quot;Allows you to find points which are slightly\noff from the baseline, xheight, cap height,\nascender, descender heights.&quot;);</span>
<span class="lineNum">    3194 </span><span class="lineNoCov">          0 :     pgcd[5].gd.cid = CID_YNearStd;</span>
<span class="lineNum">    3195 </span><span class="lineNoCov">          0 :     pgcd[5].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3196 </span><span class="lineNoCov">          0 :     parray[3] = &amp;pgcd[5];</span>
<span class="lineNum">    3197 </span>            : 
<span class="lineNum">    3198 </span><span class="lineNoCov">          0 :     plabel[6].text = (unichar_t *) (fv-&gt;b.sf-&gt;italicangle==0?_(&quot;_Control Points near horizontal/vertical&quot;):_(&quot;Control Points near horizontal/vertical/italic&quot;));</span>
<span class="lineNum">    3199 </span><span class="lineNoCov">          0 :     plabel[6].text_is_1byte = true;</span>
<span class="lineNum">    3200 </span><span class="lineNoCov">          0 :     plabel[6].text_in_resource = true;</span>
<span class="lineNum">    3201 </span><span class="lineNoCov">          0 :     pgcd[6].gd.label = &amp;plabel[6];</span>
<span class="lineNum">    3202 </span><span class="lineNoCov">          0 :     pgcd[6].gd.mnemonic = 'C';</span>
<span class="lineNum">    3203 </span><span class="lineNoCov">          0 :     pgcd[6].gd.pos.x = 3; pgcd[6].gd.pos.y = pgcd[5].gd.pos.y+14; </span>
<span class="lineNum">    3204 </span><span class="lineNoCov">          0 :     pgcd[6].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3205 </span><span class="lineNoCov">          0 :     if ( cpstd ) pgcd[6].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3206 </span><span class="lineNoCov">          0 :     pgcd[6].gd.popup_msg = (unichar_t *) _(&quot;Allows you to find control points which are almost,\nbut not quite horizontal or vertical\nfrom their base point\n(or at the italic angle).&quot;);</span>
<span class="lineNum">    3207 </span><span class="lineNoCov">          0 :     pgcd[6].gd.cid = CID_CpStd;</span>
<span class="lineNum">    3208 </span><span class="lineNoCov">          0 :     pgcd[6].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3209 </span><span class="lineNoCov">          0 :     parray[4] = &amp;pgcd[6];</span>
<span class="lineNum">    3210 </span>            : 
<span class="lineNum">    3211 </span><span class="lineNoCov">          0 :     plabel[7].text = (unichar_t *) _(&quot;Control Points _beyond spline&quot;);</span>
<span class="lineNum">    3212 </span><span class="lineNoCov">          0 :     plabel[7].text_is_1byte = true;</span>
<span class="lineNum">    3213 </span><span class="lineNoCov">          0 :     plabel[7].text_in_resource = true;</span>
<span class="lineNum">    3214 </span><span class="lineNoCov">          0 :     pgcd[7].gd.label = &amp;plabel[7];</span>
<span class="lineNum">    3215 </span><span class="lineNoCov">          0 :     pgcd[7].gd.mnemonic = 'b';</span>
<span class="lineNum">    3216 </span><span class="lineNoCov">          0 :     pgcd[7].gd.pos.x = 3; pgcd[7].gd.pos.y = pgcd[6].gd.pos.y+14; </span>
<span class="lineNum">    3217 </span><span class="lineNoCov">          0 :     pgcd[7].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3218 </span><span class="lineNoCov">          0 :     if ( cpodd ) pgcd[7].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3219 </span><span class="lineNoCov">          0 :     pgcd[7].gd.popup_msg = (unichar_t *) _(&quot;Allows you to find control points which when projected\nonto the line segment between the two end points lie\noutside of those end points&quot;);</span>
<span class="lineNum">    3220 </span><span class="lineNoCov">          0 :     pgcd[7].gd.cid = CID_CpOdd;</span>
<span class="lineNum">    3221 </span><span class="lineNoCov">          0 :     pgcd[7].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3222 </span><span class="lineNoCov">          0 :     parray[5] = &amp;pgcd[7];</span>
<span class="lineNum">    3223 </span>            : 
<span class="lineNum">    3224 </span><span class="lineNoCov">          0 :     plabel[8].text = (unichar_t *) _(&quot;Check for _irrelevant control points&quot;);</span>
<span class="lineNum">    3225 </span><span class="lineNoCov">          0 :     plabel[8].text_is_1byte = true;</span>
<span class="lineNum">    3226 </span><span class="lineNoCov">          0 :     plabel[8].text_in_resource = true;</span>
<span class="lineNum">    3227 </span><span class="lineNoCov">          0 :     pgcd[8].gd.label = &amp;plabel[8];</span>
<span class="lineNum">    3228 </span><span class="lineNoCov">          0 :     pgcd[8].gd.pos.x = 3; pgcd[8].gd.pos.y = pgcd[7].gd.pos.y+14; </span>
<span class="lineNum">    3229 </span><span class="lineNoCov">          0 :     pgcd[8].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3230 </span><span class="lineNoCov">          0 :     if ( irrelevantcp ) pgcd[8].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3231 </span><span class="lineNoCov">          0 :     pgcd[8].gd.popup_msg = (unichar_t *) _(&quot;Control points are irrelevant if they are too close to the main\npoint to make a significant difference in the shape of the curve.&quot;);</span>
<span class="lineNum">    3232 </span><span class="lineNoCov">          0 :     pgcd[8].gd.cid = CID_IrrelevantCP;</span>
<span class="lineNum">    3233 </span><span class="lineNoCov">          0 :     pgcd[8].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3234 </span><span class="lineNoCov">          0 :     parray[6] = &amp;pgcd[8];</span>
<span class="lineNum">    3235 </span>            : 
<span class="lineNum">    3236 </span><span class="lineNoCov">          0 :     plabel[9].text = (unichar_t *) _(&quot;Irrelevant _Factor:&quot;);</span>
<span class="lineNum">    3237 </span><span class="lineNoCov">          0 :     plabel[9].text_is_1byte = true;</span>
<span class="lineNum">    3238 </span><span class="lineNoCov">          0 :     plabel[9].text_in_resource = true;</span>
<span class="lineNum">    3239 </span><span class="lineNoCov">          0 :     pgcd[9].gd.label = &amp;plabel[9];</span>
<span class="lineNum">    3240 </span><span class="lineNoCov">          0 :     pgcd[9].gd.pos.x = 20; pgcd[9].gd.pos.y = pgcd[8].gd.pos.y+17; </span>
<span class="lineNum">    3241 </span><span class="lineNoCov">          0 :     pgcd[9].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3242 </span><span class="lineNoCov">          0 :     pgcd[9].gd.popup_msg = (unichar_t *) _(&quot;A control point is deemed irrelevant if the distance between it and the main\n(end) point is less than this times the distance between the two end points&quot;);</span>
<span class="lineNum">    3243 </span><span class="lineNoCov">          0 :     pgcd[9].creator = GLabelCreate;</span>
<span class="lineNum">    3244 </span><span class="lineNoCov">          0 :     pharray3[0] = GCD_HPad10; pharray3[1] = &amp;pgcd[9];</span>
<span class="lineNum">    3245 </span>            : 
<span class="lineNum">    3246 </span><span class="lineNoCov">          0 :     sprintf( irrel, &quot;%g&quot;, irrelevantfactor*100 );</span>
<span class="lineNum">    3247 </span><span class="lineNoCov">          0 :     plabel[10].text = (unichar_t *) irrel;</span>
<span class="lineNum">    3248 </span><span class="lineNoCov">          0 :     plabel[10].text_is_1byte = true;</span>
<span class="lineNum">    3249 </span><span class="lineNoCov">          0 :     pgcd[10].gd.label = &amp;plabel[10];</span>
<span class="lineNum">    3250 </span><span class="lineNoCov">          0 :     pgcd[10].gd.pos.x = 105; pgcd[10].gd.pos.y = pgcd[9].gd.pos.y-3;</span>
<span class="lineNum">    3251 </span><span class="lineNoCov">          0 :     pgcd[10].gd.pos.width = 50; </span>
<span class="lineNum">    3252 </span><span class="lineNoCov">          0 :     pgcd[10].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3253 </span><span class="lineNoCov">          0 :     pgcd[10].gd.popup_msg = (unichar_t *) _(&quot;A control point is deemed irrelevant if the distance between it and the main\n(end) point is less than this times the distance between the two end points&quot;);</span>
<span class="lineNum">    3254 </span><span class="lineNoCov">          0 :     pgcd[10].gd.cid = CID_IrrelevantFactor;</span>
<span class="lineNum">    3255 </span><span class="lineNoCov">          0 :     pgcd[10].creator = GTextFieldCreate;</span>
<span class="lineNum">    3256 </span><span class="lineNoCov">          0 :     pharray3[2] = &amp;pgcd[10];</span>
<span class="lineNum">    3257 </span>            : 
<span class="lineNum">    3258 </span><span class="lineNoCov">          0 :     plabel[11].text = (unichar_t *) &quot;%&quot;;</span>
<span class="lineNum">    3259 </span><span class="lineNoCov">          0 :     plabel[11].text_is_1byte = true;</span>
<span class="lineNum">    3260 </span><span class="lineNoCov">          0 :     pgcd[11].gd.label = &amp;plabel[11];</span>
<span class="lineNum">    3261 </span><span class="lineNoCov">          0 :     pgcd[11].gd.pos.x = 163; pgcd[11].gd.pos.y = pgcd[9].gd.pos.y; </span>
<span class="lineNum">    3262 </span><span class="lineNoCov">          0 :     pgcd[11].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3263 </span><span class="lineNoCov">          0 :     pgcd[11].gd.popup_msg = (unichar_t *) _(&quot;A control point is deemed irrelevant if the distance between it and the main\n(end) point is less than this times the distance between the two end points&quot;);</span>
<span class="lineNum">    3264 </span><span class="lineNoCov">          0 :     pgcd[11].creator = GLabelCreate;</span>
<span class="lineNum">    3265 </span><span class="lineNoCov">          0 :     pharray3[3] = &amp;pgcd[11]; pharray3[4] = GCD_Glue; pharray3[5] = NULL;</span>
<span class="lineNum">    3266 </span>            : 
<span class="lineNum">    3267 </span><span class="lineNoCov">          0 :     pboxes[4].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3268 </span><span class="lineNoCov">          0 :     pboxes[4].gd.u.boxelements = pharray3;</span>
<span class="lineNum">    3269 </span><span class="lineNoCov">          0 :     pboxes[4].creator = GHBoxCreate;</span>
<span class="lineNum">    3270 </span><span class="lineNoCov">          0 :     parray[7] = &amp;pboxes[4];</span>
<span class="lineNum">    3271 </span>            : 
<span class="lineNum">    3272 </span><span class="lineNoCov">          0 :     plabel[12].text = (unichar_t *) _(&quot;Poin_ts too close&quot;);</span>
<span class="lineNum">    3273 </span><span class="lineNoCov">          0 :     plabel[12].text_is_1byte = true;</span>
<span class="lineNum">    3274 </span><span class="lineNoCov">          0 :     plabel[12].text_in_resource = true;</span>
<span class="lineNum">    3275 </span><span class="lineNoCov">          0 :     pgcd[12].gd.label = &amp;plabel[12];</span>
<span class="lineNum">    3276 </span><span class="lineNoCov">          0 :     pgcd[12].gd.pos.x = 3; pgcd[12].gd.pos.y = pgcd[11].gd.pos.y+14; </span>
<span class="lineNum">    3277 </span><span class="lineNoCov">          0 :     pgcd[12].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3278 </span><span class="lineNoCov">          0 :     if ( pointstooclose ) pgcd[12].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3279 </span><span class="lineNoCov">          0 :     pgcd[12].gd.popup_msg = (unichar_t *) _(&quot;If two adjacent points on the same path are less than a few\nemunits apart they will cause problems for some of FontForge's\ncommands. PostScript shouldn't care though.&quot;);</span>
<span class="lineNum">    3280 </span><span class="lineNoCov">          0 :     pgcd[12].gd.cid = CID_PointsTooClose;</span>
<span class="lineNum">    3281 </span><span class="lineNoCov">          0 :     pgcd[12].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3282 </span><span class="lineNoCov">          0 :     parray[8] = &amp;pgcd[12];</span>
<span class="lineNum">    3283 </span>            : 
<span class="lineNum">    3284 </span><span class="lineNoCov">          0 :     plabel[13].text = (unichar_t *) _(&quot;_Points too far&quot;);</span>
<span class="lineNum">    3285 </span><span class="lineNoCov">          0 :     plabel[13].text_is_1byte = true;</span>
<span class="lineNum">    3286 </span><span class="lineNoCov">          0 :     plabel[13].text_in_resource = true;</span>
<span class="lineNum">    3287 </span><span class="lineNoCov">          0 :     pgcd[13].gd.label = &amp;plabel[13];</span>
<span class="lineNum">    3288 </span><span class="lineNoCov">          0 :     pgcd[13].gd.pos.x = 3; pgcd[13].gd.pos.y = pgcd[12].gd.pos.y+14; </span>
<span class="lineNum">    3289 </span><span class="lineNoCov">          0 :     pgcd[13].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3290 </span><span class="lineNoCov">          0 :     if ( pointstoofar ) pgcd[13].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3291 </span><span class="lineNoCov">          0 :     pgcd[13].gd.popup_msg = (unichar_t *) _(&quot;Most font formats cannot specify adjacent points (or control points)\nwhich are more than 32767 em-units apart in either the x or y direction&quot;);</span>
<span class="lineNum">    3292 </span><span class="lineNoCov">          0 :     pgcd[13].gd.cid = CID_PointsTooFar;</span>
<span class="lineNum">    3293 </span><span class="lineNoCov">          0 :     pgcd[13].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3294 </span><span class="lineNoCov">          0 :     parray[9] = &amp;pgcd[13]; parray[10] = GCD_Glue; parray[11] = NULL;</span>
<span class="lineNum">    3295 </span>            : 
<span class="lineNum">    3296 </span><span class="lineNoCov">          0 :     pboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3297 </span><span class="lineNoCov">          0 :     pboxes[0].gd.u.boxelements = parray;</span>
<span class="lineNum">    3298 </span><span class="lineNoCov">          0 :     pboxes[0].creator = GVBoxCreate;</span>
<span class="lineNum">    3299 </span>            : 
<span class="lineNum">    3300 </span>            : /* ************************************************************************** */
<span class="lineNum">    3301 </span>            : 
<span class="lineNum">    3302 </span><span class="lineNoCov">          0 :     memset(&amp;palabel,0,sizeof(palabel));</span>
<span class="lineNum">    3303 </span><span class="lineNoCov">          0 :     memset(&amp;pagcd,0,sizeof(pagcd));</span>
<span class="lineNum">    3304 </span><span class="lineNoCov">          0 :     memset(&amp;paboxes,0,sizeof(paboxes));</span>
<span class="lineNum">    3305 </span>            : 
<span class="lineNum">    3306 </span><span class="lineNoCov">          0 :     palabel[0].text = (unichar_t *) _(&quot;O_pen Paths&quot;);</span>
<span class="lineNum">    3307 </span><span class="lineNoCov">          0 :     palabel[0].text_is_1byte = true;</span>
<span class="lineNum">    3308 </span><span class="lineNoCov">          0 :     palabel[0].text_in_resource = true;</span>
<span class="lineNum">    3309 </span><span class="lineNoCov">          0 :     pagcd[0].gd.label = &amp;palabel[0];</span>
<span class="lineNum">    3310 </span><span class="lineNoCov">          0 :     pagcd[0].gd.mnemonic = 'P';</span>
<span class="lineNum">    3311 </span><span class="lineNoCov">          0 :     pagcd[0].gd.pos.x = 3; pagcd[0].gd.pos.y = 6; </span>
<span class="lineNum">    3312 </span><span class="lineNoCov">          0 :     pagcd[0].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3313 </span><span class="lineNoCov">          0 :     if ( openpaths ) pagcd[0].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3314 </span><span class="lineNoCov">          0 :     pagcd[0].gd.popup_msg = (unichar_t *) _(&quot;All paths should be closed loops, there should be no exposed endpoints&quot;);</span>
<span class="lineNum">    3315 </span><span class="lineNoCov">          0 :     pagcd[0].gd.cid = CID_OpenPaths;</span>
<span class="lineNum">    3316 </span><span class="lineNoCov">          0 :     pagcd[0].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3317 </span><span class="lineNoCov">          0 :     paarray[0] = &amp;pagcd[0];</span>
<span class="lineNum">    3318 </span>            : 
<span class="lineNum">    3319 </span><span class="lineNoCov">          0 :     palabel[1].text = (unichar_t *) _(&quot;Intersecting Paths&quot;);</span>
<span class="lineNum">    3320 </span><span class="lineNoCov">          0 :     palabel[1].text_is_1byte = true;</span>
<span class="lineNum">    3321 </span><span class="lineNoCov">          0 :     pagcd[1].gd.label = &amp;palabel[1];</span>
<span class="lineNum">    3322 </span><span class="lineNoCov">          0 :     pagcd[1].gd.mnemonic = 'E';</span>
<span class="lineNum">    3323 </span><span class="lineNoCov">          0 :     pagcd[1].gd.pos.x = 3; pagcd[1].gd.pos.y = pagcd[0].gd.pos.y+17; </span>
<span class="lineNum">    3324 </span><span class="lineNoCov">          0 :     pagcd[1].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3325 </span><span class="lineNoCov">          0 :     if ( intersectingpaths ) pagcd[1].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3326 </span><span class="lineNoCov">          0 :     pagcd[1].gd.popup_msg = (unichar_t *) _(&quot;No paths with within a glyph should intersect&quot;);</span>
<span class="lineNum">    3327 </span><span class="lineNoCov">          0 :     pagcd[1].gd.cid = CID_IntersectingPaths;</span>
<span class="lineNum">    3328 </span><span class="lineNoCov">          0 :     pagcd[1].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3329 </span><span class="lineNoCov">          0 :     paarray[1] = &amp;pagcd[1];</span>
<span class="lineNum">    3330 </span>            : 
<span class="lineNum">    3331 </span><span class="lineNoCov">          0 :     palabel[2].text = (unichar_t *) (fv-&gt;b.sf-&gt;italicangle==0?_(&quot;_Edges near horizontal/vertical&quot;):_(&quot;Edges near horizontal/vertical/italic&quot;));</span>
<span class="lineNum">    3332 </span><span class="lineNoCov">          0 :     palabel[2].text_is_1byte = true;</span>
<span class="lineNum">    3333 </span><span class="lineNoCov">          0 :     palabel[2].text_in_resource = true;</span>
<span class="lineNum">    3334 </span><span class="lineNoCov">          0 :     pagcd[2].gd.label = &amp;palabel[2];</span>
<span class="lineNum">    3335 </span><span class="lineNoCov">          0 :     pagcd[2].gd.mnemonic = 'E';</span>
<span class="lineNum">    3336 </span><span class="lineNoCov">          0 :     pagcd[2].gd.pos.x = 3; pagcd[2].gd.pos.y = pagcd[1].gd.pos.y+17; </span>
<span class="lineNum">    3337 </span><span class="lineNoCov">          0 :     pagcd[2].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3338 </span><span class="lineNoCov">          0 :     if ( linestd ) pagcd[2].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3339 </span><span class="lineNoCov">          0 :     pagcd[2].gd.popup_msg = (unichar_t *) _(&quot;Allows you to find lines which are almost,\nbut not quite horizontal or vertical\n(or at the italic angle).&quot;);</span>
<span class="lineNum">    3340 </span><span class="lineNoCov">          0 :     pagcd[2].gd.cid = CID_LineStd;</span>
<span class="lineNum">    3341 </span><span class="lineNoCov">          0 :     pagcd[2].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3342 </span><span class="lineNoCov">          0 :     paarray[2] = &amp;pagcd[2];</span>
<span class="lineNum">    3343 </span>            : 
<span class="lineNum">    3344 </span><span class="lineNoCov">          0 :     palabel[3].text = (unichar_t *) _(&quot;Check _outermost paths clockwise&quot;);</span>
<span class="lineNum">    3345 </span><span class="lineNoCov">          0 :     palabel[3].text_is_1byte = true;</span>
<span class="lineNum">    3346 </span><span class="lineNoCov">          0 :     palabel[3].text_in_resource = true;</span>
<span class="lineNum">    3347 </span><span class="lineNoCov">          0 :     pagcd[3].gd.label = &amp;palabel[3];</span>
<span class="lineNum">    3348 </span><span class="lineNoCov">          0 :     pagcd[3].gd.mnemonic = 'S';</span>
<span class="lineNum">    3349 </span><span class="lineNoCov">          0 :     pagcd[3].gd.pos.x = 3; pagcd[3].gd.pos.y = pagcd[2].gd.pos.y+17; </span>
<span class="lineNum">    3350 </span><span class="lineNoCov">          0 :     pagcd[3].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3351 </span><span class="lineNoCov">          0 :     if ( direction ) pagcd[3].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3352 </span><span class="lineNoCov">          0 :     pagcd[3].gd.popup_msg = (unichar_t *) _(&quot;FontForge internally uses paths drawn in a\nclockwise direction. This lets you check that they are.\nBefore doing this test insure that\nno paths self-intersect.&quot;);</span>
<span class="lineNum">    3353 </span><span class="lineNoCov">          0 :     pagcd[3].gd.cid = CID_Direction;</span>
<span class="lineNum">    3354 </span><span class="lineNoCov">          0 :     pagcd[3].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3355 </span><span class="lineNoCov">          0 :     paarray[3] = &amp;pagcd[3];</span>
<span class="lineNum">    3356 </span>            : 
<span class="lineNum">    3357 </span><span class="lineNoCov">          0 :     palabel[4].text = (unichar_t *) _(&quot;Check _missing extrema&quot;);</span>
<span class="lineNum">    3358 </span><span class="lineNoCov">          0 :     palabel[4].text_is_1byte = true;</span>
<span class="lineNum">    3359 </span><span class="lineNoCov">          0 :     palabel[4].text_in_resource = true;</span>
<span class="lineNum">    3360 </span><span class="lineNoCov">          0 :     pagcd[4].gd.label = &amp;palabel[4];</span>
<span class="lineNum">    3361 </span><span class="lineNoCov">          0 :     pagcd[4].gd.pos.x = 3; pagcd[4].gd.pos.y = pagcd[3].gd.pos.y+17; </span>
<span class="lineNum">    3362 </span><span class="lineNoCov">          0 :     pagcd[4].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3363 </span><span class="lineNoCov">          0 :     if ( missingextrema ) pagcd[4].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3364 </span><span class="lineNoCov">          0 :     pagcd[4].gd.popup_msg = (unichar_t *) _(&quot;PostScript and TrueType require that when a path\nreaches its maximum or minimum position\nthere must be a point at that location.&quot;);</span>
<span class="lineNum">    3365 </span><span class="lineNoCov">          0 :     pagcd[4].gd.cid = CID_MissingExtrema;</span>
<span class="lineNum">    3366 </span><span class="lineNoCov">          0 :     pagcd[4].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3367 </span><span class="lineNoCov">          0 :     paarray[4] = &amp;pagcd[4];</span>
<span class="lineNum">    3368 </span>            : 
<span class="lineNum">    3369 </span><span class="lineNoCov">          0 :     palabel[5].text = (unichar_t *) _(&quot;_More points than:&quot;);</span>
<span class="lineNum">    3370 </span><span class="lineNoCov">          0 :     palabel[5].text_is_1byte = true;</span>
<span class="lineNum">    3371 </span><span class="lineNoCov">          0 :     palabel[5].text_in_resource = true;</span>
<span class="lineNum">    3372 </span><span class="lineNoCov">          0 :     pagcd[5].gd.label = &amp;palabel[5];</span>
<span class="lineNum">    3373 </span><span class="lineNoCov">          0 :     pagcd[5].gd.mnemonic = 'r';</span>
<span class="lineNum">    3374 </span><span class="lineNoCov">          0 :     pagcd[5].gd.pos.x = 3; pagcd[5].gd.pos.y = pagcd[4].gd.pos.y+21; </span>
<span class="lineNum">    3375 </span><span class="lineNoCov">          0 :     pagcd[5].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3376 </span><span class="lineNoCov">          0 :     if ( toomanypoints ) pagcd[5].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3377 </span><span class="lineNoCov">          0 :     pagcd[5].gd.popup_msg = (unichar_t *) _(&quot;The PostScript Language Reference Manual (Appendix B) says that\nan interpreter need not support paths with more than 1500 points.\nI think this count includes control points. From PostScript's point\nof view, all the contours in a character make up one path. Modern\ninterpreters tend to support paths with more points than this limit.\n(Note a truetype font after conversion to PS will contain\ntwice as many control points)&quot;);</span>
<span class="lineNum">    3378 </span><span class="lineNoCov">          0 :     pagcd[5].gd.cid = CID_TooManyPoints;</span>
<span class="lineNum">    3379 </span><span class="lineNoCov">          0 :     pagcd[5].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3380 </span><span class="lineNoCov">          0 :     paharray[0] = &amp;pagcd[5];</span>
<span class="lineNum">    3381 </span>            : 
<span class="lineNum">    3382 </span><span class="lineNoCov">          0 :     sprintf( pmax, &quot;%d&quot;, pointsmax );</span>
<span class="lineNum">    3383 </span><span class="lineNoCov">          0 :     palabel[6].text = (unichar_t *) pmax;</span>
<span class="lineNum">    3384 </span><span class="lineNoCov">          0 :     palabel[6].text_is_1byte = true;</span>
<span class="lineNum">    3385 </span><span class="lineNoCov">          0 :     pagcd[6].gd.label = &amp;palabel[6];</span>
<span class="lineNum">    3386 </span><span class="lineNoCov">          0 :     pagcd[6].gd.pos.x = 105; pagcd[6].gd.pos.y = pagcd[5].gd.pos.y-3;</span>
<span class="lineNum">    3387 </span><span class="lineNoCov">          0 :     pagcd[6].gd.pos.width = 50; </span>
<span class="lineNum">    3388 </span><span class="lineNoCov">          0 :     pagcd[6].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3389 </span><span class="lineNoCov">          0 :     pagcd[6].gd.popup_msg = (unichar_t *) _(&quot;The PostScript Language Reference Manual (Appendix B) says that\nan interpreter need not support paths with more than 1500 points.\nI think this count includes control points. From PostScript's point\nof view, all the contours in a character make up one path. Modern\ninterpreters tend to support paths with more points than this limit.\n(Note a truetype font after conversion to PS will contain\ntwice as many control points)&quot;);</span>
<span class="lineNum">    3390 </span><span class="lineNoCov">          0 :     pagcd[6].gd.cid = CID_PointsMax;</span>
<span class="lineNum">    3391 </span><span class="lineNoCov">          0 :     pagcd[6].creator = GTextFieldCreate;</span>
<span class="lineNum">    3392 </span><span class="lineNoCov">          0 :     paharray[1] = &amp;pagcd[6]; paharray[2] = GCD_Glue; paharray[3] = NULL;</span>
<span class="lineNum">    3393 </span>            : 
<span class="lineNum">    3394 </span><span class="lineNoCov">          0 :     paboxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3395 </span><span class="lineNoCov">          0 :     paboxes[2].gd.u.boxelements = paharray;</span>
<span class="lineNum">    3396 </span><span class="lineNoCov">          0 :     paboxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">    3397 </span><span class="lineNoCov">          0 :     paarray[5] = &amp;paboxes[2]; paarray[6] = GCD_Glue; paarray[7] = NULL;</span>
<span class="lineNum">    3398 </span>            : 
<span class="lineNum">    3399 </span><span class="lineNoCov">          0 :     paboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3400 </span><span class="lineNoCov">          0 :     paboxes[0].gd.u.boxelements = paarray;</span>
<span class="lineNum">    3401 </span><span class="lineNoCov">          0 :     paboxes[0].creator = GVBoxCreate;</span>
<span class="lineNum">    3402 </span>            : 
<span class="lineNum">    3403 </span>            : /* ************************************************************************** */
<span class="lineNum">    3404 </span>            : 
<span class="lineNum">    3405 </span><span class="lineNoCov">          0 :     memset(&amp;rflabel,0,sizeof(rflabel));</span>
<span class="lineNum">    3406 </span><span class="lineNoCov">          0 :     memset(&amp;rfgcd,0,sizeof(rfgcd));</span>
<span class="lineNum">    3407 </span><span class="lineNoCov">          0 :     memset(&amp;rfboxes,0,sizeof(rfboxes));</span>
<span class="lineNum">    3408 </span>            : 
<span class="lineNum">    3409 </span><span class="lineNoCov">          0 :     rflabel[0].text = (unichar_t *) _(&quot;Check _flipped references&quot;);</span>
<span class="lineNum">    3410 </span><span class="lineNoCov">          0 :     rflabel[0].text_is_1byte = true;</span>
<span class="lineNum">    3411 </span><span class="lineNoCov">          0 :     rflabel[0].text_in_resource = true;</span>
<span class="lineNum">    3412 </span><span class="lineNoCov">          0 :     rfgcd[0].gd.label = &amp;rflabel[0];</span>
<span class="lineNum">    3413 </span><span class="lineNoCov">          0 :     rfgcd[0].gd.mnemonic = 'r';</span>
<span class="lineNum">    3414 </span><span class="lineNoCov">          0 :     rfgcd[0].gd.pos.x = 3; rfgcd[0].gd.pos.y = 6; </span>
<span class="lineNum">    3415 </span><span class="lineNoCov">          0 :     rfgcd[0].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3416 </span><span class="lineNoCov">          0 :     if ( flippedrefs ) rfgcd[0].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3417 </span><span class="lineNoCov">          0 :     rfgcd[0].gd.popup_msg = (unichar_t *) _(&quot;PostScript and TrueType require that paths be drawn\nin a clockwise direction. If you have a reference\nthat has been flipped then the paths in that reference will\nprobably be counter-clockwise. You should unlink it and do\nElement-&gt;Correct direction on it.&quot;);</span>
<span class="lineNum">    3418 </span><span class="lineNoCov">          0 :     rfgcd[0].gd.cid = CID_FlippedRefs;</span>
<span class="lineNum">    3419 </span><span class="lineNoCov">          0 :     rfgcd[0].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3420 </span><span class="lineNoCov">          0 :     rfarray[0] = &amp;rfgcd[0];</span>
<span class="lineNum">    3421 </span>            : 
<span class="lineNum">    3422 </span>            : /* GT: Refs is an abbreviation for References. Space is somewhat constrained here */
<span class="lineNum">    3423 </span><span class="lineNoCov">          0 :     rflabel[1].text = (unichar_t *) _(&quot;Refs with bad tt transformation matrices&quot;);</span>
<span class="lineNum">    3424 </span><span class="lineNoCov">          0 :     rflabel[1].text_is_1byte = true;</span>
<span class="lineNum">    3425 </span><span class="lineNoCov">          0 :     rflabel[1].text_in_resource = true;</span>
<span class="lineNum">    3426 </span><span class="lineNoCov">          0 :     rfgcd[1].gd.label = &amp;rflabel[1];</span>
<span class="lineNum">    3427 </span><span class="lineNoCov">          0 :     rfgcd[1].gd.mnemonic = 'r';</span>
<span class="lineNum">    3428 </span><span class="lineNoCov">          0 :     rfgcd[1].gd.pos.x = 3; rfgcd[1].gd.pos.y = rfgcd[0].gd.pos.y+17; </span>
<span class="lineNum">    3429 </span><span class="lineNoCov">          0 :     rfgcd[1].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3430 </span><span class="lineNoCov">          0 :     if ( refsbadtransformttf ) rfgcd[1].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3431 </span><span class="lineNoCov">          0 :     rfgcd[1].gd.popup_msg = (unichar_t *) _(&quot;TrueType requires that all scaling and rotational\nentries in a transformation matrix be between -2 and 2&quot;);</span>
<span class="lineNum">    3432 </span><span class="lineNoCov">          0 :     rfgcd[1].gd.cid = CID_RefBadTransformTTF;</span>
<span class="lineNum">    3433 </span><span class="lineNoCov">          0 :     rfgcd[1].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3434 </span><span class="lineNoCov">          0 :     rfarray[1] = &amp;rfgcd[1];</span>
<span class="lineNum">    3435 </span>            : 
<span class="lineNum">    3436 </span><span class="lineNoCov">          0 :     rflabel[2].text = (unichar_t *) _(&quot;Mixed contours and references&quot;);</span>
<span class="lineNum">    3437 </span><span class="lineNoCov">          0 :     rflabel[2].text_is_1byte = true;</span>
<span class="lineNum">    3438 </span><span class="lineNoCov">          0 :     rflabel[2].text_in_resource = true;</span>
<span class="lineNum">    3439 </span><span class="lineNoCov">          0 :     rfgcd[2].gd.label = &amp;rflabel[2];</span>
<span class="lineNum">    3440 </span><span class="lineNoCov">          0 :     rfgcd[2].gd.mnemonic = 'r';</span>
<span class="lineNum">    3441 </span><span class="lineNoCov">          0 :     rfgcd[2].gd.pos.x = 3; rfgcd[2].gd.pos.y = rfgcd[1].gd.pos.y+17; </span>
<span class="lineNum">    3442 </span><span class="lineNoCov">          0 :     rfgcd[2].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3443 </span><span class="lineNoCov">          0 :     if ( mixedcontoursrefs ) rfgcd[2].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3444 </span><span class="lineNoCov">          0 :     rfgcd[2].gd.popup_msg = (unichar_t *) _(&quot;TrueType glyphs can either contain references or contours.\nNot both.&quot;);</span>
<span class="lineNum">    3445 </span><span class="lineNoCov">          0 :     rfgcd[2].gd.cid = CID_MixedContoursRefs;</span>
<span class="lineNum">    3446 </span><span class="lineNoCov">          0 :     rfgcd[2].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3447 </span><span class="lineNoCov">          0 :     rfarray[2] = &amp;rfgcd[2];</span>
<span class="lineNum">    3448 </span>            : 
<span class="lineNum">    3449 </span>            : /* GT: Refs is an abbreviation for References. Space is somewhat constrained here */
<span class="lineNum">    3450 </span><span class="lineNoCov">          0 :     rflabel[3].text = (unichar_t *) _(&quot;Refs with bad ps transformation matrices&quot;);</span>
<span class="lineNum">    3451 </span><span class="lineNoCov">          0 :     rflabel[3].text_is_1byte = true;</span>
<span class="lineNum">    3452 </span><span class="lineNoCov">          0 :     rflabel[3].text_in_resource = true;</span>
<span class="lineNum">    3453 </span><span class="lineNoCov">          0 :     rfgcd[3].gd.label = &amp;rflabel[3];</span>
<span class="lineNum">    3454 </span><span class="lineNoCov">          0 :     rfgcd[3].gd.mnemonic = 'r';</span>
<span class="lineNum">    3455 </span><span class="lineNoCov">          0 :     rfgcd[3].gd.pos.x = 3; rfgcd[3].gd.pos.y = rfgcd[2].gd.pos.y+17; </span>
<span class="lineNum">    3456 </span><span class="lineNoCov">          0 :     rfgcd[3].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3457 </span><span class="lineNoCov">          0 :     if ( refsbadtransformps ) rfgcd[3].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3458 </span><span class="lineNoCov">          0 :     rfgcd[3].gd.popup_msg = (unichar_t *) _(&quot;Type1 and 2 fonts only support translation of references.\nThe first four entries of the transformation matrix should be\n[1 0 0 1].&quot;);</span>
<span class="lineNum">    3459 </span><span class="lineNoCov">          0 :     rfgcd[3].gd.cid = CID_RefBadTransformPS;</span>
<span class="lineNum">    3460 </span><span class="lineNoCov">          0 :     rfgcd[3].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3461 </span><span class="lineNoCov">          0 :     rfarray[3] = &amp;rfgcd[3];</span>
<span class="lineNum">    3462 </span>            : 
<span class="lineNum">    3463 </span>            : /* GT: Refs is an abbreviation for References. Space is somewhat constrained here */
<span class="lineNum">    3464 </span><span class="lineNoCov">          0 :     rflabel[4].text = (unichar_t *) _(&quot;Refs neste_d deeper than:&quot;);</span>
<span class="lineNum">    3465 </span><span class="lineNoCov">          0 :     rflabel[4].text_is_1byte = true;</span>
<span class="lineNum">    3466 </span><span class="lineNoCov">          0 :     rflabel[4].text_in_resource = true;</span>
<span class="lineNum">    3467 </span><span class="lineNoCov">          0 :     rfgcd[4].gd.label = &amp;rflabel[4];</span>
<span class="lineNum">    3468 </span><span class="lineNoCov">          0 :     rfgcd[4].gd.mnemonic = 'r';</span>
<span class="lineNum">    3469 </span><span class="lineNoCov">          0 :     rfgcd[4].gd.pos.x = 3; rfgcd[4].gd.pos.y = rfgcd[3].gd.pos.y+21; </span>
<span class="lineNum">    3470 </span><span class="lineNoCov">          0 :     rfgcd[4].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3471 </span><span class="lineNoCov">          0 :     if ( toodeeprefs ) rfgcd[4].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3472 </span><span class="lineNoCov">          0 :     rfgcd[4].gd.popup_msg = (unichar_t *) _(&quot;The Type 2 Charstring Reference (Appendix B) says that\nsubroutines may not be nested more than 10 deep. Each\nnesting level for references requires one subroutine\nlevel, and hints may require another level.&quot;);</span>
<span class="lineNum">    3473 </span><span class="lineNoCov">          0 :     rfgcd[4].gd.cid = CID_TooDeepRefs;</span>
<span class="lineNum">    3474 </span><span class="lineNoCov">          0 :     rfgcd[4].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3475 </span><span class="lineNoCov">          0 :     rfharray[0] = &amp;rfgcd[4];</span>
<span class="lineNum">    3476 </span>            : 
<span class="lineNum">    3477 </span><span class="lineNoCov">          0 :     sprintf( rmax, &quot;%d&quot;, refdepthmax );</span>
<span class="lineNum">    3478 </span><span class="lineNoCov">          0 :     rflabel[5].text = (unichar_t *) rmax;</span>
<span class="lineNum">    3479 </span><span class="lineNoCov">          0 :     rflabel[5].text_is_1byte = true;</span>
<span class="lineNum">    3480 </span><span class="lineNoCov">          0 :     rfgcd[5].gd.label = &amp;rflabel[5];</span>
<span class="lineNum">    3481 </span><span class="lineNoCov">          0 :     rfgcd[5].gd.pos.x = 140; rfgcd[5].gd.pos.y = rfgcd[4].gd.pos.y-3;</span>
<span class="lineNum">    3482 </span><span class="lineNoCov">          0 :     rfgcd[5].gd.pos.width = 40; </span>
<span class="lineNum">    3483 </span><span class="lineNoCov">          0 :     rfgcd[5].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3484 </span><span class="lineNoCov">          0 :     rfgcd[5].gd.popup_msg = (unichar_t *) _(&quot;The Type 2 Charstring Reference (Appendix B) says that\nsubroutines may not be nested more than 10 deep. Each\nnesting level for references requires one subroutine\nlevel, and hints may require another level.&quot;);</span>
<span class="lineNum">    3485 </span><span class="lineNoCov">          0 :     rfgcd[5].gd.cid = CID_RefDepthMax;</span>
<span class="lineNum">    3486 </span><span class="lineNoCov">          0 :     rfgcd[5].creator = GTextFieldCreate;</span>
<span class="lineNum">    3487 </span><span class="lineNoCov">          0 :     rfharray[1] = &amp;rfgcd[5]; rfharray[2] = GCD_Glue; rfharray[3] = NULL;</span>
<span class="lineNum">    3488 </span>            : 
<span class="lineNum">    3489 </span><span class="lineNoCov">          0 :     rfboxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3490 </span><span class="lineNoCov">          0 :     rfboxes[2].gd.u.boxelements = rfharray;</span>
<span class="lineNum">    3491 </span><span class="lineNoCov">          0 :     rfboxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">    3492 </span><span class="lineNoCov">          0 :     rfarray[4] = &amp;rfboxes[2];</span>
<span class="lineNum">    3493 </span>            : 
<span class="lineNum">    3494 </span><span class="lineNoCov">          0 :     rflabel[6].text = (unichar_t *) _(&quot;Refs with out of date point matching&quot;);</span>
<span class="lineNum">    3495 </span><span class="lineNoCov">          0 :     rflabel[6].text_is_1byte = true;</span>
<span class="lineNum">    3496 </span><span class="lineNoCov">          0 :     rflabel[6].text_in_resource = true;</span>
<span class="lineNum">    3497 </span><span class="lineNoCov">          0 :     rfgcd[6].gd.label = &amp;rflabel[6];</span>
<span class="lineNum">    3498 </span><span class="lineNoCov">          0 :     rfgcd[6].gd.mnemonic = 'r';</span>
<span class="lineNum">    3499 </span><span class="lineNoCov">          0 :     rfgcd[6].gd.pos.x = 3; rfgcd[6].gd.pos.y = rfgcd[5].gd.pos.y+24; </span>
<span class="lineNum">    3500 </span><span class="lineNoCov">          0 :     rfgcd[6].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3501 </span><span class="lineNoCov">          0 :     if ( ptmatchrefsoutofdate ) rfgcd[6].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3502 </span><span class="lineNoCov">          0 :     rfgcd[6].gd.popup_msg = (unichar_t *) _(&quot;If a glyph has been edited so that it has a different\nnumber of points now, then any references\nwhich use point matching and depended on that glyph's\npoint count will be incorrect.&quot;);</span>
<span class="lineNum">    3503 </span><span class="lineNoCov">          0 :     rfgcd[6].gd.cid = CID_PtMatchRefsOutOfDate;</span>
<span class="lineNum">    3504 </span><span class="lineNoCov">          0 :     rfgcd[6].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3505 </span><span class="lineNoCov">          0 :     rfarray[5] = &amp;rfgcd[6];</span>
<span class="lineNum">    3506 </span>            : 
<span class="lineNum">    3507 </span><span class="lineNoCov">          0 :     rflabel[7].text = (unichar_t *) _(&quot;Multiple refs with use-my-metrics&quot;);</span>
<span class="lineNum">    3508 </span><span class="lineNoCov">          0 :     rflabel[7].text_is_1byte = true;</span>
<span class="lineNum">    3509 </span><span class="lineNoCov">          0 :     rflabel[7].text_in_resource = true;</span>
<span class="lineNum">    3510 </span><span class="lineNoCov">          0 :     rfgcd[7].gd.label = &amp;rflabel[7];</span>
<span class="lineNum">    3511 </span><span class="lineNoCov">          0 :     rfgcd[7].gd.mnemonic = 'r';</span>
<span class="lineNum">    3512 </span><span class="lineNoCov">          0 :     rfgcd[7].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3513 </span><span class="lineNoCov">          0 :     if ( multusemymetrics ) rfgcd[7].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3514 </span><span class="lineNoCov">          0 :     rfgcd[7].gd.popup_msg = (unichar_t *) _(&quot;There may be at most one reference with the use-my-metrics bit set&quot;);</span>
<span class="lineNum">    3515 </span><span class="lineNoCov">          0 :     rfgcd[7].gd.cid = CID_MultUseMyMetrics;</span>
<span class="lineNum">    3516 </span><span class="lineNoCov">          0 :     rfgcd[7].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3517 </span><span class="lineNoCov">          0 :     rfarray[6] = &amp;rfgcd[7]; rfarray[7] = GCD_Glue; rfarray[8] = NULL;</span>
<span class="lineNum">    3518 </span>            : 
<span class="lineNum">    3519 </span><span class="lineNoCov">          0 :     rfboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3520 </span><span class="lineNoCov">          0 :     rfboxes[0].gd.u.boxelements = rfarray;</span>
<span class="lineNum">    3521 </span><span class="lineNoCov">          0 :     rfboxes[0].creator = GVBoxCreate;</span>
<span class="lineNum">    3522 </span>            : 
<span class="lineNum">    3523 </span>            : /* ************************************************************************** */
<span class="lineNum">    3524 </span>            : 
<span class="lineNum">    3525 </span><span class="lineNoCov">          0 :     memset(&amp;hlabel,0,sizeof(hlabel));</span>
<span class="lineNum">    3526 </span><span class="lineNoCov">          0 :     memset(&amp;hgcd,0,sizeof(hgcd));</span>
<span class="lineNum">    3527 </span><span class="lineNoCov">          0 :     memset(&amp;hboxes,0,sizeof(hboxes));</span>
<span class="lineNum">    3528 </span>            : 
<span class="lineNum">    3529 </span><span class="lineNoCov">          0 :     hlabel[0].text = (unichar_t *) _(&quot;_Hints controlling no points&quot;);</span>
<span class="lineNum">    3530 </span><span class="lineNoCov">          0 :     hlabel[0].text_is_1byte = true;</span>
<span class="lineNum">    3531 </span><span class="lineNoCov">          0 :     hlabel[0].text_in_resource = true;</span>
<span class="lineNum">    3532 </span><span class="lineNoCov">          0 :     hgcd[0].gd.label = &amp;hlabel[0];</span>
<span class="lineNum">    3533 </span><span class="lineNoCov">          0 :     hgcd[0].gd.mnemonic = 'H';</span>
<span class="lineNum">    3534 </span><span class="lineNoCov">          0 :     hgcd[0].gd.pos.x = 3; hgcd[0].gd.pos.y = 5; </span>
<span class="lineNum">    3535 </span><span class="lineNoCov">          0 :     hgcd[0].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3536 </span><span class="lineNoCov">          0 :     if ( hintnopt ) hgcd[0].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3537 </span><span class="lineNoCov">          0 :     hgcd[0].gd.popup_msg = (unichar_t *) _(&quot;Ghostview (perhaps other interpreters) has a problem when a\nhint exists without any points that lie on it.&quot;);</span>
<span class="lineNum">    3538 </span><span class="lineNoCov">          0 :     hgcd[0].gd.cid = CID_HintNoPt;</span>
<span class="lineNum">    3539 </span><span class="lineNoCov">          0 :     hgcd[0].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3540 </span><span class="lineNoCov">          0 :     harray[0] = &amp;hgcd[0];</span>
<span class="lineNum">    3541 </span>            : 
<span class="lineNum">    3542 </span><span class="lineNoCov">          0 :     hlabel[1].text = (unichar_t *) U_(&quot;_Points near¹ hint edges&quot;);</span>
<span class="lineNum">    3543 </span><span class="lineNoCov">          0 :     hlabel[1].text_is_1byte = true;</span>
<span class="lineNum">    3544 </span><span class="lineNoCov">          0 :     hlabel[1].text_in_resource = true;</span>
<span class="lineNum">    3545 </span><span class="lineNoCov">          0 :     hgcd[1].gd.label = &amp;hlabel[1];</span>
<span class="lineNum">    3546 </span><span class="lineNoCov">          0 :     hgcd[1].gd.mnemonic = 'H';</span>
<span class="lineNum">    3547 </span><span class="lineNoCov">          0 :     hgcd[1].gd.pos.x = 3; hgcd[1].gd.pos.y = hgcd[0].gd.pos.y+17; </span>
<span class="lineNum">    3548 </span><span class="lineNoCov">          0 :     hgcd[1].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3549 </span><span class="lineNoCov">          0 :     if ( ptnearhint ) hgcd[1].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3550 </span><span class="lineNoCov">          0 :     hgcd[1].gd.popup_msg = (unichar_t *) _(&quot;Often if a point is slightly off from a hint\nit is because a stem is made up\nof several segments, and one of them\nhas the wrong width.&quot;);</span>
<span class="lineNum">    3551 </span><span class="lineNoCov">          0 :     hgcd[1].gd.cid = CID_PtNearHint;</span>
<span class="lineNum">    3552 </span><span class="lineNoCov">          0 :     hgcd[1].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3553 </span><span class="lineNoCov">          0 :     harray[1] = &amp;hgcd[1];</span>
<span class="lineNum">    3554 </span>            : 
<span class="lineNum">    3555 </span><span class="lineNoCov">          0 :     hlabel[2].text = (unichar_t *) U_(&quot;Hint _Width Near¹&quot;);</span>
<span class="lineNum">    3556 </span><span class="lineNoCov">          0 :     hlabel[2].text_is_1byte = true;</span>
<span class="lineNum">    3557 </span><span class="lineNoCov">          0 :     hlabel[2].text_in_resource = true;</span>
<span class="lineNum">    3558 </span><span class="lineNoCov">          0 :     hgcd[2].gd.label = &amp;hlabel[2];</span>
<span class="lineNum">    3559 </span><span class="lineNoCov">          0 :     hgcd[2].gd.mnemonic = 'W';</span>
<span class="lineNum">    3560 </span><span class="lineNoCov">          0 :     hgcd[2].gd.pos.x = 3; hgcd[2].gd.pos.y = hgcd[1].gd.pos.y+21;</span>
<span class="lineNum">    3561 </span><span class="lineNoCov">          0 :     hgcd[2].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3562 </span><span class="lineNoCov">          0 :     if ( hintwidth ) hgcd[2].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3563 </span><span class="lineNoCov">          0 :     hgcd[2].gd.popup_msg = (unichar_t *) _(&quot;Allows you to check that stems have consistent widths..&quot;);</span>
<span class="lineNum">    3564 </span><span class="lineNoCov">          0 :     hgcd[2].gd.cid = CID_HintWidthNear;</span>
<span class="lineNum">    3565 </span><span class="lineNoCov">          0 :     hgcd[2].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3566 </span><span class="lineNoCov">          0 :     hharray1[0] = &amp;hgcd[2];</span>
<span class="lineNum">    3567 </span>            : 
<span class="lineNum">    3568 </span><span class="lineNoCov">          0 :     sprintf(widthbuf,&quot;%g&quot;,widthval);</span>
<span class="lineNum">    3569 </span><span class="lineNoCov">          0 :     hlabel[3].text = (unichar_t *) widthbuf;</span>
<span class="lineNum">    3570 </span><span class="lineNoCov">          0 :     hlabel[3].text_is_1byte = true;</span>
<span class="lineNum">    3571 </span><span class="lineNoCov">          0 :     hgcd[3].gd.label = &amp;hlabel[3];</span>
<span class="lineNum">    3572 </span><span class="lineNoCov">          0 :     hgcd[3].gd.pos.x = 100+5; hgcd[3].gd.pos.y = hgcd[2].gd.pos.y-1; hgcd[3].gd.pos.width = 40;</span>
<span class="lineNum">    3573 </span><span class="lineNoCov">          0 :     hgcd[3].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    3574 </span><span class="lineNoCov">          0 :     hgcd[3].gd.cid = CID_HintWidth;</span>
<span class="lineNum">    3575 </span><span class="lineNoCov">          0 :     hgcd[3].gd.handle_controlevent = Prob_TextChanged;</span>
<span class="lineNum">    3576 </span><span class="lineNoCov">          0 :     hgcd[3].data = (void *) CID_HintWidthNear;</span>
<span class="lineNum">    3577 </span><span class="lineNoCov">          0 :     hgcd[3].creator = GTextFieldCreate;</span>
<span class="lineNum">    3578 </span><span class="lineNoCov">          0 :     hharray1[1] = &amp;hgcd[3]; hharray1[2] = GCD_Glue; hharray1[3] = NULL;</span>
<span class="lineNum">    3579 </span>            : 
<span class="lineNum">    3580 </span><span class="lineNoCov">          0 :     hboxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3581 </span><span class="lineNoCov">          0 :     hboxes[2].gd.u.boxelements = hharray1;</span>
<span class="lineNum">    3582 </span><span class="lineNoCov">          0 :     hboxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">    3583 </span><span class="lineNoCov">          0 :     harray[2] = &amp;hboxes[2];</span>
<span class="lineNum">    3584 </span>            : 
<span class="lineNum">    3585 </span>            : /* GT: The _3 is used to mark an accelerator */
<span class="lineNum">    3586 </span><span class="lineNoCov">          0 :     hlabel[4].text = (unichar_t *) _(&quot;Almost stem_3 hint&quot;);</span>
<span class="lineNum">    3587 </span><span class="lineNoCov">          0 :     hlabel[4].text_is_1byte = true;</span>
<span class="lineNum">    3588 </span><span class="lineNoCov">          0 :     hlabel[4].text_in_resource = true;</span>
<span class="lineNum">    3589 </span><span class="lineNoCov">          0 :     hgcd[4].gd.label = &amp;hlabel[4];</span>
<span class="lineNum">    3590 </span><span class="lineNoCov">          0 :     hgcd[4].gd.mnemonic = '3';</span>
<span class="lineNum">    3591 </span><span class="lineNoCov">          0 :     hgcd[4].gd.pos.x = 3; hgcd[4].gd.pos.y = hgcd[3].gd.pos.y+19;</span>
<span class="lineNum">    3592 </span><span class="lineNoCov">          0 :     hgcd[4].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3593 </span><span class="lineNoCov">          0 :     if ( stem3 ) hgcd[4].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3594 </span><span class="lineNoCov">          0 :     hgcd[4].gd.popup_msg = (unichar_t *) _(&quot;This checks if the character almost, but not exactly,\nconforms to the requirements for a stem3 hint.\nThat is, either vertically or horizontally, there must\nbe exactly three hints, and they must have the same\nwidth and they must be evenly spaced.&quot;);</span>
<span class="lineNum">    3595 </span><span class="lineNoCov">          0 :     hgcd[4].gd.cid = CID_Stem3;</span>
<span class="lineNum">    3596 </span><span class="lineNoCov">          0 :     hgcd[4].gd.handle_controlevent = Prob_EnableExact;</span>
<span class="lineNum">    3597 </span><span class="lineNoCov">          0 :     hgcd[4].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3598 </span><span class="lineNoCov">          0 :     harray[3] = &amp;hgcd[4];</span>
<span class="lineNum">    3599 </span>            : 
<span class="lineNum">    3600 </span><span class="lineNoCov">          0 :     hlabel[5].text = (unichar_t *) _(&quot;_Show Exact *stem3&quot;);</span>
<span class="lineNum">    3601 </span><span class="lineNoCov">          0 :     hlabel[5].text_is_1byte = true;</span>
<span class="lineNum">    3602 </span><span class="lineNoCov">          0 :     hlabel[5].text_in_resource = true;</span>
<span class="lineNum">    3603 </span><span class="lineNoCov">          0 :     hgcd[5].gd.label = &amp;hlabel[5];</span>
<span class="lineNum">    3604 </span><span class="lineNoCov">          0 :     hgcd[5].gd.mnemonic = 'S';</span>
<span class="lineNum">    3605 </span><span class="lineNoCov">          0 :     hgcd[5].gd.pos.x = hgcd[4].gd.pos.x+5; hgcd[5].gd.pos.y = hgcd[4].gd.pos.y+17;</span>
<span class="lineNum">    3606 </span><span class="lineNoCov">          0 :     hgcd[5].gd.flags = gg_visible | gg_utf8_popup;</span>
<span class="lineNum">    3607 </span><span class="lineNoCov">          0 :     if ( showexactstem3 ) hgcd[5].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3608 </span><span class="lineNoCov">          0 :     if ( stem3 ) hgcd[5].gd.flags |= gg_enabled;</span>
<span class="lineNum">    3609 </span><span class="lineNoCov">          0 :     hgcd[5].gd.popup_msg = (unichar_t *) _(&quot;Shows when this character is exactly a stem3 hint&quot;);</span>
<span class="lineNum">    3610 </span><span class="lineNoCov">          0 :     hgcd[5].gd.cid = CID_ShowExactStem3;</span>
<span class="lineNum">    3611 </span><span class="lineNoCov">          0 :     hgcd[5].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3612 </span><span class="lineNoCov">          0 :     hharray2[0] = GCD_HPad10; hharray2[1] = &amp;hgcd[5]; hharray2[2] = GCD_Glue; hharray2[3] = NULL;</span>
<span class="lineNum">    3613 </span>            : 
<span class="lineNum">    3614 </span><span class="lineNoCov">          0 :     hboxes[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3615 </span><span class="lineNoCov">          0 :     hboxes[3].gd.u.boxelements = hharray2;</span>
<span class="lineNum">    3616 </span><span class="lineNoCov">          0 :     hboxes[3].creator = GHBoxCreate;</span>
<span class="lineNum">    3617 </span><span class="lineNoCov">          0 :     harray[4] = &amp;hboxes[3];</span>
<span class="lineNum">    3618 </span>            : 
<span class="lineNum">    3619 </span><span class="lineNoCov">          0 :     hlabel[6].text = (unichar_t *) _(&quot;_More hints than:&quot;);</span>
<span class="lineNum">    3620 </span><span class="lineNoCov">          0 :     hlabel[6].text_is_1byte = true;</span>
<span class="lineNum">    3621 </span><span class="lineNoCov">          0 :     hlabel[6].text_in_resource = true;</span>
<span class="lineNum">    3622 </span><span class="lineNoCov">          0 :     hgcd[6].gd.label = &amp;hlabel[6];</span>
<span class="lineNum">    3623 </span><span class="lineNoCov">          0 :     hgcd[6].gd.pos.x = 3; hgcd[6].gd.pos.y = hgcd[5].gd.pos.y+21; </span>
<span class="lineNum">    3624 </span><span class="lineNoCov">          0 :     hgcd[6].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3625 </span><span class="lineNoCov">          0 :     if ( toomanyhints ) hgcd[6].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3626 </span><span class="lineNoCov">          0 :     hgcd[6].gd.popup_msg = (unichar_t *) _(&quot;The Type 2 Charstring Reference (Appendix B) says that\nthere may be at most 96 horizontal and vertical stem hints\nin a character.&quot;);</span>
<span class="lineNum">    3627 </span><span class="lineNoCov">          0 :     hgcd[6].gd.cid = CID_TooManyHints;</span>
<span class="lineNum">    3628 </span><span class="lineNoCov">          0 :     hgcd[6].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3629 </span><span class="lineNoCov">          0 :     hharray3[0] = &amp;hgcd[6];</span>
<span class="lineNum">    3630 </span>            : 
<span class="lineNum">    3631 </span><span class="lineNoCov">          0 :     sprintf( hmax, &quot;%d&quot;, hintsmax );</span>
<span class="lineNum">    3632 </span><span class="lineNoCov">          0 :     hlabel[7].text = (unichar_t *) hmax;</span>
<span class="lineNum">    3633 </span><span class="lineNoCov">          0 :     hlabel[7].text_is_1byte = true;</span>
<span class="lineNum">    3634 </span><span class="lineNoCov">          0 :     hgcd[7].gd.label = &amp;hlabel[7];</span>
<span class="lineNum">    3635 </span><span class="lineNoCov">          0 :     hgcd[7].gd.pos.x = 105; hgcd[7].gd.pos.y = hgcd[6].gd.pos.y-3;</span>
<span class="lineNum">    3636 </span><span class="lineNoCov">          0 :     hgcd[7].gd.pos.width = 50; </span>
<span class="lineNum">    3637 </span><span class="lineNoCov">          0 :     hgcd[7].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3638 </span><span class="lineNoCov">          0 :     hgcd[7].gd.popup_msg = (unichar_t *) _(&quot;The Type 2 Charstring Reference (Appendix B) says that\nthere may be at most 96 horizontal and vertical stem hints\nin a character.&quot;);</span>
<span class="lineNum">    3639 </span><span class="lineNoCov">          0 :     hgcd[7].gd.cid = CID_HintsMax;</span>
<span class="lineNum">    3640 </span><span class="lineNoCov">          0 :     hgcd[7].creator = GTextFieldCreate;</span>
<span class="lineNum">    3641 </span><span class="lineNoCov">          0 :     hharray3[1] = &amp;hgcd[7]; hharray3[2] = GCD_Glue; hharray3[3] = NULL;</span>
<span class="lineNum">    3642 </span>            : 
<span class="lineNum">    3643 </span><span class="lineNoCov">          0 :     hboxes[4].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3644 </span><span class="lineNoCov">          0 :     hboxes[4].gd.u.boxelements = hharray3;</span>
<span class="lineNum">    3645 </span><span class="lineNoCov">          0 :     hboxes[4].creator = GHBoxCreate;</span>
<span class="lineNum">    3646 </span><span class="lineNoCov">          0 :     harray[5] = &amp;hboxes[4];</span>
<span class="lineNum">    3647 </span>            : 
<span class="lineNum">    3648 </span><span class="lineNoCov">          0 :     hlabel[8].text = (unichar_t *) _(&quot;_Overlapped hints&quot;);</span>
<span class="lineNum">    3649 </span><span class="lineNoCov">          0 :     hlabel[8].text_is_1byte = true;</span>
<span class="lineNum">    3650 </span><span class="lineNoCov">          0 :     hlabel[8].text_in_resource = true;</span>
<span class="lineNum">    3651 </span><span class="lineNoCov">          0 :     hgcd[8].gd.label = &amp;hlabel[8];</span>
<span class="lineNum">    3652 </span><span class="lineNoCov">          0 :     hgcd[8].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3653 </span><span class="lineNoCov">          0 :     if ( overlappedhints ) hgcd[8].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3654 </span><span class="lineNoCov">          0 :     hgcd[8].gd.popup_msg = (unichar_t *) _(&quot;Either a glyph should have no overlapping hints,\nor a glyph with hint masks should have no overlapping\nhints within a hint mask.&quot;);</span>
<span class="lineNum">    3655 </span><span class="lineNoCov">          0 :     hgcd[8].gd.cid = CID_OverlappedHints;</span>
<span class="lineNum">    3656 </span><span class="lineNoCov">          0 :     hgcd[8].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3657 </span><span class="lineNoCov">          0 :     harray[6] = &amp;hgcd[8];</span>
<span class="lineNum">    3658 </span>            : 
<span class="lineNum">    3659 </span><span class="lineNoCov">          0 :     harray[7] = GCD_Glue; harray[8] = NULL;</span>
<span class="lineNum">    3660 </span>            : 
<span class="lineNum">    3661 </span><span class="lineNoCov">          0 :     hboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3662 </span><span class="lineNoCov">          0 :     hboxes[0].gd.u.boxelements = harray;</span>
<span class="lineNum">    3663 </span><span class="lineNoCov">          0 :     hboxes[0].creator = GVBoxCreate;</span>
<span class="lineNum">    3664 </span>            : 
<span class="lineNum">    3665 </span>            : /* ************************************************************************** */
<span class="lineNum">    3666 </span>            : 
<span class="lineNum">    3667 </span><span class="lineNoCov">          0 :     memset(&amp;rlabel,0,sizeof(rlabel));</span>
<span class="lineNum">    3668 </span><span class="lineNoCov">          0 :     memset(&amp;rgcd,0,sizeof(rgcd));</span>
<span class="lineNum">    3669 </span><span class="lineNoCov">          0 :     memset(&amp;rboxes,0,sizeof(rboxes));</span>
<span class="lineNum">    3670 </span>            : 
<span class="lineNum">    3671 </span><span class="lineNoCov">          0 :     rlabel[0].text = (unichar_t *) _(&quot;Check missing _bitmaps&quot;);</span>
<span class="lineNum">    3672 </span><span class="lineNoCov">          0 :     rlabel[0].text_is_1byte = true;</span>
<span class="lineNum">    3673 </span><span class="lineNoCov">          0 :     rlabel[0].text_in_resource = true;</span>
<span class="lineNum">    3674 </span><span class="lineNoCov">          0 :     rgcd[0].gd.label = &amp;rlabel[0];</span>
<span class="lineNum">    3675 </span><span class="lineNoCov">          0 :     rgcd[0].gd.mnemonic = 'r';</span>
<span class="lineNum">    3676 </span><span class="lineNoCov">          0 :     rgcd[0].gd.pos.x = 3; rgcd[0].gd.pos.y = 6; </span>
<span class="lineNum">    3677 </span><span class="lineNoCov">          0 :     rgcd[0].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3678 </span><span class="lineNoCov">          0 :     if ( bitmaps ) rgcd[0].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3679 </span><span class="lineNoCov">          0 :     rgcd[0].gd.popup_msg = (unichar_t *) _(&quot;Are there any outline characters which don't have a bitmap version in one of the bitmap fonts?\nConversely are there any bitmap characters without a corresponding outline character?&quot;);</span>
<span class="lineNum">    3680 </span><span class="lineNoCov">          0 :     rgcd[0].gd.cid = CID_Bitmaps;</span>
<span class="lineNum">    3681 </span><span class="lineNoCov">          0 :     rgcd[0].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3682 </span>            : 
<span class="lineNum">    3683 </span><span class="lineNoCov">          0 :     rlabel[1].text = (unichar_t *) _(&quot;Bitmap/outline _advance mismatch&quot;);</span>
<span class="lineNum">    3684 </span><span class="lineNoCov">          0 :     rlabel[1].text_is_1byte = true;</span>
<span class="lineNum">    3685 </span><span class="lineNoCov">          0 :     rlabel[1].text_in_resource = true;</span>
<span class="lineNum">    3686 </span><span class="lineNoCov">          0 :     rgcd[1].gd.label = &amp;rlabel[1];</span>
<span class="lineNum">    3687 </span><span class="lineNoCov">          0 :     rgcd[1].gd.mnemonic = 'r';</span>
<span class="lineNum">    3688 </span><span class="lineNoCov">          0 :     rgcd[1].gd.pos.x = 3; rgcd[1].gd.pos.y = 6; </span>
<span class="lineNum">    3689 </span><span class="lineNoCov">          0 :     rgcd[1].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3690 </span><span class="lineNoCov">          0 :     if ( bitmapwidths ) rgcd[1].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3691 </span><span class="lineNoCov">          0 :     rgcd[1].gd.popup_msg = (unichar_t *) _(&quot;Are there any bitmap glyphs whose advance width\nis not is expected from scaling and rounding\nthe outline's advance width?&quot;);</span>
<span class="lineNum">    3692 </span><span class="lineNoCov">          0 :     rgcd[1].gd.cid = CID_BitmapWidths;</span>
<span class="lineNum">    3693 </span><span class="lineNoCov">          0 :     rgcd[1].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3694 </span>            : 
<span class="lineNum">    3695 </span><span class="lineNoCov">          0 :     rlabel[2].text = (unichar_t *) _(&quot;Check multiple Unicode&quot;);</span>
<span class="lineNum">    3696 </span><span class="lineNoCov">          0 :     rlabel[2].text_is_1byte = true;</span>
<span class="lineNum">    3697 </span><span class="lineNoCov">          0 :     rgcd[2].gd.label = &amp;rlabel[2];</span>
<span class="lineNum">    3698 </span><span class="lineNoCov">          0 :     rgcd[2].gd.pos.x = 3; rgcd[2].gd.pos.y = rgcd[1].gd.pos.y+15; </span>
<span class="lineNum">    3699 </span><span class="lineNoCov">          0 :     rgcd[2].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3700 </span><span class="lineNoCov">          0 :     if ( multuni ) rgcd[2].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3701 </span><span class="lineNoCov">          0 :     rgcd[2].gd.popup_msg = (unichar_t *) _(&quot;Check multiple Unicode&quot;);</span>
<span class="lineNum">    3702 </span><span class="lineNoCov">          0 :     rgcd[2].gd.cid = CID_MultUni;</span>
<span class="lineNum">    3703 </span><span class="lineNoCov">          0 :     rgcd[2].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3704 </span>            : 
<span class="lineNum">    3705 </span><span class="lineNoCov">          0 :     rlabel[3].text = (unichar_t *) _(&quot;Check multiple Names&quot;);</span>
<span class="lineNum">    3706 </span><span class="lineNoCov">          0 :     rlabel[3].text_is_1byte = true;</span>
<span class="lineNum">    3707 </span><span class="lineNoCov">          0 :     rgcd[3].gd.label = &amp;rlabel[3];</span>
<span class="lineNum">    3708 </span><span class="lineNoCov">          0 :     rgcd[3].gd.pos.x = 3; rgcd[3].gd.pos.y = rgcd[2].gd.pos.y+15; </span>
<span class="lineNum">    3709 </span><span class="lineNoCov">          0 :     rgcd[3].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3710 </span><span class="lineNoCov">          0 :     if ( multname ) rgcd[3].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3711 </span><span class="lineNoCov">          0 :     rgcd[3].gd.popup_msg = (unichar_t *) _(&quot;Check for multiple characters with the same name&quot;);</span>
<span class="lineNum">    3712 </span><span class="lineNoCov">          0 :     rgcd[3].gd.cid = CID_MultName;</span>
<span class="lineNum">    3713 </span><span class="lineNoCov">          0 :     rgcd[3].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3714 </span>            : 
<span class="lineNum">    3715 </span><span class="lineNoCov">          0 :     rlabel[4].text = (unichar_t *) _(&quot;Check Unicode/Name mismatch&quot;);</span>
<span class="lineNum">    3716 </span><span class="lineNoCov">          0 :     rlabel[4].text_is_1byte = true;</span>
<span class="lineNum">    3717 </span><span class="lineNoCov">          0 :     rgcd[4].gd.label = &amp;rlabel[4];</span>
<span class="lineNum">    3718 </span><span class="lineNoCov">          0 :     rgcd[4].gd.pos.x = 3; rgcd[4].gd.pos.y = rgcd[3].gd.pos.y+15; </span>
<span class="lineNum">    3719 </span><span class="lineNoCov">          0 :     rgcd[4].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3720 </span><span class="lineNoCov">          0 :     if ( uninamemismatch ) rgcd[4].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3721 </span><span class="lineNoCov">          0 :     rgcd[4].gd.popup_msg = (unichar_t *) _(&quot;Check for characters whose name maps to a unicode code point\nwhich does not map the character's assigned code point.&quot;);</span>
<span class="lineNum">    3722 </span><span class="lineNoCov">          0 :     rgcd[4].gd.cid = CID_UniNameMisMatch;</span>
<span class="lineNum">    3723 </span><span class="lineNoCov">          0 :     rgcd[4].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3724 </span>            : 
<span class="lineNum">    3725 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;=4; ++i )</span>
<span class="lineNum">    3726 </span><span class="lineNoCov">          0 :         rarray[i] = &amp;rgcd[i];</span>
<span class="lineNum">    3727 </span><span class="lineNoCov">          0 :     rarray[i++] = GCD_Glue; rarray[i++] = NULL;</span>
<span class="lineNum">    3728 </span>            : 
<span class="lineNum">    3729 </span><span class="lineNoCov">          0 :     rboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3730 </span><span class="lineNoCov">          0 :     rboxes[0].gd.u.boxelements = rarray;</span>
<span class="lineNum">    3731 </span><span class="lineNoCov">          0 :     rboxes[0].creator = GVBoxCreate;</span>
<span class="lineNum">    3732 </span>            : 
<span class="lineNum">    3733 </span>            : /* ************************************************************************** */
<span class="lineNum">    3734 </span>            : 
<span class="lineNum">    3735 </span><span class="lineNoCov">          0 :     memset(&amp;bblabel,0,sizeof(bblabel));</span>
<span class="lineNum">    3736 </span><span class="lineNoCov">          0 :     memset(&amp;bbgcd,0,sizeof(bbgcd));</span>
<span class="lineNum">    3737 </span><span class="lineNoCov">          0 :     memset(&amp;bbboxes,0,sizeof(bbboxes));</span>
<span class="lineNum">    3738 </span>            : 
<span class="lineNum">    3739 </span><span class="lineNoCov">          0 :     bblabel[0].text = (unichar_t *) _(&quot;Glyph BB Above&quot;);</span>
<span class="lineNum">    3740 </span><span class="lineNoCov">          0 :     bblabel[0].text_is_1byte = true;</span>
<span class="lineNum">    3741 </span><span class="lineNoCov">          0 :     bblabel[0].text_in_resource = true;</span>
<span class="lineNum">    3742 </span><span class="lineNoCov">          0 :     bbgcd[0].gd.label = &amp;bblabel[0];</span>
<span class="lineNum">    3743 </span><span class="lineNoCov">          0 :     bbgcd[0].gd.mnemonic = 'r';</span>
<span class="lineNum">    3744 </span><span class="lineNoCov">          0 :     bbgcd[0].gd.pos.x = 3; bbgcd[0].gd.pos.y = 6; </span>
<span class="lineNum">    3745 </span><span class="lineNoCov">          0 :     bbgcd[0].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3746 </span><span class="lineNoCov">          0 :     if ( bbymax ) bbgcd[0].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3747 </span><span class="lineNoCov">          0 :     bbgcd[0].gd.popup_msg = (unichar_t *) _(&quot;Are there any glyph's whose bounding boxes extend above this number?&quot;);</span>
<span class="lineNum">    3748 </span><span class="lineNoCov">          0 :     bbgcd[0].gd.cid = CID_BBYMax;</span>
<span class="lineNum">    3749 </span><span class="lineNoCov">          0 :     bbgcd[0].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3750 </span>            : 
<span class="lineNum">    3751 </span><span class="lineNoCov">          0 :     sf = p.fv-&gt;b.sf;</span>
<span class="lineNum">    3752 </span><span class="lineNoCov">          0 :     if ( lastsf!=sf ) {</span>
<span class="lineNum">    3753 </span><span class="lineNoCov">          0 :         bbymax_val = bbymin_val = bbxmax_val /* = bbxmin_val */= vadvancewidth = advancewidth = 0;</span>
<span class="lineNum">    3754 </span>            :     }
<span class="lineNum">    3755 </span>            : 
<span class="lineNum">    3756 </span><span class="lineNoCov">          0 :     sprintf(yymaxbuf,&quot;%g&quot;, bbymax_val!=0 ? bbymax_val : sf-&gt;ascent);</span>
<span class="lineNum">    3757 </span><span class="lineNoCov">          0 :     bblabel[1].text = (unichar_t *) yymaxbuf;</span>
<span class="lineNum">    3758 </span><span class="lineNoCov">          0 :     bblabel[1].text_is_1byte = true;</span>
<span class="lineNum">    3759 </span><span class="lineNoCov">          0 :     bbgcd[1].gd.label = &amp;bblabel[1];</span>
<span class="lineNum">    3760 </span><span class="lineNoCov">          0 :     bbgcd[1].gd.pos.x = 100+15; bbgcd[1].gd.pos.y = bbgcd[0].gd.pos.y-1; bbgcd[1].gd.pos.width = 40;</span>
<span class="lineNum">    3761 </span><span class="lineNoCov">          0 :     bbgcd[1].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    3762 </span><span class="lineNoCov">          0 :     bbgcd[1].gd.cid = CID_BBYMaxVal;</span>
<span class="lineNum">    3763 </span><span class="lineNoCov">          0 :     bbgcd[1].gd.handle_controlevent = Prob_TextChanged;</span>
<span class="lineNum">    3764 </span><span class="lineNoCov">          0 :     bbgcd[1].data = (void *) CID_BBYMax;</span>
<span class="lineNum">    3765 </span><span class="lineNoCov">          0 :     bbgcd[1].creator = GTextFieldCreate;</span>
<span class="lineNum">    3766 </span><span class="lineNoCov">          0 :     bbarray[0][0] = &amp;bbgcd[0]; bbarray[0][1] = &amp;bbgcd[1]; bbarray[0][2] = GCD_Glue; bbarray[0][3] = NULL;</span>
<span class="lineNum">    3767 </span>            : 
<span class="lineNum">    3768 </span><span class="lineNoCov">          0 :     bblabel[2].text = (unichar_t *) _(&quot;Glyph BB Below&quot;);</span>
<span class="lineNum">    3769 </span><span class="lineNoCov">          0 :     bblabel[2].text_is_1byte = true;</span>
<span class="lineNum">    3770 </span><span class="lineNoCov">          0 :     bblabel[2].text_in_resource = true;</span>
<span class="lineNum">    3771 </span><span class="lineNoCov">          0 :     bbgcd[2].gd.label = &amp;bblabel[2];</span>
<span class="lineNum">    3772 </span><span class="lineNoCov">          0 :     bbgcd[2].gd.mnemonic = 'r';</span>
<span class="lineNum">    3773 </span><span class="lineNoCov">          0 :     bbgcd[2].gd.pos.x = 3; bbgcd[2].gd.pos.y = bbgcd[0].gd.pos.y+21; </span>
<span class="lineNum">    3774 </span><span class="lineNoCov">          0 :     bbgcd[2].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3775 </span><span class="lineNoCov">          0 :     if ( bbymin ) bbgcd[2].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3776 </span><span class="lineNoCov">          0 :     bbgcd[2].gd.popup_msg = (unichar_t *) _(&quot;Are there any glyph's whose bounding boxes extend below this number?&quot;);</span>
<span class="lineNum">    3777 </span><span class="lineNoCov">          0 :     bbgcd[2].gd.cid = CID_BBYMin;</span>
<span class="lineNum">    3778 </span><span class="lineNoCov">          0 :     bbgcd[2].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3779 </span>            : 
<span class="lineNum">    3780 </span><span class="lineNoCov">          0 :     sprintf(yyminbuf,&quot;%g&quot;, bbymin_val!=0 ? bbymin_val : -sf-&gt;descent);</span>
<span class="lineNum">    3781 </span><span class="lineNoCov">          0 :     bblabel[3].text = (unichar_t *) yyminbuf;</span>
<span class="lineNum">    3782 </span><span class="lineNoCov">          0 :     bblabel[3].text_is_1byte = true;</span>
<span class="lineNum">    3783 </span><span class="lineNoCov">          0 :     bbgcd[3].gd.label = &amp;bblabel[3];</span>
<span class="lineNum">    3784 </span><span class="lineNoCov">          0 :     bbgcd[3].gd.pos.x = 100+15; bbgcd[3].gd.pos.y = bbgcd[2].gd.pos.y-1; bbgcd[3].gd.pos.width = 40;</span>
<span class="lineNum">    3785 </span><span class="lineNoCov">          0 :     bbgcd[3].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    3786 </span><span class="lineNoCov">          0 :     bbgcd[3].gd.cid = CID_BBYMinVal;</span>
<span class="lineNum">    3787 </span><span class="lineNoCov">          0 :     bbgcd[3].gd.handle_controlevent = Prob_TextChanged;</span>
<span class="lineNum">    3788 </span><span class="lineNoCov">          0 :     bbgcd[3].data = (void *) CID_BBYMin;</span>
<span class="lineNum">    3789 </span><span class="lineNoCov">          0 :     bbgcd[3].creator = GTextFieldCreate;</span>
<span class="lineNum">    3790 </span><span class="lineNoCov">          0 :     bbarray[1][0] = &amp;bbgcd[2]; bbarray[1][1] = &amp;bbgcd[3]; bbarray[1][2] = GCD_Glue; bbarray[1][3] = NULL;</span>
<span class="lineNum">    3791 </span>            : 
<span class="lineNum">    3792 </span><span class="lineNoCov">          0 :     bblabel[4].text = (unichar_t *) _(&quot;Glyph BB Right Of&quot;);</span>
<span class="lineNum">    3793 </span><span class="lineNoCov">          0 :     bblabel[4].text_is_1byte = true;</span>
<span class="lineNum">    3794 </span><span class="lineNoCov">          0 :     bblabel[4].text_in_resource = true;</span>
<span class="lineNum">    3795 </span><span class="lineNoCov">          0 :     bbgcd[4].gd.label = &amp;bblabel[4];</span>
<span class="lineNum">    3796 </span><span class="lineNoCov">          0 :     bbgcd[4].gd.pos.x = 3; bbgcd[4].gd.pos.y = bbgcd[2].gd.pos.y+21; </span>
<span class="lineNum">    3797 </span><span class="lineNoCov">          0 :     bbgcd[4].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3798 </span><span class="lineNoCov">          0 :     if ( bbxmax ) bbgcd[4].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3799 </span><span class="lineNoCov">          0 :     bbgcd[4].gd.popup_msg = (unichar_t *) _(&quot;Are there any glyphs whose bounding boxes extend to the right of this number?&quot;);</span>
<span class="lineNum">    3800 </span><span class="lineNoCov">          0 :     bbgcd[4].gd.cid = CID_BBXMax;</span>
<span class="lineNum">    3801 </span><span class="lineNoCov">          0 :     bbgcd[4].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3802 </span>            : 
<span class="lineNum">    3803 </span><span class="lineNoCov">          0 :     sprintf(xxmaxbuf,&quot;%g&quot;, bbxmax_val!=0 ? bbxmax_val : (double) (sf-&gt;ascent+sf-&gt;descent));</span>
<span class="lineNum">    3804 </span><span class="lineNoCov">          0 :     bblabel[5].text = (unichar_t *) xxmaxbuf;</span>
<span class="lineNum">    3805 </span><span class="lineNoCov">          0 :     bblabel[5].text_is_1byte = true;</span>
<span class="lineNum">    3806 </span><span class="lineNoCov">          0 :     bbgcd[5].gd.label = &amp;bblabel[5];</span>
<span class="lineNum">    3807 </span><span class="lineNoCov">          0 :     bbgcd[5].gd.pos.x = 100+15; bbgcd[5].gd.pos.y = bbgcd[4].gd.pos.y-1; bbgcd[5].gd.pos.width = 40;</span>
<span class="lineNum">    3808 </span><span class="lineNoCov">          0 :     bbgcd[5].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    3809 </span><span class="lineNoCov">          0 :     bbgcd[5].gd.cid = CID_BBXMaxVal;</span>
<span class="lineNum">    3810 </span><span class="lineNoCov">          0 :     bbgcd[5].gd.handle_controlevent = Prob_TextChanged;</span>
<span class="lineNum">    3811 </span><span class="lineNoCov">          0 :     bbgcd[5].data = (void *) CID_BBXMax;</span>
<span class="lineNum">    3812 </span><span class="lineNoCov">          0 :     bbgcd[5].creator = GTextFieldCreate;</span>
<span class="lineNum">    3813 </span><span class="lineNoCov">          0 :     bbarray[2][0] = &amp;bbgcd[4]; bbarray[2][1] = &amp;bbgcd[5]; bbarray[2][2] = GCD_Glue; bbarray[2][3] = NULL;</span>
<span class="lineNum">    3814 </span>            : 
<span class="lineNum">    3815 </span><span class="lineNoCov">          0 :     bblabel[6].text = (unichar_t *) _(&quot;Glyph BB Left Of&quot;);</span>
<span class="lineNum">    3816 </span><span class="lineNoCov">          0 :     bblabel[6].text_is_1byte = true;</span>
<span class="lineNum">    3817 </span><span class="lineNoCov">          0 :     bblabel[6].text_in_resource = true;</span>
<span class="lineNum">    3818 </span><span class="lineNoCov">          0 :     bbgcd[6].gd.label = &amp;bblabel[6];</span>
<span class="lineNum">    3819 </span><span class="lineNoCov">          0 :     bbgcd[6].gd.pos.x = 3; bbgcd[6].gd.pos.y = bbgcd[4].gd.pos.y+21; </span>
<span class="lineNum">    3820 </span><span class="lineNoCov">          0 :     bbgcd[6].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3821 </span><span class="lineNoCov">          0 :     if ( bbxmin ) bbgcd[6].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3822 </span><span class="lineNoCov">          0 :     bbgcd[6].gd.popup_msg = (unichar_t *) _(&quot;Are there any glyph's whose bounding boxes extend to the left of this number?&quot;);</span>
<span class="lineNum">    3823 </span><span class="lineNoCov">          0 :     bbgcd[6].gd.cid = CID_BBXMin;</span>
<span class="lineNum">    3824 </span><span class="lineNoCov">          0 :     bbgcd[6].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3825 </span>            : 
<span class="lineNum">    3826 </span><span class="lineNoCov">          0 :     sprintf(xxminbuf,&quot;%g&quot;,bbxmin_val);</span>
<span class="lineNum">    3827 </span><span class="lineNoCov">          0 :     bblabel[7].text = (unichar_t *) xxminbuf;</span>
<span class="lineNum">    3828 </span><span class="lineNoCov">          0 :     bblabel[7].text_is_1byte = true;</span>
<span class="lineNum">    3829 </span><span class="lineNoCov">          0 :     bbgcd[7].gd.label = &amp;bblabel[7];</span>
<span class="lineNum">    3830 </span><span class="lineNoCov">          0 :     bbgcd[7].gd.pos.x = 100+15; bbgcd[7].gd.pos.y = bbgcd[6].gd.pos.y-1; bbgcd[7].gd.pos.width = 40;</span>
<span class="lineNum">    3831 </span><span class="lineNoCov">          0 :     bbgcd[7].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    3832 </span><span class="lineNoCov">          0 :     bbgcd[7].gd.cid = CID_BBXMinVal;</span>
<span class="lineNum">    3833 </span><span class="lineNoCov">          0 :     bbgcd[7].gd.handle_controlevent = Prob_TextChanged;</span>
<span class="lineNum">    3834 </span><span class="lineNoCov">          0 :     bbgcd[7].data = (void *) CID_BBXMin;</span>
<span class="lineNum">    3835 </span><span class="lineNoCov">          0 :     bbgcd[7].creator = GTextFieldCreate;</span>
<span class="lineNum">    3836 </span><span class="lineNoCov">          0 :     bbarray[3][0] = &amp;bbgcd[6]; bbarray[3][1] = &amp;bbgcd[7]; bbarray[3][2] = GCD_Glue; bbarray[3][3] = NULL;</span>
<span class="lineNum">    3837 </span>            : 
<span class="lineNum">    3838 </span><span class="lineNoCov">          0 :     bblabel[8].text = (unichar_t *) _(&quot;Check Advance:&quot;);</span>
<span class="lineNum">    3839 </span><span class="lineNoCov">          0 :     bblabel[8].text_is_1byte = true;</span>
<span class="lineNum">    3840 </span><span class="lineNoCov">          0 :     bblabel[8].text_in_resource = true;</span>
<span class="lineNum">    3841 </span><span class="lineNoCov">          0 :     bbgcd[8].gd.label = &amp;bblabel[8];</span>
<span class="lineNum">    3842 </span><span class="lineNoCov">          0 :     bbgcd[8].gd.mnemonic = 'W';</span>
<span class="lineNum">    3843 </span><span class="lineNoCov">          0 :     bbgcd[8].gd.pos.x = 3; bbgcd[8].gd.pos.y = bbgcd[6].gd.pos.y+21;</span>
<span class="lineNum">    3844 </span><span class="lineNoCov">          0 :     bbgcd[8].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3845 </span><span class="lineNoCov">          0 :     if ( advancewidth ) bbgcd[8].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3846 </span><span class="lineNoCov">          0 :     bbgcd[8].gd.popup_msg = (unichar_t *) _(&quot;Check for characters whose advance width is not the displayed value.&quot;);</span>
<span class="lineNum">    3847 </span><span class="lineNoCov">          0 :     bbgcd[8].gd.cid = CID_AdvanceWidth;</span>
<span class="lineNum">    3848 </span><span class="lineNoCov">          0 :     bbgcd[8].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3849 </span>            : 
<span class="lineNum">    3850 </span><span class="lineNoCov">          0 :     if ( ( ssc = SFGetChar(sf,' ',NULL))!=NULL )</span>
<span class="lineNum">    3851 </span><span class="lineNoCov">          0 :         advancewidthval = ssc-&gt;width;</span>
<span class="lineNum">    3852 </span><span class="lineNoCov">          0 :     sprintf(awidthbuf,&quot;%g&quot;,advancewidthval);</span>
<span class="lineNum">    3853 </span><span class="lineNoCov">          0 :     bblabel[9].text = (unichar_t *) awidthbuf;</span>
<span class="lineNum">    3854 </span><span class="lineNoCov">          0 :     bblabel[9].text_is_1byte = true;</span>
<span class="lineNum">    3855 </span><span class="lineNoCov">          0 :     bbgcd[9].gd.label = &amp;bblabel[9];</span>
<span class="lineNum">    3856 </span><span class="lineNoCov">          0 :     bbgcd[9].gd.pos.x = 100+15; bbgcd[9].gd.pos.y = bbgcd[8].gd.pos.y-1; bbgcd[9].gd.pos.width = 40;</span>
<span class="lineNum">    3857 </span><span class="lineNoCov">          0 :     bbgcd[9].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    3858 </span><span class="lineNoCov">          0 :     bbgcd[9].gd.cid = CID_AdvanceWidthVal;</span>
<span class="lineNum">    3859 </span><span class="lineNoCov">          0 :     bbgcd[9].gd.handle_controlevent = Prob_TextChanged;</span>
<span class="lineNum">    3860 </span><span class="lineNoCov">          0 :     bbgcd[9].data = (void *) CID_AdvanceWidth;</span>
<span class="lineNum">    3861 </span><span class="lineNoCov">          0 :     bbgcd[9].creator = GTextFieldCreate;</span>
<span class="lineNum">    3862 </span><span class="lineNoCov">          0 :     bbarray[4][0] = &amp;bbgcd[8]; bbarray[4][1] = &amp;bbgcd[9]; bbarray[4][2] = GCD_Glue; bbarray[4][3] = NULL;</span>
<span class="lineNum">    3863 </span>            : 
<span class="lineNum">    3864 </span><span class="lineNoCov">          0 :     bblabel[10].text = (unichar_t *) _(&quot;Check VAdvance:\n&quot;);</span>
<span class="lineNum">    3865 </span><span class="lineNoCov">          0 :     bblabel[10].text_is_1byte = true;</span>
<span class="lineNum">    3866 </span><span class="lineNoCov">          0 :     bbgcd[10].gd.label = &amp;bblabel[10];</span>
<span class="lineNum">    3867 </span><span class="lineNoCov">          0 :     bbgcd[10].gd.mnemonic = 'W';</span>
<span class="lineNum">    3868 </span><span class="lineNoCov">          0 :     bbgcd[10].gd.pos.x = 3; bbgcd[10].gd.pos.y = bbgcd[9].gd.pos.y+24;</span>
<span class="lineNum">    3869 </span><span class="lineNoCov">          0 :     bbgcd[10].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3870 </span><span class="lineNoCov">          0 :     if ( !sf-&gt;hasvmetrics ) bbgcd[10].gd.flags = gg_visible;</span>
<span class="lineNum">    3871 </span><span class="lineNoCov">          0 :     else if ( vadvancewidth ) bbgcd[10].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3872 </span><span class="lineNoCov">          0 :     bbgcd[10].gd.popup_msg = (unichar_t *) _(&quot;Check for characters whose vertical advance width is not the displayed value.&quot;);</span>
<span class="lineNum">    3873 </span><span class="lineNoCov">          0 :     bbgcd[10].gd.cid = CID_VAdvanceWidth;</span>
<span class="lineNum">    3874 </span><span class="lineNoCov">          0 :     bbgcd[10].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3875 </span>            : 
<span class="lineNum">    3876 </span><span class="lineNoCov">          0 :     if ( vadvancewidth==0 ) vadvancewidth = sf-&gt;ascent+sf-&gt;descent;</span>
<span class="lineNum">    3877 </span><span class="lineNoCov">          0 :     sprintf(vawidthbuf,&quot;%g&quot;,vadvancewidthval);</span>
<span class="lineNum">    3878 </span><span class="lineNoCov">          0 :     bblabel[11].text = (unichar_t *) vawidthbuf;</span>
<span class="lineNum">    3879 </span><span class="lineNoCov">          0 :     bblabel[11].text_is_1byte = true;</span>
<span class="lineNum">    3880 </span><span class="lineNoCov">          0 :     bbgcd[11].gd.label = &amp;bblabel[11];</span>
<span class="lineNum">    3881 </span><span class="lineNoCov">          0 :     bbgcd[11].gd.pos.x = 100+15; bbgcd[11].gd.pos.y = bbgcd[10].gd.pos.y-1; bbgcd[11].gd.pos.width = 40;</span>
<span class="lineNum">    3882 </span><span class="lineNoCov">          0 :     bbgcd[11].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    3883 </span><span class="lineNoCov">          0 :     if ( !sf-&gt;hasvmetrics ) bbgcd[11].gd.flags = gg_visible;</span>
<span class="lineNum">    3884 </span><span class="lineNoCov">          0 :     bbgcd[11].gd.cid = CID_VAdvanceWidthVal;</span>
<span class="lineNum">    3885 </span><span class="lineNoCov">          0 :     bbgcd[11].gd.handle_controlevent = Prob_TextChanged;</span>
<span class="lineNum">    3886 </span><span class="lineNoCov">          0 :     bbgcd[11].data = (void *) CID_VAdvanceWidth;</span>
<span class="lineNum">    3887 </span><span class="lineNoCov">          0 :     bbgcd[11].creator = GTextFieldCreate;</span>
<span class="lineNum">    3888 </span><span class="lineNoCov">          0 :     bbarray[5][0] = &amp;bbgcd[10]; bbarray[5][1] = &amp;bbgcd[11]; bbarray[5][2] = GCD_Glue; bbarray[5][3] = NULL;</span>
<span class="lineNum">    3889 </span><span class="lineNoCov">          0 :     bbarray[6][0] = GCD_Glue; bbarray[6][1] = GCD_Glue; bbarray[6][2] = GCD_Glue; bbarray[6][3] = NULL;</span>
<span class="lineNum">    3890 </span><span class="lineNoCov">          0 :     bbarray[7][0] = NULL;</span>
<span class="lineNum">    3891 </span>            : 
<span class="lineNum">    3892 </span><span class="lineNoCov">          0 :     bbboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3893 </span><span class="lineNoCov">          0 :     bbboxes[0].gd.u.boxelements = bbarray[0];</span>
<span class="lineNum">    3894 </span><span class="lineNoCov">          0 :     bbboxes[0].creator = GHVBoxCreate;</span>
<span class="lineNum">    3895 </span>            : 
<span class="lineNum">    3896 </span>            : /* ************************************************************************** */
<span class="lineNum">    3897 </span>            : 
<span class="lineNum">    3898 </span><span class="lineNoCov">          0 :     memset(&amp;clabel,0,sizeof(clabel));</span>
<span class="lineNum">    3899 </span><span class="lineNoCov">          0 :     memset(&amp;cgcd,0,sizeof(cgcd));</span>
<span class="lineNum">    3900 </span><span class="lineNoCov">          0 :     memset(&amp;cboxes,0,sizeof(cboxes));</span>
<span class="lineNum">    3901 </span>            : 
<span class="lineNum">    3902 </span><span class="lineNoCov">          0 :     clabel[0].text = (unichar_t *) _(&quot;Check for CIDs defined _twice&quot;);</span>
<span class="lineNum">    3903 </span><span class="lineNoCov">          0 :     clabel[0].text_is_1byte = true;</span>
<span class="lineNum">    3904 </span><span class="lineNoCov">          0 :     clabel[0].text_in_resource = true;</span>
<span class="lineNum">    3905 </span><span class="lineNoCov">          0 :     cgcd[0].gd.label = &amp;clabel[0];</span>
<span class="lineNum">    3906 </span><span class="lineNoCov">          0 :     cgcd[0].gd.mnemonic = 'S';</span>
<span class="lineNum">    3907 </span><span class="lineNoCov">          0 :     cgcd[0].gd.pos.x = 3; cgcd[0].gd.pos.y = 6;</span>
<span class="lineNum">    3908 </span><span class="lineNoCov">          0 :     cgcd[0].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3909 </span><span class="lineNoCov">          0 :     if ( cidmultiple ) cgcd[0].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3910 </span><span class="lineNoCov">          0 :     cgcd[0].gd.popup_msg = (unichar_t *) _(&quot;Check whether a CID is defined in more than one sub-font&quot;);</span>
<span class="lineNum">    3911 </span><span class="lineNoCov">          0 :     cgcd[0].gd.cid = CID_CIDMultiple;</span>
<span class="lineNum">    3912 </span><span class="lineNoCov">          0 :     cgcd[0].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3913 </span><span class="lineNoCov">          0 :     carray[0] = &amp;cgcd[0];</span>
<span class="lineNum">    3914 </span>            : 
<span class="lineNum">    3915 </span><span class="lineNoCov">          0 :     clabel[1].text = (unichar_t *) _(&quot;Check for _undefined CIDs&quot;);</span>
<span class="lineNum">    3916 </span><span class="lineNoCov">          0 :     clabel[1].text_is_1byte = true;</span>
<span class="lineNum">    3917 </span><span class="lineNoCov">          0 :     clabel[1].text_in_resource = true;</span>
<span class="lineNum">    3918 </span><span class="lineNoCov">          0 :     cgcd[1].gd.label = &amp;clabel[1];</span>
<span class="lineNum">    3919 </span><span class="lineNoCov">          0 :     cgcd[1].gd.mnemonic = 'S';</span>
<span class="lineNum">    3920 </span><span class="lineNoCov">          0 :     cgcd[1].gd.pos.x = 3; cgcd[1].gd.pos.y = cgcd[0].gd.pos.y+17; </span>
<span class="lineNum">    3921 </span><span class="lineNoCov">          0 :     cgcd[1].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3922 </span><span class="lineNoCov">          0 :     if ( cidblank ) cgcd[1].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3923 </span><span class="lineNoCov">          0 :     cgcd[1].gd.popup_msg = (unichar_t *) _(&quot;Check whether a CID is undefined in all sub-fonts&quot;);</span>
<span class="lineNum">    3924 </span><span class="lineNoCov">          0 :     cgcd[1].gd.cid = CID_CIDBlank;</span>
<span class="lineNum">    3925 </span><span class="lineNoCov">          0 :     cgcd[1].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3926 </span><span class="lineNoCov">          0 :     carray[1] = &amp;cgcd[1]; carray[2] = GCD_Glue; carray[3] = NULL;</span>
<span class="lineNum">    3927 </span>            : 
<span class="lineNum">    3928 </span><span class="lineNoCov">          0 :     cboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3929 </span><span class="lineNoCov">          0 :     cboxes[0].gd.u.boxelements = carray;</span>
<span class="lineNum">    3930 </span><span class="lineNoCov">          0 :     cboxes[0].creator = GVBoxCreate;</span>
<span class="lineNum">    3931 </span>            : 
<span class="lineNum">    3932 </span>            : /* ************************************************************************** */
<span class="lineNum">    3933 </span>            : 
<span class="lineNum">    3934 </span><span class="lineNoCov">          0 :     memset(&amp;alabel,0,sizeof(alabel));</span>
<span class="lineNum">    3935 </span><span class="lineNoCov">          0 :     memset(&amp;agcd,0,sizeof(agcd));</span>
<span class="lineNum">    3936 </span><span class="lineNoCov">          0 :     memset(&amp;aboxes,0,sizeof(aboxes));</span>
<span class="lineNum">    3937 </span>            : 
<span class="lineNum">    3938 </span><span class="lineNoCov">          0 :     alabel[0].text = (unichar_t *) _(&quot;Check for missing _glyph names&quot;);</span>
<span class="lineNum">    3939 </span><span class="lineNoCov">          0 :     alabel[0].text_is_1byte = true;</span>
<span class="lineNum">    3940 </span><span class="lineNoCov">          0 :     alabel[0].text_in_resource = true;</span>
<span class="lineNum">    3941 </span><span class="lineNoCov">          0 :     agcd[0].gd.label = &amp;alabel[0];</span>
<span class="lineNum">    3942 </span><span class="lineNoCov">          0 :     agcd[0].gd.pos.x = 3; agcd[0].gd.pos.y = 6;</span>
<span class="lineNum">    3943 </span><span class="lineNoCov">          0 :     agcd[0].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3944 </span><span class="lineNoCov">          0 :     if ( missingglyph ) agcd[0].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3945 </span><span class="lineNoCov">          0 :     agcd[0].gd.popup_msg = (unichar_t *) _(&quot;Check whether a substitution, kerning class, etc. uses a glyph name which does not match any glyph in the font&quot;);</span>
<span class="lineNum">    3946 </span><span class="lineNoCov">          0 :     agcd[0].gd.cid = CID_MissingGlyph;</span>
<span class="lineNum">    3947 </span><span class="lineNoCov">          0 :     agcd[0].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3948 </span><span class="lineNoCov">          0 :     aarray[0] = &amp;agcd[0];</span>
<span class="lineNum">    3949 </span>            : 
<span class="lineNum">    3950 </span><span class="lineNoCov">          0 :     alabel[1].text = (unichar_t *) _(&quot;Check for missing _scripts in features&quot;);</span>
<span class="lineNum">    3951 </span><span class="lineNoCov">          0 :     alabel[1].text_is_1byte = true;</span>
<span class="lineNum">    3952 </span><span class="lineNoCov">          0 :     alabel[1].text_in_resource = true;</span>
<span class="lineNum">    3953 </span><span class="lineNoCov">          0 :     agcd[1].gd.label = &amp;alabel[1];</span>
<span class="lineNum">    3954 </span><span class="lineNoCov">          0 :     agcd[1].gd.pos.x = 3; agcd[1].gd.pos.y = agcd[0].gd.pos.y+14;</span>
<span class="lineNum">    3955 </span><span class="lineNoCov">          0 :     agcd[1].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3956 </span><span class="lineNoCov">          0 :     if ( missingscriptinfeature ) agcd[1].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3957 </span><span class="lineNoCov">          0 :     agcd[1].gd.popup_msg = (unichar_t *) _(</span>
<span class="lineNum">    3958 </span>            :             &quot;In every lookup that uses a glyph, check that at\n&quot;
<span class="lineNum">    3959 </span>            :             &quot;least one feature is active for the glyph's script.&quot;);
<span class="lineNum">    3960 </span><span class="lineNoCov">          0 :     agcd[1].gd.cid = CID_MissingScriptInFeature;</span>
<span class="lineNum">    3961 </span><span class="lineNoCov">          0 :     agcd[1].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3962 </span><span class="lineNoCov">          0 :     aarray[1] = &amp;agcd[1];</span>
<span class="lineNum">    3963 </span>            : 
<span class="lineNum">    3964 </span><span class="lineNoCov">          0 :     alabel[2].text = (unichar_t *) _(&quot;Check substitutions for empty chars&quot;);</span>
<span class="lineNum">    3965 </span><span class="lineNoCov">          0 :     alabel[2].text_is_1byte = true;</span>
<span class="lineNum">    3966 </span><span class="lineNoCov">          0 :     agcd[2].gd.label = &amp;alabel[2];</span>
<span class="lineNum">    3967 </span><span class="lineNoCov">          0 :     agcd[2].gd.pos.x = 3; agcd[2].gd.pos.y = agcd[1].gd.pos.y+15; </span>
<span class="lineNum">    3968 </span><span class="lineNoCov">          0 :     agcd[2].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3969 </span><span class="lineNoCov">          0 :     if ( badsubs ) agcd[2].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3970 </span><span class="lineNoCov">          0 :     agcd[2].gd.popup_msg = (unichar_t *) _(&quot;Check for characters which contain 'GSUB' entries which refer to empty characters&quot;);</span>
<span class="lineNum">    3971 </span><span class="lineNoCov">          0 :     agcd[2].gd.cid = CID_BadSubs;</span>
<span class="lineNum">    3972 </span><span class="lineNoCov">          0 :     agcd[2].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3973 </span><span class="lineNoCov">          0 :     aarray[2] = &amp;agcd[2];</span>
<span class="lineNum">    3974 </span>            : 
<span class="lineNum">    3975 </span><span class="lineNoCov">          0 :     alabel[3].text = (unichar_t *) _(&quot;Check for incomplete mark to base subtables&quot;);</span>
<span class="lineNum">    3976 </span><span class="lineNoCov">          0 :     alabel[3].text_is_1byte = true;</span>
<span class="lineNum">    3977 </span><span class="lineNoCov">          0 :     agcd[3].gd.label = &amp;alabel[3];</span>
<span class="lineNum">    3978 </span><span class="lineNoCov">          0 :     agcd[3].gd.pos.x = 3; agcd[3].gd.pos.y = agcd[1].gd.pos.y+15; </span>
<span class="lineNum">    3979 </span><span class="lineNoCov">          0 :     agcd[3].gd.flags = gg_visible | gg_enabled | gg_utf8_popup;</span>
<span class="lineNum">    3980 </span><span class="lineNoCov">          0 :     if ( missinganchor ) agcd[3].gd.flags |= gg_cb_on;</span>
<span class="lineNum">    3981 </span><span class="lineNoCov">          0 :     agcd[3].gd.popup_msg = (unichar_t *) _(</span>
<span class="lineNum">    3982 </span>            :         &quot;The OpenType documentation suggests in a rather confusing way\n&quot;
<span class="lineNum">    3983 </span>            :         &quot;that if a base glyph (or base mark) contains an anchor point\n&quot;
<span class="lineNum">    3984 </span>            :         &quot;for one class in a lookup subtable, then it should contain\n&quot;
<span class="lineNum">    3985 </span>            :         &quot;anchors for all classes in the subtable&quot; );
<span class="lineNum">    3986 </span><span class="lineNoCov">          0 :     agcd[3].gd.cid = CID_MissingAnchor;</span>
<span class="lineNum">    3987 </span><span class="lineNoCov">          0 :     agcd[3].creator = GCheckBoxCreate;</span>
<span class="lineNum">    3988 </span><span class="lineNoCov">          0 :     aarray[3] = &amp;agcd[3]; aarray[4] = GCD_Glue; aarray[5] = NULL;</span>
<span class="lineNum">    3989 </span>            : 
<span class="lineNum">    3990 </span><span class="lineNoCov">          0 :     aboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    3991 </span><span class="lineNoCov">          0 :     aboxes[0].gd.u.boxelements = aarray;</span>
<span class="lineNum">    3992 </span><span class="lineNoCov">          0 :     aboxes[0].creator = GVBoxCreate;</span>
<span class="lineNum">    3993 </span>            : 
<span class="lineNum">    3994 </span>            : /* ************************************************************************** */
<span class="lineNum">    3995 </span>            : 
<span class="lineNum">    3996 </span><span class="lineNoCov">          0 :     memset(&amp;mlabel,0,sizeof(mlabel));</span>
<span class="lineNum">    3997 </span><span class="lineNoCov">          0 :     memset(&amp;mgcd,0,sizeof(mgcd));</span>
<span class="lineNum">    3998 </span><span class="lineNoCov">          0 :     memset(&amp;mboxes,0,sizeof(mboxes));</span>
<span class="lineNum">    3999 </span><span class="lineNoCov">          0 :     memset(aspects,0,sizeof(aspects));</span>
<span class="lineNum">    4000 </span><span class="lineNoCov">          0 :     i = 0;</span>
<span class="lineNum">    4001 </span>            : 
<span class="lineNum">    4002 </span><span class="lineNoCov">          0 :     aspects[i].text = (unichar_t *) _(&quot;Points&quot;);</span>
<span class="lineNum">    4003 </span><span class="lineNoCov">          0 :     aspects[i].selected = true;</span>
<span class="lineNum">    4004 </span><span class="lineNoCov">          0 :     aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4005 </span><span class="lineNoCov">          0 :     aspects[i++].gcd = pboxes;</span>
<span class="lineNum">    4006 </span>            : 
<span class="lineNum">    4007 </span><span class="lineNoCov">          0 :     aspects[i].text = (unichar_t *) _(&quot;Paths&quot;);</span>
<span class="lineNum">    4008 </span><span class="lineNoCov">          0 :     aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4009 </span><span class="lineNoCov">          0 :     aspects[i++].gcd = paboxes;</span>
<span class="lineNum">    4010 </span>            : 
<span class="lineNum">    4011 </span>            : /* GT: Refs is an abbreviation for References. Space is tight here */
<span class="lineNum">    4012 </span><span class="lineNoCov">          0 :     aspects[i].text = (unichar_t *) _(&quot;Refs&quot;);</span>
<span class="lineNum">    4013 </span><span class="lineNoCov">          0 :     aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4014 </span><span class="lineNoCov">          0 :     aspects[i++].gcd = rfboxes;</span>
<span class="lineNum">    4015 </span>            : 
<span class="lineNum">    4016 </span><span class="lineNoCov">          0 :     aspects[i].text = (unichar_t *) _(&quot;Hints&quot;);</span>
<span class="lineNum">    4017 </span><span class="lineNoCov">          0 :     aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4018 </span><span class="lineNoCov">          0 :     aspects[i++].gcd = hboxes;</span>
<span class="lineNum">    4019 </span>            : 
<span class="lineNum">    4020 </span><span class="lineNoCov">          0 :     aspects[i].text = (unichar_t *) _(&quot;ATT&quot;);</span>
<span class="lineNum">    4021 </span><span class="lineNoCov">          0 :     aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4022 </span><span class="lineNoCov">          0 :     aspects[i++].gcd = aboxes;</span>
<span class="lineNum">    4023 </span>            : 
<span class="lineNum">    4024 </span><span class="lineNoCov">          0 :     aspects[i].text = (unichar_t *) _(&quot;CID&quot;);</span>
<span class="lineNum">    4025 </span><span class="lineNoCov">          0 :     aspects[i].disabled = fv-&gt;b.cidmaster==NULL;</span>
<span class="lineNum">    4026 </span><span class="lineNoCov">          0 :     aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4027 </span><span class="lineNoCov">          0 :     aspects[i++].gcd = cboxes;</span>
<span class="lineNum">    4028 </span>            : 
<span class="lineNum">    4029 </span><span class="lineNoCov">          0 :     aspects[i].text = (unichar_t *) _(&quot;BB&quot;);</span>
<span class="lineNum">    4030 </span><span class="lineNoCov">          0 :     aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4031 </span><span class="lineNoCov">          0 :     aspects[i++].gcd = bbboxes;</span>
<span class="lineNum">    4032 </span>            : 
<span class="lineNum">    4033 </span><span class="lineNoCov">          0 :     aspects[i].text = (unichar_t *) _(&quot;Random&quot;);</span>
<span class="lineNum">    4034 </span><span class="lineNoCov">          0 :     aspects[i].text_is_1byte = true;</span>
<span class="lineNum">    4035 </span><span class="lineNoCov">          0 :     aspects[i++].gcd = rboxes;</span>
<span class="lineNum">    4036 </span>            : 
<span class="lineNum">    4037 </span><span class="lineNoCov">          0 :     mgcd[0].gd.pos.x = 4; mgcd[0].gd.pos.y = 6;</span>
<span class="lineNum">    4038 </span><span class="lineNoCov">          0 :     mgcd[0].gd.pos.width = 210;</span>
<span class="lineNum">    4039 </span><span class="lineNoCov">          0 :     mgcd[0].gd.pos.height = 190;</span>
<span class="lineNum">    4040 </span><span class="lineNoCov">          0 :     mgcd[0].gd.u.tabs = aspects;</span>
<span class="lineNum">    4041 </span><span class="lineNoCov">          0 :     mgcd[0].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4042 </span><span class="lineNoCov">          0 :     mgcd[0].creator = GTabSetCreate;</span>
<span class="lineNum">    4043 </span><span class="lineNoCov">          0 :     marray[0][0] = &amp;mgcd[0]; marray[0][1] = NULL;</span>
<span class="lineNum">    4044 </span>            : 
<span class="lineNum">    4045 </span><span class="lineNoCov">          0 :     mgcd[1].gd.pos.x = 15; mgcd[1].gd.pos.y = 190+10;</span>
<span class="lineNum">    4046 </span><span class="lineNoCov">          0 :     mgcd[1].gd.flags = gg_visible | gg_enabled | gg_dontcopybox;</span>
<span class="lineNum">    4047 </span><span class="lineNoCov">          0 :     mlabel[1].text = (unichar_t *) _(&quot;Clear All&quot;);</span>
<span class="lineNum">    4048 </span><span class="lineNoCov">          0 :     mlabel[1].text_is_1byte = true;</span>
<span class="lineNum">    4049 </span><span class="lineNoCov">          0 :     mlabel[1].text_in_resource = true;</span>
<span class="lineNum">    4050 </span><span class="lineNoCov">          0 :     mgcd[1].gd.label = &amp;mlabel[1];</span>
<span class="lineNum">    4051 </span>            :     /*mgcd[1].gd.box = &amp;smallbox;*/
<span class="lineNum">    4052 </span><span class="lineNoCov">          0 :     mgcd[1].gd.handle_controlevent = Prob_DoAll;</span>
<span class="lineNum">    4053 </span><span class="lineNoCov">          0 :     mgcd[2].gd.cid = CID_ClearAll;</span>
<span class="lineNum">    4054 </span><span class="lineNoCov">          0 :     mgcd[1].creator = GButtonCreate;</span>
<span class="lineNum">    4055 </span><span class="lineNoCov">          0 :     mharray1[0] = &amp;mgcd[1];</span>
<span class="lineNum">    4056 </span>            : 
<span class="lineNum">    4057 </span><span class="lineNoCov">          0 :     mgcd[2].gd.pos.x = mgcd[1].gd.pos.x+1.25*GIntGetResource(_NUM_Buttonsize);</span>
<span class="lineNum">    4058 </span><span class="lineNoCov">          0 :     mgcd[2].gd.pos.y = mgcd[1].gd.pos.y;</span>
<span class="lineNum">    4059 </span><span class="lineNoCov">          0 :     mgcd[2].gd.flags = gg_visible | gg_enabled | gg_dontcopybox;</span>
<span class="lineNum">    4060 </span><span class="lineNoCov">          0 :     mlabel[2].text = (unichar_t *) _(&quot;Set All&quot;);</span>
<span class="lineNum">    4061 </span><span class="lineNoCov">          0 :     mlabel[2].text_is_1byte = true;</span>
<span class="lineNum">    4062 </span><span class="lineNoCov">          0 :     mlabel[2].text_in_resource = true;</span>
<span class="lineNum">    4063 </span><span class="lineNoCov">          0 :     mgcd[2].gd.label = &amp;mlabel[2];</span>
<span class="lineNum">    4064 </span>            :     /*mgcd[2].gd.box = &amp;smallbox;*/
<span class="lineNum">    4065 </span><span class="lineNoCov">          0 :     mgcd[2].gd.handle_controlevent = Prob_DoAll;</span>
<span class="lineNum">    4066 </span><span class="lineNoCov">          0 :     mgcd[2].gd.cid = CID_SetAll;</span>
<span class="lineNum">    4067 </span><span class="lineNoCov">          0 :     mgcd[2].creator = GButtonCreate;</span>
<span class="lineNum">    4068 </span><span class="lineNoCov">          0 :     mharray1[1] = &amp;mgcd[2]; mharray1[2] = GCD_Glue; mharray1[3] = NULL;</span>
<span class="lineNum">    4069 </span>            : 
<span class="lineNum">    4070 </span><span class="lineNoCov">          0 :     mboxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4071 </span><span class="lineNoCov">          0 :     mboxes[2].gd.u.boxelements = mharray1;</span>
<span class="lineNum">    4072 </span><span class="lineNoCov">          0 :     mboxes[2].creator = GHBoxCreate;</span>
<span class="lineNum">    4073 </span><span class="lineNoCov">          0 :     marray[1][0] = &amp;mboxes[2]; marray[1][1] = NULL;</span>
<span class="lineNum">    4074 </span>            : 
<span class="lineNum">    4075 </span><span class="lineNoCov">          0 :     mgcd[3].gd.pos.x = 6; mgcd[3].gd.pos.y = mgcd[1].gd.pos.y+27;</span>
<span class="lineNum">    4076 </span><span class="lineNoCov">          0 :     mgcd[3].gd.pos.width = 218-12;</span>
<span class="lineNum">    4077 </span><span class="lineNoCov">          0 :     mgcd[3].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4078 </span><span class="lineNoCov">          0 :     mgcd[3].creator = GLineCreate;</span>
<span class="lineNum">    4079 </span><span class="lineNoCov">          0 :     marray[2][0] = &amp;mgcd[3]; marray[2][1] = NULL;</span>
<span class="lineNum">    4080 </span>            : 
<span class="lineNum">    4081 </span><span class="lineNoCov">          0 :     mlabel[4].text = (unichar_t *) U_(&quot;¹ \&quot;Near\&quot; means within&quot;);</span>
<span class="lineNum">    4082 </span><span class="lineNoCov">          0 :     mlabel[4].text_is_1byte = true;</span>
<span class="lineNum">    4083 </span><span class="lineNoCov">          0 :     mgcd[4].gd.label = &amp;mlabel[4];</span>
<span class="lineNum">    4084 </span><span class="lineNoCov">          0 :     mgcd[4].gd.mnemonic = 'N';</span>
<span class="lineNum">    4085 </span><span class="lineNoCov">          0 :     mgcd[4].gd.pos.x = 6; mgcd[4].gd.pos.y = mgcd[3].gd.pos.y+6+6;</span>
<span class="lineNum">    4086 </span><span class="lineNoCov">          0 :     mgcd[4].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4087 </span><span class="lineNoCov">          0 :     mgcd[4].creator = GLabelCreate;</span>
<span class="lineNum">    4088 </span><span class="lineNoCov">          0 :     mharray2[0] = &amp;mgcd[4];</span>
<span class="lineNum">    4089 </span>            : 
<span class="lineNum">    4090 </span><span class="lineNoCov">          0 :     sprintf(nearbuf,&quot;%g&quot;,near);</span>
<span class="lineNum">    4091 </span><span class="lineNoCov">          0 :     mlabel[5].text = (unichar_t *) nearbuf;</span>
<span class="lineNum">    4092 </span><span class="lineNoCov">          0 :     mlabel[5].text_is_1byte = true;</span>
<span class="lineNum">    4093 </span><span class="lineNoCov">          0 :     mgcd[5].gd.label = &amp;mlabel[5];</span>
<span class="lineNum">    4094 </span><span class="lineNoCov">          0 :     mgcd[5].gd.pos.x = 130; mgcd[5].gd.pos.y = mgcd[4].gd.pos.y-6; mgcd[5].gd.pos.width = 40;</span>
<span class="lineNum">    4095 </span><span class="lineNoCov">          0 :     mgcd[5].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4096 </span><span class="lineNoCov">          0 :     mgcd[5].gd.cid = CID_Near;</span>
<span class="lineNum">    4097 </span><span class="lineNoCov">          0 :     mgcd[5].creator = GTextFieldCreate;</span>
<span class="lineNum">    4098 </span><span class="lineNoCov">          0 :     mharray2[1] = &amp;mgcd[5];</span>
<span class="lineNum">    4099 </span>            : 
<span class="lineNum">    4100 </span><span class="lineNoCov">          0 :     mlabel[6].text = (unichar_t *) _(&quot;em-units&quot;);</span>
<span class="lineNum">    4101 </span><span class="lineNoCov">          0 :     mlabel[6].text_is_1byte = true;</span>
<span class="lineNum">    4102 </span><span class="lineNoCov">          0 :     mgcd[6].gd.label = &amp;mlabel[6];</span>
<span class="lineNum">    4103 </span><span class="lineNoCov">          0 :     mgcd[6].gd.pos.x = mgcd[5].gd.pos.x+mgcd[5].gd.pos.width+4; mgcd[6].gd.pos.y = mgcd[4].gd.pos.y;</span>
<span class="lineNum">    4104 </span><span class="lineNoCov">          0 :     mgcd[6].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    4105 </span><span class="lineNoCov">          0 :     mgcd[6].creator = GLabelCreate;</span>
<span class="lineNum">    4106 </span><span class="lineNoCov">          0 :     mharray2[2] = &amp;mgcd[6]; mharray2[3] = GCD_Glue; mharray2[4] = NULL;</span>
<span class="lineNum">    4107 </span>            : 
<span class="lineNum">    4108 </span><span class="lineNoCov">          0 :     mboxes[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4109 </span><span class="lineNoCov">          0 :     mboxes[3].gd.u.boxelements = mharray2;</span>
<span class="lineNum">    4110 </span><span class="lineNoCov">          0 :     mboxes[3].creator = GHBoxCreate;</span>
<span class="lineNum">    4111 </span><span class="lineNoCov">          0 :     marray[3][0] = &amp;mboxes[3]; marray[3][1] = NULL;</span>
<span class="lineNum">    4112 </span>            : 
<span class="lineNum">    4113 </span><span class="lineNoCov">          0 :     mgcd[7].gd.pos.x = 15-3; mgcd[7].gd.pos.y = mgcd[5].gd.pos.y+26;</span>
<span class="lineNum">    4114 </span><span class="lineNoCov">          0 :     mgcd[7].gd.pos.width = -1; mgcd[7].gd.pos.height = 0;</span>
<span class="lineNum">    4115 </span><span class="lineNoCov">          0 :     mgcd[7].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">    4116 </span><span class="lineNoCov">          0 :     mlabel[7].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">    4117 </span><span class="lineNoCov">          0 :     mlabel[7].text_is_1byte = true;</span>
<span class="lineNum">    4118 </span><span class="lineNoCov">          0 :     mlabel[7].text_in_resource = true;</span>
<span class="lineNum">    4119 </span><span class="lineNoCov">          0 :     mgcd[7].gd.mnemonic = 'O';</span>
<span class="lineNum">    4120 </span><span class="lineNoCov">          0 :     mgcd[7].gd.label = &amp;mlabel[7];</span>
<span class="lineNum">    4121 </span><span class="lineNoCov">          0 :     mgcd[7].gd.handle_controlevent = Prob_OK;</span>
<span class="lineNum">    4122 </span><span class="lineNoCov">          0 :     mgcd[7].creator = GButtonCreate;</span>
<span class="lineNum">    4123 </span><span class="lineNoCov">          0 :     barray[0] = GCD_Glue; barray[1] = &amp;mgcd[7]; barray[2] = GCD_Glue; barray[3] = GCD_Glue;</span>
<span class="lineNum">    4124 </span>            : 
<span class="lineNum">    4125 </span><span class="lineNoCov">          0 :     mgcd[8].gd.pos.x = -15; mgcd[8].gd.pos.y = mgcd[7].gd.pos.y+3;</span>
<span class="lineNum">    4126 </span><span class="lineNoCov">          0 :     mgcd[8].gd.pos.width = -1; mgcd[8].gd.pos.height = 0;</span>
<span class="lineNum">    4127 </span><span class="lineNoCov">          0 :     mgcd[8].gd.flags = gg_visible | gg_enabled | gg_but_cancel;</span>
<span class="lineNum">    4128 </span><span class="lineNoCov">          0 :     mlabel[8].text = (unichar_t *) _(&quot;_Cancel&quot;);</span>
<span class="lineNum">    4129 </span><span class="lineNoCov">          0 :     mlabel[8].text_is_1byte = true;</span>
<span class="lineNum">    4130 </span><span class="lineNoCov">          0 :     mlabel[8].text_in_resource = true;</span>
<span class="lineNum">    4131 </span><span class="lineNoCov">          0 :     mgcd[8].gd.label = &amp;mlabel[8];</span>
<span class="lineNum">    4132 </span><span class="lineNoCov">          0 :     mgcd[8].gd.mnemonic = 'C';</span>
<span class="lineNum">    4133 </span><span class="lineNoCov">          0 :     mgcd[8].gd.handle_controlevent = Prob_Cancel;</span>
<span class="lineNum">    4134 </span><span class="lineNoCov">          0 :     mgcd[8].creator = GButtonCreate;</span>
<span class="lineNum">    4135 </span><span class="lineNoCov">          0 :     barray[4] = GCD_Glue; barray[5] = GCD_Glue; barray[6] = &amp;mgcd[8]; barray[7] = GCD_Glue; barray[8] = NULL;</span>
<span class="lineNum">    4136 </span>            : 
<span class="lineNum">    4137 </span><span class="lineNoCov">          0 :     mboxes[4].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4138 </span><span class="lineNoCov">          0 :     mboxes[4].gd.u.boxelements = barray;</span>
<span class="lineNum">    4139 </span><span class="lineNoCov">          0 :     mboxes[4].creator = GHBoxCreate;</span>
<span class="lineNum">    4140 </span><span class="lineNoCov">          0 :     marray[4][0] = &amp;mboxes[4]; marray[4][1] = NULL;</span>
<span class="lineNum">    4141 </span><span class="lineNoCov">          0 :     marray[5][0] = NULL;</span>
<span class="lineNum">    4142 </span>            : 
<span class="lineNum">    4143 </span><span class="lineNoCov">          0 :     mboxes[0].gd.pos.x = mboxes[0].gd.pos.y = 2;</span>
<span class="lineNum">    4144 </span><span class="lineNoCov">          0 :     mboxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    4145 </span><span class="lineNoCov">          0 :     mboxes[0].gd.u.boxelements = marray[0];</span>
<span class="lineNum">    4146 </span><span class="lineNoCov">          0 :     mboxes[0].creator = GHVGroupCreate;</span>
<span class="lineNum">    4147 </span>            : 
<span class="lineNum">    4148 </span><span class="lineNoCov">          0 :     GGadgetsCreate(gw,mboxes);</span>
<span class="lineNum">    4149 </span>            : 
<span class="lineNum">    4150 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(mboxes[0].ret,0);</span>
<span class="lineNum">    4151 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(mboxes[2].ret,gb_expandglue);</span>
<span class="lineNum">    4152 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(mboxes[3].ret,gb_expandglue);</span>
<span class="lineNum">    4153 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(mboxes[4].ret,gb_expandgluesame);</span>
<span class="lineNum">    4154 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(pboxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    4155 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(pboxes[2].ret,gb_expandglue);</span>
<span class="lineNum">    4156 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(pboxes[3].ret,gb_expandglue);</span>
<span class="lineNum">    4157 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(pboxes[4].ret,gb_expandglue);</span>
<span class="lineNum">    4158 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(paboxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    4159 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(paboxes[2].ret,gb_expandglue);</span>
<span class="lineNum">    4160 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(rfboxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    4161 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(rfboxes[2].ret,gb_expandglue);</span>
<span class="lineNum">    4162 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(hboxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    4163 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(hboxes[2].ret,gb_expandglue);</span>
<span class="lineNum">    4164 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(hboxes[3].ret,gb_expandglue);</span>
<span class="lineNum">    4165 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(aboxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    4166 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(cboxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    4167 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(bbboxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    4168 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(bbboxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    4169 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(rboxes[0].ret,gb_expandglue);</span>
<span class="lineNum">    4170 </span>            : 
<span class="lineNum">    4171 </span><span class="lineNoCov">          0 :     GHVBoxFitWindow(mboxes[0].ret);</span>
<span class="lineNum">    4172 </span>            : 
<span class="lineNum">    4173 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<span class="lineNum">    4174 </span><span class="lineNoCov">          0 :     while ( !p.done )</span>
<span class="lineNum">    4175 </span><span class="lineNoCov">          0 :         GDrawProcessOneEvent(NULL);</span>
<span class="lineNum">    4176 </span><span class="lineNoCov">          0 :     GDrawDestroyWindow(gw);</span>
<span class="lineNum">    4177 </span><span class="lineNoCov">          0 :     if ( p.explainw!=NULL )</span>
<span class="lineNum">    4178 </span><span class="lineNoCov">          0 :         GDrawDestroyWindow(p.explainw);</span>
<span class="lineNum">    4179 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    4180 </span>            : 
<span class="lineNum">    4181 </span>            : /* ************************************************************************** */
<span class="lineNum">    4182 </span>            : /* ***************************** Validation code **************************** */
<span class="lineNum">    4183 </span>            : /* ************************************************************************** */
<span class="lineNum">    4184 </span>            : 
<span class="lineNum">    4185 </span>            : struct val_data {
<span class="lineNum">    4186 </span>            :     GWindow gw;
<span class="lineNum">    4187 </span>            :     GWindow v;
<span class="lineNum">    4188 </span>            :     GGadget *vsb;
<span class="lineNum">    4189 </span>            :     int lcnt;
<span class="lineNum">    4190 </span>            :     int loff_top;
<span class="lineNum">    4191 </span>            :     int vlcnt;
<span class="lineNum">    4192 </span>            :     SplineFont *sf;
<span class="lineNum">    4193 </span>            :     int cidmax;
<span class="lineNum">    4194 </span>            :     enum validation_state mask;
<span class="lineNum">    4195 </span>            :     int need_to_check_with_user_on_mask;
<span class="lineNum">    4196 </span>            :     int needs_blue;
<span class="lineNum">    4197 </span>            :     GTimer *recheck;
<span class="lineNum">    4198 </span>            :     int laststart;
<span class="lineNum">    4199 </span>            :     int finished_first_pass;
<span class="lineNum">    4200 </span>            :     int as,fh;
<span class="lineNum">    4201 </span>            :     GFont *font;
<span class="lineNum">    4202 </span>            :     SplineChar *sc;             /* used by popup menu */
<span class="lineNum">    4203 </span>            :     int lastgid;
<span class="lineNum">    4204 </span>            :     CharView *lastcv;
<span class="lineNum">    4205 </span>            :     int layer;
<span class="lineNum">    4206 </span>            : };
<span class="lineNum">    4207 </span>            : 
<span class="lineNum">    4208 </span>            : static char *vserrornames[] = {
<span class="lineNum">    4209 </span>            :     N_(&quot;Open Contour&quot;),
<span class="lineNum">    4210 </span>            :     N_(&quot;Self Intersecting&quot;),
<span class="lineNum">    4211 </span>            :     N_(&quot;Wrong Direction&quot;),
<span class="lineNum">    4212 </span>            :     N_(&quot;Flipped References&quot;),
<span class="lineNum">    4213 </span>            :     N_(&quot;Missing Points at Extrema&quot;),
<span class="lineNum">    4214 </span>            :     N_(&quot;Unknown glyph referenced in GSUB/GPOS/MATH&quot;),
<span class="lineNum">    4215 </span>            :     N_(&quot;Too Many Points&quot;),
<span class="lineNum">    4216 </span>            :     N_(&quot;Too Many Hints&quot;),
<span class="lineNum">    4217 </span>            :     N_(&quot;Bad Glyph Name&quot;),
<span class="lineNum">    4218 </span>            :     NULL,               /* Maxp too many points */
<span class="lineNum">    4219 </span>            :     NULL,               /* Maxp too many paths */
<span class="lineNum">    4220 </span>            :     NULL,               /* Maxp too many component points */
<span class="lineNum">    4221 </span>            :     NULL,               /* Maxp too many component paths */
<span class="lineNum">    4222 </span>            :     NULL,               /* Maxp instructions too long */
<span class="lineNum">    4223 </span>            :     NULL,               /* Maxp too many references */
<span class="lineNum">    4224 </span>            :     NULL,               /* Maxp references too deep */
<span class="lineNum">    4225 </span>            :     NULL,               /* prep or fpgm too long */
<span class="lineNum">    4226 </span>            :     N_(&quot;Distance between adjacent points is too big&quot;),
<span class="lineNum">    4227 </span>            :     N_(&quot;Non-integral coordinates&quot;),
<span class="lineNum">    4228 </span>            :     N_(&quot;Contains anchor points for some, but not all, classes in a subtable&quot;),
<span class="lineNum">    4229 </span>            :     N_(&quot;There is another glyph in the font with this name&quot;),
<span class="lineNum">    4230 </span>            :     N_(&quot;There is another glyph in the font with this unicode code point&quot;),
<span class="lineNum">    4231 </span>            :     N_(&quot;Glyph contains overlapped hints (in the same hintmask)&quot;)
<span class="lineNum">    4232 </span>            : };
<span class="lineNum">    4233 </span>            : 
<span class="lineNum">    4234 </span>            : static char *privateerrornames[] = {
<span class="lineNum">    4235 </span>            :     N_(&quot;Odd number of elements in BlueValues/OtherBlues array.&quot;),
<span class="lineNum">    4236 </span>            :     N_(&quot;Elements in BlueValues/OtherBlues array are disordered.&quot;),
<span class="lineNum">    4237 </span>            :     N_(&quot;Too many elements in BlueValues/OtherBlues array.&quot;),
<span class="lineNum">    4238 </span>            :     N_(&quot;Elements in BlueValues/OtherBlues array are too close (Change BlueFuzz).&quot;),
<span class="lineNum">    4239 </span>            :     N_(&quot;Elements in BlueValues/OtherBlues array are not integers.&quot;),
<span class="lineNum">    4240 </span>            :     N_(&quot;Alignment zone height in BlueValues/OtherBlues array is too big for BlueScale.&quot;),
<span class="lineNum">    4241 </span>            :     NULL,
<span class="lineNum">    4242 </span>            :     NULL,
<span class="lineNum">    4243 </span>            :     N_(&quot;Odd number of elements in FamilyBlues/FamilyOtherBlues array.&quot;),
<span class="lineNum">    4244 </span>            :     N_(&quot;Elements in FamilyBlues/FamilyOtherBlues array are disordered.&quot;),
<span class="lineNum">    4245 </span>            :     N_(&quot;Too many elements in FamilyBlues/FamilyOtherBlues array.&quot;),
<span class="lineNum">    4246 </span>            :     N_(&quot;Elements in FamilyBlues/FamilyOtherBlues array are too close (Change BlueFuzz).&quot;),
<span class="lineNum">    4247 </span>            :     N_(&quot;Elements in FamilyBlues/FamilyOtherBlues array are not integers.&quot;),
<span class="lineNum">    4248 </span>            :     N_(&quot;Alignment zone height in FamilyBlues/FamilyOtherBlues array is too big for BlueScale.&quot;),
<span class="lineNum">    4249 </span>            :     NULL,
<span class="lineNum">    4250 </span>            :     NULL,
<span class="lineNum">    4251 </span>            :     N_(&quot;Missing BlueValues entry.&quot;),
<span class="lineNum">    4252 </span>            :     N_(&quot;Bad BlueFuzz entry.&quot;),
<span class="lineNum">    4253 </span>            :     N_(&quot;Bad BlueScale entry.&quot;),
<span class="lineNum">    4254 </span>            :     N_(&quot;Bad StdHW entry.&quot;),
<span class="lineNum">    4255 </span>            :     N_(&quot;Bad StdVW entry.&quot;),
<span class="lineNum">    4256 </span>            :     N_(&quot;Bad StemSnapH entry.&quot;),
<span class="lineNum">    4257 </span>            :     N_(&quot;Bad StemSnapV entry.&quot;),
<span class="lineNum">    4258 </span>            :     N_(&quot;StemSnapH does not contain StdHW value.&quot;),
<span class="lineNum">    4259 </span>            :     N_(&quot;StemSnapV does not contain StdVW value.&quot;),
<span class="lineNum">    4260 </span>            :     N_(&quot;Bad BlueShift entry.&quot;),
<span class="lineNum">    4261 </span>            :     NULL
<a name="4262"><span class="lineNum">    4262 </span>            : };</a>
<span class="lineNum">    4263 </span>            : 
<span class="lineNum">    4264 </span><span class="lineNoCov">          0 : char *VSErrorsFromMask(int mask, int private_mask) {</span>
<span class="lineNum">    4265 </span>            :     int bit, m;
<span class="lineNum">    4266 </span>            :     int len;
<span class="lineNum">    4267 </span>            :     char *ret;
<span class="lineNum">    4268 </span>            : 
<span class="lineNum">    4269 </span><span class="lineNoCov">          0 :     len = 0;</span>
<span class="lineNum">    4270 </span><span class="lineNoCov">          0 :     for ( m=0, bit=(vs_known&lt;&lt;1) ; bit&lt;=vs_last; ++m, bit&lt;&lt;=1 )</span>
<span class="lineNum">    4271 </span><span class="lineNoCov">          0 :         if ( (mask&amp;bit) &amp;&amp; vserrornames[m]!=NULL )</span>
<span class="lineNum">    4272 </span><span class="lineNoCov">          0 :             len += strlen( _(vserrornames[m]))+2;</span>
<span class="lineNum">    4273 </span><span class="lineNoCov">          0 :     if ( private_mask != 0 )</span>
<span class="lineNum">    4274 </span><span class="lineNoCov">          0 :         len += strlen( _(&quot;Bad Private Dictionary&quot;)) +2;</span>
<span class="lineNum">    4275 </span><span class="lineNoCov">          0 :     ret = malloc(len+1);</span>
<span class="lineNum">    4276 </span><span class="lineNoCov">          0 :     len = 0;</span>
<span class="lineNum">    4277 </span><span class="lineNoCov">          0 :     for ( m=0, bit=(vs_known&lt;&lt;1) ; bit&lt;=vs_last; ++m, bit&lt;&lt;=1 )</span>
<span class="lineNum">    4278 </span><span class="lineNoCov">          0 :         if ( (mask&amp;bit) &amp;&amp; vserrornames[m]!=NULL ) {</span>
<span class="lineNum">    4279 </span><span class="lineNoCov">          0 :             ret[len++] =' ';</span>
<span class="lineNum">    4280 </span><span class="lineNoCov">          0 :             strcpy(ret+len,_(vserrornames[m]));</span>
<span class="lineNum">    4281 </span><span class="lineNoCov">          0 :             len += strlen( ret+len );</span>
<span class="lineNum">    4282 </span><span class="lineNoCov">          0 :             ret[len++] ='\n';</span>
<span class="lineNum">    4283 </span>            :         }
<span class="lineNum">    4284 </span><span class="lineNoCov">          0 :     if ( private_mask != 0 ) {</span>
<span class="lineNum">    4285 </span><span class="lineNoCov">          0 :         ret[len++] =' ';</span>
<span class="lineNum">    4286 </span><span class="lineNoCov">          0 :         strcpy(ret+len,_(&quot;Bad Private Dictionary&quot;));</span>
<span class="lineNum">    4287 </span><span class="lineNoCov">          0 :         len += strlen( ret+len );</span>
<span class="lineNum">    4288 </span><span class="lineNoCov">          0 :         ret[len++] ='\n';</span>
<span class="lineNum">    4289 </span>            :     }
<span class="lineNum">    4290 </span><span class="lineNoCov">          0 :     ret[len] = '\0';</span>
<span class="lineNum">    4291 </span><span class="lineNoCov">          0 : return( ret );</span>
<a name="4292"><span class="lineNum">    4292 </span>            : }</a>
<span class="lineNum">    4293 </span>            : 
<span class="lineNum">    4294 </span><span class="lineNoCov">          0 : static int VSModMask(SplineChar *sc, struct val_data *vw) {</span>
<span class="lineNum">    4295 </span><span class="lineNoCov">          0 :     int vs = 0;</span>
<span class="lineNum">    4296 </span><span class="lineNoCov">          0 :     if ( sc!=NULL ) {</span>
<span class="lineNum">    4297 </span><span class="lineNoCov">          0 :         vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4298 </span><span class="lineNoCov">          0 :         if ( sc-&gt;unlink_rm_ovrlp_save_undo )</span>
<span class="lineNum">    4299 </span><span class="lineNoCov">          0 :             vs &amp;= ~vs_selfintersects;</span>
<span class="lineNum">    4300 </span>            :         /* if doing a truetype eval, then I'm told it's ok for references */
<span class="lineNum">    4301 </span>            :         /*  to overlap. And if refs can overlap, then we can't figure out */
<span class="lineNum">    4302 </span>            :         /*  direction properly */ /* I should really check that all the   */
<span class="lineNum">    4303 </span>            :         /*  refs have legal ttf transform matrices */
<span class="lineNum">    4304 </span><span class="lineNoCov">          0 :         if ( vw-&gt;mask==vs_maskttf &amp;&amp;</span>
<span class="lineNum">    4305 </span><span class="lineNoCov">          0 :                 sc-&gt;layers[vw-&gt;layer].splines==NULL &amp;&amp;</span>
<span class="lineNum">    4306 </span><span class="lineNoCov">          0 :                 sc-&gt;layers[vw-&gt;layer].refs!=NULL )</span>
<span class="lineNum">    4307 </span><span class="lineNoCov">          0 :             vs &amp;= ~(vs_selfintersects|vs_wrongdirection);</span>
<span class="lineNum">    4308 </span>            :     }
<span class="lineNum">    4309 </span><span class="lineNoCov">          0 : return( vs );</span>
<a name="4310"><span class="lineNum">    4310 </span>            : }</a>
<span class="lineNum">    4311 </span>            : 
<span class="lineNum">    4312 </span><span class="lineNoCov">          0 : static int VW_FindLine(struct val_data *vw,int line, int *skips) {</span>
<span class="lineNum">    4313 </span><span class="lineNoCov">          0 :     int gid,k, cidmax = vw-&gt;cidmax;</span>
<span class="lineNum">    4314 </span><span class="lineNoCov">          0 :     SplineFont *sf = vw-&gt;sf;</span>
<span class="lineNum">    4315 </span>            :     SplineFont *sub;
<span class="lineNum">    4316 </span>            :     SplineChar *sc;
<span class="lineNum">    4317 </span>            :     int sofar, tot;
<span class="lineNum">    4318 </span>            :     int bit;
<span class="lineNum">    4319 </span>            :     int vs;
<span class="lineNum">    4320 </span>            : 
<span class="lineNum">    4321 </span><span class="lineNoCov">          0 :     sofar = 0;</span>
<span class="lineNum">    4322 </span><span class="lineNoCov">          0 :     for ( gid=0; gid&lt;cidmax ; ++gid ) {</span>
<span class="lineNum">    4323 </span><span class="lineNoCov">          0 :         if ( sf-&gt;subfontcnt==0 )</span>
<span class="lineNum">    4324 </span><span class="lineNoCov">          0 :             sc = sf-&gt;glyphs[gid];</span>
<span class="lineNum">    4325 </span>            :         else {
<span class="lineNum">    4326 </span><span class="lineNoCov">          0 :             for ( k=0; k&lt;sf-&gt;subfontcnt; ++k ) {</span>
<span class="lineNum">    4327 </span><span class="lineNoCov">          0 :                 sub = sf-&gt;subfonts[k];</span>
<span class="lineNum">    4328 </span><span class="lineNoCov">          0 :                 if ( gid&lt;sub-&gt;glyphcnt &amp;&amp; (sc = sub-&gt;glyphs[gid])!=NULL )</span>
<span class="lineNum">    4329 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    4330 </span>            :             }
<span class="lineNum">    4331 </span>            :         }
<span class="lineNum">    4332 </span>            :         /* Ignore it if it has not been validated */
<span class="lineNum">    4333 </span>            :         /* Ignore it if it is good */
<span class="lineNum">    4334 </span><span class="lineNoCov">          0 :         vs = VSModMask(sc,vw);</span>
<span class="lineNum">    4335 </span><span class="lineNoCov">          0 :         if ((vs&amp;vs_known) &amp;&amp; (vs&amp;vw-&gt;mask)!=0 ) {</span>
<span class="lineNum">    4336 </span><span class="lineNoCov">          0 :             tot = 1;</span>
<span class="lineNum">    4337 </span><span class="lineNoCov">          0 :             if ( sc-&gt;vs_open )</span>
<span class="lineNum">    4338 </span><span class="lineNoCov">          0 :                 for ( bit=(vs_known&lt;&lt;1) ; bit&lt;=vs_last; bit&lt;&lt;=1 )</span>
<span class="lineNum">    4339 </span><span class="lineNoCov">          0 :                     if ( (bit&amp;vw-&gt;mask) &amp;&amp; (vs&amp;bit) )</span>
<span class="lineNum">    4340 </span><span class="lineNoCov">          0 :                         ++tot;</span>
<span class="lineNum">    4341 </span><span class="lineNoCov">          0 :             if ( sofar+tot&gt;line ) {</span>
<span class="lineNum">    4342 </span><span class="lineNoCov">          0 :                 *skips = line-sofar;</span>
<span class="lineNum">    4343 </span><span class="lineNoCov">          0 : return( gid );</span>
<span class="lineNum">    4344 </span>            :             }
<span class="lineNum">    4345 </span><span class="lineNoCov">          0 :             sofar += tot;</span>
<span class="lineNum">    4346 </span>            :         }
<span class="lineNum">    4347 </span>            :     }
<span class="lineNum">    4348 </span>            : 
<span class="lineNum">    4349 </span><span class="lineNoCov">          0 :     vs = ValidatePrivate(sf);</span>
<span class="lineNum">    4350 </span><span class="lineNoCov">          0 :     if ( !vw-&gt;needs_blue )</span>
<span class="lineNum">    4351 </span><span class="lineNoCov">          0 :         vs &amp;= ~pds_missingblue;</span>
<span class="lineNum">    4352 </span><span class="lineNoCov">          0 :     if ( vs!=0 ) {</span>
<span class="lineNum">    4353 </span><span class="lineNoCov">          0 :         tot = 1;</span>
<span class="lineNum">    4354 </span><span class="lineNoCov">          0 :         for ( bit=1 ; bit!=0; bit&lt;&lt;=1 )</span>
<span class="lineNum">    4355 </span><span class="lineNoCov">          0 :             if ( vs&amp;bit )</span>
<span class="lineNum">    4356 </span><span class="lineNoCov">          0 :                 ++tot;</span>
<span class="lineNum">    4357 </span><span class="lineNoCov">          0 :         if ( sofar+tot&gt;line ) {</span>
<span class="lineNum">    4358 </span><span class="lineNoCov">          0 :             *skips = line-sofar;</span>
<span class="lineNum">    4359 </span><span class="lineNoCov">          0 : return( -2 );</span>
<span class="lineNum">    4360 </span>            :         }
<span class="lineNum">    4361 </span>            :     }
<span class="lineNum">    4362 </span>            : 
<span class="lineNum">    4363 </span><span class="lineNoCov">          0 :     *skips = 0;</span>
<span class="lineNum">    4364 </span><span class="lineNoCov">          0 : return( -1 );</span>
<a name="4365"><span class="lineNum">    4365 </span>            : }</a>
<span class="lineNum">    4366 </span>            : 
<span class="lineNum">    4367 </span><span class="lineNoCov">          0 : static int VW_FindSC(struct val_data *vw,SplineChar *sought) {</span>
<span class="lineNum">    4368 </span><span class="lineNoCov">          0 :     int gid,k, cidmax = vw-&gt;cidmax;</span>
<span class="lineNum">    4369 </span><span class="lineNoCov">          0 :     SplineFont *sf = vw-&gt;sf;</span>
<span class="lineNum">    4370 </span>            :     SplineFont *sub;
<span class="lineNum">    4371 </span>            :     SplineChar *sc;
<span class="lineNum">    4372 </span>            :     int sofar;
<span class="lineNum">    4373 </span>            :     int bit, vs;
<span class="lineNum">    4374 </span>            : 
<span class="lineNum">    4375 </span><span class="lineNoCov">          0 :     sofar = 0;</span>
<span class="lineNum">    4376 </span><span class="lineNoCov">          0 :     for ( gid=0; gid&lt;cidmax ; ++gid ) {</span>
<span class="lineNum">    4377 </span><span class="lineNoCov">          0 :         if ( sf-&gt;subfontcnt==0 )</span>
<span class="lineNum">    4378 </span><span class="lineNoCov">          0 :             sc = sf-&gt;glyphs[gid];</span>
<span class="lineNum">    4379 </span>            :         else {
<span class="lineNum">    4380 </span><span class="lineNoCov">          0 :             for ( k=0; k&lt;sf-&gt;subfontcnt; ++k ) {</span>
<span class="lineNum">    4381 </span><span class="lineNoCov">          0 :                 sub = sf-&gt;subfonts[k];</span>
<span class="lineNum">    4382 </span><span class="lineNoCov">          0 :                 if ( gid&lt;sub-&gt;glyphcnt &amp;&amp; (sc = sub-&gt;glyphs[gid])!=NULL )</span>
<span class="lineNum">    4383 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    4384 </span>            :             }
<span class="lineNum">    4385 </span>            :         }
<span class="lineNum">    4386 </span>            :         /* Ignore it if it has not been validated */
<span class="lineNum">    4387 </span>            :         /* Ignore it if it is good */
<span class="lineNum">    4388 </span><span class="lineNoCov">          0 :         vs = VSModMask(sc,vw);</span>
<span class="lineNum">    4389 </span><span class="lineNoCov">          0 :         if ((vs&amp;vs_known) &amp;&amp; (vs&amp;vw-&gt;mask)!=0 ) {</span>
<span class="lineNum">    4390 </span><span class="lineNoCov">          0 :             if ( sc==sought )</span>
<span class="lineNum">    4391 </span><span class="lineNoCov">          0 : return( sofar );</span>
<span class="lineNum">    4392 </span><span class="lineNoCov">          0 :             ++sofar;</span>
<span class="lineNum">    4393 </span><span class="lineNoCov">          0 :             if ( sc-&gt;vs_open )</span>
<span class="lineNum">    4394 </span><span class="lineNoCov">          0 :                 for ( bit=(vs_known&lt;&lt;1) ; bit&lt;=vs_last; bit&lt;&lt;=1 )</span>
<span class="lineNum">    4395 </span><span class="lineNoCov">          0 :                     if ( (bit&amp;vw-&gt;mask) &amp;&amp; (vs&amp;bit) )</span>
<span class="lineNum">    4396 </span><span class="lineNoCov">          0 :                         ++sofar;</span>
<span class="lineNum">    4397 </span><span class="lineNoCov">          0 :         } else if ( sc==sought )</span>
<span class="lineNum">    4398 </span><span class="lineNoCov">          0 : return( -1 );</span>
<span class="lineNum">    4399 </span>            :     }
<span class="lineNum">    4400 </span><span class="lineNoCov">          0 : return( -1 );</span>
<a name="4401"><span class="lineNum">    4401 </span>            : }</a>
<span class="lineNum">    4402 </span>            : 
<span class="lineNum">    4403 </span><span class="lineNoCov">          0 : static int VW_VScroll(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    4404 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    4405 </span><span class="lineNoCov">          0 :     int newpos = vw-&gt;loff_top;</span>
<span class="lineNum">    4406 </span>            : 
<span class="lineNum">    4407 </span><span class="lineNoCov">          0 :     switch( e-&gt;u.control.u.sb.type ) {</span>
<span class="lineNum">    4408 </span>            :       case et_sb_top:
<span class="lineNum">    4409 </span><span class="lineNoCov">          0 :         newpos = 0;</span>
<span class="lineNum">    4410 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    4411 </span>            :       case et_sb_uppage:
<span class="lineNum">    4412 </span><span class="lineNoCov">          0 :         newpos -= 9*vw-&gt;vlcnt/10;</span>
<span class="lineNum">    4413 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    4414 </span>            :       case et_sb_up:
<span class="lineNum">    4415 </span><span class="lineNoCov">          0 :         newpos -= vw-&gt;vlcnt/15;</span>
<span class="lineNum">    4416 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    4417 </span>            :       case et_sb_down:
<span class="lineNum">    4418 </span><span class="lineNoCov">          0 :         newpos += vw-&gt;vlcnt/15;</span>
<span class="lineNum">    4419 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    4420 </span>            :       case et_sb_downpage:
<span class="lineNum">    4421 </span><span class="lineNoCov">          0 :         newpos += 9*vw-&gt;vlcnt/10;</span>
<span class="lineNum">    4422 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    4423 </span>            :       case et_sb_bottom:
<span class="lineNum">    4424 </span><span class="lineNoCov">          0 :         newpos = 0;</span>
<span class="lineNum">    4425 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    4426 </span>            :       case et_sb_thumb:
<span class="lineNum">    4427 </span>            :       case et_sb_thumbrelease:
<span class="lineNum">    4428 </span><span class="lineNoCov">          0 :         newpos = e-&gt;u.control.u.sb.pos;</span>
<span class="lineNum">    4429 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    4430 </span>            :       case et_sb_halfup:
<span class="lineNum">    4431 </span><span class="lineNoCov">          0 :         newpos -= vw-&gt;vlcnt/30;</span>
<span class="lineNum">    4432 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    4433 </span>            :       case et_sb_halfdown:
<span class="lineNum">    4434 </span><span class="lineNoCov">          0 :         newpos += vw-&gt;vlcnt/30;</span>
<span class="lineNum">    4435 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    4436 </span>            :     }
<span class="lineNum">    4437 </span><span class="lineNoCov">          0 :     if ( newpos + vw-&gt;vlcnt &gt; vw-&gt;lcnt )</span>
<span class="lineNum">    4438 </span><span class="lineNoCov">          0 :         newpos = vw-&gt;lcnt-vw-&gt;vlcnt;</span>
<span class="lineNum">    4439 </span><span class="lineNoCov">          0 :     if ( newpos&lt;0 )</span>
<span class="lineNum">    4440 </span><span class="lineNoCov">          0 :         newpos = 0;</span>
<span class="lineNum">    4441 </span><span class="lineNoCov">          0 :     if ( vw-&gt;loff_top!=newpos ) {</span>
<span class="lineNum">    4442 </span><span class="lineNoCov">          0 :         vw-&gt;loff_top = newpos;</span>
<span class="lineNum">    4443 </span><span class="lineNoCov">          0 :         GScrollBarSetPos(vw-&gt;vsb,newpos);</span>
<span class="lineNum">    4444 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(vw-&gt;v,NULL,false);</span>
<span class="lineNum">    4445 </span>            :     }
<span class="lineNum">    4446 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="4447"><span class="lineNum">    4447 </span>            : }</a>
<span class="lineNum">    4448 </span>            : 
<span class="lineNum">    4449 </span><span class="lineNoCov">          0 : static void VW_SetSb(struct val_data *vw) {</span>
<span class="lineNum">    4450 </span><span class="lineNoCov">          0 :     if ( vw-&gt;loff_top + vw-&gt;vlcnt &gt; vw-&gt;lcnt )</span>
<span class="lineNum">    4451 </span><span class="lineNoCov">          0 :         vw-&gt;loff_top = vw-&gt;lcnt-vw-&gt;vlcnt;</span>
<span class="lineNum">    4452 </span><span class="lineNoCov">          0 :     if ( vw-&gt;loff_top&lt;0 )</span>
<span class="lineNum">    4453 </span><span class="lineNoCov">          0 :         vw-&gt;loff_top = 0;</span>
<span class="lineNum">    4454 </span><span class="lineNoCov">          0 :     GScrollBarSetBounds(vw-&gt;vsb,0,vw-&gt;lcnt,vw-&gt;vlcnt);</span>
<span class="lineNum">    4455 </span><span class="lineNoCov">          0 :     GScrollBarSetPos(vw-&gt;vsb,vw-&gt;loff_top);</span>
<a name="4456"><span class="lineNum">    4456 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4457 </span>            :     
<span class="lineNum">    4458 </span><span class="lineNoCov">          0 : static void VW_Remetric(struct val_data *vw) {</span>
<span class="lineNum">    4459 </span><span class="lineNoCov">          0 :     int gid,k, cidmax = vw-&gt;cidmax;</span>
<span class="lineNum">    4460 </span><span class="lineNoCov">          0 :     SplineFont *sub, *sf = vw-&gt;sf;</span>
<span class="lineNum">    4461 </span>            :     SplineChar *sc;
<span class="lineNum">    4462 </span>            :     int sofar, tot;
<span class="lineNum">    4463 </span>            :     int bit, vs;
<span class="lineNum">    4464 </span>            : 
<span class="lineNum">    4465 </span><span class="lineNoCov">          0 :     sofar = 0;</span>
<span class="lineNum">    4466 </span><span class="lineNoCov">          0 :     for ( gid=0; gid&lt;cidmax ; ++gid ) {</span>
<span class="lineNum">    4467 </span><span class="lineNoCov">          0 :         if ( sf-&gt;subfontcnt==0 )</span>
<span class="lineNum">    4468 </span><span class="lineNoCov">          0 :             sc = sf-&gt;glyphs[gid];</span>
<span class="lineNum">    4469 </span>            :         else {
<span class="lineNum">    4470 </span><span class="lineNoCov">          0 :             for ( k=0; k&lt;sf-&gt;subfontcnt; ++k ) {</span>
<span class="lineNum">    4471 </span><span class="lineNoCov">          0 :                 sub = sf-&gt;subfonts[k];</span>
<span class="lineNum">    4472 </span><span class="lineNoCov">          0 :                 if ( gid&lt;sub-&gt;glyphcnt &amp;&amp; (sc = sub-&gt;glyphs[gid])!=NULL )</span>
<span class="lineNum">    4473 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    4474 </span>            :             }
<span class="lineNum">    4475 </span>            :         }
<span class="lineNum">    4476 </span>            :         /* Ignore it if it has not been validated */
<span class="lineNum">    4477 </span>            :         /* Ignore it if it is good */
<span class="lineNum">    4478 </span><span class="lineNoCov">          0 :         vs = VSModMask(sc,vw);</span>
<span class="lineNum">    4479 </span><span class="lineNoCov">          0 :         if ((vs&amp;vs_known) &amp;&amp; (vs&amp;vw-&gt;mask)!=0 ) {</span>
<span class="lineNum">    4480 </span><span class="lineNoCov">          0 :             tot = 1;</span>
<span class="lineNum">    4481 </span><span class="lineNoCov">          0 :             if ( sc-&gt;vs_open )</span>
<span class="lineNum">    4482 </span><span class="lineNoCov">          0 :                 for ( bit=(vs_known&lt;&lt;1) ; bit&lt;=vs_last; bit&lt;&lt;=1 )</span>
<span class="lineNum">    4483 </span><span class="lineNoCov">          0 :                     if ( (bit&amp;vw-&gt;mask) &amp;&amp; (vs&amp;bit) )</span>
<span class="lineNum">    4484 </span><span class="lineNoCov">          0 :                         ++tot;</span>
<span class="lineNum">    4485 </span><span class="lineNoCov">          0 :             sofar += tot;</span>
<span class="lineNum">    4486 </span>            :         }
<span class="lineNum">    4487 </span>            :     }
<span class="lineNum">    4488 </span><span class="lineNoCov">          0 :     vs = ValidatePrivate(sf);</span>
<span class="lineNum">    4489 </span><span class="lineNoCov">          0 :     if ( !vw-&gt;needs_blue )</span>
<span class="lineNum">    4490 </span><span class="lineNoCov">          0 :         vs &amp;= ~pds_missingblue;</span>
<span class="lineNum">    4491 </span><span class="lineNoCov">          0 :     if ( vs!=0 ) {</span>
<span class="lineNum">    4492 </span><span class="lineNoCov">          0 :         tot = 1;</span>
<span class="lineNum">    4493 </span><span class="lineNoCov">          0 :         for ( bit=1 ; bit!=0; bit&lt;&lt;=1 )</span>
<span class="lineNum">    4494 </span><span class="lineNoCov">          0 :             if ( vs&amp;bit )</span>
<span class="lineNum">    4495 </span><span class="lineNoCov">          0 :                 ++tot;</span>
<span class="lineNum">    4496 </span><span class="lineNoCov">          0 :         sofar += tot;</span>
<span class="lineNum">    4497 </span>            :     }
<span class="lineNum">    4498 </span><span class="lineNoCov">          0 :     if ( vw-&gt;lcnt!=sofar ) {</span>
<span class="lineNum">    4499 </span><span class="lineNoCov">          0 :         vw-&gt;lcnt = sofar;</span>
<span class="lineNum">    4500 </span><span class="lineNoCov">          0 :         VW_SetSb(vw);</span>
<span class="lineNum">    4501 </span>            :     }
<span class="lineNum">    4502 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(vw-&gt;v,NULL,false);</span>
<a name="4503"><span class="lineNum">    4503 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4504 </span>            : 
<span class="lineNum">    4505 </span><span class="lineNoCov">          0 : static void VWMenuConnect(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4506 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4507 </span><span class="lineNoCov">          0 :     SplineChar *sc = vw-&gt;sc;</span>
<span class="lineNum">    4508 </span><span class="lineNoCov">          0 :     int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4509 </span><span class="lineNoCov">          0 :     int changed = false;</span>
<span class="lineNum">    4510 </span>            :     SplineSet *ss;
<span class="lineNum">    4511 </span>            : 
<span class="lineNum">    4512 </span><span class="lineNoCov">          0 :     for ( ss=sc-&gt;layers[vw-&gt;layer].splines; ss!=NULL; ss=ss-&gt;next ) {</span>
<span class="lineNum">    4513 </span><span class="lineNoCov">          0 :         if ( ss-&gt;first-&gt;prev==NULL &amp;&amp; ss-&gt;first-&gt;next!=NULL ) {</span>
<span class="lineNum">    4514 </span><span class="lineNoCov">          0 :             if ( !changed ) {</span>
<span class="lineNum">    4515 </span><span class="lineNoCov">          0 :                 SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4516 </span><span class="lineNoCov">          0 :                 changed = true;</span>
<span class="lineNum">    4517 </span>            :             }
<span class="lineNum">    4518 </span><span class="lineNoCov">          0 :             SplineMake(ss-&gt;last,ss-&gt;first,sc-&gt;layers[vw-&gt;layer].order2);</span>
<span class="lineNum">    4519 </span><span class="lineNoCov">          0 :             ss-&gt;last = ss-&gt;first;</span>
<span class="lineNum">    4520 </span>            :         }
<span class="lineNum">    4521 </span>            :     }
<span class="lineNum">    4522 </span><span class="lineNoCov">          0 :     if ( changed ) {</span>
<span class="lineNum">    4523 </span><span class="lineNoCov">          0 :         SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4524 </span><span class="lineNoCov">          0 :         SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4525 </span><span class="lineNoCov">          0 :         if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4526 </span><span class="lineNoCov">          0 :             VW_Remetric(vw);</span>
<span class="lineNum">    4527 </span>            :     }
<a name="4528"><span class="lineNum">    4528 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4529 </span>            : 
<span class="lineNum">    4530 </span><span class="lineNoCov">          0 : static void VWMenuInlineRefs(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4531 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4532 </span><span class="lineNoCov">          0 :     SplineChar *sc = vw-&gt;sc;</span>
<span class="lineNum">    4533 </span><span class="lineNoCov">          0 :     int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4534 </span><span class="lineNoCov">          0 :     int changed = false;</span>
<span class="lineNum">    4535 </span>            :     RefChar *ref, *refnext;
<span class="lineNum">    4536 </span>            : 
<span class="lineNum">    4537 </span><span class="lineNoCov">          0 :     for ( ref= sc-&gt;layers[vw-&gt;layer].refs; ref!=NULL; ref=refnext ) {</span>
<span class="lineNum">    4538 </span><span class="lineNoCov">          0 :         refnext = ref-&gt;next;</span>
<span class="lineNum">    4539 </span><span class="lineNoCov">          0 :         if ( !changed )</span>
<span class="lineNum">    4540 </span><span class="lineNoCov">          0 :             SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4541 </span><span class="lineNoCov">          0 :         changed = true;</span>
<span class="lineNum">    4542 </span><span class="lineNoCov">          0 :         SCRefToSplines(sc,ref,vw-&gt;layer);</span>
<span class="lineNum">    4543 </span>            :     }
<span class="lineNum">    4544 </span><span class="lineNoCov">          0 :     if ( changed ) {</span>
<span class="lineNum">    4545 </span><span class="lineNoCov">          0 :         SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4546 </span>            : 
<span class="lineNum">    4547 </span><span class="lineNoCov">          0 :         SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4548 </span><span class="lineNoCov">          0 :         if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4549 </span><span class="lineNoCov">          0 :             VW_Remetric(vw);</span>
<span class="lineNum">    4550 </span>            :     }
<a name="4551"><span class="lineNum">    4551 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4552 </span>            : 
<span class="lineNum">    4553 </span><span class="lineNoCov">          0 : static void VWMenuOverlap(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4554 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4555 </span><span class="lineNoCov">          0 :     SplineChar *sc = vw-&gt;sc;</span>
<span class="lineNum">    4556 </span><span class="lineNoCov">          0 :     int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4557 </span>            : 
<span class="lineNum">    4558 </span><span class="lineNoCov">          0 :     if ( !SCRoundToCluster(sc,ly_all,false,.03,.12))</span>
<span class="lineNum">    4559 </span><span class="lineNoCov">          0 :         SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4560 </span><span class="lineNoCov">          0 :     sc-&gt;layers[vw-&gt;layer].splines = SplineSetRemoveOverlap(sc,sc-&gt;layers[vw-&gt;layer].splines,over_remove);</span>
<span class="lineNum">    4561 </span><span class="lineNoCov">          0 :     SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4562 </span>            : 
<span class="lineNum">    4563 </span><span class="lineNoCov">          0 :     SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4564 </span><span class="lineNoCov">          0 :     if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4565 </span><span class="lineNoCov">          0 :         VW_Remetric(vw);</span>
<a name="4566"><span class="lineNum">    4566 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4567 </span>            : 
<span class="lineNum">    4568 </span><span class="lineNoCov">          0 : static void VWMenuMark(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4569 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4570 </span><span class="lineNoCov">          0 :     SplineChar *sc = vw-&gt;sc;</span>
<span class="lineNum">    4571 </span>            : 
<span class="lineNum">    4572 </span><span class="lineNoCov">          0 :     sc-&gt;unlink_rm_ovrlp_save_undo = true;</span>
<span class="lineNum">    4573 </span>            : 
<span class="lineNum">    4574 </span><span class="lineNoCov">          0 :     VW_Remetric(vw);</span>
<a name="4575"><span class="lineNum">    4575 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4576 </span>            : 
<span class="lineNum">    4577 </span><span class="lineNoCov">          0 : static void VWMenuInlineFlippedRefs(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4578 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4579 </span><span class="lineNoCov">          0 :     SplineChar *sc = vw-&gt;sc;</span>
<span class="lineNum">    4580 </span><span class="lineNoCov">          0 :     int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4581 </span><span class="lineNoCov">          0 :     int changed = false;</span>
<span class="lineNum">    4582 </span>            :     RefChar *ref, *refnext;
<span class="lineNum">    4583 </span>            : 
<span class="lineNum">    4584 </span><span class="lineNoCov">          0 :     for ( ref= sc-&gt;layers[vw-&gt;layer].refs; ref!=NULL; ref=refnext ) {</span>
<span class="lineNum">    4585 </span><span class="lineNoCov">          0 :         refnext = ref-&gt;next;</span>
<span class="lineNum">    4586 </span><span class="lineNoCov">          0 :         if ( ref-&gt;transform[0]*ref-&gt;transform[3]&lt;0 ||</span>
<span class="lineNum">    4587 </span><span class="lineNoCov">          0 :                 (ref-&gt;transform[0]==0 &amp;&amp; ref-&gt;transform[1]*ref-&gt;transform[2]&gt;0)) {</span>
<span class="lineNum">    4588 </span><span class="lineNoCov">          0 :             if ( !changed )</span>
<span class="lineNum">    4589 </span><span class="lineNoCov">          0 :                 SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4590 </span><span class="lineNoCov">          0 :             changed = true;</span>
<span class="lineNum">    4591 </span><span class="lineNoCov">          0 :             SCRefToSplines(sc,ref,vw-&gt;layer);</span>
<span class="lineNum">    4592 </span>            :         }
<span class="lineNum">    4593 </span>            :     }
<span class="lineNum">    4594 </span><span class="lineNoCov">          0 :     if ( changed ) {</span>
<span class="lineNum">    4595 </span><span class="lineNoCov">          0 :         SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4596 </span>            : 
<span class="lineNum">    4597 </span><span class="lineNoCov">          0 :         SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4598 </span><span class="lineNoCov">          0 :         if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4599 </span><span class="lineNoCov">          0 :             VW_Remetric(vw);</span>
<span class="lineNum">    4600 </span>            :     }
<a name="4601"><span class="lineNum">    4601 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4602 </span>            : 
<span class="lineNum">    4603 </span><span class="lineNoCov">          0 : static void VWMenuCorrectDir(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4604 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4605 </span><span class="lineNoCov">          0 :     SplineChar *sc = vw-&gt;sc;</span>
<span class="lineNum">    4606 </span><span class="lineNoCov">          0 :     int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4607 </span><span class="lineNoCov">          0 :     int changed = false;</span>
<span class="lineNum">    4608 </span>            : 
<span class="lineNum">    4609 </span><span class="lineNoCov">          0 :     SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4610 </span><span class="lineNoCov">          0 :     sc-&gt;layers[vw-&gt;layer].splines = SplineSetsCorrect(sc-&gt;layers[vw-&gt;layer].splines,&amp;changed);</span>
<span class="lineNum">    4611 </span><span class="lineNoCov">          0 :     SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4612 </span>            : 
<span class="lineNum">    4613 </span><span class="lineNoCov">          0 :     SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4614 </span><span class="lineNoCov">          0 :     if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4615 </span><span class="lineNoCov">          0 :         VW_Remetric(vw);</span>
<a name="4616"><span class="lineNum">    4616 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4617 </span>            : 
<span class="lineNum">    4618 </span><span class="lineNoCov">          0 : static void VWMenuGoodExtrema(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4619 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4620 </span><span class="lineNoCov">          0 :     SplineFont *sf = vw-&gt;sf;</span>
<span class="lineNum">    4621 </span><span class="lineNoCov">          0 :     int emsize = sf-&gt;ascent+sf-&gt;descent;</span>
<span class="lineNum">    4622 </span><span class="lineNoCov">          0 :     SplineChar *sc = vw-&gt;sc;</span>
<span class="lineNum">    4623 </span><span class="lineNoCov">          0 :     int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4624 </span>            : 
<span class="lineNum">    4625 </span><span class="lineNoCov">          0 :     SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4626 </span><span class="lineNoCov">          0 :     SplineCharAddExtrema(sc,sc-&gt;layers[vw-&gt;layer].splines,ae_only_good,emsize);</span>
<span class="lineNum">    4627 </span><span class="lineNoCov">          0 :     SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4628 </span>            : 
<span class="lineNum">    4629 </span><span class="lineNoCov">          0 :     SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4630 </span><span class="lineNoCov">          0 :     if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4631 </span><span class="lineNoCov">          0 :         VW_Remetric(vw);</span>
<a name="4632"><span class="lineNum">    4632 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4633 </span>            : 
<span class="lineNum">    4634 </span><span class="lineNoCov">          0 : static void VWMenuAllExtrema(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4635 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4636 </span><span class="lineNoCov">          0 :     SplineFont *sf = vw-&gt;sf;</span>
<span class="lineNum">    4637 </span><span class="lineNoCov">          0 :     int emsize = sf-&gt;ascent+sf-&gt;descent;</span>
<span class="lineNum">    4638 </span><span class="lineNoCov">          0 :     SplineChar *sc = vw-&gt;sc;</span>
<span class="lineNum">    4639 </span><span class="lineNoCov">          0 :     int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4640 </span>            : 
<span class="lineNum">    4641 </span><span class="lineNoCov">          0 :     SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4642 </span><span class="lineNoCov">          0 :     SplineCharAddExtrema(sc,sc-&gt;layers[vw-&gt;layer].splines,ae_all,emsize);</span>
<span class="lineNum">    4643 </span><span class="lineNoCov">          0 :     SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4644 </span>            : 
<span class="lineNum">    4645 </span><span class="lineNoCov">          0 :     SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4646 </span><span class="lineNoCov">          0 :     if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4647 </span><span class="lineNoCov">          0 :         VW_Remetric(vw);</span>
<a name="4648"><span class="lineNum">    4648 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4649 </span>            : 
<span class="lineNum">    4650 </span><span class="lineNoCov">          0 : static void VWMenuSimplify(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4651 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4652 </span><span class="lineNoCov">          0 :     SplineChar *sc = vw-&gt;sc;</span>
<span class="lineNum">    4653 </span><span class="lineNoCov">          0 :     int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4654 </span>            :     static struct simplifyinfo smpl = { sf_normal, 0.75, 0.05, 0, -1, 0, 0 };
<span class="lineNum">    4655 </span>            : 
<span class="lineNum">    4656 </span><span class="lineNoCov">          0 :     SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4657 </span><span class="lineNoCov">          0 :     sc-&gt;layers[vw-&gt;layer].splines = SplineCharSimplify(sc,sc-&gt;layers[vw-&gt;layer].splines,&amp;smpl);</span>
<span class="lineNum">    4658 </span><span class="lineNoCov">          0 :     SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4659 </span>            : 
<span class="lineNum">    4660 </span><span class="lineNoCov">          0 :     SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4661 </span><span class="lineNoCov">          0 :     if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4662 </span><span class="lineNoCov">          0 :         VW_Remetric(vw);</span>
<a name="4663"><span class="lineNum">    4663 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4664 </span>            : 
<span class="lineNum">    4665 </span><span class="lineNoCov">          0 : static void VWMenuRevalidateAll(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4666 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4667 </span>            :     SplineChar *sc;
<span class="lineNum">    4668 </span>            :     int k, gid;
<span class="lineNum">    4669 </span>            :     SplineFont *sf;
<span class="lineNum">    4670 </span>            : 
<span class="lineNum">    4671 </span><span class="lineNoCov">          0 :     k=0;</span>
<span class="lineNum">    4672 </span>            :     do {
<span class="lineNum">    4673 </span><span class="lineNoCov">          0 :         sf = k&lt;vw-&gt;sf-&gt;subfontcnt ? vw-&gt;sf-&gt;subfonts[k] : vw-&gt;sf;</span>
<span class="lineNum">    4674 </span><span class="lineNoCov">          0 :         for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( (sc=sf-&gt;glyphs[gid])!=NULL ) {</span>
<span class="lineNum">    4675 </span><span class="lineNoCov">          0 :             sc-&gt;layers[vw-&gt;layer].validation_state = 0;</span>
<span class="lineNum">    4676 </span><span class="lineNoCov">          0 :             sc-&gt;layers[vw-&gt;layer].old_vs = 2;</span>
<span class="lineNum">    4677 </span>            :         }
<span class="lineNum">    4678 </span><span class="lineNoCov">          0 :         ++k;</span>
<span class="lineNum">    4679 </span><span class="lineNoCov">          0 :     } while ( k&lt;vw-&gt;sf-&gt;subfontcnt );</span>
<span class="lineNum">    4680 </span><span class="lineNoCov">          0 :     VW_Remetric(vw);</span>
<a name="4681"><span class="lineNum">    4681 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4682 </span>            : 
<span class="lineNum">    4683 </span><span class="lineNoCov">          0 : static void VWMenuRevalidate(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4684 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4685 </span><span class="lineNoCov">          0 :     int vs = vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4686 </span><span class="lineNoCov">          0 :     SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4687 </span><span class="lineNoCov">          0 :     if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4688 </span><span class="lineNoCov">          0 :         VW_Remetric(vw);</span>
<a name="4689"><span class="lineNum">    4689 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4690 </span>            : 
<span class="lineNum">    4691 </span><span class="lineNoCov">          0 : static void VWReuseCV(struct val_data *vw, SplineChar *sc) {</span>
<span class="lineNum">    4692 </span>            :     int k;
<span class="lineNum">    4693 </span>            :     SplineChar *sctest;
<span class="lineNum">    4694 </span><span class="lineNoCov">          0 :     SplineFont *sf = vw-&gt;sf;</span>
<span class="lineNum">    4695 </span>            :     CharView *cv;
<span class="lineNum">    4696 </span>            : 
<span class="lineNum">    4697 </span>            :     /* See if the last cv we used is still open. This is a little complex as */
<span class="lineNum">    4698 </span>            :     /*  we must make sure that the splinechar is still in the font, and then */
<span class="lineNum">    4699 </span>            :     /*  that the cv is still attached to it */
<span class="lineNum">    4700 </span><span class="lineNoCov">          0 :     cv = NULL;</span>
<span class="lineNum">    4701 </span><span class="lineNoCov">          0 :     if ( vw-&gt;lastgid!=-1 &amp;&amp; vw-&gt;lastcv!=NULL ) {</span>
<span class="lineNum">    4702 </span><span class="lineNoCov">          0 :         sctest = NULL;</span>
<span class="lineNum">    4703 </span><span class="lineNoCov">          0 :         if ( sf-&gt;subfontcnt==0 ) {</span>
<span class="lineNum">    4704 </span><span class="lineNoCov">          0 :             if ( vw-&gt;lastgid&lt;sf-&gt;glyphcnt )</span>
<span class="lineNum">    4705 </span><span class="lineNoCov">          0 :                 sctest = sf-&gt;glyphs[vw-&gt;lastgid];</span>
<span class="lineNum">    4706 </span>            :         } else {
<span class="lineNum">    4707 </span><span class="lineNoCov">          0 :             for ( k = 0; k&lt;sf-&gt;subfontcnt; ++k )</span>
<span class="lineNum">    4708 </span><span class="lineNoCov">          0 :                 if ( vw-&gt;lastgid&lt;sf-&gt;subfonts[k]-&gt;glyphcnt )</span>
<span class="lineNum">    4709 </span><span class="lineNoCov">          0 :                     if ( (sctest = sf-&gt;subfonts[k]-&gt;glyphs[vw-&gt;lastgid])!=NULL )</span>
<span class="lineNum">    4710 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    4711 </span>            :         }
<span class="lineNum">    4712 </span><span class="lineNoCov">          0 :         if ( sctest!=NULL )</span>
<span class="lineNum">    4713 </span><span class="lineNoCov">          0 :             for ( cv=(CharView *) (sctest-&gt;views); cv!=NULL &amp;&amp; cv!=vw-&gt;lastcv; cv=(CharView *) (cv-&gt;b.next) );</span>
<span class="lineNum">    4714 </span>            :     }
<span class="lineNum">    4715 </span><span class="lineNoCov">          0 :     if ( cv==NULL )</span>
<span class="lineNum">    4716 </span><span class="lineNoCov">          0 :         cv = CharViewCreate(sc,(FontView *) (vw-&gt;sf-&gt;fv),vw-&gt;sf-&gt;fv-&gt;map-&gt;backmap[sc-&gt;orig_pos]);</span>
<span class="lineNum">    4717 </span>            :     else {
<span class="lineNum">    4718 </span><span class="lineNoCov">          0 :         CVChangeSC(cv,sc);</span>
<span class="lineNum">    4719 </span><span class="lineNoCov">          0 :         GDrawSetVisible(cv-&gt;gw,true);</span>
<span class="lineNum">    4720 </span><span class="lineNoCov">          0 :         GDrawRaise(cv-&gt;gw);</span>
<span class="lineNum">    4721 </span>            :     }
<span class="lineNum">    4722 </span><span class="lineNoCov">          0 :     if ( CVLayer((CharViewBase *) cv)!=vw-&gt;layer )</span>
<span class="lineNum">    4723 </span><span class="lineNoCov">          0 :         CVSetLayer(cv,vw-&gt;layer);</span>
<span class="lineNum">    4724 </span><span class="lineNoCov">          0 :     vw-&gt;lastgid = sc-&gt;orig_pos;</span>
<span class="lineNum">    4725 </span><span class="lineNoCov">          0 :     vw-&gt;lastcv = cv;</span>
<span class="lineNum">    4726 </span>            : 
<span class="lineNum">    4727 </span><span class="lineNoCov">          0 :     if ( sc-&gt;layers[vw-&gt;layer].validation_state &amp; vs_maskfindproblems &amp; vw-&gt;mask )</span>
<span class="lineNum">    4728 </span><span class="lineNoCov">          0 :         DummyFindProblems(cv);</span>
<a name="4729"><span class="lineNum">    4729 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4730 </span>            : 
<span class="lineNum">    4731 </span><span class="lineNoCov">          0 : static void VWMenuOpenGlyph(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4732 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4733 </span><span class="lineNoCov">          0 :     VWReuseCV(vw,vw-&gt;sc);</span>
<a name="4734"><span class="lineNum">    4734 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4735 </span>            : 
<span class="lineNum">    4736 </span><span class="lineNoCov">          0 : static void VWMenuGotoGlyph(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4737 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4738 </span><span class="lineNoCov">          0 :     FontView *fv = (FontView *) (vw-&gt;sf-&gt;fv);</span>
<span class="lineNum">    4739 </span><span class="lineNoCov">          0 :     int enc = GotoChar(vw-&gt;sf,fv-&gt;b.map,NULL);</span>
<span class="lineNum">    4740 </span>            :     int gid, line;
<span class="lineNum">    4741 </span>            :     SplineChar *sc;
<span class="lineNum">    4742 </span>            : 
<span class="lineNum">    4743 </span><span class="lineNoCov">          0 :     if ( enc==-1 )</span>
<span class="lineNum">    4744 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    4745 </span><span class="lineNoCov">          0 :     gid = fv-&gt;b.map-&gt;map[enc];</span>
<span class="lineNum">    4746 </span><span class="lineNoCov">          0 :     if ( gid==-1 || (sc=vw-&gt;sf-&gt;glyphs[gid])==NULL ) {</span>
<span class="lineNum">    4747 </span><span class="lineNoCov">          0 :         ff_post_error(_(&quot;Glyph not in font&quot;), _(&quot;Glyph not in font&quot;));</span>
<span class="lineNum">    4748 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    4749 </span><span class="lineNoCov">          0 :     } else if ( (SCValidate(sc,vw-&gt;layer,true)&amp;vw-&gt;mask)==0 ) {</span>
<span class="lineNum">    4750 </span><span class="lineNoCov">          0 :         ff_post_notice(_(&quot;Glyph Valid&quot;), _(&quot;No problems detected in %s&quot;),</span>
<span class="lineNum">    4751 </span>            :                 sc-&gt;name );
<span class="lineNum">    4752 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    4753 </span>            :     }
<span class="lineNum">    4754 </span>            : 
<span class="lineNum">    4755 </span><span class="lineNoCov">          0 :     line = VW_FindSC(vw,sc);</span>
<span class="lineNum">    4756 </span><span class="lineNoCov">          0 :     if ( line==-1 )</span>
<span class="lineNum">    4757 </span><span class="lineNoCov">          0 :         IError(&quot;Glyph doesn't exist?&quot;);</span>
<span class="lineNum">    4758 </span>            : 
<span class="lineNum">    4759 </span><span class="lineNoCov">          0 :     if ( line + vw-&gt;vlcnt &gt; vw-&gt;lcnt )</span>
<span class="lineNum">    4760 </span><span class="lineNoCov">          0 :         line = vw-&gt;lcnt-vw-&gt;vlcnt;</span>
<span class="lineNum">    4761 </span><span class="lineNoCov">          0 :     if ( line&lt;0 )</span>
<span class="lineNum">    4762 </span><span class="lineNoCov">          0 :         line = 0;</span>
<span class="lineNum">    4763 </span><span class="lineNoCov">          0 :     if ( vw-&gt;loff_top!=line ) {</span>
<span class="lineNum">    4764 </span><span class="lineNoCov">          0 :         vw-&gt;loff_top = line;</span>
<span class="lineNum">    4765 </span><span class="lineNoCov">          0 :         GScrollBarSetPos(vw-&gt;vsb,line);</span>
<span class="lineNum">    4766 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(vw-&gt;v,NULL,false);</span>
<span class="lineNum">    4767 </span>            :     }
<span class="lineNum">    4768 </span>            : }
<span class="lineNum">    4769 </span>            :     
<span class="lineNum">    4770 </span>            : 
<span class="lineNum">    4771 </span>            : #define MID_SelectOpen  102
<span class="lineNum">    4772 </span>            : #define MID_SelectRO    103
<span class="lineNum">    4773 </span>            : #define MID_SelectDir   104
<span class="lineNum">    4774 </span>            : #define MID_SelectExtr  105
<a name="4775"><span class="lineNum">    4775 </span>            : #define MID_SelectErrors        106</a>
<span class="lineNum">    4776 </span>            : 
<span class="lineNum">    4777 </span><span class="lineNoCov">          0 : static void VWMenuSelect(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4778 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4779 </span><span class="lineNoCov">          0 :     FontView *fv = (FontView *) (vw-&gt;sf-&gt;fv);</span>
<span class="lineNum">    4780 </span><span class="lineNoCov">          0 :     int mask = mi-&gt;mid == MID_SelectErrors ? vw-&gt;mask :</span>
<span class="lineNum">    4781 </span><span class="lineNoCov">          0 :             mi-&gt;mid == MID_SelectOpen ? vs_opencontour :</span>
<span class="lineNum">    4782 </span><span class="lineNoCov">          0 :             mi-&gt;mid == MID_SelectRO ? vs_selfintersects :</span>
<span class="lineNum">    4783 </span><span class="lineNoCov">          0 :             mi-&gt;mid == MID_SelectDir ? vs_wrongdirection :</span>
<span class="lineNum">    4784 </span><span class="lineNoCov">          0 :             mi-&gt;mid == MID_SelectExtr ? vs_missingextrema : 0;</span>
<span class="lineNum">    4785 </span><span class="lineNoCov">          0 :     EncMap *map = fv-&gt;b.map;</span>
<span class="lineNum">    4786 </span>            :     int i, gid;
<span class="lineNum">    4787 </span>            :     SplineChar *sc;
<span class="lineNum">    4788 </span>            : 
<span class="lineNum">    4789 </span><span class="lineNoCov">          0 :     for ( i=0; i&lt;map-&gt;enccount; ++i ) {</span>
<span class="lineNum">    4790 </span><span class="lineNoCov">          0 :         fv-&gt;b.selected[i] = false;</span>
<span class="lineNum">    4791 </span><span class="lineNoCov">          0 :         gid = map-&gt;map[i];</span>
<span class="lineNum">    4792 </span><span class="lineNoCov">          0 :         if ( gid!=-1 &amp;&amp; (sc=vw-&gt;sf-&gt;glyphs[gid])!=NULL &amp;&amp;</span>
<span class="lineNum">    4793 </span><span class="lineNoCov">          0 :                 (SCValidate(sc,vw-&gt;layer,true) &amp; mask) )</span>
<span class="lineNum">    4794 </span><span class="lineNoCov">          0 :             fv-&gt;b.selected[i] = true;</span>
<span class="lineNum">    4795 </span>            :     }
<span class="lineNum">    4796 </span><span class="lineNoCov">          0 :     GDrawSetVisible(fv-&gt;gw,true);</span>
<span class="lineNum">    4797 </span><span class="lineNoCov">          0 :     GDrawRaise(fv-&gt;gw);</span>
<span class="lineNum">    4798 </span><span class="lineNoCov">          0 :     GDrawRequestExpose(fv-&gt;v,NULL,false);</span>
<span class="lineNum">    4799 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    4800 </span>            : 
<span class="lineNum">    4801 </span>            : static GMenuItem vw_subselect[] = {
<span class="lineNum">    4802 </span>            :     { { (unichar_t *) N_(&quot;problselect|Errors&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, NULL, NULL, VWMenuSelect, MID_SelectErrors },
<span class="lineNum">    4803 </span>            :     { { (unichar_t *) N_(&quot;problselect|Open Contours&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, NULL, NULL, VWMenuSelect, MID_SelectOpen },
<span class="lineNum">    4804 </span>            :     { { (unichar_t *) N_(&quot;problselect|Bad Direction&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, NULL, NULL, VWMenuSelect, MID_SelectDir },
<span class="lineNum">    4805 </span>            :     { { (unichar_t *) N_(&quot;problselect|Self Intersections&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, NULL, NULL, VWMenuSelect, MID_SelectRO },
<span class="lineNum">    4806 </span>            :     { { (unichar_t *) N_(&quot;problselect|Missing Extrema&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, NULL, NULL, VWMenuSelect, MID_SelectExtr },
<span class="lineNum">    4807 </span>            :     GMENUITEM_EMPTY
<a name="4808"><span class="lineNum">    4808 </span>            : };</a>
<span class="lineNum">    4809 </span>            : 
<span class="lineNum">    4810 </span><span class="lineNoCov">          0 : static void VWMenuManyConnect(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4811 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4812 </span>            :     SplineChar *sc;
<span class="lineNum">    4813 </span>            :     int k, gid;
<span class="lineNum">    4814 </span>            :     SplineFont *sf;
<span class="lineNum">    4815 </span>            : 
<span class="lineNum">    4816 </span><span class="lineNoCov">          0 :     k=0;</span>
<span class="lineNum">    4817 </span>            :     do {
<span class="lineNum">    4818 </span><span class="lineNoCov">          0 :         sf = k&lt;vw-&gt;sf-&gt;subfontcnt ? vw-&gt;sf-&gt;subfonts[k] : vw-&gt;sf;</span>
<span class="lineNum">    4819 </span><span class="lineNoCov">          0 :         for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( (sc=sf-&gt;glyphs[gid])!=NULL &amp;&amp; (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_opencontour) ) {</span>
<span class="lineNum">    4820 </span><span class="lineNoCov">          0 :             int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4821 </span><span class="lineNoCov">          0 :             int changed = false;</span>
<span class="lineNum">    4822 </span>            :             SplineSet *ss;
<span class="lineNum">    4823 </span>            : 
<span class="lineNum">    4824 </span><span class="lineNoCov">          0 :             for ( ss=sc-&gt;layers[vw-&gt;layer].splines; ss!=NULL; ss=ss-&gt;next ) {</span>
<span class="lineNum">    4825 </span><span class="lineNoCov">          0 :                 if ( ss-&gt;first-&gt;prev==NULL &amp;&amp; ss-&gt;first-&gt;next!=NULL ) {</span>
<span class="lineNum">    4826 </span><span class="lineNoCov">          0 :                     if ( !changed ) {</span>
<span class="lineNum">    4827 </span><span class="lineNoCov">          0 :                         SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4828 </span><span class="lineNoCov">          0 :                         changed = true;</span>
<span class="lineNum">    4829 </span>            :                     }
<span class="lineNum">    4830 </span><span class="lineNoCov">          0 :                     SplineMake(ss-&gt;last,ss-&gt;first,sc-&gt;layers[vw-&gt;layer].order2);</span>
<span class="lineNum">    4831 </span><span class="lineNoCov">          0 :                     ss-&gt;last = ss-&gt;first;</span>
<span class="lineNum">    4832 </span>            :                 }
<span class="lineNum">    4833 </span>            :             }
<span class="lineNum">    4834 </span><span class="lineNoCov">          0 :             if ( changed ) {</span>
<span class="lineNum">    4835 </span><span class="lineNoCov">          0 :                 SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4836 </span><span class="lineNoCov">          0 :                 SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4837 </span><span class="lineNoCov">          0 :                 if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4838 </span><span class="lineNoCov">          0 :                     VW_Remetric(vw);</span>
<span class="lineNum">    4839 </span>            :             }
<span class="lineNum">    4840 </span>            :         }
<span class="lineNum">    4841 </span><span class="lineNoCov">          0 :         ++k;</span>
<span class="lineNum">    4842 </span><span class="lineNoCov">          0 :     } while ( k&lt;vw-&gt;sf-&gt;subfontcnt );</span>
<a name="4843"><span class="lineNum">    4843 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4844 </span>            : 
<span class="lineNum">    4845 </span><span class="lineNoCov">          0 : static void VWMenuManyOverlap(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4846 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4847 </span>            :     SplineChar *sc;
<span class="lineNum">    4848 </span>            :     int k, gid;
<span class="lineNum">    4849 </span>            :     SplineFont *sf;
<span class="lineNum">    4850 </span>            : 
<span class="lineNum">    4851 </span><span class="lineNoCov">          0 :     k=0;</span>
<span class="lineNum">    4852 </span>            :     do {
<span class="lineNum">    4853 </span><span class="lineNoCov">          0 :         sf = k&lt;vw-&gt;sf-&gt;subfontcnt ? vw-&gt;sf-&gt;subfonts[k] : vw-&gt;sf;</span>
<span class="lineNum">    4854 </span><span class="lineNoCov">          0 :         for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( (sc=sf-&gt;glyphs[gid])!=NULL &amp;&amp; (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_selfintersects) ) {</span>
<span class="lineNum">    4855 </span><span class="lineNoCov">          0 :             int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4856 </span>            : 
<span class="lineNum">    4857 </span>            :             /* If it's only got references, I could inline them, since the */
<span class="lineNum">    4858 </span>            :             /*  intersection would occur between two refs. But that seems */
<span class="lineNum">    4859 </span>            :             /*  to extreme to do to an unsuspecting user */
<span class="lineNum">    4860 </span><span class="lineNoCov">          0 :             if ( !SCRoundToCluster(sc,ly_all,false,.03,.12))</span>
<span class="lineNum">    4861 </span><span class="lineNoCov">          0 :                 SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4862 </span><span class="lineNoCov">          0 :             sc-&gt;layers[vw-&gt;layer].splines = SplineSetRemoveOverlap(sc,sc-&gt;layers[vw-&gt;layer].splines,over_remove);</span>
<span class="lineNum">    4863 </span><span class="lineNoCov">          0 :             SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4864 </span><span class="lineNoCov">          0 :             SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4865 </span><span class="lineNoCov">          0 :             if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4866 </span><span class="lineNoCov">          0 :                 VW_Remetric(vw);</span>
<span class="lineNum">    4867 </span>            :         }
<span class="lineNum">    4868 </span><span class="lineNoCov">          0 :         ++k;</span>
<span class="lineNum">    4869 </span><span class="lineNoCov">          0 :     } while ( k&lt;vw-&gt;sf-&gt;subfontcnt );</span>
<a name="4870"><span class="lineNum">    4870 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4871 </span>            : 
<span class="lineNum">    4872 </span><span class="lineNoCov">          0 : static void VWMenuManyMark(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4873 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4874 </span>            :     SplineChar *sc;
<span class="lineNum">    4875 </span>            :     int k, gid;
<span class="lineNum">    4876 </span>            :     SplineFont *sf;
<span class="lineNum">    4877 </span>            : 
<span class="lineNum">    4878 </span><span class="lineNoCov">          0 :     k=0;</span>
<span class="lineNum">    4879 </span>            :     do {
<span class="lineNum">    4880 </span><span class="lineNoCov">          0 :         sf = k&lt;vw-&gt;sf-&gt;subfontcnt ? vw-&gt;sf-&gt;subfonts[k] : vw-&gt;sf;</span>
<span class="lineNum">    4881 </span><span class="lineNoCov">          0 :         for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( (sc=sf-&gt;glyphs[gid])!=NULL &amp;&amp;</span>
<span class="lineNum">    4882 </span><span class="lineNoCov">          0 :                 (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_selfintersects) &amp;&amp;</span>
<span class="lineNum">    4883 </span><span class="lineNoCov">          0 :                 sc-&gt;layers[vw-&gt;layer].refs!=NULL &amp;&amp;</span>
<span class="lineNum">    4884 </span><span class="lineNoCov">          0 :                 sc-&gt;layers[vw-&gt;layer].refs-&gt;next!=NULL &amp;&amp;</span>
<span class="lineNum">    4885 </span><span class="lineNoCov">          0 :                 sc-&gt;layers[vw-&gt;layer].splines==NULL ) {</span>
<span class="lineNum">    4886 </span><span class="lineNoCov">          0 :             sc-&gt;unlink_rm_ovrlp_save_undo = true;</span>
<span class="lineNum">    4887 </span><span class="lineNoCov">          0 :             VW_Remetric(vw);</span>
<span class="lineNum">    4888 </span>            :         }
<span class="lineNum">    4889 </span><span class="lineNoCov">          0 :         ++k;</span>
<span class="lineNum">    4890 </span><span class="lineNoCov">          0 :     } while ( k&lt;vw-&gt;sf-&gt;subfontcnt );</span>
<a name="4891"><span class="lineNum">    4891 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4892 </span>            : 
<span class="lineNum">    4893 </span><span class="lineNoCov">          0 : static void VWMenuManyCorrectDir(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4894 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4895 </span>            :     SplineChar *sc;
<span class="lineNum">    4896 </span>            :     int k, gid;
<span class="lineNum">    4897 </span>            :     SplineFont *sf;
<span class="lineNum">    4898 </span>            :     RefChar *ref, *refnext;
<span class="lineNum">    4899 </span>            :     int changed;
<span class="lineNum">    4900 </span>            : 
<span class="lineNum">    4901 </span><span class="lineNoCov">          0 :     k=0;</span>
<span class="lineNum">    4902 </span>            :     do {
<span class="lineNum">    4903 </span><span class="lineNoCov">          0 :         sf = k&lt;vw-&gt;sf-&gt;subfontcnt ? vw-&gt;sf-&gt;subfonts[k] : vw-&gt;sf;</span>
<span class="lineNum">    4904 </span><span class="lineNoCov">          0 :         for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( (sc=sf-&gt;glyphs[gid])!=NULL &amp;&amp; (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_wrongdirection) ) {</span>
<span class="lineNum">    4905 </span><span class="lineNoCov">          0 :             int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4906 </span>            : 
<span class="lineNum">    4907 </span><span class="lineNoCov">          0 :             SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4908 </span>            :             /* But a flipped reference is just wrong so I have no compunctions*/
<span class="lineNum">    4909 </span>            :             /*  about inlining it and then correcting its direction */
<span class="lineNum">    4910 </span>            :             
<span class="lineNum">    4911 </span><span class="lineNoCov">          0 :             for ( ref= sc-&gt;layers[vw-&gt;layer].refs; ref!=NULL; ref=refnext ) {</span>
<span class="lineNum">    4912 </span><span class="lineNoCov">          0 :                 refnext = ref-&gt;next;</span>
<span class="lineNum">    4913 </span><span class="lineNoCov">          0 :                 if ( ref-&gt;transform[0]*ref-&gt;transform[3]&lt;0 ||</span>
<span class="lineNum">    4914 </span><span class="lineNoCov">          0 :                         (ref-&gt;transform[0]==0 &amp;&amp; ref-&gt;transform[1]*ref-&gt;transform[2]&gt;0)) {</span>
<span class="lineNum">    4915 </span><span class="lineNoCov">          0 :                     SCRefToSplines(sc,ref,vw-&gt;layer);</span>
<span class="lineNum">    4916 </span>            :                 }
<span class="lineNum">    4917 </span>            :             }
<span class="lineNum">    4918 </span><span class="lineNoCov">          0 :             sc-&gt;layers[vw-&gt;layer].splines = SplineSetsCorrect(sc-&gt;layers[vw-&gt;layer].splines,&amp;changed);</span>
<span class="lineNum">    4919 </span><span class="lineNoCov">          0 :             SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4920 </span><span class="lineNoCov">          0 :             SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4921 </span><span class="lineNoCov">          0 :             if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4922 </span><span class="lineNoCov">          0 :                 VW_Remetric(vw);</span>
<span class="lineNum">    4923 </span>            :         }
<span class="lineNum">    4924 </span><span class="lineNoCov">          0 :         ++k;</span>
<span class="lineNum">    4925 </span><span class="lineNoCov">          0 :     } while ( k&lt;vw-&gt;sf-&gt;subfontcnt );</span>
<a name="4926"><span class="lineNum">    4926 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4927 </span>            : 
<span class="lineNum">    4928 </span><span class="lineNoCov">          0 : static void VWMenuManyGoodExtrema(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4929 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4930 </span>            :     SplineChar *sc;
<span class="lineNum">    4931 </span>            :     int k, gid;
<span class="lineNum">    4932 </span><span class="lineNoCov">          0 :     SplineFont *sf = vw-&gt;sf;</span>
<span class="lineNum">    4933 </span><span class="lineNoCov">          0 :     int emsize = sf-&gt;ascent+sf-&gt;descent;</span>
<span class="lineNum">    4934 </span>            : 
<span class="lineNum">    4935 </span><span class="lineNoCov">          0 :     k=0;</span>
<span class="lineNum">    4936 </span>            :     do {
<span class="lineNum">    4937 </span><span class="lineNoCov">          0 :         sf = k&lt;vw-&gt;sf-&gt;subfontcnt ? vw-&gt;sf-&gt;subfonts[k] : vw-&gt;sf;</span>
<span class="lineNum">    4938 </span><span class="lineNoCov">          0 :         for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( (sc=sf-&gt;glyphs[gid])!=NULL &amp;&amp; (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_missingextrema) ) {</span>
<span class="lineNum">    4939 </span><span class="lineNoCov">          0 :             int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4940 </span>            : 
<span class="lineNum">    4941 </span><span class="lineNoCov">          0 :             SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4942 </span><span class="lineNoCov">          0 :             SplineCharAddExtrema(sc,sc-&gt;layers[vw-&gt;layer].splines,ae_only_good,emsize);</span>
<span class="lineNum">    4943 </span><span class="lineNoCov">          0 :             SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4944 </span><span class="lineNoCov">          0 :             SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4945 </span><span class="lineNoCov">          0 :             if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4946 </span><span class="lineNoCov">          0 :                 VW_Remetric(vw);</span>
<span class="lineNum">    4947 </span>            :         }
<span class="lineNum">    4948 </span><span class="lineNoCov">          0 :         ++k;</span>
<span class="lineNum">    4949 </span><span class="lineNoCov">          0 :     } while ( k&lt;vw-&gt;sf-&gt;subfontcnt );</span>
<a name="4950"><span class="lineNum">    4950 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4951 </span>            : 
<span class="lineNum">    4952 </span><span class="lineNoCov">          0 : static void VWMenuManyAllExtrema(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4953 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4954 </span>            :     SplineChar *sc;
<span class="lineNum">    4955 </span>            :     int k, gid;
<span class="lineNum">    4956 </span><span class="lineNoCov">          0 :     SplineFont *sf = vw-&gt;sf;</span>
<span class="lineNum">    4957 </span><span class="lineNoCov">          0 :     int emsize = sf-&gt;ascent+sf-&gt;descent;</span>
<span class="lineNum">    4958 </span>            : 
<span class="lineNum">    4959 </span><span class="lineNoCov">          0 :     k=0;</span>
<span class="lineNum">    4960 </span>            :     do {
<span class="lineNum">    4961 </span><span class="lineNoCov">          0 :         sf = k&lt;vw-&gt;sf-&gt;subfontcnt ? vw-&gt;sf-&gt;subfonts[k] : vw-&gt;sf;</span>
<span class="lineNum">    4962 </span><span class="lineNoCov">          0 :         for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( (sc=sf-&gt;glyphs[gid])!=NULL &amp;&amp; (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_missingextrema) ) {</span>
<span class="lineNum">    4963 </span><span class="lineNoCov">          0 :             int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4964 </span>            : 
<span class="lineNum">    4965 </span><span class="lineNoCov">          0 :             SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4966 </span><span class="lineNoCov">          0 :             SplineCharAddExtrema(sc,sc-&gt;layers[vw-&gt;layer].splines,ae_all,emsize);</span>
<span class="lineNum">    4967 </span><span class="lineNoCov">          0 :             SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4968 </span><span class="lineNoCov">          0 :             SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4969 </span><span class="lineNoCov">          0 :             if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4970 </span><span class="lineNoCov">          0 :                 VW_Remetric(vw);</span>
<span class="lineNum">    4971 </span>            :         }
<span class="lineNum">    4972 </span><span class="lineNoCov">          0 :         ++k;</span>
<span class="lineNum">    4973 </span><span class="lineNoCov">          0 :     } while ( k&lt;vw-&gt;sf-&gt;subfontcnt );</span>
<a name="4974"><span class="lineNum">    4974 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4975 </span>            : 
<span class="lineNum">    4976 </span><span class="lineNoCov">          0 : static void VWMenuManySimplify(GWindow gw,struct gmenuitem *mi,GEvent *e) {</span>
<span class="lineNum">    4977 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    4978 </span>            :     SplineChar *sc;
<span class="lineNum">    4979 </span>            :     int k, gid;
<span class="lineNum">    4980 </span>            :     SplineFont *sf;
<span class="lineNum">    4981 </span>            :     static struct simplifyinfo smpl = { sf_normal, 0.75, 0.05, 0, -1, 0, 0 };
<span class="lineNum">    4982 </span>            : 
<span class="lineNum">    4983 </span><span class="lineNoCov">          0 :     k=0;</span>
<span class="lineNum">    4984 </span>            :     do {
<span class="lineNum">    4985 </span><span class="lineNoCov">          0 :         sf = k&lt;vw-&gt;sf-&gt;subfontcnt ? vw-&gt;sf-&gt;subfonts[k] : vw-&gt;sf;</span>
<span class="lineNum">    4986 </span><span class="lineNoCov">          0 :         for ( gid=0; gid&lt;sf-&gt;glyphcnt; ++gid ) if ( (sc=sf-&gt;glyphs[gid])!=NULL &amp;&amp; (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_toomanypoints) ) {</span>
<span class="lineNum">    4987 </span><span class="lineNoCov">          0 :             int vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    4988 </span>            : 
<span class="lineNum">    4989 </span><span class="lineNoCov">          0 :             SCPreserveLayer(sc,vw-&gt;layer,false);</span>
<span class="lineNum">    4990 </span><span class="lineNoCov">          0 :             sc-&gt;layers[vw-&gt;layer].splines = SplineCharSimplify(sc,sc-&gt;layers[vw-&gt;layer].splines,&amp;smpl);</span>
<span class="lineNum">    4991 </span><span class="lineNoCov">          0 :             SCCharChangedUpdate(sc,vw-&gt;layer);</span>
<span class="lineNum">    4992 </span><span class="lineNoCov">          0 :             SCValidate(vw-&gt;sc,vw-&gt;layer,true);</span>
<span class="lineNum">    4993 </span><span class="lineNoCov">          0 :             if ( vs != vw-&gt;sc-&gt;layers[vw-&gt;layer].validation_state )</span>
<span class="lineNum">    4994 </span><span class="lineNoCov">          0 :                 VW_Remetric(vw);</span>
<span class="lineNum">    4995 </span>            :         }
<span class="lineNum">    4996 </span><span class="lineNoCov">          0 :         ++k;</span>
<span class="lineNum">    4997 </span><span class="lineNoCov">          0 :     } while ( k&lt;vw-&gt;sf-&gt;subfontcnt );</span>
<span class="lineNum">    4998 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    4999 </span>            : 
<span class="lineNum">    5000 </span>            : static GMenuItem vw_subfixup[] = {
<span class="lineNum">    5001 </span>            :     { { (unichar_t *) N_(&quot;problfixup|Open Contours&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, NULL, NULL, VWMenuManyConnect, 0 },
<span class="lineNum">    5002 </span>            :     { { (unichar_t *) N_(&quot;problfixup|Self Intersections&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuManyOverlap, 0 },
<span class="lineNum">    5003 </span>            :     { { (unichar_t *) N_(&quot;problfixup|Mark for Overlap fix before Save&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuManyMark, 0 },
<span class="lineNum">    5004 </span>            :     { { (unichar_t *) N_(&quot;problfixup|Bad Directions&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuManyCorrectDir, 0 },
<span class="lineNum">    5005 </span>            :     { { (unichar_t *) N_(&quot;problfixup|Missing Extrema (cautiously)&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuManyGoodExtrema, 0 },
<span class="lineNum">    5006 </span>            :     { { (unichar_t *) N_(&quot;problfixup|Missing Extrema&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuManyAllExtrema, 0 },
<span class="lineNum">    5007 </span>            :     { { (unichar_t *) N_(&quot;problfixup|Too Many Points&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuManySimplify, 0 },
<span class="lineNum">    5008 </span>            :     GMENUITEM_EMPTY
<span class="lineNum">    5009 </span>            : };
<span class="lineNum">    5010 </span>            : 
<span class="lineNum">    5011 </span>            : static GMenuItem vw_popuplist[] = {
<span class="lineNum">    5012 </span>            :     { { (unichar_t *) N_(&quot;Close Open Contours&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, NULL, NULL, VWMenuConnect, 0 },
<span class="lineNum">    5013 </span>            :     { { (unichar_t *) N_(&quot;Inline All References&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuInlineRefs, 0 },
<span class="lineNum">    5014 </span>            :     { { (unichar_t *) N_(&quot;Remove Overlap&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuOverlap, 0 },
<span class="lineNum">    5015 </span>            :     { { (unichar_t *) N_(&quot;Mark for Overlap fix before Save&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuMark, 0 },
<span class="lineNum">    5016 </span>            :     { { (unichar_t *) N_(&quot;Inline Flipped References&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuInlineFlippedRefs, 0 },
<span class="lineNum">    5017 </span>            :     { { (unichar_t *) N_(&quot;Correct Direction&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuCorrectDir, 0 },
<span class="lineNum">    5018 </span>            :     { { (unichar_t *) N_(&quot;Add Good Extrema&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0',0, NULL, NULL, VWMenuGoodExtrema, 0 },
<span class="lineNum">    5019 </span>            :     { { (unichar_t *) N_(&quot;Add All Extrema&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuAllExtrema, 0 },
<span class="lineNum">    5020 </span>            :     { { (unichar_t *) N_(&quot;Simplify&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, true, 0, 0, 0, 0, 1, 1, 0, 0 }, '\0', 0, NULL, NULL, VWMenuSimplify, 0 },
<span class="lineNum">    5021 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 1, 0, 0, 0, '\0' }, '\0', 0, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">    5022 </span>            :     { { (unichar_t *) N_(&quot;Revalidate All&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, NULL, NULL, VWMenuRevalidateAll, 0 },
<span class="lineNum">    5023 </span>            :     { { (unichar_t *) N_(&quot;Revalidate&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, NULL, NULL, VWMenuRevalidate, 0 },
<span class="lineNum">    5024 </span>            :     { { (unichar_t *) N_(&quot;Open Glyph&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, NULL, NULL, VWMenuOpenGlyph, 0 },
<span class="lineNum">    5025 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 1, 0, 0, 0, '\0' }, '\0', 0, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">    5026 </span>            :     { { (unichar_t *) N_(&quot;Scroll To Glyph&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, NULL, NULL, VWMenuGotoGlyph, 0 },
<span class="lineNum">    5027 </span>            :     { { NULL, NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 1, 0, 0, 0, '\0' }, '\0', 0, NULL, NULL, NULL, 0 }, /* line */
<span class="lineNum">    5028 </span>            :     { { (unichar_t *) N_(&quot;Select Glyphs With&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, vw_subselect, NULL, NULL, 0 },
<span class="lineNum">    5029 </span>            :     { { (unichar_t *) N_(&quot;Try To Fix Glyphs With&quot;), NULL, COLOR_DEFAULT, COLOR_DEFAULT, NULL, NULL, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 }, '\0', 0, vw_subfixup, NULL, NULL, 0 },
<span class="lineNum">    5030 </span>            :     GMENUITEM_EMPTY
<a name="5031"><span class="lineNum">    5031 </span>            : };</a>
<span class="lineNum">    5032 </span>            : 
<span class="lineNum">    5033 </span><span class="lineNoCov">          0 : static void VWMouse(struct val_data *vw, GEvent *e) {</span>
<span class="lineNum">    5034 </span>            :     int skips;
<span class="lineNum">    5035 </span><span class="lineNoCov">          0 :     int gid = VW_FindLine(vw,vw-&gt;loff_top + e-&gt;u.mouse.y/vw-&gt;fh, &amp;skips);</span>
<span class="lineNum">    5036 </span>            :     SplineChar *sc;
<span class="lineNum">    5037 </span><span class="lineNoCov">          0 :     int k=0;</span>
<span class="lineNum">    5038 </span>            : 
<span class="lineNum">    5039 </span><span class="lineNoCov">          0 :     if ( gid==-2 &amp;&amp; e-&gt;u.mouse.clicks==2 &amp;&amp; e-&gt;type==et_mouseup ) {</span>
<span class="lineNum">    5040 </span><span class="lineNoCov">          0 :         FontInfo(vw-&gt;sf,vw-&gt;layer,4,false);       /* Bring up the Private Dict */</span>
<span class="lineNum">    5041 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5042 </span>            :     }
<span class="lineNum">    5043 </span><span class="lineNoCov">          0 :     if ( gid&lt;0 )</span>
<span class="lineNum">    5044 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5045 </span><span class="lineNoCov">          0 :     if ( vw-&gt;sf-&gt;subfontcnt==0 ) {</span>
<span class="lineNum">    5046 </span><span class="lineNoCov">          0 :         if ( (sc = vw-&gt;sf-&gt;glyphs[gid])==NULL )</span>
<span class="lineNum">    5047 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5048 </span>            :     } else {
<span class="lineNum">    5049 </span><span class="lineNoCov">          0 :         sc = NULL;</span>
<span class="lineNum">    5050 </span><span class="lineNoCov">          0 :         for ( k=0; k&lt;vw-&gt;sf-&gt;subfontcnt; ++k ) {</span>
<span class="lineNum">    5051 </span><span class="lineNoCov">          0 :             if ( gid&lt;vw-&gt;sf-&gt;subfonts[k]-&gt;glyphcnt &amp;&amp;</span>
<span class="lineNum">    5052 </span><span class="lineNoCov">          0 :                     (sc=vw-&gt;sf-&gt;subfonts[k]-&gt;glyphs[gid])!=NULL )</span>
<span class="lineNum">    5053 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">    5054 </span>            :         }
<span class="lineNum">    5055 </span><span class="lineNoCov">          0 :         if ( sc==NULL )</span>
<span class="lineNum">    5056 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5057 </span>            :     }
<span class="lineNum">    5058 </span>            : 
<span class="lineNum">    5059 </span><span class="lineNoCov">          0 :     if ( e-&gt;u.mouse.clicks==2 &amp;&amp; e-&gt;type==et_mouseup ) {</span>
<span class="lineNum">    5060 </span><span class="lineNoCov">          0 :         VWReuseCV(vw,sc);</span>
<span class="lineNum">    5061 </span><span class="lineNoCov">          0 :     } else if ( e-&gt;type==et_mouseup &amp;&amp; e-&gt;u.mouse.x&lt;10+vw-&gt;as &amp;&amp; skips==0 ) {</span>
<span class="lineNum">    5062 </span><span class="lineNoCov">          0 :         sc-&gt;vs_open = !sc-&gt;vs_open;</span>
<span class="lineNum">    5063 </span><span class="lineNoCov">          0 :         VW_Remetric(vw);</span>
<span class="lineNum">    5064 </span><span class="lineNoCov">          0 :     } else if ( e-&gt;type==et_mousedown &amp;&amp; e-&gt;u.mouse.button==3 ) {</span>
<span class="lineNum">    5065 </span>            :         static int initted = false;
<span class="lineNum">    5066 </span><span class="lineNoCov">          0 :         if ( !initted ) {</span>
<span class="lineNum">    5067 </span>            :             int i;
<span class="lineNum">    5068 </span><span class="lineNoCov">          0 :             initted = true;</span>
<span class="lineNum">    5069 </span>            : 
<span class="lineNum">    5070 </span><span class="lineNoCov">          0 :             for ( i=0; vw_popuplist[i].ti.text!=NULL || vw_popuplist[i].ti.line; ++i )</span>
<span class="lineNum">    5071 </span><span class="lineNoCov">          0 :                 if ( vw_popuplist[i].ti.text!=NULL )</span>
<span class="lineNum">    5072 </span><span class="lineNoCov">          0 :                     vw_popuplist[i].ti.text = (unichar_t *) _( (char *)vw_popuplist[i].ti.text);</span>
<span class="lineNum">    5073 </span>            : 
<span class="lineNum">    5074 </span><span class="lineNoCov">          0 :             for (i=0; vw_subfixup[i].ti.text!=NULL || vw_subfixup[i].ti.line; ++i )</span>
<span class="lineNum">    5075 </span><span class="lineNoCov">          0 :                 if ( vw_subfixup[i].ti.text!=NULL )</span>
<span class="lineNum">    5076 </span><span class="lineNoCov">          0 :                     vw_subfixup[i].ti.text = (unichar_t *) S_( (char *)vw_subfixup[i].ti.text);</span>
<span class="lineNum">    5077 </span>            : 
<span class="lineNum">    5078 </span><span class="lineNoCov">          0 :             for (i=0; vw_subselect[i].ti.text!=NULL || vw_subselect[i].ti.line; ++i )</span>
<span class="lineNum">    5079 </span><span class="lineNoCov">          0 :                 if ( vw_subselect[i].ti.text!=NULL )</span>
<span class="lineNum">    5080 </span><span class="lineNoCov">          0 :                     vw_subselect[i].ti.text = (unichar_t *) S_( (char *)vw_subselect[i].ti.text);</span>
<span class="lineNum">    5081 </span>            :         }
<span class="lineNum">    5082 </span><span class="lineNoCov">          0 :         vw_popuplist[0].ti.disabled = (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_opencontour)?0:1;</span>
<span class="lineNum">    5083 </span><span class="lineNoCov">          0 :         vw_popuplist[1].ti.disabled = (SCValidate(sc,vw-&gt;layer,true)&amp;vs_selfintersects)?0:1;</span>
<span class="lineNum">    5084 </span><span class="lineNoCov">          0 :         vw_popuplist[2].ti.disabled = (SCValidate(sc,vw-&gt;layer,true)&amp;vs_selfintersects)?0:1;</span>
<span class="lineNum">    5085 </span><span class="lineNoCov">          0 :         vw_popuplist[3].ti.disabled = (SCValidate(sc,vw-&gt;layer,true)&amp;vs_selfintersects) &amp;&amp;</span>
<span class="lineNum">    5086 </span><span class="lineNoCov">          0 :                     sc-&gt;layers[vw-&gt;layer].refs!=NULL?0:1;</span>
<span class="lineNum">    5087 </span><span class="lineNoCov">          0 :         vw_popuplist[4].ti.disabled = (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_flippedreferences)?0:1;</span>
<span class="lineNum">    5088 </span><span class="lineNoCov">          0 :         vw_popuplist[5].ti.disabled = (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_wrongdirection)?0:1;</span>
<span class="lineNum">    5089 </span><span class="lineNoCov">          0 :         vw_popuplist[6].ti.disabled = (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_missingextrema)?0:1;</span>
<span class="lineNum">    5090 </span><span class="lineNoCov">          0 :         vw_popuplist[7].ti.disabled = (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_missingextrema)?0:1;</span>
<span class="lineNum">    5091 </span><span class="lineNoCov">          0 :         vw_popuplist[8].ti.disabled = (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_toomanypoints)?0:1;</span>
<span class="lineNum">    5092 </span><span class="lineNoCov">          0 :         vw-&gt;sc = sc;</span>
<span class="lineNum">    5093 </span><span class="lineNoCov">          0 :         GMenuCreatePopupMenu(vw-&gt;v,e, vw_popuplist);</span>
<span class="lineNum">    5094 </span>            :     }
<a name="5095"><span class="lineNum">    5095 </span>            : }</a>
<span class="lineNum">    5096 </span>            : 
<span class="lineNum">    5097 </span><span class="lineNoCov">          0 : static void VWDrawWindow(GWindow pixmap,struct val_data *vw, GEvent *e) {</span>
<span class="lineNum">    5098 </span><span class="lineNoCov">          0 :     int gid,k, cidmax = vw-&gt;cidmax;</span>
<span class="lineNum">    5099 </span><span class="lineNoCov">          0 :     SplineFont *sub, *sf=vw-&gt;sf;</span>
<span class="lineNum">    5100 </span>            :     SplineChar *sc;
<span class="lineNum">    5101 </span>            :     int sofar;
<span class="lineNum">    5102 </span>            :     int bit, skips, vs, y, m;
<span class="lineNum">    5103 </span>            :     GRect old, r;
<span class="lineNum">    5104 </span>            : 
<span class="lineNum">    5105 </span><span class="lineNoCov">          0 :     GDrawPushClip(pixmap,&amp;e-&gt;u.expose.rect,&amp;old);</span>
<span class="lineNum">    5106 </span><span class="lineNoCov">          0 :     GDrawSetFont(pixmap,vw-&gt;font);</span>
<span class="lineNum">    5107 </span><span class="lineNoCov">          0 :     gid = VW_FindLine(vw,vw-&gt;loff_top, &amp;skips);</span>
<span class="lineNum">    5108 </span><span class="lineNoCov">          0 :     if ( gid==-1 ) {</span>
<span class="lineNum">    5109 </span><span class="lineNoCov">          0 :         GDrawDrawText8(pixmap,2,(vw-&gt;vlcnt-1)*vw-&gt;fh/2 + vw-&gt;as,</span>
<span class="lineNum">    5110 </span><span class="lineNoCov">          0 :                 vw-&gt;finished_first_pass ? _(&quot;Passed Validation&quot;) : _(&quot;Thinking...&quot;),</span>
<span class="lineNum">    5111 </span>            :                 -1,0x000000 );
<span class="lineNum">    5112 </span><span class="lineNoCov">          0 :         GDrawPopClip(pixmap,&amp;old);</span>
<span class="lineNum">    5113 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5114 </span>            :     }
<span class="lineNum">    5115 </span>            : 
<span class="lineNum">    5116 </span><span class="lineNoCov">          0 :     y = vw-&gt;as - skips*vw-&gt;fh;</span>
<span class="lineNum">    5117 </span><span class="lineNoCov">          0 :     sofar = -skips;</span>
<span class="lineNum">    5118 </span><span class="lineNoCov">          0 :     r.width = r.height = vw-&gt;as;</span>
<span class="lineNum">    5119 </span><span class="lineNoCov">          0 :     if ( gid!=-2 ) {</span>
<span class="lineNum">    5120 </span><span class="lineNoCov">          0 :         for ( ; gid&lt;cidmax &amp;&amp; sofar&lt;vw-&gt;vlcnt ; ++gid ) {</span>
<span class="lineNum">    5121 </span><span class="lineNoCov">          0 :             if ( sf-&gt;subfontcnt==0 )</span>
<span class="lineNum">    5122 </span><span class="lineNoCov">          0 :                 sc = sf-&gt;glyphs[gid];</span>
<span class="lineNum">    5123 </span>            :             else {
<span class="lineNum">    5124 </span><span class="lineNoCov">          0 :                 for ( k=0; k&lt;sf-&gt;subfontcnt; ++k ) {</span>
<span class="lineNum">    5125 </span><span class="lineNoCov">          0 :                     sub = sf-&gt;subfonts[k];</span>
<span class="lineNum">    5126 </span><span class="lineNoCov">          0 :                     if ( gid&lt;sub-&gt;glyphcnt &amp;&amp; (sc = sub-&gt;glyphs[gid])!=NULL )</span>
<span class="lineNum">    5127 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    5128 </span>            :                 }
<span class="lineNum">    5129 </span>            :             }
<span class="lineNum">    5130 </span>            :             /* Ignore it if it has not been validated */
<span class="lineNum">    5131 </span>            :             /* Ignore it if it is good */
<span class="lineNum">    5132 </span><span class="lineNoCov">          0 :             vs = VSModMask(sc,vw);</span>
<span class="lineNum">    5133 </span><span class="lineNoCov">          0 :             if ((vs&amp;vs_known) &amp;&amp; (vs&amp;vw-&gt;mask)!=0 ) {</span>
<span class="lineNum">    5134 </span><span class="lineNoCov">          0 :                 r.x = 2;   r.y = y-vw-&gt;as+1;</span>
<span class="lineNum">    5135 </span><span class="lineNoCov">          0 :                 GDrawDrawRect(pixmap,&amp;r,0x000000);</span>
<span class="lineNum">    5136 </span><span class="lineNoCov">          0 :                 GDrawDrawLine(pixmap,r.x+2,r.y+vw-&gt;as/2,r.x+vw-&gt;as-2,r.y+vw-&gt;as/2,</span>
<span class="lineNum">    5137 </span>            :                         0x000000);
<span class="lineNum">    5138 </span><span class="lineNoCov">          0 :                 if ( !sc-&gt;vs_open )</span>
<span class="lineNum">    5139 </span><span class="lineNoCov">          0 :                     GDrawDrawLine(pixmap,r.x+vw-&gt;as/2,r.y+2,r.x+vw-&gt;as/2,r.y+vw-&gt;as-2,</span>
<span class="lineNum">    5140 </span>            :                             0x000000);
<span class="lineNum">    5141 </span><span class="lineNoCov">          0 :                 GDrawDrawText8(pixmap,r.x+r.width+2,y,sc-&gt;name,-1,0x000000 );</span>
<span class="lineNum">    5142 </span><span class="lineNoCov">          0 :                 y += vw-&gt;fh;</span>
<span class="lineNum">    5143 </span><span class="lineNoCov">          0 :                 ++sofar;</span>
<span class="lineNum">    5144 </span><span class="lineNoCov">          0 :                 if ( sc-&gt;vs_open ) {</span>
<span class="lineNum">    5145 </span><span class="lineNoCov">          0 :                     for ( m=0, bit=(vs_known&lt;&lt;1) ; bit&lt;=vs_last; ++m, bit&lt;&lt;=1 )</span>
<span class="lineNum">    5146 </span><span class="lineNoCov">          0 :                         if ( (bit&amp;vw-&gt;mask) &amp;&amp; (vs&amp;bit) &amp;&amp; vserrornames[m]!=NULL ) {</span>
<span class="lineNum">    5147 </span><span class="lineNoCov">          0 :                             GDrawDrawText8(pixmap,10+r.width+r.x,y,_(vserrornames[m]),-1,0xff0000 );</span>
<span class="lineNum">    5148 </span><span class="lineNoCov">          0 :                             y += vw-&gt;fh;</span>
<span class="lineNum">    5149 </span><span class="lineNoCov">          0 :                             ++sofar;</span>
<span class="lineNum">    5150 </span>            :                         }
<span class="lineNum">    5151 </span>            :                 }
<span class="lineNum">    5152 </span>            :             }
<span class="lineNum">    5153 </span>            :         }
<span class="lineNum">    5154 </span>            :     }
<span class="lineNum">    5155 </span><span class="lineNoCov">          0 :     if ( sofar&lt;vw-&gt;vlcnt ) {</span>
<span class="lineNum">    5156 </span><span class="lineNoCov">          0 :         vs = ValidatePrivate(sf);</span>
<span class="lineNum">    5157 </span><span class="lineNoCov">          0 :         if ( !vw-&gt;needs_blue )</span>
<span class="lineNum">    5158 </span><span class="lineNoCov">          0 :             vs &amp;= ~pds_missingblue;</span>
<span class="lineNum">    5159 </span><span class="lineNoCov">          0 :         if ( vs!=0 ) {</span>
<span class="lineNum">    5160 </span>            :             /* GT: &quot;Private&quot; is a keyword (sort of) in PostScript. Perhaps it */
<span class="lineNum">    5161 </span>            :             /* GT: should remain untranslated? */
<span class="lineNum">    5162 </span><span class="lineNoCov">          0 :             GDrawDrawText8(pixmap,r.x+r.width+2,y,_(&quot;Private Dictionary&quot;),-1,0x000000 );</span>
<span class="lineNum">    5163 </span><span class="lineNoCov">          0 :             y += vw-&gt;fh;</span>
<span class="lineNum">    5164 </span><span class="lineNoCov">          0 :             for ( m=0, bit=1 ; bit!=0; ++m, bit&lt;&lt;=1 ) {</span>
<span class="lineNum">    5165 </span><span class="lineNoCov">          0 :                 if ( vs&amp;bit ) {</span>
<span class="lineNum">    5166 </span><span class="lineNoCov">          0 :                     GDrawDrawText8(pixmap,10+r.width+r.x,y,_(privateerrornames[m]),-1,0xff0000 );</span>
<span class="lineNum">    5167 </span><span class="lineNoCov">          0 :                     y += vw-&gt;fh;</span>
<span class="lineNum">    5168 </span>            :                 }
<span class="lineNum">    5169 </span>            :             }
<span class="lineNum">    5170 </span>            :         }
<span class="lineNum">    5171 </span>            :     }
<span class="lineNum">    5172 </span><span class="lineNoCov">          0 :     GDrawPopClip(pixmap,&amp;old);</span>
<a name="5173"><span class="lineNum">    5173 </span>            : }</a>
<span class="lineNum">    5174 </span>            : 
<span class="lineNum">    5175 </span><span class="lineNoCov">          0 : static int VWCheckup(struct val_data *vw) {</span>
<span class="lineNum">    5176 </span>            :     /* Check some glyphs to see what their validation state is or if they have*/
<span class="lineNum">    5177 </span>            :     /*  changed */
<span class="lineNum">    5178 </span><span class="lineNoCov">          0 :     int gid, k, cnt=0;</span>
<span class="lineNum">    5179 </span>            :     int max;
<span class="lineNum">    5180 </span><span class="lineNoCov">          0 :     SplineFont *sf=vw-&gt;sf, *sub;</span>
<span class="lineNum">    5181 </span><span class="lineNoCov">          0 :     int cntmax = vw-&gt;finished_first_pass ? 40 : 60;</span>
<span class="lineNum">    5182 </span>            :     SplineChar *sc;
<span class="lineNum">    5183 </span><span class="lineNoCov">          0 :     int a_change = false;</span>
<span class="lineNum">    5184 </span><span class="lineNoCov">          0 :     int firstv = true;</span>
<span class="lineNum">    5185 </span>            :     char *buts[4];
<span class="lineNum">    5186 </span>            : 
<span class="lineNum">    5187 </span><span class="lineNoCov">          0 :     if ( sf-&gt;subfontcnt==0 )</span>
<span class="lineNum">    5188 </span><span class="lineNoCov">          0 :         max = vw-&gt;cidmax = sf-&gt;glyphcnt;</span>
<span class="lineNum">    5189 </span>            :     else
<span class="lineNum">    5190 </span><span class="lineNoCov">          0 :         max = vw-&gt;cidmax;</span>
<span class="lineNum">    5191 </span>            : 
<span class="lineNum">    5192 </span><span class="lineNoCov">          0 :     for ( gid=vw-&gt;laststart; gid&lt;max &amp;&amp; cnt&lt;cntmax &amp;&amp; gid&lt;vw-&gt;laststart+2000; ++gid ) {</span>
<span class="lineNum">    5193 </span><span class="lineNoCov">          0 :         if ( sf-&gt;subfontcnt==0 )</span>
<span class="lineNum">    5194 </span><span class="lineNoCov">          0 :             sc = sf-&gt;glyphs[gid];</span>
<span class="lineNum">    5195 </span>            :         else {
<span class="lineNum">    5196 </span><span class="lineNoCov">          0 :             for ( k=0; k&lt;sf-&gt;subfontcnt; ++k ) {</span>
<span class="lineNum">    5197 </span><span class="lineNoCov">          0 :                 sub = sf-&gt;subfonts[k];</span>
<span class="lineNum">    5198 </span><span class="lineNoCov">          0 :                 if ( gid&lt;sub-&gt;glyphcnt &amp;&amp; (sc = sub-&gt;glyphs[gid])!=NULL )</span>
<span class="lineNum">    5199 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    5200 </span>            :             }
<span class="lineNum">    5201 </span>            :         }
<span class="lineNum">    5202 </span><span class="lineNoCov">          0 :         if ( sc!=NULL &amp;&amp; !(sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_known)) {</span>
<span class="lineNum">    5203 </span><span class="lineNoCov">          0 :             if ( firstv ) {</span>
<span class="lineNum">    5204 </span><span class="lineNoCov">          0 :                 GDrawSetCursor(vw-&gt;v,ct_watch);</span>
<span class="lineNum">    5205 </span><span class="lineNoCov">          0 :                 GDrawSync(NULL);</span>
<span class="lineNum">    5206 </span><span class="lineNoCov">          0 :                 firstv = false;</span>
<span class="lineNum">    5207 </span>            :             }
<span class="lineNum">    5208 </span><span class="lineNoCov">          0 :             SCValidate(sc,vw-&gt;layer,true);</span>
<span class="lineNum">    5209 </span><span class="lineNoCov">          0 :             ++cnt;</span>
<span class="lineNum">    5210 </span>            :         }
<span class="lineNum">    5211 </span><span class="lineNoCov">          0 :         if ( sc!=NULL &amp;&amp; vw-&gt;need_to_check_with_user_on_mask &amp;&amp;</span>
<span class="lineNum">    5212 </span><span class="lineNoCov">          0 :                 (sc-&gt;layers[vw-&gt;layer].validation_state&amp;vs_nonintegral )) {</span>
<span class="lineNum">    5213 </span><span class="lineNoCov">          0 :             vw-&gt;need_to_check_with_user_on_mask = false;</span>
<span class="lineNum">    5214 </span><span class="lineNoCov">          0 :             buts[0] = _(&quot;Report as Error&quot;); buts[1]=_(&quot;Ignore&quot;); buts[2] = NULL;</span>
<span class="lineNum">    5215 </span><span class="lineNoCov">          0 :             if ( ff_ask(_(&quot;Not sure if this is an error...&quot;),(const char **) buts,0,1,</span>
<span class="lineNum">    5216 </span><span class="lineNoCov">          0 :                     _(&quot;This font contains non-integral coordinates. That's OK\n&quot;</span>
<span class="lineNum">    5217 </span>            :                         &quot;in PostScript and SVG but causes problems in TrueType.\n&quot;
<span class="lineNum">    5218 </span>            :                         &quot;Should I consider that an error here?&quot;))==0 ) {
<span class="lineNum">    5219 </span><span class="lineNoCov">          0 :                 a_change = true;</span>
<span class="lineNum">    5220 </span><span class="lineNoCov">          0 :                 vw-&gt;mask |= vs_nonintegral;</span>
<span class="lineNum">    5221 </span>            :             }
<span class="lineNum">    5222 </span>            :         }
<span class="lineNum">    5223 </span><span class="lineNoCov">          0 :         if ( sc!=NULL &amp;&amp; sc-&gt;layers[vw-&gt;layer].validation_state!=sc-&gt;layers[vw-&gt;layer].old_vs ) {</span>
<span class="lineNum">    5224 </span><span class="lineNoCov">          0 :             a_change = true;</span>
<span class="lineNum">    5225 </span><span class="lineNoCov">          0 :             sc-&gt;layers[vw-&gt;layer].old_vs = sc-&gt;layers[vw-&gt;layer].validation_state;</span>
<span class="lineNum">    5226 </span>            :         }
<span class="lineNum">    5227 </span>            :     }
<span class="lineNum">    5228 </span><span class="lineNoCov">          0 :     if ( gid&lt;max )</span>
<span class="lineNum">    5229 </span><span class="lineNoCov">          0 :         vw-&gt;laststart = gid;</span>
<span class="lineNum">    5230 </span>            :     else {
<span class="lineNum">    5231 </span><span class="lineNoCov">          0 :         vw-&gt;laststart = 0;</span>
<span class="lineNum">    5232 </span><span class="lineNoCov">          0 :         if ( !vw-&gt;finished_first_pass ) {</span>
<span class="lineNum">    5233 </span><span class="lineNoCov">          0 :             vw-&gt;finished_first_pass = true;</span>
<span class="lineNum">    5234 </span><span class="lineNoCov">          0 :             GDrawCancelTimer(vw-&gt;recheck);</span>
<span class="lineNum">    5235 </span>            :             /* Check less frequently now we've completed a full scan */
<span class="lineNum">    5236 </span><span class="lineNoCov">          0 :             vw-&gt;recheck = GDrawRequestTimer(vw-&gt;v,3000,3000,NULL);</span>
<span class="lineNum">    5237 </span>            :         }
<span class="lineNum">    5238 </span>            :     }
<span class="lineNum">    5239 </span><span class="lineNoCov">          0 :     if ( a_change )</span>
<span class="lineNum">    5240 </span><span class="lineNoCov">          0 :         VW_Remetric(vw);</span>
<span class="lineNum">    5241 </span><span class="lineNoCov">          0 :     if ( !firstv )</span>
<span class="lineNum">    5242 </span><span class="lineNoCov">          0 :         GDrawSetCursor(vw-&gt;v,ct_mypointer);</span>
<span class="lineNum">    5243 </span><span class="lineNoCov">          0 : return( a_change );</span>
<a name="5244"><span class="lineNum">    5244 </span>            : }</a>
<span class="lineNum">    5245 </span>            : 
<span class="lineNum">    5246 </span><span class="lineNoCov">          0 : static int VW_OK(GGadget *g, GEvent *e) {</span>
<span class="lineNum">    5247 </span>            : 
<span class="lineNum">    5248 </span><span class="lineNoCov">          0 :     if ( e-&gt;type==et_controlevent &amp;&amp; e-&gt;u.control.subtype == et_buttonactivate ) {</span>
<span class="lineNum">    5249 </span><span class="lineNoCov">          0 :         struct val_data *vw = (struct val_data *) GDrawGetUserData(GGadgetGetWindow(g));</span>
<span class="lineNum">    5250 </span><span class="lineNoCov">          0 :         GDrawDestroyWindow(vw-&gt;gw);</span>
<span class="lineNum">    5251 </span>            :     }
<span class="lineNum">    5252 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="5253"><span class="lineNum">    5253 </span>            : }</a>
<span class="lineNum">    5254 </span>            :         
<span class="lineNum">    5255 </span><span class="lineNoCov">          0 : static int vwv_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    5256 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    5257 </span>            : 
<span class="lineNum">    5258 </span><span class="lineNoCov">          0 :     switch ( event-&gt;type ) {</span>
<span class="lineNum">    5259 </span>            :       case et_expose:
<span class="lineNum">    5260 </span><span class="lineNoCov">          0 :         if ( vw-&gt;recheck==NULL ) {</span>
<span class="lineNum">    5261 </span><span class="lineNoCov">          0 :             vw-&gt;recheck = GDrawRequestTimer(vw-&gt;v,500,500,NULL);</span>
<span class="lineNum">    5262 </span><span class="lineNoCov">          0 :             VWCheckup(vw);</span>
<span class="lineNum">    5263 </span>            :         }
<span class="lineNum">    5264 </span><span class="lineNoCov">          0 :         VWDrawWindow(gw,vw,event);</span>
<span class="lineNum">    5265 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5266 </span>            :       case et_mouseup:
<span class="lineNum">    5267 </span>            :       case et_mousedown:
<span class="lineNum">    5268 </span>            :       case et_mousemove:
<span class="lineNum">    5269 </span><span class="lineNoCov">          0 :         if (( event-&gt;type==et_mouseup || event-&gt;type==et_mousedown ) &amp;&amp;</span>
<span class="lineNum">    5270 </span><span class="lineNoCov">          0 :                 (event-&gt;u.mouse.button&gt;=4 &amp;&amp; event-&gt;u.mouse.button&lt;=7) ) {</span>
<span class="lineNum">    5271 </span><span class="lineNoCov">          0 : return( GGadgetDispatchEvent(vw-&gt;vsb,event));</span>
<span class="lineNum">    5272 </span>            :         }
<span class="lineNum">    5273 </span><span class="lineNoCov">          0 :         VWMouse(vw,event);</span>
<span class="lineNum">    5274 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5275 </span>            :       case et_char:
<span class="lineNum">    5276 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    5277 </span>            :       break;
<span class="lineNum">    5278 </span>            :       case et_resize: {
<span class="lineNum">    5279 </span><span class="lineNoCov">          0 :         int vlcnt = event-&gt;u.resize.size.height/vw-&gt;fh;</span>
<span class="lineNum">    5280 </span><span class="lineNoCov">          0 :         vw-&gt;vlcnt = vlcnt;</span>
<span class="lineNum">    5281 </span><span class="lineNoCov">          0 :         VW_SetSb(vw);</span>
<span class="lineNum">    5282 </span><span class="lineNoCov">          0 :         GDrawRequestExpose(vw-&gt;v,NULL,false);</span>
<span class="lineNum">    5283 </span><span class="lineNoCov">          0 :       } break;</span>
<span class="lineNum">    5284 </span>            :       case et_timer:
<span class="lineNum">    5285 </span><span class="lineNoCov">          0 :         VWCheckup(vw);</span>
<span class="lineNum">    5286 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    5287 </span>            :     }
<span class="lineNum">    5288 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="5289"><span class="lineNum">    5289 </span>            : }</a>
<span class="lineNum">    5290 </span>            : 
<span class="lineNum">    5291 </span><span class="lineNoCov">          0 : static int vw_e_h(GWindow gw, GEvent *event) {</span>
<span class="lineNum">    5292 </span><span class="lineNoCov">          0 :     struct val_data *vw = (struct val_data *) GDrawGetUserData(gw);</span>
<span class="lineNum">    5293 </span>            : 
<span class="lineNum">    5294 </span><span class="lineNoCov">          0 :     if ( event-&gt;type==et_close ) {</span>
<span class="lineNum">    5295 </span><span class="lineNoCov">          0 :         GDrawDestroyWindow(gw);</span>
<span class="lineNum">    5296 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_char ) {</span>
<span class="lineNum">    5297 </span><span class="lineNoCov">          0 : return( false );</span>
<span class="lineNum">    5298 </span><span class="lineNoCov">          0 :     } else if ( event-&gt;type == et_destroy ) {</span>
<span class="lineNum">    5299 </span><span class="lineNoCov">          0 :         if ( vw-&gt;sf!=NULL )</span>
<span class="lineNum">    5300 </span><span class="lineNoCov">          0 :             vw-&gt;sf-&gt;valwin = NULL;</span>
<span class="lineNum">    5301 </span><span class="lineNoCov">          0 :         chunkfree(vw,sizeof(*vw));</span>
<span class="lineNum">    5302 </span>            :     }
<span class="lineNum">    5303 </span><span class="lineNoCov">          0 : return( true );</span>
<a name="5304"><span class="lineNum">    5304 </span>            : }</a>
<span class="lineNum">    5305 </span>            : 
<span class="lineNum">    5306 </span><span class="lineNoCov">          0 : void SFValidationWindow(SplineFont *sf,int layer,enum fontformat format) {</span>
<span class="lineNum">    5307 </span>            :     GWindowAttrs wattrs;
<span class="lineNum">    5308 </span>            :     GRect pos;
<span class="lineNum">    5309 </span>            :     GWindow gw;
<span class="lineNum">    5310 </span>            :     GGadgetCreateData gcd[4], boxes[4], *harray[4], *butarray[8], *varray[3];
<span class="lineNum">    5311 </span>            :     GTextInfo label[4];
<span class="lineNum">    5312 </span>            :     struct val_data *valwin;
<span class="lineNum">    5313 </span>            :     char buffer[200];
<span class="lineNum">    5314 </span>            :     int k, gid;
<span class="lineNum">    5315 </span>            :     int cidmax;
<span class="lineNum">    5316 </span>            :     SplineFont *sub;
<span class="lineNum">    5317 </span>            :     SplineChar *sc;
<span class="lineNum">    5318 </span>            :     FontRequest rq;
<span class="lineNum">    5319 </span>            :     int as, ds, ld;
<span class="lineNum">    5320 </span>            :     int mask, needs_blue;
<span class="lineNum">    5321 </span>            :     static GFont *valfont=NULL;
<span class="lineNum">    5322 </span>            : 
<span class="lineNum">    5323 </span><span class="lineNoCov">          0 :     if ( sf-&gt;cidmaster )</span>
<span class="lineNum">    5324 </span><span class="lineNoCov">          0 :         sf = sf-&gt;cidmaster;</span>
<span class="lineNum">    5325 </span><span class="lineNoCov">          0 :     mask = VSMaskFromFormat(sf,layer,format);</span>
<span class="lineNum">    5326 </span><span class="lineNoCov">          0 :     needs_blue = (mask==vs_maskps || mask==vs_maskcid);</span>
<span class="lineNum">    5327 </span>            : 
<span class="lineNum">    5328 </span><span class="lineNoCov">          0 :     if ( sf-&gt;valwin!=NULL ) {</span>
<span class="lineNum">    5329 </span>            :         /* Don't need to force a revalidation because if the window exists */
<span class="lineNum">    5330 </span>            :         /*  it's been doing that all by itself */
<span class="lineNum">    5331 </span><span class="lineNoCov">          0 :         if ( mask!=(sf-&gt;valwin-&gt;mask&amp;~vs_nonintegral) ) {</span>
<span class="lineNum">    5332 </span>            :             /* But if we go from postscript to truetype the types of errors */
<span class="lineNum">    5333 </span>            :             /*  change, so what we display might be different */
<span class="lineNum">    5334 </span><span class="lineNoCov">          0 :             sf-&gt;valwin-&gt;mask = mask;</span>
<span class="lineNum">    5335 </span><span class="lineNoCov">          0 :             sf-&gt;valwin-&gt;needs_blue = needs_blue;</span>
<span class="lineNum">    5336 </span><span class="lineNoCov">          0 :             sf-&gt;valwin-&gt;layer = layer;</span>
<span class="lineNum">    5337 </span><span class="lineNoCov">          0 :             VW_Remetric(sf-&gt;valwin);</span>
<span class="lineNum">    5338 </span>            :         }
<span class="lineNum">    5339 </span><span class="lineNoCov">          0 :         GDrawSetVisible(sf-&gt;valwin-&gt;gw,true);</span>
<span class="lineNum">    5340 </span><span class="lineNoCov">          0 :         GDrawRaise(sf-&gt;valwin-&gt;gw);</span>
<span class="lineNum">    5341 </span><span class="lineNoCov">          0 : return;</span>
<span class="lineNum">    5342 </span>            :     }
<span class="lineNum">    5343 </span>            : 
<span class="lineNum">    5344 </span><span class="lineNoCov">          0 :     if ( sf-&gt;subfontcnt!=0 ) {</span>
<span class="lineNum">    5345 </span><span class="lineNoCov">          0 :         cidmax = 0;</span>
<span class="lineNum">    5346 </span><span class="lineNoCov">          0 :         for ( k=0; k&lt;sf-&gt;subfontcnt; ++k )</span>
<span class="lineNum">    5347 </span><span class="lineNoCov">          0 :             if ( sf-&gt;subfonts[k]-&gt;glyphcnt &gt; cidmax )</span>
<span class="lineNum">    5348 </span><span class="lineNoCov">          0 :                 cidmax = sf-&gt;subfonts[k]-&gt;glyphcnt;</span>
<span class="lineNum">    5349 </span>            :     } else
<span class="lineNum">    5350 </span><span class="lineNoCov">          0 :         cidmax = sf-&gt;glyphcnt;</span>
<span class="lineNum">    5351 </span>            : 
<span class="lineNum">    5352 </span>            :     /* Init all glyphs as undrawn */
<span class="lineNum">    5353 </span><span class="lineNoCov">          0 :     for ( gid=0; gid&lt;cidmax ; ++gid ) {</span>
<span class="lineNum">    5354 </span><span class="lineNoCov">          0 :         if ( sf-&gt;subfontcnt==0 )</span>
<span class="lineNum">    5355 </span><span class="lineNoCov">          0 :             sc = sf-&gt;glyphs[gid];</span>
<span class="lineNum">    5356 </span>            :         else {
<span class="lineNum">    5357 </span><span class="lineNoCov">          0 :             for ( k=0; k&lt;sf-&gt;subfontcnt; ++k ) {</span>
<span class="lineNum">    5358 </span><span class="lineNoCov">          0 :                 sub = sf-&gt;subfonts[k];</span>
<span class="lineNum">    5359 </span><span class="lineNoCov">          0 :                 if ( gid&lt;sub-&gt;glyphcnt &amp;&amp; (sc = sub-&gt;glyphs[gid])!=NULL )</span>
<span class="lineNum">    5360 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    5361 </span>            :             }
<span class="lineNum">    5362 </span>            :         }
<span class="lineNum">    5363 </span><span class="lineNoCov">          0 :         if ( sc!=NULL ) {</span>
<span class="lineNum">    5364 </span><span class="lineNoCov">          0 :             sc-&gt;layers[layer].old_vs = 0;</span>
<span class="lineNum">    5365 </span><span class="lineNoCov">          0 :             sc-&gt;vs_open = true;              /* should this default to false? */</span>
<span class="lineNum">    5366 </span>            :         }
<span class="lineNum">    5367 </span>            :     }
<span class="lineNum">    5368 </span>            : 
<span class="lineNum">    5369 </span><span class="lineNoCov">          0 :     valwin = chunkalloc(sizeof(struct val_data));</span>
<span class="lineNum">    5370 </span><span class="lineNoCov">          0 :     valwin-&gt;sf = sf;</span>
<span class="lineNum">    5371 </span><span class="lineNoCov">          0 :     valwin-&gt;mask = mask;</span>
<span class="lineNum">    5372 </span><span class="lineNoCov">          0 :     valwin-&gt;needs_blue = needs_blue;</span>
<span class="lineNum">    5373 </span><span class="lineNoCov">          0 :     valwin-&gt;cidmax = cidmax;</span>
<span class="lineNum">    5374 </span><span class="lineNoCov">          0 :     valwin-&gt;lastgid = -1;</span>
<span class="lineNum">    5375 </span><span class="lineNoCov">          0 :     valwin-&gt;layer = layer;</span>
<span class="lineNum">    5376 </span><span class="lineNoCov">          0 :     valwin-&gt;need_to_check_with_user_on_mask = (format==ff_none &amp;&amp; !sf-&gt;layers[layer].order2 );</span>
<span class="lineNum">    5377 </span>            : 
<span class="lineNum">    5378 </span><span class="lineNoCov">          0 :     memset(&amp;wattrs,0,sizeof(wattrs));</span>
<span class="lineNum">    5379 </span><span class="lineNoCov">          0 :     wattrs.mask = wam_events|wam_cursor|wam_utf8_wtitle|wam_undercursor|wam_isdlg;</span>
<span class="lineNum">    5380 </span><span class="lineNoCov">          0 :     wattrs.event_masks = -1;</span>
<span class="lineNum">    5381 </span><span class="lineNoCov">          0 :     wattrs.cursor = ct_mypointer;</span>
<span class="lineNum">    5382 </span><span class="lineNoCov">          0 :     sprintf( buffer, _(&quot;Validation of %.100s&quot;), sf-&gt;fontname );</span>
<span class="lineNum">    5383 </span><span class="lineNoCov">          0 :     wattrs.utf8_window_title = buffer;</span>
<span class="lineNum">    5384 </span><span class="lineNoCov">          0 :     wattrs.is_dlg = true;</span>
<span class="lineNum">    5385 </span><span class="lineNoCov">          0 :     wattrs.undercursor = 1;</span>
<span class="lineNum">    5386 </span><span class="lineNoCov">          0 :     pos.x = pos.y = 0;</span>
<span class="lineNum">    5387 </span><span class="lineNoCov">          0 :     pos.width = GDrawPointsToPixels(NULL,200);</span>
<span class="lineNum">    5388 </span><span class="lineNoCov">          0 :     pos.height = GDrawPointsToPixels(NULL,300);</span>
<span class="lineNum">    5389 </span><span class="lineNoCov">          0 :     valwin-&gt;gw = gw = GDrawCreateTopWindow(NULL,&amp;pos,vw_e_h,valwin,&amp;wattrs);</span>
<span class="lineNum">    5390 </span>            : 
<span class="lineNum">    5391 </span><span class="lineNoCov">          0 :     if ( valfont==NULL ) {</span>
<span class="lineNum">    5392 </span><span class="lineNoCov">          0 :         memset(&amp;rq,0,sizeof(rq));</span>
<span class="lineNum">    5393 </span><span class="lineNoCov">          0 :         rq.utf8_family_name = &quot;Helvetica&quot;;</span>
<span class="lineNum">    5394 </span><span class="lineNoCov">          0 :         rq.point_size = 11;</span>
<span class="lineNum">    5395 </span><span class="lineNoCov">          0 :         rq.weight = 400;</span>
<span class="lineNum">    5396 </span><span class="lineNoCov">          0 :         valfont = GDrawInstanciateFont(gw,&amp;rq);</span>
<span class="lineNum">    5397 </span><span class="lineNoCov">          0 :         valfont = GResourceFindFont(&quot;Validate.Font&quot;,valfont);</span>
<span class="lineNum">    5398 </span>            :     }
<span class="lineNum">    5399 </span><span class="lineNoCov">          0 :     valwin-&gt;font = valfont;</span>
<span class="lineNum">    5400 </span><span class="lineNoCov">          0 :     GDrawWindowFontMetrics(valwin-&gt;gw,valwin-&gt;font,&amp;as,&amp;ds,&amp;ld);</span>
<span class="lineNum">    5401 </span><span class="lineNoCov">          0 :     valwin-&gt;fh = as+ds;</span>
<span class="lineNum">    5402 </span><span class="lineNoCov">          0 :     valwin-&gt;as = as;</span>
<span class="lineNum">    5403 </span>            : 
<span class="lineNum">    5404 </span><span class="lineNoCov">          0 :     memset(&amp;label,0,sizeof(label));</span>
<span class="lineNum">    5405 </span><span class="lineNoCov">          0 :     memset(&amp;gcd,0,sizeof(gcd));</span>
<span class="lineNum">    5406 </span><span class="lineNoCov">          0 :     memset(&amp;boxes,0,sizeof(boxes));</span>
<span class="lineNum">    5407 </span>            : 
<span class="lineNum">    5408 </span><span class="lineNoCov">          0 :     k = 0;</span>
<span class="lineNum">    5409 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled;</span>
<span class="lineNum">    5410 </span><span class="lineNoCov">          0 :     gcd[k].gd.u.drawable_e_h = vwv_e_h;</span>
<span class="lineNum">    5411 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GDrawableCreate;</span>
<span class="lineNum">    5412 </span>            : 
<span class="lineNum">    5413 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_sb_vert;</span>
<span class="lineNum">    5414 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = VW_VScroll;</span>
<span class="lineNum">    5415 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GScrollBarCreate;</span>
<span class="lineNum">    5416 </span><span class="lineNoCov">          0 :     harray[0] = &amp;gcd[k-2]; harray[1] = &amp;gcd[k-1]; harray[2] = NULL; harray[3] = NULL;</span>
<span class="lineNum">    5417 </span>            : 
<span class="lineNum">    5418 </span><span class="lineNoCov">          0 :     gcd[k].gd.flags = gg_visible | gg_enabled | gg_but_default;</span>
<span class="lineNum">    5419 </span><span class="lineNoCov">          0 :     label[k].text = (unichar_t *) _(&quot;_OK&quot;);</span>
<span class="lineNum">    5420 </span><span class="lineNoCov">          0 :     label[k].text_is_1byte = true;</span>
<span class="lineNum">    5421 </span><span class="lineNoCov">          0 :     label[k].text_in_resource = true;</span>
<span class="lineNum">    5422 </span><span class="lineNoCov">          0 :     gcd[k].gd.label = &amp;label[k];</span>
<span class="lineNum">    5423 </span><span class="lineNoCov">          0 :     gcd[k].gd.handle_controlevent = VW_OK;</span>
<span class="lineNum">    5424 </span><span class="lineNoCov">          0 :     gcd[k++].creator = GButtonCreate;</span>
<span class="lineNum">    5425 </span><span class="lineNoCov">          0 :     butarray[0] = GCD_Glue; butarray[1] = &amp;gcd[k-1]; butarray[2] = GCD_Glue; butarray[3] = NULL;</span>
<span class="lineNum">    5426 </span>            : 
<span class="lineNum">    5427 </span><span class="lineNoCov">          0 :     boxes[2].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    5428 </span><span class="lineNoCov">          0 :     boxes[2].gd.u.boxelements = harray;</span>
<span class="lineNum">    5429 </span><span class="lineNoCov">          0 :     boxes[2].creator = GHVGroupCreate;</span>
<span class="lineNum">    5430 </span>            : 
<span class="lineNum">    5431 </span><span class="lineNoCov">          0 :     boxes[3].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    5432 </span><span class="lineNoCov">          0 :     boxes[3].gd.u.boxelements = butarray;</span>
<span class="lineNum">    5433 </span><span class="lineNoCov">          0 :     boxes[3].creator = GHBoxCreate;</span>
<span class="lineNum">    5434 </span><span class="lineNoCov">          0 :     varray[0] = &amp;boxes[2]; varray[1] = &amp;boxes[3]; varray[2] = NULL;</span>
<span class="lineNum">    5435 </span>            : 
<span class="lineNum">    5436 </span><span class="lineNoCov">          0 :     boxes[0].gd.flags = gg_enabled|gg_visible;</span>
<span class="lineNum">    5437 </span><span class="lineNoCov">          0 :     boxes[0].gd.u.boxelements = varray;</span>
<span class="lineNum">    5438 </span><span class="lineNoCov">          0 :     boxes[0].creator = GVBoxCreate;</span>
<span class="lineNum">    5439 </span>            : 
<span class="lineNum">    5440 </span><span class="lineNoCov">          0 :     GGadgetsCreate(gw,boxes);</span>
<span class="lineNum">    5441 </span><span class="lineNoCov">          0 :     valwin-&gt;vsb = gcd[1].ret;</span>
<span class="lineNum">    5442 </span><span class="lineNoCov">          0 :     valwin-&gt;v = GDrawableGetWindow(gcd[0].ret);</span>
<span class="lineNum">    5443 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableRow(boxes[0].ret,0);</span>
<span class="lineNum">    5444 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(boxes[2].ret,0);</span>
<span class="lineNum">    5445 </span><span class="lineNoCov">          0 :     GHVBoxSetPadding(boxes[2].ret,0,0);</span>
<span class="lineNum">    5446 </span><span class="lineNoCov">          0 :     GHVBoxSetExpandableCol(boxes[3].ret,gb_expandglue);</span>
<span class="lineNum">    5447 </span><span class="lineNoCov">          0 :     GHVBoxFitWindow(boxes[0].ret);</span>
<span class="lineNum">    5448 </span>            : 
<span class="lineNum">    5449 </span><span class="lineNoCov">          0 :     GDrawSetVisible(gw,true);</span>
<a name="5450"><span class="lineNum">    5450 </span>            : }</a>
<span class="lineNum">    5451 </span>            : 
<span class="lineNum">    5452 </span><span class="lineNoCov">          0 : void ValidationDestroy(SplineFont *sf) {</span>
<span class="lineNum">    5453 </span><span class="lineNoCov">          0 :     if ( sf-&gt;valwin!=NULL ) {</span>
<span class="lineNum">    5454 </span><span class="lineNoCov">          0 :         sf-&gt;valwin-&gt;sf = NULL;</span>
<span class="lineNum">    5455 </span><span class="lineNoCov">          0 :         GDrawDestroyWindow(sf-&gt;valwin-&gt;gw);</span>
<span class="lineNum">    5456 </span><span class="lineNoCov">          0 :         sf-&gt;valwin = NULL;</span>
<span class="lineNum">    5457 </span>            :     }
<span class="lineNum">    5458 </span><span class="lineNoCov">          0 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
